---
title: Création d’une transformation asynchrone à l’aide du composant Script | Microsoft Docs
ms.custom: ''
ms.date: 06/13/2017
ms.prod: sql-server-2014
ms.reviewer: ''
ms.technology: integration-services
ms.topic: reference
dev_langs:
- VB
helpviewer_keywords:
- asynchronous outputs [Integration Services]
- transformation components [Integration Services]
- Script component [Integration Services], transformation components
ms.assetid: 0d814404-21e4-4a68-894c-96fa47ab25ae
author: chugugrace
ms.author: chugu
ms.openlocfilehash: 465c4a597b4a18d7bd956116cd5d7640a5393958
ms.sourcegitcommit: ad4d92dce894592a259721a1571b1d8736abacdb
ms.translationtype: MT
ms.contentlocale: fr-FR
ms.lasthandoff: 08/04/2020
ms.locfileid: "87610728"
---
# <a name="creating-an-asynchronous-transformation-with-the-script-component"></a><span data-ttu-id="40157-102">Création d'une transformation asynchrone à l'aide du composant Script</span><span class="sxs-lookup"><span data-stu-id="40157-102">Creating an Asynchronous Transformation with the Script Component</span></span>
  <span data-ttu-id="40157-103">Vous utilisez un composant de transformation dans le flux de données d'un package [!INCLUDE[ssISnoversion](../../includes/ssisnoversion-md.md)] pour modifier et analyser les données acheminées de la source à la destination.</span><span class="sxs-lookup"><span data-stu-id="40157-103">You use a transformation component in the data flow of an [!INCLUDE[ssISnoversion](../../includes/ssisnoversion-md.md)] package to modify and analyze data as it passes from source to destination.</span></span> <span data-ttu-id="40157-104">Une transformation à sorties synchrones traite chacune des lignes d'entrée lorsqu'elles traversent le composant.</span><span class="sxs-lookup"><span data-stu-id="40157-104">A transformation with synchronous outputs processes each input row as it passes through the component.</span></span> <span data-ttu-id="40157-105">Une transformation à sorties asynchrones peut attendre d’avoir reçu toutes les lignes d’entrée avant de procéder au traitement des données, ou elle peut exporter certaines lignes avant d’avoir reçu toutes les lignes d’entrée.</span><span class="sxs-lookup"><span data-stu-id="40157-105">A transformation with asynchronous outputs may wait to complete its processing until the transformation has received all input rows, or the transformation may output certain rows before it has received all input rows.</span></span> <span data-ttu-id="40157-106">Cette rubrique examine une transformation asynchrone.</span><span class="sxs-lookup"><span data-stu-id="40157-106">This topic discusses an asynchronous transformation.</span></span> <span data-ttu-id="40157-107">Si votre traitement requiert une transformation synchrone, consultez [Création d’une transformation synchrone à l’aide du composant Script](../data-flow/transformations/script-component.md).</span><span class="sxs-lookup"><span data-stu-id="40157-107">If your processing requires a synchronous transformation, see [Creating a Synchronous Transformation with the Script Component](../data-flow/transformations/script-component.md).</span></span> <span data-ttu-id="40157-108">Pour plus d’informations sur la différence entre les composants synchrones et asynchrones, consultez [Présentation des transformations synchrones et asynchrones](../understanding-synchronous-and-asynchronous-transformations.md).</span><span class="sxs-lookup"><span data-stu-id="40157-108">For more information about the differences between synchronous and asynchronous components, see [Understanding Synchronous and Asynchronous Transformations](../understanding-synchronous-and-asynchronous-transformations.md).</span></span>

 <span data-ttu-id="40157-109">Pour une vue d’ensemble du composant Script, consultez [Extension du flux de données avec le composant Script](../extending-packages-scripting/data-flow-script-component/extending-the-data-flow-with-the-script-component.md).</span><span class="sxs-lookup"><span data-stu-id="40157-109">For an overview of the Script component, see [Extending the Data Flow with the Script Component](../extending-packages-scripting/data-flow-script-component/extending-the-data-flow-with-the-script-component.md).</span></span>

 <span data-ttu-id="40157-110">Le composant Script et le code d'infrastructure qu'il génère simplifient le processus qui consiste à développer un composant de flux de données personnalisé.</span><span class="sxs-lookup"><span data-stu-id="40157-110">The Script component and the infrastructure code that it generates for you simplify the process of developing a custom data flow component.</span></span> <span data-ttu-id="40157-111">Toutefois, pour comprendre le fonctionnement du composant Script, il peut être utile de lire les étapes que vous devez suivre pour développer un composant de flux de données personnalisé dans la section [Développement d’un composant de flux de données personnalisé](../extending-packages-custom-objects/data-flow/developing-a-custom-data-flow-component.md) et plus particulièrement dans [Développement d’un composant de transformation personnalisé à sorties synchrones](../extending-packages-custom-objects-data-flow-types/developing-a-custom-transformation-component-with-synchronous-outputs.md).</span><span class="sxs-lookup"><span data-stu-id="40157-111">However, to understand how the Script component works, you may find it useful to read through the steps that you must follow in developing a custom data flow component in the [Developing a Custom Data Flow Component](../extending-packages-custom-objects/data-flow/developing-a-custom-data-flow-component.md) section, and especially [Developing a Custom Transformation Component with Synchronous Outputs](../extending-packages-custom-objects-data-flow-types/developing-a-custom-transformation-component-with-synchronous-outputs.md).</span></span>

## <a name="getting-started-with-an-asynchronous-transformation-component"></a><span data-ttu-id="40157-112">Mise en route d'un composant de transformation asynchrone</span><span class="sxs-lookup"><span data-stu-id="40157-112">Getting Started with an Asynchronous Transformation Component</span></span>
 <span data-ttu-id="40157-113">Lorsque vous ajoutez un composant Script à l’onglet Flux de données du concepteur [!INCLUDE[ssIS](../../includes/ssis-md.md)], la boîte de dialogue **Sélectionner le type de composant de script** s’affiche et vous invite à préconfigurer le composant en tant que source, transformation ou destination.</span><span class="sxs-lookup"><span data-stu-id="40157-113">When you add a Script component to the Data Flow tab of [!INCLUDE[ssIS](../../includes/ssis-md.md)] Designer, the **Select Script Component Type** dialog box appears, prompting you to preconfigure the component as a source, transformation, or destination.</span></span> <span data-ttu-id="40157-114">Dans cette boîte de dialogue, sélectionnez **Transformation**.</span><span class="sxs-lookup"><span data-stu-id="40157-114">In this dialog box, select **Transformation**.</span></span>

## <a name="configuring-an-asynchronous-transformation-component-in-metadata-design-mode"></a><span data-ttu-id="40157-115">Configuration d'un composant de transformation asynchrone en mode Création de métadonnées</span><span class="sxs-lookup"><span data-stu-id="40157-115">Configuring an Asynchronous Transformation Component in Metadata-Design Mode</span></span>
 <span data-ttu-id="40157-116">Après avoir sélectionné l’option de création d’un composant de transformation, configurez le composant dans l’**Éditeur de transformation de script**.</span><span class="sxs-lookup"><span data-stu-id="40157-116">After you select the option to create a transformation component, you configure the component by using the **Script Transformation Editor**.</span></span> <span data-ttu-id="40157-117">Pour plus d’informations, consultez [Configuration du composant Script dans l’éditeur de composant de script](../extending-packages-scripting/data-flow-script-component/configuring-the-script-component-in-the-script-component-editor.md).</span><span class="sxs-lookup"><span data-stu-id="40157-117">For more information, see [Configuring the Script Component in the Script Component Editor](../extending-packages-scripting/data-flow-script-component/configuring-the-script-component-in-the-script-component-editor.md).</span></span>

 <span data-ttu-id="40157-118">Pour sélectionner le langage de script qui sera utilisé par le composant Script, vous devez définir la propriété **ScriptLanguage** dans la page **Script** de la boîte de dialogue **Éditeur de transformation de script**.</span><span class="sxs-lookup"><span data-stu-id="40157-118">To select the script language that the Script component will use, you set the **ScriptLanguage** property on the **Script** page of the **Script Transformation Editor** dialog box.</span></span>

> [!NOTE]
>  <span data-ttu-id="40157-119">Pour définir le langage de script par défaut du composant Script, utilisez l’option **Langage de script** dans la page **Général** de la boîte de dialogue **Options**.</span><span class="sxs-lookup"><span data-stu-id="40157-119">To set the default scripting language for the Script component, use the **Scripting language** option on the **General** page of the **Options** dialog box.</span></span> <span data-ttu-id="40157-120">Pour plus d'informations, consultez [General Page](../general-page-of-integration-services-designers-options.md).</span><span class="sxs-lookup"><span data-stu-id="40157-120">For more information, see [General Page](../general-page-of-integration-services-designers-options.md).</span></span>

 <span data-ttu-id="40157-121">Un composant de transformation de flux de données possède une entrée et prend en charge une ou plusieurs sorties.</span><span class="sxs-lookup"><span data-stu-id="40157-121">A data flow transformation component has one input and supports one or more outputs.</span></span> <span data-ttu-id="40157-122">La configuration de l’entrée et des sorties du composant est l’une des étapes à exécuter en mode Création des métadonnées, à l’aide de l’**Éditeur de transformation de script**, avant d’écrire le script personnalisé.</span><span class="sxs-lookup"><span data-stu-id="40157-122">Configuring the input and outputs of your component is one of the steps that you must complete in metadata design mode, by using the **Script Transformation Editor**, before you write your custom script.</span></span>

### <a name="configuring-input-columns"></a><span data-ttu-id="40157-123">Configuration de colonnes d'entrée</span><span class="sxs-lookup"><span data-stu-id="40157-123">Configuring Input Columns</span></span>
 <span data-ttu-id="40157-124">Un composant de transformation créé à l'aide du composant Script possède une seule entrée.</span><span class="sxs-lookup"><span data-stu-id="40157-124">A transformation component created by using the Script component has a single input.</span></span>

 <span data-ttu-id="40157-125">Dans la page **Colonnes d’entrée** de l’**Éditeur de transformation de script**, la liste des colonnes affiche les colonnes disponibles dans la sortie du composant en amont du flux de données.</span><span class="sxs-lookup"><span data-stu-id="40157-125">On the **Input Columns** page of the **Script Transformation Editor**, the columns list shows the available columns from the output of the upstream component in the data flow.</span></span> <span data-ttu-id="40157-126">Sélectionnez les colonnes à transformer ou à passer.</span><span class="sxs-lookup"><span data-stu-id="40157-126">Select the columns that you want to transform or pass through.</span></span> <span data-ttu-id="40157-127">Marquez toutes les colonnes que vous souhaitez transformer sur place comme accessibles en lecture/écriture.</span><span class="sxs-lookup"><span data-stu-id="40157-127">Mark any columns that you want to transform in place as Read/Write.</span></span>

 <span data-ttu-id="40157-128">Pour plus d’informations sur la page **Colonnes d’entrée** de l’**Éditeur de transformation de script**, consultez [Éditeur de transformation de script &#40;page Colonnes d’entrée&#41;](../script-transformation-editor-input-columns-page.md).</span><span class="sxs-lookup"><span data-stu-id="40157-128">For more information about the **Input Columns** page of the **Script Transformation Editor**, see [Script Transformation Editor &#40;Input Columns Page&#41;](../script-transformation-editor-input-columns-page.md).</span></span>

### <a name="configuring-inputs-outputs-and-output-columns"></a><span data-ttu-id="40157-129">Configuration des entrées, des sorties et des colonnes de sortie</span><span class="sxs-lookup"><span data-stu-id="40157-129">Configuring Inputs, Outputs, and Output Columns</span></span>
 <span data-ttu-id="40157-130">Un composant de transformation prend en charge une ou plusieurs sorties.</span><span class="sxs-lookup"><span data-stu-id="40157-130">A transformation component supports one or more outputs.</span></span>

 <span data-ttu-id="40157-131">Généralement, une transformation à sorties asynchrones possède deux sorties.</span><span class="sxs-lookup"><span data-stu-id="40157-131">Frequently a transformation with asynchronous outputs has two outputs.</span></span> <span data-ttu-id="40157-132">Par exemple, lorsque vous comptez le nombre d'adresses situées dans une ville spécifique, vous pouvez transférer les données d'adresse à une sortie, tout en envoyant le résultat de l'agrégation à une autre sortie.</span><span class="sxs-lookup"><span data-stu-id="40157-132">For example, when you count the number of addresses located in a specific city, you may want to pass the address data through to one output, while sending the result of the aggregation to another output.</span></span> <span data-ttu-id="40157-133">La sortie d'agrégation requiert également une nouvelle colonne de sortie.</span><span class="sxs-lookup"><span data-stu-id="40157-133">The aggregation output also requires a new output column.</span></span>

 <span data-ttu-id="40157-134">Dans la page **Entrées et sorties** de l’**Éditeur de transformation de script**, vous pouvez noter qu’une seule sortie a été créée par défaut, mais qu’aucune colonne de sortie n’a été créée.</span><span class="sxs-lookup"><span data-stu-id="40157-134">On the **Inputs and Outputs** page of the **Script Transformation Editor**, you see that a single output has been created by default, but no output columns have been created.</span></span> <span data-ttu-id="40157-135">Dans cette page de l'éditeur, vous pouvez configurer les éléments suivants :</span><span class="sxs-lookup"><span data-stu-id="40157-135">On this page of the editor, you can configure the following items:</span></span>

-   <span data-ttu-id="40157-136">Vous pouvez créer une ou plusieurs sorties supplémentaires, telles qu'une sortie pour le résultat d'une agrégation.</span><span class="sxs-lookup"><span data-stu-id="40157-136">You may want to create one or more additional outputs, such as an output for the result of an aggregation.</span></span> <span data-ttu-id="40157-137">Les boutons **Ajouter une sortie** et **Supprimer une sortie** permettent de gérer les sorties du composant de transformation asynchrone.</span><span class="sxs-lookup"><span data-stu-id="40157-137">Use the **Add Output** and **Remove Output** buttons to manage the outputs of your asynchronous transformation component.</span></span> <span data-ttu-id="40157-138">Attribuez la valeur zéro à la propriété `SynchronousInputID` de chaque sortie pour indiquer que le rôle de la sortie ne consiste pas simplement à transmettre les données d'un composant en amont ou à les transformer sur place dans les lignes et colonnes existantes.</span><span class="sxs-lookup"><span data-stu-id="40157-138">Set the `SynchronousInputID` property of each output to zero to indicate that the output does not simply pass through data from an upstream component or transform it in place in the existing rows and columns.</span></span> <span data-ttu-id="40157-139">C'est ce paramètre qui rend les sorties asynchrones par rapport à l'entrée.</span><span class="sxs-lookup"><span data-stu-id="40157-139">It is this setting that makes the outputs asynchronous to the input.</span></span>

-   <span data-ttu-id="40157-140">Vous pouvez assigner un nom convivial à l'entrée et aux sorties.</span><span class="sxs-lookup"><span data-stu-id="40157-140">You may want to assign a friendly name to the input and outputs.</span></span> <span data-ttu-id="40157-141">Le composant Script utilise ces noms pour générer les propriétés d'accesseur typées qui vous permettent de référencer l'entrée et les sorties dans le script.</span><span class="sxs-lookup"><span data-stu-id="40157-141">The Script component uses these names to generate the typed accessor properties that you will use to refer to the input and outputs in your script.</span></span>

-   <span data-ttu-id="40157-142">Généralement, une transformation asynchrone ajoute des colonnes au flux de données.</span><span class="sxs-lookup"><span data-stu-id="40157-142">Frequently an asynchronous transformation adds columns to the data flow.</span></span> <span data-ttu-id="40157-143">Lorsque la valeur zéro est attribuée à la propriété `SynchronousInputID` d'une sortie, ce qui indique que le rôle de la sortie ne consiste pas simplement à transmettre les données d'un composant en amont ou à les transformer sur place dans les lignes et colonnes existantes, vous devez ajouter et configurer des colonnes de sortie de manière explicite sur la sortie.</span><span class="sxs-lookup"><span data-stu-id="40157-143">When the `SynchronousInputID` property of an output is zero, indicating that the output does not simply pass through data from an upstream component or transform it in place in the existing rows and columns, you must add and configure output columns explicitly on the output.</span></span> <span data-ttu-id="40157-144">Les colonnes de sortie ne portent pas le même nom que les colonnes d'entrée auxquelles elles sont mappées.</span><span class="sxs-lookup"><span data-stu-id="40157-144">Output columns do not have to have the same names as the input columns to which they are mapped.</span></span>

-   <span data-ttu-id="40157-145">Vous pouvez ajouter d'autres colonnes pour contenir des informations supplémentaires.</span><span class="sxs-lookup"><span data-stu-id="40157-145">You may want to add more columns to contain additional information.</span></span> <span data-ttu-id="40157-146">Vous devez écrire votre propre code pour remplir les colonnes supplémentaires de données.</span><span class="sxs-lookup"><span data-stu-id="40157-146">You must write your own code to fill the additional columns with data.</span></span> <span data-ttu-id="40157-147">Pour plus d’informations sur la reproduction du comportement d’une sortie d’erreur standard, consultez [Simulation d’une sortie d’erreur pour le composant Script](../extending-packages-scripting-data-flow-script-component-examples/simulating-an-error-output-for-the-script-component.md).</span><span class="sxs-lookup"><span data-stu-id="40157-147">For information about reproducing the behavior of a standard error output, see [Simulating an Error Output for the Script Component](../extending-packages-scripting-data-flow-script-component-examples/simulating-an-error-output-for-the-script-component.md).</span></span>

 <span data-ttu-id="40157-148">Pour plus d’informations sur la page **Entrées et sorties** de l’**Éditeur de transformation de script**, consultez [Éditeur de transformation de script &#40;page Entrées et sorties&#41;](../script-transformation-editor-inputs-and-outputs-page.md).</span><span class="sxs-lookup"><span data-stu-id="40157-148">For more information about the **Inputs and Outputs** page of the **Script Transformation Editor**, see [Script Transformation Editor &#40;Inputs and Outputs Page&#41;](../script-transformation-editor-inputs-and-outputs-page.md).</span></span>

### <a name="adding-variables"></a><span data-ttu-id="40157-149">Ajout de variables</span><span class="sxs-lookup"><span data-stu-id="40157-149">Adding Variables</span></span>
 <span data-ttu-id="40157-150">S’il existe des variables dont vous souhaitez utiliser les valeurs dans votre script, vous pouvez les ajouter dans les champs de propriété ReadOnlyVariables et ReadWriteVariables de la page **Script** de l’**Éditeur de transformation de script**.</span><span class="sxs-lookup"><span data-stu-id="40157-150">If there are any existing variables whose values you want to use in your script, you can add them in the ReadOnlyVariables and ReadWriteVariables property fields on the **Script** page of the **Script Transformation Editor**.</span></span>

 <span data-ttu-id="40157-151">Lorsque vous ajoutez plusieurs variables dans les champs de propriété, séparez les noms de variables par des virgules.</span><span class="sxs-lookup"><span data-stu-id="40157-151">When you add multiple variables in the property fields, separate the variable names by commas.</span></span> <span data-ttu-id="40157-152">Vous pouvez également sélectionner plusieurs variables en cliquant sur le bouton des points de suspension (**...**) en regard des `ReadOnlyVariables` `ReadWriteVariables` champs de propriété et, puis en sélectionnant les variables dans la boîte de dialogue **Sélectionner des variables** .</span><span class="sxs-lookup"><span data-stu-id="40157-152">You can also select multiple variables by clicking the ellipsis (**...**) button next to the `ReadOnlyVariables` and `ReadWriteVariables` property fields, and then selecting the variables in the **Select variables** dialog box.</span></span>

 <span data-ttu-id="40157-153">Pour obtenir des informations générales sur l’utilisation de variables avec le composant Script, consultez [Utilisation de variables dans le composant Script](../extending-packages-scripting/data-flow-script-component/using-variables-in-the-script-component.md).</span><span class="sxs-lookup"><span data-stu-id="40157-153">For general information about how to use variables with the Script component, see [Using Variables in the Script Component](../extending-packages-scripting/data-flow-script-component/using-variables-in-the-script-component.md).</span></span>

 <span data-ttu-id="40157-154">Pour plus d’informations sur la page **Script** de l’**Éditeur de transformation de script**, consultez [Éditeur de transformation de script &#40;page Script&#41;](../script-transformation-editor-script-page.md).</span><span class="sxs-lookup"><span data-stu-id="40157-154">For more information about the **Script** page of the **Script Transformation Editor**, see [Script Transformation Editor &#40;Script Page&#41;](../script-transformation-editor-script-page.md).</span></span>

## <a name="scripting-an-asynchronous-transformation-component-in-code-design-mode"></a><span data-ttu-id="40157-155">Script d'un composant de transformation asynchrone en mode Création de code</span><span class="sxs-lookup"><span data-stu-id="40157-155">Scripting an Asynchronous Transformation Component in Code-Design Mode</span></span>
 <span data-ttu-id="40157-156">Après avoir configuré toutes les métadonnées du composant, vous pouvez écrire votre script personnalisé.</span><span class="sxs-lookup"><span data-stu-id="40157-156">After you have configured all the metadata for your component, you can write your custom script.</span></span> <span data-ttu-id="40157-157">Dans l’**Éditeur de transformation de script**, dans la page **Script**, cliquez sur **Modifier le script** pour ouvrir l’environnement de développement intégré [!INCLUDE[msCoName](../../includes/msconame-md.md)] [!INCLUDE[vsprvs](../../includes/vsprvs-md.md)] Tools for Applications (VSTA) où vous pouvez ajouter votre script personnalisé.</span><span class="sxs-lookup"><span data-stu-id="40157-157">In the **Script Transformation Editor**, on the **Script** page, click **Edit Script** to open the [!INCLUDE[msCoName](../../includes/msconame-md.md)] [!INCLUDE[vsprvs](../../includes/vsprvs-md.md)] Tools for Applications (VSTA) IDE where you can add your custom script.</span></span> <span data-ttu-id="40157-158">Le langage de script utilisé varie selon que vous avez sélectionné [!INCLUDE[msCoName](../../includes/msconame-md.md)] Visual Basic ou [!INCLUDE[msCoName](../../includes/msconame-md.md)] Visual C# comme langage de script pour la propriété **ScriptLanguage** dans la page **Script**.</span><span class="sxs-lookup"><span data-stu-id="40157-158">The scripting language that you use depends on whether you selected [!INCLUDE[msCoName](../../includes/msconame-md.md)] Visual Basic or [!INCLUDE[msCoName](../../includes/msconame-md.md)] Visual C# as the script language for the **ScriptLanguage** property on the **Script** page.</span></span>

 <span data-ttu-id="40157-159">Pour obtenir des informations importantes concernant tous les types de composants créés à l’aide du composant Script, consultez [Codage et débogage du composant Script](../extending-packages-scripting/data-flow-script-component/coding-and-debugging-the-script-component.md).</span><span class="sxs-lookup"><span data-stu-id="40157-159">For important information that applies to all kinds of components created by using the Script component, see [Coding and Debugging the Script Component](../extending-packages-scripting/data-flow-script-component/coding-and-debugging-the-script-component.md).</span></span>

### <a name="understanding-the-auto-generated-code"></a><span data-ttu-id="40157-160">Fonctionnement du code généré automatiquement</span><span class="sxs-lookup"><span data-stu-id="40157-160">Understanding the Auto-generated Code</span></span>
 <span data-ttu-id="40157-161">Lorsque vous ouvrez l’environnement de développement intégré VSTA après avoir créé et configuré un composant de transformation, la classe modifiable `ScriptMain` apparaît dans l’éditeur de code avec des stubs pour les méthodes ProcessInputRow et CreateNewOutputRows.</span><span class="sxs-lookup"><span data-stu-id="40157-161">When you open the VSTA IDE after creating and configuring a transformation component, the editable `ScriptMain` class appears in the code editor with stubs for the ProcessInputRow and the CreateNewOutputRows methods.</span></span> <span data-ttu-id="40157-162">La classe ScriptMain est l’emplacement où vous allez écrire votre code personnalisé et ProcessInputRow est la méthode la plus importante d’un composant de transformation.</span><span class="sxs-lookup"><span data-stu-id="40157-162">The ScriptMain class is where you will write your custom code, and ProcessInputRow is the most important method in a transformation component.</span></span> <span data-ttu-id="40157-163">La méthode `CreateNewOutputRows`, plus généralement utilisée dans un composant source, s'apparente à une transformation asynchrone dans la mesure où les deux composants doivent créer leurs propres lignes de sortie.</span><span class="sxs-lookup"><span data-stu-id="40157-163">The `CreateNewOutputRows` method is more typically used in a source component, which is like an asynchronous transformation in that both components must create their own output rows.</span></span>

 <span data-ttu-id="40157-164">Si vous ouvrez la fenêtre **Explorateur de projets** VSTA, vous pouvez voir que le composant script a également généré des `BufferWrapper` éléments de projet et en lecture seule `ComponentWrapper` .</span><span class="sxs-lookup"><span data-stu-id="40157-164">If you open the VSTA **Project Explorer** window, you can see that the Script component has also generated read-only `BufferWrapper` and `ComponentWrapper` project items.</span></span> <span data-ttu-id="40157-165">La classe ScriptMain hérite de la classe UserComponent dans l' `ComponentWrapper` élément de projet.</span><span class="sxs-lookup"><span data-stu-id="40157-165">The ScriptMain class inherits from the UserComponent class in the `ComponentWrapper` project item.</span></span>

 <span data-ttu-id="40157-166">Au moment de l’exécution, le moteur de workflow appelle la méthode PrimeOutput dans la `UserComponent` classe, qui remplace la <xref:Microsoft.SqlServer.Dts.Pipeline.ScriptComponentHost.PrimeOutput%2A> méthode de la <xref:Microsoft.SqlServer.Dts.Pipeline.ScriptComponent> classe parente.</span><span class="sxs-lookup"><span data-stu-id="40157-166">At run time, the data flow engine calls the PrimeOutput method in the `UserComponent` class, which overrides the <xref:Microsoft.SqlServer.Dts.Pipeline.ScriptComponentHost.PrimeOutput%2A> method of the <xref:Microsoft.SqlServer.Dts.Pipeline.ScriptComponent> parent class.</span></span> <span data-ttu-id="40157-167">La méthode PrimeOutput appelle à son tour la méthode CreateNewOutputRows.</span><span class="sxs-lookup"><span data-stu-id="40157-167">The PrimeOutput method in turn calls the CreateNewOutputRows method.</span></span>

 <span data-ttu-id="40157-168">Le moteur de flux de données appelle ensuite la méthode ProcessInput dans la classe UserComponent, qui remplace la méthode <xref:Microsoft.SqlServer.Dts.Pipeline.ScriptComponent.ProcessInput%2A> de la classe parente <xref:Microsoft.SqlServer.Dts.Pipeline.ScriptComponent>.</span><span class="sxs-lookup"><span data-stu-id="40157-168">Next, the data flow engine invokes the ProcessInput method in the UserComponent class, which overrides the <xref:Microsoft.SqlServer.Dts.Pipeline.ScriptComponent.ProcessInput%2A> method of the <xref:Microsoft.SqlServer.Dts.Pipeline.ScriptComponent> parent class.</span></span> <span data-ttu-id="40157-169">La méthode ProcessInput parcourt à son tour les lignes du tampon d’entrée et appelle la méthode ProcessInputRow une fois pour chaque ligne.</span><span class="sxs-lookup"><span data-stu-id="40157-169">The ProcessInput method in turn loops through the rows in the input buffer and calls the ProcessInputRow method one time for each row.</span></span>

### <a name="writing-your-custom-code"></a><span data-ttu-id="40157-170">Écriture du code personnalisé</span><span class="sxs-lookup"><span data-stu-id="40157-170">Writing Your Custom Code</span></span>
 <span data-ttu-id="40157-171">Pour achever la création d’un composant de transformation asynchrone personnalisé, vous devez appliquer la méthode ProcessInputRow remplacée pour traiter les données dans chaque ligne de la mémoire tampon d’entrée.</span><span class="sxs-lookup"><span data-stu-id="40157-171">To finish creating a custom asynchronous transformation component, you must use the overridden ProcessInputRow method to process the data in each row of the input buffer.</span></span> <span data-ttu-id="40157-172">Comme les sorties ne sont pas synchrones avec l'entrée, vous devez écrire explicitement des lignes de données dans les sorties.</span><span class="sxs-lookup"><span data-stu-id="40157-172">Because the outputs are not synchronous to the input, you must explicitly write rows of data to the outputs.</span></span>

 <span data-ttu-id="40157-173">Dans une transformation asynchrone, vous pouvez utiliser la méthode AddRow pour ajouter des lignes à la sortie appropriée à partir des méthodes ProcessInputRow ou ProcessInput.</span><span class="sxs-lookup"><span data-stu-id="40157-173">In an asynchronous transformation, you can use the AddRow method to add rows to the output as appropriate from within the ProcessInputRow or ProcessInput methods.</span></span> <span data-ttu-id="40157-174">Il est inutile d’utiliser la méthode CreateNewOutputRows.</span><span class="sxs-lookup"><span data-stu-id="40157-174">You do not have to use the CreateNewOutputRows method.</span></span> <span data-ttu-id="40157-175">Si vous écrivez une seule ligne de résultats, comme des résultats d’agrégation, dans une sortie particulière, vous pouvez créer au préalable la ligne de sortie à l’aide de la méthode CreateNewOutputRows et spécifier ses valeurs ultérieurement après avoir traité toutes les lignes d’entrée.</span><span class="sxs-lookup"><span data-stu-id="40157-175">If you are writing a single row of results, such as aggregation results, to a particular output, you can create the output row beforehand by using the CreateNewOutputRows method, and fill in its values later after processing all input rows.</span></span> <span data-ttu-id="40157-176">Toutefois, il est inutile de créer plusieurs lignes dans la méthode CreateNewOutputRows car le composant Script ne vous permet d’utiliser que la ligne en cours dans une entrée ou une sortie.</span><span class="sxs-lookup"><span data-stu-id="40157-176">However it is not useful to create multiple rows in the CreateNewOutputRows method, because the Script component only lets you use the current row in an input or output.</span></span> <span data-ttu-id="40157-177">La méthode CreateNewOutputRows est plus importante dans un composant source où il n’existe pas de ligne d’entrée à traiter.</span><span class="sxs-lookup"><span data-stu-id="40157-177">The CreateNewOutputRows method is more important in a source component where there are no input rows to process.</span></span>

 <span data-ttu-id="40157-178">Vous pouvez également remplacer la méthode ProcessInput elle-même, afin d’effectuer d’autres traitements préliminaires ou finaux avant ou après avoir parcouru la mémoire tampon d’entrée et appelé la méthode ProcessInputRow pour chaque ligne.</span><span class="sxs-lookup"><span data-stu-id="40157-178">You may also want to override the ProcessInput method itself, so that you can do additional preliminary or final processing before or after you loop through the input buffer and call ProcessInputRow for each row.</span></span> <span data-ttu-id="40157-179">Par exemple, l’un des exemples de code de cette rubrique remplace ProcessInput pour compter le nombre d’adresses dans une ville spécifique, car ProcessInputRow effectue une boucle sur les lignes `.` . l’exemple écrit la valeur résumée dans la deuxième sortie une fois que toutes les lignes ont été traitées.</span><span class="sxs-lookup"><span data-stu-id="40157-179">For example, one of the code examples in this topic overrides ProcessInput to count the number of addresses in a specific city as ProcessInputRow loops through rows`.` The example writes the summary value to the second output after all rows have been processed.</span></span> <span data-ttu-id="40157-180">L’exemple exécute l’opération de sortie dans ProcessInput car les mémoires tampons de sortie ne sont plus disponibles lorsque la méthode PostExecute est appelée.</span><span class="sxs-lookup"><span data-stu-id="40157-180">The example completes the output in ProcessInput because the output buffers are no longer available when PostExecute is called.</span></span>

 <span data-ttu-id="40157-181">Selon vos besoins, vous voudrez également écrire le script dans les méthodes PreExecute et PostExecute disponibles dans la classe ScriptMain pour effectuer tout traitement préliminaire ou final.</span><span class="sxs-lookup"><span data-stu-id="40157-181">Depending on your requirements, you may also want to write script in the PreExecute and PostExecute methods available in the ScriptMain class to perform any preliminary or final processing.</span></span>

> [!NOTE]
>  <span data-ttu-id="40157-182">Si vous développez un composant de flux de données personnalisé entièrement nouveau, il est important de remplacer la méthode PrimeOutput pour mettre en cache les références aux mémoires tampons de sortie afin de pouvoir ajouter des lignes de données aux mémoires tampons ultérieurement.</span><span class="sxs-lookup"><span data-stu-id="40157-182">If you were developing a custom data flow component from scratch, it would be important to override the PrimeOutput method to cache references to the output buffers so that you could add rows of data to the buffers later.</span></span> <span data-ttu-id="40157-183">Dans le composant Script, cette opération n'est pas nécessaire car vous disposez d'une classe générée automatiquement qui représente chaque mémoire tampon de sortie dans l'élément de projet `BufferWrapper`.</span><span class="sxs-lookup"><span data-stu-id="40157-183">In the Script component, this is not necessary because you have an automatically generated class representing each output buffer in the `BufferWrapper` project item.</span></span>

## <a name="example"></a><span data-ttu-id="40157-184">Exemple</span><span class="sxs-lookup"><span data-stu-id="40157-184">Example</span></span>
 <span data-ttu-id="40157-185">Cet exemple présente le code personnalisé requis dans la classe ScriptMain pour créer un composant de transformation asynchrone.</span><span class="sxs-lookup"><span data-stu-id="40157-185">This example demonstrates the custom code that is required in the ScriptMain class to create an asynchronous transformation component.</span></span>

> [!NOTE]
>  <span data-ttu-id="40157-186">Ces exemples utilisent la table **Person.Address** de l’exemple de base de données **AdventureWorks** et passent ses première et quatrième colonnes (à savoir les colonnes **intAddressID** et **nvarchar(30)City**) dans le flux de données.</span><span class="sxs-lookup"><span data-stu-id="40157-186">These examples use the **Person.Address** table in the **AdventureWorks** sample database and pass its first and fourth columns, the **intAddressID** and **nvarchar(30)City** columns, through the data flow.</span></span> <span data-ttu-id="40157-187">Les mêmes données sont utilisées dans les exemples de source, transformation et destination de cette section.</span><span class="sxs-lookup"><span data-stu-id="40157-187">The same data is used in the source, transformation, and destination samples in this section.</span></span> <span data-ttu-id="40157-188">Des conditions préalables et des hypothèses supplémentaires sont documentées pour chaque exemple.</span><span class="sxs-lookup"><span data-stu-id="40157-188">Additional prerequisites and assumptions are documented for each example.</span></span>

 <span data-ttu-id="40157-189">Cet exemple présente un composant de transformation asynchrone à deux sorties.</span><span class="sxs-lookup"><span data-stu-id="40157-189">This example demonstrates an asynchronous transformation component with two outputs.</span></span> <span data-ttu-id="40157-190">Cette transformation transfère les colonnes **AddressID** et **City** dans une sortie, tout en comptant le nombre d’adresses situées dans une ville spécifique (Redmond, Washington, États-Unis), puis elle exporte la valeur obtenue vers une deuxième sortie.</span><span class="sxs-lookup"><span data-stu-id="40157-190">This transformation passes through the **AddressID** and **City** columns to one output, while it counts the number of addresses located in a specific city (Redmond, Washington, U.S.A.), and then outputs the resulting value to a second output.</span></span>

 <span data-ttu-id="40157-191">Si vous souhaitez exécuter cet exemple de code, vous devez configurer le package et le composant comme suit :</span><span class="sxs-lookup"><span data-stu-id="40157-191">If you want to run this sample code, you must configure the package and the component as follows:</span></span>

1.  <span data-ttu-id="40157-192">Ajoutez un nouveau composant Script à l'aire du concepteur de flux de données et configurez-le en tant que transformation.</span><span class="sxs-lookup"><span data-stu-id="40157-192">Add a new Script component to the Data Flow designer surface and configure it as a transformation.</span></span>

2.  <span data-ttu-id="40157-193">Connectez la sortie d'une source ou d'une autre transformation au nouveau composant de transformation dans le concepteur.</span><span class="sxs-lookup"><span data-stu-id="40157-193">Connect the output of a source or of another transformation to the new transformation component in the designer.</span></span> <span data-ttu-id="40157-194">Cette sortie doit fournir les données de la table **Person.Address** de l’exemple de base de données **AdventureWorks** qui contient au moins les colonnes **AddressID** et **City**.</span><span class="sxs-lookup"><span data-stu-id="40157-194">This output should provide data from the **Person.Address** table of the **AdventureWorks** sample database that contains at least the **AddressID** and **City** columns.</span></span>

3.  <span data-ttu-id="40157-195">Ouvrez l' **Éditeur de transformation de script**.</span><span class="sxs-lookup"><span data-stu-id="40157-195">Open the **Script Transformation Editor**.</span></span> <span data-ttu-id="40157-196">Dans la page **Colonnes d’entrée**, sélectionnez les colonnes **AddressID** et **City**.</span><span class="sxs-lookup"><span data-stu-id="40157-196">On the **Input Columns** page, select the **AddressID** and **City** columns.</span></span>

4.  <span data-ttu-id="40157-197">Dans la page **Entrées et sorties**, ajoutez et configurez les colonnes de sortie **AddressID** et **City** sur la première sortie.</span><span class="sxs-lookup"><span data-stu-id="40157-197">On the **Inputs and Outputs** page, add and configure the **AddressID** and **City** output columns on the first output.</span></span> <span data-ttu-id="40157-198">Ajoutez une deuxième sortie, puis ajoutez sur cette dernière une colonne de sortie pour la valeur résumée.</span><span class="sxs-lookup"><span data-stu-id="40157-198">Add a second output, and add an output column for the summary value on the second output.</span></span> <span data-ttu-id="40157-199">Attribuez la valeur 0 à la propriété SynchronousInputID de la première sortie, car cet exemple copie explicitement chaque ligne d'entrée vers la première sortie.</span><span class="sxs-lookup"><span data-stu-id="40157-199">Set the SynchronousInputID property of the first output to 0, because this example copies each input row explicitly to the first output.</span></span> <span data-ttu-id="40157-200">La propriété SynchronousInputID de la sortie récemment créée a déjà la valeur 0.</span><span class="sxs-lookup"><span data-stu-id="40157-200">The SynchronousInputID property of the newly-created output is already set to 0.</span></span>

5.  <span data-ttu-id="40157-201">Renommez l'entrée, les sorties et la nouvelle colonne de sortie avec des noms plus descriptifs.</span><span class="sxs-lookup"><span data-stu-id="40157-201">Rename the input, the outputs, and the new output column to give them more descriptive names.</span></span> <span data-ttu-id="40157-202">L’exemple utilise le nom **MyAddressInput** pour l’entrée, les noms **MyAddressOutput** et **MySummaryOutput** pour les sorties et le nom **MyRedmondCount** pour la colonne de sortie sur la deuxième sortie.</span><span class="sxs-lookup"><span data-stu-id="40157-202">The example uses **MyAddressInput** as the name of the input, **MyAddressOutput** and **MySummaryOutput** for the outputs, and **MyRedmondCount** for the output column on the second output.</span></span>

6.  <span data-ttu-id="40157-203">Dans la page **Script** , cliquez sur **Modifier le script** , puis entrez le script suivant.</span><span class="sxs-lookup"><span data-stu-id="40157-203">On the **Script** page, click **Edit Script** and enter the script that follows.</span></span> <span data-ttu-id="40157-204">Ensuite, fermez l'environnement de développement de script et l' **Éditeur de transformation de script**.</span><span class="sxs-lookup"><span data-stu-id="40157-204">Then close the script development environment and the **Script Transformation Editor**.</span></span>

7.  <span data-ttu-id="40157-205">Créez et configurez un composant de destination pour la première sortie qui attend les colonnes **AddressID** et **City**, comme une destination [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] ou l’exemple de composant de destination présenté dans [Création d’une destination à l’aide du composant Script](../extending-packages-scripting-data-flow-script-component-types/creating-a-destination-with-the-script-component.md).</span><span class="sxs-lookup"><span data-stu-id="40157-205">Create and configure a destination component for the first output that expects the **AddressID** and **City** columns, such as a [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] destination, or the sample destination component demonstrated in [Creating a Destination with the Script Component](../extending-packages-scripting-data-flow-script-component-types/creating-a-destination-with-the-script-component.md), .</span></span> <span data-ttu-id="40157-206">Connectez ensuite la première sortie de la transformation, **MyAddressOutput**, au composant de destination.</span><span class="sxs-lookup"><span data-stu-id="40157-206">Then connect the first output of the transformation, **MyAddressOutput**, to the destination component.</span></span> <span data-ttu-id="40157-207">Vous pouvez créer une table de destination en exécutant la commande [!INCLUDE[tsql](../../includes/tsql-md.md)] suivante dans la base de données **AdventureWorks** :</span><span class="sxs-lookup"><span data-stu-id="40157-207">You can create a destination table by running the following [!INCLUDE[tsql](../../includes/tsql-md.md)] command in the **AdventureWorks** database:</span></span>

    ```
    CREATE TABLE [Person].[Address2]([AddressID] [int] NOT NULL,
        [City] [nvarchar](30) NOT NULL)
    ```

8.  <span data-ttu-id="40157-208">Créez et configurez un autre composant de destination pour la deuxième sortie.</span><span class="sxs-lookup"><span data-stu-id="40157-208">Create and configure another destination component for the second output.</span></span> <span data-ttu-id="40157-209">Puis connectez la deuxième sortie de la transformation, **MySummaryOutput**, au composant de destination.</span><span class="sxs-lookup"><span data-stu-id="40157-209">Then connect the second output of the transformation, **MySummaryOutput**, to the destination component.</span></span> <span data-ttu-id="40157-210">Comme la deuxième sortie écrit une seule ligne avec une seule valeur, vous pouvez configurer facilement une destination à l'aide d'un gestionnaire de connexions de fichiers plats qui se connecte à un nouveau fichier contenant une seule colonne.</span><span class="sxs-lookup"><span data-stu-id="40157-210">Because the second output writes a single row with a single value, you can easily configure a destination with a Flat File connection manager that connects to a new file that has a single column.</span></span> <span data-ttu-id="40157-211">Dans l’exemple, cette colonne de destination est nommée **MyRedmondCount**.</span><span class="sxs-lookup"><span data-stu-id="40157-211">In the example, this destination column is named **MyRedmondCount**.</span></span>

9. <span data-ttu-id="40157-212">Exécutez l’exemple.</span><span class="sxs-lookup"><span data-stu-id="40157-212">Run the sample.</span></span>

```vb
Public Class ScriptMain
    Inherits UserComponent

    Private myRedmondAddressCount As Integer

    Public Overrides Sub CreateNewOutputRows()

        MySummaryOutputBuffer.AddRow()

    End Sub

    Public Overrides Sub MyAddressInput_ProcessInput(ByVal Buffer As MyAddressInputBuffer)

        While Buffer.NextRow()
            MyAddressInput_ProcessInputRow(Buffer)
        End While

        If Buffer.EndOfRowset Then
            MyAddressOutputBuffer.SetEndOfRowset()
            MySummaryOutputBuffer.MyRedmondCount = myRedmondAddressCount
            MySummaryOutputBuffer.SetEndOfRowset()
        End If

    End Sub

    Public Overrides Sub MyAddressInput_ProcessInputRow(ByVal Row As MyAddressInputBuffer)

        With MyAddressOutputBuffer
            .AddRow()
            .AddressID = Row.AddressID
            .City = Row.City
        End With

        If Row.City.ToUpper = "REDMOND" Then
            myRedmondAddressCount += 1
        End If

    End Sub

End Class
```

```csharp
public class ScriptMain:
    UserComponent

{
    private int myRedmondAddressCount;

    public override void CreateNewOutputRows()
    {

        MySummaryOutputBuffer.AddRow();

    }

    public override void MyAddressInput_ProcessInput(MyAddressInputBuffer Buffer)
    {

        while (Buffer.NextRow())
        {
            MyAddressInput_ProcessInputRow(Buffer);
        }

        if (Buffer.EndOfRowset())
        {
            MyAddressOutputBuffer.SetEndOfRowset();
            MySummaryOutputBuffer.MyRedmondCount = myRedmondAddressCount;
            MySummaryOutputBuffer.SetEndOfRowset();
        }

    }

    public override void MyAddressInput_ProcessInputRow(MyAddressInputBuffer Row)
    {

        {
            MyAddressOutputBuffer.AddRow();
            MyAddressOutputBuffer.AddressID = Row.AddressID;
            MyAddressOutputBuffer.City = Row.City;
        }

        if (Row.City.ToUpper() == "REDMOND")
        {
            myRedmondAddressCount += 1;
        }

    }

}

```

<span data-ttu-id="40157-213">![Icône de Integration Services (petite)](../media/dts-16.gif "Icône Integration Services (petite)")  **restez à jour avec Integration Services**</span><span class="sxs-lookup"><span data-stu-id="40157-213">![Integration Services icon (small)](../media/dts-16.gif "Integration Services icon (small)")  **Stay Up to Date with Integration Services**</span></span><br /> <span data-ttu-id="40157-214">Pour obtenir les derniers téléchargements, articles, exemples et vidéos de Microsoft, ainsi que des solutions sélectionnées par la communauté, visitez la page [!INCLUDE[ssISnoversion](../../includes/ssisnoversion-md.md)] sur MSDN :</span><span class="sxs-lookup"><span data-stu-id="40157-214">For the latest downloads, articles, samples, and videos from Microsoft, as well as selected solutions from the community, visit the [!INCLUDE[ssISnoversion](../../includes/ssisnoversion-md.md)] page on MSDN:</span></span><br /><br /> [<span data-ttu-id="40157-215">Visiter la page Integration Services sur MSDN</span><span class="sxs-lookup"><span data-stu-id="40157-215">Visit the Integration Services page on MSDN</span></span>](https://go.microsoft.com/fwlink/?LinkId=136655)<br /><br /> <span data-ttu-id="40157-216">Pour recevoir une notification automatique de ces mises à jour, abonnez-vous aux flux RSS disponibles sur la page.</span><span class="sxs-lookup"><span data-stu-id="40157-216">For automatic notification of these updates, subscribe to the RSS feeds available on the page.</span></span>

## <a name="see-also"></a><span data-ttu-id="40157-217">Voir aussi</span><span class="sxs-lookup"><span data-stu-id="40157-217">See Also</span></span>
 <span data-ttu-id="40157-218">[Compréhension des transformations synchrones et asynchrones](../understanding-synchronous-and-asynchronous-transformations.md) [création d’une transformation synchrone avec le composant script](../extending-packages-scripting-data-flow-script-component-types/creating-a-synchronous-transformation-with-the-script-component.md) [développement d’un composant de transformation personnalisé avec des sorties asynchrones](../extending-packages-custom-objects-data-flow-types/developing-a-custom-transformation-component-with-asynchronous-outputs.md)</span><span class="sxs-lookup"><span data-stu-id="40157-218">[Understanding Synchronous and Asynchronous Transformations](../understanding-synchronous-and-asynchronous-transformations.md) [Creating a Synchronous Transformation with the Script Component](../extending-packages-scripting-data-flow-script-component-types/creating-a-synchronous-transformation-with-the-script-component.md) [Developing a Custom Transformation Component with Asynchronous Outputs](../extending-packages-custom-objects-data-flow-types/developing-a-custom-transformation-component-with-asynchronous-outputs.md)</span></span>


