---
title: Contrôle de capture de données modifiées, tâche | Microsoft Docs
ms.custom: ''
ms.date: 06/13/2017
ms.prod: sql-server-2014
ms.reviewer: ''
ms.technology: integration-services
ms.topic: conceptual
f1_keywords:
- sql12.ssis.designer.cdccontroltask.f1
ms.assetid: 6404dc7f-550c-47cc-b901-c072742f430a
author: chugugrace
ms.author: chugu
ms.openlocfilehash: 36f98a02842353fd5196432738f4ebd8b2efb46c
ms.sourcegitcommit: ad4d92dce894592a259721a1571b1d8736abacdb
ms.translationtype: MT
ms.contentlocale: fr-FR
ms.lasthandoff: 08/04/2020
ms.locfileid: "87604687"
---
# <a name="cdc-control-task"></a><span data-ttu-id="40a5e-102">Tâche de contrôle de capture de données modifiées</span><span class="sxs-lookup"><span data-stu-id="40a5e-102">CDC Control Task</span></span>
  <span data-ttu-id="40a5e-103">La tâche de contrôle de capture de données modifiées permet de contrôler le cycle de vie des packages de capture de données modifiées.</span><span class="sxs-lookup"><span data-stu-id="40a5e-103">The CDC Control task is used to control the life cycle of change data capture (CDC) packages.</span></span> <span data-ttu-id="40a5e-104">Elle gère la synchronisation des package de capture de données modifiées avec le package de charge initiale et la gestion des plages de numéros séquentiels dans le journal (NSE) qui sont traités lors de l'exécution d'un package de capture de données modifiées.</span><span class="sxs-lookup"><span data-stu-id="40a5e-104">It handles CDC package synchronization with the initial load package, the management of Log Sequence Number (LSN) ranges that are processed in a run of a CDC package.</span></span> <span data-ttu-id="40a5e-105">En outre, la tâche de contrôle de capture de données modifiées traite les scénarios d'erreur et la récupération.</span><span class="sxs-lookup"><span data-stu-id="40a5e-105">In addition, the CDC Control task deals with error scenarios and recovery.</span></span>  
  
 <span data-ttu-id="40a5e-106">La tâche de contrôle de capture de données modifiées gère l'état du package de capture de données modifiées dans une variable de package SSIS et peut également le conserver de manière permanente dans une table de base de données afin qu'il soit conservé d'une activation de package à l'autre et entre plusieurs packages qui exécutent ensemble un processus de capture de données modifiées commun (par exemple, une tâche peut être responsable du chargement initial et l'autre des mises à jour du flux progressif).</span><span class="sxs-lookup"><span data-stu-id="40a5e-106">The CDC Control task maintains the state of the CDC package in an SSIS package variable and it can also persist it in a database table so that the state is maintained across package activations and between multiple packages that together perform a common CDC process (for example, one task may be responsible for the initial loading and the other for the trickle-feed updates).</span></span>  
  
 <span data-ttu-id="40a5e-107">La tâche de contrôle de capture de données modifiées prend en charge deux groupes d'opérations.</span><span class="sxs-lookup"><span data-stu-id="40a5e-107">The CDC Control task supports two groups of operations.</span></span> <span data-ttu-id="40a5e-108">Un groupe gère la synchronisation de la charge initiale et le traitement des modifications, tandis que l'autre gère la plage de traitement des modifications des NSE pour une exécution d'un package de source de données modifiées et garde une trace des actions correctement traitées.</span><span class="sxs-lookup"><span data-stu-id="40a5e-108">One group handles the synchronization of initial load and change processing, and the other manages the change-processing range of LSNs for a run of a CDC package and keeps track of what was processed successfully.</span></span>  
  
 <span data-ttu-id="40a5e-109">Les opérations suivantes gèrent la synchronisation de la charge initiale et le traitement des modifications :</span><span class="sxs-lookup"><span data-stu-id="40a5e-109">The following operations handle the synchronization of initial load and change processing:</span></span>  
  
|<span data-ttu-id="40a5e-110">Opération</span><span class="sxs-lookup"><span data-stu-id="40a5e-110">Operation</span></span>|<span data-ttu-id="40a5e-111">Description</span><span class="sxs-lookup"><span data-stu-id="40a5e-111">Description</span></span>|  
|---------------|-----------------|  
|<span data-ttu-id="40a5e-112">ResetCdcState</span><span class="sxs-lookup"><span data-stu-id="40a5e-112">ResetCdcState</span></span>|<span data-ttu-id="40a5e-113">Cette opération est utilisée pour réinitialiser l'état permanent de capture de données modifiées associé au contexte de capture de données modifiées actuel.</span><span class="sxs-lookup"><span data-stu-id="40a5e-113">This operation is used to reset the persistent CDC state associated with the current CDC context.</span></span> <span data-ttu-id="40a5e-114">Une fois cette opération effectuée, le numéro LSN maximal actuel de la table d’horodatage des LSN `sys.fn_cdc_get_max_lsn` devient le début de la plage de traitement suivante.</span><span class="sxs-lookup"><span data-stu-id="40a5e-114">After this operation is run, the current maximum LSN from the LSN-timestamp `sys.fn_cdc_get_max_lsn` table becomes the start of the range for the next processing range.</span></span> <span data-ttu-id="40a5e-115">Cette opération requiert une connexion à la base de données source.</span><span class="sxs-lookup"><span data-stu-id="40a5e-115">This operation requires a connection to the source database.</span></span>|  
|<span data-ttu-id="40a5e-116">MarkInitialLoadStart</span><span class="sxs-lookup"><span data-stu-id="40a5e-116">MarkInitialLoadStart</span></span>|<span data-ttu-id="40a5e-117">Cette opération est utilisée au début d'un package de charge initiale pour enregistrer le NSE actuel dans la base de données source avant que le package de charge initiale commence à lire les tables sources.</span><span class="sxs-lookup"><span data-stu-id="40a5e-117">This operation is used at the beginning of an initial-load package to record the current LSN in the source database before the initial-load package starts reading the source tables.</span></span> <span data-ttu-id="40a5e-118">Cette opération requiert une connexion à la base de données source pour appeler `sys.fn_cdc_get_max_lsn`.</span><span class="sxs-lookup"><span data-stu-id="40a5e-118">This requires a connection to the source database to call `sys.fn_cdc_get_max_lsn`.</span></span><br /><br /> <span data-ttu-id="40a5e-119">Si vous sélectionnez MarkInitialLoadStart quand vous travaillez sur la capture de données modifiées [!INCLUDE[ssCurrent](../../includes/sscurrent-md.md)] (autrement dit, hors d’Oracle), l’utilisateur spécifié dans le gestionnaire de connexions doit être db_owner ou sysadmin.</span><span class="sxs-lookup"><span data-stu-id="40a5e-119">If you select MarkInitialLoadStart when working on [!INCLUDE[ssCurrent](../../includes/sscurrent-md.md)] CDC (that is, not Oracle) the user specified in the connection manager must be either  db_owner or sysadmin.</span></span>|  
|<span data-ttu-id="40a5e-120">MarkInitialLoadEnd</span><span class="sxs-lookup"><span data-stu-id="40a5e-120">MarkInitialLoadEnd</span></span>|<span data-ttu-id="40a5e-121">Cette opération est utilisée à la fin d'un package de charge initiale pour enregistrer le NSE actuel dans la base de données source une fois que le package de charge initiale a fini de lire les tables sources.</span><span class="sxs-lookup"><span data-stu-id="40a5e-121">This operation is used at the end of an initial-load package to record the current LSN in the source database after the initial-load package finished reading the source tables.</span></span> <span data-ttu-id="40a5e-122">Ce NSE est déterminé en enregistrant l'heure à laquelle cette opération s'est produite, puis en interrogeant la table de mappage `cdc.lsn_time_`dans la base de données de capture de données modifiées afin de rechercher une modification survenue après cette heure.</span><span class="sxs-lookup"><span data-stu-id="40a5e-122">This LSN is determined by recording the current time when this operation occurred and then querying the `cdc.lsn_time_`mapping table in the CDC database looking for a change that occurred after that time.</span></span><br /><br /> <span data-ttu-id="40a5e-123">Si vous sélectionnez MarkInitialLoadEnd quand vous travaillez sur la capture de données modifiées [!INCLUDE[ssCurrent](../../includes/sscurrent-md.md)] (autrement dit, hors d’Oracle), l’utilisateur spécifié dans le gestionnaire de connexions doit être db_owner ou sysadmin.</span><span class="sxs-lookup"><span data-stu-id="40a5e-123">If you select MarkInitialLoadEnd when working on [!INCLUDE[ssCurrent](../../includes/sscurrent-md.md)] CDC (that is , not Oracle) the user specified in the connection manager must be either  db_owner or sysadmin.</span></span>|  
|<span data-ttu-id="40a5e-124">MarkCdcStart</span><span class="sxs-lookup"><span data-stu-id="40a5e-124">MarkCdcStart</span></span>|<span data-ttu-id="40a5e-125">Cette opération est utilisée lorsque la charge initiale est effectuée à partir d'une base de données par instantané.</span><span class="sxs-lookup"><span data-stu-id="40a5e-125">This operation is used when then the initial load is made from a snapshot database.</span></span> <span data-ttu-id="40a5e-126">Dans ce cas, le traitement des modifications doit démarrer immédiatement après le NSE de l'instantané.</span><span class="sxs-lookup"><span data-stu-id="40a5e-126">In this case, the change processing should start immediately after the snapshot LSN.</span></span> <span data-ttu-id="40a5e-127">Vous pouvez spécifier le nom de la base de données par instantané à utiliser et la tâche de contrôle de capture de données modifiées qui interroge [!INCLUDE[ssCurrent](../../includes/sscurrent-md.md)] pour connaître le NSE de l'instantané.</span><span class="sxs-lookup"><span data-stu-id="40a5e-127">You can specify the name of the snapshot database to use and the CDC Control task queries [!INCLUDE[ssCurrent](../../includes/sscurrent-md.md)] for the snapshot LSN.</span></span> <span data-ttu-id="40a5e-128">Vous avez également la possibilité de spécifier directement le NSE de l'instantané.</span><span class="sxs-lookup"><span data-stu-id="40a5e-128">You also have the option to directly specify the snapshot LSN.</span></span><br /><br /> <span data-ttu-id="40a5e-129">Si vous sélectionnez MarkCdcStart quand vous travaillez sur la capture de données modifiées [!INCLUDE[ssCurrent](../../includes/sscurrent-md.md)] (autrement dit, hors d’Oracle), l’utilisateur spécifié dans le gestionnaire de connexions doit être db_owner ou sysadmin.</span><span class="sxs-lookup"><span data-stu-id="40a5e-129">If you select MarkCdcStart when working on [!INCLUDE[ssCurrent](../../includes/sscurrent-md.md)] CDC (that is , not Oracle) the user specified in the connection manager must be either  db_owner or sysadmin.</span></span>|  
  
 <span data-ttu-id="40a5e-130">Les opérations suivantes sont utilisées pour gérer la plage de traitement :</span><span class="sxs-lookup"><span data-stu-id="40a5e-130">The following operations are used to manage the processing range:</span></span>  
  
|<span data-ttu-id="40a5e-131">Opération</span><span class="sxs-lookup"><span data-stu-id="40a5e-131">Operation</span></span>|<span data-ttu-id="40a5e-132">Description</span><span class="sxs-lookup"><span data-stu-id="40a5e-132">Description</span></span>|  
|---------------|-----------------|  
|<span data-ttu-id="40a5e-133">GetProcessingRange</span><span class="sxs-lookup"><span data-stu-id="40a5e-133">GetProcessingRange</span></span>|<span data-ttu-id="40a5e-134">Cette opération est utilisée avant d'appeler le flux de données qui utilise le flux de données de la source CDC.</span><span class="sxs-lookup"><span data-stu-id="40a5e-134">This operation is used before invoking the data flow that uses the CDC Source data flow.</span></span> <span data-ttu-id="40a5e-135">Elle établit une plage de numéros LSN que le flux de données de la source CDC lit lorsqu'il est appelé.</span><span class="sxs-lookup"><span data-stu-id="40a5e-135">It establishes a range of LSNs that the CDC Source data flow reads when invoked.</span></span> <span data-ttu-id="40a5e-136">La plage est stockée dans une variable de package SSIS qui est utilisée par la source CDC pendant le traitement du flux de données.</span><span class="sxs-lookup"><span data-stu-id="40a5e-136">The range is stored in an SSIS package variable that is used by the CDC Source during data-flow processing.</span></span><br /><br /> <span data-ttu-id="40a5e-137">Pour plus d’informations sur les états stockés, consultez [Définir une variable d’état](../data-flow/define-a-state-variable.md).</span><span class="sxs-lookup"><span data-stu-id="40a5e-137">For more information about the states that are stored, see [Define a State Variable](../data-flow/define-a-state-variable.md).</span></span>|  
|<span data-ttu-id="40a5e-138">MarkProcessedRange</span><span class="sxs-lookup"><span data-stu-id="40a5e-138">MarkProcessedRange</span></span>|<span data-ttu-id="40a5e-139">Cette opération est exécutée après que chaque exécution de la capture de données modifiées (une fois le flux de données de capture de données modifiées terminé avec succès) pour consigner le dernier NSE qui a été entièrement traité dans le cadre de l'exécution de la capture de données modifiées.</span><span class="sxs-lookup"><span data-stu-id="40a5e-139">: This operation is executed after each CDC run (after the CDC data flow is completed successfully) to record the last LSN that was fully processed in the CDC run.</span></span> <span data-ttu-id="40a5e-140">Lors de la prochaine exécution de GetProcessingRange, cette position constitue le début de la plage de traitement.</span><span class="sxs-lookup"><span data-stu-id="40a5e-140">The next time GetProcessingRange is executed, this position is the start of the processing range.</span></span>|  
  
## <a name="handling-cdc-state-persistency"></a><span data-ttu-id="40a5e-141">Gestion de la permanence de l'état de capture de données modifiées</span><span class="sxs-lookup"><span data-stu-id="40a5e-141">Handling CDC State Persistency</span></span>  
 <span data-ttu-id="40a5e-142">La tâche de contrôle de capture de données modifiées conserve un état permanent entre les activations.</span><span class="sxs-lookup"><span data-stu-id="40a5e-142">The CDC Control task maintains a persistent state between activations.</span></span> <span data-ttu-id="40a5e-143">Les informations stockées dans l'état de capture de données modifiées sont utilisées pour déterminer et gérer la plage de traitement pour le package de capture de données modifiées et pour détecter les conditions d'erreur.</span><span class="sxs-lookup"><span data-stu-id="40a5e-143">The information stored in the CDC state is used to determine and maintain the processing range for the CDC package and for detecting error conditions.</span></span> <span data-ttu-id="40a5e-144">L'état permanent est stocké sous forme de chaîne.</span><span class="sxs-lookup"><span data-stu-id="40a5e-144">The persistent state is stored as a string.</span></span> <span data-ttu-id="40a5e-145">Pour plus d’informations, consultez [Définir une variable d’état](../data-flow/define-a-state-variable.md).</span><span class="sxs-lookup"><span data-stu-id="40a5e-145">For more information, see [Define a State Variable](../data-flow/define-a-state-variable.md).</span></span>  
  
 <span data-ttu-id="40a5e-146">La tâche de contrôle de capture de données modifiées prend en charge deux types de permanence d'état :</span><span class="sxs-lookup"><span data-stu-id="40a5e-146">The CDC Control task supports two types of state persistency</span></span>  
  
-   <span data-ttu-id="40a5e-147">Permanence d'état manuelle : dans ce cas, la tâche de contrôle de capture de données modifiées gère l'état stocké dans une variable de package, mais le développeur de package doit lire la variable dans un stockage permanent avant d'appeler le contrôle de capture de données modifiées, puis la réécrire dans ce stockage permanent après le dernier appel du contrôle de capture de données modifiées et une fois l'exécution de la capture de données modifiées terminée.</span><span class="sxs-lookup"><span data-stu-id="40a5e-147">Manual State Persistency: In this case, the CDC Control task manages the state stored in a package variable but the package developer must read the variable from a persistent store before calling the CDC Control and then write it back to that persistent store after the CDC Control is last called and the CDC run completes.</span></span>  
  
-   <span data-ttu-id="40a5e-148">Permanence d'état automatique : l'état de capture de données modifiées est stocké dans une table dans une base de données.</span><span class="sxs-lookup"><span data-stu-id="40a5e-148">Automatic State Persistency: The CDC state is stored in a table in a database.</span></span> <span data-ttu-id="40a5e-149">L’état est stocké sous un nom fourni par la propriété **StateName** dans une table nommée de la propriété **Table à utiliser pour le stockage de l’état** , qui se trouve dans un gestionnaire de connexions sélectionné pour le stockage de l’état.</span><span class="sxs-lookup"><span data-stu-id="40a5e-149">The state is stored under a name provided in the **StateName** property in a table named in the **Table to Use for Storing State** property, which is located in a selected connection manager for storing the state.</span></span> <span data-ttu-id="40a5e-150">La valeur par défaut est le gestionnaire de connexions source, mais la pratique courante consiste à utiliser le gestionnaire de connexions cible.</span><span class="sxs-lookup"><span data-stu-id="40a5e-150">The default is the source connection manager but the common practice is for it to be the target connection manager.</span></span> <span data-ttu-id="40a5e-151">La tâche de contrôle de capture de données modifiées met à jour la valeur d'état dans la table d'état et celle-ci est validée dans le cadre de la transaction en cours.</span><span class="sxs-lookup"><span data-stu-id="40a5e-151">The CDC Control task updates the state value in the state table and this is committed as part of the ambient transaction.</span></span>  
  
## <a name="error-handling"></a><span data-ttu-id="40a5e-152">Gestion des erreurs</span><span class="sxs-lookup"><span data-stu-id="40a5e-152">Error Handling</span></span>  
 <span data-ttu-id="40a5e-153">La tâche de contrôle de capture de données modifiées peut signaler une erreur dans les conditions suivantes :</span><span class="sxs-lookup"><span data-stu-id="40a5e-153">The CDC Control task may report an error when:</span></span>  
  
-   <span data-ttu-id="40a5e-154">Elle ne parvient pas à lire l'état de capture de données modifiées permanent ou la mise à jour de l'état permanent échoue.</span><span class="sxs-lookup"><span data-stu-id="40a5e-154">It fails to read the persistent CDC state or when updating the persistent state fails.</span></span>  
  
-   <span data-ttu-id="40a5e-155">Elle ne parvient pas à lire les informations du NSE actuel dans la base de données source.</span><span class="sxs-lookup"><span data-stu-id="40a5e-155">It fails to read the current LSN information from the source database.</span></span>  
  
-   <span data-ttu-id="40a5e-156">La lecture de l'état de capture de données modifiées n'est pas cohérente.</span><span class="sxs-lookup"><span data-stu-id="40a5e-156">The CDC state read is not consistent.</span></span>  
  
 <span data-ttu-id="40a5e-157">Dans toutes ces situations, la tâche de contrôle de capture de données modifiées signale une erreur qui peut être gérée de la manière dont SSIS gère habituellement les erreurs de flux de contrôle.</span><span class="sxs-lookup"><span data-stu-id="40a5e-157">In all of these cases, the CDC Control task reports an error that can be handled in the standard way SSIS handles control-flow errors.</span></span>  
  
 <span data-ttu-id="40a5e-158">La tâche de contrôle de capture de données modifiées peut également signaler un avertissement lorsque l'opération Obtenir la plage de traitement est appelée directement après une autre opération Obtenir la plage de traitement sans que Marquer la plage traitée soit appelé.</span><span class="sxs-lookup"><span data-stu-id="40a5e-158">The CDC Control task may also report a warning when the Get Processing Range operation is invoked directly after another Get Processing Range operation without Mark Processed Range being called.</span></span> <span data-ttu-id="40a5e-159">Ceci indique que l'exécution précédente a échoué ou qu'un autre package de capture de données modifiées s'exécute peut-être avec le même nom d'état de capture de données modifiées.</span><span class="sxs-lookup"><span data-stu-id="40a5e-159">This is an indication that the previous run failed or that another CDC package may be running using the same CDC state name.</span></span>  
  
## <a name="configuring-the-cdc-control-task"></a><span data-ttu-id="40a5e-160">Configuration de la tâche de contrôle de capture de données modifiées</span><span class="sxs-lookup"><span data-stu-id="40a5e-160">Configuring the CDC Control Task</span></span>  
 <span data-ttu-id="40a5e-161">Vous pouvez définir les propriétés par le biais du concepteur SSIS ou par programmation.</span><span class="sxs-lookup"><span data-stu-id="40a5e-161">You can set properties through SSIS Designer or programmatically.</span></span>  
  
## <a name="in-this-section"></a><span data-ttu-id="40a5e-162">Dans cette section</span><span class="sxs-lookup"><span data-stu-id="40a5e-162">In This Section</span></span>  
  
-   [<span data-ttu-id="40a5e-163">Éditeur de tâche de contrôle CDC</span><span class="sxs-lookup"><span data-stu-id="40a5e-163">CDC Control Task Editor</span></span>](../cdc-control-task-editor.md)  
  
-   [<span data-ttu-id="40a5e-164">Propriétés personnalisées de la tâche de contrôle de capture de données modifiées</span><span class="sxs-lookup"><span data-stu-id="40a5e-164">CDC Control Task Custom Properties</span></span>](cdc-control-task-custom-properties.md)  
  
## <a name="related-tasks"></a><span data-ttu-id="40a5e-165">Tâches associées</span><span class="sxs-lookup"><span data-stu-id="40a5e-165">Related Tasks</span></span>  
 [<span data-ttu-id="40a5e-166">Définir une variable d’état</span><span class="sxs-lookup"><span data-stu-id="40a5e-166">Define a State Variable</span></span>](../data-flow/define-a-state-variable.md)  
  
## <a name="related-content"></a><span data-ttu-id="40a5e-167">Contenu associé</span><span class="sxs-lookup"><span data-stu-id="40a5e-167">Related Content</span></span>  
  
-   <span data-ttu-id="40a5e-168">Article technique, [Installation du service de capture de données modifiées Microsoft SQL Server 2012 pour Oracle par Attunity](https://go.microsoft.com/fwlink/?LinkId=252958), sur social.technet.microsoft.com.</span><span class="sxs-lookup"><span data-stu-id="40a5e-168">Technical article, [Installing Microsoft SQL Server 2012 Change Data Capture for Oracle by Attunity](https://go.microsoft.com/fwlink/?LinkId=252958), on social.technet.microsoft.com.</span></span>  
  
-   <span data-ttu-id="40a5e-169">Article technique, [Résolution des problèmes de configuration dans le service de capture de données modifiées Microsoft SQL Server pour Oracle par Attunity](https://go.microsoft.com/fwlink/?LinkId=252960), sur social.technet.microsoft.com.</span><span class="sxs-lookup"><span data-stu-id="40a5e-169">Technical article, [Troubleshoot Configuration Issues in Microsoft Change Data Capture for Oracle by Attunity](https://go.microsoft.com/fwlink/?LinkId=252960), on social.technet.microsoft.com.</span></span>  
  
-   <span data-ttu-id="40a5e-170">Article technique, [Dépannage des erreurs d'instance du service de capture de données modifiées Microsoft SQL Server pour Oracle par Attunity](https://go.microsoft.com/fwlink/?LinkId=252961), sur social.technet.microsoft.com.</span><span class="sxs-lookup"><span data-stu-id="40a5e-170">Technical article, [Troubleshoot CDC Instance Errors in Microsoft Change Data Capture for Oracle by Attunity](https://go.microsoft.com/fwlink/?LinkId=252961), on social.technet.microsoft.com.</span></span>  
  
  
