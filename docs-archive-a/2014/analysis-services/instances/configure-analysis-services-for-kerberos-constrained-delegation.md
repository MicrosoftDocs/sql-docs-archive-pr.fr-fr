---
title: Configurer Analysis Services pour la délégation Kerberos avec restriction | Microsoft Docs
ms.custom: ''
ms.date: 06/13/2017
ms.prod: sql-server-2014
ms.reviewer: ''
ms.technology: analysis-services
ms.topic: conceptual
ms.assetid: 6d751477-6bf1-48b4-8833-5a631bbe7650
author: minewiskan
ms.author: owend
ms.openlocfilehash: 03b852acb4868cd384ef34948c6aff70541638a0
ms.sourcegitcommit: ad4d92dce894592a259721a1571b1d8736abacdb
ms.translationtype: MT
ms.contentlocale: fr-FR
ms.lasthandoff: 08/04/2020
ms.locfileid: "87699024"
---
# <a name="configure-analysis-services-for-kerberos-constrained-delegation"></a><span data-ttu-id="0cdec-102">Configurer Analysis Services pour la délégation contrainte Kerberos</span><span class="sxs-lookup"><span data-stu-id="0cdec-102">Configure Analysis Services for Kerberos constrained delegation</span></span>
  <span data-ttu-id="0cdec-103">Quand vous configurez Analysis Services pour l'authentification Kerberos, vous cherchez probablement à obtenir l'un des deux résultats suivants : laisser le soin à Analysis Services d'emprunter l'identité d'un utilisateur durant l'interrogation de données, ou demander à Analysis Services de déléguer l'identité d'utilisateur à un service de bas niveau.</span><span class="sxs-lookup"><span data-stu-id="0cdec-103">When configuring Analysis Services for Kerberos authentication, you are most likely interested in achieving one or both of the following outcomes: having Analysis Services impersonate a user identity when querying data; or having Analysis Services delegate a user identity to a down-level service.</span></span> <span data-ttu-id="0cdec-104">Chaque scénario implique des spécifications de configuration légèrement différentes.</span><span class="sxs-lookup"><span data-stu-id="0cdec-104">Each scenario calls for slightly different configuration requirements.</span></span> <span data-ttu-id="0cdec-105">De plus, dans les deux cas, une vérification doit avoir lieu pour s'assurer que la configuration a été effectuée correctement.</span><span class="sxs-lookup"><span data-stu-id="0cdec-105">Both scenarios require verification to ensure configuration was done properly.</span></span>  
  
> [!TIP]  
>  <span data-ttu-id="0cdec-106">**[!INCLUDE[msCoName](../../includes/msconame-md.md)] pour [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)]** est un outil de diagnostic qui permet de dépanner les problèmes de connexion que rencontre Kerberos avec [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)].</span><span class="sxs-lookup"><span data-stu-id="0cdec-106">**[!INCLUDE[msCoName](../../includes/msconame-md.md)] Kerberos Configuration Manager for [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)]** is a diagnostic tool that helps troubleshoot Kerberos related connectivity issues with [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)].</span></span> <span data-ttu-id="0cdec-107">Pour plus d'informations, consultez [Gestionnaire de configuration de Microsoft Kerberos pour SQL Server](https://www.microsoft.com/download/details.aspx?id=39046).</span><span class="sxs-lookup"><span data-stu-id="0cdec-107">For more information, see [Microsoft Kerberos Configuration Manager for SQL Server](https://www.microsoft.com/download/details.aspx?id=39046).</span></span>  
  
 <span data-ttu-id="0cdec-108">Cette rubrique contient les sections suivantes :</span><span class="sxs-lookup"><span data-stu-id="0cdec-108">This topic contains the following sections:</span></span>  
  
-   [<span data-ttu-id="0cdec-109">Autoriser Analysis Services à emprunter l'identité d'un utilisateur</span><span class="sxs-lookup"><span data-stu-id="0cdec-109">Allow Analysis Services to impersonate a user identity</span></span>](#bkmk_impersonate)  
  
-   [<span data-ttu-id="0cdec-110">Configurer Analysis Services pour une délégation approuvée</span><span class="sxs-lookup"><span data-stu-id="0cdec-110">Configure Analysis Services for trusted delegation</span></span>](#bkmk_delegate)  
  
-   [<span data-ttu-id="0cdec-111">Tester une identité empruntée ou déléguée</span><span class="sxs-lookup"><span data-stu-id="0cdec-111">Test for impersonated or delegated identity</span></span>](#bkmk_test)  
  
> [!NOTE]  
>  <span data-ttu-id="0cdec-112">La délégation n'est pas nécessaire si la connexion à Analysis Services est un saut unique, ou si votre solution utilise les informations d'identification stockées fournies par le Service Banque d'informations sécurisé ou Reporting Services de SharePoint.</span><span class="sxs-lookup"><span data-stu-id="0cdec-112">Delegation is not required if the connection to Analysis Services is a single hop, or your solution uses stored credentials provided by SharePoint Secure Store Service or Reporting Services.</span></span> <span data-ttu-id="0cdec-113">Si toutes les connexions sont des connexions directes à partir d'Excel vers une base de données Analysis Services, ou si elles sont basées sur des informations d'identification stockées, vous pouvez utiliser Kerberos (ou NTLM) sans avoir à configurer la délégation contrainte.</span><span class="sxs-lookup"><span data-stu-id="0cdec-113">If all connections are direct connections from Excel to an Analysis Services database, or based on stored credentials, you can use Kerberos (or NTLM) without having to configure constrained delegation.</span></span>  
>   
>  <span data-ttu-id="0cdec-114">La délégation Kerberos avec restriction est requise si l’identité de l’utilisateur doit circuler sur plusieurs connexions d’ordinateur (appelées « double saut »).</span><span class="sxs-lookup"><span data-stu-id="0cdec-114">Kerberos constrained delegation is required if the user identity has to flow over multiple computer connections (known as "double-hop").</span></span> <span data-ttu-id="0cdec-115">Lorsque l'accès aux données Analysis Services dépend de l'identité de l'utilisateur et que la demande de connexion provient d'un service de délégation, utilisez la liste de vérification de la section suivante pour vous assurer qu'Analysis Services peut emprunter l'identité de l'appelant d'origine.</span><span class="sxs-lookup"><span data-stu-id="0cdec-115">When Analysis Services data access is contingent upon user identity, and the connection request is from a delegating service, use the checklist in the next section to ensure that Analysis Services is able to impersonate the original caller.</span></span> <span data-ttu-id="0cdec-116">Pour plus d'informations sur les flux d'authentification Analysis Services, consultez [Authentification et délégation d'identité Microsoft BI](https://go.microsoft.com/fwlink/?LinkID=286576).</span><span class="sxs-lookup"><span data-stu-id="0cdec-116">For more information about Analysis Services authentication flows, see [Microsoft BI Authentication and Identity Delegation](https://go.microsoft.com/fwlink/?LinkID=286576).</span></span>  
>   
>  <span data-ttu-id="0cdec-117">En guise de meilleure pratique de sécurité, Microsoft recommande de toujours utiliser la délégation contrainte plutôt que la délégation non contrainte.</span><span class="sxs-lookup"><span data-stu-id="0cdec-117">As a security best practice, Microsoft always recommends constrained delegation over unconstrained delegation.</span></span> <span data-ttu-id="0cdec-118">La délégation non contrainte présente un risque majeur pour la sécurité car elle permet à l’identité de service d’emprunter l’identité d’un autre utilisateur sur *n’importe quel* service, application ou ordinateur en aval (plutôt qu’uniquement les services définis de manière explicite via la délégation contrainte).</span><span class="sxs-lookup"><span data-stu-id="0cdec-118">Unconstrained delegation is a major security risk because it allows the service identity to impersonate another user on *any* downstream computer, service, or application (as opposed to just those services explicitly defined via constrained delegation).</span></span>  
  
##  <a name="allow-analysis-services-to-impersonate-a-user-identity"></a><a name="bkmk_impersonate"></a><span data-ttu-id="0cdec-119">Autoriser Analysis Services à emprunter l’identité d’un utilisateur</span><span class="sxs-lookup"><span data-stu-id="0cdec-119">Allow Analysis Services to impersonate a user identity</span></span>  
 <span data-ttu-id="0cdec-120">Pour permettre aux services de haut niveau tels que Reporting Services, IIS ou SharePoint d'emprunter l'identité d'un utilisateur dans Analysis Services, vous devez configurer la délégation contrainte Kerberos pour ces services.</span><span class="sxs-lookup"><span data-stu-id="0cdec-120">To allow up-level services such as Reporting Services, IIS, or SharePoint to impersonate a user identity on Analysis Services, you must configure Kerberos constrained delegation for those services.</span></span> <span data-ttu-id="0cdec-121">Dans ce scénario, Analysis Services emprunte l'identité de l'utilisateur actuel à l'aide de l'identité fournie par le service de délégation et retourne des résultats selon l'appartenance au rôle de l'identité de cet utilisateur.</span><span class="sxs-lookup"><span data-stu-id="0cdec-121">In this scenario, Analysis Services impersonates the current user using the identity provided by the delegating service, returning results based on role membership of that user identity.</span></span>  
  
|<span data-ttu-id="0cdec-122">Tâche</span><span class="sxs-lookup"><span data-stu-id="0cdec-122">Task</span></span>|<span data-ttu-id="0cdec-123">Description</span><span class="sxs-lookup"><span data-stu-id="0cdec-123">Description</span></span>|  
|----------|-----------------|  
|<span data-ttu-id="0cdec-124">Étape 1 : Vérifier que les comptes conviennent pour la délégation</span><span class="sxs-lookup"><span data-stu-id="0cdec-124">Step 1: Verify that accounts are suitable for delegation</span></span>|<span data-ttu-id="0cdec-125">Vérifiez que les comptes utilisés pour exécuter les services présentent les propriétés appropriées dans Active Directory.</span><span class="sxs-lookup"><span data-stu-id="0cdec-125">Ensure that the accounts used to run the services have the correct properties in Active Directory.</span></span> <span data-ttu-id="0cdec-126">Les comptes de service dans Active Directory ne doivent pas être marqués comme comptes sensibles, ni être spécifiquement exclus des scénarios de délégation.</span><span class="sxs-lookup"><span data-stu-id="0cdec-126">Service accounts in Active Directory must not be marked as sensitive accounts, or specifically excluded from delegation scenarios.</span></span> <span data-ttu-id="0cdec-127">Pour plus d'informations, consultez [Présentation des comptes d'utilisateurs](https://go.microsoft.com/fwlink/?LinkId=235818).</span><span class="sxs-lookup"><span data-stu-id="0cdec-127">For more information, see [Understanding User Accounts](https://go.microsoft.com/fwlink/?LinkId=235818).</span></span><br /><br /> <span data-ttu-id="0cdec-128">Important généralement, tous les comptes et les serveurs doivent appartenir au même domaine Active Directory ou à des domaines approuvés dans la même forêt. \*\* \* \* \* \* \*\*</span><span class="sxs-lookup"><span data-stu-id="0cdec-128">**\*\* Important \*\*** Generally, all accounts and servers must belong to the same Active Directory domain or to trusted domains in the same forest.</span></span> <span data-ttu-id="0cdec-129">Toutefois, étant donné que Windows Server 2012 prend en charge la délégation entre les limites de domaine, vous pouvez configurer la délégation contrainte Kerberos si le niveau fonctionnel du domaine est Windows Server 2012.</span><span class="sxs-lookup"><span data-stu-id="0cdec-129">However, because Windows Server 2012 supports delegation across domain boundaries, you can configure Kerberos constrained delegation across a domain boundary if the domain functional level is Windows Server 2012.</span></span> <span data-ttu-id="0cdec-130">Sinon, vous pouvez configurer Analysis Services pour l'accès HTTP et utiliser les méthodes d'authentification IIS sur la connexion cliente.</span><span class="sxs-lookup"><span data-stu-id="0cdec-130">Another alternative is to configure Analysis Services for HTTP access and use IIS authentication methods on the client connection.</span></span> <span data-ttu-id="0cdec-131">Pour plus d’informations, consultez [Configurer l’accès HTTP à Analysis Services sur Internet Information Services &#40;IIS&#41; 8.0](configure-http-access-to-analysis-services-on-iis-8-0.md).</span><span class="sxs-lookup"><span data-stu-id="0cdec-131">For more information, see [Configure HTTP Access to Analysis Services on Internet Information Services &#40;IIS&#41; 8.0](configure-http-access-to-analysis-services-on-iis-8-0.md).</span></span>|  
|<span data-ttu-id="0cdec-132">Étape 2 : Inscrire le SPN</span><span class="sxs-lookup"><span data-stu-id="0cdec-132">Step 2: Register the SPN</span></span>|<span data-ttu-id="0cdec-133">Avant de configurer une délégation contrainte, vous devez enregistrer un Nom de principal de service (SPN) pour l'instance du service Analysis Services.</span><span class="sxs-lookup"><span data-stu-id="0cdec-133">Before setting up constrained delegation, you must register a Service Principle Name (SPN) for the Analysis Services instance.</span></span> <span data-ttu-id="0cdec-134">Vous aurez besoin du SPN Analysis Services lors de la configuration de la délégation contrainte Kerberos pour les services de niveau intermédiaire.</span><span class="sxs-lookup"><span data-stu-id="0cdec-134">You will need the Analysis Services SPN when configuring Kerberos constrained delegation for middle tier services.</span></span> <span data-ttu-id="0cdec-135">Pour obtenir des instructions, consultez [SPN registration for an Analysis Services instance](spn-registration-for-an-analysis-services-instance.md) .</span><span class="sxs-lookup"><span data-stu-id="0cdec-135">See [SPN registration for an Analysis Services instance](spn-registration-for-an-analysis-services-instance.md) for instructions.</span></span><br /><br /> <span data-ttu-id="0cdec-136">Un nom de principal du service (SPN) spécifie l'identité unique d'un service dans un domaine configuré pour l'authentification Kerberos.</span><span class="sxs-lookup"><span data-stu-id="0cdec-136">A Service Principle Name (SPN) specifies the unique identity of a service in a domain configured for Kerberos authentication.</span></span> <span data-ttu-id="0cdec-137">Les connexions clientes utilisant la sécurité intégrée demandent souvent un SPN dans le cadre de l'authentification SSPI.</span><span class="sxs-lookup"><span data-stu-id="0cdec-137">Client connections using integrated security often request an SPN as part of SSPI authentication.</span></span> <span data-ttu-id="0cdec-138">La demande est transmise à un contrôleur de domaine (DC) Active Directory, le centre de distribution de clés KDC accordant un ticket si le nom SPN présenté par le client comporte une inscription du nom SPN correspondante dans Active Directory.</span><span class="sxs-lookup"><span data-stu-id="0cdec-138">The request is forwarded to an Active Directory Domain Controller (DC), with the KDC granting a ticket if the SPN presented by the client has a matching SPN registration in Active Directory.</span></span>|  
|<span data-ttu-id="0cdec-139">Étape 3 : Configurer une délégation contrainte</span><span class="sxs-lookup"><span data-stu-id="0cdec-139">Step 3: Configure constrained delegation</span></span>|<span data-ttu-id="0cdec-140">Après avoir validé les comptes que vous souhaitez utiliser et inscrit les noms SPN de ces derniers, la prochaine étape consiste à configurer les services de haut niveau, tels que les services Web IIS, Reporting Services ou SharePoint pour la délégation contrainte, en spécifiant l'instance Analysis Services comme service spécifique pour lequel la délégation est autorisée.</span><span class="sxs-lookup"><span data-stu-id="0cdec-140">After validating the accounts you want to use and registering SPNs for those accounts, your next step is to configure up-level services, such as IIS, Reporting Services, or SharePoint web services for constrained delegation, specifying the Analysis Services SPN as the specific service for which delegation is allowed.</span></span><br /><br /> <span data-ttu-id="0cdec-141">Les services qui s'exécutent dans SharePoint, tels que Excel Services ou Reporting Services en mode SharePoint, hébergent fréquemment des classeurs et des rapports qui utilisent des données tabulaires ou multidimensionnelles d'Analysis Services.</span><span class="sxs-lookup"><span data-stu-id="0cdec-141">Services that run in SharePoint, such as Excel Services or Reporting Services in SharePoint mode, often host workbooks and reports that consume Analysis Services multidimensional or tabular data.</span></span> <span data-ttu-id="0cdec-142">Configurer une délégation contrainte pour ces services est une tâche de configuration commune, nécessaire pour la prise en charge de l'actualisation des données à partir d'Excel Services.</span><span class="sxs-lookup"><span data-stu-id="0cdec-142">Configuring constrained delegation for these services is a common configuration task, and necessary for supporting data refresh from Excel Services.</span></span> <span data-ttu-id="0cdec-143">Les liens suivants fournissent des instructions pour les services SharePoint, ainsi que d'autres services susceptibles de présenter une demande de connexion de données en aval pour les données Analysis Services :</span><span class="sxs-lookup"><span data-stu-id="0cdec-143">The following links provide instructions for SharePoint services, as well as other services likely to present a downstream data connection request for Analysis Services data:</span></span><br /><br /> <span data-ttu-id="0cdec-144">[Délégation d’identité pour Excel Services (SharePoint Server 2010)](https://go.microsoft.com/fwlink/?LinkId=299826) ou [Comment configurer Excel Services dans SharePoint Server 2010 pour l’authentification Kerberos](https://support.microsoft.com/kb/2466519)</span><span class="sxs-lookup"><span data-stu-id="0cdec-144">[Identity delegation for Excel Services (SharePoint Server 2010)](https://go.microsoft.com/fwlink/?LinkId=299826) or [How to configure Excel Services in SharePoint Server 2010 for Kerberos authentication](https://support.microsoft.com/kb/2466519)</span></span><br /><br /> [<span data-ttu-id="0cdec-145">Délégation d'identité pour les services PerformancePoint (SharePoint Server 2010)</span><span class="sxs-lookup"><span data-stu-id="0cdec-145">Identity delegation for PerformancePoint Services (SharePoint Server 2010)</span></span>](https://go.microsoft.com/fwlink/?LinkId=299827)<br /><br /> [<span data-ttu-id="0cdec-146">Délégation d'identité pour SQL Server Reporting Services (SharePoint Server 2010)</span><span class="sxs-lookup"><span data-stu-id="0cdec-146">Identity delegation for SQL Server Reporting Services (SharePoint Server 2010)</span></span>](https://go.microsoft.com/fwlink/?LinkId=299828)<br /><br /> <span data-ttu-id="0cdec-147">Pour IIS 7.0, consultez [Configurer l’authentification Windows (IIS 7.0)](https://technet.microsoft.com/library/cc754628\(v=ws.10\).aspx) ou [Comment configurer SQL Server 2008 Analysis Services et SQL Server 2005 Analysis Services pour utiliser l’authentification Kerberos](https://support.microsoft.com/kb/917409).</span><span class="sxs-lookup"><span data-stu-id="0cdec-147">For IIS 7.0 see [Configure Windows Authentication (IIS 7.0)](https://technet.microsoft.com/library/cc754628\(v=ws.10\).aspx) or [How to configure SQL Server 2008 Analysis Services and SQL Server 2005 Analysis Services to use Kerberos authentication](https://support.microsoft.com/kb/917409).</span></span>|  
|<span data-ttu-id="0cdec-148">Étape 4 : Tester les connexions</span><span class="sxs-lookup"><span data-stu-id="0cdec-148">Step 4: Test connections</span></span>|<span data-ttu-id="0cdec-149">Lors du test, connectez-vous à partir d'ordinateurs distants, sous des identités différentes, et interrogez Analysis Services en utilisant les mêmes applications en tant qu'utilisateurs professionnels.</span><span class="sxs-lookup"><span data-stu-id="0cdec-149">When testing, connect from remote computers, under different identities, and query Analysis Services using the same applications as business users.</span></span> <span data-ttu-id="0cdec-150">Vous pouvez utiliser SQL Server Profiler pour surveiller la connexion.</span><span class="sxs-lookup"><span data-stu-id="0cdec-150">You can use SQL Server Profiler to monitor the connection.</span></span> <span data-ttu-id="0cdec-151">Vous devez voir l'identité de l'utilisateur dans la demande.</span><span class="sxs-lookup"><span data-stu-id="0cdec-151">You should see the user identity on the request.</span></span> <span data-ttu-id="0cdec-152">Pour plus d'informations, consultez [Tester une identité empruntée ou déléguée](#bkmk_test) dans cette section.</span><span class="sxs-lookup"><span data-stu-id="0cdec-152">For more information, see [Test for impersonated or delegated identity](#bkmk_test) in this section.</span></span>|  
  
##  <a name="configure-analysis-services-for-trusted-delegation"></a><a name="bkmk_delegate"></a><span data-ttu-id="0cdec-153">Configurer Analysis Services pour la délégation approuvée</span><span class="sxs-lookup"><span data-stu-id="0cdec-153">Configure Analysis Services for trusted delegation</span></span>  
 <span data-ttu-id="0cdec-154">Configurer Analysis Services pour la délégation contrainte Kerberos permet au service d'emprunter l'identité d'un client sur un service de bas niveau, comme le moteur de base de données relationnelle, afin que les données puissent être interrogées comme si le client avait été connecté directement.</span><span class="sxs-lookup"><span data-stu-id="0cdec-154">Configuring Analysis Services for Kerberos constrained delegation allows the service to impersonate a client identity on a down-level service, such as the relational database engine, so that data can be queried as if the client was connected directly.</span></span>  
  
 <span data-ttu-id="0cdec-155">Les scénarios de délégation pour Analysis Services sont limités aux modèles tabulaires configurés pour le mode `DirectQuery`.</span><span class="sxs-lookup"><span data-stu-id="0cdec-155">Delegation scenarios for Analysis Services are limited to tabular models configured for `DirectQuery` mode.</span></span> <span data-ttu-id="0cdec-156">Il s'agit du seul scénario dans lequel Analysis Services peut transmettre des informations d'identification déléguées à un autre service.</span><span class="sxs-lookup"><span data-stu-id="0cdec-156">This is the only scenario in which Analysis Services can pass delegated credentials to another service.</span></span> <span data-ttu-id="0cdec-157">Dans tous les autres scénarios, tels que les scénarios SharePoint mentionnés dans la section précédente, Analysis Services est à l'extrémité réceptrice de la chaîne de délégation.</span><span class="sxs-lookup"><span data-stu-id="0cdec-157">In all other scenarios, such as SharePoint scenarios mentioned in the previous section, Analysis Services is on the receiving end of the delegation chain.</span></span> <span data-ttu-id="0cdec-158">Pour plus d’informations sur DirectQuery, consultez [Mode DirectQuery &#40;SSAS Tabulaire&#41;](../tabular-models/directquery-mode-ssas-tabular.md).</span><span class="sxs-lookup"><span data-stu-id="0cdec-158">For more information about DirectQuery, see [DirectQuery Mode &#40;SSAS Tabular&#41;](../tabular-models/directquery-mode-ssas-tabular.md).</span></span>  
  
> [!NOTE]  
>  <span data-ttu-id="0cdec-159">On pense souvent à tort que le stockage ROLAP, les opérations de traitement ou l'accès aux partitions distantes exigent la délégation contrainte.</span><span class="sxs-lookup"><span data-stu-id="0cdec-159">A common misconception is that ROLAP storage, processing operations, or access to remote partitions somehow introduce requirements for constrained delegation.</span></span> <span data-ttu-id="0cdec-160">Ce n'est pas le cas.</span><span class="sxs-lookup"><span data-stu-id="0cdec-160">This is not the case.</span></span> <span data-ttu-id="0cdec-161">Toutes ces opérations sont exécutées directement par le compte de service (également appelé compte de traitement), pour lui-même.</span><span class="sxs-lookup"><span data-stu-id="0cdec-161">All of these operations are executed directly by the service account (also referred to as the processing account), on its own behalf.</span></span> <span data-ttu-id="0cdec-162">La délégation n'est pas nécessaire pour ces opérations dans Analysis Services, étant donné que les autorisations pour ces opérations sont accordées directement au compte de service (par exemple, l'accord d'autorisations db_datareader sur la base de données relationnelle afin que le service puisse traiter des données).</span><span class="sxs-lookup"><span data-stu-id="0cdec-162">Delegation is not required for these operations in Analysis Services, given that permissions for such operations are granted directly to the service account (for example, granting db_datareader permissions on the relational database so that the service can process data).</span></span> <span data-ttu-id="0cdec-163">Pour plus d’informations sur les autorisations et les opérations serveur, consultez [Configurer les comptes de service &#40;Analysis Services&#41;](configure-service-accounts-analysis-services.md).</span><span class="sxs-lookup"><span data-stu-id="0cdec-163">For more information about server operations and permissions, see [Configure Service Accounts &#40;Analysis Services&#41;](configure-service-accounts-analysis-services.md).</span></span>  
  
 <span data-ttu-id="0cdec-164">Cette section explique comment configurer Analysis Services en vue de la délégation approuvée.</span><span class="sxs-lookup"><span data-stu-id="0cdec-164">This section explains how to set up Analysis Services for trusted delegation.</span></span> <span data-ttu-id="0cdec-165">Une fois cette tâche effectuée, Analysis Services peut transmettre des informations d'identification déléguées à SQL Server, pour la prise en charge du mode DirectQuery utilisé dans les solutions tabulaires.</span><span class="sxs-lookup"><span data-stu-id="0cdec-165">After you complete this task, Analysis Services will be able to pass delegated credentials to SQL Server, in support of DirectQuery mode used in Tabular solutions.</span></span>  
  
 <span data-ttu-id="0cdec-166">Avant de commencer :</span><span class="sxs-lookup"><span data-stu-id="0cdec-166">Before you start:</span></span>  
  
-   <span data-ttu-id="0cdec-167">Vérifiez qu'Analysis Services est démarré.</span><span class="sxs-lookup"><span data-stu-id="0cdec-167">Verify that Analysis Services is started.</span></span>  
  
-   <span data-ttu-id="0cdec-168">Vérifiez que le SPN inscrit pour Analysis Services est valide.</span><span class="sxs-lookup"><span data-stu-id="0cdec-168">Verify the SPN registered for Analysis Services is valid.</span></span> <span data-ttu-id="0cdec-169">Pour obtenir des instructions, consultez [SPN registration for an Analysis Services instance](spn-registration-for-an-analysis-services-instance.md)</span><span class="sxs-lookup"><span data-stu-id="0cdec-169">For instructions, see [SPN registration for an Analysis Services instance](spn-registration-for-an-analysis-services-instance.md)</span></span>  
  
 <span data-ttu-id="0cdec-170">Lorsque les deux conditions préalables requises sont satisfaites, passez aux étapes suivantes.</span><span class="sxs-lookup"><span data-stu-id="0cdec-170">When both prerequisites are satisfied, continue with the following steps.</span></span> <span data-ttu-id="0cdec-171">Notez que vous devez être administrateur de domaine pour configurer la délégation contrainte.</span><span class="sxs-lookup"><span data-stu-id="0cdec-171">Note that you must be a domain administrator to set up constrained delegation.</span></span>  
  
1.  <span data-ttu-id="0cdec-172">Dans Utilisateurs et ordinateurs Active Directory, recherchez le compte de service sous lequel s'exécute Analysis Services.</span><span class="sxs-lookup"><span data-stu-id="0cdec-172">In Active Directory Users and Computers, find the service account under which Analysis Services runs.</span></span> <span data-ttu-id="0cdec-173">Cliquez avec le bouton droit sur le compte de service et sélectionnez **Propriétés**.</span><span class="sxs-lookup"><span data-stu-id="0cdec-173">Right-click the service account and choose **Properties**.</span></span>  
  
     <span data-ttu-id="0cdec-174">À titre d'illustration, les captures d'écran suivantes utilisent OlapSvc et SQLSvc pour représenter respectivement Analysis Services et SQL Server.</span><span class="sxs-lookup"><span data-stu-id="0cdec-174">For illustrative purposes, the following screenshots use OlapSvc and SQLSvc to represent Analysis Services and SQL Server, respectively.</span></span>  
  
     <span data-ttu-id="0cdec-175">OlapSvc est le compte qui est configuré en vue d'une délégation contrainte à SQLSvc.</span><span class="sxs-lookup"><span data-stu-id="0cdec-175">OlapSvc is the account that will be configured for constrained delegation to SQLSvc.</span></span> <span data-ttu-id="0cdec-176">Lorsque vous effectuez cette tâche, OlapSvc est autorisé à passer les informations d'identification déléguées sur un ticket de service à SQLSvc, en empruntant l'identité de l'appelant d'origine lors de la demande de données.</span><span class="sxs-lookup"><span data-stu-id="0cdec-176">When you complete this task, OlapSvc will have permission to pass delegated credentials on a service ticket to SQLSvc, impersonating the original caller when requesting data.</span></span>  
  
2.  <span data-ttu-id="0cdec-177">Sous l'onglet Délégation, sélectionnez **N'approuver cet utilisateur que pour la délégation aux services spécifiés**, suivi de **Utiliser uniquement Kerberos**.</span><span class="sxs-lookup"><span data-stu-id="0cdec-177">On the Delegation tab, select **Trust this user for delegation to specified services only**, followed by **Use Kerberos only**.</span></span> <span data-ttu-id="0cdec-178">Cliquez sur **Ajouter** pour spécifier le service Analysis Services qui est autorisé à déléguer les informations d'identification.</span><span class="sxs-lookup"><span data-stu-id="0cdec-178">Click **Add** to specify which service Analysis Services is permitted to delegate credentials.</span></span>  
  
     <span data-ttu-id="0cdec-179">L'onglet Délégation n'est disponible que lorsque le compte d'utilisateur (OlapSvc) est affecté à un service (Analysis Services) et que le service dispose d'un nom SPN inscrit pour ce compte.</span><span class="sxs-lookup"><span data-stu-id="0cdec-179">Delegation tab appears only when the user account (OlapSvc) is assigned to a service (Analysis Services), and the service has an SPN registered for it.</span></span> <span data-ttu-id="0cdec-180">L'inscription du nom SPN requiert que le service s'exécute.</span><span class="sxs-lookup"><span data-stu-id="0cdec-180">SPN registration requires that the service is running.</span></span>  
  
     <span data-ttu-id="0cdec-181">![SSAS_Kerberos_1_AccountProperties](../media/ssas-kerberos-1-accountproperties.gif "SSAS_Kerberos_1_AccountProperties")</span><span class="sxs-lookup"><span data-stu-id="0cdec-181">![SSAS_Kerberos_1_AccountProperties](../media/ssas-kerberos-1-accountproperties.gif "SSAS_Kerberos_1_AccountProperties")</span></span>  
  
3.  <span data-ttu-id="0cdec-182">Sur la page Ajouter des services, cliquez sur **Utilisateurs ou ordinateurs**.</span><span class="sxs-lookup"><span data-stu-id="0cdec-182">On the Add Services page, click **Users or Computers**.</span></span>  
  
     <span data-ttu-id="0cdec-183">![SSAS_Kerberos_2_](../media/ssas-kerberos-2.gif "SSAS_Kerberos_2_")</span><span class="sxs-lookup"><span data-stu-id="0cdec-183">![SSAS_Kerberos_2_](../media/ssas-kerberos-2.gif "SSAS_Kerberos_2_")</span></span>  
  
4.  <span data-ttu-id="0cdec-184">Sur la page de sélection d'utilisateurs ou de l'ordinateur, entrez le compte utilisé pour exécuter l'instance SQL Server qui fournit des données aux bases de données model tabulaires Analysis Services.</span><span class="sxs-lookup"><span data-stu-id="0cdec-184">On the Select Users or Computer page, enter the account used to run the SQL Server instance providing data to Analysis Services tabular model databases.</span></span> <span data-ttu-id="0cdec-185">Cliquez sur **OK** pour accepter le compte de service.</span><span class="sxs-lookup"><span data-stu-id="0cdec-185">Click **OK** to accept the service account.</span></span>  
  
     <span data-ttu-id="0cdec-186">Si vous ne pouvez pas sélectionner le compte souhaité, vérifiez que SQL Server s'exécute et qu'un SPN est inscrit pour ce compte.</span><span class="sxs-lookup"><span data-stu-id="0cdec-186">If you cannot select the account you want, verify that SQL Server is running and has an SPN registered for that account.</span></span> <span data-ttu-id="0cdec-187">Pour plus d'informations sur les noms SPN pour le moteur de base de données, consultez [Inscrire un nom de principal du service pour les connexions Kerberos](../../database-engine/configure-windows/register-a-service-principal-name-for-kerberos-connections.md).</span><span class="sxs-lookup"><span data-stu-id="0cdec-187">For more information about SPNs for the database engine, see [Register a Service Principal Name for Kerberos Connections](../../database-engine/configure-windows/register-a-service-principal-name-for-kerberos-connections.md).</span></span>  
  
     <span data-ttu-id="0cdec-188">![SSAS_Kerberos_3_SelectUsers](../media/ssas-kerberos-3-selectusers.gif "SSAS_Kerberos_3_SelectUsers")</span><span class="sxs-lookup"><span data-stu-id="0cdec-188">![SSAS_Kerberos_3_SelectUsers](../media/ssas-kerberos-3-selectusers.gif "SSAS_Kerberos_3_SelectUsers")</span></span>  
  
5.  <span data-ttu-id="0cdec-189">L'instance de SQL Server doit maintenant apparaître dans Ajouter des services.</span><span class="sxs-lookup"><span data-stu-id="0cdec-189">The SQL Server instance should now appear in Add Services.</span></span> <span data-ttu-id="0cdec-190">Tout service qui utilise également ce compte apparaît aussi dans la liste.</span><span class="sxs-lookup"><span data-stu-id="0cdec-190">Any service also using that account will also appear in the list.</span></span> <span data-ttu-id="0cdec-191">Choisissez l'instance de SQL Server que vous souhaitez utiliser.</span><span class="sxs-lookup"><span data-stu-id="0cdec-191">Choose the SQL Server instance you want to use.</span></span> <span data-ttu-id="0cdec-192">Cliquez sur **OK** pour accepter l'instance.</span><span class="sxs-lookup"><span data-stu-id="0cdec-192">Click **OK** to accept the instance.</span></span>  
  
     <span data-ttu-id="0cdec-193">![SSAS_Kerberos_4_](../media/ssas-kerberos-4.gif "SSAS_Kerberos_4_")</span><span class="sxs-lookup"><span data-stu-id="0cdec-193">![SSAS_Kerberos_4_](../media/ssas-kerberos-4.gif "SSAS_Kerberos_4_")</span></span>  
  
6.  <span data-ttu-id="0cdec-194">La page de propriétés du compte de service Analysis Services doit désormais ressembler à la capture d'écran suivante.</span><span class="sxs-lookup"><span data-stu-id="0cdec-194">The properties page of the Analysis Services service account should now look similar to the following screenshot.</span></span> <span data-ttu-id="0cdec-195">Cliquez sur **OK** pour enregistrer vos modifications.</span><span class="sxs-lookup"><span data-stu-id="0cdec-195">Click **OK** to save your changes.</span></span>  
  
     <span data-ttu-id="0cdec-196">![SSAS_Kerberos_5_Finished](../media/ssas-kerberos-5-finished.gif "SSAS_Kerberos_5_Finished")</span><span class="sxs-lookup"><span data-stu-id="0cdec-196">![SSAS_Kerberos_5_Finished](../media/ssas-kerberos-5-finished.gif "SSAS_Kerberos_5_Finished")</span></span>  
  
7.  <span data-ttu-id="0cdec-197">Effectuez un test pour vérifier la réussite de la délégation en établissant une connexion à partir d'un ordinateur client distant, sous une identité différente, et interrogez le modèle tabulaire.</span><span class="sxs-lookup"><span data-stu-id="0cdec-197">Test for successful delegation by connecting from a remote client computer, under a different identity, and query the tabular model.</span></span> <span data-ttu-id="0cdec-198">Vous devez voir l'identité de l'utilisateur dans la demande dans SQL Server Profiler.</span><span class="sxs-lookup"><span data-stu-id="0cdec-198">You should see the user identity on the request in SQL Server Profiler.</span></span>  
  
##  <a name="test-for-impersonated-or-delegated-identity"></a><a name="bkmk_test"></a><span data-ttu-id="0cdec-199">Tester l’identité usurpée ou déléguée</span><span class="sxs-lookup"><span data-stu-id="0cdec-199">Test for impersonated or delegated identity</span></span>  
 <span data-ttu-id="0cdec-200">Utilisez SQL Server profiler pour contrôler l'identité de l'utilisateur qui interroge des données.</span><span class="sxs-lookup"><span data-stu-id="0cdec-200">Use SQL Server Profiler to monitor the identity of the user who is querying data.</span></span>  
  
1.  <span data-ttu-id="0cdec-201">Démarrez **SQL Server Profiler** sur l'instance d'Analysis Services, puis démarrez une nouvelle trace.</span><span class="sxs-lookup"><span data-stu-id="0cdec-201">Start **SQL Server Profiler** on the Analysis Services instance and then start a new trace.</span></span>  
  
2.  <span data-ttu-id="0cdec-202">Dans Sélection des événements, vérifiez que les événements `Audit Login` et `Audit Logout` sont activés dans la section Audit de sécurité.</span><span class="sxs-lookup"><span data-stu-id="0cdec-202">In Events Selection, verify that `Audit Login` and `Audit Logout` are checked in the Security Audit section.</span></span>  
  
3.  <span data-ttu-id="0cdec-203">Connectez-vous à Analysis Services via un service d'application (tel que SharePoint ou Reporting Services) à partir d'un ordinateur client distant.</span><span class="sxs-lookup"><span data-stu-id="0cdec-203">Connect to Analysis Services via an application service (such as SharePoint or Reporting Services) from a remote client computer.</span></span> <span data-ttu-id="0cdec-204">L'événement Audit Login affiche l'identité de l'utilisateur qui se connecte à Analysis Services.</span><span class="sxs-lookup"><span data-stu-id="0cdec-204">The Audit Login event will show the identity of the user connecting to Analysis Services.</span></span>  
  
 <span data-ttu-id="0cdec-205">Un test approfondi requiert l'utilisation d'outils de surveillance du réseau qui peuvent capturer les demandes et les réponses Kerberos sur le réseau.</span><span class="sxs-lookup"><span data-stu-id="0cdec-205">Thorough testing will require the use of network monitoring tools that can capture Kerberos requests and responses on the network.</span></span> <span data-ttu-id="0cdec-206">L'utilitaire de surveillance du réseau (netmon.exe), filtré pour Kerberos, peut être utilisé pour cette tâche.</span><span class="sxs-lookup"><span data-stu-id="0cdec-206">The Network Monitor utility (netmon.exe), filtered for Kerberos, can be used for this task.</span></span> <span data-ttu-id="0cdec-207">Pour plus d’informations sur l’utilisation de Netmon 3.4 et d’autres outils pour tester l’authentification Kerberos, consultez [Configuration de l’authentification Kerberos : configuration de base (SharePoint Server 2010)](https://technet.microsoft.com/library/gg502602\(v=office.14\).aspx).</span><span class="sxs-lookup"><span data-stu-id="0cdec-207">For more information about using Netmon 3.4 and other tools for testing Kerberos authentication, see [Configuring Kerberos authentication: Core configuration (SharePoint Server 2010)](https://technet.microsoft.com/library/gg502602\(v=office.14\).aspx).</span></span>  
  
 <span data-ttu-id="0cdec-208">Consultez également [The Most Confusing Dialog Box in Active Directory](https://www.itprotoday.com/active-directory/most-confusing-dialog-box-active-directory) pour obtenir une description détaillée de chaque option de l'onglet Délégation de la boîte de dialogue de propriétés de l'objet Active Directory.</span><span class="sxs-lookup"><span data-stu-id="0cdec-208">Additionally, see [The Most Confusing Dialog Box in Active Directory](https://www.itprotoday.com/active-directory/most-confusing-dialog-box-active-directory) for a thorough description of each option in the Delegation tab of the Active Directory object's property dialog box.</span></span> <span data-ttu-id="0cdec-209">Cet article explique également comment utiliser LDP pour effectuer des tests et interpréter leurs résultats.</span><span class="sxs-lookup"><span data-stu-id="0cdec-209">This article also explains how to use LDP to test and interpret test results.</span></span>  
  
## <a name="see-also"></a><span data-ttu-id="0cdec-210">Voir aussi</span><span class="sxs-lookup"><span data-stu-id="0cdec-210">See Also</span></span>  
 <span data-ttu-id="0cdec-211">[Authentification et délégation d’identité Microsoft BI](https://go.microsoft.com/fwlink/?LinkID=286576) </span><span class="sxs-lookup"><span data-stu-id="0cdec-211">[Microsoft BI Authentication and Identity Delegation](https://go.microsoft.com/fwlink/?LinkID=286576) </span></span>  
 <span data-ttu-id="0cdec-212">[Authentification mutuelle à l’aide de Kerberos](https://go.microsoft.com/fwlink/?LinkId=299283) </span><span class="sxs-lookup"><span data-stu-id="0cdec-212">[Mutual Authentication Using Kerberos](https://go.microsoft.com/fwlink/?LinkId=299283) </span></span>  
 <span data-ttu-id="0cdec-213">[Se connecter à Analysis Services](connect-to-analysis-services.md) </span><span class="sxs-lookup"><span data-stu-id="0cdec-213">[Connect to Analysis Services](connect-to-analysis-services.md) </span></span>  
 <span data-ttu-id="0cdec-214">[Inscription du nom SPN pour une instance Analysis Services](spn-registration-for-an-analysis-services-instance.md) </span><span class="sxs-lookup"><span data-stu-id="0cdec-214">[SPN registration for an Analysis Services instance](spn-registration-for-an-analysis-services-instance.md) </span></span>  
 [<span data-ttu-id="0cdec-215">Propriétés des chaînes de connexion &#40;Analysis Services&#41;</span><span class="sxs-lookup"><span data-stu-id="0cdec-215">Connection String Properties &#40;Analysis Services&#41;</span></span>](connection-string-properties-analysis-services.md)  
  
  
