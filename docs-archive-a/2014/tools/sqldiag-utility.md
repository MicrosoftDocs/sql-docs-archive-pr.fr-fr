---
title: Utilitaire SQLdiag | Microsoft Docs
ms.custom: ''
ms.date: 06/13/2017
ms.prod: sql-server-2014
ms.reviewer: ''
ms.technology: tools-other
ms.topic: conceptual
helpviewer_keywords:
- command prompt utilities [SQL Server], SQLdiag
- stopping diagnostic collection
- storing diagnostic information
- performance [SQL Server], diagnostic collection
- diagnostic records [SQL Server]
- scripts [SQL Server], diagnostic collection
- logs [SQL Server], diagnostic collection
- starting diagnostic collection
- clustered instance of SQL Server
- monitoring performance [SQL Server], diagnostic collection
- security [SQL Server], diagnostic collection
- SQLDIAG service
- space [SQL Server], diagnostic collection
- SQLdiag utility
- disk space [SQL Server], diagnostic collection
- configuration files [SQL Server]
- automatic diagnostic collection
- clusters [SQL Server], diagnostic collection
ms.assetid: 45ba1307-33d1-431e-872c-a6e4556f5ff2
author: stevestein
ms.author: sstein
ms.openlocfilehash: 0559e0b2261ed5ba1c9c384608d04194d685f695
ms.sourcegitcommit: ad4d92dce894592a259721a1571b1d8736abacdb
ms.translationtype: MT
ms.contentlocale: fr-FR
ms.lasthandoff: 08/04/2020
ms.locfileid: "87694920"
---
# <a name="sqldiag-utility"></a><span data-ttu-id="5a9f9-102">SQLdiag (utilitaire)</span><span class="sxs-lookup"><span data-stu-id="5a9f9-102">SQLdiag Utility</span></span>
  <span data-ttu-id="5a9f9-103">L’utilitaire **SQLdiag** est un utilitaire de collecte de données de diagnostic, conçu pour un usage général. Il est possible de l’exécuter en tant qu’application console ou service.</span><span class="sxs-lookup"><span data-stu-id="5a9f9-103">The **SQLdiag** utility is a general purpose diagnostics collection utility that can be run as a console application or as a service.</span></span> <span data-ttu-id="5a9f9-104">Vous pouvez utiliser **SQLdiag** pour collecter des fichiers journaux et des fichiers de données à partir de [!INCLUDE[ssNoVersion](../includes/ssnoversion-md.md)] et depuis d’autres types de serveurs, mais aussi analyser vos serveurs au fil des jours ou trouver des solutions à des problèmes spécifiques les concernant.</span><span class="sxs-lookup"><span data-stu-id="5a9f9-104">You can use **SQLdiag** to collect logs and data files from [!INCLUDE[ssNoVersion](../includes/ssnoversion-md.md)] and other types of servers, and use it to monitor your servers over time or troubleshoot specific problems with your servers.</span></span> <span data-ttu-id="5a9f9-105">**SQLdiag** a été conçu pour accélérer et simplifier la collecte d’informations de diagnostic pour les services d’assistance de [!INCLUDE[msCoName](../includes/msconame-md.md)] .</span><span class="sxs-lookup"><span data-stu-id="5a9f9-105">**SQLdiag** is intended to expedite and simplify diagnostic information gathering for [!INCLUDE[msCoName](../includes/msconame-md.md)] Customer Support Services.</span></span>  
  
> [!NOTE]  
>  <span data-ttu-id="5a9f9-106">Cet utilitaire peut être amené à évoluer par la suite, ainsi les applications ou les scripts élaborés à partir de son comportement ou de ses arguments de ligne de commande peuvent ne pas fonctionner correctement dans les versions ultérieures qui seront développées.</span><span class="sxs-lookup"><span data-stu-id="5a9f9-106">This utility may be changed, and applications or scripts that rely on its command line arguments or behavior may not work correctly in future releases.</span></span>  
  
 <span data-ttu-id="5a9f9-107">**SQLdiag** peut recueillir les types suivants d’informations de diagnostic :</span><span class="sxs-lookup"><span data-stu-id="5a9f9-107">**SQLdiag** can collect the following types of diagnostic information:</span></span>  
  
-   <span data-ttu-id="5a9f9-108">Journaux de performances Windows</span><span class="sxs-lookup"><span data-stu-id="5a9f9-108">Windows performance logs</span></span>  
  
-   <span data-ttu-id="5a9f9-109">Journaux des événements Windows</span><span class="sxs-lookup"><span data-stu-id="5a9f9-109">Windows event logs</span></span>  
  
-   [!INCLUDE[ssSqlProfiler](../includes/sssqlprofiler-md.md)] <span data-ttu-id="5a9f9-110">traces</span><span class="sxs-lookup"><span data-stu-id="5a9f9-110">traces</span></span>  
  
-   [!INCLUDE[ssNoVersion](../includes/ssnoversion-md.md)] <span data-ttu-id="5a9f9-111">informations de blocage</span><span class="sxs-lookup"><span data-stu-id="5a9f9-111">blocking information</span></span>  
  
-   [!INCLUDE[ssNoVersion](../includes/ssnoversion-md.md)] <span data-ttu-id="5a9f9-112">informations de configuration</span><span class="sxs-lookup"><span data-stu-id="5a9f9-112">configuration information</span></span>  
  
 <span data-ttu-id="5a9f9-113">Vous pouvez spécifier les types d’informations que vous souhaitez collecter par **SQLdiag** en modifiant le fichier de configuration SQLDiag.xml, décrit dans une section suivante.</span><span class="sxs-lookup"><span data-stu-id="5a9f9-113">You can specify what types of information you want **SQLdiag** to collect by editing the configuration file SQLDiag.xml, which is described in a following section.</span></span>  
  
## <a name="syntax"></a><span data-ttu-id="5a9f9-114">Syntaxe</span><span class="sxs-lookup"><span data-stu-id="5a9f9-114">Syntax</span></span>  
  
```  
  
      sqldiag   
     { [/?] }  
     |  
     { [/I configuration_file]  
       [/O output_folder_path]  
       [/Psupport_folder_path]  
       [/Noutput_folder_management_option]  
       [/Mmachine1 [ machine2machineN]| @machinelistfile]  
       [/Cfile_compression_type]  
       [/B [+]start_time]  
       [/E [+]stop_time]  
       [/ASQLdiag_application_name]  
       [/T { tcp [ ,port ] | np | lpc } ]  
       [/Q] [/G] [/R] [/U] [/L] [/X] }  
     |  
     { [START | STOP | STOP_ABORT] }  
     |  
     { [START | STOP | STOP_ABORT] /ASQLdiag_application_name }  
```  
  
## <a name="arguments"></a><span data-ttu-id="5a9f9-115">Arguments</span><span class="sxs-lookup"><span data-stu-id="5a9f9-115">Arguments</span></span>  
 <span data-ttu-id="5a9f9-116">**/?**</span><span class="sxs-lookup"><span data-stu-id="5a9f9-116">**/?**</span></span>  
 <span data-ttu-id="5a9f9-117">Affiche des informations sur l’utilisation.</span><span class="sxs-lookup"><span data-stu-id="5a9f9-117">Displays usage information.</span></span>  
  
 <span data-ttu-id="5a9f9-118">**/I** _configuration_file_</span><span class="sxs-lookup"><span data-stu-id="5a9f9-118">**/I** _configuration_file_</span></span>  
 <span data-ttu-id="5a9f9-119">Définit le fichier de configuration que **SQLdiag** doit utiliser.</span><span class="sxs-lookup"><span data-stu-id="5a9f9-119">Sets the configuration file for **SQLdiag** to use.</span></span> <span data-ttu-id="5a9f9-120">Par défaut, **/I** a la valeur SQLDiag.Xml.</span><span class="sxs-lookup"><span data-stu-id="5a9f9-120">By default, **/I** is set to SQLDiag.Xml.</span></span>  
  
 <span data-ttu-id="5a9f9-121">**/O** _output_folder_path_</span><span class="sxs-lookup"><span data-stu-id="5a9f9-121">**/O** _output_folder_path_</span></span>  
 <span data-ttu-id="5a9f9-122">Redirige la sortie de **SQLdiag** vers le dossier spécifié.</span><span class="sxs-lookup"><span data-stu-id="5a9f9-122">Redirects **SQLdiag** output to the specified folder.</span></span> <span data-ttu-id="5a9f9-123">Si l’option **/O** n’est pas spécifiée, la sortie de **SQLdiag** est écrite dans un sous-dossier nommé SQLDIAG, sous le dossier de démarrage **SQLdiag** .</span><span class="sxs-lookup"><span data-stu-id="5a9f9-123">If the **/O** option is not specified, **SQLdiag** output is written to a subfolder named SQLDIAG under the **SQLdiag** startup folder.</span></span> <span data-ttu-id="5a9f9-124">Si le dossier SQLDIAG n’existe pas, **SQLdiag** tente de le créer.</span><span class="sxs-lookup"><span data-stu-id="5a9f9-124">If the SQLDIAG folder does not exist, **SQLdiag** attempts to create it.</span></span>  
  
> [!NOTE]  
>  <span data-ttu-id="5a9f9-125">L’emplacement du dossier de sortie varie en fonction de l’emplacement du dossier de support qui peut être spécifié à l’aide de l’option **/P**.</span><span class="sxs-lookup"><span data-stu-id="5a9f9-125">The output folder location is relative to the support folder location that can be specified with **/P**.</span></span> <span data-ttu-id="5a9f9-126">Si vous voulez définir un emplacement complètement différent pour le dossier de sortie, spécifiez le chemin complet du répertoire pour **/O**.</span><span class="sxs-lookup"><span data-stu-id="5a9f9-126">To set an entirely different location for the output folder, specify the full directory path for **/O**.</span></span>  
  
 <span data-ttu-id="5a9f9-127">**/P** _support_folder_path_</span><span class="sxs-lookup"><span data-stu-id="5a9f9-127">**/P** _support_folder_path_</span></span>  
 <span data-ttu-id="5a9f9-128">Définit le chemin d'accès au dossier de support.</span><span class="sxs-lookup"><span data-stu-id="5a9f9-128">Sets the support folder path.</span></span> <span data-ttu-id="5a9f9-129">Par défaut, l’option **/P** a comme valeur le dossier qui contient le fichier exécutable **SQLdiag** .</span><span class="sxs-lookup"><span data-stu-id="5a9f9-129">By default, **/P** is set to the folder where the **SQLdiag** executable resides.</span></span> <span data-ttu-id="5a9f9-130">Le dossier de support contient les fichiers de prise en charge de **SQLdiag** , par exemple le fichier de configuration XML, les scripts Transact-SQL ainsi que d’autres fichiers dont l’utilitaire a besoin quand il collecte des diagnostics.</span><span class="sxs-lookup"><span data-stu-id="5a9f9-130">The support folder contains **SQLdiag** support files, such as the XML configuration file, Transact-SQL scripts, and other files that the utility uses during diagnostics collection.</span></span> <span data-ttu-id="5a9f9-131">Si vous utilisez cette option pour définir un autre chemin d’accès aux fichiers de prise en charge, **SQLdiag** copie automatiquement les fichiers de prise en charge indispensables dans le dossier spécifié s’ils ne s’y trouvent pas déjà.</span><span class="sxs-lookup"><span data-stu-id="5a9f9-131">If you use this option to specify an alternate support files path, **SQLdiag** will automatically copy the support files it requires to the specified folder if they do not already exist.</span></span>  
  
> [!NOTE]  
>  <span data-ttu-id="5a9f9-132">Pour définir votre dossier actif comme chemin de support, spécifiez **%cd%** sur la ligne de commande comme suit :</span><span class="sxs-lookup"><span data-stu-id="5a9f9-132">To set your current folder as the support path, specify **%cd%** on the command line as follows:</span></span>  
>   
>  <span data-ttu-id="5a9f9-133">**SQLDIAG /P %cd%**</span><span class="sxs-lookup"><span data-stu-id="5a9f9-133">**SQLDIAG /P %cd%**</span></span>  
  
 <span data-ttu-id="5a9f9-134">**/N** _output_folder_management_option_</span><span class="sxs-lookup"><span data-stu-id="5a9f9-134">**/N** _output_folder_management_option_</span></span>  
 <span data-ttu-id="5a9f9-135">Indique si **SQLdiag** remplace ou renomme le dossier de sortie à son démarrage.</span><span class="sxs-lookup"><span data-stu-id="5a9f9-135">Sets whether **SQLdiag** overwrites or renames the output folder when it starts up.</span></span> <span data-ttu-id="5a9f9-136">Options disponibles :</span><span class="sxs-lookup"><span data-stu-id="5a9f9-136">Available options:</span></span>  
  
 <span data-ttu-id="5a9f9-137">1 = Remplace le dossier de sortie (par défaut)</span><span class="sxs-lookup"><span data-stu-id="5a9f9-137">1 = Overwrites the output folder (default)</span></span>  
  
 <span data-ttu-id="5a9f9-138">2 = Quand **SQLdiag** démarre, il renomme le dossier de sortie en SQLDIAG_00001, SQLDIAG_00002, etc.</span><span class="sxs-lookup"><span data-stu-id="5a9f9-138">2 = When **SQLdiag** starts up, it renames the output folder to SQLDIAG_00001, SQLDIAG_00002, and so on.</span></span> <span data-ttu-id="5a9f9-139">Une fois le dossier de sortie actif renommé, **SQLdiag** enregistre la nouvelle sortie dans le dossier de sortie par défaut, SQLDIAG.</span><span class="sxs-lookup"><span data-stu-id="5a9f9-139">After renaming the current output folder, **SQLdiag** writes output to the default output folder SQLDIAG.</span></span>  
  
> [!NOTE]  
>  <span data-ttu-id="5a9f9-140">**SQLdiag** n’ajoute pas la sortie au dossier de sortie actif quand il démarre.</span><span class="sxs-lookup"><span data-stu-id="5a9f9-140">**SQLdiag** does not append output to the current output folder when it starts up.</span></span> <span data-ttu-id="5a9f9-141">Il peut uniquement remplacer le dossier de sortie par défaut (option 1) ou renommer le dossier (option 2), puis enregistrer la sortie dans le nouveau dossier de sortie par défaut nommé SQLDIAG.</span><span class="sxs-lookup"><span data-stu-id="5a9f9-141">It can only overwrite the default output folder (option 1) or rename the folder (option 2), and then it writes output to the new default output folder named SQLDIAG.</span></span>  
  
 <span data-ttu-id="5a9f9-142">**/M** _machine1_ [ *machine2 \* \* Machinen*] |*@machinelistfile*</span><span class="sxs-lookup"><span data-stu-id="5a9f9-142">**/M** _machine1_ [ *machine2\*\*machineN*] | *@machinelistfile*</span></span>  
 <span data-ttu-id="5a9f9-143">Remplace les ordinateurs spécifiés dans le fichier de configuration.</span><span class="sxs-lookup"><span data-stu-id="5a9f9-143">Overrides the machines specified in the configuration file.</span></span> <span data-ttu-id="5a9f9-144">Par défaut, le fichier de configuration est SQLDiag.Xml ou est défini avec le paramètre **/I** .</span><span class="sxs-lookup"><span data-stu-id="5a9f9-144">By default the configuration file is SQLDiag.Xml, or is set with the **/I** parameter.</span></span> <span data-ttu-id="5a9f9-145">Lorsque vous spécifiez plusieurs ordinateurs, séparez chaque nom d'ordinateur avec un espace.</span><span class="sxs-lookup"><span data-stu-id="5a9f9-145">When specifying more than one machine, separate each machine name with a space.</span></span>  
  
 <span data-ttu-id="5a9f9-146">L’utilisation de *@machinelistfile* spécifie un nom de fichier de liste d’ordinateurs à stocker dans le fichier de configuration.</span><span class="sxs-lookup"><span data-stu-id="5a9f9-146">Using *@machinelistfile* specifies a machine list filename to be stored in the configuration file.</span></span>  
  
 <span data-ttu-id="5a9f9-147">**/C** _file_compression_type_</span><span class="sxs-lookup"><span data-stu-id="5a9f9-147">**/C** _file_compression_type_</span></span>  
 <span data-ttu-id="5a9f9-148">Définit le type de compression de fichiers utilisé sur les fichiers du dossier de sortie de **SQLdiag** .</span><span class="sxs-lookup"><span data-stu-id="5a9f9-148">Sets the type of file compression used on the **SQLdiag** output folder files.</span></span> <span data-ttu-id="5a9f9-149">Options disponibles :</span><span class="sxs-lookup"><span data-stu-id="5a9f9-149">Available options:</span></span>  
  
 <span data-ttu-id="5a9f9-150">0 = aucune (par défaut)</span><span class="sxs-lookup"><span data-stu-id="5a9f9-150">0 = none (default)</span></span>  
  
 <span data-ttu-id="5a9f9-151">1 = utilise la compression NTFS</span><span class="sxs-lookup"><span data-stu-id="5a9f9-151">1 = uses NTFS compression</span></span>  
  
 <span data-ttu-id="5a9f9-152">**/B** [ **+** ]*heure_début*</span><span class="sxs-lookup"><span data-stu-id="5a9f9-152">**/B** [**+**]*start_time*</span></span>  
 <span data-ttu-id="5a9f9-153">Spécifie la date et l'heure de début de la collecte des données de diagnostics dans le format suivant :</span><span class="sxs-lookup"><span data-stu-id="5a9f9-153">Specifies the date and time to start collecting diagnostic data in the following format:</span></span>  
  
 <span data-ttu-id="5a9f9-154">AAAAMMJJ_HH:MM:SS</span><span class="sxs-lookup"><span data-stu-id="5a9f9-154">YYYYMMDD_HH:MM:SS</span></span>  
  
 <span data-ttu-id="5a9f9-155">L'heure est spécifiée en utilisant une notation de 24 heures.</span><span class="sxs-lookup"><span data-stu-id="5a9f9-155">The time is specified using 24-hour notation.</span></span> <span data-ttu-id="5a9f9-156">Par exemple, 2:00 P.M.</span><span class="sxs-lookup"><span data-stu-id="5a9f9-156">For example, 2:00 P.M.</span></span> <span data-ttu-id="5a9f9-157">doit être spécifié comme **14:00:00**.</span><span class="sxs-lookup"><span data-stu-id="5a9f9-157">should be specified as **14:00:00**.</span></span>  
  
 <span data-ttu-id="5a9f9-158">Utilisez **+** sans la date (HH:MM:SS seulement) pour spécifier une heure relative à la date et l’heure actuelle.</span><span class="sxs-lookup"><span data-stu-id="5a9f9-158">Use **+** without the date (HH:MM:SS only) to specify a time that is relative to the current date and time.</span></span> <span data-ttu-id="5a9f9-159">Par exemple, si vous spécifiez **/B +02:00:00**, **SQLdiag** attend deux heures avant de démarrer la collecte d’informations.</span><span class="sxs-lookup"><span data-stu-id="5a9f9-159">For example, if you specify **/B +02:00:00**, **SQLdiag** will wait 2 hours before it starts collecting information.</span></span>  
  
 <span data-ttu-id="5a9f9-160">N’insérez pas d’espace entre **+** et la valeur *date_début*spécifiée.</span><span class="sxs-lookup"><span data-stu-id="5a9f9-160">Do not insert a space between **+** and the specified *start_time*.</span></span>  
  
 <span data-ttu-id="5a9f9-161">Si vous spécifiez une heure de début dans le passé, **SQLdiag** modifie cette date de façon à ce que la date et l’heure de début se situent dans le futur.</span><span class="sxs-lookup"><span data-stu-id="5a9f9-161">If you specify a start time that is in the past, **SQLdiag** forcibly changes the start date so the start date and time are in the future.</span></span> <span data-ttu-id="5a9f9-162">Par exemple, si vous spécifiez **/B 01:00:00** et si l’heure actuelle est 08:00:00, **SQLdiag** remplace la date de début par la date du lendemain.</span><span class="sxs-lookup"><span data-stu-id="5a9f9-162">For example, if you specify **/B 01:00:00** and the current time is 08:00:00, **SQLdiag** forcibly changes the start date so that the start date is the next day.</span></span>  
  
 <span data-ttu-id="5a9f9-163">Notez que **SQLdiag** utilise l’heure locale sur l’ordinateur sur lequel l’utilitaire s’exécute.</span><span class="sxs-lookup"><span data-stu-id="5a9f9-163">Note that **SQLdiag** uses the local time on the computer where the utility is running.</span></span>  
  
 <span data-ttu-id="5a9f9-164">**/E** [ **+** ]*heure_fin*</span><span class="sxs-lookup"><span data-stu-id="5a9f9-164">**/E** [**+**]*stop_time*</span></span>  
 <span data-ttu-id="5a9f9-165">Spécifie la date et l'heure d'arrêt de la collecte des données de diagnostics dans le format suivant :</span><span class="sxs-lookup"><span data-stu-id="5a9f9-165">Specifies the date and time to stop collecting diagnostic data in the following format:</span></span>  
  
 <span data-ttu-id="5a9f9-166">AAAAMMJJ_HH:MM:SS</span><span class="sxs-lookup"><span data-stu-id="5a9f9-166">YYYYMMDD_HH:MM:SS</span></span>  
  
 <span data-ttu-id="5a9f9-167">L'heure est spécifiée en utilisant une notation de 24 heures.</span><span class="sxs-lookup"><span data-stu-id="5a9f9-167">The time is specified using 24-hour notation.</span></span> <span data-ttu-id="5a9f9-168">Par exemple, 2:00 P.M.</span><span class="sxs-lookup"><span data-stu-id="5a9f9-168">For example, 2:00 P.M.</span></span> <span data-ttu-id="5a9f9-169">doit être spécifié comme **14:00:00**.</span><span class="sxs-lookup"><span data-stu-id="5a9f9-169">should be specified as **14:00:00**.</span></span>  
  
 <span data-ttu-id="5a9f9-170">Utilisez **+** sans la date (HH:MM:SS seulement) pour spécifier une heure relative à la date et l’heure actuelle.</span><span class="sxs-lookup"><span data-stu-id="5a9f9-170">Use **+** without the date (HH:MM:SS only) to specify a time that is relative to the current date and time.</span></span> <span data-ttu-id="5a9f9-171">Par exemple si vous spécifiez une heure de début et une heure de fin avec **/B +02:00:00 /E +03:00:00**, **SQLdiag** attend deux heures avant de démarrer la collecte d’informations, puis collecte des informations pendant trois heures avant de s’arrêter et de quitter.</span><span class="sxs-lookup"><span data-stu-id="5a9f9-171">For example, if you specify a start time and end time by using **/B +02:00:00 /E +03:00:00**, **SQLdiag** waits 2 hours before it starts collecting information, then collects information for 3 hours before it stops and exits.</span></span> <span data-ttu-id="5a9f9-172">Si **/B** n’est pas spécifié, **SQLdiag** débute la collecte de diagnostics immédiatement et l’arrête à la date et l’heure spécifiées par **/E**.</span><span class="sxs-lookup"><span data-stu-id="5a9f9-172">If **/B** is not specified, **SQLdiag** starts collecting diagnostics immediately and ends at the date and time specified by **/E**.</span></span>  
  
 <span data-ttu-id="5a9f9-173">N’insérez pas d’espace entre **+** et la valeur *heure_début* ou *heure_fin*spécifié.</span><span class="sxs-lookup"><span data-stu-id="5a9f9-173">Do not insert a space between **+** and the specified *start_time* or *end_time*.</span></span>  
  
 <span data-ttu-id="5a9f9-174">Notez que **SQLdiag** utilise l’heure locale sur l’ordinateur sur lequel l’utilitaire s’exécute.</span><span class="sxs-lookup"><span data-stu-id="5a9f9-174">Note that **SQLdiag** uses the local time on the computer where the utility is running.</span></span>  
  
 <span data-ttu-id="5a9f9-175">**/A** _SQLdiag_application_name_</span><span class="sxs-lookup"><span data-stu-id="5a9f9-175">**/A** _SQLdiag_application_name_</span></span>  
 <span data-ttu-id="5a9f9-176">Permet d’exécuter plusieurs instances de l’utilitaire **SQLdiag[!INCLUDE[ssNoVersion](../includes/ssnoversion-md.md)] sur la même instance** .</span><span class="sxs-lookup"><span data-stu-id="5a9f9-176">Enables running multiple instances of the **SQLdiag** utility against the same [!INCLUDE[ssNoVersion](../includes/ssnoversion-md.md)] instance.</span></span>  
  
 <span data-ttu-id="5a9f9-177">Chaque *nom_application_SQLdiag* identifie une instance différente de **SQLdiag**.</span><span class="sxs-lookup"><span data-stu-id="5a9f9-177">Each *SQLdiag_application_name* identifies a different instance of **SQLdiag**.</span></span> <span data-ttu-id="5a9f9-178">Il n’existe aucune relation entre une instance *nom_application_SQLdiag* et un nom d’instance [!INCLUDE[ssNoVersion](../includes/ssnoversion-md.md)] .</span><span class="sxs-lookup"><span data-stu-id="5a9f9-178">No relationship exists between a *SQLdiag_application_name* instance and a [!INCLUDE[ssNoVersion](../includes/ssnoversion-md.md)] instance name.</span></span>  
  
 <span data-ttu-id="5a9f9-179">Vous pouvez utiliser*nom_application_SQLdiag* pour démarrer ou arrêter une instance spécifique du service **SQLdiag** .</span><span class="sxs-lookup"><span data-stu-id="5a9f9-179">*SQLdiag_application_name* can be used to start or stop a specific instance of the **SQLdiag** service.</span></span>  
  
 <span data-ttu-id="5a9f9-180">Par exemple :</span><span class="sxs-lookup"><span data-stu-id="5a9f9-180">For example:</span></span>  
  
 <span data-ttu-id="5a9f9-181">**SQLDIAG START /A** _SQLdiag_application_name_</span><span class="sxs-lookup"><span data-stu-id="5a9f9-181">**SQLDIAG START /A** _SQLdiag_application_name_</span></span>  
  
 <span data-ttu-id="5a9f9-182">Vous pouvez aussi l’utiliser avec l’option **/R** pour enregistrer une instance spécifique de **SQLdiag** en tant que service.</span><span class="sxs-lookup"><span data-stu-id="5a9f9-182">It can also be used with the **/R** option to register a specific instance of **SQLdiag** as a service.</span></span> <span data-ttu-id="5a9f9-183">Par exemple :</span><span class="sxs-lookup"><span data-stu-id="5a9f9-183">For example:</span></span>  
  
 <span data-ttu-id="5a9f9-184">**SQLDIAG /R /A** _SQLdiag_application_name_</span><span class="sxs-lookup"><span data-stu-id="5a9f9-184">**SQLDIAG /R /A** _SQLdiag_application_name_</span></span>  
  
> [!NOTE]  
>  <span data-ttu-id="5a9f9-185">**SQLdiag** ajoute automatiquement le préfixe DIAG$ au nom de l’instance spécifié pour *nom_application_SQLdiag*.</span><span class="sxs-lookup"><span data-stu-id="5a9f9-185">**SQLdiag** automatically prefixes DIAG$ to the instance name specified for *SQLdiag_application_name*.</span></span> <span data-ttu-id="5a9f9-186">Vous obtenez ainsi un nom de service pratique si vous inscrivez **SQLdiag** comme service.</span><span class="sxs-lookup"><span data-stu-id="5a9f9-186">This provides a sensible service name if you register **SQLdiag** as a service.</span></span>  
  
 <span data-ttu-id="5a9f9-187">/T { tcp [ ,*port* ] | np | lpc }</span><span class="sxs-lookup"><span data-stu-id="5a9f9-187">/T { tcp [ ,*port* ] | np | lpc }</span></span>  
 <span data-ttu-id="5a9f9-188">Permet de se connecter à une instance de [!INCLUDE[ssNoVersion](../includes/ssnoversion-md.md)] en utilisant le protocole spécifié.</span><span class="sxs-lookup"><span data-stu-id="5a9f9-188">Connects to an instance of [!INCLUDE[ssNoVersion](../includes/ssnoversion-md.md)] using the specified protocol.</span></span>  
  
 <span data-ttu-id="5a9f9-189">tcp [,*port*]</span><span class="sxs-lookup"><span data-stu-id="5a9f9-189">tcp [,*port*]</span></span>  
 <span data-ttu-id="5a9f9-190">Transmission Control Protocol/Internet Protocol (TCP/IP).</span><span class="sxs-lookup"><span data-stu-id="5a9f9-190">Transmission Control Protocol/Internet Protocol (TCP/IP).</span></span> <span data-ttu-id="5a9f9-191">Vous pouvez éventuellement spécifier un numéro de port pour la connexion.</span><span class="sxs-lookup"><span data-stu-id="5a9f9-191">You can optionally specify a port number for the connection.</span></span>  
  
 <span data-ttu-id="5a9f9-192">np</span><span class="sxs-lookup"><span data-stu-id="5a9f9-192">np</span></span>  
 <span data-ttu-id="5a9f9-193">Canaux nommés.</span><span class="sxs-lookup"><span data-stu-id="5a9f9-193">Named pipes.</span></span> <span data-ttu-id="5a9f9-194">Par défaut, l'instance par défaut de [!INCLUDE[ssNoVersion](../includes/ssnoversion-md.md)] écoute le canal nommé `\\.\pipe\sql\query` et `\\.\pipe\MSSQL$<instancename>\sql\query` pour une instance nommée.</span><span class="sxs-lookup"><span data-stu-id="5a9f9-194">By default, the default instance of [!INCLUDE[ssNoVersion](../includes/ssnoversion-md.md)] listens on named pipe `\\.\pipe\sql\query` and `\\.\pipe\MSSQL$<instancename>\sql\query` for a named instance.</span></span> <span data-ttu-id="5a9f9-195">Vous ne pouvez pas vous connecter à une instance de [!INCLUDE[ssNoVersion](../includes/ssnoversion-md.md)] en utilisant un autre nom de canal.</span><span class="sxs-lookup"><span data-stu-id="5a9f9-195">You cannot connect to an instance of [!INCLUDE[ssNoVersion](../includes/ssnoversion-md.md)] by using an alternate pipe name.</span></span>  
  
 <span data-ttu-id="5a9f9-196">lpc</span><span class="sxs-lookup"><span data-stu-id="5a9f9-196">lpc</span></span>  
 <span data-ttu-id="5a9f9-197">Appel de procédure locale.</span><span class="sxs-lookup"><span data-stu-id="5a9f9-197">Local procedure call.</span></span> <span data-ttu-id="5a9f9-198">Ce protocole de mémoire partagée est disponible si le client se connecte à une instance de [!INCLUDE[ssNoVersion](../includes/ssnoversion-md.md)] sur le même ordinateur.</span><span class="sxs-lookup"><span data-stu-id="5a9f9-198">This shared memory protocol is available if the client is connecting to an instance of [!INCLUDE[ssNoVersion](../includes/ssnoversion-md.md)] on the same computer.</span></span>  
  
 <span data-ttu-id="5a9f9-199">**/Q**</span><span class="sxs-lookup"><span data-stu-id="5a9f9-199">**/Q**</span></span>  
 <span data-ttu-id="5a9f9-200">Exécute **SQLdiag** en mode silencieux.</span><span class="sxs-lookup"><span data-stu-id="5a9f9-200">Runs **SQLdiag** in quiet mode.</span></span> <span data-ttu-id="5a9f9-201">**/Q** supprime toutes les invites, telles que les invites de mot de passe.</span><span class="sxs-lookup"><span data-stu-id="5a9f9-201">**/Q** suppresses all prompts, such as password prompts.</span></span>  
  
 <span data-ttu-id="5a9f9-202">**/G**</span><span class="sxs-lookup"><span data-stu-id="5a9f9-202">**/G**</span></span>  
 <span data-ttu-id="5a9f9-203">Exécute **SQLdiag** en mode générique.</span><span class="sxs-lookup"><span data-stu-id="5a9f9-203">Runs **SQLdiag** in generic mode.</span></span> <span data-ttu-id="5a9f9-204">Quand l’option **/G** est spécifiée, **SQLdiag** n’effectue pas les contrôles de connectivité de [!INCLUDE[ssNoVersion](../includes/ssnoversion-md.md)] au démarrage. Il ne vérifie pas non plus l’adhésion de l’utilisateur au rôle de serveur fixe **sysadmin** .</span><span class="sxs-lookup"><span data-stu-id="5a9f9-204">When **/G** is specified, on startup **SQLdiag** does not enforce [!INCLUDE[ssNoVersion](../includes/ssnoversion-md.md)] connectivity checks or verify that the user is a member of the **sysadmin** fixed server role.</span></span> <span data-ttu-id="5a9f9-205">**SQLdiag** confie plutôt à Windows le soin de déterminer si un utilisateur dispose des droits appropriés pour collecter chacun des diagnostics demandés.</span><span class="sxs-lookup"><span data-stu-id="5a9f9-205">Instead, **SQLdiag** defers to Windows to determine whether a user has the appropriate rights to gather each requested diagnostic.</span></span>  
  
 <span data-ttu-id="5a9f9-206">Si l’option **/G** n’est pas spécifiée, **SQLdiag** détermine si l’utilisateur adhère au groupe **Administrateurs** de Windows et il ne collecte aucun diagnostic [!INCLUDE[ssNoVersion](../includes/ssnoversion-md.md)] s’il n’est pas membre du groupe **Administrateurs** .</span><span class="sxs-lookup"><span data-stu-id="5a9f9-206">If **/G** is not specified, **SQLdiag** checks to determine whether the user is a member of the Windows **Administrators** group, and will not collect [!INCLUDE[ssNoVersion](../includes/ssnoversion-md.md)] diagnostics if the user is not an **Administrators** group member.</span></span>  
  
 <span data-ttu-id="5a9f9-207">**/R**</span><span class="sxs-lookup"><span data-stu-id="5a9f9-207">**/R**</span></span>  
 <span data-ttu-id="5a9f9-208">Inscrit **SQLdiag** en tant que service.</span><span class="sxs-lookup"><span data-stu-id="5a9f9-208">Registers **SQLdiag** as a service.</span></span> <span data-ttu-id="5a9f9-209">Tous les arguments de ligne de commande qui sont spécifiés à l’inscription de **SQLdiag** en tant que service sont conservés pour de futures exécutions du service.</span><span class="sxs-lookup"><span data-stu-id="5a9f9-209">Any command line arguments that are specified when you register **SQLdiag** as a service are preserved for future runs of the service.</span></span>  
  
 <span data-ttu-id="5a9f9-210">Quand **SQLdiag** est inscrit comme service, le nom du service par défaut est SQLDIAG.</span><span class="sxs-lookup"><span data-stu-id="5a9f9-210">When **SQLdiag** is registered as a service, the default service name is SQLDIAG.</span></span> <span data-ttu-id="5a9f9-211">Vous pouvez modifiez ce nom au moyen de l’argument **/A** .</span><span class="sxs-lookup"><span data-stu-id="5a9f9-211">You can change the service name by using the **/A** argument.</span></span>  
  
 <span data-ttu-id="5a9f9-212">Utilisez l'argument de ligne de commande **START** pour démarrer le service.</span><span class="sxs-lookup"><span data-stu-id="5a9f9-212">Use the **START** command line argument to start the service:</span></span>  
  
 <span data-ttu-id="5a9f9-213">**SQLDIAG START**</span><span class="sxs-lookup"><span data-stu-id="5a9f9-213">**SQLDIAG START**</span></span>  
  
 <span data-ttu-id="5a9f9-214">Vous pouvez également utiliser la commande **net start** pour démarrer le service.</span><span class="sxs-lookup"><span data-stu-id="5a9f9-214">You can also use the **net start** command to start the service:</span></span>  
  
 <span data-ttu-id="5a9f9-215">**NET START SQLDIAG**</span><span class="sxs-lookup"><span data-stu-id="5a9f9-215">**net start SQLDIAG**</span></span>  
  
 <span data-ttu-id="5a9f9-216">**/U**</span><span class="sxs-lookup"><span data-stu-id="5a9f9-216">**/U**</span></span>  
 <span data-ttu-id="5a9f9-217">Annule l’inscription de **SQLdiag** en tant que service.</span><span class="sxs-lookup"><span data-stu-id="5a9f9-217">Unregisters **SQLdiag** as a service.</span></span>  
  
 <span data-ttu-id="5a9f9-218">Utilisez également l’argument **/A** si vous annulez l’inscription d’une instance **SQLdiag** nommée.</span><span class="sxs-lookup"><span data-stu-id="5a9f9-218">Use the **/A** argument also if unregistering a named **SQLdiag** instance.</span></span>  
  
 <span data-ttu-id="5a9f9-219">**/L**</span><span class="sxs-lookup"><span data-stu-id="5a9f9-219">**/L**</span></span>  
 <span data-ttu-id="5a9f9-220">Exécute **SQLdiag** en mode continu quand une heure de début ou de fin est également indiquée respectivement par le biais des arguments **/B** ou **/E** .</span><span class="sxs-lookup"><span data-stu-id="5a9f9-220">Runs **SQLdiag** in continuous mode when a start time or end time is also specified with the **/B** or **/E** arguments, respectively.</span></span> <span data-ttu-id="5a9f9-221">**SQLdiag** redémarre automatiquement après l’arrêt de la collecte des diagnostics en raison d’un arrêt programmé.</span><span class="sxs-lookup"><span data-stu-id="5a9f9-221">**SQLdiag** automatically restarts after diagnostics collection stops due to a scheduled shutdown.</span></span> <span data-ttu-id="5a9f9-222">Par exemple, en utilisant les arguments **/E** ou **/X** .</span><span class="sxs-lookup"><span data-stu-id="5a9f9-222">For example, by using the **/E** or the **/X** arguments.</span></span>  
  
> [!NOTE]  
>  <span data-ttu-id="5a9f9-223">**SQLdiag** ignore l’argument **/L** si aucune heure de début ni de fin n’est spécifiée à l’aide des arguments de ligne de commande **/B** et **/E** .</span><span class="sxs-lookup"><span data-stu-id="5a9f9-223">**SQLdiag** ignores the **/L** argument if a start time or end time is not specified by using the **/B** and **/E** command line arguments.</span></span>  
  
 <span data-ttu-id="5a9f9-224">L’utilisation de **/L** n’implique aucunement le mode service.</span><span class="sxs-lookup"><span data-stu-id="5a9f9-224">Using **/L** does not imply the service mode.</span></span> <span data-ttu-id="5a9f9-225">Pour utiliser **/L** quand vous exécutez **SQLdiag** en tant que service, spécifiez cet argument sur la ligne de commande au moment de l’inscription du service.</span><span class="sxs-lookup"><span data-stu-id="5a9f9-225">To use **/L** when running **SQLdiag** as a service, specify it on the command line when you register the service.</span></span>  
  
 <span data-ttu-id="5a9f9-226">**/X**</span><span class="sxs-lookup"><span data-stu-id="5a9f9-226">**/X**</span></span>  
 <span data-ttu-id="5a9f9-227">Exécute **SQLdiag** en mode d’instantané.</span><span class="sxs-lookup"><span data-stu-id="5a9f9-227">Runs **SQLdiag** in snapshot mode.</span></span> <span data-ttu-id="5a9f9-228">**SQLdiag** effectue un instantané de tous les diagnostics configurés, puis s’arrête automatiquement.</span><span class="sxs-lookup"><span data-stu-id="5a9f9-228">**SQLdiag** takes a snapshot of all configured diagnostics and then shuts down automatically.</span></span>  
  
 <span data-ttu-id="5a9f9-229">**START** | **STOP** | **STOP_ABORT**</span><span class="sxs-lookup"><span data-stu-id="5a9f9-229">**START** | **STOP** | **STOP_ABORT**</span></span>  
 <span data-ttu-id="5a9f9-230">Démarre ou arrête le service **SQLdiag** .</span><span class="sxs-lookup"><span data-stu-id="5a9f9-230">Starts or stops the **SQLdiag** service.</span></span> <span data-ttu-id="5a9f9-231">**STOP_ABORT** oblige le service à s’arrêter le plus rapidement possible, sans terminer la collecte de diagnostics en cours.</span><span class="sxs-lookup"><span data-stu-id="5a9f9-231">**STOP_ABORT** forces the service to shut down as quickly as possible without finishing collection of diagnostics it is currently collecting.</span></span>  
  
 <span data-ttu-id="5a9f9-232">Lorsqu'ils sont utilisés ces arguments destinés au contrôle du service doivent être placés en premier sur les lignes de commande.</span><span class="sxs-lookup"><span data-stu-id="5a9f9-232">When these service control arguments are used, they must be the first argument used on the command line.</span></span> <span data-ttu-id="5a9f9-233">Par exemple :</span><span class="sxs-lookup"><span data-stu-id="5a9f9-233">For example:</span></span>  
  
 <span data-ttu-id="5a9f9-234">**SQLDIAG START**</span><span class="sxs-lookup"><span data-stu-id="5a9f9-234">**SQLDIAG START**</span></span>  
  
 <span data-ttu-id="5a9f9-235">Seul l’argument **/A** , qui spécifie une instance nommée de **SQLdiag**, peut être utilisé avec **START**, **STOP**ou **STOP_ABORT** pour prendre le contrôle d’une instance spécifique du service **SQLdiag** .</span><span class="sxs-lookup"><span data-stu-id="5a9f9-235">Only the **/A** argument, which specifies a named instance of **SQLdiag**, can be used with **START**, **STOP**, or **STOP_ABORT** to control a specific instance of the **SQLdiag** service.</span></span> <span data-ttu-id="5a9f9-236">Par exemple :</span><span class="sxs-lookup"><span data-stu-id="5a9f9-236">For example:</span></span>  
  
 <span data-ttu-id="5a9f9-237">**SQLDIAG START /A** _SQLdiag_application_name_</span><span class="sxs-lookup"><span data-stu-id="5a9f9-237">**SQLDIAG START /A** _SQLdiag_application_name_</span></span>  
  
## <a name="security-requirements"></a><span data-ttu-id="5a9f9-238">Spécifications de sécurité</span><span class="sxs-lookup"><span data-stu-id="5a9f9-238">Security Requirements</span></span>  
 <span data-ttu-id="5a9f9-239">Sauf si **SQLdiag** est exécuté en mode générique (avec l’argument de ligne de commande **/G** ), l’utilisateur qui exécute **SQLdiag** doit être membre du groupe **Administrateurs** de Windows et membre du rôle serveur fixe [!INCLUDE[ssNoVersion](../includes/ssnoversion-md.md)] **sysadmin**.</span><span class="sxs-lookup"><span data-stu-id="5a9f9-239">Unless **SQLdiag** is run in generic mode (by specifying the **/G** command line argument), the user who runs **SQLdiag** must be a member of the Windows **Administrators** group and a member of the [!INCLUDE[ssNoVersion](../includes/ssnoversion-md.md)] **sysadmin** fixed server role.</span></span> <span data-ttu-id="5a9f9-240">Par défaut, **SQLdiag** établit la connexion à [!INCLUDE[ssNoVersion](../includes/ssnoversion-md.md)] en utilisant l’authentification Windows, mais il prend également en charge l’authentification [!INCLUDE[ssNoVersion](../includes/ssnoversion-md.md)] .</span><span class="sxs-lookup"><span data-stu-id="5a9f9-240">By default, **SQLdiag** connects to [!INCLUDE[ssNoVersion](../includes/ssnoversion-md.md)] by using Windows Authentication, but it also supports [!INCLUDE[ssNoVersion](../includes/ssnoversion-md.md)] Authentication.</span></span>  
  
## <a name="performance-considerations"></a><span data-ttu-id="5a9f9-241">Considérations relatives aux performances</span><span class="sxs-lookup"><span data-stu-id="5a9f9-241">Performance Considerations</span></span>  
 <span data-ttu-id="5a9f9-242">Les effets sur les performances de l’exécution de **SQLdiag** varient selon le type de données de diagnostics dont vous avez configuré la collecte.</span><span class="sxs-lookup"><span data-stu-id="5a9f9-242">The performance effects of running **SQLdiag** depend on the type of diagnostic data you have configured it to collect.</span></span> <span data-ttu-id="5a9f9-243">Par exemple, si la configuration de **SQLdiag** prévoit la collecte d’informations de suivi de trace de [!INCLUDE[ssSqlProfiler](../includes/sssqlprofiler-md.md)] , les performances du serveur se trouveront affectées proportionnellement au nombre de classes d’événements à tracer.</span><span class="sxs-lookup"><span data-stu-id="5a9f9-243">For example, if you have configured **SQLdiag** to collect [!INCLUDE[ssSqlProfiler](../includes/sssqlprofiler-md.md)] tracing information, the more event classes you choose to trace, the more your server performance is affected.</span></span>  
  
 <span data-ttu-id="5a9f9-244">L’impact sur les performances d’exécution de **SQLdiag** équivaut approximativement à la somme des coûts de collecte des diagnostics configurés séparément.</span><span class="sxs-lookup"><span data-stu-id="5a9f9-244">The performance impact of running **SQLdiag** is approximately equivalent to the sum of the costs of collecting the configured diagnostics separately.</span></span> <span data-ttu-id="5a9f9-245">Par exemple, la collecte d’une trace avec **SQLdiag** implique le même coût de performances que sa collecte avec [!INCLUDE[ssSqlProfiler](../includes/sssqlprofiler-md.md)].</span><span class="sxs-lookup"><span data-stu-id="5a9f9-245">For example, collecting a trace with **SQLdiag** incurs the same performance cost as collecting it with [!INCLUDE[ssSqlProfiler](../includes/sssqlprofiler-md.md)].</span></span> <span data-ttu-id="5a9f9-246">L’impact sur les performances d’utilisation de **SQLdiag** est négligeable.</span><span class="sxs-lookup"><span data-stu-id="5a9f9-246">The performance impact of using **SQLdiag** is negligible.</span></span>  
  
## <a name="required-disk-space"></a><span data-ttu-id="5a9f9-247">Espace disque requis</span><span class="sxs-lookup"><span data-stu-id="5a9f9-247">Required Disk Space</span></span>  
 <span data-ttu-id="5a9f9-248">Comme **SQLdiag** peut recueillir différents types d’informations de diagnostics, l’espace disque libre requis pour exécuter **SQLdiag** est variable.</span><span class="sxs-lookup"><span data-stu-id="5a9f9-248">Because **SQLdiag** can collect different types of diagnostic information, the free disk space that is required to run **SQLdiag** varies.</span></span> <span data-ttu-id="5a9f9-249">La quantité d'informations de diagnostics recueillies dépend de la nature et du volume de la charge de travail que le serveur traite et peut être comprise entre quelques mégaoctets et plusieurs gigaoctets.</span><span class="sxs-lookup"><span data-stu-id="5a9f9-249">The amount of diagnostic information collected depends on the nature and volume of the workload that the server is processing and may range from a few megabytes to several gigabytes.</span></span>  
  
## <a name="configuration-files"></a><span data-ttu-id="5a9f9-250">Fichiers de configuration</span><span class="sxs-lookup"><span data-stu-id="5a9f9-250">Configuration Files</span></span>  
 <span data-ttu-id="5a9f9-251">Au démarrage, **SQLdiag** lit le fichier de configuration et les arguments de ligne de commande qui ont été spécifiés.</span><span class="sxs-lookup"><span data-stu-id="5a9f9-251">On startup, **SQLdiag** reads the configuration file and the command line arguments that have been specified.</span></span> <span data-ttu-id="5a9f9-252">Vous spécifiez les types d’informations de diagnostics que **SQLdiag** collecte dans le fichier de configuration.</span><span class="sxs-lookup"><span data-stu-id="5a9f9-252">You specify the types of diagnostic information that **SQLdiag** collects in the configuration file.</span></span> <span data-ttu-id="5a9f9-253">Par défaut, **SQLdiag** utilise le fichier de configuration SQLDiag.Xml ; ce fichier, extrait chaque fois que l’outil s’exécute, se trouve dans le dossier de démarrage de l’utilitaire **SQLdiag** .</span><span class="sxs-lookup"><span data-stu-id="5a9f9-253">By default, **SQLdiag** uses the SQLDiag.Xml configuration file, which is extracted each time the tool runs and is located in the **SQLdiag** utility startup folder.</span></span> <span data-ttu-id="5a9f9-254">Le fichier de configuration utilise le schéma XML, SQLDiag_schema.xsd, qui est également extrait à partir du fichier exécutable dans le répertoire de démarrage de l’utilitaire chaque fois que **SQLdiag** s’exécute.</span><span class="sxs-lookup"><span data-stu-id="5a9f9-254">The configuration file uses the XML schema, SQLDiag_schema.xsd, which is also extracted into the utility startup directory from the executable file each time **SQLdiag** runs.</span></span>  
  
### <a name="editing-the-configuration-files"></a><span data-ttu-id="5a9f9-255">Modification des fichiers de configuration</span><span class="sxs-lookup"><span data-stu-id="5a9f9-255">Editing the Configuration Files</span></span>  
 <span data-ttu-id="5a9f9-256">Vous pouvez copier et modifier SQLDiag.Xml pour changer les types de données de diagnostics collectées par **SQLdiag** .</span><span class="sxs-lookup"><span data-stu-id="5a9f9-256">You can copy and edit SQLDiag.Xml to change the types of diagnostic data that **SQLdiag** collects.</span></span> <span data-ttu-id="5a9f9-257">Lors de la modification du fichier de configuration, utilisez toujours un éditeur XML pouvant valider le fichier de configuration par rapport à son schéma XML, par exemple [!INCLUDE[ssManStudio](../includes/ssmanstudio-md.md)].</span><span class="sxs-lookup"><span data-stu-id="5a9f9-257">When editing the configuration file always use an XML editor that can validate the configuration file against its XML schema, such as [!INCLUDE[ssManStudio](../includes/ssmanstudio-md.md)].</span></span> <span data-ttu-id="5a9f9-258">Ne modifiez pas SQLDiag.Xml directement.</span><span class="sxs-lookup"><span data-stu-id="5a9f9-258">You should not edit SQLDiag.Xml directly.</span></span> <span data-ttu-id="5a9f9-259">Effectuez plutôt une copie de SQLDiag.Xml dans le même dossier et attribuez-lui un nouveau nom.</span><span class="sxs-lookup"><span data-stu-id="5a9f9-259">Instead, make a copy of SQLDiag.Xml and rename it to a new file name in the same folder.</span></span> <span data-ttu-id="5a9f9-260">Ensuite, modifiez le nouveau fichier et utilisez l’argument **/I** pour le passer à **SQLdiag**.</span><span class="sxs-lookup"><span data-stu-id="5a9f9-260">Then edit the new file, and use the **/I** argument to pass it to **SQLdiag**.</span></span>  
  
#### <a name="editing-the-configuration-file-when-sqldiag-runs-as-a-service"></a><span data-ttu-id="5a9f9-261">Modification du fichier de configuration lors de l'exécution de SQLdiag en tant que service</span><span class="sxs-lookup"><span data-stu-id="5a9f9-261">Editing the Configuration File When SQLdiag Runs as a Service</span></span>  
 <span data-ttu-id="5a9f9-262">Si vous avez déjà exécuté **SQLdiag** en tant que service et que vous devez modifier le fichier de configuration, annulez l’inscription du service SQLDIAG en spécifiant l’argument de ligne de commande **/U** , puis réinscrivez le service avec l’argument de ligne de commande **/R** .</span><span class="sxs-lookup"><span data-stu-id="5a9f9-262">If you have already run **SQLdiag** as a service and need to edit the configuration file, unregister the SQLDIAG service by specifying the **/U** command line argument and then re-register the service by using the **/R** command line argument.</span></span> <span data-ttu-id="5a9f9-263">L'annulation de l'inscription du service puis sa réinscription supprime les anciennes informations de configuration mises en mémoire cache dans le Registre Windows.</span><span class="sxs-lookup"><span data-stu-id="5a9f9-263">Unregistering and re-registering the service removes old configuration information that was cached in the Windows registry.</span></span>  
  
## <a name="output-folder"></a><span data-ttu-id="5a9f9-264">Dossier de sortie</span><span class="sxs-lookup"><span data-stu-id="5a9f9-264">Output Folder</span></span>  
 <span data-ttu-id="5a9f9-265">Si vous ne spécifiez pas de dossier de sortie avec l’argument **/O** , **SQLdiag** crée un sous-dossier nommé SQLDIAG sous le dossier de démarrage de **SQLdiag** .</span><span class="sxs-lookup"><span data-stu-id="5a9f9-265">If you do not specify an output folder with the **/O** argument, **SQLdiag** creates a subfolder named SQLDIAG under the **SQLdiag** startup folder.</span></span> <span data-ttu-id="5a9f9-266">Pour la collecte d'informations de diagnostics impliquant un suivi à grand volume, tel que [!INCLUDE[ssSqlProfiler](../includes/sssqlprofiler-md.md)] , assurez-vous que le dossier de sortie se trouve sur un lecteur local offrant suffisamment d'espace pour stocker la sortie de diagnostics demandée.</span><span class="sxs-lookup"><span data-stu-id="5a9f9-266">For diagnostic information collection that involves high volume tracing, such as [!INCLUDE[ssSqlProfiler](../includes/sssqlprofiler-md.md)] , make sure that the output folder is on a local drive with enough space to store the requested diagnostic output.</span></span>  
  
 <span data-ttu-id="5a9f9-267">Quand il est redémarré, **SQLdiag** remplace le contenu du dossier de sortie.</span><span class="sxs-lookup"><span data-stu-id="5a9f9-267">When **SQLdiag** is restarted, it overwrites the contents of the output folder.</span></span> <span data-ttu-id="5a9f9-268">Pour éviter cela, spécifiez **/N 2** sur la ligne de commande.</span><span class="sxs-lookup"><span data-stu-id="5a9f9-268">To avoid this, specify **/N 2** on the command line.</span></span>  
  
## <a name="data-collection-process"></a><span data-ttu-id="5a9f9-269">Processus de collecte de données</span><span class="sxs-lookup"><span data-stu-id="5a9f9-269">Data Collection Process</span></span>  
 <span data-ttu-id="5a9f9-270">Quand **SQLdiag** démarre, il effectue les contrôles d’initialisation nécessaires pour collecter les données de diagnostics qui ont été spécifiées dans SQLDiag.Xml.</span><span class="sxs-lookup"><span data-stu-id="5a9f9-270">When **SQLdiag** starts, it performs the initialization checks necessary to collect the diagnostic data that have been specified in SQLDiag.Xml.</span></span> <span data-ttu-id="5a9f9-271">Ce processus peut prendre plusieurs secondes.</span><span class="sxs-lookup"><span data-stu-id="5a9f9-271">This process may take several seconds.</span></span> <span data-ttu-id="5a9f9-272">Une fois que **SQLdiag** a démarré la collecte de données de diagnostics quand il est exécuté en tant qu’application de console, un message s’affiche pour vous signaler que la collecte de **SQLdiag** a commencé et que vous pouvez appuyer sur Ctrl+C pour l’arrêter.</span><span class="sxs-lookup"><span data-stu-id="5a9f9-272">After **SQLdiag** has started collecting diagnostic data when it is run as a console application, a message displays informing you that **SQLdiag** collection has started and that you can press CTRL+C to stop it.</span></span> <span data-ttu-id="5a9f9-273">Quand **SQLdiag** est exécuté en tant que service, un message similaire est écrit dans le journal d’événements de Windows.</span><span class="sxs-lookup"><span data-stu-id="5a9f9-273">When **SQLdiag** is run as a service, a similar message is written to the Windows event log.</span></span>  
  
 <span data-ttu-id="5a9f9-274">Si vous utilisez **SQLdiag** pour diagnostiquer un problème que vous pouvez reproduire, attendez la réception de ce message avant de reproduire le problème sur votre serveur.</span><span class="sxs-lookup"><span data-stu-id="5a9f9-274">If you are using **SQLdiag** to diagnose a problem that you can reproduce, wait until you receive this message before you reproduce the problem on your server.</span></span>  
  
 <span data-ttu-id="5a9f9-275">**SQLdiag** collecte la plupart des données de diagnostics en parallèle.</span><span class="sxs-lookup"><span data-stu-id="5a9f9-275">**SQLdiag** collects most diagnostic data in parallel.</span></span> <span data-ttu-id="5a9f9-276">Toutes les informations de diagnostics sont collectées en se connectant à des outils, tels que l’utilitaire [!INCLUDE[ssNoVersion](../includes/ssnoversion-md.md)] **sqlcmd** ou le processeur de commandes Windows, sauf quand des informations sont recueillies à partir des journaux de performances et des journaux d’événements de Windows.</span><span class="sxs-lookup"><span data-stu-id="5a9f9-276">All diagnostic information is collected by connecting to tools, such as the [!INCLUDE[ssNoVersion](../includes/ssnoversion-md.md)] **sqlcmd** utility or the Windows command processor, except when information is collected from Windows performance logs and event logs.</span></span> <span data-ttu-id="5a9f9-277">**SQLdiag** utilise un thread de travail par ordinateur pour contrôler la collecte de données de diagnostics de ces autres outils, attendant souvent simultanément la fin de l’exécution de plusieurs outils.</span><span class="sxs-lookup"><span data-stu-id="5a9f9-277">**SQLdiag** uses one worker thread per computer to monitor the diagnostic data collection of these other tools, often simultaneously waiting for several tools to complete.</span></span> <span data-ttu-id="5a9f9-278">Pendant le processus de collecte, **SQLdiag** achemine les résultats de chaque diagnostic dans le dossier de sortie.</span><span class="sxs-lookup"><span data-stu-id="5a9f9-278">During the collection process, **SQLdiag** routes the output from each diagnostic to the output folder.</span></span>  
  
## <a name="stopping-data-collection"></a><span data-ttu-id="5a9f9-279">Arrêt de la collecte de données</span><span class="sxs-lookup"><span data-stu-id="5a9f9-279">Stopping Data Collection</span></span>  
 <span data-ttu-id="5a9f9-280">Une fois que **SQLdiag** a démarré la collecte de données de diagnostics, il poursuit celle-ci sauf si vous l’arrêtez ou s’il est configuré pour s’arrêter à une heure spécifiée.</span><span class="sxs-lookup"><span data-stu-id="5a9f9-280">After **SQLdiag** starts collecting diagnostic data, it continues to do so unless you stop it or it is configured to stop at a specified time.</span></span> <span data-ttu-id="5a9f9-281">Vous pouvez configurer **SQLdiag** pour s’arrêter à une heure spécifique avec l’argument **/E** , qui permet de spécifier une heure d’arrêt ou avec l’argument **/X** , qui force l’exécution de **SQLdiag** en mode d’instantané.</span><span class="sxs-lookup"><span data-stu-id="5a9f9-281">You can configure **SQLdiag** to stop at a specified time by using the **/E** argument, which allows you to specify a stop time, or by using the **/X** argument, which causes **SQLdiag** to run in snapshot mode.</span></span>  
  
 <span data-ttu-id="5a9f9-282">Quand **SQLdiag** s’arrête, il arrête tous les diagnostics qu’il a commencés.</span><span class="sxs-lookup"><span data-stu-id="5a9f9-282">When **SQLdiag** stops, it stops all diagnostics it has started.</span></span> <span data-ttu-id="5a9f9-283">Par exemple, il arrête les traces du [!INCLUDE[ssSqlProfiler](../includes/sssqlprofiler-md.md)] dont il assurait la collecte, interrompt également les scripts [!INCLUDE[tsql](../includes/tsql-md.md)] en cours d'exécution ainsi que tous les sous-processus qu'il a générés pendant la collecte des données.</span><span class="sxs-lookup"><span data-stu-id="5a9f9-283">For example, it stops [!INCLUDE[ssSqlProfiler](../includes/sssqlprofiler-md.md)] traces it was collecting, it stops executing [!INCLUDE[tsql](../includes/tsql-md.md)] scripts it was running, and it stops any sub processes it has spawned during data collection.</span></span> <span data-ttu-id="5a9f9-284">Une fois la collecte des données de diagnostic terminée, **SQLdiag** prend fin.</span><span class="sxs-lookup"><span data-stu-id="5a9f9-284">After diagnostic data collection has completed, **SQLdiag** exits.</span></span>  
  
> [!NOTE]  
>  <span data-ttu-id="5a9f9-285">L’interruption du service **SQLdiag** n’est pas prise en charge.</span><span class="sxs-lookup"><span data-stu-id="5a9f9-285">Pausing the **SQLdiag** service is not supported.</span></span> <span data-ttu-id="5a9f9-286">Si vous tentez de suspendre le service **SQLdiag** , il s’arrête seulement après avoir fini la collecte des diagnostics qui était en cours au moment où vous l’avez interrompu.</span><span class="sxs-lookup"><span data-stu-id="5a9f9-286">If you attempt to pause the **SQLdiag** service, it stops after it finishes collecting the diagnostics that it was collecting when you paused it.</span></span> <span data-ttu-id="5a9f9-287">Si vous redémarrez **SQLdiag** suite à une interruption, l’application remplace le dossier de sortie en se lançant.</span><span class="sxs-lookup"><span data-stu-id="5a9f9-287">If you restart **SQLdiag** after stopping it, the application restarts and overwrites the output folder.</span></span> <span data-ttu-id="5a9f9-288">Pour éviter le remplacement de ce dossier, spécifiez **/N 2** sur la ligne de commande.</span><span class="sxs-lookup"><span data-stu-id="5a9f9-288">To avoid overwriting the output folder, specify **/N 2** on the command line.</span></span>  
  
 <span data-ttu-id="5a9f9-289">**Pour arrêter SQLdiag lorsqu'il s'exécute en tant qu'application console**</span><span class="sxs-lookup"><span data-stu-id="5a9f9-289">**To stop SQLdiag when running as a console application**</span></span>  
  
 <span data-ttu-id="5a9f9-290">Si vous exécutez **SQLdiag** en tant qu’application console, appuyez sur Ctrl+C dans la fenêtre de console où **SQLdiag** s’exécute pour l’arrêter.</span><span class="sxs-lookup"><span data-stu-id="5a9f9-290">If you are running **SQLdiag** as a console application, press CTRL+C in the console window where **SQLdiag** is running to stop it.</span></span> <span data-ttu-id="5a9f9-291">Une fois que vous avez appuyé sur Ctrl+C, un message s’affiche dans la fenêtre de console pour vous signaler que la collecte de données **SQLDiag** se termine et que vous devez attendre l’arrêt du processus, ce qui peut prendre plusieurs minutes.</span><span class="sxs-lookup"><span data-stu-id="5a9f9-291">After you press CTRL+C, a message displays in the console window informing you that **SQLDiag** data collection is ending, and that you should wait until the process shuts down, which may take several minutes.</span></span>  
  
 <span data-ttu-id="5a9f9-292">Appuyez deux fois sur les touches Ctrl+C pour mettre fin à tous les processus de diagnostics enfants et arrêter immédiatement l'application.</span><span class="sxs-lookup"><span data-stu-id="5a9f9-292">Press Ctrl+C twice to terminate all child diagnostic processes and immediately terminate the application.</span></span>  
  
 <span data-ttu-id="5a9f9-293">**Pour arrêter SQLdiag lorsqu'il s'exécute en tant que service**</span><span class="sxs-lookup"><span data-stu-id="5a9f9-293">**To stop SQLdiag when running as a service**</span></span>  
  
 <span data-ttu-id="5a9f9-294">Si vous exécutez **SQLdiag** en tant que service, exécutez **SQLDiag STOP** dans le dossier de démarrage **SQLdiag** pour l’arrêter.</span><span class="sxs-lookup"><span data-stu-id="5a9f9-294">If you are running **SQLdiag** as a service, run **SQLDiag STOP** in the **SQLdiag** startup folder to stop it.</span></span>  
  
 <span data-ttu-id="5a9f9-295">Si vous exécutez plusieurs instances de **SQLdiag** sur le même ordinateur, vous pouvez également mentionner le nom de l’instance **SQLdiag** sur la ligne de commande quand vous suspendez le service.</span><span class="sxs-lookup"><span data-stu-id="5a9f9-295">If you are running multiple instances of **SQLdiag** on the same computer, you can also pass the **SQLdiag** instance name to on the command line when you stop the service.</span></span> <span data-ttu-id="5a9f9-296">Utilisez, par exemple, la syntaxe suivante pour arrêter une instance **SQLdiag** nommée Instance1 :</span><span class="sxs-lookup"><span data-stu-id="5a9f9-296">For example, to stop a **SQLdiag** instance named Instance1, use the following syntax:</span></span>  
  
```  
SQLDIAG STOP /A Instance1  
```  
  
> [!NOTE]  
>  <span data-ttu-id="5a9f9-297">**/A** est le seul argument de ligne de commande pouvant être utilisé avec **START**, **STOP**ou **STOP_ABORT**.</span><span class="sxs-lookup"><span data-stu-id="5a9f9-297">**/A** is the only command-line argument that can be used with **START**, **STOP**, or **STOP_ABORT**.</span></span> <span data-ttu-id="5a9f9-298">Si vous devez spécifier une instance nommée de **SQLdiag** avec l’un des verbes de contrôle du service, placez **/A** après le verbe de contrôle sur la ligne de commande, comme illustré dans l’exemple de syntaxe précédent.</span><span class="sxs-lookup"><span data-stu-id="5a9f9-298">If you need to specify a named instance of **SQLdiag** with one of the service control verbs, specify **/A** after the control verb on the command line as shown in the previous syntax example.</span></span> <span data-ttu-id="5a9f9-299">Lorsqu'ils sont utilisés, les verbes de contrôle doivent impérativement occuper la place du premier argument sur une ligne de commande.</span><span class="sxs-lookup"><span data-stu-id="5a9f9-299">When control verbs are used, they must be the first argument on the command line.</span></span>  
  
 <span data-ttu-id="5a9f9-300">Pour arrêter le service le plus rapidement possible, exécutez **SQLDIAG STOP_ABORT** dans le dossier de démarrage de l’utilitaire.</span><span class="sxs-lookup"><span data-stu-id="5a9f9-300">To stop the service as quickly as possible, run **SQLDIAG STOP_ABORT** in the utility startup folder.</span></span> <span data-ttu-id="5a9f9-301">Cette commande interrompt toute collecte de diagnostics en cours d'exécution sans attendre que cette opération se termine.</span><span class="sxs-lookup"><span data-stu-id="5a9f9-301">This command aborts any diagnostics collecting currently being performed without waiting for them to finish.</span></span>  
  
> [!NOTE]  
>  <span data-ttu-id="5a9f9-302">Utilisez **SQLDiag STOP** ou **SQLDIAG STOP_ABORT** pour arrêter le service **SQLdiag** .</span><span class="sxs-lookup"><span data-stu-id="5a9f9-302">Use **SQLDiag STOP** or **SQLDIAG STOP_ABORT** to stop the **SQLdiag** service.</span></span> <span data-ttu-id="5a9f9-303">N’utilisez pas la console Services Windows pour arrêter **SQLdiag** ou d’autres services [!INCLUDE[ssNoVersion](../includes/ssnoversion-md.md)] .</span><span class="sxs-lookup"><span data-stu-id="5a9f9-303">Do not use the Windows Services Console to stop **SQLdiag** or other [!INCLUDE[ssNoVersion](../includes/ssnoversion-md.md)] services.</span></span>  
  
## <a name="automatically-starting-and-stopping-sqldiag"></a><span data-ttu-id="5a9f9-304">Démarrage et arrêt automatiques de SQLdiag</span><span class="sxs-lookup"><span data-stu-id="5a9f9-304">Automatically Starting and Stopping SQLdiag</span></span>  
 <span data-ttu-id="5a9f9-305">Pour démarrer et arrêter automatiquement la collecte des données de diagnostic à une heure spécifiée, utilisez les arguments **/b**_start_time_ et **/e**_stop_time_ , en utilisant une notation de 24 heures.</span><span class="sxs-lookup"><span data-stu-id="5a9f9-305">To automatically start and stop diagnostic data collection at a specified time, use the **/B**_start_time_ and **/E**_stop_time_ arguments, using 24-hour notation.</span></span> <span data-ttu-id="5a9f9-306">Par exemple, si vous dépannez un problème qui apparaît constamment vers 02:00:00, vous pouvez configurer **SQLdiag** pour qu’il démarre automatiquement la collecte de données de diagnostics à 01:00 et l’arrête à 03:00:00.</span><span class="sxs-lookup"><span data-stu-id="5a9f9-306">For example, if you are troubleshooting a problem that consistently appears at approximately 02:00:00, you can configure **SQLdiag** to automatically start collecting diagnostic data at 01:00 and automatically stop at 03:00:00.</span></span> <span data-ttu-id="5a9f9-307">Utilisez les arguments **/B** et **/E** pour spécifier les heures de début et de fin.</span><span class="sxs-lookup"><span data-stu-id="5a9f9-307">Use the **/B** and **/E** arguments to specify the start and stop time.</span></span> <span data-ttu-id="5a9f9-308">Utilisez la notation 24 heures pour spécifier des dates et heures précises de début et de fin au format AAAAMMJJ_HH:MM:SS.</span><span class="sxs-lookup"><span data-stu-id="5a9f9-308">Use 24-hour notation to specify an exact start and stop date and time with the format YYYYMMDD_HH:MM:SS.</span></span> <span data-ttu-id="5a9f9-309">Pour spécifier des heures de début et de fin relatives, utilisez le préfixe **+** devant ces heures et omettez la partie de la date (AAAAMMJJ_) comme dans l’exemple suivant, qui demande à **SQLdiag** d’attendre une heure avant de commencer la collecte d’informations, d’exécuter celle-ci pendant trois heures, puis de s’arrêter et de quitter :</span><span class="sxs-lookup"><span data-stu-id="5a9f9-309">To specify a relative start or stop time, prefix the start and stop time with **+** and omit the date portion (YYYYMMDD_) as shown in the following example, which causes **SQLdiag** to wait 1 hour before it starts collecting information, then it collects information for 3 hours before it stops and exits:</span></span>  
  
```  
sqldiag /B +01:00:00 /E +03:00:00  
```  
  
 <span data-ttu-id="5a9f9-310">Quand vous spécifiez une valeur *heure_début* relative, **SQLdiag** commence à une heure qui est cohérente par rapport à la date et l’heure actuelles.</span><span class="sxs-lookup"><span data-stu-id="5a9f9-310">When a relative *start_time* is specified, **SQLdiag** starts at a time that is relative to the current date and time.</span></span> <span data-ttu-id="5a9f9-311">Quand vous spécifiez une valeur *heure_fin* relative, **SQLdiag** se termine à une heure qui est chronologiquement cohérente par rapport à la valeur *heure_début*spécifiée.</span><span class="sxs-lookup"><span data-stu-id="5a9f9-311">When a relative *end_time* is specified, **SQLdiag** ends at a time that is relative to the specified *start_time*.</span></span> <span data-ttu-id="5a9f9-312">Si les dates ou heures de démarrage et d’arrêt que vous spécifiez se situent dans le passé, **SQLdiag** change la date de démarrage afin que la date et l’heure de démarrage se situent dans le futur.</span><span class="sxs-lookup"><span data-stu-id="5a9f9-312">If the start or end date and time that you have specified is in the past, **SQLdiag** forcibly changes the start date so that the start date and time are in the future.</span></span>  
  
 <span data-ttu-id="5a9f9-313">Ceci présente des implications importantes sur les dates de démarrage et d'arrêt que vous choisissez.</span><span class="sxs-lookup"><span data-stu-id="5a9f9-313">This has important implications on the start and end dates you choose.</span></span> <span data-ttu-id="5a9f9-314">Prenons l’exemple suivant :</span><span class="sxs-lookup"><span data-stu-id="5a9f9-314">Consider the following example:</span></span>  
  
```  
sqldiag /B +01:00:00 /E 08:30:00  
```  
  
 <span data-ttu-id="5a9f9-315">Si l'heure actuelle est 08:00, l'heure de fin arrive avant que ne commence la collecte du diagnostic.</span><span class="sxs-lookup"><span data-stu-id="5a9f9-315">If the current time is 08:00, the end time passes before diagnostic collection actually begins.</span></span> <span data-ttu-id="5a9f9-316">Comme **SQLDiag** règle automatiquement les dates de début et de fin au jour suivant quand elles se produisent dans le passé, dans cet exemple la collecte des diagnostics commence à 09:00 aujourd’hui (une heure de début relative a été spécifiée avec **+** ) et se poursuit jusqu’à 08:30 le lendemain matin.</span><span class="sxs-lookup"><span data-stu-id="5a9f9-316">Because **SQLDiag** automatically adjusts start and end dates to the next day when they occur in the past, in this example diagnostic collection starts at 09:00 today (a relative start time has been specified with **+**) and continues collecting until 08:30 the following morning.</span></span>  
  
### <a name="stopping-and-restarting-sqldiag-to-collect-daily-diagnostics"></a><span data-ttu-id="5a9f9-317">Arrêt et redémarrage de SQLdiag pour collecter des diagnostics quotidiennement</span><span class="sxs-lookup"><span data-stu-id="5a9f9-317">Stopping and Restarting SQLdiag to Collect Daily Diagnostics</span></span>  
 <span data-ttu-id="5a9f9-318">Pour collecter un ensemble de diagnostics sur une base quotidienne sans devoir démarrer et arrêter manuellement **SQLdiag**, utilisez l’argument **/L** .</span><span class="sxs-lookup"><span data-stu-id="5a9f9-318">To collect a specified set of diagnostics on a daily basis without having to manually start and stop **SQLdiag**, use the **/L** argument.</span></span> <span data-ttu-id="5a9f9-319">L’argument **/L** force **SQLdiag** à s’exécuter de façon continue en redémarrant automatiquement après un arrêt programmé.</span><span class="sxs-lookup"><span data-stu-id="5a9f9-319">The **/L** argument causes **SQLdiag** to run continuously by automatically restarting itself after a scheduled shutdown.</span></span> <span data-ttu-id="5a9f9-320">Quand vous spécifiez l’option **/L** et que **SQLdiag** s’arrête car il a atteint l’heure de fin définie avec l’argument **/E** , ou qu’il s’arrête car il s’exécute en mode d’instantané avec l’argument **/X** , **SQLdiag** redémarre au lieu de se fermer.</span><span class="sxs-lookup"><span data-stu-id="5a9f9-320">When **/L** is specified, and **SQLdiag** stops because it has reached the end time specified with the **/E** argument, or it stops because it is being run in snapshot mode by using the **/X** argument, **SQLdiag** restarts instead of exiting.</span></span>  
  
 <span data-ttu-id="5a9f9-321">L’exemple suivant spécifie que **SQLdiag** s’exécute en mode continu pour redémarrer automatiquement après une collecte de données de diagnostics effectuée entre 03:00:00 et 05:00:00.</span><span class="sxs-lookup"><span data-stu-id="5a9f9-321">The following example specifies that **SQLdiag** run in continuous mode to automatically restart after diagnostic data collecting occurs between 03:00:00 and 05:00:00.</span></span>  
  
```  
sqldiag /B 03:00:00 /E 05:00:00 /L  
```  
  
 <span data-ttu-id="5a9f9-322">L’exemple suivant spécifie que **SQLdiag** s’exécute en mode continu pour redémarrer automatiquement après un instantané de données de diagnostics à 03:00:00.</span><span class="sxs-lookup"><span data-stu-id="5a9f9-322">The following example specifies that **SQLdiag** run in continuous mode to automatically restart after taking a diagnostic data snapshot at 03:00:00.</span></span>  
  
```  
sqldiag /B 03:00:00 /X /L  
```  
  
## <a name="running-sqldiag-as-a-service"></a><span data-ttu-id="5a9f9-323">Exécution de SQLdiag en tant que service</span><span class="sxs-lookup"><span data-stu-id="5a9f9-323">Running SQLdiag as a Service</span></span>  
 <span data-ttu-id="5a9f9-324">Quand vous souhaitez utiliser **SQLdiag** pour collecter des données de diagnostics pendant de longues périodes durant lesquelles vous pourriez devoir vous déconnecter de l’ordinateur sur lequel s’exécute **SQLdiag** , vous pouvez l’exécuter en tant que service.</span><span class="sxs-lookup"><span data-stu-id="5a9f9-324">When you want to use **SQLdiag** to collect diagnostic data for long periods of time during which you might need to log out of the computer on which **SQLdiag** is running, you can run it as a service.</span></span>  
  
 <span data-ttu-id="5a9f9-325">**Pour inscrire SQLDiag afin qu'il s'exécute en tant que service**</span><span class="sxs-lookup"><span data-stu-id="5a9f9-325">**To register SQLDiag to run as a service**</span></span>  
  
 <span data-ttu-id="5a9f9-326">Vous pouvez inscrire **SQLdiag** pour qu’il s’exécute en tant que service en spécifiant l’argument **/R** sur la ligne de commande.</span><span class="sxs-lookup"><span data-stu-id="5a9f9-326">You can register **SQLdiag** to run as a service by specifying the **/R** argument at the command line.</span></span> <span data-ttu-id="5a9f9-327">Cet argument inscrit **SQLdiag** afin qu’il s’exécute en tant que service.</span><span class="sxs-lookup"><span data-stu-id="5a9f9-327">This registers **SQLdiag** to run as a service.</span></span> <span data-ttu-id="5a9f9-328">Le nom du service **SQLdiag** est SQLDIAG.</span><span class="sxs-lookup"><span data-stu-id="5a9f9-328">The **SQLdiag** service name is SQLDIAG.</span></span> <span data-ttu-id="5a9f9-329">Tous les autres arguments que vous spécifiez sur la ligne de commande quand vous inscrivez **SQLDiag** en tant que service sont préservés et réutilisés au démarrage du service.</span><span class="sxs-lookup"><span data-stu-id="5a9f9-329">Any other arguments you specify on the command line when you register **SQLDiag** as a service are preserved and reused when the service is started.</span></span>  
  
 <span data-ttu-id="5a9f9-330">Si vous voulez modifier le nom de service SQLDIAG par défaut, utilisez l’argument de ligne de commande **/A** pour spécifier un autre nom.</span><span class="sxs-lookup"><span data-stu-id="5a9f9-330">To change the default SQLDIAG service name, use the **/A** command-line argument to specify another name.</span></span> <span data-ttu-id="5a9f9-331">**SQLdiag** ajoute automatiquement le préfixe DIAG$ à tout nom d’instance **SQLdiag** spécifié à l’aide l’argument **/A** pour créer des noms de services explicites et pratiques d’utilisation.</span><span class="sxs-lookup"><span data-stu-id="5a9f9-331">**SQLdiag** automatically prefixes DIAG$ to any **SQLdiag** instance name specified with **/A** to create sensible service names.</span></span>  
  
 <span data-ttu-id="5a9f9-332">**Pour annuler l'instruction du service SQLDIAG**</span><span class="sxs-lookup"><span data-stu-id="5a9f9-332">**To unregister the SQLDIAG service**</span></span>  
  
 <span data-ttu-id="5a9f9-333">Pour annuler l’inscription du service, spécifiez l’argument **/U** .</span><span class="sxs-lookup"><span data-stu-id="5a9f9-333">To unregister the service, specify the **/U** argument.</span></span> <span data-ttu-id="5a9f9-334">L’annulation de l’inscription de **SQLdiag** en tant que service supprime également les clés de Registre Windows associées au service SQLDIAG.</span><span class="sxs-lookup"><span data-stu-id="5a9f9-334">Unregistering **SQLdiag** as a service also deletes the Windows registry keys of the service.</span></span>  
  
 <span data-ttu-id="5a9f9-335">**Pour démarrer ou redémarrer le service SQLDIAG**</span><span class="sxs-lookup"><span data-stu-id="5a9f9-335">**To start or restart the SQLDIAG service**</span></span>  
  
 <span data-ttu-id="5a9f9-336">Pour démarrer ou redémarrer le service SQLDIAG, exécutez **SQLDiag START** à partir de la ligne de commande.</span><span class="sxs-lookup"><span data-stu-id="5a9f9-336">To start or restart the SQLDIAG service, run **SQLDiag START** from the command line.</span></span>  
  
 <span data-ttu-id="5a9f9-337">Si vous exécutez plusieurs instances de **SQLdiag** par le biais de l’argument **/A** , vous pouvez également mentionner le nom de l’instance **SQLdiag** sur la ligne de commande quand vous démarrez le service.</span><span class="sxs-lookup"><span data-stu-id="5a9f9-337">If you are running multiple instances of **SQLdiag** by using the **/A** argument, you can also pass the **SQLdiag** instance name on the command line when you start the service.</span></span> <span data-ttu-id="5a9f9-338">Utilisez, par exemple, la syntaxe suivante pour démarrer une instance **SQLdiag** nommée Instance1 :</span><span class="sxs-lookup"><span data-stu-id="5a9f9-338">For example, to start a **SQLdiag** instance named Instance1, use the following syntax:</span></span>  
  
```  
SQLDIAG START /A Instance1  
```  
  
 <span data-ttu-id="5a9f9-339">Vous pouvez également utiliser la commande **net start** pour démarrer le service SQLDIAG.</span><span class="sxs-lookup"><span data-stu-id="5a9f9-339">You can also use the **net start** command to start the SQLDIAG service.</span></span>  
  
 <span data-ttu-id="5a9f9-340">Quand il est redémarré, **SQLdiag**remplace le contenu du dossier de sortie actif.</span><span class="sxs-lookup"><span data-stu-id="5a9f9-340">When you restart **SQLdiag**, it overwrites the contents in the current output folder.</span></span> <span data-ttu-id="5a9f9-341">Pour éviter cela, spécifiez **/N 2** sur la ligne de commande pour renommer le dossier de sortie au redémarrage de l’utilitaire.</span><span class="sxs-lookup"><span data-stu-id="5a9f9-341">To avoid this, specify **/N 2** on the command line to rename the output folder when the utility starts.</span></span>  
  
 <span data-ttu-id="5a9f9-342">L’interruption du service **SQLdiag** n’est pas prise en charge.</span><span class="sxs-lookup"><span data-stu-id="5a9f9-342">Pausing the **SQLdiag** service is not supported.</span></span>  
  
## <a name="running-multiple-instances-of-sqldiag"></a><span data-ttu-id="5a9f9-343">Exécution de plusieurs instances de SQLdiag</span><span class="sxs-lookup"><span data-stu-id="5a9f9-343">Running Multiple Instances of SQLdiag</span></span>  
 <span data-ttu-id="5a9f9-344">Exécutez plusieurs instances de **SQLdiag** sur le même ordinateur en spécifiant **/a**_SQLdiag_application_name_ sur la ligne de commande.</span><span class="sxs-lookup"><span data-stu-id="5a9f9-344">Run multiple instances of **SQLdiag** on the same computer by specifying **/A**_SQLdiag_application_name_ on the command line.</span></span> <span data-ttu-id="5a9f9-345">Ceci se révèle utile pour collecter différents jeux de diagnostics simultanément à partir de la même instance [!INCLUDE[ssNoVersion](../includes/ssnoversion-md.md)] .</span><span class="sxs-lookup"><span data-stu-id="5a9f9-345">This is useful for collecting different sets of diagnostics simultaneously from the same [!INCLUDE[ssNoVersion](../includes/ssnoversion-md.md)] instance.</span></span> <span data-ttu-id="5a9f9-346">Vous pouvez, par exemple, configurer une instance nommée de **SQLdiag** pour qu’elle assure en continu la collecte de données peu volumineuses.</span><span class="sxs-lookup"><span data-stu-id="5a9f9-346">For example, you can configure a named instance of **SQLdiag** to continuously perform lightweight data collection.</span></span> <span data-ttu-id="5a9f9-347">De cette façon, si un problème particulier survient sur [!INCLUDE[ssNoVersion](../includes/ssnoversion-md.md)], vous avez la possibilité d’exécuter l’instance **SQLdiag** par défaut pour collecter des diagnostics sur le problème ou réunir un jeu de diagnostics que les services d’assistance de [!INCLUDE[msCoName](../includes/msconame-md.md)] demanderont en vue d’émettre un diagnostic.</span><span class="sxs-lookup"><span data-stu-id="5a9f9-347">Then, if a specific problem occurs on [!INCLUDE[ssNoVersion](../includes/ssnoversion-md.md)], you can run the default **SQLdiag** instance to collect diagnostics for that problem, or to gather a set of diagnostics that [!INCLUDE[msCoName](../includes/msconame-md.md)] Customer Support Services has asked you to gather to diagnose a problem.</span></span>  
  
## <a name="collecting-diagnostic-data-from-clustered-sql-server-instances"></a><span data-ttu-id="5a9f9-348">Collecte de données de diagnostics à partir d'instances cluster de SQL Server</span><span class="sxs-lookup"><span data-stu-id="5a9f9-348">Collecting Diagnostic Data from Clustered SQL Server Instances</span></span>  
 <span data-ttu-id="5a9f9-349">**SQLdiag** prend en charge la collecte des données de diagnostics à partir d’instances cluster [!INCLUDE[ssNoVersion](../includes/ssnoversion-md.md)] .</span><span class="sxs-lookup"><span data-stu-id="5a9f9-349">**SQLdiag** supports collecting diagnostic data from clustered [!INCLUDE[ssNoVersion](../includes/ssnoversion-md.md)] instances.</span></span> <span data-ttu-id="5a9f9-350">Pour recueillir des diagnostics à partir d’instances de [!INCLUDE[ssNoVersion](../includes/ssnoversion-md.md)] en cluster, vérifiez que **« . »** est spécifié pour l’attribut **name** de l’élément **\<Machine>** dans le fichier de configuration de SQLDiag.Xml et ne spécifiez pas l’argument **/G** sur la ligne de commande.</span><span class="sxs-lookup"><span data-stu-id="5a9f9-350">To gather diagnostics from clustered [!INCLUDE[ssNoVersion](../includes/ssnoversion-md.md)] instances, make sure that **"."** is specified for the **name** attribute of the **\<Machine>** element in the configuration file SQLDiag.Xml and do not specify the **/G** argument on the command line.</span></span> <span data-ttu-id="5a9f9-351">Par défaut, **« . »** est spécifié pour l’attribut **name** dans le fichier de configuration et l’argument **/G** est désactivé.</span><span class="sxs-lookup"><span data-stu-id="5a9f9-351">By default, **"."** is specified for the **name** attribute in the configuration file and the **/G** argument is turned off.</span></span> <span data-ttu-id="5a9f9-352">Il n'est généralement pas nécessaire de modifier le fichier de configuration ni les arguments de ligne de commande lors d'une collecte effectuée à partir d'une instance cluster [!INCLUDE[ssNoVersion](../includes/ssnoversion-md.md)] .</span><span class="sxs-lookup"><span data-stu-id="5a9f9-352">Typically, you do not need to edit the configuration file or change the command line arguments when collecting from a clustered [!INCLUDE[ssNoVersion](../includes/ssnoversion-md.md)] instance.</span></span>  
  
 <span data-ttu-id="5a9f9-353">Quand **« . »** est spécifié comme nom d’ordinateur, **SQLdiag** détecte qu’il fonctionne sur un cluster et récupère simultanément les informations des diagnostics à partir de toutes les instances virtuelles de [!INCLUDE[ssNoVersion](../includes/ssnoversion-md.md)] installées sur ce cluster.</span><span class="sxs-lookup"><span data-stu-id="5a9f9-353">When **"."** is specified as the machine name, **SQLdiag** detects that it is running on a cluster, and simultaneously retrieves diagnostic information from all virtual instances of [!INCLUDE[ssNoVersion](../includes/ssnoversion-md.md)] that are installed on the cluster.</span></span> <span data-ttu-id="5a9f9-354">Pour collecter des informations de diagnostics à partir d’une seule instance virtuelle de [!INCLUDE[ssNoVersion](../includes/ssnoversion-md.md)] s’exécutant sur un ordinateur, spécifiez cette instance virtuelle de [!INCLUDE[ssNoVersion](../includes/ssnoversion-md.md)] pour l’attribut **name** de l’élément **\<Machine>** dans SQLDiag.Xml.</span><span class="sxs-lookup"><span data-stu-id="5a9f9-354">If you want to collect diagnostic information from only one virtual instance of [!INCLUDE[ssNoVersion](../includes/ssnoversion-md.md)] that is running on a computer, specify that virtual [!INCLUDE[ssNoVersion](../includes/ssnoversion-md.md)] for the **name** attribute of the **\<Machine>** element in SQLDiag.Xml.</span></span>  
  
> [!NOTE]  
>  <span data-ttu-id="5a9f9-355">Pour collecter des informations de traces de [!INCLUDE[ssSqlProfiler](../includes/sssqlprofiler-md.md)] à partir d'instances cluster [!INCLUDE[ssNoVersion](../includes/ssnoversion-md.md)] , les partages administratifs (ADMIN$) doivent être activés sur le cluster.</span><span class="sxs-lookup"><span data-stu-id="5a9f9-355">To collect [!INCLUDE[ssSqlProfiler](../includes/sssqlprofiler-md.md)] trace information from clustered [!INCLUDE[ssNoVersion](../includes/ssnoversion-md.md)] instances, administrative shares (ADMIN$) must be enabled on the cluster.</span></span>  
  
## <a name="see-also"></a><span data-ttu-id="5a9f9-356">Voir aussi</span><span class="sxs-lookup"><span data-stu-id="5a9f9-356">See Also</span></span>  
 [<span data-ttu-id="5a9f9-357">Référence de l’utilitaire d’invite de commandes &#40;moteur de base de données&#41;</span><span class="sxs-lookup"><span data-stu-id="5a9f9-357">Command Prompt Utility Reference &#40;Database Engine&#41;</span></span>](command-prompt-utility-reference-database-engine.md)  
  
  
