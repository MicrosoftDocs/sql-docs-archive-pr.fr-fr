---
title: Analyser les blocages avec SQL Server Profiler | Microsoft Docs
ms.custom: ''
ms.date: 03/06/2017
ms.prod: sql-server-2014
ms.reviewer: ''
ms.technology: profiler
ms.topic: conceptual
helpviewer_keywords:
- process nodes [SQL Server Profiler]
- Profiler [SQL Server Profiler], deadlocks
- deadlocks [SQL Server], identifying cause
- resource nodes [SQL Server Profiler]
- graphs [SQL Server Profiler]
- SQL Server Profiler, deadlocks
- events [SQL Server], deadlocks
- edges [SQL Server Profiler]
ms.assetid: 72d6718f-501b-4ea6-b344-c0e653f19561
author: stevestein
ms.author: sstein
ms.openlocfilehash: 3414cda74d75dbacf10ed98b6fc6d50da2feaa18
ms.sourcegitcommit: ad4d92dce894592a259721a1571b1d8736abacdb
ms.translationtype: MT
ms.contentlocale: fr-FR
ms.lasthandoff: 08/04/2020
ms.locfileid: "87694975"
---
# <a name="analyze-deadlocks-with-sql-server-profiler"></a><span data-ttu-id="aaf64-102">Analyser des blocages à l'aide de SQL Server Profiler</span><span class="sxs-lookup"><span data-stu-id="aaf64-102">Analyze Deadlocks with SQL Server Profiler</span></span>
  <span data-ttu-id="aaf64-103">Utilisez le [!INCLUDE[ssSqlProfiler](../../includes/sssqlprofiler-md.md)] pour identifier la cause d'un interblocage.</span><span class="sxs-lookup"><span data-stu-id="aaf64-103">Use [!INCLUDE[ssSqlProfiler](../../includes/sssqlprofiler-md.md)] to identify the cause of a deadlock.</span></span> <span data-ttu-id="aaf64-104">Un interblocage se produit quand il y a une dépendance cyclique entre au moins deux threads ou processus pour un jeu de ressources dans SQL Server.</span><span class="sxs-lookup"><span data-stu-id="aaf64-104">A deadlock occurs when there is a cyclic dependency between two or more threads, or processes, for some set of resources within SQL Server.</span></span> <span data-ttu-id="aaf64-105">Le [!INCLUDE[ssSqlProfiler](../../includes/sssqlprofiler-md.md)]vous permet de créer une trace qui enregistre, relit et affiche les événements de blocage dans le cadre d'une analyse.</span><span class="sxs-lookup"><span data-stu-id="aaf64-105">Using [!INCLUDE[ssSqlProfiler](../../includes/sssqlprofiler-md.md)], you can create a trace that records, replays, and displays deadlock events for analysis.</span></span>  
  
 <span data-ttu-id="aaf64-106">Pour tracer les événements de blocage, ajoutez la classe d’événements **Deadlock graph** à une trace.</span><span class="sxs-lookup"><span data-stu-id="aaf64-106">To trace deadlock events, add the **Deadlock graph** event class to a trace.</span></span> <span data-ttu-id="aaf64-107">Cette classe d’événements remplit la colonne de données **TextData** dans la trace avec des données XML relatives aux processus et objets impliqués dans le blocage.</span><span class="sxs-lookup"><span data-stu-id="aaf64-107">This event class populates the **TextData** data column in the trace with XML data about the process and objects that are involved in the deadlock.</span></span> [!INCLUDE[ssSqlProfiler](../../includes/sssqlprofiler-md.md)] <span data-ttu-id="aaf64-108">peut extraire le document XML dans un fichier XML de blocages (.xdl) que vous pouvez afficher ultérieurement dans SQL Server Management Studio.</span><span class="sxs-lookup"><span data-stu-id="aaf64-108">can extract the XML document to a deadlock XML (.xdl) file which you can view later in SQL Server Management Studio.</span></span> <span data-ttu-id="aaf64-109">Vous pouvez configurer le [!INCLUDE[ssSqlProfiler](../../includes/sssqlprofiler-md.md)] de manière à extraire les événements **Deadlock graph** vers un fichier unique contenant tous les événements **Deadlock graph** , ou bien vers des fichiers distincts.</span><span class="sxs-lookup"><span data-stu-id="aaf64-109">You can configure [!INCLUDE[ssSqlProfiler](../../includes/sssqlprofiler-md.md)] to extract **Deadlock graph** events to a single file that contains all **Deadlock graph** events, or to separate files.</span></span> <span data-ttu-id="aaf64-110">Cette extraction peut être réalisée de l'une des manières suivantes :</span><span class="sxs-lookup"><span data-stu-id="aaf64-110">This extraction can be done in any of the following ways:</span></span>  
  
-   <span data-ttu-id="aaf64-111">Au moment de la configuration de la trace, à l’aide de l’onglet **Paramètres d’extraction des événements** . Cet onglet n’apparaît que si vous sélectionnez l’événement **Deadlock graph** sous l’onglet **Sélection des événements** .</span><span class="sxs-lookup"><span data-stu-id="aaf64-111">At trace configuration time, using the **Events Extraction Settings** tab. Note that this tab does not appear until you select the **Deadlock graph** event on the **Events Selection** tab.</span></span>  
  
-   <span data-ttu-id="aaf64-112">À l’aide de l’option **Extraire les événements SQL Server** du menu **Fichier** .</span><span class="sxs-lookup"><span data-stu-id="aaf64-112">Using the **Extract SQL Server Events** option on the **File** menu.</span></span>  
  
-   <span data-ttu-id="aaf64-113">Vous pouvez également extraire et enregistrer un événement donné en cliquant avec le bouton droit sur celui-ci et en choisissant **Extraire les données d’événement**.</span><span class="sxs-lookup"><span data-stu-id="aaf64-113">Individual events can also be extracted and saved by right-clicking a specific event and choosing **Extract Event Data**.</span></span>  
  
## <a name="deadlock-graphs"></a><span data-ttu-id="aaf64-114">Graphiques de blocage</span><span class="sxs-lookup"><span data-stu-id="aaf64-114">Deadlock Graphs</span></span>  
 [!INCLUDE[ssSqlProfiler](../../includes/sssqlprofiler-md.md)] <span data-ttu-id="aaf64-115">et [!INCLUDE[ssManStudioFull](../../includes/ssmanstudiofull-md.md)] utilisent un graphique WAITFOR de blocage pour décrire un blocage.</span><span class="sxs-lookup"><span data-stu-id="aaf64-115">and [!INCLUDE[ssManStudioFull](../../includes/ssmanstudiofull-md.md)] use a deadlock wait-for graph to describe a deadlock.</span></span> <span data-ttu-id="aaf64-116">Le graphique WAITFOR de blocage contient des nœuds de processus, des nœuds de ressources et des arêtes qui représentent les relations entre les processus et les ressources.</span><span class="sxs-lookup"><span data-stu-id="aaf64-116">The deadlock wait-for graph contains process nodes, resource nodes, and edges representing the relationships between the processes and the resources.</span></span> <span data-ttu-id="aaf64-117">Les composants des graphiques WAITFOR sont définis dans la table suivante :</span><span class="sxs-lookup"><span data-stu-id="aaf64-117">The components of wait-for graphs are defined in the following table:</span></span>  
  
 <span data-ttu-id="aaf64-118">Nœud de processus</span><span class="sxs-lookup"><span data-stu-id="aaf64-118">Process node</span></span>  
 <span data-ttu-id="aaf64-119">Thread qui réalise une tâche ; par exemple, INSERT, UPDATE ou DELETE.</span><span class="sxs-lookup"><span data-stu-id="aaf64-119">A thread that performs a task; for example, INSERT, UPDATE, or DELETE.</span></span>  
  
 <span data-ttu-id="aaf64-120">Nœud de ressource</span><span class="sxs-lookup"><span data-stu-id="aaf64-120">Resource node</span></span>  
 <span data-ttu-id="aaf64-121">Objet de base de données ; par exemple, une table, un index ou une ligne.</span><span class="sxs-lookup"><span data-stu-id="aaf64-121">A database object; for example, a table, index, or row.</span></span>  
  
 <span data-ttu-id="aaf64-122">Edge</span><span class="sxs-lookup"><span data-stu-id="aaf64-122">Edge</span></span>  
 <span data-ttu-id="aaf64-123">Relation entre un processus et une ressource.</span><span class="sxs-lookup"><span data-stu-id="aaf64-123">A relationship between a process and a resource.</span></span> <span data-ttu-id="aaf64-124">Une arête `request` se produit lorsqu'un processus attend une ressource.</span><span class="sxs-lookup"><span data-stu-id="aaf64-124">A `request` edge occurs when a process waits for a resource.</span></span> <span data-ttu-id="aaf64-125">Une arête `owner` se produit lorsqu'une ressource attend un processus.</span><span class="sxs-lookup"><span data-stu-id="aaf64-125">An `owner` edge occurs when a resource waits for a process.</span></span> <span data-ttu-id="aaf64-126">Le mode de verrouillage est inclus dans la description des arêtes.</span><span class="sxs-lookup"><span data-stu-id="aaf64-126">The lock mode is included in the edge description.</span></span> <span data-ttu-id="aaf64-127">Par exemple, **Mode : X**.</span><span class="sxs-lookup"><span data-stu-id="aaf64-127">For example, **Mode: X**.</span></span>  
  
## <a name="deadlock-process-node"></a><span data-ttu-id="aaf64-128">Nœud de processus de blocage</span><span class="sxs-lookup"><span data-stu-id="aaf64-128">Deadlock Process Node</span></span>  
 <span data-ttu-id="aaf64-129">Dans un graphique WAITFOR, le nœud de processus contient des informations sur le processus.</span><span class="sxs-lookup"><span data-stu-id="aaf64-129">In a wait-for graph, the process node contains information about the process.</span></span> <span data-ttu-id="aaf64-130">Le tableau suivant décrit les composants d'un processus.</span><span class="sxs-lookup"><span data-stu-id="aaf64-130">The following table explains the components of a process.</span></span>  
  
|<span data-ttu-id="aaf64-131">Composant</span><span class="sxs-lookup"><span data-stu-id="aaf64-131">Component</span></span>|<span data-ttu-id="aaf64-132">Définition</span><span class="sxs-lookup"><span data-stu-id="aaf64-132">Definition</span></span>|  
|---------------|----------------|  
|<span data-ttu-id="aaf64-133">ID de processus serveur</span><span class="sxs-lookup"><span data-stu-id="aaf64-133">Server process Id</span></span>|<span data-ttu-id="aaf64-134">SPID, identificateur affecté par un serveur pour le processus détenant le verrou.</span><span class="sxs-lookup"><span data-stu-id="aaf64-134">Server process identifier (SPID), a server assigned identifier for the process owning the lock.</span></span>|  
|<span data-ttu-id="aaf64-135">ID de traitement du serveur</span><span class="sxs-lookup"><span data-stu-id="aaf64-135">Server batch Id</span></span>|<span data-ttu-id="aaf64-136">Identificateur de traitement du serveur (SBID).</span><span class="sxs-lookup"><span data-stu-id="aaf64-136">Server batch identifier (SBID).</span></span>|  
|<span data-ttu-id="aaf64-137">ID du contexte d'exécution</span><span class="sxs-lookup"><span data-stu-id="aaf64-137">Execution context Id</span></span>|<span data-ttu-id="aaf64-138">Identificateur du contexte d'exécution (ECID).</span><span class="sxs-lookup"><span data-stu-id="aaf64-138">Execution context identifier (ECID).</span></span> <span data-ttu-id="aaf64-139">ID de contexte d'exécution d'un thread particulier associé à un SPID spécifique</span><span class="sxs-lookup"><span data-stu-id="aaf64-139">The execution context ID of a given thread associated with a specific SPID.</span></span><br /><br /> <span data-ttu-id="aaf64-140">ECID = {0,1,2,3, *...n*}, où 0 représente toujours le thread principal ou parent et {1,2,3, *...n*} les sous-threads.</span><span class="sxs-lookup"><span data-stu-id="aaf64-140">ECID = {0,1,2,3, *...n*}, where 0 always represents the main or parent thread, and {1,2,3, *...n*} represent the subthreads.</span></span>|  
|<span data-ttu-id="aaf64-141">Priorité de blocage</span><span class="sxs-lookup"><span data-stu-id="aaf64-141">Deadlock priority</span></span>|<span data-ttu-id="aaf64-142">Priorité de blocage du processus.</span><span class="sxs-lookup"><span data-stu-id="aaf64-142">Deadlock priority for the process.</span></span> <span data-ttu-id="aaf64-143">Pour plus d’informations sur les valeurs possibles, consultez [SET DEADLOCK_PRIORITY &#40;Transact-SQL&#41;](/sql/t-sql/statements/set-deadlock-priority-transact-sql).</span><span class="sxs-lookup"><span data-stu-id="aaf64-143">For more information about possible values, see [SET DEADLOCK_PRIORITY &#40;Transact-SQL&#41;](/sql/t-sql/statements/set-deadlock-priority-transact-sql).</span></span>|  
|<span data-ttu-id="aaf64-144">Journal utilisé</span><span class="sxs-lookup"><span data-stu-id="aaf64-144">Log Used</span></span>|<span data-ttu-id="aaf64-145">Quantité d'espace journal utilisée par le processus.</span><span class="sxs-lookup"><span data-stu-id="aaf64-145">Amount of log space used by the process.</span></span>|  
|<span data-ttu-id="aaf64-146">ID de propriétaire</span><span class="sxs-lookup"><span data-stu-id="aaf64-146">Owner Id</span></span>|<span data-ttu-id="aaf64-147">ID de transaction des processus qui utilisent des transactions et qui attendent un verrou.</span><span class="sxs-lookup"><span data-stu-id="aaf64-147">Transaction ID for the processes which are using transactions and currently waiting on a lock.</span></span>|  
|<span data-ttu-id="aaf64-148">Descripteur de transaction</span><span class="sxs-lookup"><span data-stu-id="aaf64-148">Transaction descriptor</span></span>|<span data-ttu-id="aaf64-149">Pointeur vers le descripteur de transaction qui décrit l'état de la transaction.</span><span class="sxs-lookup"><span data-stu-id="aaf64-149">Pointer to the transaction descriptor that describes the state of the transaction.</span></span>|  
|<span data-ttu-id="aaf64-150">Mémoire tampon d'entrée</span><span class="sxs-lookup"><span data-stu-id="aaf64-150">Input buffer</span></span>|<span data-ttu-id="aaf64-151">Mémoire tampon d'entrée du processus actuel, qui définit le type d'événement et l'instruction en cours d'exécution.</span><span class="sxs-lookup"><span data-stu-id="aaf64-151">Input buffer of the current process, defines the type of event and the statement being executed.</span></span> <span data-ttu-id="aaf64-152">Les valeurs possibles incluent :</span><span class="sxs-lookup"><span data-stu-id="aaf64-152">Possible values include:</span></span><br /><br /> <span data-ttu-id="aaf64-153">**Langage**</span><span class="sxs-lookup"><span data-stu-id="aaf64-153">**Language**</span></span><br /><br /> <span data-ttu-id="aaf64-154">**RPC**</span><span class="sxs-lookup"><span data-stu-id="aaf64-154">**RPC**</span></span><br /><br /> <span data-ttu-id="aaf64-155">**Aucun**</span><span class="sxs-lookup"><span data-stu-id="aaf64-155">**None**</span></span>|  
|<span data-ttu-id="aaf64-156">.</span><span class="sxs-lookup"><span data-stu-id="aaf64-156">Statement</span></span>|<span data-ttu-id="aaf64-157">Type d'instruction.</span><span class="sxs-lookup"><span data-stu-id="aaf64-157">Type of statement.</span></span> <span data-ttu-id="aaf64-158">Les valeurs possibles sont les suivantes :</span><span class="sxs-lookup"><span data-stu-id="aaf64-158">Possible values are:</span></span><br /><br /> <span data-ttu-id="aaf64-159">**NOP**</span><span class="sxs-lookup"><span data-stu-id="aaf64-159">**NOP**</span></span><br /><br /> <span data-ttu-id="aaf64-160">**SELECT**</span><span class="sxs-lookup"><span data-stu-id="aaf64-160">**SELECT**</span></span><br /><br /> <span data-ttu-id="aaf64-161">**UPDATE**</span><span class="sxs-lookup"><span data-stu-id="aaf64-161">**UPDATE**</span></span><br /><br /> <span data-ttu-id="aaf64-162">**INSERT**</span><span class="sxs-lookup"><span data-stu-id="aaf64-162">**INSERT**</span></span><br /><br /> <span data-ttu-id="aaf64-163">**DELETE**</span><span class="sxs-lookup"><span data-stu-id="aaf64-163">**DELETE**</span></span><br /><br /> <span data-ttu-id="aaf64-164">**Unknown**</span><span class="sxs-lookup"><span data-stu-id="aaf64-164">**Unknown**</span></span>|  
  
## <a name="deadlock-resource-node"></a><span data-ttu-id="aaf64-165">Nœud de ressource de blocage</span><span class="sxs-lookup"><span data-stu-id="aaf64-165">Deadlock Resource Node</span></span>  
 <span data-ttu-id="aaf64-166">Dans un blocage, chacun des deux processus attend une ressource détenue par l'autre processus.</span><span class="sxs-lookup"><span data-stu-id="aaf64-166">In a deadlock, two processes are each waiting for a resource held by the other process.</span></span> <span data-ttu-id="aaf64-167">Dans un graphique de blocage, les ressources apparaissent sous la forme de nœuds de ressources.</span><span class="sxs-lookup"><span data-stu-id="aaf64-167">In a deadlock graph, the resources are displayed as resource nodes.</span></span>  
  
  
