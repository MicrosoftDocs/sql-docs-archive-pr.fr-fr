---
title: adaptateur cloud pour SQL Server | Microsoft Docs
ms.custom: ''
ms.date: 03/09/2017
ms.prod: sql-server-2014
ms.reviewer: ''
ms.technology: database-engine
ms.topic: conceptual
helpviewer_keywords:
- Cloud adapter
- Deploy to Azure
ms.assetid: 82ed0d0f-952d-4d49-aa36-3855a3ca9877
author: mashamsft
ms.author: mathoma
ms.openlocfilehash: d5716435bb1db494bdabeb45ed366c1783926989
ms.sourcegitcommit: ad4d92dce894592a259721a1571b1d8736abacdb
ms.translationtype: MT
ms.contentlocale: fr-FR
ms.lasthandoff: 08/04/2020
ms.locfileid: "87611318"
---
# <a name="cloud-adapter-for-sql-server"></a><span data-ttu-id="952f2-102">Adaptateur de cloud pour SQL Server</span><span class="sxs-lookup"><span data-stu-id="952f2-102">Cloud Adapter for SQL Server</span></span>
  <span data-ttu-id="952f2-103">Le service adaptateur cloud est créé dans le cadre de l' [!INCLUDE[ssNoVersion](../includes/ssnoversion-md.md)] approvisionnement sur une machine virtuelle Azure.</span><span class="sxs-lookup"><span data-stu-id="952f2-103">The Cloud Adapter service is created as part of [!INCLUDE[ssNoVersion](../includes/ssnoversion-md.md)] provisioning on an Azure VM.</span></span> <span data-ttu-id="952f2-104">Il génère un certificat SSL auto-signé dans le cadre de sa première exécution, puis s’exécute en tant que compte **Système local** .</span><span class="sxs-lookup"><span data-stu-id="952f2-104">The Cloud Adapter service generates a self-signed SSL certificate as part of its first run, and then runs as a **Local System** account.</span></span> <span data-ttu-id="952f2-105">Il génère un fichier de configuration utilisé pour sa configuration.</span><span class="sxs-lookup"><span data-stu-id="952f2-105">It generates a configuration file that is used to configure itself.</span></span> <span data-ttu-id="952f2-106">L’adaptateur de Cloud crée également une règle de pare-feu Windows pour autoriser les connexions TCP entrantes sur le port 11435 par défaut.</span><span class="sxs-lookup"><span data-stu-id="952f2-106">The Cloud Adapter also creates a Windows Firewall rule to allow its incoming TCP connections at default port 11435.</span></span>  
  
 <span data-ttu-id="952f2-107">L'adaptateur de cloud est un service sans état et synchrone qui reçoit les messages de l'instance sur site de [!INCLUDE[ssNoVersion](../includes/ssnoversion-md.md)].</span><span class="sxs-lookup"><span data-stu-id="952f2-107">The Cloud Adapter is a stateless, synchronous service that receives messages from the on-premise instance of [!INCLUDE[ssNoVersion](../includes/ssnoversion-md.md)].</span></span> <span data-ttu-id="952f2-108">Lorsque le service Adaptateur de cloud est arrêté, il arrête l'adaptateur de cloud d'accès à distance, dissocie le certificat SSL et désactive la règle de Pare-feu Windows.</span><span class="sxs-lookup"><span data-stu-id="952f2-108">When the Cloud Adapter service is stopped, it stops the remote access Cloud Adapter, unbinds the SSL certificate, and disables the Windows Firewall rule.</span></span>  
  
## <a name="cloud-adapter-requirements"></a><span data-ttu-id="952f2-109">Configuration requise pour l'adaptateur de cloud</span><span class="sxs-lookup"><span data-stu-id="952f2-109">Cloud Adapter Requirements</span></span>  
 <span data-ttu-id="952f2-110">Notez la configuration requise pour installer, activer, puis exécuter l'adaptateur de cloud pour [!INCLUDE[ssNoVersion](../includes/ssnoversion-md.md)]:</span><span class="sxs-lookup"><span data-stu-id="952f2-110">Note the following requirements to install, enable, and run the Cloud Adapter for [!INCLUDE[ssNoVersion](../includes/ssnoversion-md.md)]:</span></span>  
  
-   <span data-ttu-id="952f2-111">L'adaptateur de cloud est pris en charge par [!INCLUDE[ssNoVersion](../includes/ssnoversion-md.md)] 2012 et les versions ultérieures.</span><span class="sxs-lookup"><span data-stu-id="952f2-111">Cloud Adapter is supported with [!INCLUDE[ssNoVersion](../includes/ssnoversion-md.md)] 2012 and higher.</span></span> <span data-ttu-id="952f2-112">Sur [!INCLUDE[ssNoVersion](../includes/ssnoversion-md.md)] 2012, l'adaptateur de cloud pour [!INCLUDE[ssNoVersion](../includes/ssnoversion-md.md)] nécessite SQL Management Objects pour [!INCLUDE[ssNoVersion](../includes/ssnoversion-md.md)] 2012.</span><span class="sxs-lookup"><span data-stu-id="952f2-112">On [!INCLUDE[ssNoVersion](../includes/ssnoversion-md.md)] 2012, the Cloud Adapter for [!INCLUDE[ssNoVersion](../includes/ssnoversion-md.md)] requires SQL Management Objects for [!INCLUDE[ssNoVersion](../includes/ssnoversion-md.md)] 2012.</span></span>  
  
-   <span data-ttu-id="952f2-113">Le service Web Adaptateur de cloud s'exécute en tant que compte **Système local** et vérifie les informations d'identification du client avant d'exécuter les tâches.</span><span class="sxs-lookup"><span data-stu-id="952f2-113">Cloud Adapter web service runs as a **Local System** account and verifies client credentials before executing any task.</span></span> <span data-ttu-id="952f2-114">Les informations d’identification fournies par le client doivent appartenir au compte d’utilisation qui est membre du groupe **administrateurs** local sur l’ordinateur distant.</span><span class="sxs-lookup"><span data-stu-id="952f2-114">Credentials supplied by the client must belong to the use account that is a member of the local **Administrators** group on the remote machine.</span></span>  
  
-   <span data-ttu-id="952f2-115">L'adaptateur de cloud prend uniquement en charge l'Authentification [!INCLUDE[ssNoVersion](../includes/ssnoversion-md.md)] .</span><span class="sxs-lookup"><span data-stu-id="952f2-115">Cloud Adapter supports only [!INCLUDE[ssNoVersion](../includes/ssnoversion-md.md)] Authentication.</span></span>  
  
-   <span data-ttu-id="952f2-116">L'adaptateur de cloud utilise le compte d'administrateur local d'ordinateur virtuel pour exécuter des commandes sur l'ordinateur local, et non pas un compte d'administrateur système.</span><span class="sxs-lookup"><span data-stu-id="952f2-116">Cloud Adapter uses VM local administrator account to execute commands on the local machine, not an sa account.</span></span>  
  
-   <span data-ttu-id="952f2-117">L'adaptateur cloud écoute sur le protocole TCP/IP.</span><span class="sxs-lookup"><span data-stu-id="952f2-117">Cloud Adapter listens on TCP/IP.</span></span> <span data-ttu-id="952f2-118">Le port par défaut est 11435.</span><span class="sxs-lookup"><span data-stu-id="952f2-118">The default port is 11435.</span></span>  
  
-   <span data-ttu-id="952f2-119">L'adaptateur de cloud doit disposer d'autorisations pour créer et modifier des règles de Pare-feu Windows.</span><span class="sxs-lookup"><span data-stu-id="952f2-119">Cloud Adapter must have permissions to create and modify Windows Firewall rules.</span></span>  
  
## <a name="cloud-adapter-configuration-settings"></a><span data-ttu-id="952f2-120">Paramètres de configuration de l'adaptateur de cloud</span><span class="sxs-lookup"><span data-stu-id="952f2-120">Cloud Adapter Configuration Settings</span></span>  
 <span data-ttu-id="952f2-121">Utilisez les informations de configuration d'adaptateur de cloud suivantes pour modifier les paramètres d'un adaptateur de cloud.</span><span class="sxs-lookup"><span data-stu-id="952f2-121">Use the following Cloud Adapter configuration details to modify settings for a Cloud Adapter.</span></span>  
  
-   <span data-ttu-id="952f2-122">**Chemin d’accès par défaut pour le fichier de configuration** -C:\Program Files\Microsoft SQL Server\120\Tools\CloudAdapter</span><span class="sxs-lookup"><span data-stu-id="952f2-122">**Default path for the configuration file** - C:\Program Files\Microsoft SQL Server\120\Tools\CloudAdapter</span></span>\  
  
-   <span data-ttu-id="952f2-123">**Paramètres du fichier de configuration** -</span><span class="sxs-lookup"><span data-stu-id="952f2-123">**Configuration file parameters** -</span></span>  
  
    -   \<configuration>  
  
        -   \<appSettings>  
  
            -   \<add key="WebServicePort" value="" />  
  
            -   \<add key="WebServiceCertificate" value="GUID" />  
  
            -   \<add key="ExposeExceptionDetails" value="true" />  
  
        -   \</appSettings>  
  
    -   \</configuration>  
  
-   <span data-ttu-id="952f2-124">**Détails du certificat** : le certificat a les valeurs suivantes :</span><span class="sxs-lookup"><span data-stu-id="952f2-124">**Certificate details** - The certificate has the following values:</span></span>  
  
    -   <span data-ttu-id="952f2-125">Subject-"CN = CloudAdapter \<VMName> , DC = SQL Server, DC = Microsoft"</span><span class="sxs-lookup"><span data-stu-id="952f2-125">Subject - "CN=CloudAdapter\<VMName>, DC=SQL Server, DC=Microsoft"</span></span>  
  
    -   <span data-ttu-id="952f2-126">Le certificat doit disposer uniquement de l'utilisation améliorée de la clé d'authentification serveur activée.</span><span class="sxs-lookup"><span data-stu-id="952f2-126">The certificate should have only Server Authentication EKU enabled.</span></span>  
  
    -   <span data-ttu-id="952f2-127">La longueur de la clé de certificat est 2048.</span><span class="sxs-lookup"><span data-stu-id="952f2-127">The certificate key length is 2048.</span></span>  
  
 <span data-ttu-id="952f2-128">**Valeurs du fichier de configuration**:</span><span class="sxs-lookup"><span data-stu-id="952f2-128">**Configuration file values**:</span></span>  
  
|<span data-ttu-id="952f2-129">Paramètre</span><span class="sxs-lookup"><span data-stu-id="952f2-129">Setting</span></span>|<span data-ttu-id="952f2-130">Valeurs</span><span class="sxs-lookup"><span data-stu-id="952f2-130">Values</span></span>|<span data-ttu-id="952f2-131">Default</span><span class="sxs-lookup"><span data-stu-id="952f2-131">Default</span></span>|<span data-ttu-id="952f2-132">Commentaires</span><span class="sxs-lookup"><span data-stu-id="952f2-132">Comments</span></span>|  
|-------------|------------|-------------|--------------|  
|<span data-ttu-id="952f2-133">WebServicePort</span><span class="sxs-lookup"><span data-stu-id="952f2-133">WebServicePort</span></span>|<span data-ttu-id="952f2-134">1-65535</span><span class="sxs-lookup"><span data-stu-id="952f2-134">1-65535</span></span>|<span data-ttu-id="952f2-135">11435</span><span class="sxs-lookup"><span data-stu-id="952f2-135">11435</span></span>|<span data-ttu-id="952f2-136">Si ce paramètre n'est pas spécifié, utilisez 11435.</span><span class="sxs-lookup"><span data-stu-id="952f2-136">If not specified, use 11435.</span></span>|  
|<span data-ttu-id="952f2-137">WebServiceCertificate</span><span class="sxs-lookup"><span data-stu-id="952f2-137">WebServiceCertificate</span></span>|<span data-ttu-id="952f2-138">Empreinte numérique</span><span class="sxs-lookup"><span data-stu-id="952f2-138">Thumbprint</span></span>|<span data-ttu-id="952f2-139">Vide</span><span class="sxs-lookup"><span data-stu-id="952f2-139">Empty</span></span>|<span data-ttu-id="952f2-140">Si ce paramètre est vide, un nouveau certificat auto-signé est généré.</span><span class="sxs-lookup"><span data-stu-id="952f2-140">If empty, a new self-signed certificate is generated.</span></span>|  
|<span data-ttu-id="952f2-141">ExposeExceptionDetails</span><span class="sxs-lookup"><span data-stu-id="952f2-141">ExposeExceptionDetails</span></span>|<span data-ttu-id="952f2-142">Vrai/Faux</span><span class="sxs-lookup"><span data-stu-id="952f2-142">True/False</span></span>|<span data-ttu-id="952f2-143">False</span><span class="sxs-lookup"><span data-stu-id="952f2-143">False</span></span>||  
  
## <a name="cloud-adapter-troubleshooting"></a><span data-ttu-id="952f2-144">Dépannage de l'adaptateur de cloud</span><span class="sxs-lookup"><span data-stu-id="952f2-144">Cloud Adapter Troubleshooting</span></span>  
 <span data-ttu-id="952f2-145">Utilisez les informations suivantes pour dépanner l'adaptateur de cloud pour [!INCLUDE[ssNoVersion](../includes/ssnoversion-md.md)]:</span><span class="sxs-lookup"><span data-stu-id="952f2-145">Use the following information to troubleshoot the Cloud Adapter for [!INCLUDE[ssNoVersion](../includes/ssnoversion-md.md)]:</span></span>  
  
-   <span data-ttu-id="952f2-146">**Gestion des erreurs et journalisation** -les erreurs et les messages d’État sont écrits dans le journal des événements de l’application.</span><span class="sxs-lookup"><span data-stu-id="952f2-146">**Error handling and logging** - Errors and status messages are written to the Application Event Log.</span></span>  
  
-   <span data-ttu-id="952f2-147">**Traçage, événements** -tous les événements sont écrits dans le journal des événements de l’application.</span><span class="sxs-lookup"><span data-stu-id="952f2-147">**Tracing, Events** - All events are written to the Application Event Log.</span></span>  
  
-   <span data-ttu-id="952f2-148">**Contrôle, configuration** : utilisez le fichier de configuration situé dans : C:\Program Files\Microsoft SQL Server\120\Tools\CloudAdapter \\ .</span><span class="sxs-lookup"><span data-stu-id="952f2-148">**Control, configuration** - Use the configuration file located in:  C:\Program Files\Microsoft SQL Server\120\Tools\CloudAdapter\\.</span></span>  
  
|<span data-ttu-id="952f2-149">Error</span><span class="sxs-lookup"><span data-stu-id="952f2-149">Error</span></span>|<span data-ttu-id="952f2-150">ID d'erreur</span><span class="sxs-lookup"><span data-stu-id="952f2-150">Error ID</span></span>|<span data-ttu-id="952f2-151">Cause</span><span class="sxs-lookup"><span data-stu-id="952f2-151">Cause</span></span>|<span data-ttu-id="952f2-152">Résolution</span><span class="sxs-lookup"><span data-stu-id="952f2-152">Resolution</span></span>|  
|-----------|--------------|-----------|----------------|  
|<span data-ttu-id="952f2-153">Une exception s'est produite lors de l'ajout du certificat dans le magasin de certificats.</span><span class="sxs-lookup"><span data-stu-id="952f2-153">There was an exception while adding the certificate to the certificate store.</span></span> <span data-ttu-id="952f2-154">[Texte de l'exception].</span><span class="sxs-lookup"><span data-stu-id="952f2-154">{Exception text}.</span></span>|<span data-ttu-id="952f2-155">45560</span><span class="sxs-lookup"><span data-stu-id="952f2-155">45560</span></span>|<span data-ttu-id="952f2-156">Autorisations dans le magasin de certificats de l'ordinateur</span><span class="sxs-lookup"><span data-stu-id="952f2-156">Machine certificate store permissions</span></span>|<span data-ttu-id="952f2-157">Vérifiez que le service Adaptateur de cloud dispose des autorisations nécessaires pour ajouter des certificats dans le magasin de certificats de l'ordinateur.</span><span class="sxs-lookup"><span data-stu-id="952f2-157">Ensure that the Cloud Adapter service has permissions to add certificates to the machine certificate store.</span></span>|  
|<span data-ttu-id="952f2-158">Une exception s'est produite lors de la configuration de la liaison SSL du port {numéro de port} et du certificat {Thumbprint}.</span><span class="sxs-lookup"><span data-stu-id="952f2-158">There was an exception while trying to configure the SSL binding for port {Port number} and certificate {Thumbprint}.</span></span> <span data-ttu-id="952f2-159">{Exception}.</span><span class="sxs-lookup"><span data-stu-id="952f2-159">{Exception}.</span></span>|<span data-ttu-id="952f2-160">45561</span><span class="sxs-lookup"><span data-stu-id="952f2-160">45561</span></span>|<span data-ttu-id="952f2-161">Une autre application a déjà utilisé le port ou lié un certificat à celui-ci.</span><span class="sxs-lookup"><span data-stu-id="952f2-161">Another application has already used the port or bound a certificate to it.</span></span>|<span data-ttu-id="952f2-162">Supprimez les liaisons existantes ou modifiez le port de l'adaptateur de cloud dans le fichier de configuration.</span><span class="sxs-lookup"><span data-stu-id="952f2-162">Remove existing bindings or change Cloud Adapter port in the configuration file.</span></span>|  
|<span data-ttu-id="952f2-163">Certificat SSL introuvable [{Thumbprint}] dans le magasin de certificats.</span><span class="sxs-lookup"><span data-stu-id="952f2-163">Failed to find SSL certificate [{Thumbprint}] in the certificate store.</span></span>|<span data-ttu-id="952f2-164">45564</span><span class="sxs-lookup"><span data-stu-id="952f2-164">45564</span></span>|<span data-ttu-id="952f2-165">L'empreinte numérique de certificat est dans le fichier de configuration, mais le magasin de certificats personnel pour le service ne contient pas de certificat.</span><span class="sxs-lookup"><span data-stu-id="952f2-165">Certificate thumbprint is in the configuration file, but personal certificate store for the service does not contain certificate.</span></span><br /><br /> <span data-ttu-id="952f2-166">Autorisations insuffisantes.</span><span class="sxs-lookup"><span data-stu-id="952f2-166">Insufficient permissions.</span></span>|<span data-ttu-id="952f2-167">Vérifiez que le certificat se trouve dans le magasin de certificats personnel pour le service.</span><span class="sxs-lookup"><span data-stu-id="952f2-167">Make sure the certificate is in the personal certificate store for the service.</span></span><br /><br /> <span data-ttu-id="952f2-168">Vérifiez que le service dispose des autorisations appropriées pour le magasin.</span><span class="sxs-lookup"><span data-stu-id="952f2-168">Make sure the service has correct permissions for the store.</span></span>|  
|<span data-ttu-id="952f2-169">Échec du démarrage du service Web.</span><span class="sxs-lookup"><span data-stu-id="952f2-169">Failed to start the web service.</span></span> <span data-ttu-id="952f2-170">[Texte de l'exception].</span><span class="sxs-lookup"><span data-stu-id="952f2-170">{Exception text}.</span></span>|<span data-ttu-id="952f2-171">45570</span><span class="sxs-lookup"><span data-stu-id="952f2-171">45570</span></span>|<span data-ttu-id="952f2-172">Décrit dans l'exception.</span><span class="sxs-lookup"><span data-stu-id="952f2-172">Described in the exception.</span></span>|<span data-ttu-id="952f2-173">Activez ExposeExceptionDetails et utilisez les informations étendues de l'exception.</span><span class="sxs-lookup"><span data-stu-id="952f2-173">Enable ExposeExceptionDetails and use extended information from the exception.</span></span>|  
|<span data-ttu-id="952f2-174">Le certificat [{Thumbprint}] a expiré.</span><span class="sxs-lookup"><span data-stu-id="952f2-174">Certificate [{Thumbprint}] has expired.</span></span>|<span data-ttu-id="952f2-175">45565</span><span class="sxs-lookup"><span data-stu-id="952f2-175">45565</span></span>|<span data-ttu-id="952f2-176">Certificat arrivé à expiration référencé dans le fichier de configuration.</span><span class="sxs-lookup"><span data-stu-id="952f2-176">Expired certificate referenced from the configuration file.</span></span>|<span data-ttu-id="952f2-177">Ajoutez un certificat valide et mettez à jour le fichier de configuration avec son empreinte numérique.</span><span class="sxs-lookup"><span data-stu-id="952f2-177">Add a valid certificate and update the configuration file with its thumbprint.</span></span>|  
|<span data-ttu-id="952f2-178">Erreur du service Web : {0} .</span><span class="sxs-lookup"><span data-stu-id="952f2-178">Web service error: {0}.</span></span>|<span data-ttu-id="952f2-179">45571</span><span class="sxs-lookup"><span data-stu-id="952f2-179">45571</span></span>|<span data-ttu-id="952f2-180">Décrit dans l'exception.</span><span class="sxs-lookup"><span data-stu-id="952f2-180">Described in the exception.</span></span>|<span data-ttu-id="952f2-181">Activez ExposeExceptionDetails et utilisez les informations étendues de l'exception.</span><span class="sxs-lookup"><span data-stu-id="952f2-181">Enable ExposeExceptionDetails and use extended information from the exception.</span></span>|  
  
## <a name="see-also"></a><span data-ttu-id="952f2-182">Voir aussi</span><span class="sxs-lookup"><span data-stu-id="952f2-182">See Also</span></span>  
 [<span data-ttu-id="952f2-183">Déployer une base de données SQL Server sur une machine virtuelle Microsoft Azure</span><span class="sxs-lookup"><span data-stu-id="952f2-183">Deploy a SQL Server Database to a Microsoft Azure Virtual Machine</span></span>](../relational-databases/databases/deploy-a-sql-server-database-to-a-microsoft-azure-virtual-machine.md)  
  
  
