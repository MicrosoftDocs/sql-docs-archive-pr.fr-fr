---
title: Inscrire un nom de principal du service pour les connexions Kerberos | Microsoft Docs
ms.custom: ''
ms.date: 06/13/2017
ms.prod: sql-server-2014
ms.reviewer: ''
ms.technology: configuration
ms.topic: conceptual
helpviewer_keywords:
- connections [SQL Server], SPNs
- network connections [SQL Server], SPNs
- registering SPNs
- Server Principal Names
- SPNs [SQL Server]
ms.assetid: e38d5ce4-e538-4ab9-be67-7046e0d9504e
author: MikeRayMSFT
ms.author: mikeray
ms.openlocfilehash: f4db1e8b86fca057acbce29491be9c2be91f0748
ms.sourcegitcommit: ad4d92dce894592a259721a1571b1d8736abacdb
ms.translationtype: MT
ms.contentlocale: fr-FR
ms.lasthandoff: 08/04/2020
ms.locfileid: "87613132"
---
# <a name="register-a-service-principal-name-for-kerberos-connections"></a><span data-ttu-id="98c11-102">Inscrire un nom de principal du service pour les connexions Kerberos</span><span class="sxs-lookup"><span data-stu-id="98c11-102">Register a Service Principal Name for Kerberos Connections</span></span>
  <span data-ttu-id="98c11-103">Pour utiliser l'authentification Kerberos avec [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] , les deux conditions suivantes doivent être remplies :</span><span class="sxs-lookup"><span data-stu-id="98c11-103">To use Kerberos authentication with [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] requires both the following conditions to be true:</span></span>  
  
-   <span data-ttu-id="98c11-104">Les ordinateurs clients et serveurs doivent faire partie du même domaine Windows ou appartenir à des domaines approuvés.</span><span class="sxs-lookup"><span data-stu-id="98c11-104">The client and server computers must be part of the same Windows domain, or in trusted domains.</span></span>  
  
-   <span data-ttu-id="98c11-105">Un nom de principal du service (SPN, Service Principal Name) doit être inscrit dans Active Directory, qui joue le rôle de centre de distribution de clés dans un domaine Windows.</span><span class="sxs-lookup"><span data-stu-id="98c11-105">A Service Principal Name (SPN) must be registered with Active Directory, which assumes the role of the Key Distribution Center in a Windows domain.</span></span> <span data-ttu-id="98c11-106">Une fois inscrit, le SPN est mappé au compte Windows qui a démarré le service de l'instance de [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] .</span><span class="sxs-lookup"><span data-stu-id="98c11-106">The SPN, after it is registered, maps to the Windows account that started the [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] instance service.</span></span> <span data-ttu-id="98c11-107">Si l'inscription du SPN n'a pas été effectuée ou échoue, la couche de sécurité Windows ne peut pas déterminer le compte associé au SPN et l'authentification Kerberos ne sera pas utilisée.</span><span class="sxs-lookup"><span data-stu-id="98c11-107">If the SPN registration has not been performed or fails, the Windows security layer cannot determine the account associated with the SPN, and Kerberos authentication will not be used.</span></span>  
  
    > [!NOTE]  
    >  <span data-ttu-id="98c11-108">Si le serveur ne parvient pas à inscrire automatiquement le SPN, celui-ci doit être inscrit manuellement.</span><span class="sxs-lookup"><span data-stu-id="98c11-108">If the server cannot automatically register the SPN, the SPN must be registered manually.</span></span> <span data-ttu-id="98c11-109">Consultez [Inscription manuelle des SPN](#Manual).</span><span class="sxs-lookup"><span data-stu-id="98c11-109">See [Manual SPN Registration](#Manual).</span></span>  
  
 <span data-ttu-id="98c11-110">Vous pouvez vérifier qu'une connexion utilise Kerberos en interrogeant la vue de gestion dynamique sys.dm_exec_connections.</span><span class="sxs-lookup"><span data-stu-id="98c11-110">You can verify that a connection is using Kerberos by querying the sys.dm_exec_connections dynamic management view.</span></span> <span data-ttu-id="98c11-111">Exécutez la requête suivante et vérifiez la valeur de la colonne auth_scheme, qui sera « KERBEROS » si Kerberos est activé.</span><span class="sxs-lookup"><span data-stu-id="98c11-111">Run the following query and check the value of the auth_scheme column, which will be "KERBEROS" if Kerberos is enabled.</span></span>  
  
```  
SELECT auth_scheme FROM sys.dm_exec_connections WHERE session_id = @@spid ;  
```  
  
> [!TIP]  
>  <span data-ttu-id="98c11-112">**[!INCLUDE[msCoName](../../includes/msconame-md.md)] pour [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)]** est un outil de diagnostic qui permet de dépanner les problèmes de connexion que rencontre Kerberos avec [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)].</span><span class="sxs-lookup"><span data-stu-id="98c11-112">**[!INCLUDE[msCoName](../../includes/msconame-md.md)] Kerberos Configuration Manager for [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)]** is a diagnostic tool that helps troubleshoot Kerberos related connectivity issues with [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)].</span></span> <span data-ttu-id="98c11-113">Pour plus d'informations, consultez [Gestionnaire de configuration de Microsoft Kerberos pour SQL Server](https://www.microsoft.com/download/details.aspx?id=39046).</span><span class="sxs-lookup"><span data-stu-id="98c11-113">For more information, see [Microsoft Kerberos Configuration Manager for SQL Server](https://www.microsoft.com/download/details.aspx?id=39046).</span></span>  
  
##  <a name="the-role-of-the-spn-in-authentication"></a><a name="Role"></a> <span data-ttu-id="98c11-114">Rôle du SPN dans l'authentification</span><span class="sxs-lookup"><span data-stu-id="98c11-114">The Role of the SPN in Authentication</span></span>  
 <span data-ttu-id="98c11-115">Lorsqu'une application ouvre une connexion et utilise l'authentification Windows, [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] Native Client transmet le nom de l'ordinateur [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] , le nom de l'instance et, éventuellement, un SPN.</span><span class="sxs-lookup"><span data-stu-id="98c11-115">When an application opens a connection and uses Windows Authentication, [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] Native Client passes the [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] computer name, instance name and, optionally, an SPN.</span></span> <span data-ttu-id="98c11-116">Si la connexion transmet un SPN, il est utilisé sans aucune modification.</span><span class="sxs-lookup"><span data-stu-id="98c11-116">If the connection passes an SPN it is used without any changes.</span></span>  
  
 <span data-ttu-id="98c11-117">Si la connexion ne transmet pas de SPN, un SPN par défaut est construit à partir du protocole utilisé, du nom de serveur et du nom de l'instance.</span><span class="sxs-lookup"><span data-stu-id="98c11-117">If the connection does not pass an SPN, a default SPN is constructed based on the protocol used, server name, and the instance name.</span></span>  
  
 <span data-ttu-id="98c11-118">Dans les deux scénarios précédents, le SPN est envoyé au centre de distribution de clés pour obtenir un jeton de sécurité en vue d'authentifier la connexion.</span><span class="sxs-lookup"><span data-stu-id="98c11-118">In both of the preceding scenarios, the SPN is sent to the Key Distribution Center to obtain a security token for authenticating the connection.</span></span> <span data-ttu-id="98c11-119">Si un jeton de sécurité ne peut pas être obtenu, l'authentification utilise le protocole NTLM.</span><span class="sxs-lookup"><span data-stu-id="98c11-119">If a security token cannot be obtained, authentication uses NTLM.</span></span>  
  
 <span data-ttu-id="98c11-120">Le nom de principal du service (SPN) est le nom par lequel un client identifie de manière unique l'instance d'un service.</span><span class="sxs-lookup"><span data-stu-id="98c11-120">A service principal name (SPN) is the name by which a client uniquely identifies an instance of a service.</span></span> <span data-ttu-id="98c11-121">Le service d'authentification Kerberos peut utiliser le nom principal d'un service pour authentifier un service.</span><span class="sxs-lookup"><span data-stu-id="98c11-121">The Kerberos authentication service can use an SPN to authenticate a service.</span></span> <span data-ttu-id="98c11-122">Pour se connecter à un service, le client localise une instance du service, compose le nom principal du service pour cette instance, se connecte au service et présente le nom principal de service pour que le service s'authentifie.</span><span class="sxs-lookup"><span data-stu-id="98c11-122">When a client wants to connect to a service, it locates an instance of the service, composes an SPN for that instance, connects to the service, and presents the SPN for the service to authenticate.</span></span>  
  
> [!NOTE]  
>  <span data-ttu-id="98c11-123">Les informations fournies dans cette rubrique s'appliquent également aux configurations [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] qui utilisent le clustering.</span><span class="sxs-lookup"><span data-stu-id="98c11-123">The information that is provided in this topic also applies to [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] configurations that use clustering.</span></span>  
  
 <span data-ttu-id="98c11-124">L'Authentification Windows est la méthode recommandée pour authentifier les utilisateurs sur SQL Server.</span><span class="sxs-lookup"><span data-stu-id="98c11-124">Windows Authentication is the preferred method for users to authenticate to SQL Server.</span></span> <span data-ttu-id="98c11-125">Les clients qui utilisent l'Authentification Windows sont authentifiés à l'aide de NTLM ou Kerberos.</span><span class="sxs-lookup"><span data-stu-id="98c11-125">Clients that use Windows Authentication are authenticated by either using NTLM or Kerberos.</span></span> <span data-ttu-id="98c11-126">Dans un environnement Active Directory, l'authentification Kerberos est toujours tentée en premier.</span><span class="sxs-lookup"><span data-stu-id="98c11-126">In an Active Directory environment, Kerberos authentication is always attempted first.</span></span> <span data-ttu-id="98c11-127">L'authentification Kerberos n'est pas disponible pour les clients [!INCLUDE[ssVersion2005](../../includes/ssversion2005-md.md)] utilisant des canaux nommés.</span><span class="sxs-lookup"><span data-stu-id="98c11-127">Kerberos authentication is not available for [!INCLUDE[ssVersion2005](../../includes/ssversion2005-md.md)] clients using named pipes.</span></span>  
  
##  <a name="permissions"></a><a name="Permissions"></a> <span data-ttu-id="98c11-128">Autorisations</span><span class="sxs-lookup"><span data-stu-id="98c11-128">Permissions</span></span>  
 <span data-ttu-id="98c11-129">Lorsque le service du [!INCLUDE[ssDE](../../includes/ssde-md.md)] démarre, il tente d'enregistrer le nom de principal du service (SPN).</span><span class="sxs-lookup"><span data-stu-id="98c11-129">When the [!INCLUDE[ssDE](../../includes/ssde-md.md)] service starts, it attempts to register the Service Principal Name (SPN).</span></span> <span data-ttu-id="98c11-130">Si le compte qui démarre SQL Server n’a pas l’autorisation d’enregistrer un SPN dans les services de domaine Active Directory, cet appel échouera et un message d’avertissement sera consigné dans le journal des événements de l’application ainsi que dans le journal des erreurs SQL Server.</span><span class="sxs-lookup"><span data-stu-id="98c11-130">If the account starting SQL Server doesn't have permission to register a SPN in Active Directory Domain Services, this call will fail and a warning message will be logged in the Application event log as well as the SQL Server error log.</span></span> <span data-ttu-id="98c11-131">Pour inscrire le SPN, le [!INCLUDE[ssDE](../../includes/ssde-md.md)] doit s'exécuter sous un compte intégré, tel que Système local (non recommandé) ou SERVICE RÉSEAU, ou sous un compte qui a l'autorisation d'inscrire un SPN, tel qu'un compte d'administrateur de domaine.</span><span class="sxs-lookup"><span data-stu-id="98c11-131">To register the SPN, the [!INCLUDE[ssDE](../../includes/ssde-md.md)] must be running under a built-in account, such as Local System (not recommended), or NETWORK SERVICE, or an account that has permission to register an SPN, such as a domain administrator account.</span></span> <span data-ttu-id="98c11-132">Lorsque [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] s'exécute sur le système d'exploitation  [!INCLUDE[win7](../../includes/win7-md.md)] ou  [!INCLUDE[winserver2008r2](../../includes/winserver2008r2-md.md)] , vous pouvez exécuter [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] à l'aide d'un compte virtuel ou d'un compte de service administré (MSA).</span><span class="sxs-lookup"><span data-stu-id="98c11-132">When [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] is running on the  [!INCLUDE[win7](../../includes/win7-md.md)] or  [!INCLUDE[winserver2008r2](../../includes/winserver2008r2-md.md)] operating system, you can run [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] using a virtual account or a managed service account (MSA).</span></span> <span data-ttu-id="98c11-133">Les comptes virtuels et les comptes de service administré peuvent inscrire un SPN.</span><span class="sxs-lookup"><span data-stu-id="98c11-133">Both virtual accounts and MSA's can register an SPN.</span></span> <span data-ttu-id="98c11-134">Si [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] ne s’exécute pas sous l’un de ces comptes, le SPN n’est pas inscrit lors du démarrage et l’administrateur de domaine doit l’inscrire manuellement.</span><span class="sxs-lookup"><span data-stu-id="98c11-134">If [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] is not running under one of these accounts, the SPN is not registered at startup and the domain administrator must register the SPN manually.</span></span>  
  
> [!NOTE]  
>  <span data-ttu-id="98c11-135">Lorsque le domaine Windows est configuré pour s'exécuter à un niveau fonctionnel inférieur à celui de [!INCLUDE[winserver2008r2](../../includes/winserver2008r2-md.md)] , le compte de service administré n'a pas les autorisations nécessaires pour inscrire le SPN pour le service du [!INCLUDE[ssDEnoversion](../../includes/ssdenoversion-md.md)] .</span><span class="sxs-lookup"><span data-stu-id="98c11-135">When the Windows domain is configured to run at less than the [!INCLUDE[winserver2008r2](../../includes/winserver2008r2-md.md)] Windows Server 2008 R2 functional level, then the Managed Service Account will not have the necessary permissions to register the SPNs for the [!INCLUDE[ssDEnoversion](../../includes/ssdenoversion-md.md)] service.</span></span> <span data-ttu-id="98c11-136">Si l'authentification Kerberos est requise, l'administrateur de domaine doit inscrire manuellement les SPN [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] le compte de service administré.</span><span class="sxs-lookup"><span data-stu-id="98c11-136">If Kerberos authentication is required, the Domain Administrator should manually register the [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] SPNs on the Managed Service Account.</span></span>  
  
 <span data-ttu-id="98c11-137">L’article de la Base de connaissances [How to use Kerberos authentication in SQL Server (Procédure d’utilisation de l’authentification Kerberos dans SQL Server)](https://support.microsoft.com/kb/319723)contient des informations sur la manière d’accorder une autorisation de lecture ou d’écriture à un SPN pour un compte qui n’est pas Administrateur de domaine.</span><span class="sxs-lookup"><span data-stu-id="98c11-137">The KB article, [How to use Kerberos authentication in SQL Server](https://support.microsoft.com/kb/319723), contains information about how to grant read or write permission to an SPN for an account that is not a Domain Administrator.</span></span>  
  
 <span data-ttu-id="98c11-138">Des informations supplémentaires sont disponibles dans l’article [How to Implement Kerberos Constrained Delegation with SQL Server 2008 (Procédure d’implémentation de la délégation contrainte Kerberos à l’aide de SQL Server 2008)](https://technet.microsoft.com/library/ee191523.aspx).</span><span class="sxs-lookup"><span data-stu-id="98c11-138">Additional information is available at [How to Implement Kerberos Constrained Delegation with SQL Server 2008](https://technet.microsoft.com/library/ee191523.aspx)</span></span>  
  
##  <a name="spn-formats"></a><a name="Formats"></a> <span data-ttu-id="98c11-139">Formats de SPN</span><span class="sxs-lookup"><span data-stu-id="98c11-139">SPN Formats</span></span>  
 <span data-ttu-id="98c11-140">À compter de [!INCLUDE[ssKatmai](../../includes/sskatmai-md.md)], le format des SPN est modifié afin de prendre en charge l'authentification Kerberos sur le protocole TCP/IP, les canaux nommés et la mémoire partagée.</span><span class="sxs-lookup"><span data-stu-id="98c11-140">Beginning with [!INCLUDE[ssKatmai](../../includes/sskatmai-md.md)], the SPN format is changed in order to support Kerberos authentication on TCP/IP, named pipes, and shared memory.</span></span> <span data-ttu-id="98c11-141">Les formats de SPN pris en charge pour les instances nommées et par défaut sont les suivants.</span><span class="sxs-lookup"><span data-stu-id="98c11-141">The supported SPN formats for named and default instances are as follows.</span></span>  
  
 <span data-ttu-id="98c11-142">**Instance nommée**</span><span class="sxs-lookup"><span data-stu-id="98c11-142">**Named instance**</span></span>  
  
-   <span data-ttu-id="98c11-143">*MSSQLSvc/FQDN*:[_port_**|**_nom_instance_], où :</span><span class="sxs-lookup"><span data-stu-id="98c11-143">*MSSQLSvc/FQDN*:[_port_**|**_instancename_], where:</span></span>  
  
    -   <span data-ttu-id="98c11-144">*MSSQLSvc* est le service en cours d’inscription.</span><span class="sxs-lookup"><span data-stu-id="98c11-144">*MSSQLSvc* is the service that is being registered.</span></span>  
  
    -   <span data-ttu-id="98c11-145">*FQDN* est le nom de domaine complet du serveur.</span><span class="sxs-lookup"><span data-stu-id="98c11-145">*FQDN* is the fully qualified domain name of the server.</span></span>  
  
    -   <span data-ttu-id="98c11-146">*port* est le numéro de port TCP.</span><span class="sxs-lookup"><span data-stu-id="98c11-146">*port* is the TCP port number.</span></span>  
  
    -   <span data-ttu-id="98c11-147">*nom_instance* est le nom de l' [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] instance.</span><span class="sxs-lookup"><span data-stu-id="98c11-147">*instancename* is the name of the [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] instance.</span></span>  
  
 <span data-ttu-id="98c11-148">**Instance par défaut**</span><span class="sxs-lookup"><span data-stu-id="98c11-148">**Default instance**</span></span>  
  
-   <span data-ttu-id="98c11-149">*MSSQLSvc/FQDN*:_port_ **|** _MSSQLSvc/FQDN_, où :</span><span class="sxs-lookup"><span data-stu-id="98c11-149">*MSSQLSvc/FQDN*:_port_**|**_MSSQLSvc/FQDN_, where:</span></span>  
  
    -   <span data-ttu-id="98c11-150">*MSSQLSvc* est le service en cours d’inscription.</span><span class="sxs-lookup"><span data-stu-id="98c11-150">*MSSQLSvc* is the service that is being registered.</span></span>  
  
    -   <span data-ttu-id="98c11-151">*FQDN* est le nom de domaine complet du serveur.</span><span class="sxs-lookup"><span data-stu-id="98c11-151">*FQDN* is the fully qualified domain name of the server.</span></span>  
  
    -   <span data-ttu-id="98c11-152">*port* est le numéro de port TCP.</span><span class="sxs-lookup"><span data-stu-id="98c11-152">*port* is the TCP port number.</span></span>  
  
 <span data-ttu-id="98c11-153">Le nouveau format SPN ne requiert pas de numéro de port.</span><span class="sxs-lookup"><span data-stu-id="98c11-153">The new SPN format does not require a port number.</span></span> <span data-ttu-id="98c11-154">Cela signifie qu'un serveur à port multiple ou un protocole qui n'utilise pas de numéro de port peut utiliser l'authentification Kerberos.</span><span class="sxs-lookup"><span data-stu-id="98c11-154">This means that a multiple-port server or a protocol that does not use port numbers can use Kerberos authentication.</span></span>  
  
> [!NOTE]  
>  <span data-ttu-id="98c11-155">Dans le cas d'une connexion TCP/IP, où le port TCP est inclus dans le SPN, [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] doit activer le protocole TCP afin de permettre à un utilisateur de se connecter à l'aide de l'authentification Kerberos.</span><span class="sxs-lookup"><span data-stu-id="98c11-155">In the case of a TCP/IP connection, where the TCP port is included in the SPN, [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] must enable the TCP protocol for a user to connect by using Kerberos authentication.</span></span>  
  
|||  
|-|-|  
|<span data-ttu-id="98c11-156">MSSQLSvc/*FQDN : port*</span><span class="sxs-lookup"><span data-stu-id="98c11-156">MSSQLSvc/*fqdn:port*</span></span>|<span data-ttu-id="98c11-157">Nom principal de service par défaut, généré par le fournisseur, lorsque le protocole TCP est utilisé.</span><span class="sxs-lookup"><span data-stu-id="98c11-157">The provider-generated, default SPN when TCP is used.</span></span> <span data-ttu-id="98c11-158">*port* est un numéro de port TCP.</span><span class="sxs-lookup"><span data-stu-id="98c11-158">*port* is a TCP port number.</span></span>|  
|<span data-ttu-id="98c11-159">MSSQLSvc/*FQDN*</span><span class="sxs-lookup"><span data-stu-id="98c11-159">MSSQLSvc/*fqdn*</span></span>|<span data-ttu-id="98c11-160">Nom principal de service par défaut, généré par le fournisseur, pour une instance par défaut lorsqu'un autre protocole que TCP est utilisé.</span><span class="sxs-lookup"><span data-stu-id="98c11-160">The provider-generated, default SPN for a default instance when a protocol other than TCP is used.</span></span> <span data-ttu-id="98c11-161">*FQDN* est un nom de domaine complet.</span><span class="sxs-lookup"><span data-stu-id="98c11-161">*fqdn* is a fully-qualified domain name.</span></span>|  
|<span data-ttu-id="98c11-162">MSSQLSvc/*FQDN : nom_instance*</span><span class="sxs-lookup"><span data-stu-id="98c11-162">MSSQLSvc/*fqdn:InstanceName*</span></span>|<span data-ttu-id="98c11-163">Nom principal de service par défaut, généré par le fournisseur, pour une instance nommée lorsqu'un autre protocole que TCP est utilisé.</span><span class="sxs-lookup"><span data-stu-id="98c11-163">The provider-generated, default SPN for a named instance when a protocol other than TCP is used.</span></span> <span data-ttu-id="98c11-164">*Nom_instance* est le nom d’une instance de [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] .</span><span class="sxs-lookup"><span data-stu-id="98c11-164">*InstanceName* is the name of an instance of [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)].</span></span>|  
  
##  <a name="automatic-spn-registration"></a><a name="Auto"></a> <span data-ttu-id="98c11-165">Inscription automatique des SPN</span><span class="sxs-lookup"><span data-stu-id="98c11-165">Automatic SPN Registration</span></span>  
 <span data-ttu-id="98c11-166">Lors du démarrage d’une instance du [!INCLUDE[ssDEnoversion](../../includes/ssdenoversion-md.md)] , [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] tente d’inscrire le nom SPN du service [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] .</span><span class="sxs-lookup"><span data-stu-id="98c11-166">When an instance of the [!INCLUDE[ssDEnoversion](../../includes/ssdenoversion-md.md)] starts, [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] tries to register the SPN for the [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] service.</span></span> <span data-ttu-id="98c11-167">Lors de l’arrêt de l’instance, [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] tente d’annuler l’inscription du nom SPN.</span><span class="sxs-lookup"><span data-stu-id="98c11-167">When the instance is stopped, [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] tries to unregister the SPN.</span></span> <span data-ttu-id="98c11-168">Pour une connexion TCP/IP, le SPN est inscrit au format *MSSQLSvc/\<FQDN>* : *\<tcpport>* . Les instances nommées et l’instance par défaut sont inscrites en tant que *MSSQLSvc*. La valeur *\<tcpport>* est utilisée pour différencier les instances.</span><span class="sxs-lookup"><span data-stu-id="98c11-168">For a TCP/IP connection the SPN is registered in the format *MSSQLSvc/\<FQDN>*:*\<tcpport>*.Both named instances and the default instance are registered as *MSSQLSvc*, relying on the *\<tcpport>* value to differentiate the instances.</span></span>  
  
 <span data-ttu-id="98c11-169">Pour les autres connexions qui prennent en charge Kerberos, le SPN est inscrit au format \*MSSQLSvc/ \<FQDN> \*: *\<instancename>* pour une instance nommée.</span><span class="sxs-lookup"><span data-stu-id="98c11-169">For other connections that support Kerberos the SPN is registered in the format *MSSQLSvc/\<FQDN>*:*\<instancename>* for a named instance.</span></span> <span data-ttu-id="98c11-170">Le format *MSSQLSvc/\<FQDN>* est utilisé pour l’inscription de l’instance par défaut.</span><span class="sxs-lookup"><span data-stu-id="98c11-170">The format for registering the default instance is *MSSQLSvc/\<FQDN>*.</span></span>  
  
 <span data-ttu-id="98c11-171">Une intervention manuelle peut être requise pour inscrire ou annuler l'inscription du SPN si le compte de service ne possède pas les autorisations requises pour ces actions.</span><span class="sxs-lookup"><span data-stu-id="98c11-171">Manual intervention might be required to register or unregister the SPN if the service account lacks the permissions that are required for these actions.</span></span>  
  
##  <a name="manual-spn-registration"></a><a name="Manual"></a> <span data-ttu-id="98c11-172">Inscription manuelle des SPN</span><span class="sxs-lookup"><span data-stu-id="98c11-172">Manual SPN Registration</span></span>  
 <span data-ttu-id="98c11-173">Pour inscrire le SPN manuellement, l'administrateur doit utiliser l'outil Setspn.exe fourni avec les Outils de support de Microsoft [!INCLUDE[winxpsvr](../../includes/winxpsvr-md.md)] .</span><span class="sxs-lookup"><span data-stu-id="98c11-173">To register the SPN manually, the administrator must use the Setspn.exe tool that is provided with the Microsoft [!INCLUDE[winxpsvr](../../includes/winxpsvr-md.md)] Support Tools.</span></span> <span data-ttu-id="98c11-174">Pour plus d’informations, consultez l’article de la Base de connaissances [Outils de support de Windows Server 2003 Service Pack 1](https://support.microsoft.com/kb/892777) .</span><span class="sxs-lookup"><span data-stu-id="98c11-174">For more information, see the [Windows Server 2003 Service Pack 1 Support Tools](https://support.microsoft.com/kb/892777) KB article.</span></span>  
  
 <span data-ttu-id="98c11-175">Setspn.exe est un outil de ligne de commande qui vous permet de lire, modifier et supprimer la propriété du répertoire des Noms de principaux du service (SPN).</span><span class="sxs-lookup"><span data-stu-id="98c11-175">Setspn.exe is a command line tool that enables you to read, modify, and delete the Service Principal Names (SPN) directory property.</span></span> <span data-ttu-id="98c11-176">Cet outil vous permet également d'afficher les SPN actuels, de réinitialiser les SPN par défaut du compte et d'ajouter ou de supprimer des SPN supplémentaires.</span><span class="sxs-lookup"><span data-stu-id="98c11-176">This tool also enables you to view the current SPNs, reset the account's default SPNs, and add or delete supplemental SPNs.</span></span>  
  
 <span data-ttu-id="98c11-177">L'exemple suivant illustre la syntaxe utilisée pour inscrire manuellement un SPN pour une connexion TCP/IP.</span><span class="sxs-lookup"><span data-stu-id="98c11-177">The following example illustrates the syntax used to register manually register an SPN for a TCP/IP connection.</span></span>  
  
```  
setspn -A MSSQLSvc/myhost.redmond.microsoft.com:1433 accountname  
```  
  
 <span data-ttu-id="98c11-178">**Remarque** S’il existe déjà un nom SPN, il doit être supprimé avant de pouvoir être réinscrit.</span><span class="sxs-lookup"><span data-stu-id="98c11-178">**Note** If an SPN already exists, it must be deleted before it can be reregistered.</span></span> <span data-ttu-id="98c11-179">Pour cela, utilisez la commande `setspn` avec le commutateur `-D` .</span><span class="sxs-lookup"><span data-stu-id="98c11-179">You do this by using the `setspn` command together with the `-D` switch.</span></span> <span data-ttu-id="98c11-180">Les exemples suivants illustrent comment inscrire manuellement un nouveau SPN basé sur une instance.</span><span class="sxs-lookup"><span data-stu-id="98c11-180">The following examples illustrate how to manually register a new instance-based SPN.</span></span> <span data-ttu-id="98c11-181">Pour une instance par défaut, utilisez :</span><span class="sxs-lookup"><span data-stu-id="98c11-181">For a default instance, use:</span></span>  
  
```  
setspn -A MSSQLSvc/myhost.redmond.microsoft.com accountname  
```  
  
 <span data-ttu-id="98c11-182">Pour une instance nommée, utilisez :</span><span class="sxs-lookup"><span data-stu-id="98c11-182">For a named instance, use:</span></span>  
  
```  
setspn -A MSSQLSvc/myhost.redmond.microsoft.com:instancename accountname  
```  
  
##  <a name="client-connections"></a><a name="Client"></a> <span data-ttu-id="98c11-183">Connexions clientes</span><span class="sxs-lookup"><span data-stu-id="98c11-183">Client Connections</span></span>  
 <span data-ttu-id="98c11-184">Les SPN spécifiés par l'utilisateur sont pris en charge dans les pilotes clients.</span><span class="sxs-lookup"><span data-stu-id="98c11-184">User-specified SPNs are supported in client drivers.</span></span> <span data-ttu-id="98c11-185">Toutefois, si aucun SPN n'est fourni, il est généré automatiquement en fonction du type de connexion cliente.</span><span class="sxs-lookup"><span data-stu-id="98c11-185">However, if an SPN is not provided, it will be generated automatically based on the type of a client connection.</span></span> <span data-ttu-id="98c11-186">Pour une connexion TCP, un nom SPN au format *MSSQLSvc*/*FQDN*:[*port*] est utilisé à la fois pour les instances nommées et par défaut.</span><span class="sxs-lookup"><span data-stu-id="98c11-186">For a TCP connection, an SPN in the format *MSSQLSvc*/*FQDN*:[*port*] is used for both the named and default instances.</span></span>  
  
 <span data-ttu-id="98c11-187">Pour les canaux nommés et les connexions de mémoire partagée, un SPN *MSSQLSvc*au format / *nom de domaine complet*MSSQLSvc :*nom_instance* est utilisé pour une instance nommée et *MSSQLSvc* / le*nom de domaine complet* MSSQLSvc est utilisé pour l’instance par défaut.</span><span class="sxs-lookup"><span data-stu-id="98c11-187">For named pipes and shared memory connections, an SPN in the format *MSSQLSvc*/*FQDN*:*instancename* is used for a named instance and *MSSQLSvc*/*FQDN* is used for the default instance.</span></span>  
  
 <span data-ttu-id="98c11-188">**Utilisation d'un compte de service comme SPN**</span><span class="sxs-lookup"><span data-stu-id="98c11-188">**Using a service account as an SPN**</span></span>  
  
 <span data-ttu-id="98c11-189">Les comptes de service peuvent être utilisés comme SPN.</span><span class="sxs-lookup"><span data-stu-id="98c11-189">Service accounts can be used as an SPN.</span></span> <span data-ttu-id="98c11-190">Ils sont spécifiés par le biais de l'attribut de connexion pour l'authentification Kerberos et assument les formats suivants :</span><span class="sxs-lookup"><span data-stu-id="98c11-190">They are specified through the connection attribute for the Kerberos authentication and take the following formats:</span></span>  
  
-   <span data-ttu-id="98c11-191">**username@domain**ou **domaine\nom_utilisateur** pour un compte d’utilisateur de domaine</span><span class="sxs-lookup"><span data-stu-id="98c11-191">**username@domain** or **domain\username** for a domain user account</span></span>  
  
-   <span data-ttu-id="98c11-192">**ordinateur$@domain** ou **hôte\FQDN** pour un compte de domaine d’ordinateur tel que Système Local ou SERVICES RÉSEAU.</span><span class="sxs-lookup"><span data-stu-id="98c11-192">**machine$@domain** or **host\FQDN** for a computer domain account such as Local System or NETWORK SERVICES.</span></span>  
  
 <span data-ttu-id="98c11-193">Pour déterminer la méthode d'authentification d'une connexion, exécutez la requête suivante.</span><span class="sxs-lookup"><span data-stu-id="98c11-193">To determine the authentication method of a connection, execute the following query.</span></span>  
  
```sql  
SELECT net_transport, auth_scheme   
FROM sys.dm_exec_connections   
WHERE session_id = @@SPID;  
```  
  
##  <a name="authentication-defaults"></a><a name="Defaults"></a> <span data-ttu-id="98c11-194">Paramètres par défaut de l'authentification</span><span class="sxs-lookup"><span data-stu-id="98c11-194">Authentication Defaults</span></span>  
 <span data-ttu-id="98c11-195">Le tableau suivant décrit les paramètres d'authentification par défaut utilisés selon les scénarios d'inscription de SPN.</span><span class="sxs-lookup"><span data-stu-id="98c11-195">The following table describes the authentication defaults that are used based on SPN registration scenarios.</span></span>  
  
|<span data-ttu-id="98c11-196">Scénario</span><span class="sxs-lookup"><span data-stu-id="98c11-196">Scenario</span></span>|<span data-ttu-id="98c11-197">Méthode d'authentification</span><span class="sxs-lookup"><span data-stu-id="98c11-197">Authentication method</span></span>|  
|--------------|---------------------------|  
|<span data-ttu-id="98c11-198">Le SPN est mappé au compte de domaine, au compte virtuel, au compte de service administré ou au compte intégré approprié.</span><span class="sxs-lookup"><span data-stu-id="98c11-198">The SPN maps to the correct domain account, virtual account, MSA, or built-in account.</span></span> <span data-ttu-id="98c11-199">Par exemple, Système local ou SERVICE RÉSEAU.</span><span class="sxs-lookup"><span data-stu-id="98c11-199">For example, Local System or NETWORK SERVICE.</span></span><br /><br /> <span data-ttu-id="98c11-200">Remarque : l’exactitude signifie que le compte mappé par le SPN inscrit est le compte sous lequel le service SQL Server s’exécute.</span><span class="sxs-lookup"><span data-stu-id="98c11-200">Note: Correct means that the account mapped by the registered SPN is the account that the SQL Server service is running under.</span></span>|<span data-ttu-id="98c11-201">Les connexions locales utilisent NTLM, les connexions distantes utilisent Kerberos.</span><span class="sxs-lookup"><span data-stu-id="98c11-201">Local connections use NTLM, remote connections use Kerberos.</span></span>|  
|<span data-ttu-id="98c11-202">Le SPN est le compte de domaine, le compte virtuel, le compte de service administré ou le compte intégré approprié.</span><span class="sxs-lookup"><span data-stu-id="98c11-202">The SPN is the correct domain account, virtual account, MSA, or built-in account.</span></span><br /><br /> <span data-ttu-id="98c11-203">Remarque : l’exactitude signifie que le compte mappé par le SPN inscrit est le compte sous lequel le service SQL Server s’exécute.</span><span class="sxs-lookup"><span data-stu-id="98c11-203">Note: Correct means that the account mapped by the registered SPN is the account that the SQL Server service is running under.</span></span>|<span data-ttu-id="98c11-204">Les connexions locales utilisent NTLM, les connexions distantes utilisent Kerberos.</span><span class="sxs-lookup"><span data-stu-id="98c11-204">Local connections use NTLM, remote connections use Kerberos.</span></span>|  
|<span data-ttu-id="98c11-205">Le SPN est mappé à un compte de domaine, un compte virtuel, un compte de service administré ou un compte intégré erroné.</span><span class="sxs-lookup"><span data-stu-id="98c11-205">The SPN maps to an incorrect domain account, virtual account, MSA, or built-in account</span></span>|<span data-ttu-id="98c11-206">L'authentification échoue.</span><span class="sxs-lookup"><span data-stu-id="98c11-206">Authentication fails.</span></span>|  
|<span data-ttu-id="98c11-207">La recherche du SPN échoue ou ne mappe pas à un compte de domaine, un compte virtuel, un compte de service administré ou un compte intégré correct, ou n'est pas un compte de domaine, un compte virtuel, un compte de service administré ou un compte intégré correct.</span><span class="sxs-lookup"><span data-stu-id="98c11-207">The SPN lookup fails or does not map to a correct domain account, virtual account, MSA, or built-in account, or is not a correct domain account, virtual account, MSA, or built-in account.</span></span>|<span data-ttu-id="98c11-208">Les connexions locales et distantes utilisent NTLM.</span><span class="sxs-lookup"><span data-stu-id="98c11-208">Local and remote connections use NTLM.</span></span>|  
  
##  <a name="comments"></a><a name="Comments"></a> <span data-ttu-id="98c11-209">Commentaires</span><span class="sxs-lookup"><span data-stu-id="98c11-209">Comments</span></span>  
 <span data-ttu-id="98c11-210">La connexion administrateur dédiée utilise un SPN basé sur un nom d'instance.</span><span class="sxs-lookup"><span data-stu-id="98c11-210">The Dedicated Administrator Connection (DAC) uses an instance name based SPN.</span></span> <span data-ttu-id="98c11-211">L'authentification Kerberos peut être utilisée avec une connexion DAC si l'inscription de ce SPN réussit.</span><span class="sxs-lookup"><span data-stu-id="98c11-211">Kerberos authentication can be used with a DAC if that SPN is registered successfully.</span></span> <span data-ttu-id="98c11-212">En guise d'alternative, un utilisateur peut spécifier le nom du compte comme SPN.</span><span class="sxs-lookup"><span data-stu-id="98c11-212">As an alternative a user can specify the account name as an SPN.</span></span>  
  
 <span data-ttu-id="98c11-213">Si l’inscription du nom SPN échoue au démarrage, cet échec est consigné dans le journal des erreurs de [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] et le démarrage se poursuit.</span><span class="sxs-lookup"><span data-stu-id="98c11-213">If SPN registration fails during startup, this failure is recorded in the [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] error log, and startup continues.</span></span>  
  
 <span data-ttu-id="98c11-214">Si l'annulation de l'inscription du SPN échoue pendant l'arrêt, cet échec est consigné dans le journal des erreurs de [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] et l'arrêt se poursuit.</span><span class="sxs-lookup"><span data-stu-id="98c11-214">If SPN de-registration fails during shutdown, this failure is recorded in the [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] error log, and shutdown continues.</span></span>  
  
## <a name="see-also"></a><span data-ttu-id="98c11-215">Voir aussi</span><span class="sxs-lookup"><span data-stu-id="98c11-215">See Also</span></span>  
 <span data-ttu-id="98c11-216">[Prise en charge des noms de principaux du service &#40;noms SPN&#41; dans les connexions clientes](../../relational-databases/native-client/features/service-principal-name-spn-support-in-client-connections.md) </span><span class="sxs-lookup"><span data-stu-id="98c11-216">[Service Principal Name &#40;SPN&#41; Support in Client Connections](../../relational-databases/native-client/features/service-principal-name-spn-support-in-client-connections.md) </span></span>  
 <span data-ttu-id="98c11-217">[Noms de principaux du service &#40;noms SPN&#41; dans les connexions clientes &#40;OLE DB&#41;](../../relational-databases/native-client/ole-db/service-principal-names-spns-in-client-connections-ole-db.md) </span><span class="sxs-lookup"><span data-stu-id="98c11-217">[Service Principal Names &#40;SPNs&#41; in Client Connections &#40;OLE DB&#41;](../../relational-databases/native-client/ole-db/service-principal-names-spns-in-client-connections-ole-db.md) </span></span>  
 <span data-ttu-id="98c11-218">[Noms de principaux du service &#40;noms SPN&#41; dans les connexions clientes &#40;ODBC&#41;](../../relational-databases/native-client/odbc/service-principal-names-spns-in-client-connections-odbc.md) </span><span class="sxs-lookup"><span data-stu-id="98c11-218">[Service Principal Names &#40;SPNs&#41; in Client Connections &#40;ODBC&#41;](../../relational-databases/native-client/odbc/service-principal-names-spns-in-client-connections-odbc.md) </span></span>  
 <span data-ttu-id="98c11-219">[Fonctionnalités de SQL Server Native Client](../../relational-databases/native-client/features/sql-server-native-client-features.md) </span><span class="sxs-lookup"><span data-stu-id="98c11-219">[SQL Server Native Client Features](../../relational-databases/native-client/features/sql-server-native-client-features.md) </span></span>  
 [<span data-ttu-id="98c11-220">Gérer les problèmes d’authentification Kerberos dans un environnement Reporting Services</span><span class="sxs-lookup"><span data-stu-id="98c11-220">Manage Kerberos Authentication Issues in a Reporting Services Environment</span></span>](https://technet.microsoft.com/library/ff679930.aspx)  
  
  
