---
title: affinity mask (option de configuration de serveur) | Microsoft Docs
ms.custom: ''
ms.date: 10/20/2016
ms.prod: sql-server-2014
ms.reviewer: ''
ms.technology: configuration
ms.topic: conceptual
helpviewer_keywords:
- default affinity mask option
- reloading processor cache
- processor cache [SQL Server]
- CPU [SQL Server], licensing
- deferred process call
- affinity mask option
- processor affinity [SQL Server]
- SMP
- DPC
ms.assetid: 5823ba29-a75d-4b3e-ba7b-421c07ab3ac1
author: MikeRayMSFT
ms.author: mikeray
ms.openlocfilehash: dfebde8a9431026e8faedb2a1e76eb2f2d82e207
ms.sourcegitcommit: ad4d92dce894592a259721a1571b1d8736abacdb
ms.translationtype: MT
ms.contentlocale: fr-FR
ms.lasthandoff: 08/04/2020
ms.locfileid: "87611307"
---
# <a name="affinity-mask-server-configuration-option"></a><span data-ttu-id="1edbc-102">affinity mask (option de configuration de serveur)</span><span class="sxs-lookup"><span data-stu-id="1edbc-102">affinity mask Server Configuration Option</span></span>
    
> [!NOTE]  
>  [!INCLUDE[ssNoteDepFutureDontUse](../../includes/ssnotedepfuturedontuse-md.md)] <span data-ttu-id="1edbc-103">Utilisez plutôt [ALTER SERVER CONFIGURATION &#40;Transact-SQL&#41;](/sql/t-sql/statements/alter-server-configuration-transact-sql).</span><span class="sxs-lookup"><span data-stu-id="1edbc-103">Use [ALTER SERVER CONFIGURATION &#40;Transact-SQL&#41;](/sql/t-sql/statements/alter-server-configuration-transact-sql) instead.</span></span>  
  
 <span data-ttu-id="1edbc-104">Pour réaliser les travaux multitâches, [!INCLUDE[msCoName](../../includes/msconame-md.md)] Windows déplace parfois les threads de processus entre les différents processeurs.</span><span class="sxs-lookup"><span data-stu-id="1edbc-104">To carry out multitasking, [!INCLUDE[msCoName](../../includes/msconame-md.md)] Windows sometimes move process threads among different processors.</span></span> <span data-ttu-id="1edbc-105">Même si cela est efficace du point de vue du système d'exploitation, cette activité peut réduire les performances de [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] du fait des charges système élevées, puisque chaque cache de processeur est rechargé par des données de façon répétée.</span><span class="sxs-lookup"><span data-stu-id="1edbc-105">Although efficient from an operating system point of view, this activity can reduce [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] performance under heavy system loads, as each processor cache is repeatedly reloaded with data.</span></span> <span data-ttu-id="1edbc-106">L'affectation de processeurs à des threads spécifiques permet d'améliorer les performances dans ces conditions en éliminant les rechargements de processeurs et en réduisant la migration des threads entre les processeurs (réduisant ainsi les changements de contexte) ; une telle association entre un thread et un processeur est appelée affinité du processeur.</span><span class="sxs-lookup"><span data-stu-id="1edbc-106">Assigning processors to specific threads can improve performance under these conditions by eliminating processor reloads and reducing thread migration across processors (thereby reducing context switching); such an association between a thread and a processor is called processor affinity.</span></span>  
  
 [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)]<span data-ttu-id="1edbc-107">prend en charge l’affinité du processeur par le biais de deux options de masque d’affinité : Affinity Mask (également appelé le **masque d’affinité**de l’UC) et Affinity I/O mask.</span><span class="sxs-lookup"><span data-stu-id="1edbc-107">supports processor affinity by means of two affinity mask options: affinity mask (also known as **CPU affinity mask**) and affinity I/O mask.</span></span> <span data-ttu-id="1edbc-108">Pour plus d’informations sur l’option affinity I/O mask, consultez [affinity Input-Output mask (option de configuration de serveur)](affinity-input-output-mask-server-configuration-option.md).</span><span class="sxs-lookup"><span data-stu-id="1edbc-108">For more information on the affinity I/O maskoption, see [affinity Input-Output mask Server Configuration Option](affinity-input-output-mask-server-configuration-option.md).</span></span> <span data-ttu-id="1edbc-109">La prise en charge de l’affinité du processeur et d’E/S pour les serveurs dotés de 33 à 64 processeurs nécessite l’utilisation supplémentaire de l’[option de configuration de serveur affinity64 mask](affinity64-mask-server-configuration-option.md) et de l’[option de configuration du serveur affinity64 Input-Output mask](affinity64-input-output-mask-server-configuration-option.md), respectivement.</span><span class="sxs-lookup"><span data-stu-id="1edbc-109">CPU and I/O affinity support for servers with 33 to 64 processors requires the additional use of the [affinity64 mask Server Configuration Option](affinity64-mask-server-configuration-option.md) and [affinity64 Input-Output mask Server Configuration Option](affinity64-input-output-mask-server-configuration-option.md), respectively.</span></span>  
  
> [!NOTE]  
>  <span data-ttu-id="1edbc-110">La prise en charge de l'affinité pour les serveurs dotés de 33 à 64 processeurs est uniquement disponible sur les systèmes d'exploitation 64 bits.</span><span class="sxs-lookup"><span data-stu-id="1edbc-110">Affinity support for servers with 33 to 64 processors is only available on 64-bit operating systems.</span></span>  
  
 <span data-ttu-id="1edbc-111">L'option affinity mask, qui existait dans les versions antérieures de [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)], contrôle dynamiquement l'affinité du processeur.</span><span class="sxs-lookup"><span data-stu-id="1edbc-111">The affinity mask option, which existed in earlier releases of [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)], dynamically controls CPU affinity.</span></span>  
  
 <span data-ttu-id="1edbc-112">Dans [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)], l'option affinity mask peut être configurée sans exiger le redémarrage de l'instance de [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)].</span><span class="sxs-lookup"><span data-stu-id="1edbc-112">In [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)], the affinity mask option can be configured without requiring a restart of the instance of [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)].</span></span> <span data-ttu-id="1edbc-113">Lorsque vous utilisez sp_configure, vous devez exécuter RECONFIGURE ou RECONFIGURE WITH OVERRIDE après la définition d'une option de configuration.</span><span class="sxs-lookup"><span data-stu-id="1edbc-113">When you are using sp_configure, you must run either RECONFIGURE or RECONFIGURE WITH OVERRIDE after setting a configuration option.</span></span> <span data-ttu-id="1edbc-114">Si vous utilisez [!INCLUDE[ssExpress](../../includes/ssexpress-md.md)], la modification de l'option de masque d'affinité ne nécessite aucun redémarrage.</span><span class="sxs-lookup"><span data-stu-id="1edbc-114">When you are using [!INCLUDE[ssExpress](../../includes/ssexpress-md.md)], changing the affinity mask option does require a restart.</span></span>  
  
 <span data-ttu-id="1edbc-115">Les modifications apportées aux masques d'affinité s'exécutent dynamiquement, autorisant ainsi le démarrage et l'arrêt à la demande des planificateurs d'UC qui lient les threads de processus au sein de [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)].</span><span class="sxs-lookup"><span data-stu-id="1edbc-115">Changes to the affinity masks occur dynamically, allowing for on-demand startup and shutdown of the CPU schedulers that bind process threads within [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)].</span></span> <span data-ttu-id="1edbc-116">Cela peut se produire en cas de changement des conditions sur le serveur.</span><span class="sxs-lookup"><span data-stu-id="1edbc-116">This can occur as conditions change on the server.</span></span> <span data-ttu-id="1edbc-117">Par exemple, si une nouvelle instance de [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] est ajoutée au serveur, il peut être nécessaire d'ajuster l'option affinity mask afin de redistribuer la charge des processeurs.</span><span class="sxs-lookup"><span data-stu-id="1edbc-117">For example, if a new instance of [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] is added to the server, it may be necessary to make adjustments to the affinity mask option to redistribute processor load.</span></span>  
  
 <span data-ttu-id="1edbc-118">Les modifications apportées aux masques de bits d'affinité nécessitent que [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] active un nouveau planificateur d'UC et désactive le planificateur d'UC existant.</span><span class="sxs-lookup"><span data-stu-id="1edbc-118">Modifications to the affinity bitmasks require [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] to enable a new CPU scheduler and disable the existing CPU scheduler.</span></span> <span data-ttu-id="1edbc-119">Les nouveaux traitements peuvent alors être traités sur le nouveau planificateur ou sur les planificateurs restants.</span><span class="sxs-lookup"><span data-stu-id="1edbc-119">New batches can then be processed on the new or remaining schedulers.</span></span>  
  
 <span data-ttu-id="1edbc-120">Pour lancer un nouveau planificateur d'UC, [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] crée un nouveau planificateur et l'ajoute à la liste de ses planificateurs standard.</span><span class="sxs-lookup"><span data-stu-id="1edbc-120">To start a new CPU scheduler, [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] creates a new scheduler and adds it to the list of its standard schedulers.</span></span> <span data-ttu-id="1edbc-121">Le nouveau planificateur n'est pris en compte que pour les nouveaux traitements entrants.</span><span class="sxs-lookup"><span data-stu-id="1edbc-121">The new scheduler is considered only for the new incoming batches.</span></span> <span data-ttu-id="1edbc-122">Les traitements en cours continuent de s'exécuter sur le même planificateur.</span><span class="sxs-lookup"><span data-stu-id="1edbc-122">Current batches continue to run on the same scheduler.</span></span> <span data-ttu-id="1edbc-123">Les threads de travail migrent vers le nouveau planificateur lorsqu'ils sont libérés, ou lorsque de nouveaux threads de travail sont créés.</span><span class="sxs-lookup"><span data-stu-id="1edbc-123">The workers migrate to the new scheduler as they free up, or as new workers are created.</span></span>  
  
 <span data-ttu-id="1edbc-124">L'arrêt d'un planificateur exige l'achèvement et la clôture des activités de tous les traitements sur le planificateur.</span><span class="sxs-lookup"><span data-stu-id="1edbc-124">Shutting down a scheduler requires all batches on the scheduler to complete their activities and exit.</span></span> <span data-ttu-id="1edbc-125">Un planificateur arrêté est marqué hors ligne afin qu'aucun nouveau traitement ne soit planifié sur celui-ci.</span><span class="sxs-lookup"><span data-stu-id="1edbc-125">A scheduler that has been shut down is marked as offline so that no new batch is scheduled on it.</span></span>  
  
 <span data-ttu-id="1edbc-126">Qu'un nouveau planificateur soit ajouté ou supprimé, les tâches système permanentes, telles que lockmonitor, checkpoint, system task yhread (processing DTC) et signal process, continuent de s'exécuter sur le planificateur alors que le serveur est opérationnel.</span><span class="sxs-lookup"><span data-stu-id="1edbc-126">Whether a new scheduler is added or removed, the permanent system tasks such as lockmonitor, checkpoint, system task thread (processing DTC), and signal process continue to run on the scheduler while the server is operational.</span></span> <span data-ttu-id="1edbc-127">Ces tâches système permanentes ne migrent pas dynamiquement.</span><span class="sxs-lookup"><span data-stu-id="1edbc-127">These permanent system tasks do not dynamically migrate.</span></span> <span data-ttu-id="1edbc-128">Si vous souhaitez redistribuer la charge des processeurs pour ces tâches systèmes entre les planificateurs, il est nécessaire de redémarrer l'instance de [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] .</span><span class="sxs-lookup"><span data-stu-id="1edbc-128">To redistribute processor load for these system tasks across schedulers, it is necessary to restart the [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] instance.</span></span> <span data-ttu-id="1edbc-129">Si [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] tente d'arrêter un planificateur associé à une tâche système permanente, la tâche continue de s'exécuter sur le planificateur hors ligne (aucune migration).</span><span class="sxs-lookup"><span data-stu-id="1edbc-129">If [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] attempts to shut down a scheduler associated with a permanent system task, the task continues to run on the offline scheduler (no migration).</span></span> <span data-ttu-id="1edbc-130">Ce planificateur est lié aux processeurs dans le masque d'affinité modifié et ne doit imposer aucune charge au processeur avec lequel il avait une affinité avant la modification.</span><span class="sxs-lookup"><span data-stu-id="1edbc-130">This scheduler is bound to the processors in the modified affinity mask and should not put any load on the processor it was affinitized with before the change.</span></span> <span data-ttu-id="1edbc-131">Le fait de disposer de planificateurs hors ligne supplémentaires n'affecte pas vraiment la charge du système.</span><span class="sxs-lookup"><span data-stu-id="1edbc-131">Having extra offline schedulers, should not significantly affect the load of the system.</span></span> <span data-ttu-id="1edbc-132">Si ce n'est pas le cas, il est nécessaire de redémarrer le serveur de bases de données pour reconfigurer ces tâches.</span><span class="sxs-lookup"><span data-stu-id="1edbc-132">If this is not the case, a database server reboot is required to reconfigure these tasks.</span></span>  
  
 <span data-ttu-id="1edbc-133">Les tâches d'affinité d'E/S (telles que lazywriter et logwriter) sont directement affectées par le masque d'affinité d'E/S.</span><span class="sxs-lookup"><span data-stu-id="1edbc-133">The I/O affinity tasks (such as lazywriter and logwriter) are directly affected by the I/O affinity mask.</span></span> <span data-ttu-id="1edbc-134">Si les tâches lazywriter et logwriter ne possèdent pas d'affinité, elles respectent les mêmes règles que celles définies pour les tâches permanentes telles que lockmonitor ou checkpoint.</span><span class="sxs-lookup"><span data-stu-id="1edbc-134">If the lazywriter and logwriter tasks are not affinitized, they follow the same rules defined for the other permanent tasks such as lockmonitor or checkpoint.</span></span>  
  
 <span data-ttu-id="1edbc-135">Pour vous assurer que le nouveau masque d'affinité est valide, la commande RECONFIGURE vérifie que les affinités du processeur et d'E/S normales s'excluent mutuellement.</span><span class="sxs-lookup"><span data-stu-id="1edbc-135">To ensure that the new affinity mask is valid, the RECONFIGURE command verifies that the normal CPU and I/O affinities are mutually exclusive.</span></span> <span data-ttu-id="1edbc-136">Si ce n'est pas le cas, un message d'erreur est envoyé à la session cliente et consigné dans le journal des erreurs [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] pour indiquer qu'un tel paramètre n'est pas recommandé.</span><span class="sxs-lookup"><span data-stu-id="1edbc-136">If this is not the case, an error message is reported to the client session and to the [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] error log, indicating that such a setting is not recommended.</span></span> <span data-ttu-id="1edbc-137">L'exécution des options RECONFIGURE WITH OVERRIDE autorise les affinités du processeur et celles d'E/S qui ne s'excluent pas mutuellement.</span><span class="sxs-lookup"><span data-stu-id="1edbc-137">Running RECONFIGURE WITH OVERRIDE options allows CPU and I/O affinities that are not mutually exclusive.</span></span>  
  
 <span data-ttu-id="1edbc-138">Si vous spécifiez un masque d'affinité qui tente d'effectuer un mappage à une UC inexistante, la commande RECONFIGURE envoie un message d'erreur à la session cliente et le consigne dans le journal des erreurs [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] .</span><span class="sxs-lookup"><span data-stu-id="1edbc-138">If you specify an affinity mask that attempts to map to a nonexistent CPU, the RECONFIGURE command reports an error message to both the client session and the [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] error log.</span></span> <span data-ttu-id="1edbc-139">L'utilisation de l'option RECONFIGURE WITH OVERRIDE n'a aucun effet dans ce cas, et la même erreur de configuration est à nouveau signalée.</span><span class="sxs-lookup"><span data-stu-id="1edbc-139">Using the RECONFIGURE WITH OVERRIDE option has no effect in this case, and the same configuration error is reported again.</span></span>  
  
 <span data-ttu-id="1edbc-140">Vous pouvez également exclure l'activité propre à [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] des processeurs auxquels le système d'exploitation Windows 2000 ou Windows Server 2003 attribue des charges de travail données.</span><span class="sxs-lookup"><span data-stu-id="1edbc-140">You can also exclude [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] activity from processors assigned specific workload assignments by the Windows 2000 or Windows Server 2003 operating system.</span></span> <span data-ttu-id="1edbc-141">En attribuant la valeur 1 à un bit qui représente un processeur, ce processeur est sélectionné par le moteur de base de données [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] pour l'affectation des threads.</span><span class="sxs-lookup"><span data-stu-id="1edbc-141">If you set a bit representing a processor to 1, that processor is selected by the [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] Database Engine for thread assignment.</span></span> <span data-ttu-id="1edbc-142">Lorsque vous affectez la valeur `affinity mask` 0 (valeur par défaut), les algorithmes de planification de Microsoft windows 2000 ou de Windows Server 2003 définissent l’affinité du thread.</span><span class="sxs-lookup"><span data-stu-id="1edbc-142">When you set `affinity mask` to 0 (the default), the Microsoft Windows 2000 or Windows Server 2003 scheduling algorithms set the thread's affinity.</span></span> <span data-ttu-id="1edbc-143">Si vous attribuez à `affinity mask` une valeur différente de zéro, l'affinité [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] interprète cette valeur comme étant un masque de bits indiquant que ces processeurs sont ceux sur lesquels doit porter la sélection.</span><span class="sxs-lookup"><span data-stu-id="1edbc-143">When you set `affinity mask` to any nonzero value, [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] affinity interprets the value as a bitmask that specifies those processors eligible for selection.</span></span>  
  
 <span data-ttu-id="1edbc-144">La non-exécution des threads [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] sur des processeurs particuliers permet à Microsoft Windows 2000 ou Windows Server 2003 de mieux évaluer la gestion par le système de traitement des processus propres à Windows.</span><span class="sxs-lookup"><span data-stu-id="1edbc-144">By segregating [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] threads from running on particular processors, Microsoft Windows 2000 or Windows Server 2003 can better evaluate the system's handling of processes specific to Windows.</span></span> <span data-ttu-id="1edbc-145">Par exemple, sur un serveur à 8 processeurs exécutant deux instances de [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] (instances A et B), l'administrateur système peut utiliser l'option affinity mask pour affecter le premier jeu de 4 processeurs à l'instance A et le deuxième jeu de 4 processeurs à l'instance B. Pour configurer plus de 32 processeurs, définissez à la fois affinity mask et affinity64 mask.</span><span class="sxs-lookup"><span data-stu-id="1edbc-145">For example, on an 8-CPU server running two instances of [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] (instance A and B), the system administrator could use the affinity mask option to assign the first set of 4 CPUs to instance A and the second set of 4 to instance B. To configure more than 32 processors, set both the affinity mask and the affinity64 mask.</span></span> <span data-ttu-id="1edbc-146">Les valeurs de l'option `affinity mask` sont les suivantes :</span><span class="sxs-lookup"><span data-stu-id="1edbc-146">The values for `affinity mask` are as follows:</span></span>  
  
-   <span data-ttu-id="1edbc-147">Un `affinity mask` à un octet prend en charge jusqu'à 8 processeurs sur un ordinateur multiprocesseur.</span><span class="sxs-lookup"><span data-stu-id="1edbc-147">A one-byte `affinity mask` covers up to 8 CPUs in a multiprocessor computer.</span></span>  
  
-   <span data-ttu-id="1edbc-148">Un `affinity mask` à deux octets prend en charge jusqu'à 16 processeurs sur un ordinateur multiprocesseur.</span><span class="sxs-lookup"><span data-stu-id="1edbc-148">A two-byte `affinity mask` covers up to 16 CPUs in a multiprocessor computer.</span></span>  
  
-   <span data-ttu-id="1edbc-149">Un `affinity mask` à trois octets prend en charge jusqu'à 24 processeurs sur un ordinateur multiprocesseur.</span><span class="sxs-lookup"><span data-stu-id="1edbc-149">A three-byte `affinity mask` covers up to 24 CPUs in a multiprocessor computer.</span></span>  
  
-   <span data-ttu-id="1edbc-150">Un `affinity mask` à quatre octets prend en charge jusqu'à 32 processeurs sur un ordinateur multiprocesseur.</span><span class="sxs-lookup"><span data-stu-id="1edbc-150">A four-byte `affinity mask` covers up to 32 CPUs in a multiprocessor computer.</span></span>  
  
-   <span data-ttu-id="1edbc-151">Si vous disposez de plus de 32 processeurs, configurez un masque d'affinité à quatre octets pour les 32 premiers processeurs et un masque d'affinity64 à quatre octets pour les processeurs restants.</span><span class="sxs-lookup"><span data-stu-id="1edbc-151">To cover more than 32 CPUs, configure a four-byte affinity mask for the first 32 CPUs and up to a four-byte affinity64 mask for the remaining CPUs.</span></span>  
  
 <span data-ttu-id="1edbc-152">Étant donné que la définition de l'affinité du processeur de [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] est une opération spécialisée, il est recommandé de n'utiliser cette option que lorsque cela est véritablement nécessaire.</span><span class="sxs-lookup"><span data-stu-id="1edbc-152">Because setting [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] processor affinity is a specialized operation, it is recommended that it be used only when necessary.</span></span> <span data-ttu-id="1edbc-153">Dans la plupart des cas, l'option d'affinité par défaut de Microsoft Windows 2000 ou Windows Server 2003 offre des performances optimales.</span><span class="sxs-lookup"><span data-stu-id="1edbc-153">In most cases, the Microsoft Windows 2000 or Windows Server 2003 default affinity provides the best performance.</span></span> <span data-ttu-id="1edbc-154">Lors de la définition des masques d'affinité, tenez également compte des exigences des autres applications en matière de processeurs.</span><span class="sxs-lookup"><span data-stu-id="1edbc-154">You should also consider the CPU requirements for other applications when setting the affinity masks.</span></span> <span data-ttu-id="1edbc-155">Pour plus d'informations, consultez la documentation du système d'exploitation Windows.</span><span class="sxs-lookup"><span data-stu-id="1edbc-155">For more information, see your Windows operating system documentation.</span></span>  
  
> [!NOTE]  
>  <span data-ttu-id="1edbc-156">Vous pouvez utiliser le Moniteur système Windows pour afficher et analyser l'utilisation des processeurs individuels.</span><span class="sxs-lookup"><span data-stu-id="1edbc-156">You can use the Windows System Monitor to view and analyze individual processor usage.</span></span>  
  
 <span data-ttu-id="1edbc-157">Si vous spécifiez l'option affinityI/O mask, vous devez l'utiliser conjointement avec l'option de configuration affinity mask.</span><span class="sxs-lookup"><span data-stu-id="1edbc-157">When specifying the affinity I/O mask option, you must use it in connection with the affinity mask configuration option.</span></span> <span data-ttu-id="1edbc-158">Évitez d'activer sur le même processeur le commutateur `affinity mask` et l'option affinity I/O mask.</span><span class="sxs-lookup"><span data-stu-id="1edbc-158">Do not enable the same CPU in both the `affinity mask` switch and the affinity I/O mask option.</span></span> <span data-ttu-id="1edbc-159">Les bits correspondant à chaque processeur doivent être dans l'un des trois états suivants :</span><span class="sxs-lookup"><span data-stu-id="1edbc-159">The bits corresponding to each CPU should be in one of these three states:</span></span>  
  
-   <span data-ttu-id="1edbc-160">0 dans l'option affinity mask et dans l'option affinity I/O mask.</span><span class="sxs-lookup"><span data-stu-id="1edbc-160">0 in both the affinity mask option and the affinity I/O mask option.</span></span>  
  
-   <span data-ttu-id="1edbc-161">1 dans l'option affinity mask et 0 dans l'option affinity I/O mask.</span><span class="sxs-lookup"><span data-stu-id="1edbc-161">1 in the affinity mask option and 0 in the affinity I/O mask option.</span></span>  
  
-   <span data-ttu-id="1edbc-162">0 dans l'option affinity mask et 1 dans l'option affinity I/O mask.</span><span class="sxs-lookup"><span data-stu-id="1edbc-162">0 in the affinity mask option and 1 in the affinity I/O mask option.</span></span>  
  
> [!CAUTION]  
>  <span data-ttu-id="1edbc-163">Évitez de configurer l'affinité de processeur dans le système d'exploitation Windows et le masque d'affinité dans [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)].</span><span class="sxs-lookup"><span data-stu-id="1edbc-163">Do not configure CPU affinity in the Windows operating system and also configure the affinity mask in [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)].</span></span> <span data-ttu-id="1edbc-164">Ces paramètres tentent d'obtenir le même résultat et, si les configurations sont incohérentes, les résultats risquent d'être imprévisibles.</span><span class="sxs-lookup"><span data-stu-id="1edbc-164">These settings are attempting to achieve the same result, and if the configurations are inconsistent, you may have unpredictable results.</span></span> [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] <span data-ttu-id="1edbc-165">Il est préférable de configurer l’affinité de processeur à l’aide de l’option sp_configure dans [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)].</span><span class="sxs-lookup"><span data-stu-id="1edbc-165">CPU affinity is best configured using the sp_configure option in [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)].</span></span>  
  
## <a name="example"></a><span data-ttu-id="1edbc-166">Exemple</span><span class="sxs-lookup"><span data-stu-id="1edbc-166">Example</span></span>  
 <span data-ttu-id="1edbc-167">Par exemple, pour définir l'option affinity mask, si les processeurs 1, 2 et 5 sont sélectionnés comme étant disponibles et si les bits 1, 2 et 5 ont la valeur 1 alors que les bits 0, 3, 4, 6 et 7 ont la valeur 0, une valeur hexadécimale égale à 0x26 ou l'équivalent décimal `38` est spécifiée.</span><span class="sxs-lookup"><span data-stu-id="1edbc-167">As an example of setting the affinity mask option, if processors 1, 2, and 5 are selected as available with bits 1, 2, and 5 set to 1 and bits 0, 3, 4, 6, and 7 set to 0, a hexadecimal value of 0x26 or the decimal equivalent of `38` is specified.</span></span> <span data-ttu-id="1edbc-168">Numérotez les bits de droite à gauche.</span><span class="sxs-lookup"><span data-stu-id="1edbc-168">Number the bits from right to left.</span></span> <span data-ttu-id="1edbc-169">L'option affinity mask commence à compter les processeurs de 0 à 31, de sorte que dans l'exemple suivant, le compteur `1` représente le deuxième processeur sur le serveur.</span><span class="sxs-lookup"><span data-stu-id="1edbc-169">The affinity mask option starts counting processors from 0 to 31, so that in the following example the counter `1` represents the second processor on the server.</span></span>  
  
```  
sp_configure 'show advanced options', 1;  
RECONFIGURE;  
GO  
sp_configure 'affinity mask', 38;  
RECONFIGURE;  
GO  
```  
  
 <span data-ttu-id="1edbc-170">Vous trouverez ci-dessous les valeurs de l'option `affinity mask` pour un système à 8 processeurs.</span><span class="sxs-lookup"><span data-stu-id="1edbc-170">These are `affinity mask` values for an 8-CPU system.</span></span>  
  
|<span data-ttu-id="1edbc-171">Valeur décimale</span><span class="sxs-lookup"><span data-stu-id="1edbc-171">Decimal value</span></span>|<span data-ttu-id="1edbc-172">Masque binaire</span><span class="sxs-lookup"><span data-stu-id="1edbc-172">Binary bit mask</span></span>|<span data-ttu-id="1edbc-173">Autorise les threads SQL Server sur les processeurs</span><span class="sxs-lookup"><span data-stu-id="1edbc-173">Allow SQL Server threads on processors</span></span>|  
|-------------------|---------------------|--------------------------------------------|  
|<span data-ttu-id="1edbc-174">1</span><span class="sxs-lookup"><span data-stu-id="1edbc-174">1</span></span>|<span data-ttu-id="1edbc-175">00000001</span><span class="sxs-lookup"><span data-stu-id="1edbc-175">00000001</span></span>|<span data-ttu-id="1edbc-176">0</span><span class="sxs-lookup"><span data-stu-id="1edbc-176">0</span></span>|  
|<span data-ttu-id="1edbc-177">3</span><span class="sxs-lookup"><span data-stu-id="1edbc-177">3</span></span>|<span data-ttu-id="1edbc-178">00000011</span><span class="sxs-lookup"><span data-stu-id="1edbc-178">00000011</span></span>|<span data-ttu-id="1edbc-179">0 et 1</span><span class="sxs-lookup"><span data-stu-id="1edbc-179">0 and 1</span></span>|  
|<span data-ttu-id="1edbc-180">7</span><span class="sxs-lookup"><span data-stu-id="1edbc-180">7</span></span>|<span data-ttu-id="1edbc-181">00000111</span><span class="sxs-lookup"><span data-stu-id="1edbc-181">00000111</span></span>|<span data-ttu-id="1edbc-182">0, 1 et 2</span><span class="sxs-lookup"><span data-stu-id="1edbc-182">0, 1, and 2</span></span>|  
|<span data-ttu-id="1edbc-183">15</span><span class="sxs-lookup"><span data-stu-id="1edbc-183">15</span></span>|<span data-ttu-id="1edbc-184">00001111</span><span class="sxs-lookup"><span data-stu-id="1edbc-184">00001111</span></span>|<span data-ttu-id="1edbc-185">0, 1, 2 et 3</span><span class="sxs-lookup"><span data-stu-id="1edbc-185">0, 1, 2, and 3</span></span>|  
|<span data-ttu-id="1edbc-186">31</span><span class="sxs-lookup"><span data-stu-id="1edbc-186">31</span></span>|<span data-ttu-id="1edbc-187">00011111</span><span class="sxs-lookup"><span data-stu-id="1edbc-187">00011111</span></span>|<span data-ttu-id="1edbc-188">0, 1, 2, 3 et 4</span><span class="sxs-lookup"><span data-stu-id="1edbc-188">0, 1, 2, 3, and 4</span></span>|  
|<span data-ttu-id="1edbc-189">63</span><span class="sxs-lookup"><span data-stu-id="1edbc-189">63</span></span>|<span data-ttu-id="1edbc-190">00111111</span><span class="sxs-lookup"><span data-stu-id="1edbc-190">00111111</span></span>|<span data-ttu-id="1edbc-191">0, 1, 2, 3, 4 et 5</span><span class="sxs-lookup"><span data-stu-id="1edbc-191">0, 1, 2, 3, 4, and 5</span></span>|  
|<span data-ttu-id="1edbc-192">127</span><span class="sxs-lookup"><span data-stu-id="1edbc-192">127</span></span>|<span data-ttu-id="1edbc-193">01111111</span><span class="sxs-lookup"><span data-stu-id="1edbc-193">01111111</span></span>|<span data-ttu-id="1edbc-194">0, 1, 2, 3, 4, 5 et 6</span><span class="sxs-lookup"><span data-stu-id="1edbc-194">0, 1, 2, 3, 4, 5, and 6</span></span>|  
|<span data-ttu-id="1edbc-195">255</span><span class="sxs-lookup"><span data-stu-id="1edbc-195">255</span></span>|<span data-ttu-id="1edbc-196">11111111</span><span class="sxs-lookup"><span data-stu-id="1edbc-196">11111111</span></span>|<span data-ttu-id="1edbc-197">0, 1, 2, 3, 4, 5, 6 et 7</span><span class="sxs-lookup"><span data-stu-id="1edbc-197">0, 1, 2, 3, 4, 5, 6, and 7</span></span>|  
  
 <span data-ttu-id="1edbc-198">L'option affinity mask est une option avancée.</span><span class="sxs-lookup"><span data-stu-id="1edbc-198">The affinity mask option is an advanced option.</span></span> <span data-ttu-id="1edbc-199">Si vous utilisez la procédure stockée système sp_configure pour modifier le paramètre, vous ne pouvez modifier que si la `affinity mask` valeur 1 a été attribuée à l' **option Afficher les options avancées** .</span><span class="sxs-lookup"><span data-stu-id="1edbc-199">If you are using the sp_configure system stored procedure to change the setting, you can change `affinity mask` only when **show advanced options** is set to 1.</span></span> <span data-ttu-id="1edbc-200">Après l'exécution de la commande [!INCLUDE[tsql](../../includes/tsql-md.md)] RECONFIGURE, le nouveau paramètre prend immédiatement effet sans redémarrage de l'instance [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] .</span><span class="sxs-lookup"><span data-stu-id="1edbc-200">After executing the [!INCLUDE[tsql](../../includes/tsql-md.md)] RECONFIGURE command, the new setting takes effect immediately without requiring a restart of the [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] instance.</span></span>  
  
## <a name="non-uniform-memory-access-numa"></a><span data-ttu-id="1edbc-201">Non-Uniform Memory Access (NUMA)</span><span class="sxs-lookup"><span data-stu-id="1edbc-201">Non-uniform Memory Access (NUMA)</span></span>  
 <span data-ttu-id="1edbc-202">Lorsque vous utilisez l'accès NUMA (Non-Uniform Memory Access) matériel et que le masque d'affinité est défini, chaque planificateur dans un nœud possède une affinité avec sa propre unité centrale.</span><span class="sxs-lookup"><span data-stu-id="1edbc-202">When using hardware based non-uniform memory access (NUMA) and the affinity mask is set, every scheduler in a node will be affinitized to its own CPU.</span></span> <span data-ttu-id="1edbc-203">Lorsque le masque d'affinité n'est pas défini, chaque planificateur possède une affinité avec le groupe d'unités centrales au sein du nœud NUMA et un planificateur mappé sur le nœud NUMA N1 peut planifier du travail sur toute unité centrale dans le nœud, mais pas sur des unités centrales associées à un autre nœud.</span><span class="sxs-lookup"><span data-stu-id="1edbc-203">When the affinity mask is not set, each scheduler is affinitized to the group of CPUs within the NUMA node and a scheduler mapped to NUMA node N1 can schedule work on any CPU in the node, but not on CPUs associated with another node.</span></span>  
  
 <span data-ttu-id="1edbc-204">Toute opération en cours sur un nœud NUMA unique peut utiliser uniquement des pages tampon à partir de ce nœud.</span><span class="sxs-lookup"><span data-stu-id="1edbc-204">Any operation running on a single NUMA node can only use buffer pages from that node.</span></span> <span data-ttu-id="1edbc-205">Lorsqu'une opération est exécutée en parallèle sur des unités centrales issues de plusieurs nœuds, de la mémoire peut être utilisée à partir de tout nœud impliqué.</span><span class="sxs-lookup"><span data-stu-id="1edbc-205">When an operation is run in parallel on CPUs from multiple nodes, memory can be used from any node involved.</span></span>  
  
## <a name="licensing-issues"></a><span data-ttu-id="1edbc-206">À propos des licences</span><span class="sxs-lookup"><span data-stu-id="1edbc-206">Licensing Issues</span></span>  
 <span data-ttu-id="1edbc-207">L'affinité dynamique dépend étroitement des licences des processeurs.</span><span class="sxs-lookup"><span data-stu-id="1edbc-207">Dynamic affinity is tightly constrained by CPU licensing.</span></span> [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] <span data-ttu-id="1edbc-208">n'autorise pas la configuration d'options de masque d'affinité qui enfreignent la stratégie de licences.</span><span class="sxs-lookup"><span data-stu-id="1edbc-208">does not allow any configuration of affinity mask options that violates the licensing policy.</span></span>  
  
### <a name="startup"></a><span data-ttu-id="1edbc-209">Démarrage</span><span class="sxs-lookup"><span data-stu-id="1edbc-209">Startup</span></span>  
 <span data-ttu-id="1edbc-210">Si un masque d'affinité spécifié ne respecte pas la stratégie de licences au moment du démarrage de [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] ou de l'attachement de la base de données, la couche du moteur achève le processus de démarrage ou l'opération de restauration/attachement de base de données, puis remet à zéro la valeur d'exécution sp_configure du masque d'affinité, en consignant un message d'erreur dans le journal des erreurs [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] .</span><span class="sxs-lookup"><span data-stu-id="1edbc-210">If a specified affinity mask violates the licensing policy during [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] startup or during database attach, the engine layer will complete the startup process or database attach/restore operation, and then it will reset the sp_configure run value for the affinity mask to zero, issuing an error message to the [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] error log.</span></span>  
  
### <a name="reconfigure"></a><span data-ttu-id="1edbc-211">Reconfigurer</span><span class="sxs-lookup"><span data-stu-id="1edbc-211">Reconfigure</span></span>  
 <span data-ttu-id="1edbc-212">Si un masque d'affinité spécifié ne respecte pas la stratégie de licences lors de l'exécution de la commande [!INCLUDE[tsql](../../includes/tsql-md.md)] RECONFIGURE, un message d'erreur est envoyé à la session cliente et est consigné dans le journal des erreurs [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] , exigeant ainsi que l'administrateur de la base de données reconfigure le masque d'affinité.</span><span class="sxs-lookup"><span data-stu-id="1edbc-212">If a specified affinity mask violates the licensing policy when running [!INCLUDE[tsql](../../includes/tsql-md.md)] RECONFIGURE command, an error message is reported to the client session and to the [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] error log, requiring the database administrator to reconfigure the affinity mask.</span></span> <span data-ttu-id="1edbc-213">Aucune commande RECONFIGURE WITH OVERRIDE n'est acceptée dans ce cas.</span><span class="sxs-lookup"><span data-stu-id="1edbc-213">No RECONFIGURE WITH OVERRIDE command is accepted in this case.</span></span>  
  
## <a name="see-also"></a><span data-ttu-id="1edbc-214">Voir aussi</span><span class="sxs-lookup"><span data-stu-id="1edbc-214">See Also</span></span>  
 <span data-ttu-id="1edbc-215">[Analyser l’utilisation des ressources &#40;Moniteur système&#41;](../../relational-databases/performance-monitor/monitor-resource-usage-system-monitor.md) </span><span class="sxs-lookup"><span data-stu-id="1edbc-215">[Monitor Resource Usage &#40;System Monitor&#41;](../../relational-databases/performance-monitor/monitor-resource-usage-system-monitor.md) </span></span>  
 <span data-ttu-id="1edbc-216">[RECONFIGURE &#40;Transact-SQL&#41;](/sql/t-sql/language-elements/reconfigure-transact-sql) </span><span class="sxs-lookup"><span data-stu-id="1edbc-216">[RECONFIGURE &#40;Transact-SQL&#41;](/sql/t-sql/language-elements/reconfigure-transact-sql) </span></span>  
 <span data-ttu-id="1edbc-217">[Options de configuration de serveur &#40;SQL Server&#41;](server-configuration-options-sql-server.md) </span><span class="sxs-lookup"><span data-stu-id="1edbc-217">[Server Configuration Options &#40;SQL Server&#41;](server-configuration-options-sql-server.md) </span></span>  
 <span data-ttu-id="1edbc-218">[sp_configure &#40;Transact-SQL&#41;](/sql/relational-databases/system-stored-procedures/sp-configure-transact-sql) </span><span class="sxs-lookup"><span data-stu-id="1edbc-218">[sp_configure &#40;Transact-SQL&#41;](/sql/relational-databases/system-stored-procedures/sp-configure-transact-sql) </span></span>  
 [<span data-ttu-id="1edbc-219">ALTER SERVER CONFIGURATION &#40;Transact-SQL&#41;</span><span class="sxs-lookup"><span data-stu-id="1edbc-219">ALTER SERVER CONFIGURATION &#40;Transact-SQL&#41;</span></span>](/sql/t-sql/statements/alter-server-configuration-transact-sql)  
  
  
