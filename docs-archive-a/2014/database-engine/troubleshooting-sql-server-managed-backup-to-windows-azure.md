---
title: Résolution des problèmes de gestion de SQL Server de sauvegarde sur Azure | Microsoft Docs
description: Cet article décrit les tâches et les outils que vous pouvez utiliser pour résoudre les erreurs qui peuvent se produire pendant SQL Server sauvegarde managée dans des opérations de Microsoft Azure.
ms.custom: ''
ms.date: 03/08/2017
ms.prod: sql-server-2014
ms.reviewer: ''
ms.technology: backup-restore
ms.topic: conceptual
ms.assetid: a34d35b0-48eb-4ed1-9f19-ea14754650da
author: mashamsft
ms.author: mathoma
ms.openlocfilehash: 9c7ed5dd25ed2b02445bfae5eb78ac03b2270552
ms.sourcegitcommit: ad4d92dce894592a259721a1571b1d8736abacdb
ms.translationtype: MT
ms.contentlocale: fr-FR
ms.lasthandoff: 08/04/2020
ms.locfileid: "87701531"
---
# <a name="troubleshooting-sql-server-managed--backup-to-azure"></a><span data-ttu-id="ed206-103">Dépannage de la sauvegarde managée de SQL Server sur Azure</span><span class="sxs-lookup"><span data-stu-id="ed206-103">Troubleshooting SQL Server Managed  Backup to Azure</span></span>
  <span data-ttu-id="ed206-104">Cette rubrique décrit les tâches et les outils que vous pouvez utiliser pour résoudre les erreurs qui peuvent se produire lors des opérations de [!INCLUDE[ss_smartbackup](../includes/ss-smartbackup-md.md)].</span><span class="sxs-lookup"><span data-stu-id="ed206-104">This topic describes the tasks and tools you can use to troubleshoot errors that may occur during [!INCLUDE[ss_smartbackup](../includes/ss-smartbackup-md.md)] operations.</span></span>  
  
## <a name="overview"></a><span data-ttu-id="ed206-105">Vue d’ensemble</span><span class="sxs-lookup"><span data-stu-id="ed206-105">Overview</span></span>  
 <span data-ttu-id="ed206-106">La [!INCLUDE[ss_smartbackup](../includes/ss-smartbackup-md.md)] comprend des contrôles intégrés et des étapes de dépannage, par conséquent, la plupart des défaillances internes sont prises en charge par le processus de [!INCLUDE[ss_smartbackup](../includes/ss-smartbackup-md.md)] lui-même.</span><span class="sxs-lookup"><span data-stu-id="ed206-106">[!INCLUDE[ss_smartbackup](../includes/ss-smartbackup-md.md)] has built in checks and troubleshooting, so in many cases internal failures are taken care of by [!INCLUDE[ss_smartbackup](../includes/ss-smartbackup-md.md)] process itself.</span></span>  
  
 <span data-ttu-id="ed206-107">Un exemple de ce cas de figure est la suppression d’un fichier de sauvegarde, ce qui se traduit par une interruption de la séquence de journaux qui affecte la capacité de récupération [!INCLUDE[ss_smartbackup](../includes/ss-smartbackup-md.md)] . identifie l’interruption dans la chaîne de journalisation et planifie une sauvegarde qui doit être effectuée immédiatement.</span><span class="sxs-lookup"><span data-stu-id="ed206-107">Example of one such case is a deletion of a backup file resulting in a break of the log chain affecting recoverability - [!INCLUDE[ss_smartbackup](../includes/ss-smartbackup-md.md)] will identify the break in log chain and schedule a backup to be taken immediately.</span></span> <span data-ttu-id="ed206-108">Toutefois, nous vous recommandons de surveiller l'état et de résoudre les erreurs qui nécessitent une intervention manuelle.</span><span class="sxs-lookup"><span data-stu-id="ed206-108">However we recommend that you monitor the status and address any errors that require manual intervention.</span></span>  
  
 <span data-ttu-id="ed206-109">La [!INCLUDE[ss_smartbackup](../includes/ss-smartbackup-md.md)] enregistre les événements et les erreurs à l'aide de procédures stockées système, de vues système et d'événements étendus.</span><span class="sxs-lookup"><span data-stu-id="ed206-109">[!INCLUDE[ss_smartbackup](../includes/ss-smartbackup-md.md)] logs events and errors using system stored procedures, system views and extended events.</span></span> <span data-ttu-id="ed206-110">Les vues et les procédures stockées système fournissent les informations de configuration de la [!INCLUDE[ss_smartbackup](../includes/ss-smartbackup-md.md)], l'état des sauvegardes planifiées, ainsi que les erreurs capturées par les événements étendus.</span><span class="sxs-lookup"><span data-stu-id="ed206-110">System views and stored procedures provide [!INCLUDE[ss_smartbackup](../includes/ss-smartbackup-md.md)] configuration information, status of backup scheduled backups, and also the errors captured by Extended Events.</span></span> <span data-ttu-id="ed206-111">La [!INCLUDE[ss_smartbackup](../includes/ss-smartbackup-md.md)] utilise les événements étendus pour capturer les erreurs qui doivent être résolues.</span><span class="sxs-lookup"><span data-stu-id="ed206-111">[!INCLUDE[ss_smartbackup](../includes/ss-smartbackup-md.md)] uses Extended Events to capture the errors to use for troubleshooting.</span></span> <span data-ttu-id="ed206-112">En plus d'enregistrer les événements, les stratégies SQL Server Smart Admin fournissent l'état d'intégrité utilisé par le travail de notification par courrier électronique pour notifier les erreurs et les problèmes.</span><span class="sxs-lookup"><span data-stu-id="ed206-112">In addition to logging events, SQL Server Smart Admin Policies provide a health status which is used by an email notification job to provide notification or errors and issues.</span></span> <span data-ttu-id="ed206-113">Pour plus d’informations, consultez [Monitor SQL Server Managed Backup to Azure](../relational-databases/backup-restore/sql-server-managed-backup-to-microsoft-azure.md).</span><span class="sxs-lookup"><span data-stu-id="ed206-113">For more information see [Monitor SQL Server Managed Backup to Azure](../relational-databases/backup-restore/sql-server-managed-backup-to-microsoft-azure.md).</span></span>  
  
 [!INCLUDE[ss_smartbackup](../includes/ss-smartbackup-md.md)]<span data-ttu-id="ed206-114">utilise également la même journalisation que celle utilisée lors de la sauvegarde manuelle dans le stockage Azure (SQL Server la sauvegarde vers l’URL).</span><span class="sxs-lookup"><span data-stu-id="ed206-114">also uses the same logging that is used when manually backing up to Azure storage (SQL Server Backup to URL).</span></span> <span data-ttu-id="ed206-115">Pour plus d’informations sur les problèmes liés à la sauvegarde vers une URL, consultez la section résolution des problèmes dans [SQL Server meilleures pratiques et résolution des problèmes de sauvegarde vers une URL](../relational-databases/backup-restore/sql-server-backup-to-url-best-practices-and-troubleshooting.md)</span><span class="sxs-lookup"><span data-stu-id="ed206-115">For more information on Backup to URL related issues, see the troubleshooting section in [SQL Server Backup to URL Best Practices and Troubleshooting](../relational-databases/backup-restore/sql-server-backup-to-url-best-practices-and-troubleshooting.md)</span></span>  
  
### <a name="general-troubleshooting-steps"></a><span data-ttu-id="ed206-116">Étapes de dépannage générales</span><span class="sxs-lookup"><span data-stu-id="ed206-116">General Troubleshooting Steps</span></span>  
  
1.  <span data-ttu-id="ed206-117">Activez la notification par courrier électronique pour recevoir des courriers électroniques en cas d'erreurs ou d'avertissements.</span><span class="sxs-lookup"><span data-stu-id="ed206-117">Enable Email Notification to start to receive emails for error and warnings.</span></span>  
  
     <span data-ttu-id="ed206-118">Exécutez aussi régulièrement `smart_admin.fn_get_health_status` pour vérifier le nombre agrégé des erreurs.</span><span class="sxs-lookup"><span data-stu-id="ed206-118">Alternatively, you can also periodically run `smart_admin.fn_get_health_status` to check the aggregated errors and counts.</span></span> <span data-ttu-id="ed206-119">Par exemple, `number_of_invalid_credential_errors` est le nombre de fois où la sauvegarde intelligente a tenté une sauvegarde, mais a rencontré une erreur d'informations d'identification non valides.</span><span class="sxs-lookup"><span data-stu-id="ed206-119">For example, `number_of_invalid_credential_errors` is the number of times smart backup attempted a backup but got invalid credential error.</span></span> <span data-ttu-id="ed206-120">`Number_of_backup_loops` et `number_of_retention_loops` ne sont pas des erreurs ; mais indiquent le nombre de fois où le thread de sauvegarde et le thread de rétention ont analysé la liste de bases de données.</span><span class="sxs-lookup"><span data-stu-id="ed206-120">`Number_of_backup_loops` and `number_of_retention_loops` are not errors; but they indicate the number of times backup thread and retention thread scanned the list of databases.</span></span> <span data-ttu-id="ed206-121">En règle générale, lorsque @begin_time et @end_time ne sont pas fournis, la fonction affiche les informations des 30 dernières minutes, puis les valeurs non nulles sont normalement affichées pour ces deux colonnes.</span><span class="sxs-lookup"><span data-stu-id="ed206-121">Typically, when @begin_time and @end_time are not provided, the function is showing the information from last 30 minutes, then we should normally see non-zero values for these two columns.</span></span> <span data-ttu-id="ed206-122">Si des valeurs égales à zéro s'affichent, cela indique que le système est surchargé ou qu'il ne répond pas.</span><span class="sxs-lookup"><span data-stu-id="ed206-122">If they are zero then it implies system overloaded or even system not responding.</span></span> <span data-ttu-id="ed206-123">Pour plus d’informations, consultez la section **résolution des problèmes système** plus loin dans cette rubrique.</span><span class="sxs-lookup"><span data-stu-id="ed206-123">For more information, see **Troubleshooting System Issues** section later in this topic.</span></span>  
  
2.  <span data-ttu-id="ed206-124">Passez en revue les journaux des événements étendus pour obtenir plus de détails sur les erreurs et les autres événements associés.</span><span class="sxs-lookup"><span data-stu-id="ed206-124">Review the Extended Event logs to learn more details on the errors and other associated events.</span></span>  
  
3.  <span data-ttu-id="ed206-125">Utilisez les informations des journaux pour résoudre le problème.</span><span class="sxs-lookup"><span data-stu-id="ed206-125">Use the information in the logs to resolve the issue.</span></span>  <span data-ttu-id="ed206-126">En cas de problème ou d'erreur système, vous devrez peut-être redémarrer le service ou SQL Server Agent.</span><span class="sxs-lookup"><span data-stu-id="ed206-126">In case of a system issue or error, you may need to restart the service or SQL Server Agent.</span></span>  
  
### <a name="common-causes-of-errors"></a><span data-ttu-id="ed206-127">Causes courantes d'erreur</span><span class="sxs-lookup"><span data-stu-id="ed206-127">Common Causes of Errors</span></span>  
 <span data-ttu-id="ed206-128">Voici une liste des causes courantes aboutissant à un échec :</span><span class="sxs-lookup"><span data-stu-id="ed206-128">Following is the list of common causes resulting in failures:</span></span>  
  
1.  <span data-ttu-id="ed206-129">**Modifications apportées aux informations d’identification SQL :** Si le nom des informations d’identification utilisées par [!INCLUDE[ss_smartbackup](../includes/ss-smartbackup-md.md)] est modifié ou s’il est supprimé, ne sera [!INCLUDE[ss_smartbackup](../includes/ss-smartbackup-md.md)] pas en mesure d’effectuer des sauvegardes.</span><span class="sxs-lookup"><span data-stu-id="ed206-129">**Changes to SQL Credential:** If the name of the credential used by [!INCLUDE[ss_smartbackup](../includes/ss-smartbackup-md.md)] is changed or if it is deleted, [!INCLUDE[ss_smartbackup](../includes/ss-smartbackup-md.md)] will not be able to take backups.</span></span> <span data-ttu-id="ed206-130">La modification doit être appliquées aux paramètres de configuration de la [!INCLUDE[ss_smartbackup](../includes/ss-smartbackup-md.md)].</span><span class="sxs-lookup"><span data-stu-id="ed206-130">The change should be applied to [!INCLUDE[ss_smartbackup](../includes/ss-smartbackup-md.md)] configuration settings.</span></span>  
  
2.  <span data-ttu-id="ed206-131">**Modifications apportées aux valeurs des clés d’accès de stockage :** Si les valeurs de clé de stockage sont modifiées pour le compte Azure, mais que les informations d’identification SQL ne sont pas mises à jour avec les nouvelles valeurs, [!INCLUDE[ss_smartbackup](../includes/ss-smartbackup-md.md)] échoue lors de l’authentification auprès du stockage et ne parvient pas à sauvegarder les bases de données configurées pour utiliser ce compte.</span><span class="sxs-lookup"><span data-stu-id="ed206-131">**Changes to storage access key values:** If the storage key values are changed for the Azure account, but SQL Credential is not updated with the new values, [!INCLUDE[ss_smartbackup](../includes/ss-smartbackup-md.md)] will fail when authenticating to the storage, and fails to backup databases configured to use this account.</span></span>  
  
3.  <span data-ttu-id="ed206-132">**Modifications apportées au compte de stockage Azure :** La suppression ou le changement de nom du compte de stockage sans modification correspondante des informations d’identification SQL entraîne l' [!INCLUDE[ss_smartbackup](../includes/ss-smartbackup-md.md)] échec de l’opération et aucune sauvegarde n’est effectuée.</span><span class="sxs-lookup"><span data-stu-id="ed206-132">**Changes to Azure Storage Account:** Deleting or renaming storage account without corresponding changes to the SQL Credential will cause [!INCLUDE[ss_smartbackup](../includes/ss-smartbackup-md.md)] to fail and no backups will be taken.</span></span> <span data-ttu-id="ed206-133">Si vous supprimez un compte de stockage, assurez-vous que les bases de données sont reconfigurées avec des informations de compte de stockage valides.</span><span class="sxs-lookup"><span data-stu-id="ed206-133">If you delete a storage account, ensure that the databases are reconfigured with valid storage account information.</span></span> <span data-ttu-id="ed206-134">Si un compte de stockage est renommé ou les valeurs de clé sont modifiées, vérifiez que ces changements sont répercutés dans les informations d'identification SQL utilisées par la [!INCLUDE[ss_smartbackup](../includes/ss-smartbackup-md.md)].</span><span class="sxs-lookup"><span data-stu-id="ed206-134">If a storage account is renamed or the key values are changed, ensure that these changes are reflected in the SQL Credential used by [!INCLUDE[ss_smartbackup](../includes/ss-smartbackup-md.md)].</span></span>  
  
4.  <span data-ttu-id="ed206-135">**Modifications apportées aux propriétés de la base de données :** Les modifications apportées aux modèles de récupération ou à la modification du nom peuvent entraîner l’échec des sauvegardes.</span><span class="sxs-lookup"><span data-stu-id="ed206-135">**Changes to Database Properties:** Changes to recovery models or changing the name can cause backups to fail.</span></span>  
  
5.  <span data-ttu-id="ed206-136">**Modifications du mode de récupération :** Si le mode de récupération de la base de données est modifié en mode simple ou journalisé en bloc, les sauvegardes s’arrêtent et les bases de données sont ignorées par [!INCLUDE[ss_smartbackup](../includes/ss-smartbackup-md.md)] .</span><span class="sxs-lookup"><span data-stu-id="ed206-136">**Changes to Recovery Model:** If the recovery model of the database is changed to simple from full or bulk-logged, backups will stop, and the databases will be skipped by [!INCLUDE[ss_smartbackup](../includes/ss-smartbackup-md.md)].</span></span> <span data-ttu-id="ed206-137">Pour plus d’informations, consultez [SQL Server gestion de la sauvegarde sur Azure : interopérabilité et coexistence](../../2014/database-engine/sql-server-managed-backup-to-windows-azure-interoperability-and-coexistence.md)</span><span class="sxs-lookup"><span data-stu-id="ed206-137">For more information, see [SQL Server Managed Backup to Azure: Interoperability and Coexistence](../../2014/database-engine/sql-server-managed-backup-to-windows-azure-interoperability-and-coexistence.md)</span></span>  
  
### <a name="most-common-error-messages-and-solutions"></a><span data-ttu-id="ed206-138">Messages d'erreur courants et solutions</span><span class="sxs-lookup"><span data-stu-id="ed206-138">Most Common Error Messages and Solutions</span></span>  
  
1.  <span data-ttu-id="ed206-139">**Erreurs lors de l’activation ou de la configuration [!INCLUDE[ss_smartbackup](../includes/ss-smartbackup-md.md)] :**</span><span class="sxs-lookup"><span data-stu-id="ed206-139">**Errors when enabling or configuring [!INCLUDE[ss_smartbackup](../includes/ss-smartbackup-md.md)]:**</span></span>  
  
     <span data-ttu-id="ed206-140">Erreur : «échec de l’accès à l’URL de stockage... Fournissez des informations d’identification SQL valides...» : vous pouvez voir cela et d’autres erreurs similaires se rapportant aux informations d’identification SQL.</span><span class="sxs-lookup"><span data-stu-id="ed206-140">Error: " Failed to access the storage URL.... Provide a valid SQL Credential..." : You may see this and other similar errors referring to SQL Credentials.</span></span>  <span data-ttu-id="ed206-141">Dans ce cas, examinez le nom des informations d’identification SQL que vous avez fournies, ainsi que les informations stockées dans les informations d’identification SQL, le nom du compte de stockage et la clé d’accès de stockage, et assurez-vous qu’elles sont à jour et valides.</span><span class="sxs-lookup"><span data-stu-id="ed206-141">In such cases, review the name of the SQL Credential you provided, and also the information stored in the SQL Credential - the storage account name, and the storage access key and make sure that they are current and valid.</span></span>  
  
     <span data-ttu-id="ed206-142">Erreur : «... Impossible de configurer la base de données... comme il s’agit d’une base de données système», cette erreur s’affiche si vous essayez d’activer [!INCLUDE[ss_smartbackup](../includes/ss-smartbackup-md.md)] pour une base de données système.</span><span class="sxs-lookup"><span data-stu-id="ed206-142">Error: "... cannot configure the database....because it is a system database": You will see this error if you try to enable [!INCLUDE[ss_smartbackup](../includes/ss-smartbackup-md.md)] for a system database.</span></span>  <span data-ttu-id="ed206-143">La [!INCLUDE[ss_smartbackup](../includes/ss-smartbackup-md.md)] ne prend pas en charge les bases de données système.</span><span class="sxs-lookup"><span data-stu-id="ed206-143">[!INCLUDE[ss_smartbackup](../includes/ss-smartbackup-md.md)] does not support backups for system databases.</span></span>  <span data-ttu-id="ed206-144">Pour configurer la sauvegarde d'une base de données système, utilisez d'autres technologies de sauvegarde SQL Server, comme les plans de maintenance.</span><span class="sxs-lookup"><span data-stu-id="ed206-144">To configure backup for a system database use other SQL Server Backup technologies such as maintenance plans.</span></span>  
  
     <span data-ttu-id="ed206-145">Erreur : «... Fournir une période de rétention....» : vous pouvez voir des erreurs concernant la période de rétention si vous n’avez pas spécifié de période de rétention pour la base de données ou l’instance lorsque vous configurez ces valeurs pour la première fois.</span><span class="sxs-lookup"><span data-stu-id="ed206-145">Error:" ... Provide a retention period...." : You may see errors regarding the retention period if you either have not specified a retention period for the database or instance when you are configuring these values for the first time.</span></span> <span data-ttu-id="ed206-146">Vous verrez également cette erreur si vous avez utilisé une valeur non comprise dans la plage 1 à 30.</span><span class="sxs-lookup"><span data-stu-id="ed206-146">You may also see an error if you provide a value other than a number between 1 and 30.</span></span> <span data-ttu-id="ed206-147">Les valeurs autorisées pour la période de rétention sont un nombre compris entre 1 et 30.</span><span class="sxs-lookup"><span data-stu-id="ed206-147">The allowed value for the retention period is a number between 1 and 30.</span></span>  
  
2.  <span data-ttu-id="ed206-148">**Erreurs de notification de courrier électronique :**</span><span class="sxs-lookup"><span data-stu-id="ed206-148">**Email Notification Errors:**</span></span>  
  
     <span data-ttu-id="ed206-149">Erreur : « Database Mail n’est pas activé... ». cette erreur s’affiche si vous activez les notifications par courrier électronique, mais que Database Mail n’est pas configurée sur l’instance.</span><span class="sxs-lookup"><span data-stu-id="ed206-149">Error: "Database Mail is not enabled..." - You will see this error if you enable e-mail notifications, but Database Mail is not configured on the instance.</span></span> <span data-ttu-id="ed206-150">Vous devez configurer la messagerie de base de données sur l'instance pour recevoir une notification de l'état d'intégrité de la [!INCLUDE[ss_smartbackup](../includes/ss-smartbackup-md.md)].</span><span class="sxs-lookup"><span data-stu-id="ed206-150">You must configure Database Mail on the instance to be able to receive notification of the health status of [!INCLUDE[ss_smartbackup](../includes/ss-smartbackup-md.md)].</span></span> <span data-ttu-id="ed206-151">Pour plus d’informations sur l’activation de la messagerie de base de données, consultez [configurer des Database mail](../relational-databases/database-mail/configure-database-mail.md).</span><span class="sxs-lookup"><span data-stu-id="ed206-151">For information about how to enable database mail, see [Configure Database Mail](../relational-databases/database-mail/configure-database-mail.md).</span></span> <span data-ttu-id="ed206-152">Vous devez également permettre à SQL Server Agent d'utiliser la messagerie de base de données pour les notifications.</span><span class="sxs-lookup"><span data-stu-id="ed206-152">You must also enable SQL Server Agent to use Database Mail for notifications.</span></span> <span data-ttu-id="ed206-153">Pour plus d'informations, consultez [Avant de commencer](../relational-databases/database-mail/configure-sql-server-agent-mail-to-use-database-mail.md#BeforeYouBegin).</span><span class="sxs-lookup"><span data-stu-id="ed206-153">For more information, see [Before You Begin](../relational-databases/database-mail/configure-sql-server-agent-mail-to-use-database-mail.md#BeforeYouBegin).</span></span>  
  
     <span data-ttu-id="ed206-154">Voici une liste de numéros d'erreur que vous pouvez voir, qui sont associés aux notifications par message électronique :</span><span class="sxs-lookup"><span data-stu-id="ed206-154">Following is a list of error numbers you might see that are associated with email notifications:</span></span>  
  
    -   <span data-ttu-id="ed206-155">ErrorNumber : 45209</span><span class="sxs-lookup"><span data-stu-id="ed206-155">ErrorNumber: 45209</span></span>  
  
    -   <span data-ttu-id="ed206-156">ErrorNumber : 45210</span><span class="sxs-lookup"><span data-stu-id="ed206-156">ErrorNumber: 45210</span></span>  
  
    -   <span data-ttu-id="ed206-157">ErrorNumber : 45211</span><span class="sxs-lookup"><span data-stu-id="ed206-157">ErrorNumber: 45211</span></span>  
  
3.  <span data-ttu-id="ed206-158">**Erreurs de connectivité :**</span><span class="sxs-lookup"><span data-stu-id="ed206-158">**Connectivity Errors:**</span></span>  
  
    -   <span data-ttu-id="ed206-159">**Erreurs liées à la connectivité SQL :** Ces erreurs se produisent en cas de problème de connexion à SQL Server instance.</span><span class="sxs-lookup"><span data-stu-id="ed206-159">**Errors Related to SQL Connectivity:** These errors happen when there are issues connecting to SQL Server instance.</span></span> <span data-ttu-id="ed206-160">Les événements étendus exposent ces types d'erreurs via le canal d'administration.</span><span class="sxs-lookup"><span data-stu-id="ed206-160">The extended events expose these type of errors through the admin channel.</span></span> <span data-ttu-id="ed206-161">Voici deux événements étendus que vous pouvez voir pour les erreurs relatives à ce type de problème de connectivité :</span><span class="sxs-lookup"><span data-stu-id="ed206-161">Following are the two extended events that you might see for errors related to this type of connectivity issues:</span></span>  
  
         <span data-ttu-id="ed206-162">FileRetentionAdminXEvent avec l'event_type = SqlError.</span><span class="sxs-lookup"><span data-stu-id="ed206-162">FileRetentionAdminXEvent with event_type = SqlError.</span></span> <span data-ttu-id="ed206-163">Pour les détails de cette erreur, observez l'error_code, l'error_message et le stack_trace de cet événement.</span><span class="sxs-lookup"><span data-stu-id="ed206-163">For details of this error, look at the error_code, error_message and stack_trace of that event.</span></span> <span data-ttu-id="ed206-164">Le error_code est le numéro d’erreur de SqlException.</span><span class="sxs-lookup"><span data-stu-id="ed206-164">The error_code is the SqlException's error number.</span></span>  
  
         <span data-ttu-id="ed206-165">SmartBackupAdminXevent avec les messages/préfixes de message suivants :</span><span class="sxs-lookup"><span data-stu-id="ed206-165">SmartBackupAdminXevent with the following messages/message prefixes:</span></span>  
  
         <span data-ttu-id="ed206-166">*«Une erreur interne s’est produite lors de la configuration de SQL Server sauvegarde managée dans les paramètres Azure par défaut pour l’instance. L’erreur peut être temporaire.»*</span><span class="sxs-lookup"><span data-stu-id="ed206-166">*"An internal error occurred while configuring SQL Server Managed Backup to Azure default settings for instance. Error might be transient."*</span></span>  
  
         <span data-ttu-id="ed206-167">*«Il est probable que des problèmes de connectivité avec SQL Server. La base de données est ignorée dans l’itération actuelle.»*</span><span class="sxs-lookup"><span data-stu-id="ed206-167">*"Probably experiencing connectivity issues with SQL Server. Skipping database in the current iteration."*</span></span>  
  
         <span data-ttu-id="ed206-168">*«Échec de l’interrogation des informations sur l’utilisation du journal. L’échec peut être temporaire. La base de données est ignorée dans l’itération actuelle.»*</span><span class="sxs-lookup"><span data-stu-id="ed206-168">*"Querying log usage info failed. The failure might be transient. Skipping database in the current iteration."*</span></span>  
  
         <span data-ttu-id="ed206-169">*«Exception SQL rencontrée lors du chargement des métadonnées de l’agent SSMBackup2WA. L’échec peut être temporaire. L’opération va être retentée.»*</span><span class="sxs-lookup"><span data-stu-id="ed206-169">*"SQL exception encountered while loading SSMBackup2WA agent metadata. The failure might be transient. Operation will be retried."*</span></span>  
  
         <span data-ttu-id="ed206-170">*«SSMBackup2WA a rencontré une exception SQL lors de... "*</span><span class="sxs-lookup"><span data-stu-id="ed206-170">*"SSMBackup2WA encountered SQL exception while ... "*</span></span>  
  
    -   <span data-ttu-id="ed206-171">**Erreurs lors de la connexion au compte de stockage :**</span><span class="sxs-lookup"><span data-stu-id="ed206-171">**Errors Connecting to the storage account:**</span></span>  
  
         <span data-ttu-id="ed206-172">Les exceptions de stockage sont répertoriées dans FileRetentionAdminXEvent avec l'event_type = XstoreError.</span><span class="sxs-lookup"><span data-stu-id="ed206-172">Storage exceptions are reported in FileRetentionAdminXEvent with event_type = XstoreError.</span></span> <span data-ttu-id="ed206-173">Pour les détails de l'erreur, observez l'error_message et le stack_trace de cet événement.</span><span class="sxs-lookup"><span data-stu-id="ed206-173">For details of the error, look at the error_message and stack_trace of that event.</span></span>  
  
         <span data-ttu-id="ed206-174">Étant donné que la sauvegarde managée de SQL Server utilise la technologie de sauvegarde vers l'URL sous-jacente, les erreurs liées à la connectivité du stockage s'appliquent aux deux fonctionnalités.</span><span class="sxs-lookup"><span data-stu-id="ed206-174">Since SQL Server Managed Backup uses the underlying Backup to URL technology, the errors related to storage connectivity apply to both the features.</span></span> <span data-ttu-id="ed206-175">Pour plus d’informations sur les étapes de dépannage, consultez la **section Troubleshooting** de l’article [meilleures pratiques et dépannage de la SQL Server sauvegarde vers une URL](../relational-databases/backup-restore/sql-server-backup-to-url-best-practices-and-troubleshooting.md) .</span><span class="sxs-lookup"><span data-stu-id="ed206-175">For more information on troubleshooting steps, see **troubleshooting section** of the [SQL Server Backup to URL Best Practices and Troubleshooting](../relational-databases/backup-restore/sql-server-backup-to-url-best-practices-and-troubleshooting.md) article.</span></span>  
  
### <a name="troubleshooting-system-issues"></a><span data-ttu-id="ed206-176">Dépannage des problèmes du système</span><span class="sxs-lookup"><span data-stu-id="ed206-176">Troubleshooting System Issues</span></span>  
 <span data-ttu-id="ed206-177">Voici des scénarios d'un problème avec le système (SQL Server, SQL Server Agent) et ses effets sur [!INCLUDE[ss_smartbackup](../includes/ss-smartbackup-md.md)] :</span><span class="sxs-lookup"><span data-stu-id="ed206-177">Following are some scenarios when there is an issue with the system (SQL Server, SQL Server Agent) and its effects on [!INCLUDE[ss_smartbackup](../includes/ss-smartbackup-md.md)]:</span></span>  
  
-   <span data-ttu-id="ed206-178">**Sqlservr.exe cesse de répondre ou cesse de fonctionner lorsque [!INCLUDE[ss_smartbackup](../includes/ss-smartbackup-md.md)] est en cours d’exécution :** si SQL Server cesse de fonctionner, l’agent SQL s’arrête normalement, [!INCLUDE[ss_smartbackup](../includes/ss-smartbackup-md.md)] s’arrête également et les événements sont consignés dans le fichier SQL Agent. out.</span><span class="sxs-lookup"><span data-stu-id="ed206-178">**Sqlservr.exe stops responding or stops working when [!INCLUDE[ss_smartbackup](../includes/ss-smartbackup-md.md)] is running:** If SQL Server stops working, SQL Agent will gracefully shut down, [!INCLUDE[ss_smartbackup](../includes/ss-smartbackup-md.md)] also stops and the events are logged in SQL Agent.out file.</span></span>  
  
     <span data-ttu-id="ed206-179">Si SQL Server ne répond plus, des événements sont consignés dans le canal d'administration.</span><span class="sxs-lookup"><span data-stu-id="ed206-179">If SQL Server stops responding, events are logged in the admin channel.</span></span>  <span data-ttu-id="ed206-180">Exemple du journal des événements :</span><span class="sxs-lookup"><span data-stu-id="ed206-180">An example of the event log:</span></span>  
  
     <span data-ttu-id="ed206-181">*Erreur SQL (le moteur ne répond pas ou récupérez sqlException : SqlException :* </span><span class="sxs-lookup"><span data-stu-id="ed206-181">*Sql Error (engine not responding or get sqlException: SqlException:* </span></span>  
     <span data-ttu-id="ed206-182">*code d’erreur, message et StackTrace s’affichent dans un canal d’administration XEvent, ainsi que des informations supplémentaires, telles que :* </span><span class="sxs-lookup"><span data-stu-id="ed206-182">*error code, message and stacktrace will be displayed in an admin channel xevent, together with some extra information, such as :* </span></span>  
    <span data-ttu-id="ed206-183">*«Il est probable que des problèmes de connectivité avec SQL Server. La base de données est ignorée dans l’itération actuelle.»*</span><span class="sxs-lookup"><span data-stu-id="ed206-183">*"Probably experiencing connectivity issues with SQL Server. Skipping database in the current iteration"*</span></span>  
  
-   <span data-ttu-id="ed206-184">**L’agent SQL ne répond plus ou cesse de fonctionner lorsque [!INCLUDE[ss_smartbackup](../includes/ss-smartbackup-md.md)] est en cours d’exécution :**</span><span class="sxs-lookup"><span data-stu-id="ed206-184">**SQL Agent stops responding or stops working when [!INCLUDE[ss_smartbackup](../includes/ss-smartbackup-md.md)] is running:**</span></span>  
  
     <span data-ttu-id="ed206-185">Si l'Agent SQL s'arrête, [!INCLUDE[ss_smartbackup](../includes/ss-smartbackup-md.md)] s'arrête également et des événements sont consignés dans le canal d'administration.</span><span class="sxs-lookup"><span data-stu-id="ed206-185">If SQL Agent stops working, [!INCLUDE[ss_smartbackup](../includes/ss-smartbackup-md.md)] also stops and events are logged in the admin channel.</span></span> <span data-ttu-id="ed206-186">Ce comportement est similaire à celui des scénarios dans lesquels SQL Server ne répond plus.</span><span class="sxs-lookup"><span data-stu-id="ed206-186">This is similar to the scenarios when SQL Server stops responding.</span></span>  
  
     <span data-ttu-id="ed206-187">Si l'Agent SQL ne répond plus, [!INCLUDE[ss_smartbackup](../includes/ss-smartbackup-md.md)] ne pourra pas continuer les opérations de sauvegarde, et des événements sont consignés dans le canal d'administration.</span><span class="sxs-lookup"><span data-stu-id="ed206-187">If SQL Agent stops responding, [!INCLUDE[ss_smartbackup](../includes/ss-smartbackup-md.md)] will be unable to continue with backup operations, and events are logged in the admin channel.</span></span> <span data-ttu-id="ed206-188">Exemple du journal des événements :</span><span class="sxs-lookup"><span data-stu-id="ed206-188">An example of the event log:</span></span>  
  
     <span data-ttu-id="ed206-189">*Blocage du travail : Voir le canal d’administration XEvents* </span><span class="sxs-lookup"><span data-stu-id="ed206-189">*Job hangs: see admin channel xevents* </span></span>  
    <span data-ttu-id="ed206-190">*« Une mise à jour de progression n’a pas été reçue de SQL Server dans plus de «constantes. DBBackupInfoMsgMaxWaitTime + » heures pour la sauvegarde de base de données.   La sauvegarde du Cloud SSM va continuer à attendre.»*</span><span class="sxs-lookup"><span data-stu-id="ed206-190">*"A progress update hasn't been received from SQL Server in more than " + Constants.DBBackupInfoMsgMaxWaitTime  + " hours for database backup.   SSM Cloud Backup will continue to wait."*</span></span>  
  
 <span data-ttu-id="ed206-191">Si vous avez activé la notification par message électronique, vous recevrez une notification qui comprend le **Nombre de boucles de sauvegarde** et le **Nombre de boucles de rétention**.</span><span class="sxs-lookup"><span data-stu-id="ed206-191">If you have enabled email notification, you will receive a notification which includes **Number of Backup Loops** and **Number of Retention Loops**.</span></span> <span data-ttu-id="ed206-192">Si la valeur retournée dans la notification pour une de ces deux colonnes ou les deux est zéro, cela peut indiquer que le système ne répond pas.</span><span class="sxs-lookup"><span data-stu-id="ed206-192">If the value returned in the notification for one or both of these two columns is zero, it could be an indication that the system is not responding.</span></span>  
  
> [!WARNING]  
>  <span data-ttu-id="ed206-193">Les processus internes qui génèrent les résultats du rapport supposent que les journaux de diagnostic du moteur sont dans le même emplacement que le journal d'erreurs SQL Agent, qui est par défaut dans le même dossier que les journaux d'erreurs de l'instance de SQL Server.</span><span class="sxs-lookup"><span data-stu-id="ed206-193">The internal processes that generate the results for the report, assumes that the engine diagnostic logs are in the same location of SQL Agent error log, which by default is in the same folder as the error logs of the SQL Server instance.</span></span> <span data-ttu-id="ed206-194">Si les journaux de diagnostic du moteur sont déplacés dans un autre emplacement que l'emplacement du journal d'erreurs de SQL Agent, le système ne trouve pas les journaux de diagnostic de la sauvegarde intelligente et, par conséquent, le rapport dans la notification par messagerie peut-être incorrect.</span><span class="sxs-lookup"><span data-stu-id="ed206-194">If the engine diagnostic logs are moved to a location other than SQL Agent error log location, the system is unable to find the smart backup diagnostic logs, and hence the report in the email notification may not be correct.</span></span> <span data-ttu-id="ed206-195">Par exemple, vous pouvez voir la valeur **0** dans tous les champs, y compris pour le nombre de boucles de sauvegarde et pour le nombre de boucles de rétention.</span><span class="sxs-lookup"><span data-stu-id="ed206-195">For example, you might see a value of **0** in all the fields reported including the Number of Backup Loops and Number of Retention Loops.</span></span> <span data-ttu-id="ed206-196">Dans ce cas, lorsque les journaux de diagnostic sont déplacés dans un autre emplacement, cela ne signifie pas que le système ne répond pas, mais qu'il ne trouve pas les journaux.</span><span class="sxs-lookup"><span data-stu-id="ed206-196">In this case where the diagnostic logs are moved to a different location, it may not mean that the system is not responding, but that the system is unable to find the logs.</span></span> <span data-ttu-id="ed206-197">Vérifiez d'abord que l'emplacement des journaux de diagnostic et des journaux d'erreurs de SQL Agent est le même.</span><span class="sxs-lookup"><span data-stu-id="ed206-197">Ensure that the location of the diagnostic logs and SQL Agent error logs are at the same location first.</span></span> <span data-ttu-id="ed206-198">Pour vérifier l’emplacement actuel des journaux de diagnostic, vous pouvez utiliser [sys. dm_os_server_diagnostics_log_configurations](/sql/relational-databases/system-dynamic-management-views/sys-dm-os-server-diagnostics-log-configurations).</span><span class="sxs-lookup"><span data-stu-id="ed206-198">To verify the current location of the diagnostic logs, you can use [sys.dm_os_server_diagnostics_log_configurations](/sql/relational-databases/system-dynamic-management-views/sys-dm-os-server-diagnostics-log-configurations).</span></span> <span data-ttu-id="ed206-199">La `path` colonne retourne l’emplacement actuel des journaux de diagnostic du moteur.</span><span class="sxs-lookup"><span data-stu-id="ed206-199">The `path` column returns the current location of the engine diagnostic logs.</span></span>  <span data-ttu-id="ed206-200">Il doit se trouver dans le même dossier que les journaux d’erreurs de l’agent SQL.</span><span class="sxs-lookup"><span data-stu-id="ed206-200">It should be in the same folder as the SQL Agent error logs.</span></span> <span data-ttu-id="ed206-201">Pour obtenir le chemin d'accès du journal d'erreurs de SQL Agent, utilisez la procédure stockée `dbo.sp_get_sqlagent_properties`.</span><span class="sxs-lookup"><span data-stu-id="ed206-201">You can get SQL Agent error log path using the `dbo.sp_get_sqlagent_properties` stored procedure.</span></span>  
  
 <span data-ttu-id="ed206-202">Consultez les journaux des événements étendus pour afficher les détails des erreurs.</span><span class="sxs-lookup"><span data-stu-id="ed206-202">Check the extended event logs to see details of the errors.</span></span> <span data-ttu-id="ed206-203">Résolvez les erreurs, ou redémarrez SQL Server Agent pour résoudre le problème.</span><span class="sxs-lookup"><span data-stu-id="ed206-203">fix the errors, or restart SQL Server Agent to correct the situation.</span></span>  
  
  
