---
title: 'SQL Server la gestion de sauvegarde sur Azure : interopérabilité et coexistence | Microsoft Docs'
description: Cet article décrit SQL Server la sauvegarde managée pour Microsoft Azure l’interopérabilité et la coexistence avec plusieurs fonctionnalités dans SQL Server 2014.
ms.custom: ''
ms.date: 03/07/2017
ms.prod: sql-server-2014
ms.reviewer: ''
ms.technology: backup-restore
ms.topic: conceptual
ms.assetid: 78fb78ed-653f-45fe-a02a-a66519bfee1b
author: mashamsft
ms.author: mathoma
ms.openlocfilehash: 2e2839fc4755fe47504e42e5058a5da117888900
ms.sourcegitcommit: ad4d92dce894592a259721a1571b1d8736abacdb
ms.translationtype: MT
ms.contentlocale: fr-FR
ms.lasthandoff: 08/04/2020
ms.locfileid: "87701526"
---
# <a name="sql-server-managed-backup-to-azure-interoperability-and-coexistence"></a><span data-ttu-id="83414-103">Sauvegarde managée SQL Server sur Azure : Interopérabilité et coexistence</span><span class="sxs-lookup"><span data-stu-id="83414-103">SQL Server Managed Backup to Azure: Interoperability and Coexistence</span></span>
  <span data-ttu-id="83414-104">Cette rubrique présente l'interopérabilité et la coexistence de [!INCLUDE[ss_smartbackup](../includes/ss-smartbackup-md.md)] avec plusieurs fonctionnalités dans [!INCLUDE[ssCurrent](../includes/sscurrent-md.md)].</span><span class="sxs-lookup"><span data-stu-id="83414-104">This topic describes [!INCLUDE[ss_smartbackup](../includes/ss-smartbackup-md.md)] interoperability and coexistence with several features in [!INCLUDE[ssCurrent](../includes/sscurrent-md.md)].</span></span> <span data-ttu-id="83414-105">Ces fonctionnalités sont les suivantes : les groupes de disponibilité AlwaysOn, la mise en miroir de bases de données, les plans de maintenance de sauvegarde, la copie des journaux de transactions, les sauvegardes ad hoc, le détachement d'une base de données et la suppression d'une base de données.</span><span class="sxs-lookup"><span data-stu-id="83414-105">These features include the following: AlwaysOn Availability Groups, Database Mirroring, Backup Maintenance Plans, Log Shipping, Ad hoc backups, Detach Database, and Drop Database.</span></span>  
  
### <a name="alwayson-availability-groups"></a><span data-ttu-id="83414-106">Groupes de disponibilité AlwaysOn</span><span class="sxs-lookup"><span data-stu-id="83414-106">AlwaysOn Availability Groups</span></span>  
 <span data-ttu-id="83414-107">Groupes de disponibilité AlwaysOn configurés en tant que solution Azure uniquement prise en charge pour [!INCLUDE[ss_smartbackup](../includes/ss-smartbackup-md.md)] .</span><span class="sxs-lookup"><span data-stu-id="83414-107">AlwaysOn Availability Groups that are configured as an Azure-only solution supported for [!INCLUDE[ss_smartbackup](../includes/ss-smartbackup-md.md)].</span></span> <span data-ttu-id="83414-108">Les configurations de groupes de disponibilité AlwaysOn locaux ou hybrides ne sont pas prises en charge.</span><span class="sxs-lookup"><span data-stu-id="83414-108">On-premises only, or Hybrid AlwaysOn Availability Group configurations are not supported.</span></span> <span data-ttu-id="83414-109">Pour plus d’informations et d’autres éléments à prendre en considération, consultez [configuration d’SQL Server gestion de la sauvegarde sur Azure pour les groupes de disponibilité](../../2014/database-engine/setting-up-sql-server-managed-backup-to-windows-azure-for-availability-groups.md)</span><span class="sxs-lookup"><span data-stu-id="83414-109">For more information and other considerations, see [Setting up SQL Server Managed Backup to Azure for Availability Groups](../../2014/database-engine/setting-up-sql-server-managed-backup-to-windows-azure-for-availability-groups.md)</span></span>  
  
### <a name="database-mirroring"></a><span data-ttu-id="83414-110">Mise en miroir de bases de données</span><span class="sxs-lookup"><span data-stu-id="83414-110">Database Mirroring</span></span>  
 <span data-ttu-id="83414-111">La [!INCLUDE[ss_smartbackup](../includes/ss-smartbackup-md.md)] est prise en charge uniquement sur la base de données principale.</span><span class="sxs-lookup"><span data-stu-id="83414-111">[!INCLUDE[ss_smartbackup](../includes/ss-smartbackup-md.md)] is supported only on the principal database.</span></span> <span data-ttu-id="83414-112">Si la base de données principale et le miroir sont configurés pour utiliser la [!INCLUDE[ss_smartbackup](../includes/ss-smartbackup-md.md)], la base de données mise en miroir est ignorée et ne sera pas sauvegardée.</span><span class="sxs-lookup"><span data-stu-id="83414-112">If both the principal and the mirror are configured to use [!INCLUDE[ss_smartbackup](../includes/ss-smartbackup-md.md)], the mirrored database is skipped and will not be backed up.</span></span> <span data-ttu-id="83414-113">Toutefois, en cas de basculement, la [!INCLUDE[ss_smartbackup](../includes/ss-smartbackup-md.md)] commence le processus de sauvegarde après que le miroir a terminé de permuter le rôle, et est en ligne.</span><span class="sxs-lookup"><span data-stu-id="83414-113">However, in the event of a failover, [!INCLUDE[ss_smartbackup](../includes/ss-smartbackup-md.md)] will start the backup process after the mirror has completed role switching and is online.</span></span> <span data-ttu-id="83414-114">Dans ce cas, les sauvegardes seront restaurées dans un nouveau conteneur.</span><span class="sxs-lookup"><span data-stu-id="83414-114">The backups will be stored in a new container in this case.</span></span> <span data-ttu-id="83414-115">Si le miroir n'est pas configuré pour utiliser la [!INCLUDE[ss_smartbackup](../includes/ss-smartbackup-md.md)], en cas de basculement, aucune sauvegarde n'est effectuée.</span><span class="sxs-lookup"><span data-stu-id="83414-115">If the mirror is not configured to use [!INCLUDE[ss_smartbackup](../includes/ss-smartbackup-md.md)], in the event of a failover, no backups are taken.</span></span> <span data-ttu-id="83414-116">Nous vous recommandons de configurer la [!INCLUDE[ss_smartbackup](../includes/ss-smartbackup-md.md)] sur le serveur principal et le miroir de façon à ce que les sauvegardes continuent en cas de basculement.</span><span class="sxs-lookup"><span data-stu-id="83414-116">We recommend that you configure [!INCLUDE[ss_smartbackup](../includes/ss-smartbackup-md.md)] on both the principal and the mirror so backups continue in the event of a failover.</span></span>  
  
> [!TIP]  
>  <span data-ttu-id="83414-117">Si vous créez une base de données mise en miroir sur une instance avec les paramètres par défaut de [!INCLUDE[ss_smartbackup](../includes/ss-smartbackup-md.md)], il peut être préférable de désactiver les valeurs par défaut de d'instance [!INCLUDE[ss_smartbackup](../includes/ss-smartbackup-md.md)], de façon à ce qu'elles ne soient pas appliquées à la base de données mise en miroir, puis de les réactiver après avoir configuré le principal et le miroir.</span><span class="sxs-lookup"><span data-stu-id="83414-117">If you are creating a mirrored database on an instance with [!INCLUDE[ss_smartbackup](../includes/ss-smartbackup-md.md)] default settings, it may be preferable to disable [!INCLUDE[ss_smartbackup](../includes/ss-smartbackup-md.md)] instance defaults, so they are not applied to the mirrored database, and then re-enable the instance defaults after configuring the Principal and the Mirror.</span></span>  
  
### <a name="maintenance-plan"></a><span data-ttu-id="83414-118">Plan de maintenance</span><span class="sxs-lookup"><span data-stu-id="83414-118">Maintenance Plan</span></span>  
 <span data-ttu-id="83414-119">L'utilisation de plans de maintenance pour créer des sauvegardes d'une base de données lorsque la [!INCLUDE[ss_smartbackup](../includes/ss-smartbackup-md.md)] est activée n'est pas prise en charge.</span><span class="sxs-lookup"><span data-stu-id="83414-119">Using Maintenance Plans for creating backups for a database when [!INCLUDE[ss_smartbackup](../includes/ss-smartbackup-md.md)] is enabled is not supported.</span></span> <span data-ttu-id="83414-120">Les plans de maintenance vont rompre la séquence de journaux de transactions consécutifs et la [!INCLUDE[ss_smartbackup](../includes/ss-smartbackup-md.md)] peut ne pas être en mesure d'assurer la récupérabilité de la base de données lors de la restauration.</span><span class="sxs-lookup"><span data-stu-id="83414-120">Maintenance plans will cause broken log chain and [!INCLUDE[ss_smartbackup](../includes/ss-smartbackup-md.md)] may not be able to support a guaranteed recoverability of the database during restore.</span></span> <span data-ttu-id="83414-121">Cela s'applique également si la [!INCLUDE[ss_smartbackup](../includes/ss-smartbackup-md.md)] est activée au niveau de l'instance.</span><span class="sxs-lookup"><span data-stu-id="83414-121">This also applies when [!INCLUDE[ss_smartbackup](../includes/ss-smartbackup-md.md)] is enabled at the instance level.</span></span>  
  
> [!TIP]  
>  <span data-ttu-id="83414-122">Les plans de maintenance avec des sauvegardes de type copie seule sont pris en charge par la [!INCLUDE[ss_smartbackup](../includes/ss-smartbackup-md.md)] configurée pour la même base de données ou instance.</span><span class="sxs-lookup"><span data-stu-id="83414-122">Maintenance Plans with Copy Only backups is supported with [!INCLUDE[ss_smartbackup](../includes/ss-smartbackup-md.md)] configured for the same database or instance.</span></span>  
  
### <a name="log-shipping"></a><span data-ttu-id="83414-123">Copie des journaux de transactions</span><span class="sxs-lookup"><span data-stu-id="83414-123">Log Shipping</span></span>  
 <span data-ttu-id="83414-124">Vous ne pouvez pas configurer la copie des journaux de transactions et la [!INCLUDE[ss_smartbackup](../includes/ss-smartbackup-md.md)] simultanément pour la même base de données.</span><span class="sxs-lookup"><span data-stu-id="83414-124">You cannot configure Log Shipping and [!INCLUDE[ss_smartbackup](../includes/ss-smartbackup-md.md)] for the same database at the same time.</span></span> <span data-ttu-id="83414-125">Cela affecte la récupérabilité de la base de données de l'une ou l'autre fonctionnalité.</span><span class="sxs-lookup"><span data-stu-id="83414-125">Doing so will affect the recoverability of the database using either functionality.</span></span>  
  
### <a name="ad-hoc-backups-using-transact-sql-and-sql-server-management-studio"></a><span data-ttu-id="83414-126">Sauvegardes ad hoc à l'aide de Transact-SQL et SQL Server Management Studio</span><span class="sxs-lookup"><span data-stu-id="83414-126">Ad Hoc Backups Using Transact-SQL and SQL Server Management Studio</span></span>  
 <span data-ttu-id="83414-127">Les sauvegardes ad hoc ou uniques créées hors de la [!INCLUDE[ss_smartbackup](../includes/ss-smartbackup-md.md)] avec Transact-SQL ou SQL Server Management Studio peuvent affecter le processus de [!INCLUDE[ss_smartbackup](../includes/ss-smartbackup-md.md)] en fonction du type de sauvegarde et du support de stockage utilisé.</span><span class="sxs-lookup"><span data-stu-id="83414-127">Ad hoc or one time backups created outside [!INCLUDE[ss_smartbackup](../includes/ss-smartbackup-md.md)] using Transact-SQL or SQL Server Management Studio may affect the [!INCLUDE[ss_smartbackup](../includes/ss-smartbackup-md.md)] process depending on the type of backup and the storage media used.</span></span> <span data-ttu-id="83414-128">Les sauvegardes de journaux vers un autre compte de stockage Azure que celui qui [!INCLUDE[ss_smartbackup](../includes/ss-smartbackup-md.md)] utilise, ou toute autre destination que le service de stockage d’objets BLOB Azure, entraînent une rupture de la séquence de journaux.</span><span class="sxs-lookup"><span data-stu-id="83414-128">Log backups to a different Azure storage account than what [!INCLUDE[ss_smartbackup](../includes/ss-smartbackup-md.md)] is using, or any other destination than the Azure Blob storage service, will cause a log chain break.</span></span> <span data-ttu-id="83414-129">Nous vous recommandons d’utiliser l' [smart_admin. sp_backup_on_demand &#40;procédure stockée Transact-SQL&#41;](/sql/relational-databases/system-stored-procedures/managed-backup-sp-backup-on-demand-transact-sql) pour lancer une sauvegarde sur les bases de données qui ont [!INCLUDE[ss_smartbackup](../includes/ss-smartbackup-md.md)] activé.</span><span class="sxs-lookup"><span data-stu-id="83414-129">We recommend that you use the [smart_admin.sp_backup_on_demand &#40;Transact-SQL&#41;](/sql/relational-databases/system-stored-procedures/managed-backup-sp-backup-on-demand-transact-sql) stored procedure to initiate a backup on databases that have [!INCLUDE[ss_smartbackup](../includes/ss-smartbackup-md.md)] enabled.</span></span> <span data-ttu-id="83414-130">Effectuez une sauvegarde de base de données complète ou bien une sauvegarde de fichier journal en utilisant cette procédure stockée.</span><span class="sxs-lookup"><span data-stu-id="83414-130">You can initiate either a full database or log backup using this stored procedure.</span></span>  
  
### <a name="drop-database-and-detach-database"></a><span data-ttu-id="83414-131">Supprimer et détacher une base de données</span><span class="sxs-lookup"><span data-stu-id="83414-131">Drop Database and Detach Database</span></span>  
 <span data-ttu-id="83414-132">Si une base de données activée pour la [!INCLUDE[ss_smartbackup](../includes/ss-smartbackup-md.md)] est supprimée ou détachée, bien qu'aucune sauvegarde ne soit plus possible, les sauvegardes précédentes restent dans le stockage jusqu'à l'expiration de la période de rétention, après quoi, elles seront purgées.</span><span class="sxs-lookup"><span data-stu-id="83414-132">If a database that has [!INCLUDE[ss_smartbackup](../includes/ss-smartbackup-md.md)] enabled is detached or dropped, although no additional backups are possible, the previous backups remain in the storage until the retention period has elapsed, at which point the backups will be purged.</span></span>  
  
### <a name="changes-to-recovery-model"></a><span data-ttu-id="83414-133">Changements apportés au modèle de récupération</span><span class="sxs-lookup"><span data-stu-id="83414-133">Changes to Recovery Model</span></span>  
  
-   <span data-ttu-id="83414-134">Si vous modifiez le mode de récupération d’une base de données de **simple** à **complet** ou **journalisé en bloc**, vous avez la possibilité de configurer [!INCLUDE[ss_smartbackup](../includes/ss-smartbackup-md.md)] pour la base de données.</span><span class="sxs-lookup"><span data-stu-id="83414-134">If you change the recovery model of a database from **Simple** to **Full** or **Bulk-Logged**, you have the option of configuring [!INCLUDE[ss_smartbackup](../includes/ss-smartbackup-md.md)] for the database.</span></span> <span data-ttu-id="83414-135">La base de données sera considérée comme une nouvelle base de données par la [!INCLUDE[ss_smartbackup](../includes/ss-smartbackup-md.md)].</span><span class="sxs-lookup"><span data-stu-id="83414-135">This will be considered like a new database from [!INCLUDE[ss_smartbackup](../includes/ss-smartbackup-md.md)] perspective.</span></span>  
  
-   <span data-ttu-id="83414-136">Si vous modifiez le mode de récupération d’une base de données **complète** ou de la **journalisation en bloc** en **simple**, qui est [!INCLUDE[ss_smartbackup](../includes/ss-smartbackup-md.md)] activée, les opérations de sauvegarde ne seront plus planifiées.</span><span class="sxs-lookup"><span data-stu-id="83414-136">If you change the recovery model of a database from **Full** or **Bulk-Logged** to **Simple**, that has [!INCLUDE[ss_smartbackup](../includes/ss-smartbackup-md.md)] enabled, backup operations will no longer be scheduled.</span></span> <span data-ttu-id="83414-137">Le paramètre de période de rétention continue d'être appliqué et les fichiers de sauvegarde resteront dans le compte de stockage jusqu'à l'expiration de la période de rétention.</span><span class="sxs-lookup"><span data-stu-id="83414-137">The retention period setting will still be active and backup files will remain in the storage account until the retention period has elapsed.</span></span> <span data-ttu-id="83414-138">Si vous souhaitez conserver les sauvegardes, nous vous recommandons de télécharger les fichiers dans un compte de stockage différent ou dans un emplacement local.</span><span class="sxs-lookup"><span data-stu-id="83414-138">If you want to retain the backups, we recommend that you download the files either to a different storage account or to an on-premises location.</span></span> <span data-ttu-id="83414-139">Les paramètres de configuration sont conservés et peuvent être réutilisés si le mode de récupération est de nouveau défini sur **complet** ou **journalisé en bloc** .</span><span class="sxs-lookup"><span data-stu-id="83414-139">The configuration settings are retained and can be reused if the recovery model is set back to **Full** or **Bulk-Logged** again.</span></span>  
  
### <a name="log-backups-using-other-backup-tools-or-custom-scripts"></a><span data-ttu-id="83414-140">Sauvegarde de fichier journal avec d'autres outils de sauvegarde ou des scripts personnalisés</span><span class="sxs-lookup"><span data-stu-id="83414-140">Log Backups Using Other Backup Tools or Custom Scripts</span></span>  
 <span data-ttu-id="83414-141">Deux sauvegardes qui sont configurées pour effectuer des sauvegardes de fichier journal sur la même base de données entraîneront une interruption de la séquence des journaux de sauvegarde.</span><span class="sxs-lookup"><span data-stu-id="83414-141">Any two backups that are configured to perform log backups on the same database will cause break in the backup log chain.</span></span> <span data-ttu-id="83414-142">Bien que la [!INCLUDE[ss_smartbackup](../includes/ss-smartbackup-md.md)] tente de remédier à l'interruption dans la séquence de sauvegarde en planifiant des sauvegardes complètes lorsqu'une interruption est détectée, cela revient à suivre de façon permanente les interruptions périodiques et les sauvegardes de fichier journal effectuées par deux outils concurrents.</span><span class="sxs-lookup"><span data-stu-id="83414-142">Although [!INCLUDE[ss_smartbackup](../includes/ss-smartbackup-md.md)] will attempt to remedy the break in the backup chain by scheduling full backups when a break in chain is detected, this means keeping up continuously with periodic breaks and log backups performed by two competing tools.</span></span> <span data-ttu-id="83414-143">Cela peut également affecter la récupérabilité de la base de données car aucun outil ne peut avoir un jeu complet de sauvegardes en séquence.</span><span class="sxs-lookup"><span data-stu-id="83414-143">This can also potentially affect the recoverability of the database since no one tool can be expected to have a full set of backup in sequence.</span></span> <span data-ttu-id="83414-144">Bien que cela s'applique à toutes les fonctionnalités ou outils effectuant des sauvegardes de fichier journal, il est utile de donner des exemples spécifiques, comme décrit ci-dessous.</span><span class="sxs-lookup"><span data-stu-id="83414-144">Although this applies to any two features or tools performing log backups,, it is useful to call out specific examples as described below.</span></span> <span data-ttu-id="83414-145">Cela sert également à résoudre les problèmes de configuration des plans de maintenance ou de copie des journaux de transaction décrits dans les premières sections de cette rubrique.</span><span class="sxs-lookup"><span data-stu-id="83414-145">This is also the basis for the issues with configuring maintenance plans or log shipping as described in earlier sections of this topic.</span></span>  
  
 <span data-ttu-id="83414-146">**Sauvegardes basées sur Data Protection Manager (DPM) :** Microsoft Data Protection Manager vous permet d’effectuer des sauvegardes complètes et incrémentielles.</span><span class="sxs-lookup"><span data-stu-id="83414-146">**Data Protection Manager (DPM) based backups:** Microsoft Data Protection Manager allows you to do full and incremental backups.</span></span> <span data-ttu-id="83414-147">Les sauvegardes incrémentielles sont des sauvegardes de fichier journal qui effectuent une troncation de journal après la création d'une sauvegarde de fichier journal T.</span><span class="sxs-lookup"><span data-stu-id="83414-147">The incremental backups are log backups that do perform a log truncation after creating a T-log backup.</span></span> <span data-ttu-id="83414-148">Par conséquent, la configuration de DPM et de la [!INCLUDE[ss_smartbackup](../includes/ss-smartbackup-md.md)] pour la même base de données n'est pas prise en charge.</span><span class="sxs-lookup"><span data-stu-id="83414-148">So configuring both DPM and [!INCLUDE[ss_smartbackup](../includes/ss-smartbackup-md.md)] for the same database is not supported.</span></span>  
  
 <span data-ttu-id="83414-149">**Outils tiers ou scripts :** Les outils tiers ou les scripts qui effectuent des sauvegardes de journaux provoquant la troncation du journal ne sont pas compatibles avec [!INCLUDE[ss_smartbackup](../includes/ss-smartbackup-md.md)] et ne sont pas pris en charge.</span><span class="sxs-lookup"><span data-stu-id="83414-149">**Third Party Tools or Scripts:** Any third party tool or scripts that perform log backups causing log truncation is incompatible with [!INCLUDE[ss_smartbackup](../includes/ss-smartbackup-md.md)], and is not supported.</span></span>  
  
 <span data-ttu-id="83414-150">Si vous avez [!INCLUDE[ss_smartbackup](../includes/ss-smartbackup-md.md)] activé la pour une instance de base de données et que vous souhaitez effectuer une sauvegarde ad hoc, vous pouvez utiliser l' [smart_admin. sp_backup_on_demand &#40;procédure stockée Transact-SQL&#41;](/sql/relational-databases/system-stored-procedures/managed-backup-sp-backup-on-demand-transact-sql) , comme décrit dans la section précédente.</span><span class="sxs-lookup"><span data-stu-id="83414-150">If you have [!INCLUDE[ss_smartbackup](../includes/ss-smartbackup-md.md)] enabled for a database instance, and you want to take an ad hoc backup you can either use the [smart_admin.sp_backup_on_demand &#40;Transact-SQL&#41;](/sql/relational-databases/system-stored-procedures/managed-backup-sp-backup-on-demand-transact-sql) stored procedure as described in the earlier section.</span></span> <span data-ttu-id="83414-151">Si vous avez également besoin de planifier des sauvegardes régulièrement en dehors la [!INCLUDE[ss_smartbackup](../includes/ss-smartbackup-md.md)], utilisez la sauvegarde de copie uniquement.</span><span class="sxs-lookup"><span data-stu-id="83414-151">If you also have a need to schedule or un backups periodically outside of [!INCLUDE[ss_smartbackup](../includes/ss-smartbackup-md.md)], you can use the Copy Only Backup.</span></span>  <span data-ttu-id="83414-152">Pour plus d’informations, consultez [Sauvegardes de copie uniquement &#40;SQL Server&#41;](../relational-databases/backup-restore/copy-only-backups-sql-server.md).</span><span class="sxs-lookup"><span data-stu-id="83414-152">For more information, see [Copy-Only Backups &#40;SQL Server&#41;](../relational-databases/backup-restore/copy-only-backups-sql-server.md).</span></span>  
  
  
