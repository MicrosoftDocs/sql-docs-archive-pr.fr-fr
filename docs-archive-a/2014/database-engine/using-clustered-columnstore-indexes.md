---
title: Utilisation d’index ColumnStore en cluster | Microsoft Docs
ms.custom: ''
ms.date: 04/27/2017
ms.prod: sql-server-2014
ms.reviewer: ''
ms.technology: table-view-index
ms.topic: conceptual
ms.assetid: 5af6b91c-724f-45ac-aff1-7555014914f4
author: mashamsft
ms.author: mathoma
ms.openlocfilehash: afc7da4e28ef7f32ca4a2b4ea762e5a5af442471
ms.sourcegitcommit: ad4d92dce894592a259721a1571b1d8736abacdb
ms.translationtype: MT
ms.contentlocale: fr-FR
ms.lasthandoff: 08/04/2020
ms.locfileid: "87601040"
---
# <a name="using-clustered-columnstore-indexes"></a><span data-ttu-id="bf361-102">Utilisation d'index columnstore cluster</span><span class="sxs-lookup"><span data-stu-id="bf361-102">Using Clustered Columnstore Indexes</span></span>
  <span data-ttu-id="bf361-103">Tâches pour utiliser des index columnstore cluster dans [!INCLUDE[ssNoVersion](../includes/ssnoversion-md.md)].</span><span class="sxs-lookup"><span data-stu-id="bf361-103">Tasks for using clustered columnstore indexes in [!INCLUDE[ssNoVersion](../includes/ssnoversion-md.md)].</span></span>

 <span data-ttu-id="bf361-104">Pour une présentation des index columnstore, consultez [Columnstore Indexes Described](../relational-databases/indexes/columnstore-indexes-described.md).</span><span class="sxs-lookup"><span data-stu-id="bf361-104">For an overview of columnstore indexes, see [Columnstore Indexes Described](../relational-databases/indexes/columnstore-indexes-described.md).</span></span>

 <span data-ttu-id="bf361-105">Pour plus d'informations sur les index columnstore cluster, consultez [Using Clustered Columnstore Indexes](../relational-databases/indexes/indexes.md).</span><span class="sxs-lookup"><span data-stu-id="bf361-105">For information about clustered columnstore indexes, see [Using Clustered Columnstore Indexes](../relational-databases/indexes/indexes.md).</span></span>

## <a name="contents"></a><span data-ttu-id="bf361-106">Contenu</span><span class="sxs-lookup"><span data-stu-id="bf361-106">Contents</span></span>

-   [<span data-ttu-id="bf361-107">Créer un index columnstore cluster</span><span class="sxs-lookup"><span data-stu-id="bf361-107">Create a Clustered Columnstore Index</span></span>](#create)

-   [<span data-ttu-id="bf361-108">Supprimer un index columnstore cluster</span><span class="sxs-lookup"><span data-stu-id="bf361-108">Drop a Clustered Columnstore Index</span></span>](#drop)

-   [<span data-ttu-id="bf361-109">Charger des données dans un index columnstore cluster</span><span class="sxs-lookup"><span data-stu-id="bf361-109">Load Data into a Clustered Columnstore Index</span></span>](#load)

-   [<span data-ttu-id="bf361-110">Changer des données dans un index columnstore cluster</span><span class="sxs-lookup"><span data-stu-id="bf361-110">Change Data in a Clustered Columnstore Index</span></span>](#change)

-   [<span data-ttu-id="bf361-111">Reconstruire un index ColumnStore cluster</span><span class="sxs-lookup"><span data-stu-id="bf361-111">Rebuild a Clustered Columnstore Index</span></span>](#rebuild)

-   [<span data-ttu-id="bf361-112">Réorganiser un index cluster columnstore</span><span class="sxs-lookup"><span data-stu-id="bf361-112">Reorganize a Clustered Columnstore Index</span></span>](#reorganize)

##  <a name="create-a-clustered-columnstore-index"></a><a name="create"></a><span data-ttu-id="bf361-113">Créer un index ColumnStore cluster</span><span class="sxs-lookup"><span data-stu-id="bf361-113">Create a Clustered Columnstore Index</span></span>
 <span data-ttu-id="bf361-114">Pour créer un index ColumnStore cluster, commencez par créer une table rowstore en tant que segment de mémoire ou index cluster, puis utilisez l’instruction [Create Clustered COLUMNSTORE index &#40;Transact-SQL&#41;](/sql/t-sql/statements/create-columnstore-index-transact-sql) pour convertir la table en index ColumnStore cluster.</span><span class="sxs-lookup"><span data-stu-id="bf361-114">To create a clustered columnstore index, first create a rowstore table as a heap or clustered index, and then use the [CREATE CLUSTERED COLUMNSTORE INDEX &#40;Transact-SQL&#41;](/sql/t-sql/statements/create-columnstore-index-transact-sql) statement to convert the table to a clustered columnstore index.</span></span> <span data-ttu-id="bf361-115">Si vous souhaitez que l'index columnstore cluster ait le même nom que l'index cluster, utilisez l'option DROP_EXISTING.</span><span class="sxs-lookup"><span data-stu-id="bf361-115">If you want the clustered columnstore index to have the same name as the clustered index, use the DROP_EXISTING option.</span></span>

 <span data-ttu-id="bf361-116">Cet exemple crée une table en tant que segment puis la convertit en un index columnstore cluster nommé cci_Simple.</span><span class="sxs-lookup"><span data-stu-id="bf361-116">This example creates a table as a heap and then converts it to a clustered columnstore index named cci_Simple.</span></span> <span data-ttu-id="bf361-117">Cela modifie le stockage de la table entière qui change de rowstore en columnstore.</span><span class="sxs-lookup"><span data-stu-id="bf361-117">This changes the storage for the entire table from rowstore to columnstore.</span></span>

```
CREATE TABLE T1(
    ProductKey [int] NOT NULL, 
    OrderDateKey [int] NOT NULL, 
    DueDateKey [int] NOT NULL, 
    ShipDateKey [int] NOT NULL);
GO
CREATE CLUSTERED COLUMNSTORE INDEX cci_T1 ON T1;
GO
```

 <span data-ttu-id="bf361-118">Pour obtenir plus d’exemples, consultez la section exemples dans [Create Clustered COLUMNSTORE INDEX &#40;Transact-SQL&#41;](/sql/t-sql/statements/create-columnstore-index-transact-sql).</span><span class="sxs-lookup"><span data-stu-id="bf361-118">For more examples, see the Examples section in [CREATE CLUSTERED COLUMNSTORE INDEX &#40;Transact-SQL&#41;](/sql/t-sql/statements/create-columnstore-index-transact-sql).</span></span>

##  <a name="drop-a-clustered-columnstore-index"></a><a name="drop"></a><span data-ttu-id="bf361-119">Supprimer un index ColumnStore cluster</span><span class="sxs-lookup"><span data-stu-id="bf361-119">Drop a Clustered Columnstore Index</span></span>
 <span data-ttu-id="bf361-120">Utilisez l’instruction [DROP INDEX &#40;Transact-SQL&#41;](/sql/t-sql/statements/drop-index-transact-sql) pour supprimer un index cluster ColumnStore.</span><span class="sxs-lookup"><span data-stu-id="bf361-120">Use the [DROP INDEX &#40;Transact-SQL&#41;](/sql/t-sql/statements/drop-index-transact-sql) statement to drop a clustered columnstore index.</span></span> <span data-ttu-id="bf361-121">Cette opération supprime l'index et convertit la table columnstore en un segment de mémoire rowstore.</span><span class="sxs-lookup"><span data-stu-id="bf361-121">This operation will drop the index and convert the columnstore table to a rowstore heap.</span></span>

##  <a name="load-data-into-a-clustered-columnstore-index"></a><a name="load"></a><span data-ttu-id="bf361-122">Charger des données dans un index ColumnStore cluster</span><span class="sxs-lookup"><span data-stu-id="bf361-122">Load Data into a Clustered Columnstore Index</span></span>
 <span data-ttu-id="bf361-123">Ajoutez des données à un index columnstore cluster existant à l'aide de l'une des méthodes de chargement standard.</span><span class="sxs-lookup"><span data-stu-id="bf361-123">You can add data to an existing clustered columnstore index by using any of the standard loading methods.</span></span>  <span data-ttu-id="bf361-124">Par exemple, l’outil de chargement en masse BCP, Integration Services et INSERT... SELECT peut toutes charger des données dans un index ColumnStore en cluster.</span><span class="sxs-lookup"><span data-stu-id="bf361-124">For example, the bcp bulk loading tool, Integration Services, and INSERT ... SELECT can all load data into a clustered columnstore index.</span></span>

 <span data-ttu-id="bf361-125">Les index columnstore cluster tirent parti du deltastore pour éviter la fragmentation de segments de colonne dans le columnstore.</span><span class="sxs-lookup"><span data-stu-id="bf361-125">Clustered columnstore indexes leverage the deltastore in order to prevent fragmentation of column segments in the columnstore.</span></span>

### <a name="loading-into-a-partitioned-table"></a><span data-ttu-id="bf361-126">Chargement dans une table partitionnée</span><span class="sxs-lookup"><span data-stu-id="bf361-126">Loading into a partitioned table</span></span>
 <span data-ttu-id="bf361-127">Pour les données partitionnées, [!INCLUDE[ssNoVersion](../includes/ssnoversion-md.md)] affecte d'abord chaque ligne à une partition, puis effectue les opérations de columnstore sur les données dans la partition.</span><span class="sxs-lookup"><span data-stu-id="bf361-127">For partitioned data, [!INCLUDE[ssNoVersion](../includes/ssnoversion-md.md)] first assigns each row to a partition, and then performs columnstore operations on the data within the partition.</span></span> <span data-ttu-id="bf361-128">Chaque partition a ses propres rowgroups et au moins un deltastore.</span><span class="sxs-lookup"><span data-stu-id="bf361-128">Each partition has its own rowgroups and at least one deltastore.</span></span>

### <a name="deltastore-loading-scenarios"></a><span data-ttu-id="bf361-129">Scénarios de chargement de deltastore</span><span class="sxs-lookup"><span data-stu-id="bf361-129">Deltastore loading scenarios</span></span>
 <span data-ttu-id="bf361-130">Les lignes s'accumulent dans le deltastore tant que le nombre de lignes n'atteint pas le nombre maximal de lignes autorisées pour un rowgroup.</span><span class="sxs-lookup"><span data-stu-id="bf361-130">Rows accumulate in the deltastore until the number of rows is the maximum number of rows allowed for a rowgroup.</span></span> <span data-ttu-id="bf361-131">Lorsque le deltastore contient le nombre maximal de lignes par rowgroup, [!INCLUDE[ssNoVersion](../includes/ssnoversion-md.md)] marque le rowgroup comme étant « fermé ».</span><span class="sxs-lookup"><span data-stu-id="bf361-131">When the deltastore contains the maximum number of rows per rowgroup, [!INCLUDE[ssNoVersion](../includes/ssnoversion-md.md)] marks the rowgroup as "CLOSED".</span></span> <span data-ttu-id="bf361-132">Un processus en arrière-plan, appelé « Tuple-Mover », recherche le rowgroup fermé et se déplace dans le ColumnStore, où le rowgroup est compressé en segments de colonne et les segments de colonne sont stockés dans le ColumnStore.</span><span class="sxs-lookup"><span data-stu-id="bf361-132">A background process, called the "tuple-mover", finds the CLOSED rowgroup and moves into the columnstore, where the rowgroup is compressed into column segments and the column segments are stored in the columnstore.</span></span>

 <span data-ttu-id="bf361-133">Pour chaque index columnstore cluster il peut y avoir plusieurs deltastores.</span><span class="sxs-lookup"><span data-stu-id="bf361-133">For each clustered columnstore index there can be multiple deltastores.</span></span>

-   <span data-ttu-id="bf361-134">Si un deltastore est verrouillé, [!INCLUDE[ssNoVersion](../includes/ssnoversion-md.md)] essaie d'obtenir un verrou sur un autre deltastore.</span><span class="sxs-lookup"><span data-stu-id="bf361-134">If a deltastore is locked, [!INCLUDE[ssNoVersion](../includes/ssnoversion-md.md)] will try to obtain a lock on a different deltastore.</span></span> <span data-ttu-id="bf361-135">Si aucun deltastore n'est disponible, [!INCLUDE[ssNoVersion](../includes/ssnoversion-md.md)] crée un nouveau deltastore.</span><span class="sxs-lookup"><span data-stu-id="bf361-135">If there are no deltastores available, [!INCLUDE[ssNoVersion](../includes/ssnoversion-md.md)] will create a new deltastore.</span></span>

-   <span data-ttu-id="bf361-136">Pour une table partitionnée, il peut y avoir un ou plusieurs deltastores pour chaque partition.</span><span class="sxs-lookup"><span data-stu-id="bf361-136">For a partitioned table, there can be one or more deltastores for each partition.</span></span>

 <span data-ttu-id="bf361-137">Pour les index columnstore cluster uniquement, les scénarios suivants décrivent à quel moment les lignes chargées sont directement placées dans le columnstore ou dans le deltastore.</span><span class="sxs-lookup"><span data-stu-id="bf361-137">For clustered columnstore indexes only, the following scenarios describe when loaded rows go directly to the columnstore or when they go to the deltastore.</span></span>

 <span data-ttu-id="bf361-138">Dans l'exemple, chaque rowgroup peut avoir 102 400-1 048 576 lignes par rowgroup.</span><span class="sxs-lookup"><span data-stu-id="bf361-138">In the example, each rowgroup can have 102,400-1,048,576 rows per rowgroup.</span></span>

|<span data-ttu-id="bf361-139">Lignes à charger en masse</span><span class="sxs-lookup"><span data-stu-id="bf361-139">Rows to Bulk Load</span></span>|<span data-ttu-id="bf361-140">Lignes ajoutées au columnstore</span><span class="sxs-lookup"><span data-stu-id="bf361-140">Rows Added to the Columnstore</span></span>|<span data-ttu-id="bf361-141">Lignes ajoutées au deltastore</span><span class="sxs-lookup"><span data-stu-id="bf361-141">Rows Added to the Deltastore</span></span>|
|-----------------------|-----------------------------------|----------------------------------|
|<span data-ttu-id="bf361-142">102 000</span><span class="sxs-lookup"><span data-stu-id="bf361-142">102,000</span></span>|<span data-ttu-id="bf361-143">0</span><span class="sxs-lookup"><span data-stu-id="bf361-143">0</span></span>|<span data-ttu-id="bf361-144">102 000</span><span class="sxs-lookup"><span data-stu-id="bf361-144">102,000</span></span>|
|<span data-ttu-id="bf361-145">145 000</span><span class="sxs-lookup"><span data-stu-id="bf361-145">145,000</span></span>|<span data-ttu-id="bf361-146">145 000</span><span class="sxs-lookup"><span data-stu-id="bf361-146">145,000</span></span><br /><br /> <span data-ttu-id="bf361-147">Taille de rowgroup : 145 000</span><span class="sxs-lookup"><span data-stu-id="bf361-147">Rowgroup size: 145,000</span></span>|<span data-ttu-id="bf361-148">0</span><span class="sxs-lookup"><span data-stu-id="bf361-148">0</span></span>|
|<span data-ttu-id="bf361-149">1 048 577</span><span class="sxs-lookup"><span data-stu-id="bf361-149">1,048,577</span></span>|<span data-ttu-id="bf361-150">1,048,576</span><span class="sxs-lookup"><span data-stu-id="bf361-150">1,048,576</span></span><br /><br /> <span data-ttu-id="bf361-151">Taille de rowgroup : 1 048 576</span><span class="sxs-lookup"><span data-stu-id="bf361-151">Rowgroup size: 1,048,576.</span></span>|<span data-ttu-id="bf361-152">1</span><span class="sxs-lookup"><span data-stu-id="bf361-152">1</span></span>|
|<span data-ttu-id="bf361-153">2 252 152</span><span class="sxs-lookup"><span data-stu-id="bf361-153">2,252,152</span></span>|<span data-ttu-id="bf361-154">2 252 152</span><span class="sxs-lookup"><span data-stu-id="bf361-154">2,252,152</span></span><br /><br /> <span data-ttu-id="bf361-155">Tailles de rowgroup : 1 048 576, 1 048 576, 155 000.</span><span class="sxs-lookup"><span data-stu-id="bf361-155">Rowgroup sizes: 1,048,576, 1,048,576, 155,000.</span></span>|<span data-ttu-id="bf361-156">0</span><span class="sxs-lookup"><span data-stu-id="bf361-156">0</span></span>|

 <span data-ttu-id="bf361-157">L'exemple suivant montre les résultats du chargement de 1 048 577 lignes dans une partition.</span><span class="sxs-lookup"><span data-stu-id="bf361-157">The following example shows the results of loading 1,048,577 rows into a partition.</span></span> <span data-ttu-id="bf361-158">Les résultats indiquent un rowgroup COMPRESSÉ dans le columnstore (comme segments de colonne compressés), et 1 ligne dans le deltastore.</span><span class="sxs-lookup"><span data-stu-id="bf361-158">The results show that one COMPRESSED rowgroup in the columnstore (as compressed column segments), and 1 row in the deltastore.</span></span>

```sql
SELECT * FROM sys.column_store_row_groups;
```

 <span data-ttu-id="bf361-159">![Rowgroup et deltastore pour une charge de traitement](../../2014/database-engine/media/sql-server-pdw-columnstore-batchload.gif "Rowgroup et deltastore pour une charge de traitement")</span><span class="sxs-lookup"><span data-stu-id="bf361-159">![Rowgroup and deltastore for a batch load](../../2014/database-engine/media/sql-server-pdw-columnstore-batchload.gif "Rowgroup and deltastore for a batch load")</span></span>



##  <a name="change-data-in-a-clustered-columnstore-index"></a><a name="change"></a><span data-ttu-id="bf361-160">Modifier des données dans un index ColumnStore cluster</span><span class="sxs-lookup"><span data-stu-id="bf361-160">Change Data in a Clustered Columnstore Index</span></span>
 <span data-ttu-id="bf361-161">Les index columnstore cluster prennent en charge les opérations DML d'insertion, mise à jour et suppression.</span><span class="sxs-lookup"><span data-stu-id="bf361-161">Clustered columnstore indexes support insert, update, and delete DML operations.</span></span>

 <span data-ttu-id="bf361-162">Utilisez [insert &#40;&#41;Transact-SQL](/sql/t-sql/statements/insert-transact-sql) pour insérer une ligne.</span><span class="sxs-lookup"><span data-stu-id="bf361-162">Use [INSERT &#40;Transact-SQL&#41;](/sql/t-sql/statements/insert-transact-sql) to insert a row.</span></span> <span data-ttu-id="bf361-163">La ligne sera ajoutée au deltastore.</span><span class="sxs-lookup"><span data-stu-id="bf361-163">The row will be added to the deltastore.</span></span>

 <span data-ttu-id="bf361-164">Utilisez [DELETE &#40;Transact-SQL&#41;](/sql/t-sql/statements/delete-transact-sql) pour supprimer une ligne.</span><span class="sxs-lookup"><span data-stu-id="bf361-164">Use [DELETE &#40;Transact-SQL&#41;](/sql/t-sql/statements/delete-transact-sql) to delete a row.</span></span>

-   <span data-ttu-id="bf361-165">Si la ligne est dans le columnstore, [!INCLUDE[ssNoVersion](../includes/ssnoversion-md.md)] marque la ligne comme étant supprimée logiquement, mais ne récupère pas le stockage physique pour la ligne tant que l'index n'est pas reconstruit.</span><span class="sxs-lookup"><span data-stu-id="bf361-165">If the row is in the columnstore, [!INCLUDE[ssNoVersion](../includes/ssnoversion-md.md)] marks the row as logically deleted but does not reclaim the physical storage for the row until the index is rebuilt.</span></span>

-   <span data-ttu-id="bf361-166">Si la ligne est dans le deltastore, [!INCLUDE[ssNoVersion](../includes/ssnoversion-md.md)] supprime la ligne logiquement et physiquement.</span><span class="sxs-lookup"><span data-stu-id="bf361-166">If the row is in the deltastore, [!INCLUDE[ssNoVersion](../includes/ssnoversion-md.md)] logically and physically deletes the row.</span></span>

 <span data-ttu-id="bf361-167">Utilisez [UPDATE &#40;Transact-SQL&#41;](/sql/t-sql/queries/update-transact-sql) pour mettre à jour une ligne.</span><span class="sxs-lookup"><span data-stu-id="bf361-167">Use [UPDATE &#40;Transact-SQL&#41;](/sql/t-sql/queries/update-transact-sql) to update a row.</span></span>

-   <span data-ttu-id="bf361-168">Si la ligne est dans le columnstore, [!INCLUDE[ssNoVersion](../includes/ssnoversion-md.md)] marque la ligne comme étant supprimée logiquement, puis insère la ligne mise à jour dans le deltastore.</span><span class="sxs-lookup"><span data-stu-id="bf361-168">If the row is in the columnstore, [!INCLUDE[ssNoVersion](../includes/ssnoversion-md.md)] marks the row as logically deleted, and then inserts the updated row into the deltastore.</span></span>

-   <span data-ttu-id="bf361-169">Si la ligne est dans le deltastore, [!INCLUDE[ssNoVersion](../includes/ssnoversion-md.md)] met à jour la ligne dans le deltastore.</span><span class="sxs-lookup"><span data-stu-id="bf361-169">If the row is in the deltastore, [!INCLUDE[ssNoVersion](../includes/ssnoversion-md.md)] updates the row in the deltastore.</span></span>

##  <a name="rebuild-a-clustered-columnstore-index"></a><a name="rebuild"></a><span data-ttu-id="bf361-170">Reconstruire un index ColumnStore cluster</span><span class="sxs-lookup"><span data-stu-id="bf361-170">Rebuild a Clustered Columnstore Index</span></span>
 <span data-ttu-id="bf361-171">Utilisez [Create Clustered COLUMNSTORE index &#40;Transact-sql&#41;](/sql/t-sql/statements/create-columnstore-index-transact-sql) ou [ALTER index &#40;transact-SQL&#41;](/sql/t-sql/statements/alter-index-transact-sql) pour effectuer une reconstruction complète d’un index COLUMNSTORE cluster existant.</span><span class="sxs-lookup"><span data-stu-id="bf361-171">Use [CREATE CLUSTERED COLUMNSTORE INDEX &#40;Transact-SQL&#41;](/sql/t-sql/statements/create-columnstore-index-transact-sql) or [ALTER INDEX &#40;Transact-SQL&#41;](/sql/t-sql/statements/alter-index-transact-sql) to perform a full rebuild of an existing clustered columnstore index.</span></span> <span data-ttu-id="bf361-172">En outre, vous pouvez utiliser ALTER INDEX... Régénérez pour reconstruire une partition spécifique.</span><span class="sxs-lookup"><span data-stu-id="bf361-172">Additionally, you can use ALTER INDEX ... REBUILD to rebuild a specific partition.</span></span>

### <a name="rebuild-process"></a><span data-ttu-id="bf361-173">Processus de reconstruction</span><span class="sxs-lookup"><span data-stu-id="bf361-173">Rebuild Process</span></span>
 <span data-ttu-id="bf361-174">Pour reconstruire un index cluster columnstore, [!INCLUDE[ssNoVersion](../includes/ssnoversion-md.md)] :</span><span class="sxs-lookup"><span data-stu-id="bf361-174">To rebuild a clustered columnstore index, [!INCLUDE[ssNoVersion](../includes/ssnoversion-md.md)]:</span></span>

-   <span data-ttu-id="bf361-175">Acquiert un verrou exclusif sur la table ou la partition lorsque la reconstruction se produit.</span><span class="sxs-lookup"><span data-stu-id="bf361-175">Acquires an exclusive lock on the table or partition while the rebuild occurs.</span></span>  <span data-ttu-id="bf361-176">Les données sont « hors connexion » et indisponibles pendant la reconstruction.</span><span class="sxs-lookup"><span data-stu-id="bf361-176">The data is "offline" and unavailable during the rebuild.</span></span>

-   <span data-ttu-id="bf361-177">Défragmente le columnstore en supprimant physiquement les lignes qui ont été logiquement supprimées de la table ; les octets supprimés sont récupérés sur le support physique.</span><span class="sxs-lookup"><span data-stu-id="bf361-177">Defragments the columnstore by physically deleting rows that have been logically deleted from the table; the deleted bytes are reclaimed on the physical media.</span></span>

-   <span data-ttu-id="bf361-178">Fusionne les données rowstore dans le deltastore, avec les données du columnstore avant de reconstruire l'index.</span><span class="sxs-lookup"><span data-stu-id="bf361-178">Merges the rowstore data in the deltastore with the data in the columnstore before it rebuilds the index.</span></span> <span data-ttu-id="bf361-179">Lorsque la reconstruction est terminée, toutes les données sont stockées au format columnstore, puis le deltastore est vide.</span><span class="sxs-lookup"><span data-stu-id="bf361-179">When the rebuild is finished, all data is stored in columnstore format, and the deltastore is empty.</span></span>

-   <span data-ttu-id="bf361-180">Recompresse toutes les données dans le columnstore.</span><span class="sxs-lookup"><span data-stu-id="bf361-180">Re-compresses all data into the columnstore.</span></span> <span data-ttu-id="bf361-181">Il existe deux copies de l'index columnstore pendant la reconstruction.</span><span class="sxs-lookup"><span data-stu-id="bf361-181">Two copies of the columnstore index exist while the rebuild is taking place.</span></span> <span data-ttu-id="bf361-182">Lorsque la reconstruction est terminée, [!INCLUDE[ssNoVersion](../includes/ssnoversion-md.md)] supprime l'index columnstore d'origine.</span><span class="sxs-lookup"><span data-stu-id="bf361-182">When the rebuild is finished, [!INCLUDE[ssNoVersion](../includes/ssnoversion-md.md)] deletes the original columnstore index.</span></span>

### <a name="recommendations-for-rebuilding-a-clustered-columnstore-index"></a><span data-ttu-id="bf361-183">Recommandations pour reconstruire un index columnstore cluster</span><span class="sxs-lookup"><span data-stu-id="bf361-183">Recommendations for Rebuilding a Clustered Columnstore Index</span></span>
 <span data-ttu-id="bf361-184">Reconstruire un index columnstore cluster est utile pour supprimer une fragmentation, et pour déplacer toutes les lignes dans le columnstore.</span><span class="sxs-lookup"><span data-stu-id="bf361-184">Rebuilding a clustered columnstore index is useful for removing fragmentation, and for moving all rows into the columnstore.</span></span> <span data-ttu-id="bf361-185">Tenez compte des recommandations suivantes :</span><span class="sxs-lookup"><span data-stu-id="bf361-185">We have the following recommendations:</span></span>

-   <span data-ttu-id="bf361-186">Reconstruisez une partition au lieu de la table entière.</span><span class="sxs-lookup"><span data-stu-id="bf361-186">Rebuild a partition instead of the entire table.</span></span>

    1.  <span data-ttu-id="bf361-187">Reconstruire un index columnstore cluster entier prend beaucoup de temps si l'index est volumineux, et cela nécessite suffisamment d'espace disque pour stocker une copie supplémentaire de l'index pendant la reconstruction.</span><span class="sxs-lookup"><span data-stu-id="bf361-187">Rebuilding the entire table takes a long time if the index is large, and it requires enough disk space to store an additional copy of the index during the rebuild.</span></span> <span data-ttu-id="bf361-188">Généralement il est nécessaire de reconstruire que la dernière partition utilisée.</span><span class="sxs-lookup"><span data-stu-id="bf361-188">Usually it is only necessary to rebuild the most recently used partition.</span></span>

    2.  <span data-ttu-id="bf361-189">Pour les tables partitionnées, vous n'avez pas besoin de reconstruire l'index columnstore entier, car la fragmentation se produira probablement uniquement dans les partitions modifiées récemment.</span><span class="sxs-lookup"><span data-stu-id="bf361-189">For partitioned tables, you do not need to rebuild the entire columnstore index because fragmentation is likely to occur in only the partitions that have been modified recently.</span></span> <span data-ttu-id="bf361-190">Les tables de faits et de dimension volumineuses sont généralement partitionnées pour exécuter des opérations de sauvegarde et de gestion sur les segments de la table.</span><span class="sxs-lookup"><span data-stu-id="bf361-190">Fact tables and large dimension tables are usually partitioned in order to perform backup and management operations on chunks of the table.</span></span>

-   <span data-ttu-id="bf361-191">Reconstruisez une partition après des opérations DML lourdes.</span><span class="sxs-lookup"><span data-stu-id="bf361-191">Rebuild a partition after heavy DML operations.</span></span>

     <span data-ttu-id="bf361-192">Reconstruire une partition la défragmentera et réduira la mémoire sur disque.</span><span class="sxs-lookup"><span data-stu-id="bf361-192">Rebuilding a partition will defragment the partition and reduce disk storage.</span></span> <span data-ttu-id="bf361-193">La reconstruction supprimera toutes les lignes du columnstore marquées pour suppression, et déplacera toutes les lignes du deltastore dans le columnstore.</span><span class="sxs-lookup"><span data-stu-id="bf361-193">Rebuilding will delete all rows from the columnstore that are marked for deletion, and it will move all rows from the deltastore into the columnstore.</span></span>

-   <span data-ttu-id="bf361-194">Reconstruisez une partition après le chargement des données.</span><span class="sxs-lookup"><span data-stu-id="bf361-194">Rebuild a partition after loading data.</span></span>

     <span data-ttu-id="bf361-195">Cela garantit que toutes les données sont stockées dans le columnstore.</span><span class="sxs-lookup"><span data-stu-id="bf361-195">This ensures all data is stored in the columnstore.</span></span> <span data-ttu-id="bf361-196">Si plusieurs chargements se produisent simultanément, chaque partition peut disposer de plusieurs deltastores.</span><span class="sxs-lookup"><span data-stu-id="bf361-196">If multiple loads occur at the same time, each partition could end up having multiple deltastores.</span></span> <span data-ttu-id="bf361-197">La reconstruction déplacera toutes les lignes du deltastore dans le columnstore.</span><span class="sxs-lookup"><span data-stu-id="bf361-197">Rebuilding will move all deltastore rows into the columnstore.</span></span>

##  <a name="reorganize-a-clustered-columnstore-index"></a><a name="reorganize"></a><span data-ttu-id="bf361-198">Réorganiser un index ColumnStore cluster</span><span class="sxs-lookup"><span data-stu-id="bf361-198">Reorganize a Clustered Columnstore Index</span></span>
 <span data-ttu-id="bf361-199">La réorganisation des index columnstore cluster déplace tous les rowgroups fermés dans le columnstore.</span><span class="sxs-lookup"><span data-stu-id="bf361-199">Reorganizing a clustered columnstore index moves all CLOSED rowgroups into the columnstore.</span></span> <span data-ttu-id="bf361-200">Pour effectuer une réorganisation, utilisez [ALTER INDEX &#40;&#41;Transact-SQL ](/sql/t-sql/statements/alter-index-transact-sql)avec l’option REORGANIZE.</span><span class="sxs-lookup"><span data-stu-id="bf361-200">To perform a reorganize, use [ALTER INDEX &#40;Transact-SQL&#41;](/sql/t-sql/statements/alter-index-transact-sql)with the REORGANIZE option.</span></span>

 <span data-ttu-id="bf361-201">La réorganisation n'est pas requise pour déplacer les rowgroups fermés dans le columnstore.</span><span class="sxs-lookup"><span data-stu-id="bf361-201">Reorganizing is not required in order to move CLOSED rowgroups into the columnstore.</span></span> <span data-ttu-id="bf361-202">Le processus de déplacement de tuple recherche tous les rowgroups CLOSED et les déplace.</span><span class="sxs-lookup"><span data-stu-id="bf361-202">The tuple-mover process will eventually find all CLOSED rowgroups and move them.</span></span> <span data-ttu-id="bf361-203">Toutefois, le processus de déplacement de tuple est monothread et peut ne pas déplacer les rowgroups suffisamment rapidement pour votre charge de travail.</span><span class="sxs-lookup"><span data-stu-id="bf361-203">However, the tuple-mover is single-threaded and might not move rowgroups fast enough for your workload.</span></span>

### <a name="recommendations-for-reorganizing"></a><span data-ttu-id="bf361-204">Recommandations pour la réorganisation</span><span class="sxs-lookup"><span data-stu-id="bf361-204">Recommendations for Reorganizing</span></span>
 <span data-ttu-id="bf361-205">Quand réorganiser un index cluster columnstore :</span><span class="sxs-lookup"><span data-stu-id="bf361-205">When to reorganize a clustered columnstore index:</span></span>

-   <span data-ttu-id="bf361-206">Réorganisez un index columnstore cluster après un ou plusieurs chargements de données pour obtenir des gains de performance des requêtes aussi rapidement que possible.</span><span class="sxs-lookup"><span data-stu-id="bf361-206">Reorganize a clustered columnstore index after one or more data loads to achieve query performance benefits as quickly as possible.</span></span> <span data-ttu-id="bf361-207">La réorganisation nécessite initialement des ressources processeur supplémentaires pour compresser les données, ce qui peut ralentir les performances globales du système.</span><span class="sxs-lookup"><span data-stu-id="bf361-207">Reorganizing will initially require additional CPU resources to compress the data, which could slow overall system performance.</span></span> <span data-ttu-id="bf361-208">Toutefois, dès que les données sont compressées, les performances des requêtes s'améliorent.</span><span class="sxs-lookup"><span data-stu-id="bf361-208">However, as soon as the data is compressed, query performance can improve.</span></span>


