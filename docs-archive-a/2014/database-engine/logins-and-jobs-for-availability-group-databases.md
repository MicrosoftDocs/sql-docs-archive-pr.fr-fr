---
title: Gestion des connexions et des travaux pour les bases de données d’un groupe de disponibilité (SQL Server) | Microsoft Docs
ms.custom: ''
ms.date: 06/13/2017
ms.prod: sql-server-2014
ms.reviewer: ''
ms.technology: high-availability
ms.topic: conceptual
helpviewer_keywords:
- Availability Groups [SQL Server], deploying
- Availability Groups [SQL Server], failover
- failover [SQL Server], AlwaysOn Availability Groups
ms.assetid: d7da14d3-848c-44d4-8e49-d536a1158a61
author: rothja
ms.author: jroth
ms.openlocfilehash: 457f3ef946b5cfaf86a4a19774af63c5d7635882
ms.sourcegitcommit: ad4d92dce894592a259721a1571b1d8736abacdb
ms.translationtype: MT
ms.contentlocale: fr-FR
ms.lasthandoff: 08/04/2020
ms.locfileid: "87614779"
---
# <a name="management-of-logins-and-jobs-for-the-databases-of-an-availability-group-sql-server"></a><span data-ttu-id="4fdf1-102">Gestion des connexions et des travaux pour les bases de données d'un groupe de disponibilité (SQL Server)</span><span class="sxs-lookup"><span data-stu-id="4fdf1-102">Management of Logins and Jobs for the Databases of an Availability Group (SQL Server)</span></span>
  <span data-ttu-id="4fdf1-103">Vous devez maintenir régulièrement le même ensemble de connexions utilisateur et de travaux de l'Agent [!INCLUDE[ssNoVersion](../includes/ssnoversion-md.md)] sur chaque base de données primaire d'un groupe de disponibilité AlwaysOn et les bases de données secondaires correspondantes.</span><span class="sxs-lookup"><span data-stu-id="4fdf1-103">You should routinely maintain the same set of user logins and [!INCLUDE[ssNoVersion](../includes/ssnoversion-md.md)] Agent jobs on every primary database of an AlwaysOn availability group and the corresponding secondary databases.</span></span> <span data-ttu-id="4fdf1-104">Les connexions et les travaux doivent être reproduits sur chaque instance de [!INCLUDE[ssNoVersion](../includes/ssnoversion-md.md)] qui héberge un réplica de disponibilité pour le groupe de disponibilité.</span><span class="sxs-lookup"><span data-stu-id="4fdf1-104">The logins and jobs must be reproduced on every instance of [!INCLUDE[ssNoVersion](../includes/ssnoversion-md.md)] that hosts an availability replica for the availability group.</span></span>  
  
-   <span data-ttu-id="4fdf1-105">**[!INCLUDE[ssNoVersion](../includes/ssnoversion-md.md)]Travaux de l’agent**</span><span class="sxs-lookup"><span data-stu-id="4fdf1-105">**[!INCLUDE[ssNoVersion](../includes/ssnoversion-md.md)] Agent jobs**</span></span>  
  
     <span data-ttu-id="4fdf1-106">Vous devez copier manuellement les travaux appropriés de l'instance de serveur qui héberge le réplica principal d'origine vers les instances de serveur qui hébergent les réplicas secondaires d'origine.</span><span class="sxs-lookup"><span data-stu-id="4fdf1-106">You need to manually copy relevant jobs from the server instance that hosts the original primary replica to the server instances that host the original secondary replicas.</span></span> <span data-ttu-id="4fdf1-107">Pour toutes les bases de données, vous devez ajouter la logique au début de chaque travail approprié de façon à ce que le travail s'exécute uniquement sur la base de données primaire, c.-à-d., uniquement lorsque le réplica local est le réplica principal pour la base de données.</span><span class="sxs-lookup"><span data-stu-id="4fdf1-107">For all databases, you need to add logic at the beginning of each relevant job to make the job execute only on the primary database, that is, only when the local replica is the primary replica for the database.</span></span>  
  
     <span data-ttu-id="4fdf1-108">Les instances de serveur qui hébergent les réplicas de disponibilité d'un groupe de disponibilité peuvent être configurées différemment, avec des lettres de lecteurs de bande ou de lecteur différentes.</span><span class="sxs-lookup"><span data-stu-id="4fdf1-108">The server instances that host the availability replicas of an availability group might be configured differently, with different tape drive letters or such.</span></span> <span data-ttu-id="4fdf1-109">Les travaux de chaque réplica de disponibilité doivent autoriser de telles différences.</span><span class="sxs-lookup"><span data-stu-id="4fdf1-109">The jobs for each availability replica must allow for any such differences.</span></span>  
  
     <span data-ttu-id="4fdf1-110">Notez que les travaux de sauvegarde peuvent utiliser la fonction [sys.fn_hadr_is_preferred_backup_replica](/sql/relational-databases/system-functions/sys-fn-hadr-backup-is-preferred-replica-transact-sql) pour déterminer si le réplica local est celui qui est utilisé par défaut pour les sauvegardes, selon les préférences de sauvegarde du groupe de disponibilité.</span><span class="sxs-lookup"><span data-stu-id="4fdf1-110">Notice that backup jobs can use the [sys.fn_hadr_is_preferred_backup_replica](/sql/relational-databases/system-functions/sys-fn-hadr-backup-is-preferred-replica-transact-sql) function to identify whether the local replica is the preferred one for backups, according to the availability group backup preferences.</span></span> <span data-ttu-id="4fdf1-111">Les travaux de sauvegarde créés à l'aide de l'[Assistant Plan de maintenance](../relational-databases/maintenance-plans/use-the-maintenance-plan-wizard.md) utilisent cette fonction en mode natif.</span><span class="sxs-lookup"><span data-stu-id="4fdf1-111">Backup jobs created using the [Maintenance Plan Wizard](../relational-databases/maintenance-plans/use-the-maintenance-plan-wizard.md) natively use this function.</span></span> <span data-ttu-id="4fdf1-112">Pour d'autres travaux de sauvegarde, nous vous recommandons d'utiliser cette fonction comme condition dans vos travaux de sauvegarde, de façon à ce qu'ils s'exécutent uniquement sur le réplica par défaut.</span><span class="sxs-lookup"><span data-stu-id="4fdf1-112">For other backup jobs, we recommend that you use this function as a condition in your backup jobs, so they execute only on the preferred replica.</span></span> <span data-ttu-id="4fdf1-113">Pour plus d’informations, consultez secondaires [actifs : sauvegarde sur les réplicas secondaires (groupes de disponibilité AlwaysOn)](availability-groups/windows/active-secondaries-backup-on-secondary-replicas-always-on-availability-groups.md).</span><span class="sxs-lookup"><span data-stu-id="4fdf1-113">For more information, see [Active Secondaries: Backup on Secondary Replicas (AlwaysOn Availability Groups)](availability-groups/windows/active-secondaries-backup-on-secondary-replicas-always-on-availability-groups.md).</span></span>  
  
-   <span data-ttu-id="4fdf1-114">**Connexions**</span><span class="sxs-lookup"><span data-stu-id="4fdf1-114">**Logins**</span></span>  
  
     <span data-ttu-id="4fdf1-115">Si vous utilisez des bases de données autonomes, vous pouvez configurer les utilisateurs contenus dans les bases de données, et pour ces utilisateurs, vous n'avez pas besoin de créer des connexions sur des instances de serveur qui hébergent un réplica secondaire.</span><span class="sxs-lookup"><span data-stu-id="4fdf1-115">If you are using contained databases, you can configure contained users in the databases, and for these users, you do not need to create logins on the server instances that host a secondary replica.</span></span> <span data-ttu-id="4fdf1-116">Pour une base de données de disponibilité sans relation contenant-contenu, vous devrez créer les utilisateurs pour les connexions sur les instances de serveur qui hébergent les réplicas de disponibilité.</span><span class="sxs-lookup"><span data-stu-id="4fdf1-116">For a non-contained availability database, you will need to create users for the logins on the server instances that host the availability replicas.</span></span> <span data-ttu-id="4fdf1-117">Pour plus d’informations, consultez [CREATE USER &#40;Transact-SQL&#41;](/sql/t-sql/statements/create-user-transact-sql).</span><span class="sxs-lookup"><span data-stu-id="4fdf1-117">For more information, see [CREATE USER &#40;Transact-SQL&#41;](/sql/t-sql/statements/create-user-transact-sql).</span></span>  
  
     <span data-ttu-id="4fdf1-118">Si l’une de vos applications utilise l’authentification [!INCLUDE[ssNoVersion](../includes/ssnoversion-md.md)] ou une connexion locale Windows, consultez [Connexions des applications qui utilisent l’authentification SQL Server ou une connexion locale Windows](../../2014/database-engine/logins-and-jobs-for-availability-group-databases.md#SSauthentication), plus loin dans cette rubrique.</span><span class="sxs-lookup"><span data-stu-id="4fdf1-118">If any of your applications use [!INCLUDE[ssNoVersion](../includes/ssnoversion-md.md)] Authentication or a local Windows login, see [Logins Of Applications That Use SQL Server Authentication or a Local Windows Login](../../2014/database-engine/logins-and-jobs-for-availability-group-databases.md#SSauthentication), later in this topic.</span></span>  
  
    > [!NOTE]  
    >  <span data-ttu-id="4fdf1-119">Un utilisateur de base de données pour lequel la connexion SQL Server n'est pas définie sur une instance de serveur, ou l'est de façon incorrecte, ne peut pas se connecter à cette instance.</span><span class="sxs-lookup"><span data-stu-id="4fdf1-119">A database user for which the SQL Server login is undefined or is incorrectly defined on a server instance cannot log in to the instance.</span></span> <span data-ttu-id="4fdf1-120">L'utilisateur devient donc un *utilisateur orphelin* de la base de données sur cette instance du serveur.</span><span class="sxs-lookup"><span data-stu-id="4fdf1-120">Such a user is said to be an *orphaned user* of the database on that server instance.</span></span> <span data-ttu-id="4fdf1-121">Si un utilisateur est orphelin sur une instance de serveur donnée, vous pouvez configurer les connexions utilisateur à tout moment.</span><span class="sxs-lookup"><span data-stu-id="4fdf1-121">If a user is orphaned on a given server instance, you can set up the user logins at any time.</span></span> <span data-ttu-id="4fdf1-122">Pour plus d’informations, consultez [Dépanner des utilisateurs orphelins &#40;SQL Server&#41;](../sql-server/failover-clusters/troubleshoot-orphaned-users-sql-server.md).</span><span class="sxs-lookup"><span data-stu-id="4fdf1-122">For more information, see [Troubleshoot Orphaned Users &#40;SQL Server&#41;](../sql-server/failover-clusters/troubleshoot-orphaned-users-sql-server.md).</span></span>  
  
-   <span data-ttu-id="4fdf1-123">**Métadonnées supplémentaires**</span><span class="sxs-lookup"><span data-stu-id="4fdf1-123">**Additional metadata**</span></span>  
  
     <span data-ttu-id="4fdf1-124">Les connexions et les travaux ne sont pas les seules informations qui doivent être recréées sur chaque instance de serveur qui héberge un réplica secondaire d'un groupe de disponibilité donné.</span><span class="sxs-lookup"><span data-stu-id="4fdf1-124">Logins and jobs are not the only information that need to be recreated on each of the server instances that hosts an secondary replica for a given availability group.</span></span> <span data-ttu-id="4fdf1-125">Par exemple, vous devrez peut-être recréer les paramètres de configuration du serveur, les informations d'identification, les données chiffrées, les autorisations, les paramètres de réplication, les applications de Service Broker, les déclencheurs (au niveau du serveur), etc.</span><span class="sxs-lookup"><span data-stu-id="4fdf1-125">For example, you might need to recreate server configuration settings, credentials, encrypted data, permissions, replication settings, service broker applications, triggers (at server level), and so forth.</span></span> <span data-ttu-id="4fdf1-126">Pour plus d’informations, consultez [Gérer les métadonnées durant la mise à disposition d’une base de données sur une autre instance de serveur &#40;SQL Server&#41;](../relational-databases/databases/manage-metadata-when-making-a-database-available-on-another-server.md).</span><span class="sxs-lookup"><span data-stu-id="4fdf1-126">For more information, see [Manage Metadata When Making a Database Available on Another Server Instance &#40;SQL Server&#41;](../relational-databases/databases/manage-metadata-when-making-a-database-available-on-another-server.md).</span></span>  
  
##  <a name="logins-of-applications-that-use-sql-server-authentication-or-a-local-windows-login"></a><a name="SSauthentication"></a> <span data-ttu-id="4fdf1-127">Connexions des applications qui utilisent l’authentification SQL Server ou une connexion locale Windows</span><span class="sxs-lookup"><span data-stu-id="4fdf1-127">Logins Of Applications That Use SQL Server Authentication or a Local Windows Login</span></span>  
 <span data-ttu-id="4fdf1-128">Si une application utilise l'authentification SQL Server ou une connexion locale Windows, des SID incompatibles peuvent empêcher la résolution de la connexion de l'application sur une instance distante de [!INCLUDE[ssNoVersion](../includes/ssnoversion-md.md)].</span><span class="sxs-lookup"><span data-stu-id="4fdf1-128">If an application uses SQL Server Authentication or a local Windows login, mismatched SIDs can prevent the application's login from resolving on a remote instance of [!INCLUDE[ssNoVersion](../includes/ssnoversion-md.md)].</span></span> <span data-ttu-id="4fdf1-129">En cas de SID incompatibles, la connexion peut se solder par un utilisateur orphelin sur l'instance de serveur distante.</span><span class="sxs-lookup"><span data-stu-id="4fdf1-129">The mismatched SIDs cause the login to become an orphaned user on the remote server instance.</span></span> <span data-ttu-id="4fdf1-130">Ce problème peut se produire lorsqu'une application se connecte à une base de données de copie des journaux de transaction ou une base de données mise en miroir suite à un basculement ou à une base de données d'abonné de réplication qui a été initialisée à partir d'une sauvegarde.</span><span class="sxs-lookup"><span data-stu-id="4fdf1-130">This issue can occur when an application connects to a mirrored or log shipping database after a failover or to a replication subscriber database that was initialized from a backup.</span></span>  
  
 <span data-ttu-id="4fdf1-131">Pour éviter ce problème, nous vous recommandons de prendre des mesures préventives lorsque vous configurez une telle application de manière à utiliser une base de données hébergée par une instance distante de [!INCLUDE[ssNoVersion](../includes/ssnoversion-md.md)].</span><span class="sxs-lookup"><span data-stu-id="4fdf1-131">To prevent this issue, we recommend that you take preventative measures when you set up such an application to use a database that is hosted by a remote instance of [!INCLUDE[ssNoVersion](../includes/ssnoversion-md.md)].</span></span> <span data-ttu-id="4fdf1-132">La prévention implique de transférer des connexions et des mots de passe de l'instance locale de [!INCLUDE[ssNoVersion](../includes/ssnoversion-md.md)] à l'instance distante de [!INCLUDE[ssNoVersion](../includes/ssnoversion-md.md)].</span><span class="sxs-lookup"><span data-stu-id="4fdf1-132">Prevention involves transferring the logins and the passwords from the local instance of [!INCLUDE[ssNoVersion](../includes/ssnoversion-md.md)] to the remote instance of [!INCLUDE[ssNoVersion](../includes/ssnoversion-md.md)].</span></span> <span data-ttu-id="4fdf1-133">Pour savoir comment éviter ce problème, consultez l’article 918992 de la Base de connaissances Microsoft : [Comment transférer les connexions et les mots de passe entre des instances de SQL Server](https://support.microsoft.com/kb/918992/)).</span><span class="sxs-lookup"><span data-stu-id="4fdf1-133">For more information about how to prevent this issue, see KB article 918992-[How to transfer the logins and the passwords between instances of SQL Server](https://support.microsoft.com/kb/918992/)).</span></span>  
  
> [!NOTE]  
>  <span data-ttu-id="4fdf1-134">Ce problème affecte les comptes Windows locaux sur différents ordinateurs.</span><span class="sxs-lookup"><span data-stu-id="4fdf1-134">This problem affects Windows local accounts on different computers.</span></span> <span data-ttu-id="4fdf1-135">Toutefois, ce problème ne se pose pas pour les comptes de domaine car le SID est identique sur chacun des ordinateurs.</span><span class="sxs-lookup"><span data-stu-id="4fdf1-135">However, this problem does not occur for domain accounts because the SID is the same on each of the computers.</span></span>  
  
 <span data-ttu-id="4fdf1-136">Pour plus d’informations, consultez [Orphaned Users with Database Mirroring and Log Shipping (Utilisateurs orphelins avec mise en miroir de bases de données et copie des journaux de transaction)](https://blogs.msdn.com/b/sqlserverfaq/archive/2009/04/13/orphaned-users-with-database-mirroring-and-log-shipping.aspx) (blog du moteur de base de données).</span><span class="sxs-lookup"><span data-stu-id="4fdf1-136">For more information, see [Orphaned Users with Database Mirroring and Log Shipping](https://blogs.msdn.com/b/sqlserverfaq/archive/2009/04/13/orphaned-users-with-database-mirroring-and-log-shipping.aspx) (a Database Engine blog).</span></span>  
  
##  <a name="related-tasks"></a><a name="RelatedTasks"></a> <span data-ttu-id="4fdf1-137">Tâches associées</span><span class="sxs-lookup"><span data-stu-id="4fdf1-137">Related Tasks</span></span>  
  
-   [<span data-ttu-id="4fdf1-138">Créer un compte de connexion</span><span class="sxs-lookup"><span data-stu-id="4fdf1-138">Create a Login</span></span>](../relational-databases/security/authentication-access/create-a-login.md)  
  
-   <span data-ttu-id="4fdf1-139">[Créer un utilisateur de base de données](../relational-databases/security/authentication-access/create-a-database-user.md).</span><span class="sxs-lookup"><span data-stu-id="4fdf1-139">[Create a Database User](../relational-databases/security/authentication-access/create-a-database-user.md).</span></span>  
  
-   [<span data-ttu-id="4fdf1-140">Créer un travail</span><span class="sxs-lookup"><span data-stu-id="4fdf1-140">Create a Job</span></span>](../ssms/agent/create-a-job.md)  
  
-   [<span data-ttu-id="4fdf1-141">Gérer les métadonnées durant la mise à disposition d’une base de données sur une autre instance de serveur &#40;SQL Server&#41;</span><span class="sxs-lookup"><span data-stu-id="4fdf1-141">Manage Metadata When Making a Database Available on Another Server Instance &#40;SQL Server&#41;</span></span>](../relational-databases/databases/manage-metadata-when-making-a-database-available-on-another-server.md)  
  
## <a name="see-also"></a><span data-ttu-id="4fdf1-142">Voir aussi</span><span class="sxs-lookup"><span data-stu-id="4fdf1-142">See Also</span></span>  
 <span data-ttu-id="4fdf1-143">[Vue d’ensemble de groupes de disponibilité AlwaysOn &#40;SQL Server&#41;](availability-groups/windows/overview-of-always-on-availability-groups-sql-server.md) </span><span class="sxs-lookup"><span data-stu-id="4fdf1-143">[Overview of AlwaysOn Availability Groups &#40;SQL Server&#41;](availability-groups/windows/overview-of-always-on-availability-groups-sql-server.md) </span></span>  
 <span data-ttu-id="4fdf1-144">[Bases de données autonomes](../relational-databases/databases/contained-databases.md) </span><span class="sxs-lookup"><span data-stu-id="4fdf1-144">[Contained Databases](../relational-databases/databases/contained-databases.md) </span></span>  
 [<span data-ttu-id="4fdf1-145">Créer des travaux</span><span class="sxs-lookup"><span data-stu-id="4fdf1-145">Create Jobs</span></span>](../ssms/agent/create-jobs.md)  
  
  
