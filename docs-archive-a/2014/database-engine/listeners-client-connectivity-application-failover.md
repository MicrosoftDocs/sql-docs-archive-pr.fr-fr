---
title: Écouteurs de groupe de disponibilité, connectivité client et basculement d’application (SQL Server) | Microsoft Docs
ms.custom: ''
ms.date: 06/13/2017
ms.prod: sql-server-2014
ms.reviewer: ''
ms.technology: high-availability
ms.topic: conceptual
helpviewer_keywords:
- Availability Groups [SQL Server], listeners
- read-only routing
- read-intent connections [AlwaysOn Availability Groups]
- Availability Groups [SQL Server], configuring
- Availability Groups [SQL Server], read-only routing
- Availability Groups [SQL Server], client connectivity
ms.assetid: 76fb3eca-6b08-4610-8d79-64019dd56c44
author: rothja
ms.author: jroth
ms.openlocfilehash: f66046625ca0078904e9555d1cf586873b9f697f
ms.sourcegitcommit: ad4d92dce894592a259721a1571b1d8736abacdb
ms.translationtype: MT
ms.contentlocale: fr-FR
ms.lasthandoff: 08/04/2020
ms.locfileid: "87698501"
---
# <a name="availability-group-listeners-client-connectivity-and-application-failover-sql-server"></a><span data-ttu-id="15570-102">Écouteurs de groupe de disponibilité, connectivité client et basculement d’application (SQL Server)</span><span class="sxs-lookup"><span data-stu-id="15570-102">Availability Group Listeners, Client Connectivity, and Application Failover (SQL Server)</span></span>
  <span data-ttu-id="15570-103">Cette rubrique contient des informations sur les éléments à prendre en compte en matière de connectivité client [!INCLUDE[ssHADR](../includes/sshadr-md.md)] et de fonctionnalité de basculement d'application.</span><span class="sxs-lookup"><span data-stu-id="15570-103">This topic contains information about considerations for [!INCLUDE[ssHADR](../includes/sshadr-md.md)] client connectivity and application-failover functionality.</span></span>  
  
> [!NOTE]  
>  <span data-ttu-id="15570-104">Pour la majorité des configurations habituelles d'écouteur, vous pouvez créer le premier écouteur de groupe de disponibilité simplement à l'aide d'instructions [!INCLUDE[tsql](../includes/tsql-md.md)] ou d'applets de commande PowerShell.</span><span class="sxs-lookup"><span data-stu-id="15570-104">For the majority of the common listener configurations, you can create the first availability group listener simply by using [!INCLUDE[tsql](../includes/tsql-md.md)] statements or PowerShell cmdlets.</span></span> <span data-ttu-id="15570-105">Pour plus d'informations, consultez [Tâches associées](#RelatedTasks), plus loin dans cette rubrique.</span><span class="sxs-lookup"><span data-stu-id="15570-105">For more information, see [Related Tasks](#RelatedTasks), later in this topic.</span></span>  
  
 
  
##  <a name="availability-group-listeners"></a><a name="AGlisteners"></a> <span data-ttu-id="15570-106">Écouteurs de groupe de disponibilité</span><span class="sxs-lookup"><span data-stu-id="15570-106">Availability Group Listeners</span></span>  
 <span data-ttu-id="15570-107">Vous pouvez fournir la connectivité client à la base de données d'un groupe de disponibilité donné en créant un écouteur de groupe de disponibilité.</span><span class="sxs-lookup"><span data-stu-id="15570-107">You can provide client connectivity to the database of a given availability group by creating an availability group listener.</span></span> <span data-ttu-id="15570-108">Un écouteur de groupe de disponibilité est un nom de réseau virtuel (VNN) auquel les clients peuvent se connecter afin d'accéder à une base de données dans un réplica principal ou secondaire d'un groupe de disponibilité AlwaysOn.</span><span class="sxs-lookup"><span data-stu-id="15570-108">An availability group listener is a virtual network name (VNN) to which clients can connect in order to access a database in a primary or secondary replica of an AlwaysOn availability group.</span></span> <span data-ttu-id="15570-109">Un écouteur de groupe de disponibilité permet à un client de se connecter à un réplica de disponibilité sans connaître le nom de l'instance physique de SQL Server à laquelle il se connecte.</span><span class="sxs-lookup"><span data-stu-id="15570-109">An availability group listener enables a client to connect to an availability replica without knowing the name of the physical instance of SQL Server to which the client is connecting.</span></span>  <span data-ttu-id="15570-110">Il est inutile de modifier la chaîne de connexion du client pour se connecter à l'emplacement actuel du réplica principal.</span><span class="sxs-lookup"><span data-stu-id="15570-110">The client connection string does not need to be modified to connect to the current location of the current primary replica.</span></span>  
  
 <span data-ttu-id="15570-111">Un écouteur de groupe de disponibilité consiste en un nom d'écouteur DNS (Domain Name System), en une désignation de port d'écoute et en une ou plusieurs adresses IP.</span><span class="sxs-lookup"><span data-stu-id="15570-111">An availability group listener consists of a Domain Name System (DNS) listener name, listener port designation, and one or more IP addresses.</span></span> <span data-ttu-id="15570-112">Seul le protocole TCP est pris en charge par l'écouteur de groupe de disponibilité.</span><span class="sxs-lookup"><span data-stu-id="15570-112">Only the TCP protocol is supported by availability group listener.</span></span>  <span data-ttu-id="15570-113">Le nom DNS de l'écouteur doit également être unique dans le domaine et dans NetBIOS.</span><span class="sxs-lookup"><span data-stu-id="15570-113">The DNS name of the listener must also be unique in the domain and in NetBIOS.</span></span>  <span data-ttu-id="15570-114">Lorsque vous créez un nouvel écouteur de groupe de disponibilité, il devient une ressource de cluster avec un nom de réseau virtuel (VNN) associé, une adresse IP virtuelle (VIP) et une dépendance de groupe de disponibilité.</span><span class="sxs-lookup"><span data-stu-id="15570-114">When you create a new availability group listener it becomes a resource in a cluster with an associated virtual network name (VNN), virtual IP (VIP), and availability group dependency.</span></span> <span data-ttu-id="15570-115">Un client utilise le nom DNS pour résoudre le nom VNN en plusieurs adresses IP et tente ensuite de se connecter à chaque adresse, jusqu'à ce qu'une demande de connexion réussisse ou jusqu'à ce que la requête de connexion expire.</span><span class="sxs-lookup"><span data-stu-id="15570-115">A client uses DNS to resolve the VNN into multiple IP addresses and then tries to connect to each address, until a connection request succeeds or until the connection requests time out.</span></span>  
  
 <span data-ttu-id="15570-116">Si le routage en lecture seule est configuré pour un ou plusieurs[réplicas secondaires accessibles en lecture](availability-groups/windows/active-secondaries-readable-secondary-replicas-always-on-availability-groups.md), les connexions clientes d’intention de lecture du réplica principal sont redirigées vers un réplica secondaire accessible en lecture.</span><span class="sxs-lookup"><span data-stu-id="15570-116">If read-only routing is configured for one or more[readable secondary replicas](availability-groups/windows/active-secondaries-readable-secondary-replicas-always-on-availability-groups.md), read-intent client connections to the primary replica are redirected to a readable secondary replica.</span></span> <span data-ttu-id="15570-117">Par ailleurs, si le réplica principal est mis hors connexion sur une instance de SQL Server et un nouveau réplica principal passe en ligne sur une autre instance de SQL Server, l'écouteur de groupe de disponibilité permet aux clients de se connecter au nouveau réplica principal.</span><span class="sxs-lookup"><span data-stu-id="15570-117">Also, if the primary replica goes offline on one instance of SQL Server, and a new primary replica comes online on another instance of SQL Server, the availability group listener enables clients to connect to the new primary replica.</span></span>  
  
 <span data-ttu-id="15570-118">Pour obtenir des informations essentielles sur les écouteurs de groupe de disponibilité, consultez [Créer ou configurer un écouteur de groupe de disponibilité &#40;SQL Server&#41;](availability-groups/windows/create-or-configure-an-availability-group-listener-sql-server.md).</span><span class="sxs-lookup"><span data-stu-id="15570-118">For essential information about availability group listeners, see [Create or Configure an Availability Group Listener &#40;SQL Server&#41;](availability-groups/windows/create-or-configure-an-availability-group-listener-sql-server.md).</span></span>  
  
 
  
###  <a name="availability-group-listener-configuration"></a><a name="AGlConfig"></a> <span data-ttu-id="15570-119">Configuration de l'écouteur de groupe de disponibilité</span><span class="sxs-lookup"><span data-stu-id="15570-119">Availability Group Listener Configuration</span></span>  
 <span data-ttu-id="15570-120">Un écouteur de groupe de disponibilité est défini par les élément suivants :</span><span class="sxs-lookup"><span data-stu-id="15570-120">An availability group listener is defined by the following:</span></span>  
  
 <span data-ttu-id="15570-121">Un nom DNS unique.</span><span class="sxs-lookup"><span data-stu-id="15570-121">A unique DNS name</span></span>  
 <span data-ttu-id="15570-122">Ce nom est aussi appelé un nom de réseau virtuel (VNN).</span><span class="sxs-lookup"><span data-stu-id="15570-122">This is also known as a Virtual Network Name (VNN).</span></span> <span data-ttu-id="15570-123">Les règles d'attribution de noms Active Directory pour les noms d'hôte DNS s'appliquent.</span><span class="sxs-lookup"><span data-stu-id="15570-123">Active Directory naming rules for DNS host names apply.</span></span> <span data-ttu-id="15570-124">Pour plus d'informations, consultez l'article [Conventions d'affectation de noms dans Active Directory pour les ordinateurs, les domaines, les sites et les unités d'organisation](https://support.microsoft.com/kb/909264) de la Base de connaissances.</span><span class="sxs-lookup"><span data-stu-id="15570-124">For more information, see the [Naming conventions in Active Directory for computers, domains, sites, and OUs](https://support.microsoft.com/kb/909264) KB article.</span></span>  
  
 <span data-ttu-id="15570-125">Une ou plusieurs adresses IP virtuelles (VIP)</span><span class="sxs-lookup"><span data-stu-id="15570-125">One or more Virtual IP addresses (VIPs)</span></span>  
 <span data-ttu-id="15570-126">Les adresses IP virtuelles sont configurées pour un ou plusieurs sous-réseaux vers lesquels le groupe de disponibilité peut basculer.</span><span class="sxs-lookup"><span data-stu-id="15570-126">VIPs are configured for one or more subnets to which the availability group can failover.</span></span>  
  
 <span data-ttu-id="15570-127">Configuration de l'adresse IP</span><span class="sxs-lookup"><span data-stu-id="15570-127">IP address configuration</span></span>  
 <span data-ttu-id="15570-128">Pour un écouteur de groupe de disponibilité donné, l'adresse IP utilise le protocole DHCP (Dynamic Host Configuration Protocol) ou une ou plusieurs adresses IP statiques.</span><span class="sxs-lookup"><span data-stu-id="15570-128">For a given availability group listener, the IP address uses either Dynamic Host Configuration Protocol (DHCP) or one or more static IP addresses.</span></span>  
  
-   <span data-ttu-id="15570-129">Protocole DHCP (Dynamic Host Configuration Protocol)</span><span class="sxs-lookup"><span data-stu-id="15570-129">Dynamic Host Configuration Protocol (DHCP)</span></span>  
  
     <span data-ttu-id="15570-130">Vous pouvez configurer toutes les adresses IP d'écouteur de groupe de disponibilité en vue d'utiliser le protocole DHCP (Dynamic Host Configuration Protocol) si un groupe de disponibilité réside sur un même sous-réseau.</span><span class="sxs-lookup"><span data-stu-id="15570-130">If an availability group resides on a single subnet, you can configure all the availability group listener IP addresses to use DHCP.</span></span> <span data-ttu-id="15570-131">Pour les environnements de préproduction, le protocole DHCP permet une installation facile pour un groupe de disponibilité qui n'a pas besoin de la fonctionnalité de récupération d'urgence vers un site distant sur un sous-réseau distinct.</span><span class="sxs-lookup"><span data-stu-id="15570-131">For pre-production environments, DHCP offers an easy setup for an availability group that does not require disaster recovery to a remote site on a separate subnet.</span></span> <span data-ttu-id="15570-132">Toutefois, nous déconseillons d'utiliser DHCP en même temps qu'un écouteur de groupe de disponibilité dans un environnement de production.</span><span class="sxs-lookup"><span data-stu-id="15570-132">However, you should not use DHCP in conjunction with an availability group listener in a production environment.</span></span> <span data-ttu-id="15570-133">En effet, en cas d'arrêt du système, si le bail IP DHCP expire, il faudra consacrer du temps supplémentaire pour réinscrire la nouvelle adresse IP DHCP associée au nom DNS de l'écouteur.</span><span class="sxs-lookup"><span data-stu-id="15570-133">This is because, in the event of down time, if the DHCP IP lease expires, extra time is required to re-register the new DHCP IP address associated with the listener DNS name.</span></span> <span data-ttu-id="15570-134">Ce temps supplémentaire va provoquer l'échec de la connexion cliente.</span><span class="sxs-lookup"><span data-stu-id="15570-134">The extra time will cause client-connection failure.</span></span>  
  
-   <span data-ttu-id="15570-135">Adresses IP statiques</span><span class="sxs-lookup"><span data-stu-id="15570-135">Static IP addresses</span></span>  
  
     <span data-ttu-id="15570-136">Dans les environnements de production, nous conseillons que les écouteurs de groupe de disponibilité utilisent des adresses IP statiques.</span><span class="sxs-lookup"><span data-stu-id="15570-136">In production environments, we recommend that availability group listeners use static IP addresses.</span></span> <span data-ttu-id="15570-137">De plus, dans le cas où vos groupes de disponibilité s'étendent sur plusieurs sous-réseaux dans un domaine de plusieurs sous-réseaux, un écouteur de groupe de disponibilité doit utiliser des adresses IP statiques.</span><span class="sxs-lookup"><span data-stu-id="15570-137">Furthermore, where availability groups extend across subnets in a multi-subnet domain, an availability group listener must use static IP addresses.</span></span>  
  
 <span data-ttu-id="15570-138">Les configurations réseau hybrides et le recours au protocole DHCP sur plusieurs sous-réseaux ne sont pas pris en charge pour les écouteurs de groupe de disponibilité.</span><span class="sxs-lookup"><span data-stu-id="15570-138">Hybrid network configurations and DHCP across subnets are not supported for availability group listeners.</span></span> <span data-ttu-id="15570-139">Cela est dû au fait que, lorsqu'un basculement a lieu, une adresse IP dynamique peut expirer ou être libérée, ce qui compromet la haute disponibilité globale.</span><span class="sxs-lookup"><span data-stu-id="15570-139">This is because when a failover happens, a dynamic IP might expire or be released, which jeopardizes overall high availability.</span></span>  
  
###  <a name="selecting-an-availability-group-listener-port"></a><a name="SelectListenerPort"></a> <span data-ttu-id="15570-140">Sélection d'un port d'écoute de groupe de disponibilité</span><span class="sxs-lookup"><span data-stu-id="15570-140">Selecting an Availability Group Listener Port</span></span>  
 <span data-ttu-id="15570-141">Lors de la configuration d'un écouteur de groupe de disponibilité, vous devez indiquer un port.</span><span class="sxs-lookup"><span data-stu-id="15570-141">When configuring an availability group listener, you must designate a port.</span></span>  <span data-ttu-id="15570-142">Vous pouvez configurer le port par défaut sur 1433, afin de permettre de simplifier les chaînes de connexion du client.</span><span class="sxs-lookup"><span data-stu-id="15570-142">You can configure the default port to 1433 in order to allow for simplicity of the client connection strings.</span></span> <span data-ttu-id="15570-143">Si vous utilisez 1433, vous n'avez pas besoin d'indiquer un numéro de port dans une chaîne de connexion.</span><span class="sxs-lookup"><span data-stu-id="15570-143">If using 1433, you do not need to designate a port number in a connection string.</span></span>   <span data-ttu-id="15570-144">De plus, étant donné que chaque écouteur de groupe de disponibilité portera un nom de réseau virtuel distinct, chaque écouteur de groupe de disponibilité configuré sur un même WSFC pourra être configuré pour référencer le même port par défaut 1433.</span><span class="sxs-lookup"><span data-stu-id="15570-144">Also, since each availability group listener will have a separate virtual network name, each availability group listener configured on a single WSFC can be configured to reference the same default port of 1433.</span></span>  
  
 <span data-ttu-id="15570-145">Vous pouvez également indiquer un port d'écoute non standard ; toutefois, cela signifie que vous devrez également spécifier explicitement un port cible dans votre chaîne de connexion lors de chaque connexion à l'écouteur de groupe de disponibilité.</span><span class="sxs-lookup"><span data-stu-id="15570-145">You can also designate a non-standard listener port; however this means that you will also need to explicitly specify a target port in your connection string whenever connecting to the availability group listener.</span></span>  <span data-ttu-id="15570-146">Vous devrez également ouvrir l'autorisation sur le pare-feu pour le port non standard.</span><span class="sxs-lookup"><span data-stu-id="15570-146">You will also need to open permission on the firewall for the non-standard port.</span></span>  
  
 <span data-ttu-id="15570-147">Si vous utilisez le port par défaut 1433 comme nom VNN de l'écouteur du groupe de disponibilité, vous devez toujours vérifier qu'aucun autre service sur le nœud de cluster n'utilise ce port ; dans le cas contraire, cela provoquerait un conflit de ports.</span><span class="sxs-lookup"><span data-stu-id="15570-147">If you use the default port of 1433 for availability group listener VNNs, you will still need to ensure that no other services on the cluster node are using this port; otherwise this would cause a port conflict.</span></span>  
  
 <span data-ttu-id="15570-148">Si l'une des instances de SQL Server écoute déjà sur le port TCP 1433 par l'intermédiaire de l'écouteur d'instance et qu'il n'existe aucun autre service (instances supplémentaires de SQL Server comprises) sur l'ordinateur écoutant sur le port 1433, cela ne provoque pas un conflit de ports avec l'écouteur du groupe de disponibilité.</span><span class="sxs-lookup"><span data-stu-id="15570-148">If one of the instances of SQL Server is already listening on TCP port 1433 via the instance listener and there are no other services (including additional instances of SQL Server) on the computer listening on port 1433, this will not cause a port conflict with the availability group listener.</span></span>  <span data-ttu-id="15570-149">Cela est dû au fait que l'écouteur du groupe de disponibilité peut partager le même port TCP au sein du même processus de service.</span><span class="sxs-lookup"><span data-stu-id="15570-149">This is because the availability group listener can share the same TCP port inside the same service process.</span></span>  <span data-ttu-id="15570-150">Toutefois, plusieurs instances de SQL Server (côte à côte) ne doivent pas être configurées pour écouter sur le même port.</span><span class="sxs-lookup"><span data-stu-id="15570-150">However multiple instances of SQL Server (side-by-side)should not be configured to listen on the same port.</span></span>  
  
##  <a name="using-a-listener-to-connect-to-the-primary-replica"></a><a name="ConnectToPrimary"></a><span data-ttu-id="15570-151">Utilisation d’un écouteur pour se connecter au réplica principal</span><span class="sxs-lookup"><span data-stu-id="15570-151">Using a Listener to Connect to the Primary Replica</span></span>  
 <span data-ttu-id="15570-152">Pour utiliser un écouteur de groupe de disponibilité pour la connexion au réplica principal en vue de l'accès en lecture-écriture, la chaîne de connexion spécifie le nom DNS de l'écouteur de groupe de disponibilité.</span><span class="sxs-lookup"><span data-stu-id="15570-152">To use an availability group listener to connect to the primary replica for read-write access, the connection string specifies the availability group listener DNS name.</span></span>  <span data-ttu-id="15570-153">Si un réplica principal de groupe de disponibilité se transforme en nouveau réplica, les connexions existantes qui utilisent le nom réseau d'un écouteur de groupe de disponibilité sont déconnectées.</span><span class="sxs-lookup"><span data-stu-id="15570-153">If an availability group primary replica changes to a new replica, existing connections that use an availability group listener's network name are disconnected.</span></span>  <span data-ttu-id="15570-154">Les nouvelles connexions à l'écouteur du groupe de disponibilité sont ensuite dirigées vers le nouveau réplica principal.</span><span class="sxs-lookup"><span data-stu-id="15570-154">New connections to the availability group listener are then directed to the new primary replica.</span></span> <span data-ttu-id="15570-155">Voici un exemple de chaîne de connexion de base pour le fournisseur ADO.NET (System.Data.SqlClient) :</span><span class="sxs-lookup"><span data-stu-id="15570-155">An example of a basic connection string for the ADO.NET provider (System.Data.SqlClient) is as follows:</span></span>  
  
```  
Server=tcp: AGListener,1433;Database=MyDB;IntegratedSecurity=SSPI  
```  
  
 <span data-ttu-id="15570-156">Vous pouvez néanmoins choisir de référencer directement l'instance du nom SQL Server des réplicas principaux ou secondaires au lieu d'utiliser le nom du serveur de l'écouteur du groupe de disponibilité ; toutefois, si vous choisissez d'agir ainsi, les nouvelles connexions ne seront plus dirigées automatiquement vers le réplica principal actuel.</span><span class="sxs-lookup"><span data-stu-id="15570-156">You can still choose to directly reference the instance of SQL Server name of the primary or secondary replicas instead of using the availability group listener server name, however if you choose to do so you will lose the benefit of new connections being directed automatically to the current primary replica.</span></span>  <span data-ttu-id="15570-157">Vous perdrez également l'avantage du routage en lecture seule.</span><span class="sxs-lookup"><span data-stu-id="15570-157">You will also lose the benefit of read-only routing.</span></span>  
  
##  <a name="using-a-listener-to-connect-to-a-read-only-secondary-replica-read-only-routing"></a><a name="ConnectToSecondary"></a> <span data-ttu-id="15570-158">Utilisation d'un écouteur pour se connecter à un réplica secondaire en lecture seule (routage en lecture seule)</span><span class="sxs-lookup"><span data-stu-id="15570-158">Using a Listener to Connect to a Read-Only Secondary Replica (Read-Only Routing)</span></span>  
 <span data-ttu-id="15570-159">Le*routage en lecture seule* fait référence à la capacité de [!INCLUDE[ssNoVersion](../includes/ssnoversion-md.md)] d’acheminer les connexions entrantes à un écouteur de groupe de disponibilité vers un réplica secondaire qui est configuré pour autoriser des charges de travail en lecture seule.</span><span class="sxs-lookup"><span data-stu-id="15570-159">*Read-only routing* refers to the ability of [!INCLUDE[ssNoVersion](../includes/ssnoversion-md.md)] to route incoming connections to an availability group listener to a secondary replica that is configured to allow read-only workloads.</span></span> <span data-ttu-id="15570-160">Une connexion entrante faisant référence à un nom d'écouteur de groupe de disponibilité peut automatiquement être acheminée vers un réplica en lecture seule si les conditions suivantes sont réunies :</span><span class="sxs-lookup"><span data-stu-id="15570-160">An incoming connection referencing an availability group listener name can automatically be routed to a read-only replica if the following are true:</span></span>  
  
-   <span data-ttu-id="15570-161">Au moins un réplica secondaire est défini sur l'accès en lecture seule, et chaque réplica secondaire en lecture seule et le réplica principal sont configurés pour prendre en charge le routage en lecture seule.</span><span class="sxs-lookup"><span data-stu-id="15570-161">At least one secondary replica is set to read-only access, and each read-only secondary replica and the primary replica are configured to support read-only routing.</span></span> <span data-ttu-id="15570-162">Pour plus d’informations, consultez [Pour configurer des réplicas de disponibilité pour le routage en lecture seule](#ConfigureARsForROR), plus loin dans cette section.</span><span class="sxs-lookup"><span data-stu-id="15570-162">For more information, see [To Configure Availability Replicas for Read-Only Routing](#ConfigureARsForROR), later in this section.</span></span>  
  
-   <span data-ttu-id="15570-163">La chaîne de connexion fait référence à un écouteur de groupe de disponibilité, et l’intention de l’application de la connexion entrante est définie en lecture seule (par exemple, à l’aide du mot clé **Application Intent=ReadOnly** dans les chaînes de connexion ODBC ou OLEDB, ou dans les attributs ou les propriétés de connexion).</span><span class="sxs-lookup"><span data-stu-id="15570-163">The connection string references an availability group listener, and the application intent of the incoming connection is set to read-only (for example, by using the **Application Intent=ReadOnly** keyword in the ODBC or OLEDB connection strings or connection attributes or properties).</span></span> <span data-ttu-id="15570-164">Pour plus d’informations, consultez [Intention de l’application en lecture seule et routage en lecture seule](#ReadOnlyAppIntent), plus loin dans cette section.</span><span class="sxs-lookup"><span data-stu-id="15570-164">For more information, see [Read-Only Application Intent and Read-Only Routing](#ReadOnlyAppIntent), later in this section.</span></span>  
  
###  <a name="to-configure-availability-replicas-for-read-only-routing"></a><a name="ConfigureARsForROR"></a> <span data-ttu-id="15570-165">Pour configurer des réplicas de disponibilité pour le routage en lecture seule</span><span class="sxs-lookup"><span data-stu-id="15570-165">To Configure Availability Replicas for Read-Only Routing</span></span>  
 <span data-ttu-id="15570-166">Un administrateur de base de données doit configurer les réplicas de disponibilité comme suit :</span><span class="sxs-lookup"><span data-stu-id="15570-166">A database administrator must configure the availability replicas as follows:</span></span>  
  
1.  <span data-ttu-id="15570-167">Pour chaque réplica de disponibilité à configurer comme réplica secondaire accessible en lecture, un administrateur de base de données doit configurer les paramètres suivants, qui prennent effet uniquement sous le rôle secondaire :</span><span class="sxs-lookup"><span data-stu-id="15570-167">For each availability replica that you want to configure as a readable secondary replica, a database administrator must configure the following settings, which take effect only under the secondary role:</span></span>  
  
    -   <span data-ttu-id="15570-168">L'accès à la connexion doit avoir la valeur « tous » ou « lecture seule ».</span><span class="sxs-lookup"><span data-stu-id="15570-168">Connection access must be set to "all" or "read only".</span></span>  
  
    -   <span data-ttu-id="15570-169">L'URL de routage en lecture seule doit être spécifiée.</span><span class="sxs-lookup"><span data-stu-id="15570-169">The read-only routing URL must be specified.</span></span>  
  
2.  <span data-ttu-id="15570-170">Pour chacun de ces réplicas, une liste de routage en lecture seule doit être spécifiée pour le rôle principal.</span><span class="sxs-lookup"><span data-stu-id="15570-170">For each of these replicas, a read-only routing list must be specified for the primary role.</span></span> <span data-ttu-id="15570-171">Spécifiez un ou plusieurs noms de serveur comme cibles de routage.</span><span class="sxs-lookup"><span data-stu-id="15570-171">Specify one or more server names as routing targets.</span></span>  
  
####  <a name="related-tasks"></a><a name="RelatedTasksROR"></a> <span data-ttu-id="15570-172">Tâches associées</span><span class="sxs-lookup"><span data-stu-id="15570-172">Related Tasks</span></span>  
  
-   [<span data-ttu-id="15570-173">Configurer l’accès en lecture seule sur un réplica de disponibilité &#40;SQL Server&#41;</span><span class="sxs-lookup"><span data-stu-id="15570-173">Configure Read-Only Access on an Availability Replica &#40;SQL Server&#41;</span></span>](availability-groups/windows/configure-read-only-access-on-an-availability-replica-sql-server.md)  
  
-   [<span data-ttu-id="15570-174">Configurer le routage en lecture seule pour un groupe de disponibilité &#40;SQL Server&#41;</span><span class="sxs-lookup"><span data-stu-id="15570-174">Configure Read-Only Routing for an Availability Group &#40;SQL Server&#41;</span></span>](availability-groups/windows/configure-read-only-routing-for-an-availability-group-sql-server.md)  
  
###  <a name="read-only-application-intent-and-read-only-routing"></a><a name="ReadOnlyAppIntent"></a><span data-ttu-id="15570-175">Intention d’application en lecture seule et routage en lecture seule</span><span class="sxs-lookup"><span data-stu-id="15570-175">Read-Only Application Intent and Read-Only Routing</span></span>  
 <span data-ttu-id="15570-176">La propriété de chaîne de connexion de l’intention d’application exprime le souhait de l’application cliente d’être redirigée vers une version en lecture-écriture ou en lecture seule d’une base de données de groupe de disponibilité.</span><span class="sxs-lookup"><span data-stu-id="15570-176">The application intent connection string property expresses the client application's request to be directed either to a read-write or read-only version of an availability group database.</span></span> <span data-ttu-id="15570-177">Pour utiliser le routage en lecture seule, un client doit utiliser une intention d'application en lecture seule dans la chaîne de connexion pour la connexion à l'écouteur de groupe de disponibilité.</span><span class="sxs-lookup"><span data-stu-id="15570-177">To use read-only routing, a client must use an application intent of read-only in the connection string when connecting to the availability group listener.</span></span> <span data-ttu-id="15570-178">Sans intention d'application en lecture seule, les connexions à l'écouteur de groupe de disponibilité sont dirigées vers la base de données sur le réplica principal.</span><span class="sxs-lookup"><span data-stu-id="15570-178">Without the read-only application intent, connections to the availability group listener are directed to the database on the primary replica.</span></span>  
  
 <span data-ttu-id="15570-179">L’attribut d’intention d’application est stocké dans la session du client lors de la connexion. L’instance de SQL Server traite ensuite cette intention et détermine ce qu’il faut faire, selon la configuration du groupe de disponibilité et l’état en lecture-écriture actuel de la base de données cible dans le réplica secondaire.</span><span class="sxs-lookup"><span data-stu-id="15570-179">The application intent attribute is stored in the client's session during login and the instance of SQL Server will then process this intent and determine what to do according to the configuration of the availability group and the current read-write state of the target database in the secondary replica.</span></span>  
  
 <span data-ttu-id="15570-180">Voici un exemple de chaîne de connexion pour le fournisseur ADO.NET (System.Data.SqlClient) qui indique l'intention d'application en lecture seule :</span><span class="sxs-lookup"><span data-stu-id="15570-180">An example of a connection string for the ADO.NET provider (System.Data.SqlClient) that designates read-only application intent is as follows:</span></span>  
  
```  
Server=tcp:AGListener,1433;Database=AdventureWorks;IntegratedSecurity=SSPI;ApplicationIntent=ReadOnly  
```  
  
 <span data-ttu-id="15570-181">Dans cet exemple de chaîne de connexion, le client tente de se connecter à un écouteur de groupe de disponibilité nommé `AGListener` sur le port 1433 (vous pouvez aussi omettre le port si l'écouteur du groupe de disponibilité écoute sur le port 1433).</span><span class="sxs-lookup"><span data-stu-id="15570-181">In this connection string example, the client is attempting to connect to an availability group listener named `AGListener` on port 1433 (you may also omit the port if the availability group listener is listening on 1433).</span></span>  <span data-ttu-id="15570-182">La propriété de la chaîne de connexion a la `ApplicationIntent` valeur `ReadOnly` , ce qui en fait une *chaîne de connexion d’intention de lecture*.</span><span class="sxs-lookup"><span data-stu-id="15570-182">The connection string has the `ApplicationIntent` property set to `ReadOnly`, making this a *read-intent connection string*.</span></span>  <span data-ttu-id="15570-183">Sans ce paramètre, le serveur n'aurait pas essayé un routage en lecture seule de la connexion.</span><span class="sxs-lookup"><span data-stu-id="15570-183">Without this setting, the server would not have attempted a read-only routing of the connection.</span></span>  
  
 <span data-ttu-id="15570-184">La base de données primaire du groupe de disponibilité traite la demande de routage en lecture seule entrante et tente de localiser un réplica en ligne et en lecture seule joint au réplica principal et configuré pour le routage en lecture seule.</span><span class="sxs-lookup"><span data-stu-id="15570-184">The primary database of the availability group processes the incoming read-only routing request and attempts to locate an online, read-only replica that is joined to the primary replica and is configured for read-only routing.</span></span>  <span data-ttu-id="15570-185">Le client reçoit les informations de connexion depuis le serveur de réplica principal et se connecte au réplica en lecture seule identifié.</span><span class="sxs-lookup"><span data-stu-id="15570-185">The client receives back connection information from the primary replica server and connects to the identified read-only replica.</span></span>  
  
 <span data-ttu-id="15570-186">Notez que l'intention de l'application peut être envoyée depuis un pilote client vers une instance de bas niveau de SQL Server.</span><span class="sxs-lookup"><span data-stu-id="15570-186">Note that the application intent can be sent from a client driver to a down-level instance of SQL Server.</span></span>  <span data-ttu-id="15570-187">Dans ce cas, l'intention de l'application en lecture seule est ignorée et la connexion se déroule normalement.</span><span class="sxs-lookup"><span data-stu-id="15570-187">In this case, application intent of read-only is ignored and the connection proceeds as normal.</span></span>  
  
 <span data-ttu-id="15570-188">Vous pouvez contourner le routage en lecture seule en ne définissant pas la propriété de connexion d'intention d'application avec la valeur `ReadOnly` (en l'absence de spécification, la valeur par défaut est `ReadWrite` pendant la connexion) ou en effectuant une connexion directe à l'instance du réplica principal de SQL Server au lieu d'utiliser le nom de l'écouteur du groupe de disponibilité.</span><span class="sxs-lookup"><span data-stu-id="15570-188">You can bypass read-only routing by not setting the application intent connection property to `ReadOnly` (when not designated, the default is `ReadWrite` during login) or by connecting directly to the primary replica instance of SQL Server instead of using the availability group listener name.</span></span>  <span data-ttu-id="15570-189">Le routage en lecture seule n'a pas lieu non plus si vous vous connectez directement à un réplica en lecture seule.</span><span class="sxs-lookup"><span data-stu-id="15570-189">Read-only routing will also not occur if you connect directly to a read-only replica.</span></span>  
  
####  <a name="related-tasks"></a><a name="RelatedTasksApps"></a> <span data-ttu-id="15570-190">Tâches associées</span><span class="sxs-lookup"><span data-stu-id="15570-190">Related Tasks</span></span>  
  
-   [<span data-ttu-id="15570-191">Prise en charge des fonctionnalités de récupération d'urgence, haute disponibilité par SQL Server Native Client</span><span class="sxs-lookup"><span data-stu-id="15570-191">SQL Server Native Client Support for High Availability, Disaster Recovery</span></span>](../relational-databases/native-client/features/sql-server-native-client-support-for-high-availability-disaster-recovery.md)  
  
-   [<span data-ttu-id="15570-192">Utilisation de mots clés de chaîne de connexion avec SQL Server Native Client</span><span class="sxs-lookup"><span data-stu-id="15570-192">Using Connection String Keywords with SQL Server Native Client</span></span>](../relational-databases/native-client/applications/using-connection-string-keywords-with-sql-server-native-client.md)  
  
##  <a name="bypassing-availability-group-listeners"></a><a name="BypassAGl"></a><span data-ttu-id="15570-193">Contournement des écouteurs de groupe de disponibilité</span><span class="sxs-lookup"><span data-stu-id="15570-193">Bypassing Availability Group Listeners</span></span>  
 <span data-ttu-id="15570-194">Alors que les écouteurs de groupe de disponibilité permettent la prise en charge de la redirection de basculement et le routage en lecture seule, les connexions clientes ne sont pas requises pour les utiliser.</span><span class="sxs-lookup"><span data-stu-id="15570-194">While availability group listeners enable support for failover redirection and read-only routing, client connections are not required to use them.</span></span> <span data-ttu-id="15570-195">Une connexion cliente peut également faire directement référence à l'instance de SQL Server au lieu de se connecter à l'écouteur du groupe de disponibilité.</span><span class="sxs-lookup"><span data-stu-id="15570-195">A client connection can also directly reference the instance of SQL Server instead of connecting to the availability group listener.</span></span>  
  
 <span data-ttu-id="15570-196">Pour l'instance de SQL Server, cela ne fait aucune différence si une connexion est établie à l'aide de l'écouteur du groupe de disponibilité ou avec un autre point de terminaison d'instance.</span><span class="sxs-lookup"><span data-stu-id="15570-196">To the instance of SQL Server it is irrelevant whether a connection logs in using the availability group listener or using another instance endpoint.</span></span>  <span data-ttu-id="15570-197">L'instance de SQL Server vérifie l'état de la base de données ciblée, puis autorise ou interdit la connectivité, selon la configuration du groupe de disponibilité et l'état actuel de la base de données sur l'instance.</span><span class="sxs-lookup"><span data-stu-id="15570-197">The instance of SQL Server will verify the state of the targeted database and either allow or disallow connectivity based on the configuration of the availability group and the current state of the database on the instance.</span></span>  <span data-ttu-id="15570-198">Par exemple, si une application cliente se connecte directement à une instance de port SQL Server et se connecte à une base de données cible hébergée dans un groupe de disponibilité, et que la base de données cible se trouve dans l'état primaire et en ligne, la connectivité aboutit.</span><span class="sxs-lookup"><span data-stu-id="15570-198">For example, if a client application connects directly to a instance of SQL Server port and connects to a target database hosted in an availability group, and the target database is in primary state and online, then connectivity will succeed.</span></span>  <span data-ttu-id="15570-199">Si la base de données cible est hors connexion ou dans un état de transition, la connectivité à la base de données échoue.</span><span class="sxs-lookup"><span data-stu-id="15570-199">If the target database is offline or in a transitional state, connectivity to the database will fail.</span></span>  
  
 <span data-ttu-id="15570-200">Autrement, lors d'une migration depuis une mise en miroir de bases de données vers [!INCLUDE[ssHADR](../includes/sshadr-md.md)], les applications peuvent spécifier la chaîne de connexion de mise en miroir de bases de données dans la mesure où il existe un seul réplica secondaire et qu'il n'autorise pas les connexions utilisateur.</span><span class="sxs-lookup"><span data-stu-id="15570-200">Alternatively, while migrating from database mirroring to [!INCLUDE[ssHADR](../includes/sshadr-md.md)], applications can specify the database mirroring connection string as long as only one secondary replica exists and it disallows user connections.</span></span> <span data-ttu-id="15570-201">Pour plus d’informations, consultez [Utilisation des chaînes de connexion de mise en miroir de bases de données avec des groupes de disponibilité](#DbmConnectionString), plus loin dans cette section.</span><span class="sxs-lookup"><span data-stu-id="15570-201">For more information, see [Using Database-Mirroring Connection Strings with Availability Groups](#DbmConnectionString), later in this section.</span></span>  
  
###  <a name="using-database-mirroring-connection-strings-with-availability-groups"></a><a name="DbmConnectionString"></a><span data-ttu-id="15570-202">Utilisation de chaînes de connexion de mise en miroir de bases de données avec des groupes de disponibilité</span><span class="sxs-lookup"><span data-stu-id="15570-202">Using Database-Mirroring Connection Strings with Availability Groups</span></span>  
 <span data-ttu-id="15570-203">Si un groupe de disponibilité possède uniquement un réplica secondaire et n'est pas configuré pour autoriser l'accès en lecture au réplica secondaire, les clients peuvent se connecter au réplica principal à l'aide d'une chaîne de connexion de mise en miroir de bases de données.</span><span class="sxs-lookup"><span data-stu-id="15570-203">If an availability group possesses only one secondary replica and is not configured to allow read-access to the secondary replica, clients can connect to the primary replica by using a database mirroring connection string.</span></span> <span data-ttu-id="15570-204">Cette approche peut être utile lors de la migration d'une application existante depuis la mise en miroir de bases de données vers un groupe de disponibilité, tant que vous limitez le groupe de disponibilité à deux réplicas de disponibilité (un réplica principal et un réplica secondaire).</span><span class="sxs-lookup"><span data-stu-id="15570-204">This approach can be useful while migrating an existing application from database mirroring to an availability group, as long as you limit the availability group to two availability replicas (a primary replica and one secondary replica).</span></span> <span data-ttu-id="15570-205">Si vous ajoutez des réplicas secondaires supplémentaires, vous devrez créer un écouteur de groupe de disponibilité pour le groupe de disponibilité et mettre à jour vos applications pour utiliser le nom DNS de l'écouteur du groupe de disponibilité.</span><span class="sxs-lookup"><span data-stu-id="15570-205">If you add additional secondary replicas, you will need to create an availability group listener for the availability group and update your applications to use the availability group listener DNS name.</span></span>  
  
 <span data-ttu-id="15570-206">Lors de l'utilisation de chaînes de connexion de mise en miroir de bases de données, le client peut soit utiliser [!INCLUDE[ssNoVersion](../includes/ssnoversion-md.md)] Native Client, soit le fournisseur de données .NET Framework pour [!INCLUDE[ssNoVersion](../includes/ssnoversion-md.md)].</span><span class="sxs-lookup"><span data-stu-id="15570-206">When using database mirroring connection strings, the client can use either [!INCLUDE[ssNoVersion](../includes/ssnoversion-md.md)] Native Client or .NET Framework Data Provider for [!INCLUDE[ssNoVersion](../includes/ssnoversion-md.md)].</span></span> <span data-ttu-id="15570-207">La chaîne de connexion fournie par un client doit fournir au minimum le nom d'une instance de serveur, le *nom du partenaire initial*, pour identifier l'instance de serveur qui héberge initialement le réplica de disponibilité auquel vous envisagez de vous connecter.</span><span class="sxs-lookup"><span data-stu-id="15570-207">The connection string provided by a client must minimally supply the name of one server instance, the *initial partner name*, to identify the server instance that initially hosts the availability replica to which you intend to connect.</span></span> <span data-ttu-id="15570-208">Éventuellement, la chaîne de connexion peut également fournir le nom d'une autre instance de serveur, le *nom du partenaire de basculement*, pour identifier l'instance de serveur qui héberge initialement le réplica secondaire comme nom de partenaire de basculement.</span><span class="sxs-lookup"><span data-stu-id="15570-208">Optionally, the connection string can also supply the name of another server instance, the *failover partner name*, to identify the server instance that initially hosts the secondary replica as the failover partner name.</span></span>  
  
 <span data-ttu-id="15570-209">Pour plus d’informations sur les chaînes de connexion de mise en miroir de base de données, consultez [Connecter des clients à une session de mise en miroir de bases de données &#40;SQL Server&#41;](database-mirroring/connect-clients-to-a-database-mirroring-session-sql-server.md).</span><span class="sxs-lookup"><span data-stu-id="15570-209">For more information about database mirroring connection strings, see [Connect Clients to a Database Mirroring Session &#40;SQL Server&#41;](database-mirroring/connect-clients-to-a-database-mirroring-session-sql-server.md).</span></span>  
  
##  <a name="behavior-of-client-connections-on-failover"></a><a name="CCBehaviorOnFailover"></a><span data-ttu-id="15570-210">Comportement des connexions clientes lors du basculement</span><span class="sxs-lookup"><span data-stu-id="15570-210">Behavior of Client Connections on Failover</span></span>  
 <span data-ttu-id="15570-211">Lorsqu'un basculement de groupe de disponibilité se produit, les connexions persistantes existantes au groupe de disponibilité prennent fin et le client doit établir une nouvelle connexion afin de continuer à utiliser la même base de données primaire ou base de données secondaire en lecture seule.</span><span class="sxs-lookup"><span data-stu-id="15570-211">When an availability group failover occurs, existing persistent connections to the availability group are terminated and the client must establish a new connection in order to continue working with the same primary database or read-only secondary database.</span></span>  <span data-ttu-id="15570-212">Lorsqu'un basculement se produit côté serveur, la connectivité au groupe de disponibilité peut échouer, forçant l'application cliente à réessayer une nouvelle connexion jusqu'à ce que le serveur principal soit entièrement remis en ligne.</span><span class="sxs-lookup"><span data-stu-id="15570-212">While a failover is occurring on the server side, connectivity to the availability group may fail, forcing the client application to retry connecting until the primary is brought fully back online.</span></span>  
  
 <span data-ttu-id="15570-213">Si le groupe de disponibilité revient en ligne pendant une tentative de connexion d’une application cliente, mais avant l’expiration du délai d’attente de connexion, le pilote client peut se connecter au cours de l’une de ses tentatives de reprise interne, auquel cas, aucune erreur n’est visible dans l’application.</span><span class="sxs-lookup"><span data-stu-id="15570-213">If the availability group comes back online during a client application's connection attempt but before the connect timeout period, the client driver may successfully connect during one of its internal retry attempts and no error will be surfaced to the application in this case.</span></span>  
  
##  <a name="supporting-availability-group-multi-subnet-failovers"></a><a name="SupportAgMultiSubnetFailover"></a> <span data-ttu-id="15570-214">Prise en charge de basculements de sous-réseaux multiples de groupe de disponibilité</span><span class="sxs-lookup"><span data-stu-id="15570-214">Supporting Availability Group Multi-Subnet Failovers</span></span>  
 <span data-ttu-id="15570-215">Si vous utilisez des bibliothèques clientes qui prennent en charge l’option de connexion MultiSubnetFailover dans la chaîne de connexion, vous pouvez optimiser le basculement du groupe de disponibilité vers un sous-réseau différent en définissant MultiSubnetFailover sur « True » ou « Yes », selon la syntaxe du fournisseur que vous utilisez.</span><span class="sxs-lookup"><span data-stu-id="15570-215">If you are using client libraries that support the MultiSubnetFailover connection option in the connection string, you can optimize availability group failover to a different subnet by setting MultiSubnetFailover to "True" or "Yes", depending on the syntax of the provider you are using.</span></span>  
  
> [!NOTE]  
>  <span data-ttu-id="15570-216">Nous vous recommandons de définir ce paramètre à la fois pour les connexions à un seul ou à plusieurs sous-réseaux aux écouteurs de groupes de disponibilité et aux noms d'instance de cluster de basculement SQL Server.</span><span class="sxs-lookup"><span data-stu-id="15570-216">We recommend this setting for both single and multi-subnet connections to availability groups listeners and to SQL Server Failover Cluster Instance names.</span></span>  <span data-ttu-id="15570-217">L'activation de cette option ajoute des optimisations supplémentaires, même pour les scénarios de sous-réseau unique.</span><span class="sxs-lookup"><span data-stu-id="15570-217">Enabling this option adds additional optimizations, even for single-subnet scenarios.</span></span>  
  
 <span data-ttu-id="15570-218">L'option de connexion `MultiSubnetFailover` fonctionne uniquement avec le protocole réseau TCP et elle est prise en charge uniquement lors de la connexion à un écouteur de groupe de disponibilité et pour n'importe quel nom de réseau virtuel se connectant à [!INCLUDE[ssCurrent](../includes/sscurrent-md.md)].</span><span class="sxs-lookup"><span data-stu-id="15570-218">The `MultiSubnetFailover` connection option only works with the TCP network protocol and is only supported when connecting to an availability group listener and for any virtual network name connecting to [!INCLUDE[ssCurrent](../includes/sscurrent-md.md)].</span></span>  
  
 <span data-ttu-id="15570-219">Voici un exemple de chaîne de connexion du fournisseur ADO.NET (System.Data.SqlClient) qui permet le basculement de plusieurs sous-réseaux :</span><span class="sxs-lookup"><span data-stu-id="15570-219">An example of a for the ADO.NET provider (System.Data.SqlClient) connection string that enables multi-subnet failover is as follows:</span></span>  
  
```  
Server=tcp:AGListener,1433;Database=AdventureWorks;IntegratedSecurity=SSPI; MultiSubnetFailover=True  
```  
  
 <span data-ttu-id="15570-220">L'option de connexion `MultiSubnetFailover` doit être définie avec la valeur `True` même si le groupe de disponibilité s'étend sur un seul sous-réseau.</span><span class="sxs-lookup"><span data-stu-id="15570-220">The `MultiSubnetFailover` connection option should be set to `True` even if the availability group only spans a single subnet.</span></span>  <span data-ttu-id="15570-221">Cela vous permet de préconfigurer de nouveaux clients afin de prendre en charge la future couverture de sous-réseaux, sans recourir à de futures modifications de la chaîne de connexion du client. Par ailleurs, cela permet d'optimiser les performances de basculement pour les basculements au sein d'un seul sous-réseau.</span><span class="sxs-lookup"><span data-stu-id="15570-221">This allows you to preconfigure new clients to support future spanning of subnets without any need for future client connection string changes and also optimizes failover performance for single subnet failovers.</span></span>  <span data-ttu-id="15570-222">Lorsque l'option de connexion `MultiSubnetFailover` n'est pas obligatoire, elle offre l'avantage d'un basculement de sous-réseau plus rapide.</span><span class="sxs-lookup"><span data-stu-id="15570-222">While the `MultiSubnetFailover` connection option is not required, it does provide the benefit of a faster subnet failover.</span></span>  <span data-ttu-id="15570-223">Cela est dû au fait que le pilote client essaie d'ouvrir un socket TCP pour chaque adresse IP en parallèle associée au groupe de disponibilité.</span><span class="sxs-lookup"><span data-stu-id="15570-223">This is because the client driver will attempt to open up a TCP socket for each IP address in parallel associated with the availability group.</span></span>  <span data-ttu-id="15570-224">Le pilote client attend une réponse correcte de la première adresse IP et, ceci fait, l'utilise pour la connexion.</span><span class="sxs-lookup"><span data-stu-id="15570-224">The client driver will wait for the first IP to respond with success and once it does, will then use it for the connection.</span></span>  
  
##  <a name="availability-group-listeners-and-ssl-certificates"></a><a name="SSLcertificates"></a> <span data-ttu-id="15570-225">Écouteurs de groupe de disponibilité et certificats SSL</span><span class="sxs-lookup"><span data-stu-id="15570-225">Availability Group Listeners and SSL Certificates</span></span>  
 <span data-ttu-id="15570-226">Lors de la connexion à un écouteur de groupe de disponibilité, si les instances participantes de SQL Server utilisent des certificats SSL en même temps que le chiffrement de session, le pilote client de la connexion doit prendre en charge le nom SAN (Subject Alternate Name) dans le certificat SSL afin de forcer le chiffrement.</span><span class="sxs-lookup"><span data-stu-id="15570-226">When connecting to an availability group listener, if the participating instances of SQL Server use SSL certificates in conjunction with session encryption, the connecting client driver will need to support the Subject Alternate Name in the SSL certificate in order to force encryption.</span></span>  <span data-ttu-id="15570-227">La prise en charge de pilotes SQL Server pour le nom SAN de certificat est planifiée pour ADO.NET (SqlClient), Microsoft JDBC et SQL Native Client (SNAC).</span><span class="sxs-lookup"><span data-stu-id="15570-227">SQL Server driver support for certificate Subject Alternative Name is planned for ADO.NET (SqlClient), Microsoft JDBC and SQL Native Client (SNAC).</span></span>  
  
 <span data-ttu-id="15570-228">Un certificat X.509 doit être configuré pour chaque nœud serveur participant dans le cluster de basculement, avec une liste de tous les écouteurs de groupe de disponibilité définis dans le nom SAN du certificat.</span><span class="sxs-lookup"><span data-stu-id="15570-228">A X.509 certificate must be configured for each participating server node in the failover cluster with a list of all availability group listeners set in the Subject Alternate Name of the certificate.</span></span>  
  
 <span data-ttu-id="15570-229">Par exemple, si le WSFC dispose de trois écouteurs de groupe de disponibilité avec les noms `AG1_listener.Adventure-Works.com`, `AG2_listener.Adventure-Works.com`et `AG3_listener.Adventure-Works.com`, le nom SAN du certificat doit être défini comme suit :</span><span class="sxs-lookup"><span data-stu-id="15570-229">For example, if the WSFC has three availability group listeners with the names `AG1_listener.Adventure-Works.com`, `AG2_listener.Adventure-Works.com`, and `AG3_listener.Adventure-Works.com`, the Subject Alternative Name for the certificate should be set as follows:</span></span>  
  
```  
CN = ServerFQDN  
SAN = ServerFQDN,AG1_listener.Adventure-Works.com, AG2_listener.Adventure-Works.com, AG3_listener.Adventure-Works.com  
```  
  
##  <a name="availability-group-listeners-and-server-principal-names-spns"></a><a name="SPNs"></a><span data-ttu-id="15570-230">Écouteurs de groupe de disponibilité et noms de principal de serveur (SPN)</span><span class="sxs-lookup"><span data-stu-id="15570-230">Availability Group Listeners and Server Principal Names (SPNs)</span></span>  
 <span data-ttu-id="15570-231">Un nom de principal de serveur (SPN) doit être configuré dans Active Directory par un administrateur de domaine pour chaque nom d'écouteur de groupe de disponibilité afin d'activer Kerberos pour la connexion cliente à l'écouteur du groupe de disponibilité.</span><span class="sxs-lookup"><span data-stu-id="15570-231">A Server Principal Name (SPN) must be configured in Active Directory by a domain administrator for each availability group listener name in order to enable Kerberos for the client connection to the availability group listener.</span></span> <span data-ttu-id="15570-232">Lors de l’inscription du nom SPN, vous devez utiliser le compte de service de l’instance de serveur qui héberge le réplica de disponibilité.</span><span class="sxs-lookup"><span data-stu-id="15570-232">When registering the SPN, you must use the service account of the server instance that hosts the availability replica .</span></span>  <span data-ttu-id="15570-233">Pour que le SPN fonctionne sur tous les réplicas, le même compte de service doit être utilisé pour toutes les instances du cluster WSFC qui héberge le groupe de disponibilité.</span><span class="sxs-lookup"><span data-stu-id="15570-233">For the SPN to work across all replicas, the same service account must be used for all instances in the WSFC cluster that hosts the availability group.</span></span>  
  
 <span data-ttu-id="15570-234">Utilisez l'outil de ligne de commande `setspn` de Windows pour configurer le SPN.</span><span class="sxs-lookup"><span data-stu-id="15570-234">Use the `setspn` Windows command line tool to configure the SPN.</span></span>  <span data-ttu-id="15570-235">Par exemple, pour configurer un SPN pour un groupe de disponibilité nommé `AG1listener.Adventure-Works.com` hébergé dans un ensemble d'instances de SQL Server, toutes configurées pour s'exécuter sous le compte de domaine `corp/svclogin2`:</span><span class="sxs-lookup"><span data-stu-id="15570-235">For example to configure an SPN for an availability group named `AG1listener.Adventure-Works.com` hosted on a set of instances of SQL Server all configured to run under the domain account `corp/svclogin2`:</span></span>  
  
```cmd
setspn -A MSSQLSvc/AG1listener.Adventure-Works.com:1433 corp/svclogin2  
```  
  
 <span data-ttu-id="15570-236">Pour plus d'informations sur l'inscription manuelle d'un SPN pour SQL Server, consultez [Inscrire un nom de principal du service pour les connexions Kerberos](configure-windows/register-a-service-principal-name-for-kerberos-connections.md).</span><span class="sxs-lookup"><span data-stu-id="15570-236">For more information about manual registration of a SPN for SQL Server, see [Register a Service Principal Name for Kerberos Connections](configure-windows/register-a-service-principal-name-for-kerberos-connections.md).</span></span>  
  
##  <a name="related-tasks"></a><a name="RelatedTasks"></a> <span data-ttu-id="15570-237">Tâches associées</span><span class="sxs-lookup"><span data-stu-id="15570-237">Related Tasks</span></span>  
  
-   [<span data-ttu-id="15570-238">Connectivité client AlwaysOn &#40;SQL Server&#41;</span><span class="sxs-lookup"><span data-stu-id="15570-238">AlwaysOn Client Connectivity &#40;SQL Server&#41;</span></span>](availability-groups/windows/always-on-client-connectivity-sql-server.md)
  
-   [<span data-ttu-id="15570-239">Créer ou configurer un écouteur de groupe de disponibilité &#40;SQL Server&#41;</span><span class="sxs-lookup"><span data-stu-id="15570-239">Create or Configure an Availability Group Listener &#40;SQL Server&#41;</span></span>](availability-groups/windows/create-or-configure-an-availability-group-listener-sql-server.md)  
  
-   [<span data-ttu-id="15570-240">Afficher les propriétés d’écouteur de groupe de disponibilité &#40;SQL Server&#41;</span><span class="sxs-lookup"><span data-stu-id="15570-240">View Availability Group Listener Properties &#40;SQL Server&#41;</span></span>](availability-groups/windows/view-availability-group-listener-properties-sql-server.md)  
  
-   [<span data-ttu-id="15570-241">Supprimer un écouteur de groupe de disponibilité &#40;SQL Server&#41;</span><span class="sxs-lookup"><span data-stu-id="15570-241">Remove an Availability Group Listener &#40;SQL Server&#41;</span></span>](availability-groups/windows/remove-an-availability-group-listener-sql-server.md)  
  
-   [<span data-ttu-id="15570-242">Configurer l’accès en lecture seule sur un réplica de disponibilité &#40;SQL Server&#41;</span><span class="sxs-lookup"><span data-stu-id="15570-242">Configure Read-Only Access on an Availability Replica &#40;SQL Server&#41;</span></span>](availability-groups/windows/configure-read-only-access-on-an-availability-replica-sql-server.md)  
  
-   [<span data-ttu-id="15570-243">Configurer le routage en lecture seule pour un groupe de disponibilité &#40;SQL Server&#41;</span><span class="sxs-lookup"><span data-stu-id="15570-243">Configure Read-Only Routing for an Availability Group &#40;SQL Server&#41;</span></span>](availability-groups/windows/configure-read-only-routing-for-an-availability-group-sql-server.md)  
  
##  <a name="related-content"></a><a name="RelatedContent"></a> <span data-ttu-id="15570-244">Contenu associé</span><span class="sxs-lookup"><span data-stu-id="15570-244">Related Content</span></span>  
  
-   [<span data-ttu-id="15570-245">Guide de solutions Microsoft SQL Server AlwaysOn pour la haute disponibilité et la récupération d'urgence</span><span class="sxs-lookup"><span data-stu-id="15570-245">Microsoft SQL Server AlwaysOn Solutions Guide for High Availability and Disaster Recovery</span></span>](https://go.microsoft.com/fwlink/?LinkId=227600)  
  
-   <span data-ttu-id="15570-246">[Présentation de l'écouteur du groupe de disponibilité](https://blogs.msdn.com/b/sqlalwayson/archive/2012/01/16/introduction-to-the-availability-group-listener.aspx) (blog de l'équipe SQL Server AlwaysOn)</span><span class="sxs-lookup"><span data-stu-id="15570-246">[Introduction to the Availability Group Listener](https://blogs.msdn.com/b/sqlalwayson/archive/2012/01/16/introduction-to-the-availability-group-listener.aspx) (a SQL Server AlwaysOn team blog)</span></span>  
  
-   [<span data-ttu-id="15570-247">Blog de l'équipe de SQL Server AlwaysOn : Blog officiel de l'équipe de SQL Server AlwaysOn</span><span class="sxs-lookup"><span data-stu-id="15570-247">SQL Server AlwaysOn Team Blog: The official SQL Server AlwaysOn Team Blog</span></span>](https://blogs.msdn.com/b/sqlalwayson/)  
  
## <a name="see-also"></a><span data-ttu-id="15570-248">Voir aussi</span><span class="sxs-lookup"><span data-stu-id="15570-248">See Also</span></span>  
 <span data-ttu-id="15570-249">[Vue d’ensemble de groupes de disponibilité AlwaysOn &#40;SQL Server&#41;](availability-groups/windows/overview-of-always-on-availability-groups-sql-server.md) </span><span class="sxs-lookup"><span data-stu-id="15570-249">[Overview of AlwaysOn Availability Groups &#40;SQL Server&#41;](availability-groups/windows/overview-of-always-on-availability-groups-sql-server.md) </span></span>  
 [<span data-ttu-id="15570-250">Connectivité client AlwaysOn &#40;SQL Server&#41;</span><span class="sxs-lookup"><span data-stu-id="15570-250">AlwaysOn Client Connectivity &#40;SQL Server&#41;</span></span>](availability-groups/windows/always-on-client-connectivity-sql-server.md)  
 <span data-ttu-id="15570-251">[À propos de l’accès de la connexion client aux réplicas de disponibilité &#40;SQL Server&#41;](availability-groups/windows/about-client-connection-access-to-availability-replicas-sql-server.md) </span><span class="sxs-lookup"><span data-stu-id="15570-251">[About Client Connection Access to Availability Replicas &#40;SQL Server&#41;](availability-groups/windows/about-client-connection-access-to-availability-replicas-sql-server.md) </span></span>  
 <span data-ttu-id="15570-252">[Secondaires actifs : réplicas secondaires accessibles en lecture &#40;groupes de disponibilité AlwaysOn&#41;](availability-groups/windows/active-secondaries-readable-secondary-replicas-always-on-availability-groups.md) </span><span class="sxs-lookup"><span data-stu-id="15570-252">[Active Secondaries: Readable Secondary Replicas &#40;AlwaysOn Availability Groups&#41;](availability-groups/windows/active-secondaries-readable-secondary-replicas-always-on-availability-groups.md) </span></span>  
 [<span data-ttu-id="15570-253">Connecter des clients à une session de mise en miroir de bases de données &#40;SQL Server&#41;</span><span class="sxs-lookup"><span data-stu-id="15570-253">Connect Clients to a Database Mirroring Session &#40;SQL Server&#41;</span></span>](database-mirroring/connect-clients-to-a-database-mirroring-session-sql-server.md)
