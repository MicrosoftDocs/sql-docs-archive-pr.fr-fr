---
title: Défaillances possibles pendant les sessions entre les réplicas de disponibilité (SQL Server) | Microsoft Docs
ms.custom: ''
ms.date: 06/13/2017
ms.prod: sql-server-2014
ms.reviewer: ''
ms.technology: high-availability
ms.topic: conceptual
helpviewer_keywords:
- troubleshooting [SQL Server, HADR]
- Availability Groups [SQL Server], availability replicas
- Availability Groups [SQL Server], troubleshooting
ms.assetid: cd613898-82d9-482f-a255-0230a6c7d6fe
author: MashaMSFT
ms.author: mathoma
ms.openlocfilehash: 4cfacb7f7c75875d4f5d0b0b435d282b3f537cc7
ms.sourcegitcommit: ad4d92dce894592a259721a1571b1d8736abacdb
ms.translationtype: MT
ms.contentlocale: fr-FR
ms.lasthandoff: 08/04/2020
ms.locfileid: "87703295"
---
# <a name="possible-failures-during-sessions-between-availability-replicas-sql-server"></a><span data-ttu-id="34c45-102">Défaillances possibles pendant les sessions entre les réplicas de disponibilité (SQL Server)</span><span class="sxs-lookup"><span data-stu-id="34c45-102">Possible Failures During Sessions Between Availability Replicas (SQL Server)</span></span>
  <span data-ttu-id="34c45-103">Des problèmes physiques, de système d'exploitation ou [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] peuvent provoquer un échec dans une session entre deux réplicas de disponibilité.</span><span class="sxs-lookup"><span data-stu-id="34c45-103">Physical, operating system, or [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] problems can cause a failure in a session between two availability replicas.</span></span> <span data-ttu-id="34c45-104">Un réplica de disponibilité ne contrôle pas régulièrement les composants sur lesquels Sqlservr.exe s'appuie pour vérifier s'ils fonctionnent correctement ou s'ils ont échoué.</span><span class="sxs-lookup"><span data-stu-id="34c45-104">An availability replica does not regularly check the components on which Sqlservr.exe relies to verify whether they are functioning correctly or have failed.</span></span> <span data-ttu-id="34c45-105">Toutefois, pour certains types d'échecs, le composant affecté signale une erreur à Sqlservr.exe.</span><span class="sxs-lookup"><span data-stu-id="34c45-105">However, for some types of failures, the affected component reports an error to Sqlservr.exe.</span></span> <span data-ttu-id="34c45-106">Une erreur signalée par un autre composant est appelée *erreur matérielle*.</span><span class="sxs-lookup"><span data-stu-id="34c45-106">An error reported by another component is called a *hard error*.</span></span> <span data-ttu-id="34c45-107">Pour détecter les autres erreurs qui passeraient sinon inaperçues, [!INCLUDE[ssHADR](../../../includes/sshadr-md.md)] implémente son propre mécanisme de délai d'expiration de session.</span><span class="sxs-lookup"><span data-stu-id="34c45-107">To detect other failures that would otherwise go unnoticed, [!INCLUDE[ssHADR](../../../includes/sshadr-md.md)] implements its own session-timeout mechanism.</span></span> <span data-ttu-id="34c45-108">Spécifie le délai d'expiration de la session en secondes.</span><span class="sxs-lookup"><span data-stu-id="34c45-108">Specifies the session-timeout period in seconds.</span></span> <span data-ttu-id="34c45-109">Ce délai d'attente est la durée maximale pendant laquelle une instance de serveur attend de recevoir un message PING d'une autre instance avant de considérer que cette dernière est déconnectée.</span><span class="sxs-lookup"><span data-stu-id="34c45-109">This time-out period is the maximum time that a server instance waits to receive a PING message from another instance before considering that other instance to be disconnected.</span></span> <span data-ttu-id="34c45-110">Quand un délai d’expiration de session se produit entre deux réplicas de disponibilité, les réplicas de disponibilité partent du principe qu’une erreur s’est produite et déclarent une *erreur logicielle*.</span><span class="sxs-lookup"><span data-stu-id="34c45-110">When a session timeout occurs between two availability replicas, the availability replicas assume that a failure has occurred and declares a *soft error*.</span></span>  
  
> [!IMPORTANT]  
>  <span data-ttu-id="34c45-111">Les défaillances dans les bases de données autres que la base de données primaire ne sont pas détectables.</span><span class="sxs-lookup"><span data-stu-id="34c45-111">Failures in databases other than the primary database are not detectable.</span></span> <span data-ttu-id="34c45-112">En outre, il est peu vraisemblable qu'une défaillance du disque de données soit détectée, sauf si la base de données est redémarrée en raison de la défaillance d'un disque de données.</span><span class="sxs-lookup"><span data-stu-id="34c45-112">Moreover, a data disk failure is unlikely to be detected unless the database is restarted because of a data disk failure.</span></span>  
  
 <span data-ttu-id="34c45-113">Le temps de détection de l'erreur et, par extension, le temps de réaction face à une erreur, varient selon que l'erreur est matérielle ou logicielle.</span><span class="sxs-lookup"><span data-stu-id="34c45-113">The speed of error detection and, therefore, the reaction time to a failure, depends on whether the error is hard or soft.</span></span> <span data-ttu-id="34c45-114">Certaines erreurs matérielles, telles que les pannes de réseau sont signalées immédiatement.</span><span class="sxs-lookup"><span data-stu-id="34c45-114">Some hard errors, such as network failures are reported immediately.</span></span> <span data-ttu-id="34c45-115">Cependant, il arrive parfois que des délais d'attente spécifiques à un composant retardent la signalisation de certaines erreurs matérielles.</span><span class="sxs-lookup"><span data-stu-id="34c45-115">However, in some cases, component-specific time-out periods can delay the reporting of some hard errors.</span></span> <span data-ttu-id="34c45-116">Pour les erreurs logicielles, la durée du délai d'expiration de session détermine la vitesse de détection de l'erreur.</span><span class="sxs-lookup"><span data-stu-id="34c45-116">For soft errors, the length of the session-timeout period determines the speed of error detection.</span></span> <span data-ttu-id="34c45-117">Par défaut, cette valeur est de 10 secondes.</span><span class="sxs-lookup"><span data-stu-id="34c45-117">By default, this period is 10 seconds.</span></span> <span data-ttu-id="34c45-118">Il s'agit de la valeur minimale recommandée.</span><span class="sxs-lookup"><span data-stu-id="34c45-118">This is the minimum recommended value.</span></span>  
  
## <a name="failures-due-to-hard-errors"></a><span data-ttu-id="34c45-119">Défaillances dues à des erreurs matérielles</span><span class="sxs-lookup"><span data-stu-id="34c45-119">Failures Due to Hard Errors</span></span>  
 <span data-ttu-id="34c45-120">Parmi les causes possibles d'erreurs matérielles figurent notamment, sans s'y limiter, les situations suivantes :</span><span class="sxs-lookup"><span data-stu-id="34c45-120">Possible causes of hard errors include (but are not limited to) the following conditions:</span></span>  
  
-   <span data-ttu-id="34c45-121">une connexion ou un câble coupé ;</span><span class="sxs-lookup"><span data-stu-id="34c45-121">A broken connection or wire</span></span>  
  
-   <span data-ttu-id="34c45-122">une carte réseau défaillante ;</span><span class="sxs-lookup"><span data-stu-id="34c45-122">A bad network card</span></span>  
  
-   <span data-ttu-id="34c45-123">un changement de routeur ;</span><span class="sxs-lookup"><span data-stu-id="34c45-123">A router change</span></span>  
  
-   <span data-ttu-id="34c45-124">des modifications au pare-feu ;</span><span class="sxs-lookup"><span data-stu-id="34c45-124">Changes in the firewall</span></span>  
  
-   <span data-ttu-id="34c45-125">une reconfiguration du point de terminaison ;</span><span class="sxs-lookup"><span data-stu-id="34c45-125">Endpoint reconfiguration</span></span>  
  
-   <span data-ttu-id="34c45-126">la perte du lecteur où se trouve le journal de transactions ;</span><span class="sxs-lookup"><span data-stu-id="34c45-126">Loss of the drive where the transaction log resides</span></span>  
  
-   <span data-ttu-id="34c45-127">une défaillance du système d'exploitation ou d'un processus.</span><span class="sxs-lookup"><span data-stu-id="34c45-127">Operating system or process failure</span></span>  
  
 <span data-ttu-id="34c45-128">Par exemple, lorsque le lecteur de journalisation de la base de données primaire cesse de répondre et échoue, le système d'exploitation informe Sqlservr.exe qu'une erreur grave s'est produite.</span><span class="sxs-lookup"><span data-stu-id="34c45-128">For example, when the log drive on the primary database becomes unresponsive and fails, the operating system informs Sqlservr.exe that a serious error has occurred.</span></span>  
  
 <span data-ttu-id="34c45-129">Certains composants, tels que les composants réseau et certains sous-systèmes d'E/S, ont leurs propres délais d'attente pour détecter les défaillances.</span><span class="sxs-lookup"><span data-stu-id="34c45-129">Some components, such as network components and some IO subsystems, have their own time-outs to determine failures.</span></span> <span data-ttu-id="34c45-130">Ces délais sont indépendants de [!INCLUDE[ssHADR](../../../includes/sshadr-md.md)], qui n'en a pas connaissance et n'est pas tenu au courant de leur comportement.</span><span class="sxs-lookup"><span data-stu-id="34c45-130">Such time-outs are independent of [!INCLUDE[ssHADR](../../../includes/sshadr-md.md)], which has no knowledge of them and is completely unaware of their behavior.</span></span> <span data-ttu-id="34c45-131">Dans ces cas, le délai d'attente augmente la durée entre une défaillance et la réception de son erreur matérielle par le réplica de disponibilité.</span><span class="sxs-lookup"><span data-stu-id="34c45-131">In these cases, the time-out delay increases the time between a failure and when the availability replica receives the resulting hard error.</span></span>  
  
> [!NOTE]  
>  <span data-ttu-id="34c45-132">C'est uniquement dans le cas des erreurs logicielles que la détection des erreurs appliquée aux réplicas de disponibilité est active.</span><span class="sxs-lookup"><span data-stu-id="34c45-132">The only active error checking performed for availability replicas occurs for soft error cases.</span></span> <span data-ttu-id="34c45-133">Pour plus d'informations, consultez « Défaillances dues à des erreurs logicielles » plus loin dans cette rubrique.</span><span class="sxs-lookup"><span data-stu-id="34c45-133">For more information, see "Failures Due to Soft Errors," later in this topic.</span></span>  
  
 <span data-ttu-id="34c45-134">Pour vous aider à interpréter les conditions d'erreur qui se produisent sur le réseau, demandez à un ingénieur réseau quels messages d'erreur sont envoyés à un port lorsque les événements ci-dessous se produisent sur une connexion TCP :</span><span class="sxs-lookup"><span data-stu-id="34c45-134">To help you interpret the error conditions that occur on the network, ask a network engineer what error messages are sent to a port when the following events occur on a TCP connection:</span></span>  
  
-   <span data-ttu-id="34c45-135">le DNS ne fonctionne pas ;</span><span class="sxs-lookup"><span data-stu-id="34c45-135">DNS is not working.</span></span>  
  
-   <span data-ttu-id="34c45-136">les câbles sont débranchés ;</span><span class="sxs-lookup"><span data-stu-id="34c45-136">Cables are unplugged.</span></span>  
  
-   [!INCLUDE[msCoName](../../../includes/msconame-md.md)] <span data-ttu-id="34c45-137">Windows comprend un pare-feu qui bloque un port spécifique ;</span><span class="sxs-lookup"><span data-stu-id="34c45-137">Windows has a firewall that blocks a specific port.</span></span>  
  
-   <span data-ttu-id="34c45-138">l'application de surveillance d'un port ne fonctionne pas ;</span><span class="sxs-lookup"><span data-stu-id="34c45-138">The application that is monitoring a port fails.</span></span>  
  
-   <span data-ttu-id="34c45-139">un serveur Windows a été renommé ;</span><span class="sxs-lookup"><span data-stu-id="34c45-139">A Windows-based server is renamed.</span></span>  
  
-   <span data-ttu-id="34c45-140">un serveur Windows a été redémarré ;</span><span class="sxs-lookup"><span data-stu-id="34c45-140">A Windows-based server is rebooted.</span></span>  
  
> [!NOTE]  
>  [!INCLUDE[ssHADRc](../../../includes/sshadrc-md.md)] <span data-ttu-id="34c45-141">ne protège pas des problèmes spécifiques au client qui accède aux serveurs.</span><span class="sxs-lookup"><span data-stu-id="34c45-141">does not protect against problems specific to client accessing the servers.</span></span> <span data-ttu-id="34c45-142">Prenons l'exemple d'un cas dans lequel une carte réseau publique gère des connexions clientes au réplica principal, tandis qu'une carte d'interface réseau privée gère le trafic entre les instances de serveur qui hébergent les réplicas d'un groupe de disponibilité.</span><span class="sxs-lookup"><span data-stu-id="34c45-142">For example, consider a case in which a public network adapter handles client connections to the primary replica, while a private network interface card handles traffic among the server instances that are hosting the replicas of an availability group.</span></span> <span data-ttu-id="34c45-143">Dans ce cas, l'échec de la carte réseau publique empêcherait les clients d'accéder aux bases de données.</span><span class="sxs-lookup"><span data-stu-id="34c45-143">In this case, failure of the public network adapter would prevent clients from accessing the databases.</span></span>  
  
## <a name="failures-due-to-soft-errors"></a><span data-ttu-id="34c45-144">Défaillances dues à des erreurs logicielles</span><span class="sxs-lookup"><span data-stu-id="34c45-144">Failures Due to Soft Errors</span></span>  
 <span data-ttu-id="34c45-145">Parmi les conditions susceptibles de provoquer des délais d'expiration de session figurent notamment, sans s'y limiter, les situations suivantes :</span><span class="sxs-lookup"><span data-stu-id="34c45-145">Conditions that might cause session timeouts include (but are not limited to) the following:</span></span>  
  
-   <span data-ttu-id="34c45-146">des erreurs réseau, par exemple, un dépassement de délai de la liaison TCP, des paquets supprimés ou endommagés, des paquets dans le désordre ;</span><span class="sxs-lookup"><span data-stu-id="34c45-146">Network errors such as TCP link time-outs, dropped or corrupted packets, or packets that are in an incorrect order.</span></span>  
  
-   <span data-ttu-id="34c45-147">un système d’exploitation, un serveur ou une base de données qui ne répond pas ;</span><span class="sxs-lookup"><span data-stu-id="34c45-147">An operating system, server, or database that is not responding.</span></span>  
  
-   <span data-ttu-id="34c45-148">un serveur Windows en cours de dépassement d'un délai d'expiration ;</span><span class="sxs-lookup"><span data-stu-id="34c45-148">A Windows server timing out.</span></span>  
  
-   <span data-ttu-id="34c45-149">des ressources informatiques insuffisantes, telles qu'une surcharge de l'unité centrale ou du disque, la taille limite atteinte par le journal de transactions ou l'absence de mémoire ou de threads disponibles.</span><span class="sxs-lookup"><span data-stu-id="34c45-149">Insufficient computing resources, such as a CPU or disk overload, the transaction log filling up, or the system is running out of memory or threads.</span></span> <span data-ttu-id="34c45-150">Dans de telles situations, vous devez augmenter le délai d'attente, réduire la charge de travail ou remplacer les matériels pour qu'ils supportent la charge de travail.</span><span class="sxs-lookup"><span data-stu-id="34c45-150">In these cases, you must increase the time-out period, reduce the workload, or change the hardware to handle the workload.</span></span>  
  
### <a name="the-session-timeout-mechanism"></a><span data-ttu-id="34c45-151">Mécanisme du délai d'expiration de session</span><span class="sxs-lookup"><span data-stu-id="34c45-151">The Session-Timeout Mechanism</span></span>  
 <span data-ttu-id="34c45-152">Étant donné que les erreurs logicielles ne sont pas détectables directement par une instance de serveur, lorsqu'elles surviennent, un réplica de disponibilité peut attendre indéfiniment une réponse de l'autre réplica de disponibilité dans une session.</span><span class="sxs-lookup"><span data-stu-id="34c45-152">Because soft errors are not detectable directly by a server instance, a soft error could potentially cause an availability replica to wait indefinitely for a response from the other availability replica in a session.</span></span> <span data-ttu-id="34c45-153">Pour éviter cela, [!INCLUDE[ssHADR](../../../includes/sshadr-md.md)] implémente son propre mécanisme de délai d'expiration de session, selon lequel les réplicas de disponibilités connectés envoient une commande ping sur chaque connexion ouverte à un intervalle fixe.</span><span class="sxs-lookup"><span data-stu-id="34c45-153">To prevent this, [!INCLUDE[ssHADR](../../../includes/sshadr-md.md)] implements a session time-out mechanism, based on the connected availability replicas sending out a ping on each open connection at a fixed interval.</span></span> <span data-ttu-id="34c45-154">La réception d'un ping au cours du délai d'attente indique que la connexion est toujours ouverte et que les instances de serveur communiquent via celle-ci.</span><span class="sxs-lookup"><span data-stu-id="34c45-154">Receiving a ping during the time-out period indicates that the connection is still open and that the server instances are communicating over it.</span></span> <span data-ttu-id="34c45-155">À la réception du ping, un réplica réinitialise son compteur de délai d'expiration sur cette connexion.</span><span class="sxs-lookup"><span data-stu-id="34c45-155">On receiving a ping, a replica resets its time-out counter on that connection.</span></span> <span data-ttu-id="34c45-156">Pour plus d’informations sur la relation entre le mode de disponibilité et les délais d’expiration de session, consultez [modes de disponibilité (groupes de disponibilité AlwaysOn)](availability-modes-always-on-availability-groups.md).</span><span class="sxs-lookup"><span data-stu-id="34c45-156">For information about the relationship of availability mode and session timeouts, see [Availability Modes (AlwaysOn Availability Groups)](availability-modes-always-on-availability-groups.md).</span></span>  
  
 <span data-ttu-id="34c45-157">Les réplicas primaire et secondaire s'envoient réciproquement une commande ping pour signaler qu'ils sont toujours actifs, et la limite définie par le délai d'expiration de session empêche que l'un ou l'autre réplica attende indéfiniment de recevoir une commande ping de l'autre réplica.</span><span class="sxs-lookup"><span data-stu-id="34c45-157">The primary and secondary replicas ping each other to signal that they are still active, and a session-timeout limit prevents either replica from waiting indefinitely to receive a ping from the other replica.</span></span> <span data-ttu-id="34c45-158">La limite définie par le délai d'expiration de session est une propriété de réplica configurable par l'utilisateur dont la valeur par défaut est de 10 secondes.</span><span class="sxs-lookup"><span data-stu-id="34c45-158">The session-timeout limit is a user-configurable replica property with a default value of 10 seconds.</span></span> <span data-ttu-id="34c45-159">La réception d'un ping au cours du délai d'attente indique que la connexion est toujours ouverte et que les instances de serveur communiquent via celle-ci.</span><span class="sxs-lookup"><span data-stu-id="34c45-159">Receiving a ping during the time-out period indicates that the connection is still open and that the server instances are communicating over it.</span></span> <span data-ttu-id="34c45-160">À la réception d'un ping, un réplica de disponibilité réinitialise son compteur de délai d'expiration de session sur cette connexion.</span><span class="sxs-lookup"><span data-stu-id="34c45-160">On receiving a ping, an availability replica resets its time-out counter on that connection.</span></span>  
  
 <span data-ttu-id="34c45-161">Si aucun ping n’est reçu de l’autre réplica au cours de la période d’expiration de session, la connexion expire. La connexion est fermée, et le réplica ayant expiré passe à l’État Disconnected.</span><span class="sxs-lookup"><span data-stu-id="34c45-161">If no ping is received from the other replica within the session-timeout period, the connection times out. The connection is closed, and the timed-out replica enters the DISCONNECTED state.</span></span> <span data-ttu-id="34c45-162">Même si un réplica déconnecté est configuré pour le mode de validation synchrone, les transactions n'attendront pas que ce réplica se reconnecte et se resynchronise.</span><span class="sxs-lookup"><span data-stu-id="34c45-162">Even if a disconnected replica is configured for synchronous-commit mode, transactions will not wait for that replica to reconnect and resynchronize.</span></span>  
  
## <a name="responding-to-an-error"></a><span data-ttu-id="34c45-163">Réponse à une erreur</span><span class="sxs-lookup"><span data-stu-id="34c45-163">Responding to an Error</span></span>  
 <span data-ttu-id="34c45-164">Quel que soit le type d'erreur, une instance de serveur qui détecte une erreur réagit comme il se doit en fonction du rôle de l'instance, du mode de disponibilité de la session et de l'état des autres connexions de la session.</span><span class="sxs-lookup"><span data-stu-id="34c45-164">Regardless of the type of error, a server instance that detects an error responds appropriately based on the role of the instance, the availability mode of the session, and the state of any other connection in the session.</span></span> <span data-ttu-id="34c45-165">Pour plus d’informations sur ce qui se produit lors de la perte d’un partenaire, consultez [modes de disponibilité (groupes de disponibilité AlwaysOn)](availability-modes-always-on-availability-groups.md).</span><span class="sxs-lookup"><span data-stu-id="34c45-165">For information about what occurs on the loss of a partner, see [Availability Modes (AlwaysOn Availability Groups)](availability-modes-always-on-availability-groups.md).</span></span>  
  
## <a name="related-tasks"></a><span data-ttu-id="34c45-166">Tâches associées</span><span class="sxs-lookup"><span data-stu-id="34c45-166">Related Tasks</span></span>  
 <span data-ttu-id="34c45-167">**Pour modifier la valeur du délai d'expiration (mode de disponibilité avec validation synchrone uniquement)**</span><span class="sxs-lookup"><span data-stu-id="34c45-167">**To change the time-out value (synchronous-commit availability mode only)**</span></span>  
  
-   [<span data-ttu-id="34c45-168">Modifier le délai d’expiration de session pour un réplica de disponibilité &#40;SQL Server&#41;</span><span class="sxs-lookup"><span data-stu-id="34c45-168">Change the Session-Timeout Period for an Availability Replica &#40;SQL Server&#41;</span></span>](change-the-session-timeout-period-for-an-availability-replica-sql-server.md)  
  
 <span data-ttu-id="34c45-169">**Pour afficher la valeur actuelle du délai d'attente**</span><span class="sxs-lookup"><span data-stu-id="34c45-169">**To view the current time-out value**</span></span>  
  
-   <span data-ttu-id="34c45-170">Interroger **session_timeout** dans [sys.availability_replicas &#40;Transact-SQL&#41;](/sql/relational-databases/system-catalog-views/sys-availability-replicas-transact-sql).</span><span class="sxs-lookup"><span data-stu-id="34c45-170">Query **session_timeout** in [sys.availability_replicas &#40;Transact-SQL&#41;](/sql/relational-databases/system-catalog-views/sys-availability-replicas-transact-sql).</span></span>  
  
## <a name="see-also"></a><span data-ttu-id="34c45-171">Voir aussi</span><span class="sxs-lookup"><span data-stu-id="34c45-171">See Also</span></span>  
 [<span data-ttu-id="34c45-172">Vue d’ensemble de groupes de disponibilité AlwaysOn &#40;SQL Server&#41;</span><span class="sxs-lookup"><span data-stu-id="34c45-172">Overview of AlwaysOn Availability Groups &#40;SQL Server&#41;</span></span>](overview-of-always-on-availability-groups-sql-server.md)  
  
  
