---
title: Transactions entre bases de données non prises en charge pour la mise en miroir de bases de données ou groupes de disponibilité AlwaysOn (SQL Server) | Microsoft Docs
ms.custom: ''
ms.date: 03/06/2017
ms.prod: sql-server-2014
ms.reviewer: ''
ms.technology: high-availability
ms.topic: conceptual
helpviewer_keywords:
- database mirroring [SQL Server], interoperability
- cross-database transactions [SQL Server]
- transactions [database mirroring]
- Availability Groups [SQL Server], interoperability
- troubleshooting [SQL Server], cross-database transactions
ms.assetid: 9f7ed895-ad65-43e3-ba08-00d7bff1456d
author: MashaMSFT
ms.author: mathoma
ms.openlocfilehash: a0e23e073375c8f00317003635df8ec0b69883cd
ms.sourcegitcommit: ad4d92dce894592a259721a1571b1d8736abacdb
ms.translationtype: MT
ms.contentlocale: fr-FR
ms.lasthandoff: 08/04/2020
ms.locfileid: "87708643"
---
# <a name="cross-database-transactions-not-supported-for-database-mirroring-or-alwayson-availability-groups-sql-server"></a><span data-ttu-id="23c54-102">Transactions entre bases de données non prises en charge pour la mise en miroir de bases de données ou les groupes de disponibilité AlwaysOn (SQL Server)</span><span class="sxs-lookup"><span data-stu-id="23c54-102">Cross-Database Transactions Not Supported For Database Mirroring or AlwaysOn Availability Groups (SQL Server)</span></span>
  <span data-ttu-id="23c54-103">Les transactions entre bases de données et les transactions distribuées ne sont pas prises en charge par [!INCLUDE[ssHADR](../../../includes/sshadr-md.md)] et par la mise en miroir de bases de données.</span><span class="sxs-lookup"><span data-stu-id="23c54-103">Cross-database transactions and distributed transactions are not supported by [!INCLUDE[ssHADR](../../../includes/sshadr-md.md)] or by database mirroring.</span></span> <span data-ttu-id="23c54-104">En effet, l'atomicité/intégrité des transactions ne peut pas être garantie pour les raisons suivantes :</span><span class="sxs-lookup"><span data-stu-id="23c54-104">This is because transaction atomicity/integrity cannot be guaranteed for the following reasons:</span></span>  
  
-   <span data-ttu-id="23c54-105">Pour les transactions entre bases de données : chaque base de données est validée indépendamment.</span><span class="sxs-lookup"><span data-stu-id="23c54-105">For cross-database transactions: Each database commits independently.</span></span> <span data-ttu-id="23c54-106">Par conséquent, même pour les bases de données dans un seul groupe de disponibilité, un basculement peut se produire après qu'une base de données a validé une transaction, mais avant que l'autre base de données ne le fasse.</span><span class="sxs-lookup"><span data-stu-id="23c54-106">Therefore, even for databases in a single availability group, a failover could occur after one database commits a transaction but before the other database does.</span></span> <span data-ttu-id="23c54-107">Pour la mise en miroir de bases de données, ce problème est aggravé car après un basculement, la base de données mise en miroir figure généralement sur une instance de serveur différente de l'autre base de données, et même si les deux bases de données sont mises en miroir entre les mêmes deux partenaires, il n'y a aucune garantie que les deux bases de données basculent au même moment.</span><span class="sxs-lookup"><span data-stu-id="23c54-107">For database mirroring this issue is compounded because after a failover, the mirrored database is typically on a different server instance from the other database, and  even if both databases are mirrored between the same two partners, there is no guarantee that both databases will fail over at the same time.</span></span>  
  
-   <span data-ttu-id="23c54-108">Pour les transactions distribuées : après un basculement, le nouveau principal/réplica principal ne peut pas se connecter au coordinateur de transaction distribuée sur le principal/réplica principal.</span><span class="sxs-lookup"><span data-stu-id="23c54-108">For distributed transactions: After a failover, the new principal server/primary replica is unable to connect to the distributed transaction coordinator on the previous principal server/primary replica.</span></span> <span data-ttu-id="23c54-109">Par conséquent, le nouveau principal/réplica principal ne peut pas obtenir l'état de la transaction.</span><span class="sxs-lookup"><span data-stu-id="23c54-109">Therefore, the new principal server/primary replica cannot obtain the transaction status.</span></span>  
  
 <span data-ttu-id="23c54-110">L'exemple de mise en miroir de bases de données suivant illustre la manière dont une incohérence logique pourrait se produire.</span><span class="sxs-lookup"><span data-stu-id="23c54-110">The following database mirroring example illustrates how a logical inconsistency could occur.</span></span> <span data-ttu-id="23c54-111">Dans cet exemple, une application utilise une transaction entre bases de données pour insérer deux lignes de données : une ligne est insérée dans une table dans une base de données mise en miroir, A, et l'autre ligne est insérée dans une table dans une autre base de données, B. La base de données A est mise en miroir en mode haute sécurité avec basculement automatique.</span><span class="sxs-lookup"><span data-stu-id="23c54-111">In this example, an application uses a cross-database transaction to insert two rows of data: one row is inserted into a table in a mirrored database, A, and the other row is inserted into a table in another database, B. Database A is being mirrored in high-safety mode with automatic failover.</span></span> <span data-ttu-id="23c54-112">Pendant la validation de la transaction, la base de données A devient indisponible et la session de mise en miroir bascule automatiquement vers le miroir de la base de données A.</span><span class="sxs-lookup"><span data-stu-id="23c54-112">While the transaction is being committed, database A becomes unavailable, and the mirroring session automatically fails over to the mirror of database A.</span></span>  
  
 <span data-ttu-id="23c54-113">Après le basculement, il se peut que la transaction entre bases de données soit validée correctement dans la base de données B mais pas dans la base de données basculée.</span><span class="sxs-lookup"><span data-stu-id="23c54-113">After the failover, the cross-database transaction might be successfully committed on database B but not on the failed-over database.</span></span> <span data-ttu-id="23c54-114">Cela pourrait se produire si le serveur principal d'origine de la base de données A n'avait pas envoyé le journal pour la transaction entre bases de données avant le basculement.</span><span class="sxs-lookup"><span data-stu-id="23c54-114">This would occur if the original principal server for database A had not sent the log for the cross-database transaction to the mirror server before the failure.</span></span> <span data-ttu-id="23c54-115">Après le basculement, cette transaction n'existerait pas sur le nouveau serveur principal.</span><span class="sxs-lookup"><span data-stu-id="23c54-115">After the failover, that transaction would not exist on the new principal server.</span></span> <span data-ttu-id="23c54-116">Les bases de données A et B deviendraient incohérentes car les données insérées dans la base de donnes B demeureraient intactes, alors que celles insérées dans la base de données A auraient été perdues.</span><span class="sxs-lookup"><span data-stu-id="23c54-116">Databases A and B would become inconsistent, because the data inserted in database B remains intact, but the data inserted in database A has been lost.</span></span>  
  
 <span data-ttu-id="23c54-117">Un scénario semblable peut se présenter lors de l'utilisation d'une transaction MS DTC.</span><span class="sxs-lookup"><span data-stu-id="23c54-117">A similar scenario can occur while using a MS DTC transaction.</span></span> <span data-ttu-id="23c54-118">Par exemple, après un basculement, le nouveau principal contacte MS DTC.</span><span class="sxs-lookup"><span data-stu-id="23c54-118">For example, after failover, the new principal contacts MS DTC.</span></span> <span data-ttu-id="23c54-119">Mais MS DTC n'a aucune connaissance du nouveau serveur principal et interrompt toute transaction en « préparation pour validation », considérée comme validée dans d'autres bases de données.</span><span class="sxs-lookup"><span data-stu-id="23c54-119">But MS DTC has no knowledge of the new principal server, and it terminates any transactions that are "preparing to commit," which are considered committed in other databases.</span></span>  
  
> [!IMPORTANT]  
>  <span data-ttu-id="23c54-120">Le fait d'utiliser la mise en miroir de bases de données ou les groupes de disponibilité avec DTC n'entraîne pas une installation non prise en charge de SQL Server.</span><span class="sxs-lookup"><span data-stu-id="23c54-120">Using Database Mirroring or Availability Groups together with DTC does not result in an unsupported SQL Server installation.</span></span> <span data-ttu-id="23c54-121">Si, cependant, une base de données fait partie d'une session de mise en miroir de bases de données ou d'un groupe de disponibilité et DTC est également utilisé dans la base de données, les problèmes de prise en charge seront examinés par Microsoft uniquement s'ils ne sont pas associés à l'utilisation combinée de la mise en miroir de bases de données ou des groupes de disponibilité avec DTC.</span><span class="sxs-lookup"><span data-stu-id="23c54-121">If, however, a database is part of a Database Mirroring session or an Availability Group and DTC is also used in the database, support issues will be investigated by Microsoft only if unrelated to the combined use of Database Mirroring or Availability Groups with DTC.</span></span>  
  
  
