---
title: Configurer la sauvegarde sur des réplicas de disponibilité (SQL Server) | Microsoft Docs
ms.custom: ''
ms.date: 06/14/2017
ms.prod: sql-server-2014
ms.reviewer: ''
ms.technology: high-availability
ms.topic: conceptual
helpviewer_keywords:
- backup priority
- backup on secondary replicas
- Availability Groups [SQL Server], availability replicas
- Availability Groups [SQL Server], backup on secondary replicas
- active secondary replicas [SQL Server], backup on
- automated backup preference
- Availability Groups [SQL Server], active secondary replicas
ms.assetid: 74bc40bb-9f57-44e4-8988-1d69c0585eb6
author: MashaMSFT
ms.author: mathoma
ms.openlocfilehash: 91a781d957eb2f5a81d323fc3c65c93e34945c12
ms.sourcegitcommit: ad4d92dce894592a259721a1571b1d8736abacdb
ms.translationtype: MT
ms.contentlocale: fr-FR
ms.lasthandoff: 08/04/2020
ms.locfileid: "87708668"
---
# <a name="configure-backup-on-availability-replicas-sql-server"></a><span data-ttu-id="00cfb-102">Configurer la sauvegarde sur des réplicas de disponibilité (SQL Server)</span><span class="sxs-lookup"><span data-stu-id="00cfb-102">Configure Backup on Availability Replicas (SQL Server)</span></span>
  <span data-ttu-id="00cfb-103">Cette rubrique explique comment configurer la sauvegarde sur des réplicas secondaires pour un groupe de disponibilité AlwaysOn à l'aide de [!INCLUDE[ssManStudioFull](../../../includes/ssmanstudiofull-md.md)], de [!INCLUDE[tsql](../../../includes/tsql-md.md)]ou de PowerShell dans [!INCLUDE[ssCurrent](../../../includes/sscurrent-md.md)].</span><span class="sxs-lookup"><span data-stu-id="00cfb-103">This topic describes how to configure backup on secondary replicas for an AlwaysOn availability group by using [!INCLUDE[ssManStudioFull](../../../includes/ssmanstudiofull-md.md)], [!INCLUDE[tsql](../../../includes/tsql-md.md)], or PowerShell in [!INCLUDE[ssCurrent](../../../includes/sscurrent-md.md)].</span></span>  
  
> [!NOTE]  
>  <span data-ttu-id="00cfb-104">Pour une introduction à la sauvegarde sur les réplicas secondaires, consultez secondaires [actifs : sauvegarde sur les réplicas secondaires (groupes de disponibilité AlwaysOn)](active-secondaries-backup-on-secondary-replicas-always-on-availability-groups.md).</span><span class="sxs-lookup"><span data-stu-id="00cfb-104">For an introduction to backup on secondary replicas, see [Active Secondaries: Backup on Secondary Replicas (AlwaysOn Availability Groups)](active-secondaries-backup-on-secondary-replicas-always-on-availability-groups.md).</span></span>  
  
 
  

  
##  <a name="before-you-begin"></a><a name="BeforeYouBegin"></a> <span data-ttu-id="00cfb-105">Avant de commencer</span><span class="sxs-lookup"><span data-stu-id="00cfb-105">Before You Begin</span></span>  
  
###  <a name="prerequisites"></a><a name="Prerequisites"></a> <span data-ttu-id="00cfb-106">Conditions préalables</span><span class="sxs-lookup"><span data-stu-id="00cfb-106">Prerequisites</span></span>  
 <span data-ttu-id="00cfb-107">Vous devez être connecté à l'instance de serveur qui héberge le réplica principal.</span><span class="sxs-lookup"><span data-stu-id="00cfb-107">You must be connected to the server instance that hosts the primary replica.</span></span>  
  
###  <a name="security"></a><a name="Security"></a> <span data-ttu-id="00cfb-108">Sécurité</span><span class="sxs-lookup"><span data-stu-id="00cfb-108">Security</span></span>  
  
####  <a name="permissions"></a><a name="Permissions"></a> <span data-ttu-id="00cfb-109">Autorisations</span><span class="sxs-lookup"><span data-stu-id="00cfb-109">Permissions</span></span>  
  
|<span data-ttu-id="00cfb-110">Tâche</span><span class="sxs-lookup"><span data-stu-id="00cfb-110">Task</span></span>|<span data-ttu-id="00cfb-111">Autorisations</span><span class="sxs-lookup"><span data-stu-id="00cfb-111">Permissions</span></span>|  
|----------|-----------------|  
|<span data-ttu-id="00cfb-112">Pour configurer la sauvegarde sur les réplicas secondaires en créant un groupe de disponibilité</span><span class="sxs-lookup"><span data-stu-id="00cfb-112">To configure backup on secondary replicas when creating an availability group</span></span>|<span data-ttu-id="00cfb-113">Requiert l’appartenance au rôle serveur fixe **sysadmin** et l’autorisation de serveur CREATE AVAILABILITY GROUP, l’autorisation ALTER ANY AVAILABILITY GROUP ou l’autorisation CONTROL SERVER.</span><span class="sxs-lookup"><span data-stu-id="00cfb-113">Requires membership in the **sysadmin** fixed server role and either CREATE AVAILABILITY GROUP server permission, ALTER ANY AVAILABILITY GROUP permission, or CONTROL SERVER permission.</span></span>|  
|<span data-ttu-id="00cfb-114">Pour modifier un groupe de disponibilité ou un réplica de disponibilité</span><span class="sxs-lookup"><span data-stu-id="00cfb-114">To modify an availability group or availability replica</span></span>|<span data-ttu-id="00cfb-115">Requiert l'autorisation ALTER AVAILABILITY GROUP sur le groupe de disponibilité, l'autorisation CONTROL AVAILABILITY GROUP, l'autorisation ALTER ANY AVAILABILITY GROUP ou l'autorisation CONTROL SERVER.</span><span class="sxs-lookup"><span data-stu-id="00cfb-115">Requires ALTER AVAILABILITY GROUP permission on the availability group, CONTROL AVAILABILITY GROUP permission, ALTER ANY AVAILABILITY GROUP permission, or CONTROL SERVER permission.</span></span>|  
  
##  <a name="using-sql-server-management-studio"></a><a name="SSMSProcedure"></a> <span data-ttu-id="00cfb-116">Utilisation de SQL Server Management Studio</span><span class="sxs-lookup"><span data-stu-id="00cfb-116">Using SQL Server Management Studio</span></span>  
 <span data-ttu-id="00cfb-117">**Pour configurer la sauvegarde sur les réplicas secondaires**</span><span class="sxs-lookup"><span data-stu-id="00cfb-117">**To configure backup on secondary replicas**</span></span>  
  
1.  <span data-ttu-id="00cfb-118">Dans l'Explorateur d'objets, connectez-vous à l'instance de serveur qui héberge le réplica principal, cliquez sur le nom du serveur pour développer l'arborescence du serveur.</span><span class="sxs-lookup"><span data-stu-id="00cfb-118">In Object Explorer, connect to the server instance that hosts the primary replica, and click the server name to expand the server tree.</span></span>  
  
2.  <span data-ttu-id="00cfb-119">Développez le nœud **Haute disponibilité AlwaysOn** et le nœud **Groupes de disponibilité** .</span><span class="sxs-lookup"><span data-stu-id="00cfb-119">Expand the **AlwaysOn High Availability** node and the **Availability Groups** node.</span></span>  
  
3.  <span data-ttu-id="00cfb-120">Cliquez sur le groupe de disponibilité dont vous souhaitez configurer les préférences de sauvegarde et sélectionnez la commande **Propriétés** .</span><span class="sxs-lookup"><span data-stu-id="00cfb-120">Click the availability group whose backup preferences you want to configure, and select the **Properties** command.</span></span>  
  
4.  <span data-ttu-id="00cfb-121">Dans la boîte de dialogue **Propriétés de groupe de disponibilité**, sélectionnez la page **Préférences de sauvegarde**.</span><span class="sxs-lookup"><span data-stu-id="00cfb-121">In the **Availability Group Properties** dialog box, select **Backup Preferences** page.</span></span>  
  
5.  <span data-ttu-id="00cfb-122">Dans le panneau **Où les sauvegardes doivent-elles être effectuées ?** , sélectionnez la préférence de sauvegarde automatisée pour le groupe de disponibilité, parmi les options suivantes :</span><span class="sxs-lookup"><span data-stu-id="00cfb-122">On the **Where should backups occur?** panel, select the automated backup preference for the availability group, one of:</span></span>  
  
     <span data-ttu-id="00cfb-123">**Préférer secondaire**</span><span class="sxs-lookup"><span data-stu-id="00cfb-123">**Prefer Secondary**</span></span>  
     <span data-ttu-id="00cfb-124">Spécifie que les sauvegardes doivent se produire sur un réplica secondaire sauf lorsque le réplica principal est le seul réplica en ligne.</span><span class="sxs-lookup"><span data-stu-id="00cfb-124">Specifies that backups should occur on a secondary replica except when the primary replica is the only replica online.</span></span> <span data-ttu-id="00cfb-125">Dans ce cas, la sauvegarde doit se produire sur le réplica principal.</span><span class="sxs-lookup"><span data-stu-id="00cfb-125">In that case, the backup should occur on the primary replica.</span></span> <span data-ttu-id="00cfb-126">Il s'agit de l'option par défaut.</span><span class="sxs-lookup"><span data-stu-id="00cfb-126">This is the default option.</span></span>  
  
     <span data-ttu-id="00cfb-127">**Secondaire uniquement**</span><span class="sxs-lookup"><span data-stu-id="00cfb-127">**Secondary only**</span></span>  
     <span data-ttu-id="00cfb-128">Spécifie que les sauvegardes ne doivent jamais être effectuées sur le réplica principal.</span><span class="sxs-lookup"><span data-stu-id="00cfb-128">Specifies that backups should never be performed on the primary replica.</span></span> <span data-ttu-id="00cfb-129">Si le réplica principal est le seul réplica en ligne, la sauvegarde ne doit pas avoir lieu.</span><span class="sxs-lookup"><span data-stu-id="00cfb-129">If the primary replica is the only replica online, the backup should not occur.</span></span>  
  
     `Primary`  
     <span data-ttu-id="00cfb-130">Spécifie que les sauvegardes doivent toujours avoir lieu sur le réplica principal.</span><span class="sxs-lookup"><span data-stu-id="00cfb-130">Specifies that the backups should always occur on the primary replica.</span></span> <span data-ttu-id="00cfb-131">Cette option est utile si vous avez besoin de fonctionnalités de sauvegarde, telles que la création de sauvegardes différentielles, qui ne sont pas prises en charge lorsque la sauvegarde est exécutée sur un réplica secondaire.</span><span class="sxs-lookup"><span data-stu-id="00cfb-131">This option is useful if you need backup features, such as creating differential backups, that are not supported when backup is run on a secondary replica.</span></span>  
  
    > [!IMPORTANT]  
    >  <span data-ttu-id="00cfb-132">Si vous envisagez d'utiliser la copie de journaux de transaction pour préparer des bases de données secondaires pour un groupe de disponibilité, définissez la préférence de sauvegarde automatique sur `Primary` jusqu'à ce que toutes les bases de données secondaires aient été préparées et attachées au groupe de disponibilité.</span><span class="sxs-lookup"><span data-stu-id="00cfb-132">If you plan to use log shipping to prepare any secondary databases for an availability group, set the automated backup preference to `Primary` until all the secondary databases have been prepared and joined to the availability group.</span></span>  
  
     <span data-ttu-id="00cfb-133">**Tout réplica**</span><span class="sxs-lookup"><span data-stu-id="00cfb-133">**Any Replica**</span></span>  
     <span data-ttu-id="00cfb-134">Spécifie que vous préférez que les travaux de sauvegarde ignorent le rôle des réplicas de disponibilité lorsque vous choisissez le réplica pour effectuer les sauvegardes.</span><span class="sxs-lookup"><span data-stu-id="00cfb-134">Specifies that you prefer that backup jobs ignore the role of the availability replicas when choosing the replica to perform backups.</span></span> <span data-ttu-id="00cfb-135">Notez que les travaux de sauvegarde peuvent évaluer d'autres facteurs tels que la priorité de sauvegarde de chaque réplica de disponibilité en association avec son état opérationnel et son état connecté.</span><span class="sxs-lookup"><span data-stu-id="00cfb-135">Note backup jobs might evaluate other factors such as backup priority of each availability replica in combination with its operational state and connected state.</span></span>  
  
    > [!IMPORTANT]  
    >  <span data-ttu-id="00cfb-136">Il n'y a aucune mise en application du paramètre de préférence de sauvegarde automatisée.</span><span class="sxs-lookup"><span data-stu-id="00cfb-136">There is no enforcement of the automated backup preference setting.</span></span> <span data-ttu-id="00cfb-137">La traduction de cette préférence dépend de la logique, le cas échéant, que vous avez écrite dans les travaux de sauvegarde pour les bases de données dans un groupe de disponibilité donné.</span><span class="sxs-lookup"><span data-stu-id="00cfb-137">The interpretation of this preference depends on the logic, if any, that you script into backup jobs for the databases in a given availability group.</span></span> <span data-ttu-id="00cfb-138">Le paramètre de préférence de sauvegarde automatisée n'a aucun impact sur les sauvegardes ad-hoc.</span><span class="sxs-lookup"><span data-stu-id="00cfb-138">The automated backup preference setting has no impact on ad-hoc backups.</span></span> <span data-ttu-id="00cfb-139">Pour plus d’informations, consultez [suivi : après avoir configuré la sauvegarde sur les réplicas secondaires](#FollowUp) , plus loin dans cette rubrique.</span><span class="sxs-lookup"><span data-stu-id="00cfb-139">For more information, see [Follow Up: After Configuring Backup on Secondary Replicas](#FollowUp) later in this topic.</span></span>  
  
6.  <span data-ttu-id="00cfb-140">Utilisez la grille **Priorités de sauvegarde de réplica** pour modifier la priorité de sauvegarde des réplicas de disponibilité.</span><span class="sxs-lookup"><span data-stu-id="00cfb-140">Use the **Replica backup priorities** grid to change the backup priority of the availability replicas.</span></span> <span data-ttu-id="00cfb-141">Cette grille affiche la priorité de sauvegarde actuelle de chaque instance de serveur qui héberge un réplica pour le groupe de disponibilité.</span><span class="sxs-lookup"><span data-stu-id="00cfb-141">This grid displays the current backup priority of each server instance that hosts a replica for the availability group.</span></span> <span data-ttu-id="00cfb-142">Les colonnes de la grille sont les suivantes :</span><span class="sxs-lookup"><span data-stu-id="00cfb-142">The grid columns are as follows:</span></span>  
  
     <span data-ttu-id="00cfb-143">**Instance de serveur**</span><span class="sxs-lookup"><span data-stu-id="00cfb-143">**Server Instance**</span></span>  
     <span data-ttu-id="00cfb-144">Nom de l'instance de [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] qui héberge le réplica de disponibilité.</span><span class="sxs-lookup"><span data-stu-id="00cfb-144">The name of the instance of [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] that hosts the availability replica.</span></span>  
  
     <span data-ttu-id="00cfb-145">**Priorité de sauvegarde (Minimale=1, Maximale=100)**</span><span class="sxs-lookup"><span data-stu-id="00cfb-145">**Backup Priority (Lowest=1, Highest=100)**</span></span>  
     <span data-ttu-id="00cfb-146">Spécifie la priorité d'exécution des sauvegardes sur ce réplica par rapport aux autres réplicas dans le même groupe de disponibilité.</span><span class="sxs-lookup"><span data-stu-id="00cfb-146">Specifies your priority for performing backups on this replica relative to the other replicas in the same availability group.</span></span> <span data-ttu-id="00cfb-147">La valeur est un entier compris entre 0 et 100.</span><span class="sxs-lookup"><span data-stu-id="00cfb-147">The value is an integer in the range of 0..100.</span></span> <span data-ttu-id="00cfb-148">1 indique la priorité la plus faible, 100 la priorité la plus élevée.</span><span class="sxs-lookup"><span data-stu-id="00cfb-148">1 indicates the lowest priority, and 100 indicates the highest priority.</span></span> <span data-ttu-id="00cfb-149">Si **Priorité de sauvegarde** = 1, le réplica de disponibilité est choisi pour l'exécution des sauvegardes uniquement si aucun réplica de disponibilité ayant une priorité plus élevée n'est actuellement disponible.</span><span class="sxs-lookup"><span data-stu-id="00cfb-149">If **Backup Priority** = 1, the availability replica would be chosen for performing backups only if no higher priority availability replicas are currently available.</span></span>  
  
     <span data-ttu-id="00cfb-150">**Exclure le réplica**</span><span class="sxs-lookup"><span data-stu-id="00cfb-150">**Exclude Replica**</span></span>  
     <span data-ttu-id="00cfb-151">Sélectionnez cette option si vous ne souhaitez jamais que ce réplica de disponibilité soit choisi pour effectuer des sauvegardes.</span><span class="sxs-lookup"><span data-stu-id="00cfb-151">Select if you never want this availability replica to be chosen for performing backups.</span></span> <span data-ttu-id="00cfb-152">Cela est utile, par exemple, pour un réplica de disponibilité distant sur lequel vous ne souhaitez jamais basculer de sauvegardes.</span><span class="sxs-lookup"><span data-stu-id="00cfb-152">This is useful, for example, for a remote availability replica to which you never want backups to fail over.</span></span>  
  
7.  <span data-ttu-id="00cfb-153">Cliquez sur **OK**pour valider vos modifications.</span><span class="sxs-lookup"><span data-stu-id="00cfb-153">To commit your changes, click **OK**.</span></span>  
  
 <span data-ttu-id="00cfb-154">**Autres manières d'accéder à la page des préférences de sauvegarde**</span><span class="sxs-lookup"><span data-stu-id="00cfb-154">**Alternative ways to access the Backup Preferences page**</span></span>  
  
-   [<span data-ttu-id="00cfb-155">Utiliser la boîte de dialogue Nouveau groupe de disponibilité &#40;SQL Server Management Studio&#41;</span><span class="sxs-lookup"><span data-stu-id="00cfb-155">Use the New Availability Group Dialog Box &#40;SQL Server Management Studio&#41;</span></span>](use-the-new-availability-group-dialog-box-sql-server-management-studio.md)  
  
-   [<span data-ttu-id="00cfb-156">Utiliser l’Assistant Ajouter un réplica au groupe de disponibilité &#40;SQL Server Management Studio&#41;</span><span class="sxs-lookup"><span data-stu-id="00cfb-156">Use the Add Replica to Availability Group Wizard &#40;SQL Server Management Studio&#41;</span></span>](use-the-add-replica-to-availability-group-wizard-sql-server-management-studio.md)  
  
-   [<span data-ttu-id="00cfb-157">Utiliser la boîte de dialogue Nouveau groupe de disponibilité &#40;SQL Server Management Studio&#41;</span><span class="sxs-lookup"><span data-stu-id="00cfb-157">Use the New Availability Group Dialog Box &#40;SQL Server Management Studio&#41;</span></span>](use-the-new-availability-group-dialog-box-sql-server-management-studio.md)  
  
##  <a name="using-transact-sql"></a><a name="TsqlProcedure"></a> <span data-ttu-id="00cfb-158">Utilisation de Transact-SQL</span><span class="sxs-lookup"><span data-stu-id="00cfb-158">Using Transact-SQL</span></span>  
 <span data-ttu-id="00cfb-159">**Pour configurer la sauvegarde sur les réplicas secondaires**</span><span class="sxs-lookup"><span data-stu-id="00cfb-159">**To configure backup on secondary replicas**</span></span>  
  
1.  <span data-ttu-id="00cfb-160">Connectez-vous à l'instance de serveur qui héberge le réplica principal.</span><span class="sxs-lookup"><span data-stu-id="00cfb-160">Connect to the server instance that hosts the primary replica.</span></span>  
  
2.  <span data-ttu-id="00cfb-161">Pour un nouveau groupe de disponibilité, utilisez l’instruction [CREATE AVAILABILITY GROUP &#40;Transact-SQL&#41;](/sql/t-sql/statements/create-availability-group-transact-sql).</span><span class="sxs-lookup"><span data-stu-id="00cfb-161">For a new availability group, use the [CREATE AVAILABILITY GROUP &#40;Transact-SQL&#41;](/sql/t-sql/statements/create-availability-group-transact-sql) statement.</span></span> <span data-ttu-id="00cfb-162">Si vous modifiez un groupe de disponibilité existant, utilisez l’instruction [ALTER AVAILABILITY GROUP &#40;Transact-SQL&#41;](/sql/t-sql/statements/alter-availability-group-transact-sql).</span><span class="sxs-lookup"><span data-stu-id="00cfb-162">If you are modifying an existing availability group, use the [ALTER AVAILABILITY GROUP &#40;Transact-SQL&#41;](/sql/t-sql/statements/alter-availability-group-transact-sql) statement.</span></span>  
  
##  <a name="using-powershell"></a><a name="PowerShellProcedure"></a> <span data-ttu-id="00cfb-163">Utilisation de PowerShell</span><span class="sxs-lookup"><span data-stu-id="00cfb-163">Using PowerShell</span></span>  

### <a name="to-configure-backup-on-secondary-replicas"></a><span data-ttu-id="00cfb-164">Pour configurer la sauvegarde sur les réplicas secondaires</span><span class="sxs-lookup"><span data-stu-id="00cfb-164">To configure backup on secondary replicas</span></span>
  
1.  <span data-ttu-id="00cfb-165">Définissez la valeur par défaut (`cd`) sur l'instance de serveur qui héberge le réplica principal.</span><span class="sxs-lookup"><span data-stu-id="00cfb-165">Set default (`cd`) to the server instance that hosts the primary replica.</span></span>  
  
2.  <span data-ttu-id="00cfb-166">Éventuellement, configurez la priorité de sauvegarde de chaque réplica de disponibilité que vous ajoutez ou modifiez.</span><span class="sxs-lookup"><span data-stu-id="00cfb-166">Optionally, configure the backup priority of each availability replica that you are adding or modifying.</span></span> <span data-ttu-id="00cfb-167">Cette priorité est utilisée par l'instance de serveur qui héberge le réplica principal pour décider quel réplica doit traiter une demande de sauvegarde automatique sur une base de données dans le groupe de disponibilité (le réplica avec la priorité la plus élevée est choisi).</span><span class="sxs-lookup"><span data-stu-id="00cfb-167">This priority is used by the server instance that hosts the primary replica to decide which replica should service an automated backup request on a database in the availability group (the replica with highest priority is chosen).</span></span> <span data-ttu-id="00cfb-168">Cette priorité peut être tout nombre compris entre 0 et 100 (inclus).</span><span class="sxs-lookup"><span data-stu-id="00cfb-168">This priority can be any number between 0 and 100, inclusive.</span></span> <span data-ttu-id="00cfb-169">Une priorité de 0 indique que le réplica ne doit pas être considéré comme candidat pour le traitement des demandes de sauvegarde.</span><span class="sxs-lookup"><span data-stu-id="00cfb-169">A priority of 0 indicates that the replica should not be considered as a candidate for servicing backup requests.</span></span>  <span data-ttu-id="00cfb-170">La valeur par défaut est 50.</span><span class="sxs-lookup"><span data-stu-id="00cfb-170">The default setting is 50.</span></span>  
  
     <span data-ttu-id="00cfb-171">Lorsque vous ajoutez un réplica de disponibilité à un groupe de disponibilité, utilisez l'applet de commande `New-SqlAvailabilityReplica`.</span><span class="sxs-lookup"><span data-stu-id="00cfb-171">When adding an availability replica to an availability group, use the `New-SqlAvailabilityReplica` cmdlet.</span></span> <span data-ttu-id="00cfb-172">Lorsque vous modifiez un réplica de disponibilité existant, utilisez l'applet de commande `Set-SqlAvailabilityReplica`.</span><span class="sxs-lookup"><span data-stu-id="00cfb-172">When modifying an existing availability replica, use the `Set-SqlAvailabilityReplica` cmdlet.</span></span> <span data-ttu-id="00cfb-173">Dans les deux cas, spécifiez le `BackupPriority` paramètre *n* , où *n* est une valeur comprise entre 0 et 100.</span><span class="sxs-lookup"><span data-stu-id="00cfb-173">In either case, specify the `BackupPriority`*n* parameter, where *n* is a value from 0 to 100.</span></span>  
  
     <span data-ttu-id="00cfb-174">Par exemple, la commande suivante définit la priorité de sauvegarde du réplica de disponibilité `MyReplica` à `60`.</span><span class="sxs-lookup"><span data-stu-id="00cfb-174">For example, the following command sets the backup priority of the availability replica `MyReplica` to `60`.</span></span>  
  
    ```powershell
    Set-SqlAvailabilityReplica -BackupPriority 60 -Path SQLSERVER:\Sql\Computer\Instance\AvailabilityGroups\MyAg\AvailabilityReplicas\MyReplica  
    ```  
  
3.  <span data-ttu-id="00cfb-175">Éventuellement, configurez la préférence de sauvegarde automatique pour le groupe de disponibilité que vous créez ou modifiez.</span><span class="sxs-lookup"><span data-stu-id="00cfb-175">Optionally, configure the automated backup preference for the availability group that you are creating  or modifying.</span></span> <span data-ttu-id="00cfb-176">Cette préférence indique la manière dont un travail de sauvegarde doit évaluer le réplica principal lorsqu'on choisit où effectuer des sauvegardes.</span><span class="sxs-lookup"><span data-stu-id="00cfb-176">This preference indicates how a backup job should evaluate the primary replica when choosing where to perform backups.</span></span> <span data-ttu-id="00cfb-177">Le paramètre par défaut est de préférer les réplicas secondaires.</span><span class="sxs-lookup"><span data-stu-id="00cfb-177">The default setting is to prefer secondary replicas.</span></span>  
  
     <span data-ttu-id="00cfb-178">Lors de la création d'un groupe de disponibilité, utilisez l'applet de commande `New-SqlAvailabilityGroup`.</span><span class="sxs-lookup"><span data-stu-id="00cfb-178">When creating an availability group, use the `New-SqlAvailabilityGroup` cmdlet.</span></span> <span data-ttu-id="00cfb-179">Lorsque vous modifiez un groupe de disponibilité existant, utilisez l'applet de commande `Set-SqlAvailabilityGroup`.</span><span class="sxs-lookup"><span data-stu-id="00cfb-179">When modifying an existing availability group, use the `Set-SqlAvailabilityGroup` cmdlet.</span></span> <span data-ttu-id="00cfb-180">Dans les deux cas, spécifiez le paramètre `AutomatedBackupPreference`.</span><span class="sxs-lookup"><span data-stu-id="00cfb-180">In either case, specify the `AutomatedBackupPreference` parameter.</span></span>  
  
     <span data-ttu-id="00cfb-181">où :</span><span class="sxs-lookup"><span data-stu-id="00cfb-181">where,</span></span>  
  
     `Primary`  
     <span data-ttu-id="00cfb-182">Spécifie que les sauvegardes doivent toujours avoir lieu sur le réplica principal.</span><span class="sxs-lookup"><span data-stu-id="00cfb-182">Specifies that the backups should always occur on the primary replica.</span></span> <span data-ttu-id="00cfb-183">Cette option est utile si vous avez besoin de fonctionnalités de sauvegarde, telles que la création de sauvegardes différentielles, qui ne sont pas prises en charge lorsque la sauvegarde est exécutée sur un réplica secondaire.</span><span class="sxs-lookup"><span data-stu-id="00cfb-183">This option is useful if you need backup features, such as creating differential backups, that are not supported when backup is run on a secondary replica.</span></span>  
  
    > [!IMPORTANT]  
    >  <span data-ttu-id="00cfb-184">Si vous envisagez d'utiliser la copie de journaux de transaction pour préparer des bases de données secondaires pour un groupe de disponibilité, définissez la préférence de sauvegarde automatique sur `Primary` jusqu'à ce que toutes les bases de données secondaires aient été préparées et attachées au groupe de disponibilité.</span><span class="sxs-lookup"><span data-stu-id="00cfb-184">If you plan to use log shipping to prepare any secondary databases for an availability group, set the automated backup preference to `Primary` until all the secondary databases have been prepared and joined to the availability group.</span></span>  
  
     `SecondaryOnly`  
     <span data-ttu-id="00cfb-185">Spécifie que les sauvegardes ne doivent jamais être effectuées sur le réplica principal.</span><span class="sxs-lookup"><span data-stu-id="00cfb-185">Specifies that backups should never be performed on the primary replica.</span></span> <span data-ttu-id="00cfb-186">Si le réplica principal est le seul réplica en ligne, la sauvegarde ne doit pas avoir lieu.</span><span class="sxs-lookup"><span data-stu-id="00cfb-186">If the primary replica is the only replica online, the backup should not occur.</span></span>  
  
     `Secondary`  
     <span data-ttu-id="00cfb-187">Spécifie que les sauvegardes doivent se produire sur un réplica secondaire sauf lorsque le réplica principal est le seul réplica en ligne.</span><span class="sxs-lookup"><span data-stu-id="00cfb-187">Specifies that backups should occur on a secondary replica except when the primary replica is the only replica online.</span></span> <span data-ttu-id="00cfb-188">Dans ce cas, la sauvegarde doit se produire sur le réplica principal.</span><span class="sxs-lookup"><span data-stu-id="00cfb-188">In that case, the backup should occur on the primary replica.</span></span> <span data-ttu-id="00cfb-189">Il s'agit du comportement par défaut.</span><span class="sxs-lookup"><span data-stu-id="00cfb-189">This is the default behavior.</span></span>  
  
     `None`  
     <span data-ttu-id="00cfb-190">Spécifie que vous préférez que les travaux de sauvegarde ignorent le rôle des réplicas de disponibilité lorsque vous choisissez le réplica pour effectuer les sauvegardes.</span><span class="sxs-lookup"><span data-stu-id="00cfb-190">Specifies that you prefer that backup jobs ignore the role of the availability replicas when choosing the replica to perform backups.</span></span> <span data-ttu-id="00cfb-191">Notez que les travaux de sauvegarde peuvent évaluer d'autres facteurs tels que la priorité de sauvegarde de chaque réplica de disponibilité en association avec son état opérationnel et son état connecté.</span><span class="sxs-lookup"><span data-stu-id="00cfb-191">Note backup jobs might evaluate other factors such as backup priority of each availability replica in combination with its operational state and  connected state.</span></span>  
  
    > [!IMPORTANT]  
    >  <span data-ttu-id="00cfb-192">Aucune application de `AutomatedBackupPreference`.</span><span class="sxs-lookup"><span data-stu-id="00cfb-192">There is no enforcement of `AutomatedBackupPreference`.</span></span> <span data-ttu-id="00cfb-193">La traduction de cette préférence dépend de la logique, le cas échéant, que vous avez écrite dans les travaux de sauvegarde pour les bases de données dans un groupe de disponibilité donné.</span><span class="sxs-lookup"><span data-stu-id="00cfb-193">The interpretation of this preference depends on the logic, if any, that you script into backup jobs for the databases in a given availability group.</span></span> <span data-ttu-id="00cfb-194">Le paramètre de préférence de sauvegarde automatisée n'a aucun impact sur les sauvegardes ad-hoc.</span><span class="sxs-lookup"><span data-stu-id="00cfb-194">The automated backup preference setting has no impact on ad-hoc backups.</span></span> <span data-ttu-id="00cfb-195">Pour plus d’informations, consultez [suivi : après avoir configuré la sauvegarde sur les réplicas secondaires](#FollowUp) , plus loin dans cette rubrique.</span><span class="sxs-lookup"><span data-stu-id="00cfb-195">For more information, see [Follow Up: After Configuring Backup on Secondary Replicas](#FollowUp) later in this topic.</span></span>  
  
     <span data-ttu-id="00cfb-196">Par exemple, la commande suivante définit la propriété `AutomatedBackupPreference` sur le groupe de disponibilité `MyAg` à `SecondaryOnly`.</span><span class="sxs-lookup"><span data-stu-id="00cfb-196">For example, the following command sets the `AutomatedBackupPreference` property on the availability group `MyAg` to `SecondaryOnly`.</span></span> <span data-ttu-id="00cfb-197">Les sauvegardes automatiques des bases de données dans ce groupe de disponibilité ne se produiront jamais sur le réplica principal, mais seront redirigées vers le réplica secondaire avec la priorité de sauvegarde la plus élevée.</span><span class="sxs-lookup"><span data-stu-id="00cfb-197">Automated backups of databases in this availability group will never occur on the primary replica, but will be redirected to the secondary replica with the highest backup priority setting.</span></span>  
  
    ```powershell
    Set-SqlAvailabilityGroup -Path SQLSERVER:\Sql\PrimaryServer\InstanceName\AvailabilityGroups\MyAg `  
     -AutomatedBackupPreference SecondaryOnly  
    ```  
  
> [!NOTE]  
>  <span data-ttu-id="00cfb-198">Pour afficher la syntaxe d'une applet de commande, utilisez l'applet de commande `Get-Help` dans l'environnement [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] PowerShell.</span><span class="sxs-lookup"><span data-stu-id="00cfb-198">To view the syntax of a cmdlet, use the `Get-Help` cmdlet in the [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] PowerShell environment.</span></span> <span data-ttu-id="00cfb-199">Pour en savoir plus, voir [Get Help SQL Server PowerShell](../../../powershell/sql-server-powershell.md).</span><span class="sxs-lookup"><span data-stu-id="00cfb-199">For more information, see [Get Help SQL Server PowerShell](../../../powershell/sql-server-powershell.md).</span></span>  
  
<span data-ttu-id="00cfb-200">Pour configurer et utiliser le fournisseur de SQL Server PowerShell, consultez [SQL Server PowerShell fournisseur](../../../powershell/sql-server-powershell-provider.md) et [obtenir de l’aide SQL Server PowerShell](../../../powershell/sql-server-powershell.md).</span><span class="sxs-lookup"><span data-stu-id="00cfb-200">To set up and use the SQL Server PowerShell provider, see [SQL Server PowerShell Provider](../../../powershell/sql-server-powershell-provider.md) and [Get Help SQL Server PowerShell](../../../powershell/sql-server-powershell.md).</span></span>
  
##  <a name="follow-up-after-configuring-backup-on-secondary-replicas"></a><a name="FollowUp"></a><span data-ttu-id="00cfb-201">Suivi : après la configuration de la sauvegarde sur les réplicas secondaires</span><span class="sxs-lookup"><span data-stu-id="00cfb-201">Follow Up: After Configuring Backup on Secondary Replicas</span></span>  
 <span data-ttu-id="00cfb-202">Pour prendre en compte la préférence de sauvegarde automatisée pour un groupe de disponibilité donné, sur chaque instance de serveur qui héberge un réplica de disponibilité dont la priorité de sauvegarde est supérieure à zéro (>0), vous avez besoin de créer un script pour les travaux de sauvegarde des bases de données du groupe de disponibilité.</span><span class="sxs-lookup"><span data-stu-id="00cfb-202">To take the automated backup preference into account for a given availability group, on each server instance that hosts an availability replica whose backup priority is greater than zero (>0), you need to script backup jobs for the databases in the availability group.</span></span> <span data-ttu-id="00cfb-203">Pour déterminer si le réplica actuel est le réplica de sauvegarde par défaut, utilisez la fonction [sys.fn_hadr_backup_is_preferred_replica](/sql/relational-databases/system-functions/sys-fn-hadr-backup-is-preferred-replica-transact-sql) dans votre script de sauvegarde.</span><span class="sxs-lookup"><span data-stu-id="00cfb-203">To determine whether the current replica is the preferred backup replica, use the [sys.fn_hadr_backup_is_preferred_replica](/sql/relational-databases/system-functions/sys-fn-hadr-backup-is-preferred-replica-transact-sql) function in your backup script.</span></span> <span data-ttu-id="00cfb-204">Si le réplica de disponibilité hébergé par l'instance de serveur actuelle est le réplica par défaut des sauvegardes, cette fonction retourne la valeur 1.</span><span class="sxs-lookup"><span data-stu-id="00cfb-204">If the availability replica that is hosted by the current server instance is the preferred replica for backups, this function returns 1.</span></span> <span data-ttu-id="00cfb-205">Dans le cas contraire, la fonction retourne la valeur 0.</span><span class="sxs-lookup"><span data-stu-id="00cfb-205">If not, the function returns 0.</span></span> <span data-ttu-id="00cfb-206">En exécutant un simple script sur chaque réplica de disponibilité qui interroge cette fonction, vous pouvez déterminer quel réplica doit exécuter un travail de sauvegarde donné.</span><span class="sxs-lookup"><span data-stu-id="00cfb-206">By running a simple script on each availability replica that queries this function, you can determine which replica should run a given backup job.</span></span> <span data-ttu-id="00cfb-207">Par exemple, un extrait de code classique d'un script de travail de sauvegarde se présenterait comme suit :</span><span class="sxs-lookup"><span data-stu-id="00cfb-207">For example, a typical snippet of a backup-job script would look like:</span></span>  
  
```  
IF (NOT sys.fn_hadr_backup_is_preferred_replica(@DBNAME))  
BEGIN  
      Select 'This is not the preferred replica, exiting with success';  
      RETURN 0 - This is a normal, expected condition, so the script returns success  
END  
BACKUP DATABASE @DBNAME TO DISK=<disk>  
   WITH COPY_ONLY;  
```  
  
 <span data-ttu-id="00cfb-208">L'écriture d'un script de travail de sauvegarde à l'aide de cette logique vous permet de planifier le travail à exécuter sur chaque réplica de disponibilité sur la même planification.</span><span class="sxs-lookup"><span data-stu-id="00cfb-208">Scripting a backup job with this logic enables you to schedule the job to run on every availability replica on the same schedule.</span></span> <span data-ttu-id="00cfb-209">Chacun de ces travaux recherche les mêmes données pour déterminer quel est le travail à exécuter, de sorte qu'un seul des travaux planifiés passe à l'étape de sauvegarde.</span><span class="sxs-lookup"><span data-stu-id="00cfb-209">Each of these jobs looks at the same data to determine which job should run, so only one of the scheduled job actually proceeds to the backup stage.</span></span>  <span data-ttu-id="00cfb-210">En cas de basculement, aucun des scripts ou des travaux ne doit être modifié.</span><span class="sxs-lookup"><span data-stu-id="00cfb-210">In the event of a failover, none of the scripts or jobs needs to be modified.</span></span> <span data-ttu-id="00cfb-211">De plus, si vous reconfigurez un groupe de disponibilité afin d'ajouter un réplica de disponibilité, la gestion du travail de sauvegarde nécessite simplement la copie ou la planification du travail de sauvegarde.</span><span class="sxs-lookup"><span data-stu-id="00cfb-211">Also, if you reconfigure an availability group to add an availability replica, managing the backup job requires simply copying or scheduling the backup job.</span></span> <span data-ttu-id="00cfb-212">Si vous supprimez un réplica de disponibilité, supprimez simplement le travail de sauvegarde de l'instance de serveur qui a hébergé ce réplica.</span><span class="sxs-lookup"><span data-stu-id="00cfb-212">If you remove an availability replica, simply delete the backup job from the server instance that hosted that replica.</span></span>  
  
> [!TIP]  
>  <span data-ttu-id="00cfb-213">Si vous utilisez l’[Assistant Plan de maintenance](../../../relational-databases/maintenance-plans/use-the-maintenance-plan-wizard.md)pour créer un travail de sauvegarde donné, le travail inclut automatiquement la logique de script qui appelle et vérifie la fonction **sys.fn_hadr_backup_is_preferred_replica** .</span><span class="sxs-lookup"><span data-stu-id="00cfb-213">If you use the[Maintenance Plan Wizard](../../../relational-databases/maintenance-plans/use-the-maintenance-plan-wizard.md)to create a given backup job, the job will automatically include the scripting logic that calls and checks the **sys.fn_hadr_backup_is_preferred_replica** function.</span></span> <span data-ttu-id="00cfb-214">Cependant, le travail de sauvegarde ne va pas retourner le message indiquant qu’il ne s’agit pas du réplica par défaut. Veillez donc à créer le ou les travaux pour chaque base de données de disponibilité sur chacune des instances de serveur qui hébergent un réplica de disponibilité pour le groupe de disponibilité.</span><span class="sxs-lookup"><span data-stu-id="00cfb-214">However, the backup job will not return the "This is not the preferred replica..." message.Be sure to create the job(s) for each availability database on every server instance that hosts an availability replica for the availability group.</span></span>  
  
##  <a name="to-obtain-information-about-backup-preference-settings"></a><a name="ForInfoAboutBuPref"></a><span data-ttu-id="00cfb-215">Pour obtenir des informations sur les paramètres de préférence de sauvegarde</span><span class="sxs-lookup"><span data-stu-id="00cfb-215">To Obtain Information About Backup Preference Settings</span></span>  
 <span data-ttu-id="00cfb-216">Voici des ressources utiles pour obtenir des informations pertinentes sur la sauvegarde de réplicas secondaires.</span><span class="sxs-lookup"><span data-stu-id="00cfb-216">The following are useful for obtaining information that is relevant for backup on secondary.</span></span>  
  
|<span data-ttu-id="00cfb-217">Affichage</span><span class="sxs-lookup"><span data-stu-id="00cfb-217">View</span></span>|<span data-ttu-id="00cfb-218">Informations</span><span class="sxs-lookup"><span data-stu-id="00cfb-218">Information</span></span>|<span data-ttu-id="00cfb-219">Colonnes appropriées</span><span class="sxs-lookup"><span data-stu-id="00cfb-219">Relevant Columns</span></span>|  
|----------|-----------------|----------------------|  
|[<span data-ttu-id="00cfb-220">sys.fn_hadr_backup_is_preferred_replica</span><span class="sxs-lookup"><span data-stu-id="00cfb-220">sys.fn_hadr_backup_is_preferred_replica</span></span>](/sql/relational-databases/system-functions/sys-fn-hadr-backup-is-preferred-replica-transact-sql)|<span data-ttu-id="00cfb-221">Le réplica actuel est-il le réplica de sauvegarde par défaut ?</span><span class="sxs-lookup"><span data-stu-id="00cfb-221">Is the current replica the preferred backup replica?</span></span>|<span data-ttu-id="00cfb-222">Non applicable.</span><span class="sxs-lookup"><span data-stu-id="00cfb-222">Not applicable.</span></span>|  
|[<span data-ttu-id="00cfb-223">sys.availability_groups</span><span class="sxs-lookup"><span data-stu-id="00cfb-223">sys.availability_groups</span></span>](/sql/relational-databases/system-catalog-views/sys-availability-groups-transact-sql)|<span data-ttu-id="00cfb-224">préférence de sauvegarde automatisée</span><span class="sxs-lookup"><span data-stu-id="00cfb-224">Automated backup preference</span></span>|<span data-ttu-id="00cfb-225">**automated_backup_preference**</span><span class="sxs-lookup"><span data-stu-id="00cfb-225">**automated_backup_preference**</span></span><br /><br /> <span data-ttu-id="00cfb-226">**automated_backup_preference_desc**</span><span class="sxs-lookup"><span data-stu-id="00cfb-226">**automated_backup_preference_desc**</span></span>|  
|[<span data-ttu-id="00cfb-227">sys.availability_replicas</span><span class="sxs-lookup"><span data-stu-id="00cfb-227">sys.availability_replicas</span></span>](/sql/relational-databases/system-catalog-views/sys-availability-replicas-transact-sql)|<span data-ttu-id="00cfb-228">Priorité de sauvegarde d'un réplica de disponibilité donné</span><span class="sxs-lookup"><span data-stu-id="00cfb-228">Backup priority of a given availability replica</span></span>|<span data-ttu-id="00cfb-229">**backup_priority**</span><span class="sxs-lookup"><span data-stu-id="00cfb-229">**backup_priority**</span></span>|  
|[<span data-ttu-id="00cfb-230">sys.dm_hadr_availability_replica_states</span><span class="sxs-lookup"><span data-stu-id="00cfb-230">sys.dm_hadr_availability_replica_states</span></span>](/sql/relational-databases/system-dynamic-management-views/sys-dm-hadr-availability-replica-states-transact-sql)|<span data-ttu-id="00cfb-231">Le réplica est-il locale sur l'instance de serveur ?</span><span class="sxs-lookup"><span data-stu-id="00cfb-231">Is replica local to the server instance?</span></span><br /><br /> <span data-ttu-id="00cfb-232">Rôle actuel</span><span class="sxs-lookup"><span data-stu-id="00cfb-232">Current role</span></span><br /><br /> <span data-ttu-id="00cfb-233">État opérationnel</span><span class="sxs-lookup"><span data-stu-id="00cfb-233">Operational state</span></span><br /><br /> <span data-ttu-id="00cfb-234">Étata connecté</span><span class="sxs-lookup"><span data-stu-id="00cfb-234">Connected state</span></span><br /><br /> <span data-ttu-id="00cfb-235">Intégrité de synchronisation d'un réplica de disponibilité</span><span class="sxs-lookup"><span data-stu-id="00cfb-235">Synchronization health of an availability replica</span></span>|<span data-ttu-id="00cfb-236">**is_local**</span><span class="sxs-lookup"><span data-stu-id="00cfb-236">**is_local**</span></span><br /><br /> <span data-ttu-id="00cfb-237">**role**, **role_desc**</span><span class="sxs-lookup"><span data-stu-id="00cfb-237">**role**, **role_desc**</span></span><br /><br /> <span data-ttu-id="00cfb-238">**operational_state**, **operational_state_desc**</span><span class="sxs-lookup"><span data-stu-id="00cfb-238">**operational_state**, **operational_state_desc**</span></span><br /><br /> <span data-ttu-id="00cfb-239">**connected_state**, **connected_state_desc**</span><span class="sxs-lookup"><span data-stu-id="00cfb-239">**connected_state**, **connected_state_desc**</span></span><br /><br /> <span data-ttu-id="00cfb-240">**synchronization_health**, **synchronization_health_desc**</span><span class="sxs-lookup"><span data-stu-id="00cfb-240">**synchronization_health**, **synchronization_health_desc**</span></span>|  
  
##  <a name="related-content"></a><a name="RelatedContent"></a> <span data-ttu-id="00cfb-241">Contenu associé</span><span class="sxs-lookup"><span data-stu-id="00cfb-241">Related Content</span></span>  
  
-   [<span data-ttu-id="00cfb-242">Guide de solutions Microsoft SQL Server AlwaysOn pour la haute disponibilité et la récupération d'urgence</span><span class="sxs-lookup"><span data-stu-id="00cfb-242">Microsoft SQL Server AlwaysOn Solutions Guide for High Availability and Disaster Recovery</span></span>](https://go.microsoft.com/fwlink/?LinkId=227600)  
  
-   [<span data-ttu-id="00cfb-243">Blog de l'équipe de SQL Server AlwaysOn : Blog officiel de l'équipe de SQL Server AlwaysOn</span><span class="sxs-lookup"><span data-stu-id="00cfb-243">SQL Server AlwaysOn Team Blog: The official SQL Server AlwaysOn Team Blog</span></span>](https://blogs.msdn.com/b/sqlalwayson/)  
  
## <a name="see-also"></a><span data-ttu-id="00cfb-244">Voir aussi</span><span class="sxs-lookup"><span data-stu-id="00cfb-244">See Also</span></span>  
 <span data-ttu-id="00cfb-245">[Vue d’ensemble de groupes de disponibilité AlwaysOn &#40;SQL Server&#41;](overview-of-always-on-availability-groups-sql-server.md) </span><span class="sxs-lookup"><span data-stu-id="00cfb-245">[Overview of AlwaysOn Availability Groups &#40;SQL Server&#41;](overview-of-always-on-availability-groups-sql-server.md) </span></span>  
 [<span data-ttu-id="00cfb-246">Secondaires actifs : sauvegarde sur les réplicas secondaires (groupes de disponibilité d'AlwaysOn)</span><span class="sxs-lookup"><span data-stu-id="00cfb-246">Active Secondaries: Backup on Secondary Replicas (AlwaysOn Availability Groups)</span></span>](active-secondaries-backup-on-secondary-replicas-always-on-availability-groups.md) 
