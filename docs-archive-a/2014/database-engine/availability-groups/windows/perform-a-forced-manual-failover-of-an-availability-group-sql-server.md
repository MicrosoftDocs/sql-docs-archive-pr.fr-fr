---
title: Effectuer un basculement forcé manuel d'un groupe de disponibilité (SQL Server) | Microsoft Docs
ms.custom: ''
ms.date: 06/14/2017
ms.prod: sql-server-2014
ms.reviewer: ''
ms.technology: high-availability
ms.topic: conceptual
f1_keywords:
- sql12.swb.availabilitygroup.forcefailover.f1
helpviewer_keywords:
- Availability Groups [SQL Server], failover
- failover [SQL Server], AlwaysOn Availability Groups
ms.assetid: 222288fe-ffc0-4567-b624-5d91485d70f0
author: MashaMSFT
ms.author: mathoma
ms.openlocfilehash: f36908102a09eb1ef1f7a485898da715deb4253b
ms.sourcegitcommit: ad4d92dce894592a259721a1571b1d8736abacdb
ms.translationtype: MT
ms.contentlocale: fr-FR
ms.lasthandoff: 08/04/2020
ms.locfileid: "87604147"
---
# <a name="perform-a-forced-manual-failover-of-an-availability-group-sql-server"></a><span data-ttu-id="d554b-102">Effectuer un basculement manuel forcé d'un groupe de disponibilité (SQL Server)</span><span class="sxs-lookup"><span data-stu-id="d554b-102">Perform a Forced Manual Failover of an Availability Group (SQL Server)</span></span>
  <span data-ttu-id="d554b-103">Cette rubrique explique comment effectuer un basculement forcé (avec perte de données potentielle) sur un groupe de disponibilité AlwaysOn à l'aide de [!INCLUDE[ssManStudioFull](../../../includes/ssmanstudiofull-md.md)], [!INCLUDE[tsql](../../../includes/tsql-md.md)]ou de PowerShell dans [!INCLUDE[ssCurrent](../../../includes/sscurrent-md.md)].</span><span class="sxs-lookup"><span data-stu-id="d554b-103">This topic describes how to perform a forced failover (with possible data loss) on an AlwaysOn availability group by using [!INCLUDE[ssManStudioFull](../../../includes/ssmanstudiofull-md.md)], [!INCLUDE[tsql](../../../includes/tsql-md.md)], or PowerShell in [!INCLUDE[ssCurrent](../../../includes/sscurrent-md.md)].</span></span> <span data-ttu-id="d554b-104">Un basculement forcé est une forme du basculement manuel qui est destiné exclusivement à la récupération d'urgence, lorsqu'un [basculement manuel planifié](perform-a-planned-manual-failover-of-an-availability-group-sql-server.md) n'est pas possible.</span><span class="sxs-lookup"><span data-stu-id="d554b-104">A forced failover is a form of manual failover that is intended strictly for disaster recovery, when a [planned manual failover](perform-a-planned-manual-failover-of-an-availability-group-sql-server.md) is not possible.</span></span> <span data-ttu-id="d554b-105">Si vous forcez le basculement vers un réplica secondaire qui n'est pas synchronisé, une perte de données est possible.</span><span class="sxs-lookup"><span data-stu-id="d554b-105">If you force failover to an unsynchronized secondary replica, some data loss is possible.</span></span> <span data-ttu-id="d554b-106">Par conséquent, nous vous recommandons fortement de forcer le basculement uniquement si vous devez restaurer immédiatement un service dans le groupe de disponibilité et si vous êtes prêt à prendre le risque de perdre des données.</span><span class="sxs-lookup"><span data-stu-id="d554b-106">Therefore, we strongly recommend that you force failover only if you must restore service to the availability group immediately and you are willing to risk losing data.</span></span>  
  
 <span data-ttu-id="d554b-107">Après un basculement forcé, la cible de basculement vers laquelle le groupe de disponibilité a basculé devient le nouveau réplica principal.</span><span class="sxs-lookup"><span data-stu-id="d554b-107">After a forced failover, the failover target to which the availability group was failed over becomes the new primary replica.</span></span> <span data-ttu-id="d554b-108">Les bases de données secondaires dans les réplicas secondaires restants sont suspendues et vous devez les reprendre manuellement.</span><span class="sxs-lookup"><span data-stu-id="d554b-108">The secondary databases in the remaining secondary replicas are suspended and must be manually resumed.</span></span> <span data-ttu-id="d554b-109">Lorsque l'ancien réplica principal devient disponible, il adopte le rôle secondaire, et les anciennes bases de données primaires deviennent les bases de données secondaires et passent à l'état SUSPENDED.</span><span class="sxs-lookup"><span data-stu-id="d554b-109">When the former primary replica becomes available, it transitions to the secondary role, causing the former primary databases to become secondary databases and transition into the SUSPENDED state.</span></span> <span data-ttu-id="d554b-110">Avant de reprendre une base de données secondaire donnée, vous pouvez récupérer les données perdues de celle-ci.</span><span class="sxs-lookup"><span data-stu-id="d554b-110">Before you resume a given secondary database, you might be able to recover lost data from it.</span></span> <span data-ttu-id="d554b-111">Toutefois, notez que la troncation du journal des transactions est retardée sur une base de données primaire donnée, lorsque l'une de ses bases de données secondaires est interrompue.</span><span class="sxs-lookup"><span data-stu-id="d554b-111">However, notice that transaction log truncation is delayed on a given primary database while any of its secondary databases is suspended.</span></span>  
  
> [!IMPORTANT]  
>  <span data-ttu-id="d554b-112">La synchronisation de données avec la base de données primaire n'est pas effectuée tant que la base de données secondaire n'est pas reprise.</span><span class="sxs-lookup"><span data-stu-id="d554b-112">Data synchronization with the primary database will not occur until the secondary database is resumed.</span></span> <span data-ttu-id="d554b-113">Pour plus d’informations sur la reprise d’une base de données secondaire, consultez [Suivi : Tâches essentielles après un basculement forcé](#FollowUp), plus loin dans cet article.</span><span class="sxs-lookup"><span data-stu-id="d554b-113">For information about resuming a secondary database, see [Follow Up: Essential Tasks After a Forced Failover](#FollowUp) later in this article.</span></span>  
  
 <span data-ttu-id="d554b-114">Effectuer un basculement forcé est nécessaire dans les cas d'urgence suivants :</span><span class="sxs-lookup"><span data-stu-id="d554b-114">Performing a forced failover is necessary in the following emergency situations:</span></span>  
  
-   <span data-ttu-id="d554b-115">Après avoir forcé le quorum sur le cluster WSFC (*quorum forcé*), vous devez forcer le basculement de chaque groupe de disponibilité (avec perte de données possible).</span><span class="sxs-lookup"><span data-stu-id="d554b-115">After forcing quorum on the WSFC cluster (*forced quorum*), you need to force failover each availability group (with possible data loss).</span></span> <span data-ttu-id="d554b-116">Le basculement forcé est requis, car l'état réel des valeurs de cluster WSFC peut avoir été perdu.</span><span class="sxs-lookup"><span data-stu-id="d554b-116">Forcing failover is required because the real state of the WSFC cluster values might have been lost.</span></span> <span data-ttu-id="d554b-117">Toutefois, vous pouvez éviter la perte de données, si vous êtes en mesure de forcer le basculement sur l'instance de serveur qui hébergeait un réplica qui était le réplica principal avant d'avoir forcé le quorum ou sur un réplica secondaire qui était synchronisé avant d'avoir forcé le quorum.</span><span class="sxs-lookup"><span data-stu-id="d554b-117">However, you can avoid data loss, if are able to force failover on the server instance that was hosting the replica that was the primary replica before you forced quorum or to a secondary replica that was synchronized before you forced quorum.</span></span> <span data-ttu-id="d554b-118">Pour plus d'informations, consultez [Méthodes possibles pour éviter la perte de données après un quorum forcé](#WaysToAvoidDataLoss), plus loin dans cette rubrique.</span><span class="sxs-lookup"><span data-stu-id="d554b-118">For more information, see [Potential Ways to Avoid Data Loss After Quorum is Forced](#WaysToAvoidDataLoss), later in this topic.</span></span>  
  
    > [!IMPORTANT]  
    >  <span data-ttu-id="d554b-119">Si le quorum est regagné par des moyens naturels au lieu d'être forcé, les réplicas de disponibilité seront récupérés normalement.</span><span class="sxs-lookup"><span data-stu-id="d554b-119">If quorum is regained by natural means instead of being forced, the availability replicas will go through normal recovery.</span></span> <span data-ttu-id="d554b-120">Si le réplica principal reste indisponible une fois le quorum regagné, vous pouvez effectuer un basculement manuel planifié vers un réplica secondaire synchronisé.</span><span class="sxs-lookup"><span data-stu-id="d554b-120">If the primary replica is still unavailable after quorum is regained, you can perform a planned manual failover to a synchronized secondary replica.</span></span>  
  
     <span data-ttu-id="d554b-121">Pour plus d’informations sur le quorum forcé, consultez [Récupération d’urgence WSFC par le quorum forcé &#40;SQL Server&#41;](../../../sql-server/failover-clusters/windows/wsfc-disaster-recovery-through-forced-quorum-sql-server.md).</span><span class="sxs-lookup"><span data-stu-id="d554b-121">For information about forcing quorum, see [WSFC Disaster Recovery through Forced Quorum &#40;SQL Server&#41;](../../../sql-server/failover-clusters/windows/wsfc-disaster-recovery-through-forced-quorum-sql-server.md).</span></span> <span data-ttu-id="d554b-122">Pour découvrir pourquoi le basculement forcé est nécessaire après avoir forcé le quorum, consultez [Basculement et modes de basculement &#40;groupes de disponibilité AlwaysOn&#41;](failover-and-failover-modes-always-on-availability-groups.md).</span><span class="sxs-lookup"><span data-stu-id="d554b-122">For information about why forcing failover is required after forcing quorum, see [Failover and Failover Modes &#40;AlwaysOn Availability Groups&#41;](failover-and-failover-modes-always-on-availability-groups.md).</span></span>  
  
-   <span data-ttu-id="d554b-123">Si le réplica principal devient indisponible lorsque le cluster WSFC possède un quorum sain, vous pouvez forcer le basculement (avec perte de données possible), vers tout réplica dont le rôle est dans l'état SECONDARY ou RESOLVING.</span><span class="sxs-lookup"><span data-stu-id="d554b-123">If the primary replica becomes unavailable when the WSFC cluster has a healthy quorum, you can force failover (with possible data loss), to any replica whose role is in the SECONDARY or RESOLVING state.</span></span> <span data-ttu-id="d554b-124">Si possible, forcez le basculement vers un réplica secondaire avec validation synchrone qui était synchronisé lorsque le réplica principal a été perdu.</span><span class="sxs-lookup"><span data-stu-id="d554b-124">If possible, force failover to a synchronous-commit secondary replica that was synchronized when the primary replica was lost.</span></span>  
  
    > [!TIP]  
    >  <span data-ttu-id="d554b-125">Lorsque le cluster WSFC possède un quorum sain, si vous exécutez une commande de basculement forcé sur un réplica secondaire synchronisé, le réplica effectue un basculement manuel planifié.</span><span class="sxs-lookup"><span data-stu-id="d554b-125">When the WSFC cluster has a healthy quorum, if you issue a force failover command on a synchronized secondary replica, the replica actually performs a planned manual failover.</span></span>  
  
> [!NOTE]  
>  <span data-ttu-id="d554b-126">Pour plus d’informations sur les prérequis et les recommandations pour forcer un basculement et pour obtenir un exemple de scénario qui utilise un basculement forcé pour effectuer une récupération suite à une défaillance catastrophique, consultez [Exemple de scénario : Utilisation d’un basculement forcé pour effectuer une récupération suite à une défaillance catastrophique](perform-a-forced-manual-failover-of-an-availability-group-sql-server.md#ExampleRecoveryFromCatastrophy), plus loin dans cette rubrique.</span><span class="sxs-lookup"><span data-stu-id="d554b-126">For more information about the prerequisites and recommendations for forcing failover and for an example scenario that uses a forced failover to recover from a catastrophic failure, see [Example Scenario: Using a Forced Failover to Recover from a Catastrophic Failure](perform-a-forced-manual-failover-of-an-availability-group-sql-server.md#ExampleRecoveryFromCatastrophy), later in this topic.</span></span>  
  
  
##  <a name="before-you-begin"></a><a name="BeforeYouBegin"></a> <span data-ttu-id="d554b-127">Avant de commencer</span><span class="sxs-lookup"><span data-stu-id="d554b-127">Before You Begin</span></span>  
  
###  <a name="limitations-and-restrictions"></a><a name="Restrictions"></a> <span data-ttu-id="d554b-128">Limitations et restrictions</span><span class="sxs-lookup"><span data-stu-id="d554b-128">Limitations and Restrictions</span></span>  
  
-   <span data-ttu-id="d554b-129">Le seul cas où vous ne pouvez pas effectuer un basculement forcé est lorsque le cluster de clustering de basculement Windows Server (WSFC) ne dispose pas de quorum.</span><span class="sxs-lookup"><span data-stu-id="d554b-129">The only time that you cannot perform a forced failover is when Windows Server Failover Clustering (WSFC) cluster lacks quorum.</span></span>  
  
-   <span data-ttu-id="d554b-130">Une perte de données est possible pendant le basculement forcé d'un groupe de disponibilité.</span><span class="sxs-lookup"><span data-stu-id="d554b-130">Data loss is possible during the forced failover of an availability group.</span></span> <span data-ttu-id="d554b-131">En outre, si le réplica principal s'exécute lorsque vous démarrez un basculement forcé, les clients risquent de toujours être connectés aux bases de données primaires précédentes.</span><span class="sxs-lookup"><span data-stu-id="d554b-131">In addition, if the primary replica is running when you initiate a forced failover, clients might still be connected to former primary databases.</span></span> <span data-ttu-id="d554b-132">Par conséquent, nous vous recommandons vivement de forcer le basculement uniquement si le réplica principal n'est plus exécuté et si vous êtes prêt à prendre le risque de perdre des données afin de restaurer l'accès aux bases de données dans le groupe de disponibilité.</span><span class="sxs-lookup"><span data-stu-id="d554b-132">Therefore, we strongly recommend that you force failover only if the primary replica is no longer running and if you are willing to risk losing data in order to restore access to databases in the availability group.</span></span>  
  
-   <span data-ttu-id="d554b-133">Lorsqu'une base de données secondaire se trouve dans l'état REVERTING ou INITIALIZING, forcer le basculement entraîne l'impossibilité pour la base de données de démarrer en tant que base de données primaire.</span><span class="sxs-lookup"><span data-stu-id="d554b-133">When a secondary database in the REVERTING or INITIALIZING state, forcing failover would cause the database to fail to start as a primary database.</span></span> <span data-ttu-id="d554b-134">Si la base de données se trouvait dans un état INTIAILIZING, vous devez appliquer les enregistrements de journal manquants d'une sauvegarde de base de données ou restaurer entièrement la base de données.</span><span class="sxs-lookup"><span data-stu-id="d554b-134">If the database was in the INTIAILIZGING state the you will need to apply the missing log records from a database backup or fully restore the database from scratch.</span></span> <span data-ttu-id="d554b-135">Si la base de données se trouvait dans un état REVERTING, vous devez restaurer entièrement la base de données à partir de sauvegardes.</span><span class="sxs-lookup"><span data-stu-id="d554b-135">If the database was in the REVERTING state you will need to fully restore the database from backups.</span></span>  
  
-   <span data-ttu-id="d554b-136">Une commande de basculement est retournée dès que la cible de basculement a accepté la commande.</span><span class="sxs-lookup"><span data-stu-id="d554b-136">A failover command returns as soon as the failover target has accepted the command.</span></span> <span data-ttu-id="d554b-137">Toutefois, la récupération de la base de données est asynchrone après que le basculement du groupe de disponibilité est terminé.</span><span class="sxs-lookup"><span data-stu-id="d554b-137">However, database recovery occurs asynchronously after the availability group has finished failing over.</span></span>  
  
-   <span data-ttu-id="d554b-138">La cohérence entre bases de données sur plusieurs bases de données dans le groupe de disponibilité n'est pas conservée lors d'un basculement.</span><span class="sxs-lookup"><span data-stu-id="d554b-138">Cross-database consistency across databases within the availability group is not maintained on failover.</span></span>  
  
    > [!NOTE]  
    >  <span data-ttu-id="d554b-139">Les transactions entre bases de données et les transactions distribuées ne sont pas prises en charge par [!INCLUDE[ssHADR](../../../includes/sshadr-md.md)].</span><span class="sxs-lookup"><span data-stu-id="d554b-139">Cross-database transactions and distributed transactions are not supported by [!INCLUDE[ssHADR](../../../includes/sshadr-md.md)].</span></span> <span data-ttu-id="d554b-140">Pour plus d’informations, consultez [Transactions entre bases de données non prises en charge pour la mise en miroir de bases de données ou les groupes de disponibilité AlwaysOn &#40;SQL Server&#41;](transactions-always-on-availability-and-database-mirroring.md).</span><span class="sxs-lookup"><span data-stu-id="d554b-140">For more information, see [Cross-Database Transactions Not Supported For Database Mirroring or AlwaysOn Availability Groups &#40;SQL Server&#41;](transactions-always-on-availability-and-database-mirroring.md).</span></span>  
  
###  <a name="prerequisites"></a><a name="Prerequisites"></a> <span data-ttu-id="d554b-141">Conditions préalables</span><span class="sxs-lookup"><span data-stu-id="d554b-141">Prerequisites</span></span>  
  
-   <span data-ttu-id="d554b-142">Le cluster WSFC possède un quorum.</span><span class="sxs-lookup"><span data-stu-id="d554b-142">The WSFC cluster has quorum.</span></span> <span data-ttu-id="d554b-143">Si le cluster n’a pas de quorum, consultez [Récupération d’urgence WSFC par le quorum forcé &#40;SQL Server&#41;](../../../sql-server/failover-clusters/windows/wsfc-disaster-recovery-through-forced-quorum-sql-server.md).</span><span class="sxs-lookup"><span data-stu-id="d554b-143">If the cluster lacks quorum, see [WSFC Disaster Recovery through Forced Quorum &#40;SQL Server&#41;](../../../sql-server/failover-clusters/windows/wsfc-disaster-recovery-through-forced-quorum-sql-server.md).</span></span>  
  
-   <span data-ttu-id="d554b-144">Vous devez être en mesure de vous connecter à une instance de serveur qui héberge un réplica dont le rôle se trouve dans l'état SECONDARY ou RESOLVING.</span><span class="sxs-lookup"><span data-stu-id="d554b-144">You must be able to connect to a server instance that hosts a replica whose role is in the SECONDARY or RESOLVING state.</span></span>  
  
###  <a name="recommendations"></a><a name="Recommendations"></a> <span data-ttu-id="d554b-145">Recommandations</span><span class="sxs-lookup"><span data-stu-id="d554b-145">Recommendations</span></span>  
  
-   <span data-ttu-id="d554b-146">Ne forcez pas le basculement lorsque le réplica principal est toujours en cours d'exécution.</span><span class="sxs-lookup"><span data-stu-id="d554b-146">Do not force failover while the primary replica is still running.</span></span>  
  
-   <span data-ttu-id="d554b-147">Si possible, forcez le basculement uniquement vers une cible de basculement dont les bases de données secondaires se trouvent dans l'état NOT SYNCHRONIZED, SYNCHRONIZED ou SYNCHRONIZING.</span><span class="sxs-lookup"><span data-stu-id="d554b-147">If possible, force failover only to a failover target whose secondary databases are either in the NOT SYNCHRONIZED, SYNCHRONIZED, or SYNCHRONIZING state.</span></span> <span data-ttu-id="d554b-148">Pour plus d'informations sur les conséquences d'un basculement forcé lorsqu'une base de données secondaire se trouve dans l'état INTIAILIZGING ou REVERTING, consultez [Limitations et restrictions](#Restrictions), plus haut dans cette rubrique.</span><span class="sxs-lookup"><span data-stu-id="d554b-148">For information about the implications of forcing failover when a secondary database is in the INTIAILIZGING or REVERTING state, see [Limitations and Restrictions](#Restrictions), earlier in this topic.</span></span>  
  
-   <span data-ttu-id="d554b-149">En général, la latence d'une base de données secondaire donnée, par rapport à la base de données primaire, doit être similaire sur les différents réplicas secondaires de validation asynchrone.</span><span class="sxs-lookup"><span data-stu-id="d554b-149">Typically, the latency of a given secondary database, relative to the primary database, should be similar on different asynchronous-commit secondary replicas.</span></span> <span data-ttu-id="d554b-150">Toutefois, lors d'un basculement forcé, une perte de données peut constituer un souci majeur.</span><span class="sxs-lookup"><span data-stu-id="d554b-150">However, when forcing failover, data loss can be a significant concern.</span></span> <span data-ttu-id="d554b-151">Par conséquent, prenez le temps de déterminer la latence relative des copies des bases de données sur les différents réplicas secondaires.</span><span class="sxs-lookup"><span data-stu-id="d554b-151">Therefore, consider taking time to determine the relative latency of the copies of the databases on different secondary replicas.</span></span> <span data-ttu-id="d554b-152">Pour déterminer quelle copie d'une base de données secondaire donnée présente la latence la plus faible, comparez leurs numéros séquentiels LSN de fin de journal.</span><span class="sxs-lookup"><span data-stu-id="d554b-152">To determine which copy of a given secondary database has the least latency, compare their end-of-log LSNs.</span></span> <span data-ttu-id="d554b-153">Plus ce numéro LSN de fin de journal est élevé, plus la latence est faible.</span><span class="sxs-lookup"><span data-stu-id="d554b-153">A higher the end-of-log LSN indicates less latency.</span></span>  
  
    > [!TIP]  
    >  <span data-ttu-id="d554b-154">Pour comparer des LSN de fin de journal, connectez-vous, à tour de rôle, à chacun des réplicas secondaires en ligne et interrogez [sys.dm_hadr_database_replica_states](/sql/relational-databases/system-dynamic-management-views/sys-dm-hadr-database-replica-states-transact-sql) pour connaître la valeur **end_of_log_lsn** de chaque base de données secondaire locale.</span><span class="sxs-lookup"><span data-stu-id="d554b-154">To compare end-of-log LSNs, connect to each online secondary replica, in turn, and query [sys.dm_hadr_database_replica_states](/sql/relational-databases/system-dynamic-management-views/sys-dm-hadr-database-replica-states-transact-sql) for the **end_of_log_lsn** value of each local secondary database.</span></span> <span data-ttu-id="d554b-155">Puis, comparez les numéros séquentiels LSN de fin de journal des différentes copies de chaque base de données.</span><span class="sxs-lookup"><span data-stu-id="d554b-155">Then, compare the end-of-log LSNs of the different copies of each database.</span></span> <span data-ttu-id="d554b-156">Notez que les différentes bases de données peuvent avoir leur plus haut numéro séquentiel LSN sur différents réplicas secondaires.</span><span class="sxs-lookup"><span data-stu-id="d554b-156">Note that different databases might have their highest LSNs on different secondary replicas.</span></span> <span data-ttu-id="d554b-157">Dans ce cas, la cible de basculement la plus appropriée dépend de l'importance relative que vous accordez aux données dans les différentes bases de données.</span><span class="sxs-lookup"><span data-stu-id="d554b-157">In this case, the most appropriate failover target depends on the relative importance that you place on the data in the different databases.</span></span> <span data-ttu-id="d554b-158">Autrement dit, pour quelle base de données souhaitez-vous minimiser la possible perte de données ?</span><span class="sxs-lookup"><span data-stu-id="d554b-158">That is, for which of these databases would you most want to minimize possible data loss?</span></span>  
  
-   <span data-ttu-id="d554b-159">Si les clients peuvent se connecter au réplica principal d'origine, un basculement forcé entraîne un risque de comportement de fractionnement des partitions.</span><span class="sxs-lookup"><span data-stu-id="d554b-159">If clients are able to connect to the original primary, a forced failover incurs some risk of split brain behavior.</span></span> <span data-ttu-id="d554b-160">Avant de forcer le basculement, nous vous recommandons fortement d'empêcher les clients d'accéder au réplica principal d'origine.</span><span class="sxs-lookup"><span data-stu-id="d554b-160">Before you force failover, we strongly recommend that you prevent clients from accessing the original primary replica.</span></span> <span data-ttu-id="d554b-161">Autrement, une fois le basculement forcé, les bases de données primaires d'origine et les bases de données primaires actuelles risquent d'être mises à jour indépendamment les unes des autres.</span><span class="sxs-lookup"><span data-stu-id="d554b-161">Otherwise, after failover is forced, the original primary databases and the current primary databases could be updated independently of the other.</span></span>  
  
###  <a name="potential-ways-to-avoid-data-loss-after-quorum-is-forced"></a><a name="WaysToAvoidDataLoss"></a> <span data-ttu-id="d554b-162">Méthodes possibles pour éviter la perte de données après un quorum forcé</span><span class="sxs-lookup"><span data-stu-id="d554b-162">Potential Ways to Avoid Data Loss After Quorum is Forced</span></span>  
 <span data-ttu-id="d554b-163">Dans certaines conditions d'échec après la perte du quorum, vous pouvez empêcher la perte de données, comme suit :</span><span class="sxs-lookup"><span data-stu-id="d554b-163">Under some failure conditions after quorum is lost, you can avoid prevent data loss, as follows:</span></span>  
  
-   <span data-ttu-id="d554b-164">**Si le réplica principal d'origine est mis en ligne**</span><span class="sxs-lookup"><span data-stu-id="d554b-164">**If the original primary replica comes online**</span></span>  
  
     <span data-ttu-id="d554b-165">Si le quorum est perdu et l'application forcée d'un quorum WSFC restaure le nœud de cluster qui héberge le réplica principal d'un groupe de disponibilité, vous pouvez empêcher la perte de données de ce groupe de disponibilité.</span><span class="sxs-lookup"><span data-stu-id="d554b-165">If quorum is lost and forcing WSFC quorum restores the cluster node that hosts the primary replica of an availability group, you can prevent data loss for this availability group.</span></span> <span data-ttu-id="d554b-166">Connectez-vous au réplica principal et effectuez un basculement forcé (FAILOVER_ALLOW_DATA_LOSS).</span><span class="sxs-lookup"><span data-stu-id="d554b-166">Connect to the primary replica and perform a forced failover (FAILOVER_ALLOW_DATA_LOSS).</span></span> <span data-ttu-id="d554b-167">Cela remet le réplica principal en ligne.</span><span class="sxs-lookup"><span data-stu-id="d554b-167">This brings the primary replica back online.</span></span> <span data-ttu-id="d554b-168">Étant donné que vous effectuez le basculement forcé vers le réplica principal d'origine, il n'y a aucune perte de données.</span><span class="sxs-lookup"><span data-stu-id="d554b-168">Because you perform the forced failover to the original primary replica, there is no data loss.</span></span>  
  
-   <span data-ttu-id="d554b-169">**Si un réplica secondaire synchronisé avec validation synchrone est mis en ligne**</span><span class="sxs-lookup"><span data-stu-id="d554b-169">**If a synchronized synchronous-commit secondary replica comes online**</span></span>  
  
     <span data-ttu-id="d554b-170">Si le quorum est perdu et l'application forcée d'un quorum WSFC restaure un nœud de cluster qui héberge un réplica secondaire synchronisé d'un groupe de disponibilité, vous serez à même d'empêcher la perte de données de ce groupe de disponibilité.</span><span class="sxs-lookup"><span data-stu-id="d554b-170">If quorum is lost and forcing WSFC quorum restores a cluster node that hosts a synchronized secondary replica for an availability group, you should be able to prevent data loss for this availability group.</span></span> <span data-ttu-id="d554b-171">Si le nœud restauré était activé lors de la perte du quorum, vous pouvez déterminer si la perte de données a pu se produire sur une base de données en interrogeant la colonne **is_failover_ready** de la vue de gestion dynamique [sys.dm_hadr_database_replica_cluster_states](/sql/relational-databases/system-dynamic-management-views/sys-dm-hadr-database-replica-cluster-states-transact-sql) .</span><span class="sxs-lookup"><span data-stu-id="d554b-171">If the restored node was up at the time that quorum was lost, you can determine whether data loss could occur on a given database by querying the **is_failover_ready** column of the [sys.dm_hadr_database_replica_cluster_states](/sql/relational-databases/system-dynamic-management-views/sys-dm-hadr-database-replica-cluster-states-transact-sql) dynamic management view.</span></span> <span data-ttu-id="d554b-172">Par exemple, pour une instance de serveur nommée `sql108w2k8r22`, exécutez la requête suivante :</span><span class="sxs-lookup"><span data-stu-id="d554b-172">For example, for a server instance named `sql108w2k8r22`, issue the following query:</span></span>  
  
    ```  
    SELECT * FROM sys.dm_hadr_database_replica_cluster_states  
       WHERE replica_id=(SELECT replica_id FROM sys.availability_replicas   
          WHERE replica_server_name ='sql108w2k8r22')  
    ```  
  
    > [!CAUTION]  
    >  <span data-ttu-id="d554b-173">Si le nœud restauré était désactivé lors de la perte du quorum, **is_failover_ready** peut ne pas refléter l’état réel du cluster quand le réplica principal a été mis hors connexion.</span><span class="sxs-lookup"><span data-stu-id="d554b-173">If the restored node was not up at the time quorum was lost, **is_failover_ready** may not reflect the cluster's actual state at the time the primary replica went offline.</span></span> <span data-ttu-id="d554b-174">Par conséquent, la valeur **is_failover_ready** est efficace uniquement si le nœud hôte était activé au moment de la défaillance.</span><span class="sxs-lookup"><span data-stu-id="d554b-174">Therefore, the **is_failover_ready** value is only good if the host node at the time of the failure.</span></span> <span data-ttu-id="d554b-175">Pour plus d’informations, consultez « Raisons pour lesquelles le basculement forcé est requis après avoir forcé le quorum » dans [Basculement et modes de basculement &#40;groupes de disponibilité AlwaysOn&#41;](failover-and-failover-modes-always-on-availability-groups.md).</span><span class="sxs-lookup"><span data-stu-id="d554b-175">For more information, see "Why Forced Failover is Required After Forcing Quorum" in [Failover and Failover Modes &#40;AlwaysOn Availability Groups&#41;](failover-and-failover-modes-always-on-availability-groups.md).</span></span>  
  
     <span data-ttu-id="d554b-176">Si **is_failover_ready** = 1, la base de données est marquée comme synchronisée dans le cluster et est prête pour le basculement.</span><span class="sxs-lookup"><span data-stu-id="d554b-176">If **is_failover_ready** = 1, the database is marked as synchronized in the cluster and is ready for a failover.</span></span> <span data-ttu-id="d554b-177">Si **is_failover_ready** = 1 sur chaque base de données d’un réplica secondaire donné, vous pouvez effectuer un basculement forcé (FORCE_FAILOVER_ALLOW_DATA_LOSS) sans perte de données sur ce réplica secondaire.</span><span class="sxs-lookup"><span data-stu-id="d554b-177">If **is_failover_ready** = 1 on every database on a given secondary replica, you can perform a forced failover (FORCE_FAILOVER_ALLOW_DATA_LOSS) without data loss on this secondary replica.</span></span> <span data-ttu-id="d554b-178">Le réplica secondaire synchronisé est mis en ligne dans le rôle principal, c.-à-d., comme nouveau réplica principal, avec toutes les données intactes.</span><span class="sxs-lookup"><span data-stu-id="d554b-178">The synchronized secondary replica comes online in the primary role, that is, as the new primary replica, with all the data intact.</span></span>  
  
     <span data-ttu-id="d554b-179">Si **is_failover_ready** = 0, la base de données n’est pas marquée comme synchronisée dans le cluster et *n’est pas prête* pour un basculement manuel planifié.</span><span class="sxs-lookup"><span data-stu-id="d554b-179">If **is_failover_ready** = 0, the database is not marked as synchronized in the cluster and is *not* ready for a planned manual failover.</span></span> <span data-ttu-id="d554b-180">Si vous forcez le basculement vers le réplica secondaire hôte, les données seront perdues sur cette base de données.</span><span class="sxs-lookup"><span data-stu-id="d554b-180">If you force failover to the host secondary replica, data will be lost on this database.</span></span>  
  
    > [!NOTE]  
    >  <span data-ttu-id="d554b-181">Lorsque vous forcez le basculement vers un réplica secondaire, la perte de données dépend du retard de la cible de basculement par rapport au réplica principal.</span><span class="sxs-lookup"><span data-stu-id="d554b-181">When you force failover to a secondary replica, the amount of data loss will depend on how far the failover target is lagging behind the primary replica.</span></span> <span data-ttu-id="d554b-182">Malheureusement, lorsque le cluster WSFC ne dispose pas de quorum ou que le quorum a été forcé, vous ne pouvez pas déterminer la perte de données.</span><span class="sxs-lookup"><span data-stu-id="d554b-182">Unfortunately, when the WSFC cluster lacks quorum or quorum has been forced, you cannot assess the amount of potential data loss.</span></span> <span data-ttu-id="d554b-183">Notez, toutefois, qu'une fois que le cluster WSFC a regagné un quorum sain, vous pouvez commencer à suivre la perte potentielle de données.</span><span class="sxs-lookup"><span data-stu-id="d554b-183">Note, however, that once the WSFC cluster regains a healthy quorum, you could begin to track potential data loss.</span></span> <span data-ttu-id="d554b-184">Pour plus d’informations, consultez « Suivi de la perte de données potentielle » dans [Basculement et modes de basculement &#40;groupes de disponibilité AlwaysOn&#41;](failover-and-failover-modes-always-on-availability-groups.md).</span><span class="sxs-lookup"><span data-stu-id="d554b-184">For more information, see "Tracking Potential Data Loss" in [Failover and Failover Modes &#40;AlwaysOn Availability Groups&#41;](failover-and-failover-modes-always-on-availability-groups.md).</span></span>  
  
###  <a name="security"></a><a name="Security"></a> <span data-ttu-id="d554b-185">Sécurité</span><span class="sxs-lookup"><span data-stu-id="d554b-185">Security</span></span>  
  
####  <a name="permissions"></a><a name="Permissions"></a> <span data-ttu-id="d554b-186">Autorisations</span><span class="sxs-lookup"><span data-stu-id="d554b-186">Permissions</span></span>  
 <span data-ttu-id="d554b-187">Requiert l'autorisation ALTER AVAILABILITY GROUP sur le groupe de disponibilité, l'autorisation CONTROL AVAILABILITY GROUP, l'autorisation ALTER ANY AVAILABILITY GROUP ou l'autorisation CONTROL SERVER.</span><span class="sxs-lookup"><span data-stu-id="d554b-187">Requires ALTER AVAILABILITY GROUP permission on the availability group, CONTROL AVAILABILITY GROUP permission, ALTER ANY AVAILABILITY GROUP permission, or CONTROL SERVER permission.</span></span>  
  
##  <a name="using-sql-server-management-studio"></a><a name="SSMSProcedure"></a> <span data-ttu-id="d554b-188">Utilisation de SQL Server Management Studio</span><span class="sxs-lookup"><span data-stu-id="d554b-188">Using SQL Server Management Studio</span></span>  
 <span data-ttu-id="d554b-189">**Pour forcer le basculement (avec possible perte de données)**</span><span class="sxs-lookup"><span data-stu-id="d554b-189">**To force failover (with possible data loss)**</span></span>  
  
1.  <span data-ttu-id="d554b-190">Dans l'Explorateur d'objets, connectez-vous à une instance de serveur qui héberge un réplica dont le rôle se trouve dans l'état SECONDARY ou RESOLVING dans le groupe de disponibilité devant être basculé et développez l'arborescence du serveur.</span><span class="sxs-lookup"><span data-stu-id="d554b-190">In Object Explorer, connect to a server instance that hosts a replica whose role is in the SECONDARY or RESOLVING state in the availability group that needs to be failed over, and expand the server tree.</span></span>  
  
2.  <span data-ttu-id="d554b-191">Développez le nœud **Haute disponibilité AlwaysOn** et le nœud **Groupes de disponibilité** .</span><span class="sxs-lookup"><span data-stu-id="d554b-191">Expand the **AlwaysOn High Availability** node and the **Availability Groups** node.</span></span>  
  
3.  <span data-ttu-id="d554b-192">Cliquez avec le bouton droit sur le groupe de disponibilité à basculer et sélectionnez la commande **Basculement** .</span><span class="sxs-lookup"><span data-stu-id="d554b-192">Right-click the availability group to be failed over, and select the **Failover** command.</span></span>  
  
4.  <span data-ttu-id="d554b-193">Cette commande lance l'Assistant Basculer le groupe de disponibilité.</span><span class="sxs-lookup"><span data-stu-id="d554b-193">This launches the Failover Availability Group Wizard.</span></span> <span data-ttu-id="d554b-194">Pour plus d’informations, consultez [Utiliser l’Assistant Basculer le groupe de disponibilité &#40;SQL Server Management Studio&#41;](use-the-fail-over-availability-group-wizard-sql-server-management-studio.md).</span><span class="sxs-lookup"><span data-stu-id="d554b-194">For more information, see [Use the Fail Over Availability Group Wizard &#40;SQL Server Management Studio&#41;](use-the-fail-over-availability-group-wizard-sql-server-management-studio.md).</span></span>  
  
5.  <span data-ttu-id="d554b-195">Après avoir forcé un groupe de disponibilité à basculer, effectuez les étapes de suivi nécessaires.</span><span class="sxs-lookup"><span data-stu-id="d554b-195">After forcing an availability group to fail over, complete the necessary follow-up steps.</span></span> <span data-ttu-id="d554b-196">Pour plus d’informations, consultez [Suivi : Tâches essentielles après un basculement forcé](#FollowUp), plus loin dans cette rubrique.</span><span class="sxs-lookup"><span data-stu-id="d554b-196">For more information, see [Follow Up: Essential Tasks After a Forced Failover](#FollowUp), later in this topic.</span></span>  
  
##  <a name="using-transact-sql"></a><a name="TsqlProcedure"></a> <span data-ttu-id="d554b-197">Utilisation de Transact-SQL</span><span class="sxs-lookup"><span data-stu-id="d554b-197">Using Transact-SQL</span></span>  
 <span data-ttu-id="d554b-198">**Pour forcer le basculement (avec possible perte de données)**</span><span class="sxs-lookup"><span data-stu-id="d554b-198">**To force failover (with possible data loss)**</span></span>  
  
1.  <span data-ttu-id="d554b-199">Connectez-vous à une instance de serveur qui héberge un réplica dont le rôle se trouve dans l'état SECONDARY ou RESOLVING dans le groupe de disponibilité devant être basculé.</span><span class="sxs-lookup"><span data-stu-id="d554b-199">Connect to a server instance that hosts a replica whose role is in the SECONDARY or RESOLVING state in the availability group that needs to be failed over.</span></span>  
  
2.  <span data-ttu-id="d554b-200">Utilisez l'instruction [ALTER AVAILABILITY GROUP](/sql/t-sql/statements/alter-availability-group-transact-sql) , comme suit :</span><span class="sxs-lookup"><span data-stu-id="d554b-200">Use the [ALTER AVAILABILITY GROUP](/sql/t-sql/statements/alter-availability-group-transact-sql) statement, as follows:</span></span>  
  
     <span data-ttu-id="d554b-201">ALTER AVAILABILITY GROUP *nom_groupe* FORCE_FAILOVER_ALLOW_DATA_LOSS</span><span class="sxs-lookup"><span data-stu-id="d554b-201">ALTER AVAILABILITY GROUP *group_name* FORCE_FAILOVER_ALLOW_DATA_LOSS</span></span>  
  
     <span data-ttu-id="d554b-202">où *nom_groupe* correspond au nom du groupe de disponibilité.</span><span class="sxs-lookup"><span data-stu-id="d554b-202">where *group_name* is the name of the availability group.</span></span>  
  
     <span data-ttu-id="d554b-203">L'exemple suivant force le basculement du groupe de disponibilité `AccountsAG` vers le réplica secondaire local.</span><span class="sxs-lookup"><span data-stu-id="d554b-203">The following example forces the `AccountsAG` availability group to fail over to the local secondary replica.</span></span>  
  
    ```sql
    ALTER AVAILABILITY GROUP AccountsAG FORCE_FAILOVER_ALLOW_DATA_LOSS;  
    ```  
  
3.  <span data-ttu-id="d554b-204">Après avoir forcé un groupe de disponibilité à basculer, effectuez les étapes de suivi nécessaires.</span><span class="sxs-lookup"><span data-stu-id="d554b-204">After forcing an availability group to fail over, complete the necessary follow-up steps.</span></span> <span data-ttu-id="d554b-205">Pour plus d’informations, consultez [Suivi : Tâches essentielles après un basculement forcé](#FollowUp), plus loin dans cette rubrique.</span><span class="sxs-lookup"><span data-stu-id="d554b-205">For more information, see [Follow Up: Essential Tasks After a Forced Failover](#FollowUp), later in this topic.</span></span>  
  
##  <a name="using-powershell"></a><a name="PowerShellProcedure"></a> <span data-ttu-id="d554b-206">Utilisation de PowerShell</span><span class="sxs-lookup"><span data-stu-id="d554b-206">Using PowerShell</span></span>  
 <span data-ttu-id="d554b-207">**Pour forcer le basculement (avec possible perte de données)**</span><span class="sxs-lookup"><span data-stu-id="d554b-207">**To force failover (with possible data loss)**</span></span>  
  
1.  <span data-ttu-id="d554b-208">Remplacez le répertoire ( `cd` ) par une instance de serveur qui héberge un réplica dont le rôle est dans l’état secondaire ou de résolution dans le groupe de disponibilité qui doit être basculé.</span><span class="sxs-lookup"><span data-stu-id="d554b-208">Change directory (`cd`) to a server instance that hosts a replica whose role is in the SECONDARY or RESOLVING state in the availability group that needs to be failed over.</span></span>  
  
2.  <span data-ttu-id="d554b-209">Utilisez l'applet de commande `Switch-SqlAvailabilityGroup` avec le paramètre `AllowDataLoss` dans l'un des formats suivants :</span><span class="sxs-lookup"><span data-stu-id="d554b-209">Use the `Switch-SqlAvailabilityGroup` cmdlet with the `AllowDataLoss` parameter in one of the following forms:</span></span>  
  
    -   `-AllowDataLoss`  
  
         <span data-ttu-id="d554b-210">Par défaut, avec le paramètre `-AllowDataLoss`, `Switch-SqlAvailabilityGroup` vous rappelle que le basculement forcé peut provoquer la perte de transactions non validées et vous demande confirmation.</span><span class="sxs-lookup"><span data-stu-id="d554b-210">By default `-AllowDataLoss` parameter causes `Switch-SqlAvailabilityGroup` to prompt you to remind you that forcing failover might result in the loss of uncommitted transactions and to request confirmation.</span></span> <span data-ttu-id="d554b-211">Pour continuer, entrez `Y` ; pour annuler l’opération, entrez `N`.</span><span class="sxs-lookup"><span data-stu-id="d554b-211">To continue, enter `Y`; to cancel the operation, enter `N`.</span></span>  
  
         <span data-ttu-id="d554b-212">L’exemple suivant exécute un basculement forcé (avec perte de données possible) du groupe de disponibilité `MyAg` vers le réplica secondaire sur l’instance de serveur nommée `SecondaryServer\InstanceName`.</span><span class="sxs-lookup"><span data-stu-id="d554b-212">The following example performs a forced failover (with possible data loss) of the availability group `MyAg` to the secondary replica on the server instance named `SecondaryServer\InstanceName`.</span></span> <span data-ttu-id="d554b-213">Vous êtes invité à confirmer cette opération.</span><span class="sxs-lookup"><span data-stu-id="d554b-213">You will be prompted to confirm this operation.</span></span>  
  
        ```powershell
        Switch-SqlAvailabilityGroup -Path SQLSERVER:\Sql\SecondaryServer\InstanceName\AvailabilityGroups\MyAg -AllowDataLoss  
        ```  
  
    -   <span data-ttu-id="d554b-214">**-AllowDataLoss-Force**</span><span class="sxs-lookup"><span data-stu-id="d554b-214">**-AllowDataLoss-Force**</span></span>  
  
         <span data-ttu-id="d554b-215">Pour démarrer un basculement forcé sans confirmation, spécifiez à la fois les paramètres `-AllowDataLoss` et `-Force`.</span><span class="sxs-lookup"><span data-stu-id="d554b-215">To initiate a forced failover without confirmation, specify both the `-AllowDataLoss` and `-Force` parameters.</span></span> <span data-ttu-id="d554b-216">Cela est utile si vous souhaitez inclure la commande dans un script et l'exécuter sans intervention de l'utilisateur.</span><span class="sxs-lookup"><span data-stu-id="d554b-216">This is useful if you want to include the command in a script and run it without user interaction.</span></span>  <span data-ttu-id="d554b-217">Toutefois, utilisez l'option `-Force` avec précaution, car un basculement forcé peut se traduire par une perte de données des bases de données participant au groupe de disponibilité.</span><span class="sxs-lookup"><span data-stu-id="d554b-217">However, use the `-Force` option with caution, because a forced failover might result in the loss of data from databases participating the availability group.</span></span>  
  
         <span data-ttu-id="d554b-218">L’exemple suivant exécute un basculement forcé (avec perte de données possible) du groupe de disponibilité `MyAg` vers l’instance de serveur nommée `SecondaryServer\InstanceName`.</span><span class="sxs-lookup"><span data-stu-id="d554b-218">The following example performs a forced failover (with possible data loss) of the availability group `MyAg` to the server instance named `SecondaryServer\InstanceName`.</span></span> <span data-ttu-id="d554b-219">L'option `-Force` supprime la confirmation de cette opération.</span><span class="sxs-lookup"><span data-stu-id="d554b-219">The `-Force` option suppresses confirmation of this operation.</span></span>  
  
        ```powershell
        Switch-SqlAvailabilityGroup -Path SQLSERVER:\Sql\SecondaryServer\InstanceName\AvailabilityGroups\MyAg -AllowDataLoss -Force  
        ```  
  
    > [!NOTE]  
    >  <span data-ttu-id="d554b-220">Pour afficher la syntaxe d'une applet de commande, utilisez l'applet de commande `Get-Help` dans l'environnement [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] PowerShell.</span><span class="sxs-lookup"><span data-stu-id="d554b-220">To view the syntax of a cmdlet, use the `Get-Help` cmdlet in the [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] PowerShell environment.</span></span> <span data-ttu-id="d554b-221">Pour en savoir plus, voir [Get Help SQL Server PowerShell](../../../powershell/sql-server-powershell.md).</span><span class="sxs-lookup"><span data-stu-id="d554b-221">For more information, see [Get Help SQL Server PowerShell](../../../powershell/sql-server-powershell.md).</span></span>  
  
3.  <span data-ttu-id="d554b-222">Après avoir forcé un groupe de disponibilité à basculer, effectuez les étapes de suivi nécessaires.</span><span class="sxs-lookup"><span data-stu-id="d554b-222">After forcing an availability group to fail over, complete the necessary follow-up steps.</span></span> <span data-ttu-id="d554b-223">Pour plus d’informations, consultez [Suivi : Tâches essentielles après un basculement forcé](#FollowUp), plus loin dans cette rubrique.</span><span class="sxs-lookup"><span data-stu-id="d554b-223">For more information, see [Follow Up: Essential Tasks After a Forced Failover](#FollowUp), later in this topic.</span></span>  
  
 <span data-ttu-id="d554b-224">**Pour configurer et utiliser le fournisseur SQL Server PowerShell**</span><span class="sxs-lookup"><span data-stu-id="d554b-224">**To set up and use the SQL Server PowerShell provider**</span></span>  
  
-   [<span data-ttu-id="d554b-225">Fournisseur SQL Server PowerShell</span><span class="sxs-lookup"><span data-stu-id="d554b-225">SQL Server PowerShell Provider</span></span>](../../../powershell/sql-server-powershell-provider.md)  
  
##  <a name="follow-up-essential-tasks-after-a-forced-failover"></a><a name="FollowUp"></a> <span data-ttu-id="d554b-226">Suivi : Tâches essentielles après un basculement forcé</span><span class="sxs-lookup"><span data-stu-id="d554b-226">Follow Up: Essential Tasks After a Forced Failover</span></span>  
  
1.  <span data-ttu-id="d554b-227">Après un basculement forcé, le réplica secondaire vers lequel vous avez effectué le basculement devient le nouveau réplica principal.</span><span class="sxs-lookup"><span data-stu-id="d554b-227">After a forced failover, the secondary replica to which you failed over becomes the new primary replica.</span></span> <span data-ttu-id="d554b-228">Toutefois, pour que ce réplica de disponibilité soit accessible aux clients, vous devrez peut-être reconfigurer le quorum WSFC ou ajuster la configuration du mode de disponibilité du groupe de disponibilité, comme suit :</span><span class="sxs-lookup"><span data-stu-id="d554b-228">However, to make that availability replica accessible to clients, you might need to reconfigure the WSFC quorum or adjust the availability-mode configuration of the availability group, as follows:</span></span>  
  
    -   <span data-ttu-id="d554b-229">**Si vous avez effectué le basculement en dehors du [!INCLUDE[ssFosAuto](../../../includes/ssfosauto-md.md)] :**  Ajustez les votes de quorum des nœuds WSFC afin de refléter la nouvelle configuration de votre groupe de disponibilité.</span><span class="sxs-lookup"><span data-stu-id="d554b-229">**If you failed over outside of the [!INCLUDE[ssFosAuto](../../../includes/ssfosauto-md.md)]:**  Adjust the quorum votes of the WSFC nodes to reflect your new availability group configuration.</span></span> <span data-ttu-id="d554b-230">Si le nœud WSFC qui héberge le réplica secondaire cible n'a pas de vote de quorum WSFC, vous devrez peut-être forcer le quorum WSFC.</span><span class="sxs-lookup"><span data-stu-id="d554b-230">If the WSFC node that hosts the target secondary replica does not have a WSFC quorum vote, you might need to force WSFC quorum.</span></span>  
  
        > [!NOTE]  
        >  <span data-ttu-id="d554b-231">Un [!INCLUDE[ssFosAuto](../../../includes/ssfosauto-md.md)] existe uniquement si deux réplicas de disponibilité (réplica principal précédent inclus) sont configurés pour le mode de validation synchrone avec basculement automatique.</span><span class="sxs-lookup"><span data-stu-id="d554b-231">An [!INCLUDE[ssFosAuto](../../../includes/ssfosauto-md.md)] exists only if two availability replicas (including the previous primary replica) are configured for synchronous-commit mode with automatic failover.</span></span>  
  
         <span data-ttu-id="d554b-232">**Pour ajuster les votes de quorum**</span><span class="sxs-lookup"><span data-stu-id="d554b-232">**To adjust quorum votes**</span></span>  
  
        -   [<span data-ttu-id="d554b-233">Afficher les paramètres NodeWeight pour le quorum de cluster</span><span class="sxs-lookup"><span data-stu-id="d554b-233">View Cluster Quorum NodeWeight Settings</span></span>](../../../sql-server/failover-clusters/windows/view-cluster-quorum-nodeweight-settings.md)  
  
        -   [<span data-ttu-id="d554b-234">Configurer les paramètres NodeWeight pour un quorum de cluster</span><span class="sxs-lookup"><span data-stu-id="d554b-234">Configure Cluster Quorum NodeWeight Settings</span></span>](../../../sql-server/failover-clusters/windows/configure-cluster-quorum-nodeweight-settings.md)  
  
        -   [<span data-ttu-id="d554b-235">Forcer un cluster WSFC à démarrer sans quorum</span><span class="sxs-lookup"><span data-stu-id="d554b-235">Force a WSFC Cluster to Start Without a Quorum</span></span>](../../../sql-server/failover-clusters/windows/force-a-wsfc-cluster-to-start-without-a-quorum.md)  
  
    -   <span data-ttu-id="d554b-236">**Si vous avez effectué le basculement en dehors du [!INCLUDE[ssFosSync](../../../includes/ssfossync-md.md)] :** Nous vous recommandons d’ajuster le mode de disponibilité et de basculement sur le nouveau réplica principal et sur les réplicas secondaires restants afin de refléter la configuration de votre choix concernant la validation synchrone et le basculement automatique.</span><span class="sxs-lookup"><span data-stu-id="d554b-236">**If you failed over outside of the [!INCLUDE[ssFosSync](../../../includes/ssfossync-md.md)]:** We recommend that you consider adjusting the availability mode and failover mode on the new primary replica and on remaining secondary replicas to reflect your desired synchronous-commit and automatic failover configuration.</span></span>  
  
        > [!NOTE]  
        >  <span data-ttu-id="d554b-237">Un [!INCLUDE[ssFosSync](../../../includes/ssfossync-md.md)] existe uniquement si le réplica principal actuel est configuré pour le mode de validation synchrone.</span><span class="sxs-lookup"><span data-stu-id="d554b-237">A [!INCLUDE[ssFosSync](../../../includes/ssfossync-md.md)] exists only if the current primary replica is configured for synchronous-commit mode.</span></span>  
  
         <span data-ttu-id="d554b-238">**Pour modifier le mode de disponibilité et de basculement**</span><span class="sxs-lookup"><span data-stu-id="d554b-238">**To change the availability mode and failover mode**</span></span>  
  
        -   [<span data-ttu-id="d554b-239">Modifier le mode de disponibilité d’un réplica de disponibilité &#40;SQL Server&#41;</span><span class="sxs-lookup"><span data-stu-id="d554b-239">Change the Availability Mode of an Availability Replica &#40;SQL Server&#41;</span></span>](change-the-availability-mode-of-an-availability-replica-sql-server.md)  
  
        -   [<span data-ttu-id="d554b-240">Modifier le mode de basculement d’un réplica de disponibilité &#40;SQL Server&#41;</span><span class="sxs-lookup"><span data-stu-id="d554b-240">Change the Failover Mode of an Availability Replica &#40;SQL Server&#41;</span></span>](change-the-failover-mode-of-an-availability-replica-sql-server.md)  
  
2.  <span data-ttu-id="d554b-241">Après un basculement forcé, toutes les bases de données secondaires sont interrompues.</span><span class="sxs-lookup"><span data-stu-id="d554b-241">After a forced failover, all secondary databases are suspended.</span></span> <span data-ttu-id="d554b-242">Cela inclut les anciennes bases de données principales, une fois que l'ancien réplica principal est repassé en ligne et découvre qu'il s'agit maintenant d'un réplica secondaire.</span><span class="sxs-lookup"><span data-stu-id="d554b-242">This includes the former primary databases, after the former primary replica comes back online and discovers that it is now a secondary replica.</span></span> <span data-ttu-id="d554b-243">Vous devez reprendre manuellement chaque base de données interrompue individuellement sur chaque réplica secondaire.</span><span class="sxs-lookup"><span data-stu-id="d554b-243">You must manually resume each suspended database individually on each secondary replica.</span></span>  
  
     <span data-ttu-id="d554b-244">Lors de la reprise d'une base de données secondaire, la synchronisation de données commence avec la base de données primaire correspondante.</span><span class="sxs-lookup"><span data-stu-id="d554b-244">When a secondary database is resumed, it initiates data synchronization with the corresponding primary database.</span></span> <span data-ttu-id="d554b-245">La base de données secondaire restaure tous les enregistrements de journal qui n'ont jamais été validés sur la nouvelle base de données primaire. Par conséquent, si vous êtes inquiet de la possible perte de données sur les bases de données primaires après le basculement, vous devez essayer de créer un instantané de base de données sur les bases de données interrompues sur l’une des bases de données secondaires avec validation synchrone.</span><span class="sxs-lookup"><span data-stu-id="d554b-245">The secondary database rolls back any log records that were never committed on the new primary database.Therefore, if you are concerned about possible data loss on the post-failover primary databases, you should attempt to create a database snapshot on the suspended databases on one of the synchronous-commit secondary databases.</span></span>  
  
    > [!IMPORTANT]  
    >  <span data-ttu-id="d554b-246">La troncation du journal des transactions est différée sur une base de données principale tant que l'une de ses bases de données secondaires est interrompue.</span><span class="sxs-lookup"><span data-stu-id="d554b-246">Transaction log truncation is delayed on a primary database while any of its secondary databases is suspended.</span></span> <span data-ttu-id="d554b-247">De même, l'état de synchronisation d'un réplica secondaire avec validation synchrone ne peut pas effectuer la transition vers l'état HEALTHY tant qu'une base de données locale reste interrompue.</span><span class="sxs-lookup"><span data-stu-id="d554b-247">Also the synchronization health of a synchronous-commit secondary replica cannot transition to HEALTHY as long as any local database remains suspended.</span></span>  
  
     <span data-ttu-id="d554b-248">**Pour créer un instantané de base de données**</span><span class="sxs-lookup"><span data-stu-id="d554b-248">**To create a database snapshot**</span></span>  
  
    -   [<span data-ttu-id="d554b-249">Créer un instantané de base de données &#40;Transact-SQL&#41;</span><span class="sxs-lookup"><span data-stu-id="d554b-249">Create a Database Snapshot &#40;Transact-SQL&#41;</span></span>](../../../relational-databases/databases/create-a-database-snapshot-transact-sql.md)  
  
     <span data-ttu-id="d554b-250">**Pour reprendre une base de données de disponibilité**</span><span class="sxs-lookup"><span data-stu-id="d554b-250">**To resume an availability database**</span></span>  
  
    -   [<span data-ttu-id="d554b-251">Reprendre une base de données de disponibilité &#40;SQL Server&#41;</span><span class="sxs-lookup"><span data-stu-id="d554b-251">Resume an Availability Database &#40;SQL Server&#41;</span></span>](resume-an-availability-database-sql-server.md)  
  
    > [!CAUTION]  
    >  <span data-ttu-id="d554b-252">Après la reprise de toutes les bases de données secondaires, et avant de tenter un nouveau basculement du groupe, attendez que chaque base de données secondaire sur la cible de basculement suivante passe à l'état SYNCHRONIZING.</span><span class="sxs-lookup"><span data-stu-id="d554b-252">After resuming all the secondary databases, before attempting to fail over the group again, wait for every secondary database on the next failover target to enter the SYNCHRONIZING state.</span></span> <span data-ttu-id="d554b-253">Si une base de données ne présente pas encore l'état SYNCHRONIZING, cette base de données sera empêchée d'être mise en ligne en tant que base de données primaire, et le rétablissement de la synchronisation de données pour la base de données peut nécessiter la restauration des journaux de transactions, la restauration d'une sauvegarde complète de base de données ou le basculement vers le réplica principal précédent.</span><span class="sxs-lookup"><span data-stu-id="d554b-253">If any database is not yet SYNCHRONIZING, that database will be prevented from coming online as a primary database, and re-establishing data synchronization for the database might require restoring transaction logs, restoring a full database backup, or failing over back to the previous primary replica.</span></span>  
  
3.  <span data-ttu-id="d554b-254">Si un réplica de disponibilité ayant échoué ne retourne pas au réplica de disponibilité ou y retourne trop tard pour vous permettre de retarder la troncation du journal des transactions sur la nouvelle base de données primaire, supprimez le réplica défaillant du groupe de disponibilité afin d'éviter le risque de manquer d'espace sur le disque pour vos fichiers journaux.</span><span class="sxs-lookup"><span data-stu-id="d554b-254">If an availability replica that failed will not be returning to the availability replica or will return too late for you to delay transaction log truncation on the new primary database, consider removing the failed replica from the availability group to avoid running out of disk space for your log files.</span></span>  
  
     <span data-ttu-id="d554b-255">**Pour supprimer un réplica secondaire**</span><span class="sxs-lookup"><span data-stu-id="d554b-255">**To remove a secondary replica**</span></span>  
  
    -   [<span data-ttu-id="d554b-256">Supprimer un réplica secondaire d’un groupe de disponibilité &#40;SQL Server&#41;</span><span class="sxs-lookup"><span data-stu-id="d554b-256">Remove a Secondary Replica from an Availability Group &#40;SQL Server&#41;</span></span>](remove-a-secondary-replica-from-an-availability-group-sql-server.md)  
  
4.  <span data-ttu-id="d554b-257">Si vous suivez un basculement forcé avec un ou plusieurs basculements supplémentaires forcés, effectuez une sauvegarde de journal après chaque basculement forcé supplémentaire de la séquence.</span><span class="sxs-lookup"><span data-stu-id="d554b-257">If you follow a forced failover with one or more additional forced failovers, perform a log backup after each additional forced failover in the series.</span></span> <span data-ttu-id="d554b-258">Pour plus d’informations expliquant ce phénomène, consultez « Risques posés par le basculement forcé » dans la section « Basculement manuel forcé (avec possible perte de données) » de la rubrique [Basculement et modes de basculement &#40;groupes de disponibilité AlwaysOn&#41;](failover-and-failover-modes-always-on-availability-groups.md).</span><span class="sxs-lookup"><span data-stu-id="d554b-258">For information about the reason for this, see "Risks of Forcing Failover" in the "Forced Manual Failover (with Possible Data Loss)" section of [Failover and Failover Modes &#40;AlwaysOn Availability Groups&#41;](failover-and-failover-modes-always-on-availability-groups.md).</span></span>  
  
     <span data-ttu-id="d554b-259">**Pour effectuer une sauvegarde de fichier journal**</span><span class="sxs-lookup"><span data-stu-id="d554b-259">**To perform a log backup**</span></span>  
  
    -   [<span data-ttu-id="d554b-260">Sauvegarder un journal des transactions &#40;SQL Server&#41;</span><span class="sxs-lookup"><span data-stu-id="d554b-260">Back Up a Transaction Log &#40;SQL Server&#41;</span></span>](../../../relational-databases/backup-restore/back-up-a-transaction-log-sql-server.md)  
  
##  <a name="example-scenario-using-a-forced-failover-to-recover-from-a-catastrophic-failure"></a><span data-ttu-id="d554b-261"><a name="ExampleRecoveryFromCatastrophy">Exemple de scénario :</a> Utilisation d’un basculement forcé pour effectuer une récupération suite à une défaillance catastrophique</span><span class="sxs-lookup"><span data-stu-id="d554b-261"><a name="ExampleRecoveryFromCatastrophy"></a> Example Scenario: Using a Forced Failover to Recover from a Catastrophic Failure</span></span>  
 <span data-ttu-id="d554b-262">Si le réplica principal échoue et qu'aucun réplica secondaire synchronisé n'est disponible, forcer le groupe de disponibilité à basculer peut constituer une réponse appropriée.</span><span class="sxs-lookup"><span data-stu-id="d554b-262">If the primary replica fails and no synchronized secondary replica is available, forcing the availability group to fail over might be an appropriate response.</span></span> <span data-ttu-id="d554b-263">La pertinence d’un basculement forcé varie : (1) selon que vous vous attendez ou non à ce que le réplica principal reste hors connexion pendant une durée plus longue que celle tolérée par votre contrat de niveau de service (SLA), et (2) selon que vous êtes prêt à prendre le risque de perdre éventuellement des données afin de mettre les bases de données primaires à disposition le plus rapidement possible.</span><span class="sxs-lookup"><span data-stu-id="d554b-263">The appropriateness of forcing a failover depends on: (1) whether you expect the primary replica to be offline for longer than your service level agreement (SLA) tolerates, and (2) whether you are willing to risk potential data loss in order to make primary databases available quickly.</span></span> <span data-ttu-id="d554b-264">Si vous décidez qu'un groupe de disponibilité nécessite un basculement forcé, ce dernier ne constitue qu'une étape dans un processus plus complexe.</span><span class="sxs-lookup"><span data-stu-id="d554b-264">If you decide that an availability group requires a forced failover, the actual forced failover is but one step of a multi-step process.</span></span>  
  
 <span data-ttu-id="d554b-265">Pour illustrer les étapes requises pour utiliser un basculement forcé afin d'opérer une récupération suite à une défaillance catastrophique, cette rubrique présente un possible scénario de récupération d'urgence.</span><span class="sxs-lookup"><span data-stu-id="d554b-265">To illustrate the steps that are required to use a forced failover to recover from a catastrophic failure, this topic presents one possible disaster recovery scenario.</span></span> <span data-ttu-id="d554b-266">Ce scénario d'exemple implique un groupe de disponibilité dont la topologie d'origine consiste en un centre de données principal qui héberge trois réplicas de disponibilité avec validation synchrone, y compris le réplica principal, et un centre de données distant qui héberge deux réplicas secondaires avec validation asynchrone.</span><span class="sxs-lookup"><span data-stu-id="d554b-266">The example scenario considers an availability group whose original topology consists of a main data center that hosts three synchronous-commit availability replicas, including the primary replica, and a remote data center that hosts two asynchronous-commit secondary replicas.</span></span> <span data-ttu-id="d554b-267">La figure suivante illustre la topologie d'origine de ce groupe de disponibilité d'exemple.</span><span class="sxs-lookup"><span data-stu-id="d554b-267">The following figure illustrates the original topology of this example availability group.</span></span> <span data-ttu-id="d554b-268">Le groupe de disponibilité est hébergé par un cluster WSFC à plusieurs sous-réseaux avec trois nœuds dans le centre de données principal (**nœud 01**, **nœud 02**et **nœud 03**) et deux nœuds dans un centre de données distant (**nœud 04** et **nœud 05**).</span><span class="sxs-lookup"><span data-stu-id="d554b-268">The availability group is hosted by a multi-subnet WSFC cluster with three nodes in the main data center (**Node 01**, **Node 02**, and **Node 03**) and two nodes in a remote data center (**Node 04** and **Node 05**).</span></span>  
  
 <span data-ttu-id="d554b-269">![Topologie d’origine du groupe de disponibilité](../../media/aoag-failurerecovery-origtopology.gif "Topologie d’origine du groupe de disponibilité")</span><span class="sxs-lookup"><span data-stu-id="d554b-269">![Original topology of availability group](../../media/aoag-failurerecovery-origtopology.gif "Original topology of availability group")</span></span>  
  
 <span data-ttu-id="d554b-270">Le centre de données principal s'arrête de manière inattendue.</span><span class="sxs-lookup"><span data-stu-id="d554b-270">The main data center shuts down unexpectedly.</span></span> <span data-ttu-id="d554b-271">Ses trois réplicas de disponibilité passent en mode hors connexion et leurs bases de données deviennent indisponibles.</span><span class="sxs-lookup"><span data-stu-id="d554b-271">Its three availability replicas to go offline, and their databases become unavailable.</span></span> <span data-ttu-id="d554b-272">La figure suivante illustre l'impact de cette défaillance sur la topologie du groupe de disponibilité.</span><span class="sxs-lookup"><span data-stu-id="d554b-272">The following figure illustrates the impact of this failure on the topology of the availability group.</span></span>  
  
 <span data-ttu-id="d554b-273">![Topologie après la défaillance du centre de données principal](../../media/aoag-failurerecovery-catastrophy.gif "Topologie après la défaillance du centre de données principal")</span><span class="sxs-lookup"><span data-stu-id="d554b-273">![Topology after failure of main data center](../../media/aoag-failurerecovery-catastrophy.gif "Topology after failure of main data center")</span></span>  
  
 <span data-ttu-id="d554b-274">L'administrateur de base de données détermine que la meilleure réponse possible consiste à forcer le basculement du groupe de disponibilité vers l'un des réplicas secondaires distants avec validation asynchrone.</span><span class="sxs-lookup"><span data-stu-id="d554b-274">The database administrator (DBA) determines that the best possible response is to force failover of the availability group to one of the remote, asynchronous-commit secondary replicas.</span></span> <span data-ttu-id="d554b-275">Cet exemple illustre les étapes classiques impliquées lors du basculement forcé du groupe de disponibilité vers un réplica distant et, finalement, lors du retour du groupe de disponibilité à sa topologie d'origine.</span><span class="sxs-lookup"><span data-stu-id="d554b-275">This example illustrates the typical steps involved when you force failover of the availability group to a remote replica and, eventually, return the availability group to its original topology.</span></span>  
  
  
###  <a name="responding-to-the-catastrophic-failure-of-the-main-data-center"></a><a name="FailureResponse"></a> <span data-ttu-id="d554b-276">Responding to the Catastrophic Failure of the Main Data Center</span><span class="sxs-lookup"><span data-stu-id="d554b-276">Responding to the Catastrophic Failure of the Main Data Center</span></span>  
 <span data-ttu-id="d554b-277">La figure suivante illustre la série d'actions effectuées au niveau du centre de données distant en réponse à une défaillance catastrophique dans le centre de données principal.</span><span class="sxs-lookup"><span data-stu-id="d554b-277">The following figure illustrates the series of actions performed at the remote data center in response a catastrophic failure at the main data center.</span></span>  
  
 <span data-ttu-id="d554b-278">![Procédure de réponse à la défaillance du centre de données principal](../../media/aoag-failurerecovery-actions-part1.gif "Procédure de réponse à la défaillance du centre de données principal")</span><span class="sxs-lookup"><span data-stu-id="d554b-278">![Steps for responding to failure of main data cente](../../media/aoag-failurerecovery-actions-part1.gif "Steps for responding to failure of main data cente")</span></span>  
  
 <span data-ttu-id="d554b-279">Les étapes de cette illustration sont les suivantes :</span><span class="sxs-lookup"><span data-stu-id="d554b-279">The steps in this figure indicate the following steps:</span></span>  
  
|<span data-ttu-id="d554b-280">Étape</span><span class="sxs-lookup"><span data-stu-id="d554b-280">Step</span></span>|<span data-ttu-id="d554b-281">Action</span><span class="sxs-lookup"><span data-stu-id="d554b-281">Action</span></span>|<span data-ttu-id="d554b-282">Liens</span><span class="sxs-lookup"><span data-stu-id="d554b-282">Links</span></span>|  
|----------|------------|-----------|  
|<span data-ttu-id="d554b-283">**1.**</span><span class="sxs-lookup"><span data-stu-id="d554b-283">**1.**</span></span>|<span data-ttu-id="d554b-284">L'administrateur de base de données ou réseau s'assure que le cluster WSFC dispose d'un quorum sain.</span><span class="sxs-lookup"><span data-stu-id="d554b-284">The DBA or network administrator ensures that the WSFC cluster has a healthy quorum.</span></span> <span data-ttu-id="d554b-285">Dans cet exemple, le quorum doit être forcé.</span><span class="sxs-lookup"><span data-stu-id="d554b-285">In this example, quorum needs to be forced.</span></span>|[<span data-ttu-id="d554b-286">Modes de quorum WSFC et configuration de vote &#40;SQL Server&#41;</span><span class="sxs-lookup"><span data-stu-id="d554b-286">WSFC Quorum Modes and Voting Configuration &#40;SQL Server&#41;</span></span>](../../../sql-server/failover-clusters/windows/wsfc-quorum-modes-and-voting-configuration-sql-server.md)<br /><br /> [<span data-ttu-id="d554b-287">Récupération d’urgence WSFC par le quorum forcé &#40;SQL Server&#41;</span><span class="sxs-lookup"><span data-stu-id="d554b-287">WSFC Disaster Recovery through Forced Quorum &#40;SQL Server&#41;</span></span>](../../../sql-server/failover-clusters/windows/wsfc-disaster-recovery-through-forced-quorum-sql-server.md)|  
|<span data-ttu-id="d554b-288">**2.**</span><span class="sxs-lookup"><span data-stu-id="d554b-288">**2.**</span></span>|<span data-ttu-id="d554b-289">L’administrateur de base de données se connecte à l’instance du serveur présentant la latence la plus faible (sur le **nœud 04**) et effectue un basculement manuel forcé.</span><span class="sxs-lookup"><span data-stu-id="d554b-289">The DBA connects to the server instance with the least latency (on **Node 04**) and performs a forced manual failover.</span></span> <span data-ttu-id="d554b-290">Le basculement forcé fait passer ce réplica secondaire au rôle principal et interrompt les bases de données secondaires sur le réplica secondaire restant (sur le **nœud 05**).</span><span class="sxs-lookup"><span data-stu-id="d554b-290">The forced failover transitions this secondary replica to the primary role and suspends the secondary databases on the remaining secondary replica (on **Node 05**).</span></span>|<span data-ttu-id="d554b-291">[sys.dm_hadr_database_replica_states &#40;Transact-SQL&#41;](/sql/relational-databases/system-dynamic-management-views/sys-dm-hadr-database-replica-states-transact-sql) (Interroger la colonne **end_of_log_lsn** .</span><span class="sxs-lookup"><span data-stu-id="d554b-291">[sys.dm_hadr_database_replica_states &#40;Transact-SQL&#41;](/sql/relational-databases/system-dynamic-management-views/sys-dm-hadr-database-replica-states-transact-sql) (Query the **end_of_log_lsn** column.</span></span> <span data-ttu-id="d554b-292">Pour plus d’informations, consultez [Recommandations](#Recommendations)plus haut dans cette rubrique.)</span><span class="sxs-lookup"><span data-stu-id="d554b-292">For more information, see [Recommendations](#Recommendations), earlier in this topic.)</span></span>|  
|<span data-ttu-id="d554b-293">**3.**</span><span class="sxs-lookup"><span data-stu-id="d554b-293">**3.**</span></span>|<span data-ttu-id="d554b-294">L'administrateur de base de données rétablit chacune des bases de données secondaires sur le réplica secondaire restant.</span><span class="sxs-lookup"><span data-stu-id="d554b-294">The DBA manually resumes each of the secondary databases on the remaining secondary replica.</span></span>|[<span data-ttu-id="d554b-295">Reprendre une base de données de disponibilité &#40;SQL Server&#41;</span><span class="sxs-lookup"><span data-stu-id="d554b-295">Resume an Availability Database &#40;SQL Server&#41;</span></span>](resume-an-availability-database-sql-server.md)|  
  
###  <a name="returning-the-availability-group-to-its-original-topology"></a><a name="ReturnToOrigTopology"></a> <span data-ttu-id="d554b-296">Retour du groupe de disponibilité à sa topologie d'origine</span><span class="sxs-lookup"><span data-stu-id="d554b-296">Returning the Availability Group to its Original Topology</span></span>  
 <span data-ttu-id="d554b-297">La figure suivante illustre la série d'actions qui permettent au groupe de disponibilité de retourner à sa topologie d'origine une fois que le centre de données principal revient en ligne et que les nœuds WSFC rétablissent la communication avec le cluster WSFC.</span><span class="sxs-lookup"><span data-stu-id="d554b-297">The following figure illustrates the series of actions that return the availability group to its original topology after the main data center comes back online and the WSFC nodes re-establish communication with the WSFC cluster.</span></span>  
  
> [!IMPORTANT]  
>  <span data-ttu-id="d554b-298">Si le quorum du cluster WSFC a été forcé, lorsque les nœuds hors connexion redémarrent, il est possible qu'ils forment un nouveau quorum si les deux conditions suivantes sont réunies : (a) il n'existe aucune connectivité de réseau entre les nœuds dans le quorum forcé défini, et (b) les nœuds qui redémarrent représentent la majorité des nœuds de cluster.</span><span class="sxs-lookup"><span data-stu-id="d554b-298">If the WSFC cluster quorum has been forced, as the offline nodes restart they could form a new quorum if the following conditions both exist: (a) there is no network connectivity between any of the nodes in the forced-quorum set, and (b) the restarting nodes are the majority of the cluster nodes.</span></span> <span data-ttu-id="d554b-299">Cela se traduirait par un fractionnement des partitions, condition dans laquelle le groupe de disponibilité posséderait deux réplicas principaux indépendants, un sur chaque centre de données.</span><span class="sxs-lookup"><span data-stu-id="d554b-299">This would result in a "split brain" condition in which the availability group would possess two independent primary replicas, one at each data center.</span></span> <span data-ttu-id="d554b-300">Avant de forcer un quorum pour créer un quorum minoritaire défini, consultez [Récupération d’urgence WSFC par le quorum forcé &#40;SQL Server&#41;](../../../sql-server/failover-clusters/windows/wsfc-disaster-recovery-through-forced-quorum-sql-server.md).</span><span class="sxs-lookup"><span data-stu-id="d554b-300">Before forcing quorum to create a minority quorum set, see [WSFC Disaster Recovery through Forced Quorum &#40;SQL Server&#41;](../../../sql-server/failover-clusters/windows/wsfc-disaster-recovery-through-forced-quorum-sql-server.md).</span></span>  
  
 <span data-ttu-id="d554b-301">![Procédure pour retourner le groupe à sa topologie d’origine](../../media/aoag-failurerecovery-actions-part2.gif "Procédure pour retourner le groupe à sa topologie d’origine")</span><span class="sxs-lookup"><span data-stu-id="d554b-301">![Steps to return the group to its original topology](../../media/aoag-failurerecovery-actions-part2.gif "Steps to return the group to its original topology")</span></span>  
  
 <span data-ttu-id="d554b-302">Les étapes de cette illustration sont les suivantes :</span><span class="sxs-lookup"><span data-stu-id="d554b-302">The steps in this figure indicate the following steps:</span></span>  
  
||<span data-ttu-id="d554b-303">Étape</span><span class="sxs-lookup"><span data-stu-id="d554b-303">Step</span></span>|<span data-ttu-id="d554b-304">Liens</span><span class="sxs-lookup"><span data-stu-id="d554b-304">Links</span></span>|  
|-|----------|-----------|  
|<span data-ttu-id="d554b-305">**1.**</span><span class="sxs-lookup"><span data-stu-id="d554b-305">**1.**</span></span>|<span data-ttu-id="d554b-306">Les nœuds du centre de données principal reviennent en ligne et rétablissent la communication avec le cluster WSFC.</span><span class="sxs-lookup"><span data-stu-id="d554b-306">The nodes in the main data center come back online and re-establish communication with the WSFC cluster.</span></span> <span data-ttu-id="d554b-307">Leurs réplicas de disponibilité reviennent en ligne en tant que réplicas secondaires avec des bases de données interrompues et l'administrateur de base de données doit rétablir manuellement chacune d'entre elles dans un bref délai.</span><span class="sxs-lookup"><span data-stu-id="d554b-307">Their availability replicas come online as secondary replicas with suspended databases, and the DBA will need to manually resume each of these databases soon.</span></span>|[<span data-ttu-id="d554b-308">Reprendre une base de données de disponibilité &#40;SQL Server&#41;</span><span class="sxs-lookup"><span data-stu-id="d554b-308">Resume an Availability Database &#40;SQL Server&#41;</span></span>](resume-an-availability-database-sql-server.md)<br /><br /> <span data-ttu-id="d554b-309">Conseil : Si vous êtes inquiet de la possible perte de données sur les bases de données primaires suite au basculement, vous devez essayer de créer une capture instantanée de base de données sur les bases de données interrompues sur l’une des bases de données secondaires avec validation synchrone.</span><span class="sxs-lookup"><span data-stu-id="d554b-309">Tip: If you are concerned about possible data loss on the post-failover primary databases, you should attempt to create a database snapshot on the suspended databases on one the synchronous-commit secondary database.</span></span> <span data-ttu-id="d554b-310">Gardez à l'esprit que la troncation du journal des transactions est retardée sur une base de données primaire, lorsque l'une de ses bases de données secondaires est interrompue.</span><span class="sxs-lookup"><span data-stu-id="d554b-310">Keep in mind that the transaction log truncation is delayed on a primary database while any of its secondary databases is suspended.</span></span> <span data-ttu-id="d554b-311">De même, l'état de synchronisation du réplica secondaire avec validation synchrone ne peut pas effectuer la transition vers l'état HEALTHY tant qu'une base de données locale reste interrompue.</span><span class="sxs-lookup"><span data-stu-id="d554b-311">Also the synchronization health of the synchronous-commit secondary replica cannot transition to HEALTHY as long as any local database remains suspended.</span></span>|  
|<span data-ttu-id="d554b-312">**2.**</span><span class="sxs-lookup"><span data-stu-id="d554b-312">**2.**</span></span>|<span data-ttu-id="d554b-313">Une fois que les bases de données ont repris, l'administrateur de base de données change le nouveau réplica principal pour qu'il passe en mode de validation synchrone de manière temporaire.</span><span class="sxs-lookup"><span data-stu-id="d554b-313">Once the databases are resumed, the DBA changes the new primary replica to synchronous-commit mode temporarily.</span></span> <span data-ttu-id="d554b-314">Cela implique deux étapes :</span><span class="sxs-lookup"><span data-stu-id="d554b-314">This involves two steps:</span></span><br /><br /> <span data-ttu-id="d554b-315">1) Modifiez un réplica de disponibilité hors connexion en mode de validation asynchrone.</span><span class="sxs-lookup"><span data-stu-id="d554b-315">1) Change one offline availability replica to asynchronous-commit mode.</span></span> <br /><span data-ttu-id="d554b-316">2) Modifiez le nouveau réplica principal en mode de validation synchrone.</span><span class="sxs-lookup"><span data-stu-id="d554b-316">2) Change the new primary replica to synchronous-commit mode.</span></span><br /><span data-ttu-id="d554b-317">Remarque : Cette étape permet aux bases de données secondaires avec validation synchrone ayant repris de passer à l’état SYNCHRONIZED.</span><span class="sxs-lookup"><span data-stu-id="d554b-317">Note: This step enables resumed synchronous-commit secondary databases to become SYNCHRONIZED.</span></span>|[<span data-ttu-id="d554b-318">Modifier le mode de disponibilité d’un réplica de disponibilité &#40;SQL Server&#41;</span><span class="sxs-lookup"><span data-stu-id="d554b-318">Change the Availability Mode of an Availability Replica &#40;SQL Server&#41;</span></span>](change-the-availability-mode-of-an-availability-replica-sql-server.md)|  
|<span data-ttu-id="d554b-319">**3.**</span><span class="sxs-lookup"><span data-stu-id="d554b-319">**3.**</span></span>|<span data-ttu-id="d554b-320">Une fois que le réplica secondaire avec validation synchrone sur le **nœud 03** (le réplica principal d’origine) passe à l’état de synchronisation HEALTHY, l’administrateur de base de données effectue un basculement planifié manuel vers ce réplica, pour qu’il redevienne le réplica principal.</span><span class="sxs-lookup"><span data-stu-id="d554b-320">Once the synchronous-commit secondary replica on **Node 03** (the original primary replica) enters the HEALTHY synchronization state, the DBA performs a planned manual failover to that replica, to make it the primary replica again.</span></span> <span data-ttu-id="d554b-321">Le réplica sur le **nœud 04** redevient un réplica secondaire.</span><span class="sxs-lookup"><span data-stu-id="d554b-321">The replica on **Node 04** returns to being a secondary replica.</span></span>|[<span data-ttu-id="d554b-322">sys.dm_hadr_database_replica_states &#40;Transact-SQL&#41;</span><span class="sxs-lookup"><span data-stu-id="d554b-322">sys.dm_hadr_database_replica_states &#40;Transact-SQL&#41;</span></span>](/sql/relational-databases/system-dynamic-management-views/sys-dm-hadr-database-replica-states-transact-sql)<br /><br /> [<span data-ttu-id="d554b-323">Utilisez les stratégies AlwaysOn pour afficher l’intégrité d’un groupe de disponibilité &#40;SQL Server&#41;</span><span class="sxs-lookup"><span data-stu-id="d554b-323">Use AlwaysOn Policies to View the Health of an Availability Group &#40;SQL Server&#41;</span></span>](use-always-on-policies-to-view-the-health-of-an-availability-group-sql-server.md)<br /><br /> [<span data-ttu-id="d554b-324">Effectuer un basculement manuel planifié d’un groupe de disponibilité &#40;SQL Server&#41;</span><span class="sxs-lookup"><span data-stu-id="d554b-324">Perform a Planned Manual Failover of an Availability Group &#40;SQL Server&#41;</span></span>](perform-a-planned-manual-failover-of-an-availability-group-sql-server.md)|  
|<span data-ttu-id="d554b-325">**4.**</span><span class="sxs-lookup"><span data-stu-id="d554b-325">**4.**</span></span>|<span data-ttu-id="d554b-326">L'administrateur de base de données se connecte au nouveau réplica principal et :</span><span class="sxs-lookup"><span data-stu-id="d554b-326">The DBA connects to the new primary replica and:</span></span><br /><br /> <span data-ttu-id="d554b-327">1) Modifie l’ancien réplica principal (dans le centre distant) pour qu’il repasse en mode de validation asynchrone.</span><span class="sxs-lookup"><span data-stu-id="d554b-327">1) Changes the former primary replica (in the remote center) back to asynchronous-commit mode.</span></span><br /><span data-ttu-id="d554b-328">2) Modifie le réplica secondaire avec validation asynchrone dans le centre de données principal pour qu’il repasse en mode de validation synchrone</span><span class="sxs-lookup"><span data-stu-id="d554b-328">2) Changes the asynchronous-commit secondary replica in the main data center back to synchronous-commit mode.</span></span>|[<span data-ttu-id="d554b-329">Modifier le mode de disponibilité d’un réplica de disponibilité &#40;SQL Server&#41;</span><span class="sxs-lookup"><span data-stu-id="d554b-329">Change the Availability Mode of an Availability Replica &#40;SQL Server&#41;</span></span>](change-the-availability-mode-of-an-availability-replica-sql-server.md)|  
  
##  <a name="related-tasks"></a><a name="RelatedTasks"></a> <span data-ttu-id="d554b-330">Tâches associées</span><span class="sxs-lookup"><span data-stu-id="d554b-330">Related Tasks</span></span>  
 <span data-ttu-id="d554b-331">**Pour ajuster les votes de quorum**</span><span class="sxs-lookup"><span data-stu-id="d554b-331">**To adjust quorum votes**</span></span>  
  
-   [<span data-ttu-id="d554b-332">Afficher les paramètres NodeWeight pour le quorum de cluster</span><span class="sxs-lookup"><span data-stu-id="d554b-332">View Cluster Quorum NodeWeight Settings</span></span>](../../../sql-server/failover-clusters/windows/view-cluster-quorum-nodeweight-settings.md)  
  
-   [<span data-ttu-id="d554b-333">Configurer les paramètres NodeWeight pour un quorum de cluster</span><span class="sxs-lookup"><span data-stu-id="d554b-333">Configure Cluster Quorum NodeWeight Settings</span></span>](../../../sql-server/failover-clusters/windows/configure-cluster-quorum-nodeweight-settings.md)  
  
-   [<span data-ttu-id="d554b-334">Forcer un cluster WSFC à démarrer sans quorum</span><span class="sxs-lookup"><span data-stu-id="d554b-334">Force a WSFC Cluster to Start Without a Quorum</span></span>](../../../sql-server/failover-clusters/windows/force-a-wsfc-cluster-to-start-without-a-quorum.md)  
  
 <span data-ttu-id="d554b-335">**Basculement manuel planifié :**</span><span class="sxs-lookup"><span data-stu-id="d554b-335">**Planned manual failover:**</span></span>  
  
-   [<span data-ttu-id="d554b-336">Effectuer un basculement manuel planifié d’un groupe de disponibilité &#40;SQL Server&#41;</span><span class="sxs-lookup"><span data-stu-id="d554b-336">Perform a Planned Manual Failover of an Availability Group &#40;SQL Server&#41;</span></span>](perform-a-planned-manual-failover-of-an-availability-group-sql-server.md)  
  
-   [<span data-ttu-id="d554b-337">Utiliser l’Assistant Basculer le groupe de disponibilité &#40;SQL Server Management Studio&#41;</span><span class="sxs-lookup"><span data-stu-id="d554b-337">Use the Fail Over Availability Group Wizard &#40;SQL Server Management Studio&#41;</span></span>](use-the-fail-over-availability-group-wizard-sql-server-management-studio.md)  
  
 <span data-ttu-id="d554b-338">**Pour dépanner :**</span><span class="sxs-lookup"><span data-stu-id="d554b-338">**To troubleshoot:**</span></span>  
  
-   [<span data-ttu-id="d554b-339">Résoudre les problèmes de configuration groupes de disponibilité AlwaysOn &#40;SQL Server&#41;</span><span class="sxs-lookup"><span data-stu-id="d554b-339">Troubleshoot AlwaysOn Availability Groups Configuration &#40;SQL Server&#41;</span></span>](troubleshoot-always-on-availability-groups-configuration-sql-server.md) 
  
-   [<span data-ttu-id="d554b-340">Résoudre les problèmes liés à l’échec d’une opération d’ajout de fichier &#40;groupes de disponibilité AlwaysOn&#41;</span><span class="sxs-lookup"><span data-stu-id="d554b-340">Troubleshoot a Failed Add-File Operation &#40;AlwaysOn Availability Groups&#41;</span></span>](troubleshoot-a-failed-add-file-operation-always-on-availability-groups.md)  
  
##  <a name="related-content"></a><a name="RelatedContent"></a> <span data-ttu-id="d554b-341">Contenu associé</span><span class="sxs-lookup"><span data-stu-id="d554b-341">Related Content</span></span>  
  
-   <span data-ttu-id="d554b-342">**Blogs :**</span><span class="sxs-lookup"><span data-stu-id="d554b-342">**Blogs:**</span></span>  
  
     [<span data-ttu-id="d554b-343">Blogs de l'équipe de SQL Server AlwaysOn : Blog officiel de l'équipe de SQL Server AlwaysOn</span><span class="sxs-lookup"><span data-stu-id="d554b-343">SQL Server AlwaysOn Team Blogs: The official SQL Server AlwaysOn Team Blog</span></span>](https://blogs.msdn.com/b/sqlalwayson/)  
  
     [<span data-ttu-id="d554b-344">Blogs des ingénieurs du Service clientèle et du Support technique de SQL Server</span><span class="sxs-lookup"><span data-stu-id="d554b-344">CSS SQL Server Engineers Blogs</span></span>](https://blogs.msdn.com/b/psssql/)  
  
-   <span data-ttu-id="d554b-345">**Livres blancs :**</span><span class="sxs-lookup"><span data-stu-id="d554b-345">**Whitepapers:**</span></span>  
  
     [<span data-ttu-id="d554b-346">Guide de solutions Microsoft SQL Server AlwaysOn pour la haute disponibilité et la récupération d'urgence</span><span class="sxs-lookup"><span data-stu-id="d554b-346">Microsoft SQL Server AlwaysOn Solutions Guide for High Availability and Disaster Recovery</span></span>](https://go.microsoft.com/fwlink/?LinkId=227600)  
  
     [<span data-ttu-id="d554b-347">Livres blancs de Microsoft pour SQL Server 2012</span><span class="sxs-lookup"><span data-stu-id="d554b-347">Microsoft White Papers for SQL Server 2012</span></span>](https://msdn.microsoft.com/library/hh403491.aspx)  
  
     [<span data-ttu-id="d554b-348">Livres blancs de l'équipe de consultants clients de SQL Server</span><span class="sxs-lookup"><span data-stu-id="d554b-348">SQL Server Customer Advisory Team Whitepapers</span></span>](http://sqlcat.com/)  
  
## <a name="see-also"></a><span data-ttu-id="d554b-349">Voir aussi</span><span class="sxs-lookup"><span data-stu-id="d554b-349">See Also</span></span>  
 <span data-ttu-id="d554b-350">[Vue d’ensemble de groupes de disponibilité AlwaysOn &#40;SQL Server&#41;](overview-of-always-on-availability-groups-sql-server.md) </span><span class="sxs-lookup"><span data-stu-id="d554b-350">[Overview of AlwaysOn Availability Groups &#40;SQL Server&#41;](overview-of-always-on-availability-groups-sql-server.md) </span></span>  
 <span data-ttu-id="d554b-351">[Modes de disponibilité &#40;groupes de disponibilité AlwaysOn&#41;](availability-modes-always-on-availability-groups.md) </span><span class="sxs-lookup"><span data-stu-id="d554b-351">[Availability Modes &#40;AlwaysOn Availability Groups&#41;](availability-modes-always-on-availability-groups.md) </span></span>  
 <span data-ttu-id="d554b-352">[Basculement et modes de basculement &#40;groupes de disponibilité AlwaysOn&#41;](failover-and-failover-modes-always-on-availability-groups.md) </span><span class="sxs-lookup"><span data-stu-id="d554b-352">[Failover and Failover Modes &#40;AlwaysOn Availability Groups&#41;](failover-and-failover-modes-always-on-availability-groups.md) </span></span>  
 <span data-ttu-id="d554b-353">[À propos de l’accès de la connexion client aux réplicas de disponibilité &#40;SQL Server&#41;](about-client-connection-access-to-availability-replicas-sql-server.md) </span><span class="sxs-lookup"><span data-stu-id="d554b-353">[About Client Connection Access to Availability Replicas &#40;SQL Server&#41;](about-client-connection-access-to-availability-replicas-sql-server.md) </span></span>  
 <span data-ttu-id="d554b-354">[Surveillance des groupes de disponibilité &#40;SQL Server&#41;](monitoring-of-availability-groups-sql-server.md) </span><span class="sxs-lookup"><span data-stu-id="d554b-354">[Monitoring of Availability Groups &#40;SQL Server&#41;](monitoring-of-availability-groups-sql-server.md) </span></span>  
 [<span data-ttu-id="d554b-355">Clustering de basculement Windows Server &#40;WSFC&#41; avec SQL Server</span><span class="sxs-lookup"><span data-stu-id="d554b-355">Windows Server Failover Clustering &#40;WSFC&#41; with SQL Server</span></span>](../../../sql-server/failover-clusters/windows/windows-server-failover-clustering-wsfc-with-sql-server.md)  
  
  
