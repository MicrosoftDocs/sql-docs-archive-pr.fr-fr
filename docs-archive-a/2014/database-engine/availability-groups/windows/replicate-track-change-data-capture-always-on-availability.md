---
title: Réplication, Change Tracking, capture de données modifiées et groupes de disponibilité AlwaysOn (SQL Server) | Microsoft Docs
ms.custom: ''
ms.date: 06/13/2017
ms.prod: sql-server-2014
ms.reviewer: ''
ms.technology: high-availability
ms.topic: conceptual
helpviewer_keywords:
- change tracking [SQL Server], AlwaysOn Availability Groups
- change data capture [SQL Server], AlwaysOn Availability Groups
- Availability Groups [SQL Server], interoperability
- replication [SQL Server], AlwaysOn Availability Groups
ms.assetid: e17a9ca9-dd96-4f84-a85d-60f590da96ad
author: MashaMSFT
ms.author: mathoma
ms.openlocfilehash: e8ea6257cb906177b9eb224d718eecf54fb94119
ms.sourcegitcommit: ad4d92dce894592a259721a1571b1d8736abacdb
ms.translationtype: MT
ms.contentlocale: fr-FR
ms.lasthandoff: 08/04/2020
ms.locfileid: "87603044"
---
# <a name="replication-change-tracking-change-data-capture-and-alwayson-availability-groups-sql-server"></a><span data-ttu-id="8cc33-102">Réplication, suivi des modifications, capture de données modifiées et groupes de disponibilité AlwaysOn (SQL Server)</span><span class="sxs-lookup"><span data-stu-id="8cc33-102">Replication, Change Tracking, Change Data Capture, and AlwaysOn Availability Groups (SQL Server)</span></span>
  [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] <span data-ttu-id="8cc33-103">La réplication, la capture de données modifiées (CDC) et le suivi des modifications (CT) sont pris en charge sur [!INCLUDE[ssHADR](../../../includes/sshadr-md.md)].</span><span class="sxs-lookup"><span data-stu-id="8cc33-103">Replication, change data capture (CDC), and change tracking (CT) are supported on [!INCLUDE[ssHADR](../../../includes/sshadr-md.md)].</span></span> [!INCLUDE[ssHADR](../../../includes/sshadr-md.md)] <span data-ttu-id="8cc33-104">aide à fournir des fonctionnalités haute disponibilité et de récupération de base de données supplémentaires.</span><span class="sxs-lookup"><span data-stu-id="8cc33-104">helps provide high availability and additional database recovery capabilities.</span></span>  
  
 
  
##  <a name="overview-of-replication-on-alwayson-availability-groups"></a><a name="Overview"></a><span data-ttu-id="8cc33-105">Vue d’ensemble de la réplication sur groupes de disponibilité AlwaysOn</span><span class="sxs-lookup"><span data-stu-id="8cc33-105">Overview of Replication on AlwaysOn Availability Groups</span></span>  
  
###  <a name="publisher-redirection"></a><a name="PublisherRedirect"></a> <span data-ttu-id="8cc33-106">Redirection de serveur de publication</span><span class="sxs-lookup"><span data-stu-id="8cc33-106">Publisher Redirection</span></span>  
 <span data-ttu-id="8cc33-107">Lorsqu'une base de données publiée repose sur la technologie [!INCLUDE[ssHADR](../../../includes/sshadr-md.md)], le serveur de distribution qui offre un accès d'agent à la base de données de publication est configuré avec des entrées redirected_publishers.</span><span class="sxs-lookup"><span data-stu-id="8cc33-107">When a published database is aware of [!INCLUDE[ssHADR](../../../includes/sshadr-md.md)], the distributor that provides agent access to the publishing database is configured with redirected_publishers entries.</span></span> <span data-ttu-id="8cc33-108">Ces entrées redirigent la combinaison serveur de publication/base de données initialement configurée, en se servant d'un nom d'écouteur de groupe de disponibilité pour se connecter au serveur de publication et à la base de données de publication.</span><span class="sxs-lookup"><span data-stu-id="8cc33-108">These entries redirect the originally configured publisher/database pair, making use of an availability group listener name to connect to the publisher and publishing database.</span></span> <span data-ttu-id="8cc33-109">Les connexions établies via le nom d'écouteur de groupe de disponibilité échouent lors d'un basculement.</span><span class="sxs-lookup"><span data-stu-id="8cc33-109">Established connections through the availability group listener name will fail on failover.</span></span> <span data-ttu-id="8cc33-110">Lors du redémarrage de l'agent de réplication, à l'issue du basculement, la connexion est automatiquement redirigée vers le nouveau principal.</span><span class="sxs-lookup"><span data-stu-id="8cc33-110">When the replication agent restarts after failover, the connection will automatically be redirected to the new primary.</span></span>  
  
 <span data-ttu-id="8cc33-111">Dans un groupe de disponibilité AlwaysOn, une base de données secondaire ne peut pas être un serveur de publication.</span><span class="sxs-lookup"><span data-stu-id="8cc33-111">In an AlwaysOn availability group a secondary database cannot be a publisher.</span></span> <span data-ttu-id="8cc33-112">La republication n'est pas prise en charge lorsque la réplication est associée à [!INCLUDE[ssHADR](../../../includes/sshadr-md.md)].</span><span class="sxs-lookup"><span data-stu-id="8cc33-112">Republishing is not supported when replication is combined with [!INCLUDE[ssHADR](../../../includes/sshadr-md.md)].</span></span>  
  
 <span data-ttu-id="8cc33-113">Si une base de données publiée est membre d'un groupe de disponibilité et que le serveur de publication est redirigé, il doit être redirigé vers un nom d'écouteur de groupe de disponibilité associé au groupe de disponibilité.</span><span class="sxs-lookup"><span data-stu-id="8cc33-113">If a published database is a member of an availability group and the publisher is redirected, it must be redirected to an availability group listener name associated with the availability group.</span></span> <span data-ttu-id="8cc33-114">Il ne peut pas être redirigé vers un nœud explicite.</span><span class="sxs-lookup"><span data-stu-id="8cc33-114">It may not be redirected to an explicit node.</span></span>  
  
> [!NOTE]  
>  <span data-ttu-id="8cc33-115">Après un basculement vers un réplica secondaire, le Moniteur de réplication ne peut pas ajuster le nom de l'instance de publication de [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] et continue à afficher les informations de réplication sous le nom de l'instance principale [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)]d'origine.</span><span class="sxs-lookup"><span data-stu-id="8cc33-115">After failover to a secondary replica, Replication Monitor is unable to adjust the name of the publishing instance of [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] and will continue to display replication information under the name of the original primary instance of [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)].</span></span> <span data-ttu-id="8cc33-116">Après le basculement, un jeton de suivi ne peut pas être écrit à l'aide du Moniteur de réplication, toutefois un jeton de suivi écrit sur le nouveau serveur de publication à l'aide de [!INCLUDE[tsql](../../../includes/tsql-md.md)]est visible dans le Moniteur de réplication.</span><span class="sxs-lookup"><span data-stu-id="8cc33-116">After failover, a tracer token cannot be entered by using the Replication Monitor, however a tracer token entered on the new publisher by using [!INCLUDE[tsql](../../../includes/tsql-md.md)], is visible in Replication Monitor.</span></span>  
  
###  <a name="general-changes-to-replication-agents-to-support-alwayson-availability-groups"></a><a name="Changes"></a><span data-ttu-id="8cc33-117">Modifications générales apportées aux agents de réplication pour prendre en charge groupes de disponibilité AlwaysOn</span><span class="sxs-lookup"><span data-stu-id="8cc33-117">General Changes to Replication Agents to Support AlwaysOn Availability Groups</span></span>  
 <span data-ttu-id="8cc33-118">Trois agents de réplication ont été modifiés pour prendre en charge [!INCLUDE[ssHADR](../../../includes/sshadr-md.md)].</span><span class="sxs-lookup"><span data-stu-id="8cc33-118">Three replication agents were modified to support [!INCLUDE[ssHADR](../../../includes/sshadr-md.md)].</span></span> <span data-ttu-id="8cc33-119">L'agent de lecture du journal, ainsi que les agents d'instantané et de fusion ont été modifiés pour interroger la base de données de distribution pour le serveur de publication redirigé et pour utiliser le nom d'écouteur de groupe de disponibilité retourné, si un serveur de publication redirigé était déclaré, pour se connecter au serveur de publication de base de données.</span><span class="sxs-lookup"><span data-stu-id="8cc33-119">The Log Reader, Snapshot, and Merge agents were modified to query the distribution database for the redirected publisher and to use the returned availability group listener name, if a redirected publisher was declared, to connect to the database publisher.</span></span>  
  
 <span data-ttu-id="8cc33-120">Par défaut, lorsque les agents interrogent le serveur de distribution afin de déterminer si le serveur de publication d'origine a été redirigé, l'adéquation de la cible actuelle ou de la redirection est vérifiée avant de retourner l'hôte redirigé à l'agent.</span><span class="sxs-lookup"><span data-stu-id="8cc33-120">By default, when the agents query the distributor to determine whether the original publisher has been redirected, the suitability of the current target or redirection will be verified prior to returning the redirected host to the agent.</span></span> <span data-ttu-id="8cc33-121">Il s'agit du comportement recommandé.</span><span class="sxs-lookup"><span data-stu-id="8cc33-121">This is recommended behavior.</span></span> <span data-ttu-id="8cc33-122">Toutefois, si le démarrage de l'agent se produit très fréquemment, la surcharge liée à la procédure stockée de validation peut être considérée comme trop importante.</span><span class="sxs-lookup"><span data-stu-id="8cc33-122">However, if agent start up occurs very frequently the overhead associated with the validation stored procedure may be deemed too costly.</span></span> <span data-ttu-id="8cc33-123">Un nouveau commutateur de ligne de commande, *BypassPublisherValidation*, a été ajouté à l'agent de lecture du journal, ainsi qu'aux agents d'instantané et de fusion.</span><span class="sxs-lookup"><span data-stu-id="8cc33-123">A new command line switch, *BypassPublisherValidation*, has been added to the Logreader, Snapshot, and Merge agents.</span></span> <span data-ttu-id="8cc33-124">Lorsque le commutateur est utilisé, le serveur de publication redirigé est retourné immédiatement à l'agent et l'exécution de la procédure stockée de validation est ignorée.</span><span class="sxs-lookup"><span data-stu-id="8cc33-124">When the switch is used, the redirected publisher is returned immediately to the agent and execution of the validation stored procedure is bypassed.</span></span>  
  
 <span data-ttu-id="8cc33-125">Les échecs retournés de la procédure stockée de validation sont consignés dans les journaux d'historique de l'agent.</span><span class="sxs-lookup"><span data-stu-id="8cc33-125">Failures returned from the validation stored procedure are logged in the agent history logs.</span></span> <span data-ttu-id="8cc33-126">Les erreurs dont le niveau de gravité est supérieur ou égal à 16 entraîneront l'arrêt des agents.</span><span class="sxs-lookup"><span data-stu-id="8cc33-126">Those errors with severity greater than or equal to 16 will cause the agents to terminate.</span></span> <span data-ttu-id="8cc33-127">Certaines fonctions de reprise ont été intégrées aux agents afin de gérer la déconnexion attendue d'une base de données publiée en cas de basculement vers un nouveau principal.</span><span class="sxs-lookup"><span data-stu-id="8cc33-127">Some retry capabilities have been built in to the agents to handle the expected disconnect from a published database when it fails over to a new primary.</span></span>  
  
#### <a name="log-reader-agent-modifications"></a><span data-ttu-id="8cc33-128">Modifications apportées à l'agent de lecture du journal</span><span class="sxs-lookup"><span data-stu-id="8cc33-128">Log Reader Agent Modifications</span></span>  
 <span data-ttu-id="8cc33-129">L'agent de lecture du journal comporte les modifications suivantes.</span><span class="sxs-lookup"><span data-stu-id="8cc33-129">The Logreader Agent has the following changes.</span></span>  
  
-   <span data-ttu-id="8cc33-130">**Cohérence de bases de données répliquées**</span><span class="sxs-lookup"><span data-stu-id="8cc33-130">**Replicated Database Consistency**</span></span>  
  
     <span data-ttu-id="8cc33-131">Lorsqu'une base de données publiée est membre d'un groupe de disponibilité AlwaysOn, par défaut l'agent de lecture du journal ne traite pas les enregistrements de journal qui n'ont pas déjà été renforcés au niveau de tous les réplicas secondaires de groupe de disponibilité.</span><span class="sxs-lookup"><span data-stu-id="8cc33-131">When a published database is a member of an AlwaysOn availability group, by default the log reader will not process log records that have not already been hardened at all availability group secondary replicas.</span></span> <span data-ttu-id="8cc33-132">Cela permet de s'assurer que lors du basculement, toutes les lignes répliquées sur un abonné sont également présentes dans le nouveau principal.</span><span class="sxs-lookup"><span data-stu-id="8cc33-132">This insures that on failover, all rows replicated to a subscriber also are present at the new primary.</span></span>  
  
     <span data-ttu-id="8cc33-133">Lorsque le serveur de publication dispose de deux réplicas de disponibilité AlwaysOn uniquement (un principal et un secondaire) et qu'un basculement a lieu, le réplica principal d'origine reste arrêté, car le lecteur de journal n'avance pas tant que toutes les bases de données secondaires ne sont pas remises en ligne ou tant que les réplicas secondaires défaillants n'ont pas été supprimés du groupe de disponibilité.</span><span class="sxs-lookup"><span data-stu-id="8cc33-133">When the publisher has only two AlwaysOn availability replicas (one primary and one secondary) and a failover happens, the original primary replica remains down because the logreader does not move forward until all secondary databases are brought back online or until the failing secondary replicas are removed from the availability group.</span></span> <span data-ttu-id="8cc33-134">Le lecteur de journal, qui s'exécute à présent sur la base de données secondaire, n'avance pas étant donné que AlwaysOn ne peut pas renforcer de modifications sur une base de données secondaire.</span><span class="sxs-lookup"><span data-stu-id="8cc33-134">The logreader, now running against the secondary database, will not proceed forward since AlwaysOn cannot harden any changes to any secondary database.</span></span> <span data-ttu-id="8cc33-135">Pour permettre au lecteur de journal de poursuivre et de continuer à disposer de la capacité de récupération d'urgence, supprimez le réplica principal d'origine du groupe de disponibilité à l'aide de ALTER AVAILABITY GROUP <nom_groupe> REMOVE REPLICA.</span><span class="sxs-lookup"><span data-stu-id="8cc33-135">To allow the logreader to proceed further and still have disaster recovery capacity, remove the original primary replica from the availability group using ALTER AVAILABITY GROUP <group_name> REMOVE REPLICA.</span></span> <span data-ttu-id="8cc33-136">Ajoutez ensuite un nouveau réplica secondaire au groupe de disponibilité.</span><span class="sxs-lookup"><span data-stu-id="8cc33-136">Then add a new secondary replica to the availability group.</span></span>  
  
-   <span data-ttu-id="8cc33-137">**Indicateur de trace 1448**</span><span class="sxs-lookup"><span data-stu-id="8cc33-137">**Trace flag 1448**</span></span>  
  
     <span data-ttu-id="8cc33-138">L'indicateur de trace 1448 permet à l'agent de lecture du journal de réplication d'avancer même si les réplicas secondaires asynchrones n'ont pas accusé réception d'une modification.</span><span class="sxs-lookup"><span data-stu-id="8cc33-138">Trace flag 1448 enables the replication log reader to move forward even if the asynchronous secondary replicas have not acknowledged the reception of a change.</span></span> <span data-ttu-id="8cc33-139">Même si cet indicateur de trace est activé, l'agent de lecture de journal attend toujours les réplicas secondaires synchrones.</span><span class="sxs-lookup"><span data-stu-id="8cc33-139">Even with this trace flag enabled,, the log reader always waits for the synchronous secondary replicas.</span></span> <span data-ttu-id="8cc33-140">L'agent de lecture du journal n'ira pas au delà de l'accusé réception minimum des réplicas secondaires synchrones.</span><span class="sxs-lookup"><span data-stu-id="8cc33-140">The log reader will not go beyond the min ack of the synchronous secondary replicas.</span></span> <span data-ttu-id="8cc33-141">Cet indicateur de trace s'applique à l'instance de [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)], et pas simplement à un groupe de disponibilité, à une base de données de disponibilité ou à une instance de l'agent de lecture de journal.</span><span class="sxs-lookup"><span data-stu-id="8cc33-141">This trace flag applies to the instance of [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)], not just to an availability group, an availability database, or a log reader instance.</span></span> <span data-ttu-id="8cc33-142">Cet indicateur de trace prend effet immédiatement, sans redémarrage.</span><span class="sxs-lookup"><span data-stu-id="8cc33-142">This trace flag takes effect immediately without a restart.</span></span> <span data-ttu-id="8cc33-143">Il peut être activé d'avance ou lorsque le réplica secondaire asynchrone échoue.</span><span class="sxs-lookup"><span data-stu-id="8cc33-143">It can be activated ahead of time or when an asynchronous secondary replica fails.</span></span>  
  
###  <a name="stored-procedures-supporting-alwayson"></a><a name="StoredProcs"></a><span data-ttu-id="8cc33-144">Procédures stockées prenant en charge AlwaysOn</span><span class="sxs-lookup"><span data-stu-id="8cc33-144">Stored Procedures Supporting AlwaysOn</span></span>  
  
-   <span data-ttu-id="8cc33-145">**sp_redirect_publisher**</span><span class="sxs-lookup"><span data-stu-id="8cc33-145">**sp_redirect_publisher**</span></span>  
  
     <span data-ttu-id="8cc33-146">La procédure stockée **sp_redirect_publisher** permet de spécifier un serveur de publication redirigé pour une combinaison existante serveur de publication/base de données.</span><span class="sxs-lookup"><span data-stu-id="8cc33-146">The stored procedure **sp_redirect_publisher** is used to specify a redirected publisher for an existing publisher/database pair.</span></span> <span data-ttu-id="8cc33-147">Si la base de données du serveur de publication appartient à un groupe de disponibilité, le serveur de publication redirigé correspond au nom d'écouteur de groupe de disponibilité.</span><span class="sxs-lookup"><span data-stu-id="8cc33-147">If the publisher database belongs to an availability group, the redirected publisher is the availability group listener name.</span></span>  
  
-   <span data-ttu-id="8cc33-148">**Sp_get_redirected_publisher**</span><span class="sxs-lookup"><span data-stu-id="8cc33-148">**sp_get_redirected_publisher**</span></span>  
  
     <span data-ttu-id="8cc33-149">La procédure stockée **sp_get_redirected_publisher** permet aux agents de réplication d’interroger un serveur de distribution pour déterminer si une combinaison serveur de publication/base de données dispose d’un serveur de publication redirigé défini.</span><span class="sxs-lookup"><span data-stu-id="8cc33-149">The stored procedure **sp_get_redirected_publisher** is used by replication agents to query a distributor to determine whether a publisher/database pair has a defined redirected publisher.</span></span> <span data-ttu-id="8cc33-150">Cette procédure stockée remplit deux objectifs.</span><span class="sxs-lookup"><span data-stu-id="8cc33-150">This stored procedure serves two purposes.</span></span> <span data-ttu-id="8cc33-151">En premier lieu, elle permet à l'agent de déterminer si le serveur de publication d'origine a été redirigé.</span><span class="sxs-lookup"><span data-stu-id="8cc33-151">First, it allows the agent to determine whether the original publisher has been redirected.</span></span> <span data-ttu-id="8cc33-152">Ensuite, elle peut également initier une procédure stockée de validation exécutée sur le serveur de distribution (**sp_validate_redirected_publisher**) qui vérifie l’adéquation du nœud cible de la redirection pour servir de serveur de publication pour la base de données nommée.</span><span class="sxs-lookup"><span data-stu-id="8cc33-152">Second, it may also initiate a validation stored procedure run at the distributor (**sp_validate_redirected_publisher**) that verifies the suitability of the target node of the redirection to serve as a publisher for the named database.</span></span>  
  
     <span data-ttu-id="8cc33-153">Pour exécuter cette procédure stockée, l’appelant doit être membre du rôle serveur **sysadmin** , du rôle de base de données **db_owner** de la base de données de distribution, ou être membre d’une **liste d’accès à une publication** pour une publication définie associée à la base de données du serveur de publication.</span><span class="sxs-lookup"><span data-stu-id="8cc33-153">To execute this stored procedure the caller must either be a member of the **sysadmin** server role, the **db_owner** database role for the distribution database, or a member of a **Publication Access List** for a defined publication associated with the publisher database.</span></span>  
  
-   <span data-ttu-id="8cc33-154">**sp_validate_redirected_publisher**</span><span class="sxs-lookup"><span data-stu-id="8cc33-154">**sp_validate_redirected_publisher**</span></span>  
  
     <span data-ttu-id="8cc33-155">Cette procédure stockée tente de valider que le serveur de publication actuel est capable d'héberger la base de données publiée.</span><span class="sxs-lookup"><span data-stu-id="8cc33-155">This stored procedure attempts to validate that the current publisher is capable of hosting the published database.</span></span> <span data-ttu-id="8cc33-156">Elle peut être appelée à tout moment pour vérifier que l'hôte actuel de la base de données publiée est en mesure de prendre en charge la réplication.</span><span class="sxs-lookup"><span data-stu-id="8cc33-156">It can be called at any time to verify that the current host for the published database is capable of supporting replication.</span></span>  
  
-   <span data-ttu-id="8cc33-157">**sp_validate_replicate_hosts_as_publishers**</span><span class="sxs-lookup"><span data-stu-id="8cc33-157">**sp_validate_replicate_hosts_as_publishers**</span></span>  
  
     <span data-ttu-id="8cc33-158">S'il est utile que les agents vérifient que le serveur principal actuel peut fonctionner comme serveur de publication de réplication pour une base de données du serveur de publication, une fonctionnalité de validation plus générale est nécessaire pour établir la validité d'une topologie de réplication dans une base de données de disponibilité AlwaysOn.</span><span class="sxs-lookup"><span data-stu-id="8cc33-158">While it is useful for the agents to insure that the current primary can function as the replication publisher for a publisher database, a more general validation capability is needed to establish the validity of an entire replication topology on an AlwaysOn availability database.</span></span> <span data-ttu-id="8cc33-159">La procédure stockée **sp_validate_replica_hosts_as_publishers** est conçue pour satisfaire à ce besoin.</span><span class="sxs-lookup"><span data-stu-id="8cc33-159">The stored procedure **sp_validate_replica_hosts_as_publishers** is designed to fill this need.</span></span>  
  
     <span data-ttu-id="8cc33-160">Cette procédure stockée est toujours exécutée manuellement.</span><span class="sxs-lookup"><span data-stu-id="8cc33-160">This stored procedure is always run manually.</span></span> <span data-ttu-id="8cc33-161">L'appelant doit être **sysadmin** sur le serveur de distribution, **dbowner** de la base de données de distribution ou un membre de la **liste d'accès à la publication** d'une publication de la base de données du serveur de publication.</span><span class="sxs-lookup"><span data-stu-id="8cc33-161">The caller must either be **sysadmin** at the distributor, **dbowner** of the distribution database, or a member of the **Publication Access List** of a publication of the publisher database.</span></span> <span data-ttu-id="8cc33-162">En outre, l'identifiant de connexion de l'appelant doit être un identifiant valide pour tous les hôtes de réplica de groupe de disponibilité, et disposer de privilèges de sélection sur la base de données de disponibilité associée à la base de données du serveur de publication.</span><span class="sxs-lookup"><span data-stu-id="8cc33-162">In addition, the login of the caller must be a valid login for all of the availability replica hosts, and have select privileges on the availability database associated with the publisher database.</span></span>  
  
###  <a name="change-data-capture"></a><a name="CDC"></a> <span data-ttu-id="8cc33-163">Capture de données modifiées</span><span class="sxs-lookup"><span data-stu-id="8cc33-163">Change Data Capture</span></span>  
 <span data-ttu-id="8cc33-164">Les bases de données activées pour la capture de données modifiées (CDC) peuvent tirer parti de [!INCLUDE[ssHADR](../../../includes/sshadr-md.md)] afin d'assurer que non seulement la base de données reste disponible en cas de défaillance, mais également que les modifications apportées aux tables de base de données continuent d'être surveillées et déposées dans les tables de modifications de capture de données modifiées.</span><span class="sxs-lookup"><span data-stu-id="8cc33-164">Databases enabled for change data capture (CDC) are able to leverage [!INCLUDE[ssHADR](../../../includes/sshadr-md.md)] in order to insure not only that the database remains available in the event of failure, but that changes to the database tables continue to be monitored and deposited in the CDC change tables.</span></span> <span data-ttu-id="8cc33-165">L'ordre dans lequel la capture de données modifiées et [!INCLUDE[ssHADR](../../../includes/sshadr-md.md)] sont configurés n'est pas important.</span><span class="sxs-lookup"><span data-stu-id="8cc33-165">The order in which CDC and [!INCLUDE[ssHADR](../../../includes/sshadr-md.md)] are configured is not important.</span></span> <span data-ttu-id="8cc33-166">Les bases de données activées pour la capture de données modifiées peuvent être ajoutées à [!INCLUDE[ssHADR](../../../includes/sshadr-md.md)], et celles qui sont membres d'un groupe de disponibilité AlwaysOn peuvent être activées pour la capture de données modifiées.</span><span class="sxs-lookup"><span data-stu-id="8cc33-166">CDC enabled databases can be added to [!INCLUDE[ssHADR](../../../includes/sshadr-md.md)], and databases that are members of an AlwaysOn availability group can be enabled for CDC.</span></span> <span data-ttu-id="8cc33-167">Dans les deux cas, toutefois, la configuration de la capture de données modifiées est toujours effectuée sur le réplica principal actuel ou prévu.</span><span class="sxs-lookup"><span data-stu-id="8cc33-167">In both cases, however, CDC configuration is always performed on the current or intended primary replica.</span></span> <span data-ttu-id="8cc33-168">CDC utilise l'agent de lecture du journal et est soumis aux mêmes limitations décrites dans la section **Modifications apportées à l'agent de lecture du journal** plus haut dans cette rubrique.</span><span class="sxs-lookup"><span data-stu-id="8cc33-168">CDC uses the log reader agent and has the same limitations as described in the **Log Reader Agent Modifications** section earlier in this topic.</span></span>  
  
-   <span data-ttu-id="8cc33-169">**Récolte des modifications pour la capture de données modifiées sans réplication**</span><span class="sxs-lookup"><span data-stu-id="8cc33-169">**Harvesting Changes for Change Data Capture Without Replication**</span></span>  
  
     <span data-ttu-id="8cc33-170">Si la capture de données modifiées est activée pour une base de données, mais que la réplication ne l'est pas, le processus de capture utilisé pour récolter les modifications à partir du journal et les déposer dans les tables de modifications de capture de données modifiées s'exécute au niveau de l'hôte de capture de données modifiées comme son propre travail de l'Agent SQL.</span><span class="sxs-lookup"><span data-stu-id="8cc33-170">If CDC is enabled for a database, but replication is not, the capture process used to harvest changes from the log and deposit them in CDC change tables runs at the CDC host as its own SQL Agent job.</span></span>  
  
     <span data-ttu-id="8cc33-171">Pour reprendre la récolte des modifications après un basculement, la procédure stockée **sp_cdc_add_job** doit être exécutée au niveau du nouveau principal pour créer le travail de capture local.</span><span class="sxs-lookup"><span data-stu-id="8cc33-171">In order to resume the harvesting of changes after failover, the stored procedure **sp_cdc_add_job** must be run at the new primary to create the local capture job.</span></span>  
  
     <span data-ttu-id="8cc33-172">L'exemple suivant crée le travail de capture.</span><span class="sxs-lookup"><span data-stu-id="8cc33-172">The following example creates the capture job.</span></span>  
  
    ```  
    EXEC sys.sp_cdc_add_job @job_type = 'capture';  
    ```  
  
-   <span data-ttu-id="8cc33-173">**Récolte des modifications pour la capture de données modifiées avec réplication**</span><span class="sxs-lookup"><span data-stu-id="8cc33-173">**Harvesting Changes for Change Data Capture With Replication**</span></span>  
  
     <span data-ttu-id="8cc33-174">Si la capture de données modifiées et la réplication sont activées pour une base de données, le lecteur de journal gère le flux des tables de modifications de capture de données modifiées.</span><span class="sxs-lookup"><span data-stu-id="8cc33-174">If both CDC and replication are enabled for a database, the log reader handles the population of the CDC change tables.</span></span> <span data-ttu-id="8cc33-175">Dans ce cas, les techniques utilisées par la réplication pour tirer parti de [!INCLUDE[ssHADR](../../../includes/sshadr-md.md)] s'assurent que les modifications continuent d'être récoltées à partir du journal et à être déposées dans les tables de modifications de capture de données modifiées après le basculement.</span><span class="sxs-lookup"><span data-stu-id="8cc33-175">In this case, the techniques used by replication to leverage [!INCLUDE[ssHADR](../../../includes/sshadr-md.md)] will insure that changes continue to be harvested from the log and deposited in CDC change tables after failover.</span></span> <span data-ttu-id="8cc33-176">Aucune opération supplémentaire ne doit être effectuée pour la capture de données modifiées dans cette configuration pour que les tables de modifications soient remplies.</span><span class="sxs-lookup"><span data-stu-id="8cc33-176">Nothing additional needs to be done for CDC in this configuration to insure that the change tables are populated.</span></span>  
  
-   <span data-ttu-id="8cc33-177">**Nettoyage de la capture de données modifiées**</span><span class="sxs-lookup"><span data-stu-id="8cc33-177">**Change Data Capture Cleanup**</span></span>  
  
     <span data-ttu-id="8cc33-178">Pour s'assurer que le nettoyage approprié se produit au niveau de la nouvelle base de données principale, un travail local de nettoyage doit toujours être créé.</span><span class="sxs-lookup"><span data-stu-id="8cc33-178">To insure that appropriate cleanup occurs at the new primary database, a local cleanup job should always be created.</span></span> <span data-ttu-id="8cc33-179">L'exemple suivant crée le travail de nettoyage.</span><span class="sxs-lookup"><span data-stu-id="8cc33-179">The following example creates the cleanup job.</span></span>  
  
    ```  
    EXEC sys.sp_cdc_add_job @job_type = 'cleanup';  
    ```  
  
    > [!NOTE]  
    >  <span data-ttu-id="8cc33-180">Vous devez créer les travaux au niveau de toutes les cibles possibles de basculement avant le basculement, et les marquer comme étant désactivés jusqu'à ce que le réplica de disponibilité sur un hôte devienne le nouveau réplica principal.</span><span class="sxs-lookup"><span data-stu-id="8cc33-180">You should create the jobs at all of the possible failover targets before failover, and mark them as disabled until the availability replica at a host becomes the new primary replica.</span></span> <span data-ttu-id="8cc33-181">Les travaux de capture de données modifiées s'exécutant au niveau de l'ancienne base de données principale doivent également être désactivés lorsque la base de données locale devient une base de données secondaire.</span><span class="sxs-lookup"><span data-stu-id="8cc33-181">The CDC jobs running at the old primary database should be also disabled when the local database becomes a secondary database.</span></span> <span data-ttu-id="8cc33-182">Pour désactiver et activer des travaux, utilisez l' *@enabled* option de [sp_update_job &#40;&#41;Transact-SQL ](/sql/relational-databases/system-stored-procedures/sp-update-job-transact-sql).</span><span class="sxs-lookup"><span data-stu-id="8cc33-182">To disable and enable jobs, use the *@enabled* option of [sp_update_job &#40;Transact-SQL&#41;](/sql/relational-databases/system-stored-procedures/sp-update-job-transact-sql).</span></span> <span data-ttu-id="8cc33-183">Pour plus d’informations sur la création de travaux de capture de données modifiées, consultez [sys.sp_cdc_add_job &#40;Transact-SQL&#41;](/sql/relational-databases/system-stored-procedures/sys-sp-cdc-add-job-transact-sql).</span><span class="sxs-lookup"><span data-stu-id="8cc33-183">For more information about creating CDC jobs, see [sys.sp_cdc_add_job &#40;Transact-SQL&#41;](/sql/relational-databases/system-stored-procedures/sys-sp-cdc-add-job-transact-sql).</span></span>  
  
-   <span data-ttu-id="8cc33-184">**Ajout de rôles de capture de données modifiées à un réplica de base de données principal AlwaysOn**</span><span class="sxs-lookup"><span data-stu-id="8cc33-184">**Adding CDC Roles to an AlwaysOn Primary Database Replica**</span></span>  
  
     <span data-ttu-id="8cc33-185">Lorsqu'une table est activée pour la capture de données modifiées, il est possible d'associer un rôle de base de données à l'instance de capture.</span><span class="sxs-lookup"><span data-stu-id="8cc33-185">When a table is enabled for CDC, it is possible to associate a database role with the capture instance.</span></span> <span data-ttu-id="8cc33-186">Si un rôle est spécifié, l'utilisateur souhaitant utiliser les fonctions table de capture de données modifiées pour accéder à des modifications pour la table doit non seulement avoir un accès choisi aux colonnes de table faisant l'objet d'un suivi, mais doit également être membre du rôle nommé.</span><span class="sxs-lookup"><span data-stu-id="8cc33-186">If a role is specified, the user wishing to use the CDC table-valued functions to access changes for the table must not only have select access to the tracked table columns, but must also be a member of the named role.</span></span> <span data-ttu-id="8cc33-187">Si le rôle spécifié n'existe pas encore, il sera créé.</span><span class="sxs-lookup"><span data-stu-id="8cc33-187">If the specified role does not already exist, the role will be created.</span></span> <span data-ttu-id="8cc33-188">Lorsque des rôles de base de données sont ajoutés automatiquement à une base de données principale AlwaysOn, les rôles sont également propagés aux bases de données secondaires du groupe de disponibilité.</span><span class="sxs-lookup"><span data-stu-id="8cc33-188">When database roles are automatically added to an AlwaysOn primary database, the roles are also propagated to the secondary databases of the availability group.</span></span>  
  
-   <span data-ttu-id="8cc33-189">**Applications clientes qui accèdent aux données de modifications de capture de données modifiées et Always On**</span><span class="sxs-lookup"><span data-stu-id="8cc33-189">**Client Applications Accessing CDC Change Data and Always On**</span></span>  
  
     <span data-ttu-id="8cc33-190">Les applications clientes qui utilisent les fonctions table (TVF) ou des serveurs liés pour accéder aux données de la table de modifications ont également besoin de pouvoir localiser un hôte de capture de données modifiées approprié après le basculement.</span><span class="sxs-lookup"><span data-stu-id="8cc33-190">Client applications that use the table-valued functions (TVFs) or linked servers to access change table data also need the ability to locate an appropriate CDC host after failover.</span></span> <span data-ttu-id="8cc33-191">Le nom d'écouteur de groupe de disponibilité correspond au mécanisme fourni par [!INCLUDE[ssHADR](../../../includes/sshadr-md.md)] pour permettre à une connexion, en toute transparence, d'être redirigée vers un hôte différent.</span><span class="sxs-lookup"><span data-stu-id="8cc33-191">The availability group listener name is the mechanism provided by [!INCLUDE[ssHADR](../../../includes/sshadr-md.md)] to transparently allow a connection to be retargeted to a different host.</span></span> <span data-ttu-id="8cc33-192">Une fois qu'un nom d'écouteur de groupe de disponibilité est associé à un groupe de disponibilité, il peut être utilisé dans les chaînes de connexion TCP.</span><span class="sxs-lookup"><span data-stu-id="8cc33-192">Once an availability group listener name is associated with an availability group, it is available to be used in TCP connection strings.</span></span> <span data-ttu-id="8cc33-193">Deux scénarios de connexion différents sont pris en charge par le biais du nom d'écouteur de groupe de disponibilité.</span><span class="sxs-lookup"><span data-stu-id="8cc33-193">Two different connection scenarios are supported through the availability group listener name.</span></span>  
  
    -   <span data-ttu-id="8cc33-194">L'un garantit que les demandes de connexion sont toujours dirigées vers le réplica principal actuel.</span><span class="sxs-lookup"><span data-stu-id="8cc33-194">One insures that connection requests are always directed to the current primary replica.</span></span>  
  
    -   <span data-ttu-id="8cc33-195">L'autre garantit que les demandes de connexion sont dirigées vers un réplica secondaire en lecture seule.</span><span class="sxs-lookup"><span data-stu-id="8cc33-195">One insures that connection requests are directed to a read-only secondary replica.</span></span>  
  
     <span data-ttu-id="8cc33-196">Utilisée pour rechercher un réplica secondaire en lecture seule, une liste de routage en lecture seule doit également être définie pour le groupe de disponibilité.</span><span class="sxs-lookup"><span data-stu-id="8cc33-196">If used to locate a read-only secondary replica, a read-only routing list must also be defined for the availability group.</span></span> <span data-ttu-id="8cc33-197">Pour plus d’informations sur l’accès de routage aux serveurs secondaires accessibles en lecture, consultez [Pour configurer des réplicas de disponibilité pour le routage en lecture seule](../../listeners-client-connectivity-application-failover.md#ConfigureARsForROR).</span><span class="sxs-lookup"><span data-stu-id="8cc33-197">For more information about routing access to readable secondaries, see [To Configure Availability Replicas for Read-Only Routing](../../listeners-client-connectivity-application-failover.md#ConfigureARsForROR).</span></span>  
  
    > [!NOTE]  
    >  <span data-ttu-id="8cc33-198">Il existe un certain délai de propagation associé à la création d'un nom d'écouteur de groupe de disponibilité et son utilisation par les applications clientes afin d'accéder à un réplica de base de données du groupe de disponibilité.</span><span class="sxs-lookup"><span data-stu-id="8cc33-198">There is some propagation delay associated with the creation of an availability group listener name and its use by client applications to access an availability group database replica.</span></span>  
  
     <span data-ttu-id="8cc33-199">Utilisez la requête suivante pour déterminer si un nom d'écouteur de groupe de disponibilité a été défini pour le groupe de disponibilité qui héberge une base de données CDC.</span><span class="sxs-lookup"><span data-stu-id="8cc33-199">Use the following query to determine whether an availability group listener name has been defined for the availability group hosting a CDC database.</span></span> <span data-ttu-id="8cc33-200">La requête retourne le nom d'écouteur du groupe de disponibilité, s'il a été créé.</span><span class="sxs-lookup"><span data-stu-id="8cc33-200">The query will return the availability group listener name if one has been created.</span></span>  
  
    ```  
    SELECT dns_name   
    FROM sys.availability_group_listeners AS l  
    INNER JOIN sys.availability_databases_cluster AS d  
        ON l.group_id = d.group_id  
    WHERE d.database_name = N'MyCDCDB';  
    ```  
  
-   <span data-ttu-id="8cc33-201">**Redirection de la charge de requête vers un réplica secondaire accessible en lecture**</span><span class="sxs-lookup"><span data-stu-id="8cc33-201">**Redirecting the Query Load to a Readable Secondary Replica**</span></span>  
  
     <span data-ttu-id="8cc33-202">Même si, dans de nombreux cas, une application cliente souhaite toujours se connecter au réplica principal actuel, il ne s'agit pas de la seule façon de tirer parti de [!INCLUDE[ssHADR](../../../includes/sshadr-md.md)].</span><span class="sxs-lookup"><span data-stu-id="8cc33-202">While in many cases a client application will always want to connect to the current primary replica that is not the only way to leverage [!INCLUDE[ssHADR](../../../includes/sshadr-md.md)].</span></span> <span data-ttu-id="8cc33-203">Si un groupe de disponibilité est configuré pour prendre en charge des réplicas secondaires accessibles en lecture, les données modifiées peuvent également être collectées à partir des nœuds secondaires.</span><span class="sxs-lookup"><span data-stu-id="8cc33-203">If an availability group is configured to support readable secondary replicas, change data can also be gathered from secondary nodes.</span></span>  
  
     <span data-ttu-id="8cc33-204">Lorsqu'un groupe de disponibilité est configuré, l'attribut ALLOW_CONNECTIONS associé à SECONDARY_ROLE est utilisé pour spécifier le type d'accès secondaire pris en charge.</span><span class="sxs-lookup"><span data-stu-id="8cc33-204">When an availability group is configured, the ALLOW_CONNECTIONS attribute associated with the SECONDARY_ROLE is used to specify the type of secondary access supported.</span></span> <span data-ttu-id="8cc33-205">Dans le cas d'une configuration de type ALL, toutes les connexions au serveur secondaire sont autorisées, mais seules celles nécessitant un accès en lecture seule aboutiront.</span><span class="sxs-lookup"><span data-stu-id="8cc33-205">If configured as ALL, all connections to the secondary will be allowed, but only those requiring read only access will succeed.</span></span> <span data-ttu-id="8cc33-206">Dans le cas d'une configuration de type READ_ONLY, il est nécessaire de spécifier l'intention en lecture seule lors de l'établissement de la connexion à la base de données secondaire pour que la connexion réussisse.</span><span class="sxs-lookup"><span data-stu-id="8cc33-206">If configured as READ_ONLY, it is necessary to specify read only intent when making the connection to the secondary database in order for the connection to succeed.</span></span> <span data-ttu-id="8cc33-207">Pour plus d’informations, consultez [Configurer l’accès en lecture seule sur un réplica de disponibilité &#40;SQL Server&#41;](configure-read-only-access-on-an-availability-replica-sql-server.md).</span><span class="sxs-lookup"><span data-stu-id="8cc33-207">For more information, see [Configure Read-Only Access on an Availability Replica &#40;SQL Server&#41;](configure-read-only-access-on-an-availability-replica-sql-server.md).</span></span>  
  
     <span data-ttu-id="8cc33-208">La requête suivante peut être utilisée pour déterminer si l'intention en lecture seule est nécessaire pour se connecter à un réplica secondaire accessible en lecture.</span><span class="sxs-lookup"><span data-stu-id="8cc33-208">The following query can be used to determine whether read-only intent is needed to connect to a readable secondary replica.</span></span>  
  
    ```  
    SELECT g.name AS AG, replica_server_name, secondary_role_allow_connections_desc  
    FROM sys.availability_replicas AS r  
    JOIN sys.availability_groups AS g  
        ON r.group_id = g.group_id  
    WHERE g.name = N'MY_AG_NAME;  
    ```  
  
     <span data-ttu-id="8cc33-209">Le nom d'écouteur de groupe de disponibilité ou le nom du nœud explicite peut être utilisé pour rechercher le réplica secondaire.</span><span class="sxs-lookup"><span data-stu-id="8cc33-209">Either the availability group listener name or the explicit node name can be used to locate the secondary replica.</span></span> <span data-ttu-id="8cc33-210">Si le nom d'écouteur du groupe de disponibilité est utilisé, l'accès est dirigé vers un réplica secondaire approprié.</span><span class="sxs-lookup"><span data-stu-id="8cc33-210">If the availability group listener name is used, access will be directed to any suitable secondary replica.</span></span>  
  
     <span data-ttu-id="8cc33-211">Lorsque `sp_addlinkedserver` est utilisé pour créer un serveur lié afin d’accéder au serveur secondaire, le *@datasrc* paramètre est utilisé pour le nom de l’écouteur du groupe de disponibilité ou le nom du serveur explicite, et le *@provstr* paramètre est utilisé pour spécifier l’intention de lecture seule.</span><span class="sxs-lookup"><span data-stu-id="8cc33-211">When `sp_addlinkedserver` is used to create a linked server to access the secondary, the *@datasrc* parameter is used for the availability group listener name or the explicit server name, and the *@provstr* parameter is used to specify read-only intent.</span></span>  
  
    ```  
    EXEC sp_addlinkedserver   
    @server = N'linked_svr',   
    @srvproduct=N'SqlServer',  
    @provider=N'SQLNCLI11',   
    @datasrc=N'AG_Listener_Name',   
    @provstr=N'ApplicationIntent=ReadOnly',   
    @catalog=N'MY_DB_NAME';  
    ```  
  
-   <span data-ttu-id="8cc33-212">**Accès client aux données de modifications de capture de données modifiées et aux connexions de domaine**</span><span class="sxs-lookup"><span data-stu-id="8cc33-212">**Client Access to CDC Change Data and Domain Logins**</span></span>  
  
     <span data-ttu-id="8cc33-213">En général, vous devez utiliser les connexions de domaine pour l'accès client aux données modifiées résidant dans les bases de données qui sont membres des groupes de disponibilité AlwaysOn.</span><span class="sxs-lookup"><span data-stu-id="8cc33-213">In general, you should use domain logins for client access to change data residing in databases that are members of AlwaysOn availability groups.</span></span> <span data-ttu-id="8cc33-214">Pour garantir l'accès continu aux données modifiées après le basculement, l'utilisateur de domaine aura besoin des privilèges d'accès sur tous les hôtes prenant en charge les réplicas de groupe de disponibilité.</span><span class="sxs-lookup"><span data-stu-id="8cc33-214">To insure continued access to change data after failover, the domain user will need access privileges on all of the hosts supporting availability group replicas.</span></span> <span data-ttu-id="8cc33-215">Si un utilisateur de base de données est ajouté à une base de données dans un réplica principal et que l'utilisateur est associé à une connexion de domaine, l'utilisateur de base de données est propagé aux bases de données secondaires et continue d'être associé à la connexion de domaine spécifiée.</span><span class="sxs-lookup"><span data-stu-id="8cc33-215">If a database user is added to a database in a primary replica, and the user is associated with a domain login, the database user is propagated to secondary databases and continues to be associated with the specified domain login.</span></span> <span data-ttu-id="8cc33-216">Si le nouvel utilisateur de base de données est associé à une connexion d'authentification SQL Server, l'utilisateur au niveau des bases de données secondaires sera propagé sans connexion.</span><span class="sxs-lookup"><span data-stu-id="8cc33-216">If the new database user is associated with a SQL Server authentication login, the user at the secondary databases will be propagated without a login.</span></span> <span data-ttu-id="8cc33-217">Lorsque la connexion d'authentification [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] associée peut être utilisée pour accéder aux données modifiées au niveau du serveur principal où l'utilisateur de la base de données a été défini à l'origine, ce nœud est le seul où l'accès est possible.</span><span class="sxs-lookup"><span data-stu-id="8cc33-217">While the associated [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] authentication login could be used to access change data at the primary where the database user was originally defined, that node is the only one where access would be possible.</span></span> <span data-ttu-id="8cc33-218">La connexion d'authentification [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] ne peut pas accéder aux données d'une base de données secondaire, ni à celles d'une nouvelle base de données primaire autre que la base de données d'origine où l'utilisateur de la base de données a été défini.</span><span class="sxs-lookup"><span data-stu-id="8cc33-218">The [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] authentication login would not be able to access data from any secondary database, nor from any new primary databases other than the original database where the database user was defined.</span></span>  
  
###  <a name="change-tracking"></a><a name="CT"></a> <span data-ttu-id="8cc33-219">Suivi des modifications</span><span class="sxs-lookup"><span data-stu-id="8cc33-219">Change Tracking</span></span>  
 <span data-ttu-id="8cc33-220">Une base de données activée pour le suivi des modifications peut faire partie d'un groupe de disponibilité AlwaysOn.</span><span class="sxs-lookup"><span data-stu-id="8cc33-220">A database enabled for change tracking (CT) can be part of an AlwaysOn availability group.</span></span> <span data-ttu-id="8cc33-221">Aucune configuration supplémentaire n’est nécessaire.</span><span class="sxs-lookup"><span data-stu-id="8cc33-221">No additional configuration is needed.</span></span> <span data-ttu-id="8cc33-222">Les applications clientes de suivi des modifications qui utilisent les fonctions table (TVF) de capture de données modifiées pour accéder aux données modifiées ont besoin de pouvoir localiser le réplica principal après le basculement.</span><span class="sxs-lookup"><span data-stu-id="8cc33-222">Change tracking client applications that use the CDC table-valued functions (TVFs) to access change data will need the ability to locate the primary replica after failover.</span></span> <span data-ttu-id="8cc33-223">Si l'application cliente se connecte via le nom d'écouteur de groupe de disponibilité, les demandes de connexion seront toujours dirigées correctement vers le réplica principal actuel.</span><span class="sxs-lookup"><span data-stu-id="8cc33-223">If the client application connects through the availability group listener name, connection requests will always be appropriately directed to the current primary replica.</span></span>  
  
> [!NOTE]  
>  <span data-ttu-id="8cc33-224">Les données de suivi des modifications doivent toujours être obtenues à partir du réplica principal.</span><span class="sxs-lookup"><span data-stu-id="8cc33-224">Change tracking data must always be obtained from the primary replica.</span></span> <span data-ttu-id="8cc33-225">Toute tentative d'accès aux données de modification depuis un réplica secondaire provoque l'erreur suivante :</span><span class="sxs-lookup"><span data-stu-id="8cc33-225">An attempt to access change data from a secondary replica will result in the following error:</span></span>  
>   
>  <span data-ttu-id="8cc33-226">Msg 22117, Niveau 16, État 1, Ligne 1</span><span class="sxs-lookup"><span data-stu-id="8cc33-226">Msg 22117, Level 16, State 1, Line1</span></span>  
>   
>  <span data-ttu-id="8cc33-227">Pour les bases de données qui sont membres d'un réplica secondaire (pour les bases de données secondaires), le suivi des modifications n'est pas pris en charge.</span><span class="sxs-lookup"><span data-stu-id="8cc33-227">For databases that are members of a secondary replica (that is, for secondary databases), change tracking is not supported.</span></span> <span data-ttu-id="8cc33-228">Exécutez les requêtes de suivi des modifications sur les bases de données du réplica principal.</span><span class="sxs-lookup"><span data-stu-id="8cc33-228">Run change tracking queries on the databases in the primary replica.</span></span>  
  
##  <a name="prerequisites-restrictions-and-considerations-for-using-replication"></a><a name="Prereqs"></a> <span data-ttu-id="8cc33-229">Conditions préalables requises, restrictions et considérations relatives à l'utilisation de la réplication</span><span class="sxs-lookup"><span data-stu-id="8cc33-229">Prerequisites, Restrictions, and Considerations for Using Replication</span></span>  
 <span data-ttu-id="8cc33-230">Cette section décrit les considérations à prendre en compte pour déployer la réplication avec [!INCLUDE[ssHADR](../../../includes/sshadr-md.md)], y compris les conditions préalables requises, les restrictions et les recommandations.</span><span class="sxs-lookup"><span data-stu-id="8cc33-230">This section describes considerations for deploying replication with [!INCLUDE[ssHADR](../../../includes/sshadr-md.md)], including prerequisites, restrictions, and recommendations.</span></span>  
  
### <a name="prerequisites"></a><span data-ttu-id="8cc33-231">Prérequis</span><span class="sxs-lookup"><span data-stu-id="8cc33-231">Prerequisites</span></span>  
  
-   <span data-ttu-id="8cc33-232">Lors de l'utilisation de la réplication transactionnelle, si la base de données de publication se trouve dans un groupe de disponibilité, le serveur de publication et le serveur de distribution doivent exécuter au moins [!INCLUDE[ssSQL11](../../../includes/sssql11-md.md)].</span><span class="sxs-lookup"><span data-stu-id="8cc33-232">When using transactional replication and the publishing database is in an availability group both the publisher and the distributor must run at least [!INCLUDE[ssSQL11](../../../includes/sssql11-md.md)].</span></span> <span data-ttu-id="8cc33-233">L'abonné peut utiliser un niveau inférieur de [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)].</span><span class="sxs-lookup"><span data-stu-id="8cc33-233">The subscriber can be using a lower level of [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)].</span></span>  
  
-   <span data-ttu-id="8cc33-234">Lors de l'utilisation de la réplication de fusion, si la base de données de publication se trouve dans un groupe de disponibilité :</span><span class="sxs-lookup"><span data-stu-id="8cc33-234">When using merge replication and the publishing database is in an availability group:</span></span>  
  
    -   <span data-ttu-id="8cc33-235">Abonnement par émission de données : le serveur de publication et le serveur de distribution doivent exécuter au moins [!INCLUDE[ssSQL11](../../../includes/sssql11-md.md)].</span><span class="sxs-lookup"><span data-stu-id="8cc33-235">Push subscription: Both the publisher and the distributor must run at least [!INCLUDE[ssSQL11](../../../includes/sssql11-md.md)].</span></span>  
  
    -   <span data-ttu-id="8cc33-236">Abonnement par extraction : le serveur de publication, le serveur de distribution et les bases de données de l’abonné doivent s’exécuter sur au moins [!INCLUDE[ssSQL11](../../../includes/sssql11-md.md)].</span><span class="sxs-lookup"><span data-stu-id="8cc33-236">Pull subscription: The publisher, distributor, and subscriber databases must be on at least [!INCLUDE[ssSQL11](../../../includes/sssql11-md.md)].</span></span> <span data-ttu-id="8cc33-237">Cela est dû au fait que l'Agent de fusion sur l'abonné doit comprendre la façon dont un groupe de disponibilité peut basculer sur son serveur secondaire.</span><span class="sxs-lookup"><span data-stu-id="8cc33-237">This is because the merge agent on the subscriber must understand how an availability group can fail over to its secondary.</span></span>  
  
-   <span data-ttu-id="8cc33-238">Le placement de la base de données de distribution sur un groupe de disponibilité n'est pas pris en charge.</span><span class="sxs-lookup"><span data-stu-id="8cc33-238">Placing the distribution database on an availability group is not supported.</span></span>  
  
-   <span data-ttu-id="8cc33-239">Les instances de serveur de publication satisfont toutes les conditions préalables requises pour faire partie d'un groupe de disponibilité AlwaysOn.</span><span class="sxs-lookup"><span data-stu-id="8cc33-239">The Publisher instances satisfy all the prerequisites required to participate in an AlwaysOn availability group.</span></span> <span data-ttu-id="8cc33-240">Pour plus d’informations [, consultez conditions préalables requises, restrictions et recommandations pour groupes de disponibilité AlwaysOn &#40;SQL Server&#41;](prereqs-restrictions-recommendations-always-on-availability.md).</span><span class="sxs-lookup"><span data-stu-id="8cc33-240">For more information see [Prerequisites, Restrictions, and Recommendations for AlwaysOn Availability Groups &#40;SQL Server&#41;](prereqs-restrictions-recommendations-always-on-availability.md).</span></span>  
  
### <a name="restrictions"></a><span data-ttu-id="8cc33-241">Restrictions</span><span class="sxs-lookup"><span data-stu-id="8cc33-241">Restrictions</span></span>  
 <span data-ttu-id="8cc33-242">Combinaisons de réplication prises en charge sur [!INCLUDE[ssHADR](../../../includes/sshadr-md.md)]:</span><span class="sxs-lookup"><span data-stu-id="8cc33-242">Supported combinations of replication on [!INCLUDE[ssHADR](../../../includes/sshadr-md.md)]:</span></span>  
  
|||||  
|-|-|-|-|  
||<span data-ttu-id="8cc33-243">**Publisher**</span><span class="sxs-lookup"><span data-stu-id="8cc33-243">**Publisher**</span></span>|<span data-ttu-id="8cc33-244">Serveur de **distribution** <sup>3</sup></span><span class="sxs-lookup"><span data-stu-id="8cc33-244">**Distributor** <sup>3</sup></span></span>|<span data-ttu-id="8cc33-245">**Abonné**</span><span class="sxs-lookup"><span data-stu-id="8cc33-245">**Subscriber**</span></span>|  
|<span data-ttu-id="8cc33-246">**Transactionnelle**</span><span class="sxs-lookup"><span data-stu-id="8cc33-246">**Transactional**</span></span>|<span data-ttu-id="8cc33-247">Oui<sup>1</sup></span><span class="sxs-lookup"><span data-stu-id="8cc33-247">Yes<sup>1</sup></span></span>|<span data-ttu-id="8cc33-248">Non</span><span class="sxs-lookup"><span data-stu-id="8cc33-248">No</span></span>|<span data-ttu-id="8cc33-249">Oui<sup>2</sup></span><span class="sxs-lookup"><span data-stu-id="8cc33-249">Yes<sup>2</sup></span></span>|  
|<span data-ttu-id="8cc33-250">**P2P**</span><span class="sxs-lookup"><span data-stu-id="8cc33-250">**P2P**</span></span>|<span data-ttu-id="8cc33-251">Non</span><span class="sxs-lookup"><span data-stu-id="8cc33-251">No</span></span>|<span data-ttu-id="8cc33-252">Non</span><span class="sxs-lookup"><span data-stu-id="8cc33-252">No</span></span>|<span data-ttu-id="8cc33-253">Non</span><span class="sxs-lookup"><span data-stu-id="8cc33-253">No</span></span>|  
|<span data-ttu-id="8cc33-254">**Fusionner**</span><span class="sxs-lookup"><span data-stu-id="8cc33-254">**Merge**</span></span>|<span data-ttu-id="8cc33-255">Oui</span><span class="sxs-lookup"><span data-stu-id="8cc33-255">Yes</span></span>|<span data-ttu-id="8cc33-256">Non</span><span class="sxs-lookup"><span data-stu-id="8cc33-256">No</span></span>|<span data-ttu-id="8cc33-257">Oui<sup>2</sup></span><span class="sxs-lookup"><span data-stu-id="8cc33-257">Yes<sup>2</sup></span></span>|  
|<span data-ttu-id="8cc33-258">**Instantané**</span><span class="sxs-lookup"><span data-stu-id="8cc33-258">**Snapshot**</span></span>|<span data-ttu-id="8cc33-259">Oui</span><span class="sxs-lookup"><span data-stu-id="8cc33-259">Yes</span></span>|<span data-ttu-id="8cc33-260">Non</span><span class="sxs-lookup"><span data-stu-id="8cc33-260">No</span></span>|<span data-ttu-id="8cc33-261">Oui<sup>2</sup></span><span class="sxs-lookup"><span data-stu-id="8cc33-261">Yes<sup>2</sup></span></span>|  
  
 <span data-ttu-id="8cc33-262"><sup>1</sup> n’inclut pas la prise en charge de la réplication transactionnelle bidirectionnelle et réciproque.</span><span class="sxs-lookup"><span data-stu-id="8cc33-262"><sup>1</sup> Does not include support for bi-directional and reciprocal transactional replication.</span></span>  
  
 <span data-ttu-id="8cc33-263"><sup>2</sup> le basculement vers la base de données de réplica est une procédure manuelle.</span><span class="sxs-lookup"><span data-stu-id="8cc33-263"><sup>2</sup> Failover to the replica database is a manual procedure.</span></span> <span data-ttu-id="8cc33-264">Le basculement automatique n'est pas fourni.</span><span class="sxs-lookup"><span data-stu-id="8cc33-264">Automatic failover is not provided.</span></span>  
  
 <span data-ttu-id="8cc33-265"><sup>3</sup> la base de données de distribution n’est pas prise en charge pour une utilisation avec [!INCLUDE[ssHADR](../../../includes/sshadr-md.md)] ou la mise en miroir de bases de données.</span><span class="sxs-lookup"><span data-stu-id="8cc33-265"><sup>3</sup> The Distributor database is not supported for use with [!INCLUDE[ssHADR](../../../includes/sshadr-md.md)] or database mirroring.</span></span>  
  
### <a name="considerations"></a><span data-ttu-id="8cc33-266">Considérations</span><span class="sxs-lookup"><span data-stu-id="8cc33-266">Considerations</span></span>  
  
-   <span data-ttu-id="8cc33-267">La base de données de distribution n'est pas prise en charge en vue d'une utilisation avec [!INCLUDE[ssHADR](../../../includes/sshadr-md.md)] ou la mise en miroir de bases de données.</span><span class="sxs-lookup"><span data-stu-id="8cc33-267">The distribution database is not supported for use with [!INCLUDE[ssHADR](../../../includes/sshadr-md.md)] or database mirroring.</span></span> <span data-ttu-id="8cc33-268">La configuration de la réplication est couplée à l'instance de SQL Server sur laquelle le serveur de distribution est configuré ; par conséquent la base de données de distribution ne peut pas être mise en miroir ni répliquée.</span><span class="sxs-lookup"><span data-stu-id="8cc33-268">Replication configuration is coupled to the SQL Server instance where the Distributor is configured; therefore the distribution database cannot be mirrored or replicated.</span></span> <span data-ttu-id="8cc33-269">Pour fournir une haute disponibilité au serveur de distribution, utilisez un cluster de basculement SQL Server.</span><span class="sxs-lookup"><span data-stu-id="8cc33-269">To provide high availability for the Distributor, use a SQL Server failover cluster.</span></span> <span data-ttu-id="8cc33-270">Pour plus d’informations, consultez [Instances de cluster de basculement AlwaysOn (SQL Server)](../../../sql-server/failover-clusters/windows/always-on-failover-cluster-instances-sql-server.md).</span><span class="sxs-lookup"><span data-stu-id="8cc33-270">For more information, see [AlwaysOn Failover Cluster Instances (SQL Server)](../../../sql-server/failover-clusters/windows/always-on-failover-cluster-instances-sql-server.md).</span></span>  
  
-   <span data-ttu-id="8cc33-271">Le basculement d'abonné vers une base de données secondaire, s'il est pris en charge, est une procédure manuelle relativement complexe.</span><span class="sxs-lookup"><span data-stu-id="8cc33-271">Subscriber failover to a secondary database, while supported, is a relatively complex manual procedure.</span></span> <span data-ttu-id="8cc33-272">La procédure est, pour l'essentiel, identique à la méthode utilisée pour le basculement vers une base de données de l'abonné en miroir.</span><span class="sxs-lookup"><span data-stu-id="8cc33-272">The procedure is essentially identical to the method used to fail over a mirrored subscriber database.</span></span> <span data-ttu-id="8cc33-273">Les abonnés doivent exécuter [!INCLUDE[ssSQL11](../../../includes/sssql11-md.md)] ou une version ultérieure pour pouvoir participer à un groupe de disponibilité.</span><span class="sxs-lookup"><span data-stu-id="8cc33-273">Subscribers must be running [!INCLUDE[ssSQL11](../../../includes/sssql11-md.md)] or later to participate in an availability group.</span></span>  
  
-   <span data-ttu-id="8cc33-274">Les métadonnées et les objets qui existent en dehors de la base de données, c'est-à-dire les connexions, les travaux et les serveurs liés, ne sont pas propagés vers les réplicas secondaires.</span><span class="sxs-lookup"><span data-stu-id="8cc33-274">Metadata and objects that exist outside the database are not propagated to the secondary replicas, including logins, jobs, linked servers.</span></span> <span data-ttu-id="8cc33-275">Si vous voulez faire figurer les métadonnées et les objets dans la nouvelle base de données principale après le basculement, vous devez les copier manuellement.</span><span class="sxs-lookup"><span data-stu-id="8cc33-275">If you require the metadata and objects at the new primary database after failover, you must copy them manually.</span></span> <span data-ttu-id="8cc33-276">Pour plus d’informations, consultez [Gestion des connexions et des travaux pour les bases de données d’un groupe de disponibilité &#40;SQL Server&#41;](../../logins-and-jobs-for-availability-group-databases.md).</span><span class="sxs-lookup"><span data-stu-id="8cc33-276">For more information, see [Management of Logins and Jobs for the Databases of an Availability Group &#40;SQL Server&#41;](../../logins-and-jobs-for-availability-group-databases.md).</span></span>  
  
##  <a name="related-tasks"></a><a name="RelatedTasks"></a> <span data-ttu-id="8cc33-277">Tâches associées</span><span class="sxs-lookup"><span data-stu-id="8cc33-277">Related Tasks</span></span>  
 <span data-ttu-id="8cc33-278">**Réplication**</span><span class="sxs-lookup"><span data-stu-id="8cc33-278">**Replication**</span></span>  
  
-   [<span data-ttu-id="8cc33-279">Configurer la réplication pour les groupes de disponibilité AlwaysOn (SQL Server)</span><span class="sxs-lookup"><span data-stu-id="8cc33-279">Configure Replication for AlwaysOn Availability Groups (SQL Server)</span></span>](always-on-availability-groups-sql-server.md)  
  
-   [<span data-ttu-id="8cc33-280">Maintenance d’une base de données de publication AlwaysOn &#40;SQL Server&#41;</span><span class="sxs-lookup"><span data-stu-id="8cc33-280">Maintaining an AlwaysOn Publication Database &#40;SQL Server&#41;</span></span>](maintaining-an-always-on-publication-database-sql-server.md)  
  
-   [<span data-ttu-id="8cc33-281">FAQ sur l’administration de la réplication</span><span class="sxs-lookup"><span data-stu-id="8cc33-281">Replication Administration FAQ</span></span>](../../../relational-databases/replication/administration/frequently-asked-questions-for-replication-administrators.md)  
  
 <span data-ttu-id="8cc33-282">**Modifier la capture de données**</span><span class="sxs-lookup"><span data-stu-id="8cc33-282">**Change data capture**</span></span>  
  
-   [<span data-ttu-id="8cc33-283">Activer et désactiver la capture de données modifiées &#40;SQL Server&#41;</span><span class="sxs-lookup"><span data-stu-id="8cc33-283">Enable and Disable Change Data Capture &#40;SQL Server&#41;</span></span>](../../../relational-databases/track-changes/enable-and-disable-change-data-capture-sql-server.md)  
  
-   [<span data-ttu-id="8cc33-284">Administrer et surveiller la capture de données modifiées &#40;SQL Server&#41;</span><span class="sxs-lookup"><span data-stu-id="8cc33-284">Administer and Monitor Change Data Capture &#40;SQL Server&#41;</span></span>](../../../relational-databases/track-changes/administer-and-monitor-change-data-capture-sql-server.md)  
  
-   [<span data-ttu-id="8cc33-285">Utiliser les données modifiées &#40;SQL Server&#41;</span><span class="sxs-lookup"><span data-stu-id="8cc33-285">Work with Change Data &#40;SQL Server&#41;</span></span>](../../../relational-databases/track-changes/work-with-change-data-sql-server.md)  
  
 <span data-ttu-id="8cc33-286">**Suivi des modifications**</span><span class="sxs-lookup"><span data-stu-id="8cc33-286">**Change tracking**</span></span>  
  
-   [<span data-ttu-id="8cc33-287">Activer et désactiver le suivi des modifications &#40;SQL Server&#41;</span><span class="sxs-lookup"><span data-stu-id="8cc33-287">Enable and Disable Change Tracking &#40;SQL Server&#41;</span></span>](../../../relational-databases/track-changes/enable-and-disable-change-tracking-sql-server.md)  
  
-   [<span data-ttu-id="8cc33-288">Gérer le suivi des modifications &#40;SQL Server&#41;</span><span class="sxs-lookup"><span data-stu-id="8cc33-288">Manage Change Tracking &#40;SQL Server&#41;</span></span>](../../../relational-databases/track-changes/manage-change-tracking-sql-server.md)  
  
-   [<span data-ttu-id="8cc33-289">Utiliser le suivi des modifications &#40;SQL Server&#41;</span><span class="sxs-lookup"><span data-stu-id="8cc33-289">Work with Change Tracking &#40;SQL Server&#41;</span></span>](../../../relational-databases/track-changes/work-with-change-tracking-sql-server.md)  
  
## <a name="see-also"></a><span data-ttu-id="8cc33-290">Voir aussi</span><span class="sxs-lookup"><span data-stu-id="8cc33-290">See Also</span></span>  
 <span data-ttu-id="8cc33-291">[Abonnés de réplication et groupes de disponibilité AlwaysOn &#40;SQL Server&#41;](replication-subscribers-and-always-on-availability-groups-sql-server.md) </span><span class="sxs-lookup"><span data-stu-id="8cc33-291">[Replication Subscribers and AlwaysOn Availability Groups &#40;SQL Server&#41;](replication-subscribers-and-always-on-availability-groups-sql-server.md) </span></span>  
 <span data-ttu-id="8cc33-292">[Conditions préalables requises, restrictions et recommandations pour groupes de disponibilité AlwaysOn &#40;SQL Server&#41;](prereqs-restrictions-recommendations-always-on-availability.md) </span><span class="sxs-lookup"><span data-stu-id="8cc33-292">[Prerequisites, Restrictions, and Recommendations for AlwaysOn Availability Groups &#40;SQL Server&#41;](prereqs-restrictions-recommendations-always-on-availability.md) </span></span>  
 <span data-ttu-id="8cc33-293">[Vue d’ensemble de groupes de disponibilité AlwaysOn &#40;SQL Server&#41;](overview-of-always-on-availability-groups-sql-server.md) </span><span class="sxs-lookup"><span data-stu-id="8cc33-293">[Overview of AlwaysOn Availability Groups &#40;SQL Server&#41;](overview-of-always-on-availability-groups-sql-server.md) </span></span>  
 <span data-ttu-id="8cc33-294">[Groupes de disponibilité AlwaysOn : interopérabilité (SQL Server)](always-on-availability-groups-interoperability-sql-server.md) [instances de cluster de basculement alwayson (SQL Server)](../../../sql-server/failover-clusters/windows/always-on-failover-cluster-instances-sql-server.md) </span><span class="sxs-lookup"><span data-stu-id="8cc33-294">[AlwaysOn Availability Groups: Interoperability (SQL Server)](always-on-availability-groups-interoperability-sql-server.md) [AlwaysOn Failover Cluster Instances (SQL Server)](../../../sql-server/failover-clusters/windows/always-on-failover-cluster-instances-sql-server.md) </span></span>  
 <span data-ttu-id="8cc33-295">[À propos de la capture de données modifiées &#40;SQL Server&#41;](../../../relational-databases/track-changes/about-change-data-capture-sql-server.md) </span><span class="sxs-lookup"><span data-stu-id="8cc33-295">[About Change Data Capture &#40;SQL Server&#41;](../../../relational-databases/track-changes/about-change-data-capture-sql-server.md) </span></span>  
 <span data-ttu-id="8cc33-296">[À propos du suivi des modifications &#40;SQL Server&#41;](../../../relational-databases/track-changes/about-change-tracking-sql-server.md) </span><span class="sxs-lookup"><span data-stu-id="8cc33-296">[About Change Tracking &#40;SQL Server&#41;](../../../relational-databases/track-changes/about-change-tracking-sql-server.md) </span></span>  
 <span data-ttu-id="8cc33-297">[Réplication SQL Server](../../../relational-databases/replication/sql-server-replication.md) </span><span class="sxs-lookup"><span data-stu-id="8cc33-297">[SQL Server Replication](../../../relational-databases/replication/sql-server-replication.md) </span></span>  
 <span data-ttu-id="8cc33-298">[Suivi des modifications de données &#40;SQL Server&#41;](../../../relational-databases/track-changes/track-data-changes-sql-server.md) </span><span class="sxs-lookup"><span data-stu-id="8cc33-298">[Track Data Changes &#40;SQL Server&#41;](../../../relational-databases/track-changes/track-data-changes-sql-server.md) </span></span>  
 [<span data-ttu-id="8cc33-299">sys.sp_cdc_add_job &#40;Transact-SQL&#41;</span><span class="sxs-lookup"><span data-stu-id="8cc33-299">sys.sp_cdc_add_job &#40;Transact-SQL&#41;</span></span>](/sql/relational-databases/system-stored-procedures/sys-sp-cdc-add-job-transact-sql)  
  
  
