---
title: Mise en miroir de bases de données et réplication (SQL Server) | Microsoft Docs
ms.custom: ''
ms.date: 06/13/2017
ms.prod: sql-server-2014
ms.reviewer: ''
ms.technology: high-availability
ms.topic: conceptual
helpviewer_keywords:
- database mirroring [SQL Server], interoperability
- replication [SQL Server], database mirroring and
ms.assetid: 82796217-02e2-4bc5-9ab5-218bae11a2d6
author: MikeRayMSFT
ms.author: mikeray
ms.openlocfilehash: b126aeb8ccd24932706b8798ebfe7088308918e2
ms.sourcegitcommit: ad4d92dce894592a259721a1571b1d8736abacdb
ms.translationtype: MT
ms.contentlocale: fr-FR
ms.lasthandoff: 08/04/2020
ms.locfileid: "87705420"
---
# <a name="database-mirroring-and-replication-sql-server"></a><span data-ttu-id="e18fc-102">Mise en miroir de bases de données et réplication (SQL Server)</span><span class="sxs-lookup"><span data-stu-id="e18fc-102">Database Mirroring and Replication (SQL Server)</span></span>
  <span data-ttu-id="e18fc-103">La mise en miroir des bases de données peut avoir lieu en parallèle à la réplication afin d'améliorer la disponibilité de la base de données de publication.</span><span class="sxs-lookup"><span data-stu-id="e18fc-103">Database mirroring can be used in conjunction with replication to improve availability for the publication database.</span></span> <span data-ttu-id="e18fc-104">La mise en miroir des bases de données consiste à avoir deux exemplaires d'une même base de données qui résident généralement sur des ordinateurs différents.</span><span class="sxs-lookup"><span data-stu-id="e18fc-104">Database mirroring involves two copies of a single database that typically reside on different computers.</span></span> <span data-ttu-id="e18fc-105">À un moment donné précis, les clients ne peuvent accéder qu'à un seul exemplaire de la base de données.</span><span class="sxs-lookup"><span data-stu-id="e18fc-105">At any given time, only one copy of the database is currently available to clients.</span></span> <span data-ttu-id="e18fc-106">Cet exemplaire s'appelle la base de données principale.</span><span class="sxs-lookup"><span data-stu-id="e18fc-106">This copy is known as the principal database.</span></span> <span data-ttu-id="e18fc-107">Les mises à jour apportées par les clients sur la base de données principale sont appliquées à l'autre exemplaire de la base de données, appelé base de données miroir.</span><span class="sxs-lookup"><span data-stu-id="e18fc-107">Updates made by clients to the principal database are applied on the other copy of the database, known as the mirror database.</span></span> <span data-ttu-id="e18fc-108">La mise en miroir consiste à répercuter dans la base de données miroir chaque insertion, mise à jour ou suppression apportée à la base de données principale.</span><span class="sxs-lookup"><span data-stu-id="e18fc-108">Mirroring involves applying the transaction log from every insertion, update, or deletion made on the principal database onto the mirror database.</span></span>  
  
 <span data-ttu-id="e18fc-109">Le basculement de réplication vers un miroir est entièrement pris en charge pour les bases de données de publication, avec la prise en charge limitée des bases de données d'abonnement.</span><span class="sxs-lookup"><span data-stu-id="e18fc-109">Replication failover to a mirror is fully supported for publication databases, with limited support for subscription databases.</span></span> <span data-ttu-id="e18fc-110">La mise en miroir de bases de données n'est pas prise en charge pour la base de données de distribution.</span><span class="sxs-lookup"><span data-stu-id="e18fc-110">Database mirroring is not supported for the distribution database.</span></span> <span data-ttu-id="e18fc-111">Pour plus d’informations sur la façon de récupérer une base de données de distribution ou d’abonnement sans avoir à reconfigurer la réplication, consultez [Sauvegarder et restaurer des bases de données répliquées](../../relational-databases/replication/administration/back-up-and-restore-replicated-databases.md).</span><span class="sxs-lookup"><span data-stu-id="e18fc-111">For information about recovering a distribution database or subscription database without any need to reconfigure replication, see [Back Up and Restore Replicated Databases](../../relational-databases/replication/administration/back-up-and-restore-replicated-databases.md).</span></span> <span data-ttu-id="e18fc-112">Pour plus d'informations sur la mise en miroir de la base de données de l'abonné, consultez</span><span class="sxs-lookup"><span data-stu-id="e18fc-112">For information about mirroring the subscriber database, see the</span></span>  
  
> [!NOTE]  
>  <span data-ttu-id="e18fc-113">Après un basculement, le miroir devient la base de données principale.</span><span class="sxs-lookup"><span data-stu-id="e18fc-113">After a failover, the mirror becomes the principal.</span></span> <span data-ttu-id="e18fc-114">Dans cette rubrique, les termes « principale » et « miroir » renvoient toujours aux bases de données principale et miroir d'origine.</span><span class="sxs-lookup"><span data-stu-id="e18fc-114">In this topic, "principal" and "mirror" always refer to the original principal and mirror.</span></span>  
  
## <a name="requirements-and-considerations-for-using-replication-with-database-mirroring"></a><span data-ttu-id="e18fc-115">Conditions requises et éléments à prendre en compte pour procéder à une réplication avec mise en miroir des bases de données</span><span class="sxs-lookup"><span data-stu-id="e18fc-115">Requirements and Considerations for Using Replication with Database Mirroring</span></span>  
 <span data-ttu-id="e18fc-116">Tenez compte des exigences et des points suivants lors d'une réplication avec mise en miroir des bases de données :</span><span class="sxs-lookup"><span data-stu-id="e18fc-116">Be aware of the following requirements and considerations when using replication with database mirroring:</span></span>  
  
-   <span data-ttu-id="e18fc-117">Les bases de données principale et miroir doivent partager un serveur de distribution.</span><span class="sxs-lookup"><span data-stu-id="e18fc-117">The principal and mirror must share a Distributor.</span></span> <span data-ttu-id="e18fc-118">Nous vous conseillons de choisir un serveur de distribution à distance qui offre une plus grande tolérance de panne en cas de basculement inopiné du serveur de publication.</span><span class="sxs-lookup"><span data-stu-id="e18fc-118">We recommend that this be a remote Distributor, which provides greater fault tolerance if the Publisher has an unplanned failover.</span></span>  
  
-   <span data-ttu-id="e18fc-119">La réplication prend en charge la mise en miroir des bases de données de publication pour les réplications de fusion et les réplications transactionnelles mettant en jeu des Abonnés en lecture seule ou des Abonnés avec mise à jour en file d'attente.</span><span class="sxs-lookup"><span data-stu-id="e18fc-119">Replication supports mirroring the publication database for merge replication and for transactional replication with read-only Subscribers or queued updating Subscribers.</span></span> <span data-ttu-id="e18fc-120">Les Abonnés avec mise à jour immédiate, les serveurs de publication Oracle et les serveurs de publication d'une topologie d'égal à égal ne sont pas pris en charge.</span><span class="sxs-lookup"><span data-stu-id="e18fc-120">Immediate updating Subscribers, Oracle Publishers, Publishers in a peer-to-peer topology, and republishing are not supported.</span></span>  
  
-   <span data-ttu-id="e18fc-121">Les métadonnées et les objets qui existent en dehors de la base de données, c'est-à-dire connexions, travaux, serveurs liés, etc. ne sont pas copiés vers le miroir.</span><span class="sxs-lookup"><span data-stu-id="e18fc-121">Metadata and objects that exist outside the database are not copied to the mirror, including logins, jobs, linked servers, and so on.</span></span> <span data-ttu-id="e18fc-122">Si vous voulez faire figurer les métadonnées et les objets dans le miroir, vous devez les copier manuellement.</span><span class="sxs-lookup"><span data-stu-id="e18fc-122">If you require the metadata and objects at the mirror, you must copy them manually.</span></span> <span data-ttu-id="e18fc-123">Pour plus d’informations, consultez [Gestion des connexions et des travaux après un basculement de rôle &#40;SQL Server&#41;](../../sql-server/failover-clusters/management-of-logins-and-jobs-after-role-switching-sql-server.md).</span><span class="sxs-lookup"><span data-stu-id="e18fc-123">For more information, see [Management of Logins and Jobs After Role Switching &#40;SQL Server&#41;](../../sql-server/failover-clusters/management-of-logins-and-jobs-after-role-switching-sql-server.md).</span></span>  
  
## <a name="configuring-replication-with-database-mirroring"></a><span data-ttu-id="e18fc-124">Configuration de la réplication avec mise en miroir des bases de données</span><span class="sxs-lookup"><span data-stu-id="e18fc-124">Configuring Replication with Database Mirroring</span></span>  
 <span data-ttu-id="e18fc-125">La configuration de la réplication et de la mise en miroir des bases de données se fait en cinq étapes.</span><span class="sxs-lookup"><span data-stu-id="e18fc-125">Configuring replication and database mirroring involves five steps.</span></span> <span data-ttu-id="e18fc-126">Chaque étape est décrite plus en détail dans les sections qui suivent.</span><span class="sxs-lookup"><span data-stu-id="e18fc-126">Each step is described in more detail in the following section.</span></span>  
  
1.  <span data-ttu-id="e18fc-127">Configurez le serveur de publication.</span><span class="sxs-lookup"><span data-stu-id="e18fc-127">Configure the Publisher.</span></span>  
  
2.  <span data-ttu-id="e18fc-128">Configurez la mise en miroir des bases de données.</span><span class="sxs-lookup"><span data-stu-id="e18fc-128">Configure database mirroring.</span></span>  
  
3.  <span data-ttu-id="e18fc-129">Configurez la base de données miroir de façon à ce qu'elle utilise le même serveur de distribution que la base de données principale.</span><span class="sxs-lookup"><span data-stu-id="e18fc-129">Configure the mirror to use the same Distributor as the principal.</span></span>  
  
4.  <span data-ttu-id="e18fc-130">Configurez les agents de réplication pour le basculement.</span><span class="sxs-lookup"><span data-stu-id="e18fc-130">Configure replication agents for failover.</span></span>  
  
5.  <span data-ttu-id="e18fc-131">Ajoutez les bases de données principale et miroir dans le Moniteur de réplication.</span><span class="sxs-lookup"><span data-stu-id="e18fc-131">Add the principal and mirror to Replication Monitor.</span></span>  
  
 <span data-ttu-id="e18fc-132">Les étapes 1 et 2 peuvent être inversées.</span><span class="sxs-lookup"><span data-stu-id="e18fc-132">Steps 1 and 2 can also be performed in the opposite order.</span></span>  
  
#### <a name="to-configure-database-mirroring-for-a-publication-database"></a><span data-ttu-id="e18fc-133">Pour configurer la mise en miroir d'une base de données de publication</span><span class="sxs-lookup"><span data-stu-id="e18fc-133">To configure database mirroring for a publication database</span></span>  
  
1.  <span data-ttu-id="e18fc-134">Configurez le serveur de publication :</span><span class="sxs-lookup"><span data-stu-id="e18fc-134">Configure the Publisher:</span></span>  
  
    1.  <span data-ttu-id="e18fc-135">Nous vous conseillons d'utiliser un serveur de distribution distant.</span><span class="sxs-lookup"><span data-stu-id="e18fc-135">We recommend using a remote Distributor.</span></span> <span data-ttu-id="e18fc-136">Pour plus d’informations sur la configuration de la distribution, consultez [Configuration de la distribution](../../relational-databases/replication/configure-distribution.md).</span><span class="sxs-lookup"><span data-stu-id="e18fc-136">For more information about configuring distribution, see [Configure Distribution](../../relational-databases/replication/configure-distribution.md).</span></span>  
  
    2.  <span data-ttu-id="e18fc-137">Vous pouvez activer une base de données en vue de publications d'instantanés, de publications transactionnelles et/ou de publications de fusion.</span><span class="sxs-lookup"><span data-stu-id="e18fc-137">You can enable a database for snapshot and transactional publications and/or merge publications.</span></span> <span data-ttu-id="e18fc-138">Pour les bases de données mises en miroir contenant plusieurs types de publications, vous devez activer la base de données pour les différents types au niveau du même nœud à l’aide de [sp_replicationdboption](/sql/relational-databases/system-stored-procedures/sp-replicationdboption-transact-sql).</span><span class="sxs-lookup"><span data-stu-id="e18fc-138">For mirrored databases that will contain more than one type of publication, you must enable the database for both types at the same node using [sp_replicationdboption](/sql/relational-databases/system-stored-procedures/sp-replicationdboption-transact-sql).</span></span> <span data-ttu-id="e18fc-139">Vous pourriez, par exemple, appeler la procédure stockée suivante sur le principal :</span><span class="sxs-lookup"><span data-stu-id="e18fc-139">For example, you could execute the following stored procedure calls at the principal:</span></span>  
  
        ```  
        exec sp_replicationdboption @dbname='<PublicationDatabase>', @optname='publish', @value=true;  
        exec sp_replicationdboption @dbname='<PublicationDatabase>', @optname='mergepublish', @value=true;  
        ```  
  
         <span data-ttu-id="e18fc-140">Pour plus d’informations sur la création de publications, consultez [Publier des données et des objets de base de données](../../relational-databases/replication/publish/publish-data-and-database-objects.md).</span><span class="sxs-lookup"><span data-stu-id="e18fc-140">For more information about creating publications, see [Publish Data and Database Objects](../../relational-databases/replication/publish/publish-data-and-database-objects.md).</span></span>  
  
2.  <span data-ttu-id="e18fc-141">Configurez la mise en miroir des bases de données.</span><span class="sxs-lookup"><span data-stu-id="e18fc-141">Configure database mirroring.</span></span> <span data-ttu-id="e18fc-142">Pour plus d’informations, consultez [Établir une session de mise en miroir de bases de données au moyen de l’authentification Windows &#40;SQL Server Management Studio&#41;](establish-database-mirroring-session-windows-authentication.md) et [Configuration de la mise en miroir d’une base de données &#40;SQL Server&#41;](database-mirroring-sql-server.md).</span><span class="sxs-lookup"><span data-stu-id="e18fc-142">For more information, see [Establish a Database Mirroring Session Using Windows Authentication &#40;SQL Server Management Studio&#41;](establish-database-mirroring-session-windows-authentication.md) and [Setting Up Database Mirroring &#40;SQL Server&#41;](database-mirroring-sql-server.md).</span></span>  
  
3.  <span data-ttu-id="e18fc-143">Configurez la distribution pour le miroir.</span><span class="sxs-lookup"><span data-stu-id="e18fc-143">Configure distribution for the mirror.</span></span> <span data-ttu-id="e18fc-144">Spécifiez le nom du miroir comme serveur de publication, puis spécifiez le serveur de publication et le dossier d'instantanés que le principal utilise.</span><span class="sxs-lookup"><span data-stu-id="e18fc-144">Specify the mirror name as the Publisher, and specify the same Distributor and snapshot folder that the principal uses.</span></span> <span data-ttu-id="e18fc-145">Par exemple, si vous configurez la réplication par le biais de procédures stockées, exécutez [sp_adddistpublisher](/sql/relational-databases/system-stored-procedures/sp-adddistpublisher-transact-sql) sur le serveur de distribution, puis [sp_adddistributor](/sql/relational-databases/system-stored-procedures/sp-adddistributor-transact-sql) sur le miroir.</span><span class="sxs-lookup"><span data-stu-id="e18fc-145">For example, if you are configuring replication with stored procedures, execute [sp_adddistpublisher](/sql/relational-databases/system-stored-procedures/sp-adddistpublisher-transact-sql) at the Distributor; and then execute [sp_adddistributor](/sql/relational-databases/system-stored-procedures/sp-adddistributor-transact-sql) at the mirror.</span></span> <span data-ttu-id="e18fc-146">Pour **sp_adddistpublisher**:</span><span class="sxs-lookup"><span data-stu-id="e18fc-146">For **sp_adddistpublisher**:</span></span>  
  
    -   <span data-ttu-id="e18fc-147">Définissez la valeur du **@publisher** paramètre sur le nom réseau du miroir.</span><span class="sxs-lookup"><span data-stu-id="e18fc-147">Set the value of the **@publisher** parameter to the network name of the mirror.</span></span>  
  
    -   <span data-ttu-id="e18fc-148">Définissez la valeur du **@working_directory** paramètre sur le dossier d’instantanés utilisé par le principal.</span><span class="sxs-lookup"><span data-stu-id="e18fc-148">Set the value of the **@working_directory** parameter to the snapshot folder used by the principal.</span></span>  
  
4.  <span data-ttu-id="e18fc-149">Spécifiez le nom du miroir pour le paramètre d’agent **-PublisherFailoverPartner**.</span><span class="sxs-lookup"><span data-stu-id="e18fc-149">Specify the mirror name for the **-PublisherFailoverPartner** agent parameter.</span></span> <span data-ttu-id="e18fc-150">Agent Ce paramètre est obligatoire ; il permet aux agents suivants d'identifier le miroir après le basculement :</span><span class="sxs-lookup"><span data-stu-id="e18fc-150">Agent This parameter is required for the following agents to identify the mirror after failover:</span></span>  
  
    -   <span data-ttu-id="e18fc-151">Agent d'instantané (pour toutes les publications)</span><span class="sxs-lookup"><span data-stu-id="e18fc-151">Snapshot Agent (for all publications)</span></span>  
  
    -   <span data-ttu-id="e18fc-152">Agent de lecture du journal (pour toutes les publications transactionnelles)</span><span class="sxs-lookup"><span data-stu-id="e18fc-152">Log Reader Agent (for all transactional publications)</span></span>  
  
    -   <span data-ttu-id="e18fc-153">Agent de lecture de la file d'attente (pour les publications transactionnelles prenant en charge les abonnements avec mise à jour en file d'attente)</span><span class="sxs-lookup"><span data-stu-id="e18fc-153">Queue Reader Agent (for transactional publications that support queued updating subscriptions)</span></span>  
  
    -   <span data-ttu-id="e18fc-154">Agent de fusion (pour les abonnements de fusion)</span><span class="sxs-lookup"><span data-stu-id="e18fc-154">Merge Agent (for merge subscriptions)</span></span>  
  
    -   [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] <span data-ttu-id="e18fc-155">Écouteur de réplication (replisapi.dll : pour les abonnements de fusion synchronisés via la synchronisation web)</span><span class="sxs-lookup"><span data-stu-id="e18fc-155">replication listener (replisapi.dll: for merge subscriptions synchronized using Web synchronization)</span></span>  
  
    -   <span data-ttu-id="e18fc-156">Contrôle ActiveX SQL Merge (pour les abonnements de fusion synchronisés à l'aide du contrôle)</span><span class="sxs-lookup"><span data-stu-id="e18fc-156">SQL Merge ActiveX Control (for merge subscriptions synchronized with the control)</span></span>  
  
     <span data-ttu-id="e18fc-157">L'agent de distribution et le contrôle ActiveX SQL Distribution n'ont pas ce paramètre puisqu'ils ne se connectent pas au serveur de publication.</span><span class="sxs-lookup"><span data-stu-id="e18fc-157">The Distribution Agent and Distribution ActiveX Control do not have this parameter because they do not connect to the Publisher.</span></span>  
  
     <span data-ttu-id="e18fc-158">Les modifications apportées aux paramètres prennent effet au prochain démarrage de l'Agent.</span><span class="sxs-lookup"><span data-stu-id="e18fc-158">Agent parameter changes take effect the next time the agent is started.</span></span> <span data-ttu-id="e18fc-159">Si l'Agent fonctionne en continu, vous devez l'arrêter, puis le redémarrer.</span><span class="sxs-lookup"><span data-stu-id="e18fc-159">If the agent runs continuously, you must stop and restart the agent.</span></span> <span data-ttu-id="e18fc-160">Les paramètres peuvent être définis dans les profils d'agent et à l'invite de commandes.</span><span class="sxs-lookup"><span data-stu-id="e18fc-160">Parameters can be specified in agent profiles and from the command prompt.</span></span> <span data-ttu-id="e18fc-161">Pour plus d'informations, consultez les pages suivantes :</span><span class="sxs-lookup"><span data-stu-id="e18fc-161">For more information, see:</span></span>  
  
    -   [<span data-ttu-id="e18fc-162">Afficher et modifier des paramètres d’invite de commandes d’un Agent de réplication &#40;SQL Server Management Studio&#41;</span><span class="sxs-lookup"><span data-stu-id="e18fc-162">View and Modify Replication Agent Command Prompt Parameters &#40;SQL Server Management Studio&#41;</span></span>](../../relational-databases/replication/agents/view-and-modify-replication-agent-command-prompt-parameters.md)  
  
    -   [<span data-ttu-id="e18fc-163">Concepts des exécutables de l'agent de réplication</span><span class="sxs-lookup"><span data-stu-id="e18fc-163">Replication Agent Executables Concepts</span></span>](../../relational-databases/replication/concepts/replication-agent-executables-concepts.md)  
  
     <span data-ttu-id="e18fc-164">Nous vous conseillons d’ajouter le paramètre **-PublisherFailoverPartner** à un profil d’agent, puis de spécifier le nom du miroir dans le profil.</span><span class="sxs-lookup"><span data-stu-id="e18fc-164">We recommend adding the **-PublisherFailoverPartner** to an agent profile, and then specifying the mirror name in the profile.</span></span> <span data-ttu-id="e18fc-165">Par exemple, si vous configurez la réplication à l'aide de procédures stockées :</span><span class="sxs-lookup"><span data-stu-id="e18fc-165">For example, if you are configuring replication with stored procedures:</span></span>  
  
    ```  
    -- Execute sp_help_agent_profile in the context of the distribution database to get the list of profiles.  
    -- Select the profile id of the profile that needs to be updated from the result set.  
    -- In the agent_type column returned by sp_help_agent_profile:   
    -- 1 = Snapshot Agent; 2 = Log Reader Agent; 3 = Distribution Agent; 4 = Merge Agent; 9 = Queue Reader Agent.  
  
    exec sp_help_agent_profile;  
  
    -- Setting the -PublisherFailoverPartner parameter in the default Snapshot Agent profile (profile 1).  
    -- Execute sp_add_agent_parameter in the context of the distribution database.  
    exec sp_add_agent_parameter @profile_id = 1, @parameter_name = N'-PublisherFailoverPartner', @parameter_value = N'<Failover Partner Name>';  
  
    -- Setting the -PublisherFailoverPartner parameter in the default Merge Agent profile (profile 6).  
    -- Execute sp_add_agent_parameter in the context of the distribution database.  
    exec sp_add_agent_parameter @profile_id = 6, @parameter_name = N'-PublisherFailoverPartner', @parameter_value = N'<Failover Partner Name>';  
    ```  
  
5.  <span data-ttu-id="e18fc-166">Ajoutez les bases de données principale et miroir dans le Moniteur de réplication.</span><span class="sxs-lookup"><span data-stu-id="e18fc-166">Add the principal and mirror to Replication Monitor.</span></span> <span data-ttu-id="e18fc-167">Pour plus d’informations, consultez [Ajouter et supprimer des serveurs de publication à partir du moniteur de réplication](../../relational-databases/replication/monitor/add-and-remove-publishers-from-replication-monitor.md).</span><span class="sxs-lookup"><span data-stu-id="e18fc-167">For more information, see [Add and Remove Publishers from Replication Monitor](../../relational-databases/replication/monitor/add-and-remove-publishers-from-replication-monitor.md).</span></span>  
  
## <a name="maintaining-a-mirrored-publication-database"></a><span data-ttu-id="e18fc-168">Gestion d'une base de données de publication mise en miroir</span><span class="sxs-lookup"><span data-stu-id="e18fc-168">Maintaining a Mirrored Publication Database</span></span>  
 <span data-ttu-id="e18fc-169">La gestion d'une base de données de publication reste quasiment identique qu'elle soit mise en miroir ou non, mais quelques précautions sont toutefois à prendre :</span><span class="sxs-lookup"><span data-stu-id="e18fc-169">Maintaining a mirrored publication database is essentially the same as maintaining a non-mirrored database, with the following considerations:</span></span>  
  
-   <span data-ttu-id="e18fc-170">L'administration et la surveillance doivent se faire au niveau du serveur actif.</span><span class="sxs-lookup"><span data-stu-id="e18fc-170">Administration and monitoring must occur at the active server.</span></span> <span data-ttu-id="e18fc-171">Dans [!INCLUDE[ssManStudioFull](../../includes/ssmanstudiofull-md.md)], les publications apparaissent sous le dossier **Publications locales** uniquement pour le serveur actif.</span><span class="sxs-lookup"><span data-stu-id="e18fc-171">In [!INCLUDE[ssManStudioFull](../../includes/ssmanstudiofull-md.md)], publications appear under the **Local Publications** folder only for the active server.</span></span> <span data-ttu-id="e18fc-172">En cas de basculement sur le miroir, par exemple, les publications s'affichent sur le miroir et plus sur le principal.</span><span class="sxs-lookup"><span data-stu-id="e18fc-172">For example, if you failover to the mirror, the publications are displayed at the mirror and are no longer displayed at the principal.</span></span> <span data-ttu-id="e18fc-173">Si la base de données bascule sur le miroir, vous aurez à actualiser manuellement [!INCLUDE[ssManStudio](../../includes/ssmanstudio-md.md)] et le moniteur de réplication pour répercuter les modifications.</span><span class="sxs-lookup"><span data-stu-id="e18fc-173">If the database fails over to the mirror, you might need to manually refresh [!INCLUDE[ssManStudio](../../includes/ssmanstudio-md.md)] and Replication Monitor for the change to be reflected.</span></span>  
  
-   <span data-ttu-id="e18fc-174">Le moniteur de réplication affiche les nœuds de serveur de publication dans l'arborescence des objets de la base de données principale et de la base de données miroir.</span><span class="sxs-lookup"><span data-stu-id="e18fc-174">Replication Monitor displays Publisher nodes in the object tree for both the principal and the mirror.</span></span> <span data-ttu-id="e18fc-175">Si la base de données principale est le serveur actif, les informations de publication sont affichées uniquement sous le nœud de base de données principale dans le moniteur de réplication.</span><span class="sxs-lookup"><span data-stu-id="e18fc-175">If the principal is the active server, publication information is displayed only under the principal node in Replication Monitor.</span></span>  
  
     <span data-ttu-id="e18fc-176">Si la base de données miroir est le serveur actif :</span><span class="sxs-lookup"><span data-stu-id="e18fc-176">If the mirror is the active server:</span></span>  
  
    -   <span data-ttu-id="e18fc-177">Si un agent possède une erreur, celle-ci est indiquée sur le nœud de base de données principale, pas sur le nœud de base de données miroir.</span><span class="sxs-lookup"><span data-stu-id="e18fc-177">If an agent has an error, the error is indicated only on the principal node, not on the mirror node.</span></span>  
  
    -   <span data-ttu-id="e18fc-178">Si la base de données principale n'est pas disponible, les nœuds de base de données principale et miroir affichent des listes identiques de publications.</span><span class="sxs-lookup"><span data-stu-id="e18fc-178">If the principal is unavailable, the principal and mirror nodes display identical lists of publications.</span></span> <span data-ttu-id="e18fc-179">La surveillance doit être réalisée sur les publications sous le nœud de base de données miroir.</span><span class="sxs-lookup"><span data-stu-id="e18fc-179">Monitoring should be performed on the publications under the mirror node.</span></span>  
  
-   <span data-ttu-id="e18fc-180">Si vous faites appel aux procédures stockées ou aux Replication Management Objects pour gérer la réplication sur le miroir, vous devez spécifier comme serveur de publication le nom de l'instance où la base de données est activée pour la réplication.</span><span class="sxs-lookup"><span data-stu-id="e18fc-180">When using stored procedures or Replication Management Objects (RMO) to administer replication at the mirror, for cases in which you specify the Publisher name, you must specify the name of the instance on which the database was enabled for replication.</span></span> <span data-ttu-id="e18fc-181">Pour déterminer le nom approprié, utilisez la fonction [publishingservername](/sql/t-sql/functions/replication-functions-publishingservername).</span><span class="sxs-lookup"><span data-stu-id="e18fc-181">To determine the appropriate name, use the function [publishingservername](/sql/t-sql/functions/replication-functions-publishingservername).</span></span>  
  
     <span data-ttu-id="e18fc-182">En cas de mise en miroir d'une base de données de publication, les métadonnées de réplication stockées dans la base de données miroir sont identiques à celles de la base de données principale.</span><span class="sxs-lookup"><span data-stu-id="e18fc-182">When a publication database is mirrored, the replication metadata stored in the mirrored database is identical to the metadata stored in the principal database.</span></span> <span data-ttu-id="e18fc-183">Par conséquent, en cas de bases de données de publication activées pour la réplication sur le principal, le nom d'instance du serveur de publication stocké dans les tables système du miroir est celui du principal, et non du miroir.</span><span class="sxs-lookup"><span data-stu-id="e18fc-183">Consequently, for publication databases enabled for replication at the principal, the Publisher instance name stored in system tables at the mirror is the name of the principal, not the mirror.</span></span> <span data-ttu-id="e18fc-184">Cela affecte la configuration et l'administration de la réplication si la base de données de publication bascule sur le miroir.</span><span class="sxs-lookup"><span data-stu-id="e18fc-184">This affects replication configuration and maintenance if the publication database fails over to the mirror.</span></span> <span data-ttu-id="e18fc-185">Par exemple, si vous configurez la réplication avec des procédures stockées sur le miroir après un basculement et que vous souhaitez ajouter un abonnement par extraction à une base de données de publication qui a été activée au niveau du principal, vous devez spécifier le nom du principal plutôt que le nom du miroir pour le **@publisher** paramètre de **sp_addpullsubscription** ou **sp_addmergepullsubscription**.</span><span class="sxs-lookup"><span data-stu-id="e18fc-185">For example, if you are configuring replication with stored procedures on the mirror after a failover, and you want to add a pull subscription to a publication database that was enabled at the principal, you must specify the principal name rather than the mirror name for the **@publisher** parameter of **sp_addpullsubscription** or **sp_addmergepullsubscription**.</span></span>  
  
     <span data-ttu-id="e18fc-186">Si vous activez une base de données de publication sur le miroir après le basculement vers le miroir, le nom de l’instance du serveur de publication stocké dans les tables système est le nom du miroir ; dans ce cas, vous devez utiliser le nom du miroir pour le **@publisher** paramètre.</span><span class="sxs-lookup"><span data-stu-id="e18fc-186">If you enable a publication database at the mirror after failover to the mirror, the Publisher instance name stored in system tables is the name of the mirror; in this case, you would use the name of the mirror for the **@publisher** parameter.</span></span>  
  
    > [!NOTE]  
    >  <span data-ttu-id="e18fc-187">Dans certains cas, comme **sp_addpublication**, le paramètre **@publisher** n’est pris en charge que pour les serveurs de publication non-[!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] . Il ne sert alors à rien en cas de mise en miroir des bases de données [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] .</span><span class="sxs-lookup"><span data-stu-id="e18fc-187">In some cases, such as **sp_addpublication**, the **@publisher** parameter is supported only for non-[!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] Publishers; in these cases, it is not relevant for [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] database mirroring.</span></span>  
  
-   <span data-ttu-id="e18fc-188">Pour synchroniser un abonnement dans [!INCLUDE[ssManStudio](../../includes/ssmanstudio-md.md)] après un basculement : synchronisez les abonnements par extraction à partir de l'Abonné, puis synchronisez les abonnements par émission de données à partir du serveur de publication actif.</span><span class="sxs-lookup"><span data-stu-id="e18fc-188">To synchronize a subscription in [!INCLUDE[ssManStudio](../../includes/ssmanstudio-md.md)] after a failover: synchronize pull subscriptions from the Subscriber; and synchronize push subscriptions from the active Publisher.</span></span>  
  
### <a name="replication-behavior-if-mirroring-is-removed"></a><span data-ttu-id="e18fc-189">Comportement de la réplication en cas de suppression de la mise en miroir</span><span class="sxs-lookup"><span data-stu-id="e18fc-189">Replication Behavior if Mirroring is Removed</span></span>  
 <span data-ttu-id="e18fc-190">Gardez les points suivants à l'esprit si la mise en miroir des bases de données est retirée d'une base de données publiée :</span><span class="sxs-lookup"><span data-stu-id="e18fc-190">Keep the following issues in mind if database mirroring is removed from a published database:</span></span>  
  
-   <span data-ttu-id="e18fc-191">Si la base de données de publication du principal n'est plus mise en miroir, la réplication se poursuit comme si de rien n'était vis-à-vis du principal d'origine.</span><span class="sxs-lookup"><span data-stu-id="e18fc-191">If the publication database at the principal is no longer mirrored, replication continues to work unchanged against the original principal.</span></span>  
  
-   <span data-ttu-id="e18fc-192">Si la base de données de publication bascule du principal vers le miroir et que la relation de mise en miroir est par la suite désactivée ou supprimée, les agents de réplication ne pourront pas travailler avec le miroir.</span><span class="sxs-lookup"><span data-stu-id="e18fc-192">If the publication database fails over from the principal to the mirror and the mirroring relationship is subsequently disabled or removed, replication agents will not function against the mirror.</span></span> <span data-ttu-id="e18fc-193">Si la base de données principale est définitivement perdue, désactivez, puis reconfigurez la réplication avec le miroir choisi comme serveur de publication.</span><span class="sxs-lookup"><span data-stu-id="e18fc-193">If the principal is permanently lost, disable and then reconfigure replication with the mirror specified as the Publisher.</span></span>  
  
-   <span data-ttu-id="e18fc-194">Si la mise en miroir des bases de données est totalement supprimée, la base de données miroir passe en état de récupération et doit être restaurée pour devenir fonctionnelle.</span><span class="sxs-lookup"><span data-stu-id="e18fc-194">If database mirroring is removed completely, the mirror database is in a recovery state and must be restored in order to become functional.</span></span> <span data-ttu-id="e18fc-195">Le comportement de la base de données récupérée à l'égard de la réplication varie selon que l'option KEEP_REPLICATION est ou non activée.</span><span class="sxs-lookup"><span data-stu-id="e18fc-195">The behavior of the recovered database with respect to replication depends on whether the KEEP_REPLICATION option is specified.</span></span> <span data-ttu-id="e18fc-196">Cette option oblige l'opération de restauration à conserver les paramètres de réplication lors de la restauration d'une base de données publiée sur un serveur autre que celui sur lequel elle a été créée.</span><span class="sxs-lookup"><span data-stu-id="e18fc-196">This option forces the restore operation to preserve replication settings when restoring a published database to a server other than that on which the backup was created.</span></span> <span data-ttu-id="e18fc-197">N'utilisez l'option KEEP_REPLICATION que si l'autre base de données de publication n'est pas disponible.</span><span class="sxs-lookup"><span data-stu-id="e18fc-197">Use the KEEP_REPLICATION option only when the other publication database is unavailable.</span></span> <span data-ttu-id="e18fc-198">L'option n'est pas prise en charge si l'autre base de données de publication est intacte et en cours de réplication.</span><span class="sxs-lookup"><span data-stu-id="e18fc-198">The option is not supported if the other publication database is still intact and replicating.</span></span> <span data-ttu-id="e18fc-199">Pour plus d’informations sur KEEP_REPLICATION, consultez [RESTORE &#40;Transact-SQL&#41;](/sql/t-sql/statements/restore-statements-transact-sql).</span><span class="sxs-lookup"><span data-stu-id="e18fc-199">For more information about KEEP_REPLICATION, see [RESTORE &#40;Transact-SQL&#41;](/sql/t-sql/statements/restore-statements-transact-sql).</span></span>  
  
## <a name="log-reader-agent-behavior"></a><span data-ttu-id="e18fc-200">Comportement de l'Agent de lecture du journal</span><span class="sxs-lookup"><span data-stu-id="e18fc-200">Log Reader Agent Behavior</span></span>  
 <span data-ttu-id="e18fc-201">Le tableau suivant décrit la façon dont se comporte l'Agent de lecture du journal dans les différents modes d'opération de la mise en miroir des bases de données.</span><span class="sxs-lookup"><span data-stu-id="e18fc-201">The following table describes Log Reader Agent behavior for the various operating modes of database mirroring.</span></span>  
  
|<span data-ttu-id="e18fc-202">Mode d'opération</span><span class="sxs-lookup"><span data-stu-id="e18fc-202">Operating mode</span></span>|<span data-ttu-id="e18fc-203">Comportement de l'Agent de lecture du journal en cas d'indisponibilité du miroir</span><span class="sxs-lookup"><span data-stu-id="e18fc-203">Log Reader Agent behavior if the mirror is unavailable</span></span>|  
|--------------------|------------------------------------------------------------|  
|<span data-ttu-id="e18fc-204">Mode haute sécurité avec basculement automatique</span><span class="sxs-lookup"><span data-stu-id="e18fc-204">High-safety mode with automatic failover</span></span>|<span data-ttu-id="e18fc-205">Si le miroir n'est pas disponible, l'Agent de lecture du journal propage les commandes vers la base de données de distribution.</span><span class="sxs-lookup"><span data-stu-id="e18fc-205">If the mirror is unavailable, the Log Reader Agent propagates commands to the distribution database.</span></span> <span data-ttu-id="e18fc-206">Le principal ne peut pas basculer sur le miroir tant que ce dernier n'est pas connecté et que toutes les transactions du principal n'y figurent pas.</span><span class="sxs-lookup"><span data-stu-id="e18fc-206">The principal cannot failover to the mirror until the mirror is back online and has all transactions from the principal.</span></span>|  
|<span data-ttu-id="e18fc-207">Mode hautes performances</span><span class="sxs-lookup"><span data-stu-id="e18fc-207">High-performance mode</span></span>|<span data-ttu-id="e18fc-208">Si le miroir n'est pas disponible, la base de données principale s'exécute sans filet (elle n'est pas mise en miroir).</span><span class="sxs-lookup"><span data-stu-id="e18fc-208">If the mirror is unavailable, the principal database is running exposed (that is, unmirrored).</span></span> <span data-ttu-id="e18fc-209">Toutefois, l'Agent de lecture du journal réplique les transactions renforcées sur le miroir.</span><span class="sxs-lookup"><span data-stu-id="e18fc-209">However, the Log Reader Agent only replicates those transactions that are hardened on the mirror.</span></span> <span data-ttu-id="e18fc-210">Si le service est forcé et que le serveur miroir joue le rôle de principal, l'Agent de lecture du journal travaille en fonction du miroir et commence à collecter les nouvelles transactions.</span><span class="sxs-lookup"><span data-stu-id="e18fc-210">If service is forced and the mirror server assumes the role of the principal, the Log Reader Agent will work against the mirror and start picking up the new transactions.</span></span><br /><br /> <span data-ttu-id="e18fc-211">Sachez que la durée de latence de la réplication augmente si le miroir se trouve derrière le principal.</span><span class="sxs-lookup"><span data-stu-id="e18fc-211">Be aware that replication latency will increase if the mirror falls behind the principal.</span></span>|  
|<span data-ttu-id="e18fc-212">Mode Haute sécurité sans basculement automatique</span><span class="sxs-lookup"><span data-stu-id="e18fc-212">High-safety mode without automatic failover</span></span>|<span data-ttu-id="e18fc-213">Toutes les transactions validées sont renforcées sur le disque dur du miroir.</span><span class="sxs-lookup"><span data-stu-id="e18fc-213">All committed transactions are guaranteed to be hardened to disk on the mirror.</span></span> <span data-ttu-id="e18fc-214">L'Agent de lecture du journal ne réplique que les transactions renforcées du miroir.</span><span class="sxs-lookup"><span data-stu-id="e18fc-214">The Log Reader Agent replicates only those transactions that are hardened on the mirror.</span></span> <span data-ttu-id="e18fc-215">Si le miroir n'est pas disponible, le principal empêche toute autre activité dans la base de données. L'Agent de lecture du journal n'a plus aucune transaction à répliquer.</span><span class="sxs-lookup"><span data-stu-id="e18fc-215">If the mirror is unavailable, the principal disallows further activity in the database; therefore the Log Reader Agent has no transactions to replicate.</span></span>|  
  
## <a name="see-also"></a><span data-ttu-id="e18fc-216">Voir aussi</span><span class="sxs-lookup"><span data-stu-id="e18fc-216">See Also</span></span>  
 <span data-ttu-id="e18fc-217">[Réplication SQL Server](../../relational-databases/replication/sql-server-replication.md) </span><span class="sxs-lookup"><span data-stu-id="e18fc-217">[SQL Server Replication](../../relational-databases/replication/sql-server-replication.md) </span></span>  
 [<span data-ttu-id="e18fc-218">Copie des journaux de transaction et réplication &#40;SQL Server&#41;</span><span class="sxs-lookup"><span data-stu-id="e18fc-218">Log Shipping and Replication &#40;SQL Server&#41;</span></span>](../log-shipping/log-shipping-and-replication-sql-server.md)  
  
  
