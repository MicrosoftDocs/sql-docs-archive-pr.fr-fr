---
title: Mise en miroir de bases de données et copie des journaux de transaction (SQL Server) | Microsoft Docs
ms.custom: ''
ms.date: 06/13/2017
ms.prod: sql-server-2014
ms.reviewer: ''
ms.technology: high-availability
ms.topic: conceptual
helpviewer_keywords:
- database mirroring [SQL Server], interoperability
- log shipping [SQL Server], database mirroring
ms.assetid: 53e98134-e274-4dfd-8b72-0cc0fd5c800e
author: MikeRayMSFT
ms.author: mikeray
ms.openlocfilehash: fe11f4244eff98923a6f4ee291caca9c094237f4
ms.sourcegitcommit: ad4d92dce894592a259721a1571b1d8736abacdb
ms.translationtype: MT
ms.contentlocale: fr-FR
ms.lasthandoff: 08/04/2020
ms.locfileid: "87603019"
---
# <a name="database-mirroring-and-log-shipping-sql-server"></a><span data-ttu-id="7b51c-102">Mise en miroir de bases de données et copie des journaux de transaction (SQL Server)</span><span class="sxs-lookup"><span data-stu-id="7b51c-102">Database Mirroring and Log Shipping (SQL Server)</span></span>
  <span data-ttu-id="7b51c-103">Une base de données déterminée peut être simultanément mise en miroir et/ou faire l'objet d'une copie des journaux de transaction.</span><span class="sxs-lookup"><span data-stu-id="7b51c-103">A given database can be mirrored or log shipped; it can also be simultaneously mirrored and log shipped.</span></span> <span data-ttu-id="7b51c-104">Pour choisir l'approche à utiliser, tenez compte des éléments suivants :</span><span class="sxs-lookup"><span data-stu-id="7b51c-104">To choose what approach to use, consider the following:</span></span>  
  
-   <span data-ttu-id="7b51c-105">De combien de serveurs de destination avez-vous besoin ?</span><span class="sxs-lookup"><span data-stu-id="7b51c-105">How many destination servers do you require?</span></span>  
  
     <span data-ttu-id="7b51c-106">Si vous n'avez besoin que d'une base de données de destination, la mise en miroir de bases de données est la solution recommandée.</span><span class="sxs-lookup"><span data-stu-id="7b51c-106">If you require only a single destination database, database mirroring is the recommended solution.</span></span>  
  
     <span data-ttu-id="7b51c-107">Si plusieurs bases de données de destination sont nécessaires, vous devez utiliser la copie des journaux de transaction, seul ou avec la mise en miroir de bases de données.</span><span class="sxs-lookup"><span data-stu-id="7b51c-107">If you require more than one destination database, you need to use log shipping, either alone or with database mirroring.</span></span> <span data-ttu-id="7b51c-108">La combinaison de ces approches offre les avantages de la mise en miroir de bases de données ainsi que la prise en charge de plusieurs destinations, permise par la copie des journaux de transaction.</span><span class="sxs-lookup"><span data-stu-id="7b51c-108">Combining these approaches gives you the benefits of database mirroring along with the support for multiple destinations provided by log shipping.</span></span>  
  
-   <span data-ttu-id="7b51c-109">Si vous devez différer la restauration du journal sur la base de données de destination (généralement pour la protéger contre les erreurs logiques), utilisez la copie des journaux de transaction, seul ou avec la mise en miroir de bases de données.</span><span class="sxs-lookup"><span data-stu-id="7b51c-109">If you need to delay restoring log on the destination database (typically, to protect against logical errors), use log shipping, alone or with database mirroring.</span></span>  
  
 <span data-ttu-id="7b51c-110">Cette rubrique présente les observations relatives à la combinaison de la copie des journaux de transaction et de la mise en miroir de bases de données.</span><span class="sxs-lookup"><span data-stu-id="7b51c-110">This topic discusses considerations for combining log shipping and database mirroring.</span></span>  
  
> [!NOTE]  
>  <span data-ttu-id="7b51c-111">Pour obtenir une présentation de ces technologies, consultez [Mise en miroir de bases de données &#40;SQL Server&#41;](database-mirroring-sql-server.md) et [À propos de la copie des journaux de transaction &#40;SQL Server&#41;](../log-shipping/about-log-shipping-sql-server.md).</span><span class="sxs-lookup"><span data-stu-id="7b51c-111">For introductions to these technologies, see [Database Mirroring &#40;SQL Server&#41;](database-mirroring-sql-server.md) and [About Log Shipping &#40;SQL Server&#41;](../log-shipping/about-log-shipping-sql-server.md).</span></span>  
  
## <a name="combining-log-shipping-and-database-mirroring"></a><span data-ttu-id="7b51c-112">Combinaison de la copie des journaux de transaction et de la mise en miroir de bases de données</span><span class="sxs-lookup"><span data-stu-id="7b51c-112">Combining Log Shipping and Database Mirroring</span></span>  
 <span data-ttu-id="7b51c-113">La base de données principale dans une session de mise en miroir peut également jouer le rôle de la base de données primaire dans une configuration de copie des journaux de transaction, ou inversement, car le partage de la sauvegarde de copie des journaux de transaction est intact.</span><span class="sxs-lookup"><span data-stu-id="7b51c-113">The principal database in a mirroring session can also act as the primary database in a log shipping configuration, or vice versa, as the log shipping backup share is intact.</span></span> <span data-ttu-id="7b51c-114">La session de mise en miroir de bases de données s'exécute dans n'importe quel mode d'exécution : synchrone (la sécurité des transactions ayant la valeur FULL) ou asynchrone (la sécurité des transactions ayant la valeur OFF).</span><span class="sxs-lookup"><span data-stu-id="7b51c-114">The database mirroring session run in any operating mode, whether synchronous (with transaction safety set to FULL) or asynchronous (with transaction safety set to OFF).</span></span>  
  
> [!NOTE]  
>  <span data-ttu-id="7b51c-115">Pour utiliser la mise en miroir de base de données sur une base de données, le mode de restauration complète est toujours requis.</span><span class="sxs-lookup"><span data-stu-id="7b51c-115">To use database mirroring on a database, the full recovery model is always required.</span></span>  
  
 <span data-ttu-id="7b51c-116">Généralement, lors de la combinaison de la copie des journaux de transaction et de la mise en miroir de bases de données, la session de mise en miroir de bases de données est établie avant la copie des journaux de transaction, même si cela n'est pas obligatoire.</span><span class="sxs-lookup"><span data-stu-id="7b51c-116">Typically, when combining log shipping and database mirroring, the mirroring session is established before log shipping, although this is not required.</span></span> <span data-ttu-id="7b51c-117">Ensuite, la base de données principale actuelle est configurée comme base de données primaire de copie des journaux de transaction ( *base de données principale/primaire*), associée à une ou plusieurs bases de données secondaires distantes.</span><span class="sxs-lookup"><span data-stu-id="7b51c-117">Then the current principal database is configured as the log shipping primary (the *principal/primary database*), along with one or more remote secondary databases.</span></span> <span data-ttu-id="7b51c-118">En outre, la base de données miroir doit être configurée comme base de données primaire de copie des journaux de transaction ( *base de données miroir/primaire*).</span><span class="sxs-lookup"><span data-stu-id="7b51c-118">Also, the mirror database must be configured as a log shipping primary (the *mirror/primary database*).</span></span> <span data-ttu-id="7b51c-119">Les bases de données secondaires de copie des journaux de transaction doivent se situer sur des instances du serveur différentes du serveur principal ou du serveur miroir/principal.</span><span class="sxs-lookup"><span data-stu-id="7b51c-119">The log shipping secondary databases should be on different server instances than either the principal/primary server or mirror/primary server.</span></span>  
  
> [!NOTE]  
>  <span data-ttu-id="7b51c-120">Les paramètres de respect de la casse des serveurs impliqués dans la copie des journaux de transaction doivent correspondre.</span><span class="sxs-lookup"><span data-stu-id="7b51c-120">The case sensitivity settings of the servers involved in log shipping should match.</span></span>  
  
 <span data-ttu-id="7b51c-121">Pendant une session de copie des journaux de transaction, les travaux de sauvegarde situés dans la base de données primaire entraînent la création de sauvegardes des journaux dans un dossier de sauvegarde.</span><span class="sxs-lookup"><span data-stu-id="7b51c-121">During a log shipping session, backup jobs on the primary database create log backups in a backup folder.</span></span> <span data-ttu-id="7b51c-122">À partir de cet endroit, les sauvegardes sont copiées par les travaux de copie des serveurs secondaires.</span><span class="sxs-lookup"><span data-stu-id="7b51c-122">From there, the backups are copied by the copy jobs of the secondary servers.</span></span> <span data-ttu-id="7b51c-123">Pour que les travaux de sauvegarde et de copie réussissent, ils doivent avoir accès au dossier de sauvegarde de la copie des journaux de transaction.</span><span class="sxs-lookup"><span data-stu-id="7b51c-123">For the backup jobs and copy jobs to succeed, they must have access to the log shipping backup folder.</span></span> <span data-ttu-id="7b51c-124">Pour optimiser la disponibilité du serveur principal, il est recommandé d'installer le dossier de sauvegarde à un emplacement de sauvegarde partagé sur un ordinateur hôte distinct.</span><span class="sxs-lookup"><span data-stu-id="7b51c-124">To maximize availability of the primary server, we recommend that you establish the backup folder in a shared backup location on a separate host computer.</span></span> <span data-ttu-id="7b51c-125">Vérifiez que tous les serveurs de copie des journaux de transaction, notamment le serveur miroir/principal, peuvent accéder à l’emplacement de sauvegarde partagé (connu sous le nom de *partage de sauvegarde*).</span><span class="sxs-lookup"><span data-stu-id="7b51c-125">Ensure that all the log shipping servers, including the mirror/primary server, can access the shared backup location (known as a *backup share*).</span></span>  
  
 <span data-ttu-id="7b51c-126">Pour permettre la poursuite de la copie des journaux de transaction après le basculement de la mise en miroir de base de données, vous devez également configurer le serveur miroir en tant que serveur principal, à l'aide de la même configuration que celle utilisée pour la base de données primaire ou la base de données principale.</span><span class="sxs-lookup"><span data-stu-id="7b51c-126">To allow log shipping to continue after database mirroring fails over, you must also configure the mirror server as a primary server, using the same configuration you use for the primary on the principal database.</span></span> <span data-ttu-id="7b51c-127">La base de données miroir est en état de restauration, ce qui empêche les travaux de sauvegarde de sauvegarder le journal dans celle-ci.</span><span class="sxs-lookup"><span data-stu-id="7b51c-127">The mirror database is in the restoring state, which prevents the backup jobs from backing up the log on the mirror database.</span></span> <span data-ttu-id="7b51c-128">De cette manière, la base de données miroir/primaire n'interfère pas avec la base de données principale/primaire dont les sauvegardes des journaux sont actuellement copiées par les serveurs secondaires.</span><span class="sxs-lookup"><span data-stu-id="7b51c-128">This ensures that the mirror/primary database does not interfere with the principal/primary database whose log backups are currently being copied by secondary servers.</span></span> <span data-ttu-id="7b51c-129">Pour empêcher les fausses alertes, quand un travail de sauvegarde s’exécute sur la base de données miroir/primaire, le travail de sauvegarde enregistre un message dans la table**log_shipping_monitor_history_detail** et le travail de l’Agent retourne un état de réussite.</span><span class="sxs-lookup"><span data-stu-id="7b51c-129">To prevent spurious alerts, after the backup job executes on the mirror/primary database, the backup job logs a message to the l**og_shipping_monitor_history_detail** table, and the agent job returns a status of success.</span></span>  
  
 <span data-ttu-id="7b51c-130">La base de données miroir/primaire est inactive dans la session de copie des journaux de transaction.</span><span class="sxs-lookup"><span data-stu-id="7b51c-130">The mirror/primary database is inactive in the log shipping session.</span></span> <span data-ttu-id="7b51c-131">Cependant, si la mise en miroir bascule, la base de données miroir précédente se met en ligne en tant que base de données principale.</span><span class="sxs-lookup"><span data-stu-id="7b51c-131">However, if mirroring fails over, the former mirror database comes online as the principal database.</span></span> <span data-ttu-id="7b51c-132">À ce stade, cette base de données joue également le rôle de base de données primaire de copie des journaux de transaction.</span><span class="sxs-lookup"><span data-stu-id="7b51c-132">At that point, that database also becomes active as the log shipping primary database.</span></span> <span data-ttu-id="7b51c-133">Les travaux de sauvegarde de la copie des journaux de transaction qui ne pouvaient pas précédemment copier de journaux sur cette base de données, commencent la copie des journaux de transaction.</span><span class="sxs-lookup"><span data-stu-id="7b51c-133">The log shipping backup jobs that were previously unable to ship log on that database, begin shipping log.</span></span> <span data-ttu-id="7b51c-134">À l'inverse, un basculement entraîne la transformation de l'ancienne base de données principale/primaire en une nouvelle base de données miroir/primaire ainsi que son passage à l'état de restauration, tandis que les travaux de sauvegarde de cette base de données cessent de sauvegarder le journal.</span><span class="sxs-lookup"><span data-stu-id="7b51c-134">Conversely, a failover causes the former principal/primary database to become the new mirror/primary database and enter the restoring state, and backup jobs on that database cease to backup log.</span></span>  
  
> [!NOTE]  
>  <span data-ttu-id="7b51c-135">En cas de basculement automatique, le passage au rôle miroir se produit lorsque la base de données principale/primaire précédente rejoint la session de mise en miroir.</span><span class="sxs-lookup"><span data-stu-id="7b51c-135">In the event of an automatic failover, the switch to the mirror role occurs when the former principal/primary database rejoins the mirroring session.</span></span>  
  
 <span data-ttu-id="7b51c-136">Pour s’exécuter en mode haute sécurité avec basculement automatique, la session de mise en miroir est configurée avec une instance de serveur supplémentaire appelée *témoin*.</span><span class="sxs-lookup"><span data-stu-id="7b51c-136">To run in high-safety mode with automatic failover the mirroring session is configured with an additional server instance known as the *witness*.</span></span> <span data-ttu-id="7b51c-137">Si la base de données principale est perdue pour une quelconque raison après la synchronisation de la base de données et si le serveur miroir ainsi que son témoin peuvent toujours communiquer entre eux, un basculement automatique se produit.</span><span class="sxs-lookup"><span data-stu-id="7b51c-137">If the principal database is lost for any reason after the database is synchronized and if the mirror server and witness can still communicate with each other, automatic failover occurs.</span></span> <span data-ttu-id="7b51c-138">Lors d'un basculement automatique, le serveur miroir assume le rôle du principal et met sa base de données en ligne en tant que base de données principale.</span><span class="sxs-lookup"><span data-stu-id="7b51c-138">An automatic failover causes mirror server to assume the principal role and bring its database online as the principal database.</span></span> <span data-ttu-id="7b51c-139">Si l'emplacement de la sauvegarde de la copie des journaux de transaction est accessible au nouveau serveur principal, ses travaux de sauvegarde commencent à envoyer les sauvegardes des journaux à cet endroit.</span><span class="sxs-lookup"><span data-stu-id="7b51c-139">If the log shipping backup location is accessible to the new principal/primary server, its backup jobs begin to ship log backups to that location.</span></span> <span data-ttu-id="7b51c-140">Le mode synchrone de mise en miroir de bases de données garantit que la séquence de journaux de transactions consécutifs n'est pas affectée par un basculement de mise en miroir et que seul le journal valide est restauré.</span><span class="sxs-lookup"><span data-stu-id="7b51c-140">The database mirroring synchronous mode guarantees that the log chain is unaffected by a mirroring failover and that only valid log is restored.</span></span> <span data-ttu-id="7b51c-141">Les serveurs secondaires continuent de copier les sauvegardes des journaux sans savoir qu'une autre instance du serveur est devenue le serveur principal.</span><span class="sxs-lookup"><span data-stu-id="7b51c-141">The secondary servers continue to copy log backups without knowing that a different server instance has become the primary server.</span></span>  
  
 <span data-ttu-id="7b51c-142">Si vous utilisez un moniteur de copie des journaux de transaction local, aucune observation particulière n'est nécessaire pour la prise en charge de ce scénario.</span><span class="sxs-lookup"><span data-stu-id="7b51c-142">When using a local log shipping monitor, no special considerations are necessary to accommodate this scenario.</span></span> <span data-ttu-id="7b51c-143">Pour plus d'informations sur l'utilisation d'une instance de surveillance à distance avec ce scénario, consultez la section « Impact de la mise en miroir de bases de données sur une instance de surveillance à distance », plus loin dans cette rubrique.</span><span class="sxs-lookup"><span data-stu-id="7b51c-143">For information about using a remote monitoring instance with this scenario, see, "The Impact of Database Mirroring on a Remote Monitoring Instance," later in this topic.</span></span>  
  
## <a name="failing-over-from-the-principal-to-the-mirror-database"></a><span data-ttu-id="7b51c-144">Basculement d'une base de données principale vers une base de données miroir</span><span class="sxs-lookup"><span data-stu-id="7b51c-144">Failing over from the Principal to the Mirror database</span></span>  
 <span data-ttu-id="7b51c-145">La figure suivante illustre la manière dont la copie des journaux de transaction et la mise en miroir de bases de données interagissent lorsque la mise en miroir s'exécute en mode haute sécurité avec basculement automatique.</span><span class="sxs-lookup"><span data-stu-id="7b51c-145">The following figure shows how log shipping and database mirroring work together when mirroring is running in high-safety mode with automatic failover.</span></span> <span data-ttu-id="7b51c-146">Initialement, **Server_A** est à la fois le serveur du principal pour la mise en miroir et le serveur principal pour la copie des journaux de transaction.</span><span class="sxs-lookup"><span data-stu-id="7b51c-146">Initially, **Server_A** is both the principal server for mirroring and the primary server for log shipping.</span></span> <span data-ttu-id="7b51c-147">**Server_B** est le serveur miroir et est également configuré comme serveur principal actuellement inactif.</span><span class="sxs-lookup"><span data-stu-id="7b51c-147">**Server_B** is the mirror server and is also configured as a primary server, which is currently inactive.</span></span> <span data-ttu-id="7b51c-148">**Server_C** et **Server_D** sont des serveurs secondaires de copie des journaux de transaction.</span><span class="sxs-lookup"><span data-stu-id="7b51c-148">**Server_C** and **Server_D** are log shipping secondary servers.</span></span> <span data-ttu-id="7b51c-149">Pour optimiser la disponibilité de la session de copie des journaux de transaction, l'emplacement de sauvegarde se trouve dans un répertoire de partage situé sur un ordinateur hôte distinct.</span><span class="sxs-lookup"><span data-stu-id="7b51c-149">To maximize availability of the log shipping session, the backup location is on a share directory on a separate host computer.</span></span>  
  
 <span data-ttu-id="7b51c-150">![Envoi de journaux et mise en miroir de bases de données](../media/logshipping-and-dbm-automatic-failover.gif "Envoi de journaux et mise en miroir de bases de données")</span><span class="sxs-lookup"><span data-stu-id="7b51c-150">![Log shipping and database mirroring](../media/logshipping-and-dbm-automatic-failover.gif "Log shipping and database mirroring")</span></span>  
  
 <span data-ttu-id="7b51c-151">Après un basculement de mise en miroir, le nom du serveur principal défini sur le serveur secondaire reste inchangé.</span><span class="sxs-lookup"><span data-stu-id="7b51c-151">After a mirroring failover, the primary server name defined on the secondary server is unchanged.</span></span> <span data-ttu-id="7b51c-152">.</span><span class="sxs-lookup"><span data-stu-id="7b51c-152">.</span></span>  
  
## <a name="the-impact-of-database-mirroring-on-a-remote-monitoring-instance"></a><span data-ttu-id="7b51c-153">Impact de la mise en miroir de bases de données sur une instance de surveillance à distance</span><span class="sxs-lookup"><span data-stu-id="7b51c-153">The Impact of Database Mirroring on a Remote Monitoring Instance</span></span>  
 <span data-ttu-id="7b51c-154">Lorsque la copie des journaux de transaction utilise une instance de surveillance à distance, la combinaison de la session de copie des journaux de transaction et de la mise en miroir de bases de données affecte les informations contenues dans les tables de surveillance.</span><span class="sxs-lookup"><span data-stu-id="7b51c-154">When log shipping uses with a remote monitoring instance, combining the log shipping session and database mirroring affects the information in the monitor tables.</span></span> <span data-ttu-id="7b51c-155">Les informations relatives au serveur principal sont une combinaison de celles configurées au niveau du serveur principal et du moniteur configuré sur chaque serveur secondaire.</span><span class="sxs-lookup"><span data-stu-id="7b51c-155">The information about the primary is a combination of the one configured at the principal/primary and the monitor configured on each secondary.</span></span>  
  
 <span data-ttu-id="7b51c-156">Pour que la surveillance soit la plus transparente possible, lorsque vous utilisez un moniteur distant, il est recommandé de spécifier le nom du serveur principal d'origine lors de la configuration du serveur principal au niveau du serveur secondaire.</span><span class="sxs-lookup"><span data-stu-id="7b51c-156">To keep monitoring as seamless as possible, when you use a remote monitor, we recommend that you specify the original primary name when configuring the primary at the secondary.</span></span> <span data-ttu-id="7b51c-157">Cette approche facilite également la modification de la configuration de la copie des journaux de transaction à partir de l'Agent Microsoft [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)].</span><span class="sxs-lookup"><span data-stu-id="7b51c-157">This approach also facilitates changing the log shipping configuration from Microsoft [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] Agent.</span></span> <span data-ttu-id="7b51c-158">Pour plus d’informations sur la surveillance, consultez [Surveiller la copie des journaux de transaction &#40;Transact-SQL&#41;](../log-shipping/monitor-log-shipping-transact-sql.md).</span><span class="sxs-lookup"><span data-stu-id="7b51c-158">For more information about monitoring, see [Monitor Log Shipping &#40;Transact-SQL&#41;](../log-shipping/monitor-log-shipping-transact-sql.md).</span></span>  
  
## <a name="setting-up-mirroring-and-log-shipping-together"></a><span data-ttu-id="7b51c-159">Configuration simultanée de la mise en miroir et de la copie des journaux de transaction</span><span class="sxs-lookup"><span data-stu-id="7b51c-159">Setting Up Mirroring and Log Shipping Together</span></span>  
 <span data-ttu-id="7b51c-160">Pour configurer simultanément la mise en miroir de bases de données et la copie des journaux de transaction, les étapes suivantes sont requises :</span><span class="sxs-lookup"><span data-stu-id="7b51c-160">To set up database mirroring and log shipping together, the following steps are required:</span></span>  
  
1.  <span data-ttu-id="7b51c-161">Restaurer les sauvegardes de la base de données principale/primaire à l'aide de NORECOVERY sur une autre instance du serveur afin de les utiliser ultérieurement comme base de données miroir de la mise en miroir de base de données pour la base de données principale/primaire.</span><span class="sxs-lookup"><span data-stu-id="7b51c-161">Restore backups of the principal/primary database with NORECOVERY onto another server instance to be later used as database mirroring mirror database for the principal/primary database.</span></span> <span data-ttu-id="7b51c-162">Pour plus d’informations, consultez [Préparer une base de données miroir pour la mise en miroir &#40;SQL Server&#41;](prepare-a-mirror-database-for-mirroring-sql-server.md).</span><span class="sxs-lookup"><span data-stu-id="7b51c-162">For more information, see [Prepare a Mirror Database for Mirroring &#40;SQL Server&#41;](prepare-a-mirror-database-for-mirroring-sql-server.md).</span></span>  
  
2.  <span data-ttu-id="7b51c-163">Configurer la mise en miroir de bases de données.</span><span class="sxs-lookup"><span data-stu-id="7b51c-163">Set up database mirroring.</span></span> <span data-ttu-id="7b51c-164">Pour plus d’informations, consultez [Établir une session de mise en miroir de bases de données au moyen de l’authentification Windows &#40;SQL Server Management Studio&#41;](establish-database-mirroring-session-windows-authentication.md) ou [Configuration de la mise en miroir d’une base de données &#40;SQL Server&#41;](setting-up-database-mirroring-sql-server.md).</span><span class="sxs-lookup"><span data-stu-id="7b51c-164">For more information, see [Establish a Database Mirroring Session Using Windows Authentication &#40;SQL Server Management Studio&#41;](establish-database-mirroring-session-windows-authentication.md) or [Setting Up Database Mirroring &#40;SQL Server&#41;](setting-up-database-mirroring-sql-server.md).</span></span>  
  
3.  <span data-ttu-id="7b51c-165">Restaurer les sauvegardes de la base de données principale/primaire sur d'autres instances du serveur afin de les utiliser ultérieurement comme bases de données secondaires de copie des journaux de transaction pour la base de données primaire.</span><span class="sxs-lookup"><span data-stu-id="7b51c-165">Restore backups of the principal/primary database to other server instances to be later used as log shipping secondary databases for the primary database.</span></span>  
  
4.  <span data-ttu-id="7b51c-166">Configurer la copie des journaux de transaction sur la base de données principale comme base de données primaire pour une ou plusieurs bases de données secondaires.</span><span class="sxs-lookup"><span data-stu-id="7b51c-166">Set up log shipping on the principal database as the primary database for one or more secondary databases.</span></span>  
  
     <span data-ttu-id="7b51c-167">Il est conseillé de configurer un partage unique comme répertoire de sauvegarde (partage de sauvegarde).</span><span class="sxs-lookup"><span data-stu-id="7b51c-167">You should set up a single share as the backup directory (a backup share).</span></span> <span data-ttu-id="7b51c-168">Cela permet de garantir qu'après le changement de rôle entre le principal et le serveur miroir, les travaux de sauvegarde seront toujours écrits dans le même répertoire qu'auparavant.</span><span class="sxs-lookup"><span data-stu-id="7b51c-168">This ensures that after role switching between the principal and mirror servers, backup jobs continue to write to the same directory as before.</span></span> <span data-ttu-id="7b51c-169">Il est recommandé de vérifier que ce partage se situe sur un serveur physique différent des serveurs hébergeant les bases de données impliquées dans la mise en miroir et la copie des journaux de transaction.</span><span class="sxs-lookup"><span data-stu-id="7b51c-169">A best practice is to ensure that this share is located on a different physical server from the servers hosting the databases involved in mirroring and log shipping.</span></span>  
  
     <span data-ttu-id="7b51c-170">Pour plus d’informations, consultez [Configurer la copie des journaux de transaction &#40;Transact-SQL&#41;](../log-shipping/configure-log-shipping-sql-server.md).</span><span class="sxs-lookup"><span data-stu-id="7b51c-170">For more information, see [Configure Log Shipping &#40;SQL Server&#41;](../log-shipping/configure-log-shipping-sql-server.md).</span></span>  
  
5.  <span data-ttu-id="7b51c-171">Basculement manuel du principal au miroir.</span><span class="sxs-lookup"><span data-stu-id="7b51c-171">Manually failover from the principal to the mirror.</span></span>  
  
     <span data-ttu-id="7b51c-172">Pour effectuer un basculement manuel :</span><span class="sxs-lookup"><span data-stu-id="7b51c-172">To perform a manual failover:</span></span>  
  
    -   [<span data-ttu-id="7b51c-173">Basculer manuellement une session de mise en miroir de bases de données &#40;SQL Server Management Studio&#41;</span><span class="sxs-lookup"><span data-stu-id="7b51c-173">Manually Fail Over a Database Mirroring Session &#40;SQL Server Management Studio&#41;</span></span>](manually-fail-over-a-database-mirroring-session-sql-server-management-studio.md)  
  
    -   [<span data-ttu-id="7b51c-174">Basculer manuellement une session de mise en miroir de bases de données &#40;Transact-SQL&#41;</span><span class="sxs-lookup"><span data-stu-id="7b51c-174">Manually Fail Over a Database Mirroring Session &#40;Transact-SQL&#41;</span></span>](manually-fail-over-a-database-mirroring-session-transact-sql.md)  
  
6.  <span data-ttu-id="7b51c-175">Configurez la copie des journaux de transaction sur le nouveau principal (auparavant le miroir) comme la base de données primaire.</span><span class="sxs-lookup"><span data-stu-id="7b51c-175">Set up log shipping on the new principal (previously mirror) as the primary database.</span></span>  
  
    > [!IMPORTANT]  
    >  <span data-ttu-id="7b51c-176">N'effectuez pas de configuration à partir d'un serveur secondaire.</span><span class="sxs-lookup"><span data-stu-id="7b51c-176">Do not perform any setup from a secondary.</span></span>  
  
     <span data-ttu-id="7b51c-177">Vous devez utiliser le même partage de sauvegarde que celui utilisé à l'étape 4.</span><span class="sxs-lookup"><span data-stu-id="7b51c-177">You must use the same backup share that you used in step 4.</span></span>  
  
     <span data-ttu-id="7b51c-178">L’interface **Envoi des journaux de transactions** de [!INCLUDE[ssManStudioFull](../../includes/ssmanstudiofull-md.md)] ne prend en charge qu’une base de données primaire par configuration de la copie des journaux de transaction.</span><span class="sxs-lookup"><span data-stu-id="7b51c-178">The **Transaction Log Shipping** interface in [!INCLUDE[ssManStudioFull](../../includes/ssmanstudiofull-md.md)] supports only one primary database per log shipping configuration.</span></span> <span data-ttu-id="7b51c-179">Par conséquent, vous devez utiliser des procédures stockées pour configurer le nouveau principal comme base de données primaire.</span><span class="sxs-lookup"><span data-stu-id="7b51c-179">Therefore, you must use stored procedures to set up the new principal as primary.</span></span>  
  
7.  <span data-ttu-id="7b51c-180">Effectuez un autre basculement manuel pour revenir au principal d'origine.</span><span class="sxs-lookup"><span data-stu-id="7b51c-180">Perform another manual failover to fail back to the original principal.</span></span>  
  
  
