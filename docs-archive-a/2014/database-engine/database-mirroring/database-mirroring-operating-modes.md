---
title: Modes de fonctionnement de la mise en miroir de bases de données | Microsoft Docs
ms.custom: ''
ms.date: 06/13/2017
ms.prod: sql-server-2014
ms.reviewer: ''
ms.technology: high-availability
ms.topic: conceptual
helpviewer_keywords:
- database mirroring [SQL Server], operating modes
ms.assetid: f8a579c2-55d7-4278-8088-f1da1de5b2e6
author: MikeRayMSFT
ms.author: mikeray
ms.openlocfilehash: c944b402b8b1ba9b78036d667ec728ccaf561a91
ms.sourcegitcommit: ad4d92dce894592a259721a1571b1d8736abacdb
ms.translationtype: MT
ms.contentlocale: fr-FR
ms.lasthandoff: 08/04/2020
ms.locfileid: "87601673"
---
# <a name="database-mirroring-operating-modes"></a><span data-ttu-id="89773-102">Modes de fonctionnement de la mise en miroir de bases de données</span><span class="sxs-lookup"><span data-stu-id="89773-102">Database Mirroring Operating Modes</span></span>
  <span data-ttu-id="89773-103">Cette rubrique décrit les modes d'opération synchrones et asynchrones des sessions de mise en miroir de bases de données.</span><span class="sxs-lookup"><span data-stu-id="89773-103">This topic describes the synchronous and asynchronous operating modes for database mirroring sessions.</span></span>  
  
> [!NOTE]  
>  <span data-ttu-id="89773-104">Pour une présentation de la mise en miroir de bases de données, consultez [Mise en miroir de bases de données &#40;SQL Server&#41;](database-mirroring-sql-server.md).</span><span class="sxs-lookup"><span data-stu-id="89773-104">For an introduction to database mirroring, see [Database Mirroring &#40;SQL Server&#41;](database-mirroring-sql-server.md).</span></span>  
  
 
  
##  <a name="terms-and-definitions"></a><a name="TermsAndDefinitions"></a> <span data-ttu-id="89773-105">Termes et définitions</span><span class="sxs-lookup"><span data-stu-id="89773-105">Terms and Definitions</span></span>  
 <span data-ttu-id="89773-106">Cette section présente des termes qui sont essentiels dans cette rubrique.</span><span class="sxs-lookup"><span data-stu-id="89773-106">This section introduces a few terms that are central to this topic.</span></span>  
  
 <span data-ttu-id="89773-107">Mode hautes performances</span><span class="sxs-lookup"><span data-stu-id="89773-107">High-performance mode</span></span>  
 <span data-ttu-id="89773-108">La session de mise en miroir de bases de données s'exécute de façon asynchrone et utilise uniquement le serveur principal et le serveur miroir.</span><span class="sxs-lookup"><span data-stu-id="89773-108">The database mirroring session operates asynchronously and uses only the principal server and mirror server.</span></span> <span data-ttu-id="89773-109">La seule forme de basculement de rôle est le service forcé (avec perte de données possible).</span><span class="sxs-lookup"><span data-stu-id="89773-109">The only form of role switching is forced service (with possible data loss).</span></span>  
  
 <span data-ttu-id="89773-110">Mode haute sécurité</span><span class="sxs-lookup"><span data-stu-id="89773-110">High-safety mode</span></span>  
 <span data-ttu-id="89773-111">La session de mise en miroir de bases de données s'exécute de façon synchrone et, éventuellement, utilise un témoin, ainsi que le serveur principal et le serveur miroir.</span><span class="sxs-lookup"><span data-stu-id="89773-111">The database mirroring session operates synchronously and, optionally, uses a witness, as well as the principal server and mirror server.</span></span>  
  
 <span data-ttu-id="89773-112">Sécurité des transactions</span><span class="sxs-lookup"><span data-stu-id="89773-112">Transaction safety</span></span>  
 <span data-ttu-id="89773-113">Propriété de base de données spécifique de la mise en miroir qui permet de déterminer si une session de mise en miroir de bases de données opère de manière synchrone ou asynchrone.</span><span class="sxs-lookup"><span data-stu-id="89773-113">A mirroring-specific database property that determines whether a database mirroring session operates synchronously or asynchronously.</span></span> <span data-ttu-id="89773-114">Il existe deux niveaux de sécurité : FULL (complète) et OFF (désactivée).</span><span class="sxs-lookup"><span data-stu-id="89773-114">There are two safety levels: FULL and OFF.</span></span>  
  
 <span data-ttu-id="89773-115">Témoin</span><span class="sxs-lookup"><span data-stu-id="89773-115">Witness</span></span>  
 <span data-ttu-id="89773-116">À utiliser uniquement avec le mode haute sécurité. Il s'agit d'une instance facultative de SQL Server qui active le serveur miroir pour déterminer s'il est nécessaire d'initier un basculement automatique.</span><span class="sxs-lookup"><span data-stu-id="89773-116">For use only with high-safety mode, an optional instance of SQL Server that enables the mirror server to recognize whether to initiate an automatic failover.</span></span> <span data-ttu-id="89773-117">Contrairement aux deux autres partenaires de basculement, le témoin ne dessert pas la base de données.</span><span class="sxs-lookup"><span data-stu-id="89773-117">Unlike the two failover partners, the witness does not serve the database.</span></span> <span data-ttu-id="89773-118">La prise en charge du basculement automatique est le seul rôle rempli par le témoin.</span><span class="sxs-lookup"><span data-stu-id="89773-118">Supporting automatic failover is the only role of the witness.</span></span>  
  
##  <a name="asynchronous-database-mirroring-high-performance-mode"></a><a name="VisualElement"></a><span data-ttu-id="89773-119">Mise en miroir de bases de données asynchrones (mode hautes performances)</span><span class="sxs-lookup"><span data-stu-id="89773-119">Asynchronous Database Mirroring (High-Performance Mode)</span></span>  
 <span data-ttu-id="89773-120">Cette section décrit le fonctionnement asynchrone de la mise en miroir de bases de données, lorsqu'il convient d'utiliser le mode hautes performances, et explique comment réagir en cas de défaillance du serveur principal.</span><span class="sxs-lookup"><span data-stu-id="89773-120">This section describes how asynchronous database mirroring works, when it is appropriate to use high-performance mode, and how to respond if the principal server fails.</span></span>  
  
> [!NOTE]  
>  <span data-ttu-id="89773-121">La plupart des éditions de [!INCLUDE[ssCurrent](../../includes/sscurrent-md.md)] prennent uniquement en charge la mise en miroir de bases de données synchrone (« niveau complet sécurité uniquement »).</span><span class="sxs-lookup"><span data-stu-id="89773-121">Most editions of [!INCLUDE[ssCurrent](../../includes/sscurrent-md.md)] support only synchronous database mirroring ("Safety Full Only").</span></span> <span data-ttu-id="89773-122">Pour plus d’informations sur les éditions qui prennent entièrement en charge la mise en miroir de bases de données, consultez « haute disponibilité (AlwaysOn) » dans [fonctionnalités prises en charge par les éditions de SQL Server 2014](../../getting-started/features-supported-by-the-editions-of-sql-server-2014.md).</span><span class="sxs-lookup"><span data-stu-id="89773-122">For information about editions that fully support database mirroring, see "High Availability (AlwaysOn)" in [Features Supported by the Editions of SQL Server 2014](../../getting-started/features-supported-by-the-editions-of-sql-server-2014.md).</span></span>  
  
 <span data-ttu-id="89773-123">Si la sécurité des transactions est désactivée (OFF), la session de mise en miroir de bases de données fonctionne de manière asynchrone.</span><span class="sxs-lookup"><span data-stu-id="89773-123">When transaction safety is set to OFF, the database mirroring session operates asynchronously.</span></span> <span data-ttu-id="89773-124">Le fonctionnement asynchrone ne prend en charge qu’un seul mode d’opération : le mode hautes performances.</span><span class="sxs-lookup"><span data-stu-id="89773-124">Asynchronous operation supports only one operating mode-high-performance mode.</span></span> <span data-ttu-id="89773-125">Ce mode améliore les performances au détriment de la haute disponibilité.</span><span class="sxs-lookup"><span data-stu-id="89773-125">This mode enhances performance at the expense of high availability.</span></span> <span data-ttu-id="89773-126">Le mode hautes performances utilise uniquement le serveur principal et le serveur miroir.</span><span class="sxs-lookup"><span data-stu-id="89773-126">High-performance mode uses just the principal server and the mirror server.</span></span> <span data-ttu-id="89773-127">Les problèmes survenant sur le serveur miroir n'ont jamais d'impact sur le serveur principal.</span><span class="sxs-lookup"><span data-stu-id="89773-127">Problems on the mirror server never impact the principal server.</span></span> <span data-ttu-id="89773-128">En cas de perte du serveur principal, la base de données miroir est marquée comme DISCONNECTED, mais est disponible en état de secours semi-automatique.</span><span class="sxs-lookup"><span data-stu-id="89773-128">On the loss of the principal server, the mirror database is marked DISCONNECTED but is available as a warm standby.</span></span>  
  
 <span data-ttu-id="89773-129">Le mode hautes performances prend en charge une seule forme de basculement de rôle : le service forcé (avec perte de données possible), qui utilise le serveur miroir comme un serveur de secours semi-automatique.</span><span class="sxs-lookup"><span data-stu-id="89773-129">High-performance mode, supports only one form of role switching: forced service (with possible data loss), which uses the mirror server as a warm standby server.</span></span> <span data-ttu-id="89773-130">Le service forcé est l'une des réponses possibles à la défaillance du serveur principal.</span><span class="sxs-lookup"><span data-stu-id="89773-130">Forced service is one of the possible responses to the failure of the principal server.</span></span> <span data-ttu-id="89773-131">Comme une perte de données est possible, vous devez envisager d'autres alternatives avant de forcer le service sur le miroir.</span><span class="sxs-lookup"><span data-stu-id="89773-131">Because data loss is possible, you should consider other alternatives before forcing service to the mirror.</span></span> <span data-ttu-id="89773-132">Pour plus d'informations, consultez [Réponse à la défaillance du principal](#WhenPrincipalFails), plus loin dans cette rubrique.</span><span class="sxs-lookup"><span data-stu-id="89773-132">For more information, see [Responding to Failure of the Principal](#WhenPrincipalFails), later in this topic.</span></span>  
  
 <span data-ttu-id="89773-133">La figure suivante illustre la configuration d'une session à l'aide du mode hautes performances.</span><span class="sxs-lookup"><span data-stu-id="89773-133">The following figure shows the configuration of a session using high-performance mode.</span></span>  
  
 <span data-ttu-id="89773-134">![Configuration de serveur partenaire uniquement d'une session](../media/dbm-high-performance-mode.gif "Configuration de serveur partenaire uniquement d’une session")</span><span class="sxs-lookup"><span data-stu-id="89773-134">![Partner-only configuration of a session](../media/dbm-high-performance-mode.gif "Partner-only configuration of a session")</span></span>  
  
 <span data-ttu-id="89773-135">En mode hautes performances, dès que le serveur principal envoie le journal d'une transaction au serveur miroir, le serveur principal envoie une confirmation au client, sans attendre d'accusé de réception du serveur miroir.</span><span class="sxs-lookup"><span data-stu-id="89773-135">In high-performance mode, as soon as the principal server sends the log for a transaction to the mirror server, the principal server sends a confirmation to the client, without waiting for an acknowledgement from the mirror server.</span></span> <span data-ttu-id="89773-136">Les transactions sont validées sans attendre que le serveur miroir enregistre le journal sur le disque.</span><span class="sxs-lookup"><span data-stu-id="89773-136">Transactions commit without waiting for the mirror server to write the log to disk.</span></span> <span data-ttu-id="89773-137">Le fonctionnement asynchrone permet au serveur principal de s'exécuter avec une latence de transaction minimale.</span><span class="sxs-lookup"><span data-stu-id="89773-137">Asynchronous operation permits the principal server to run with minimum transaction latency.</span></span>  
  
 <span data-ttu-id="89773-138">Le serveur miroir tente de rester à jour par rapport aux enregistrements de journal envoyés par le serveur principal.</span><span class="sxs-lookup"><span data-stu-id="89773-138">The mirror server attempts to keep up with the log records sent by the principal server.</span></span> <span data-ttu-id="89773-139">En revanche, la base de données miroir peut rester quelque peu en arrière de la base de données principale, bien que l'écart entre les bases de données soit faible en général.</span><span class="sxs-lookup"><span data-stu-id="89773-139">But the mirror database might lag somewhat behind the principal database, though typically the gap between the databases is small.</span></span> <span data-ttu-id="89773-140">Cependant, il peut devenir important si le serveur principal est soumis à une charge de travail considérable ou si le système du serveur miroir est surchargé.</span><span class="sxs-lookup"><span data-stu-id="89773-140">However, the gap can become substantial if the principal server is under a heavy work load or the system of the mirror server is over loaded.</span></span>  
  
 
  
###  <a name="when-is-high-performance-mode-appropriate"></a><a name="WhenUseHighPerf"></a> <span data-ttu-id="89773-141">Quand le mode hautes performances est-il conseillé ?</span><span class="sxs-lookup"><span data-stu-id="89773-141">When Is High-Performance Mode Appropriate?</span></span>  
 <span data-ttu-id="89773-142">Le mode hautes performances peut être utile dans un scénario de récupération après sinistre dans lequel le principal et le serveur miroir sont considérablement éloignés et où vous ne souhaitez pas que de petites erreurs affectent le serveur principal.</span><span class="sxs-lookup"><span data-stu-id="89773-142">High-performance mode can be useful in a disaster-recovery scenario in which the principal and mirror servers are separated by a significant distance and where you do not want small errors to impact the principal server.</span></span>  
  
> [!NOTE]  
>  <span data-ttu-id="89773-143">La copie des journaux de transaction peut être un supplément à la mise en miroir de base de données et constitue une alternative favorable à la mise en miroir de base de données asynchrone.</span><span class="sxs-lookup"><span data-stu-id="89773-143">Log shipping can be a supplement to database mirroring and is a favorable alternative to asynchronous database mirroring.</span></span> <span data-ttu-id="89773-144">Pour plus d’informations sur les avantages de la copie des journaux de transaction, consultez [Solutions haute disponibilité &#40;SQL Server&#41;](../../sql-server/failover-clusters/high-availability-solutions-sql-server.md).</span><span class="sxs-lookup"><span data-stu-id="89773-144">For information about the advantages of log shipping, see [High Availability Solutions &#40;SQL Server&#41;](../../sql-server/failover-clusters/high-availability-solutions-sql-server.md).</span></span> <span data-ttu-id="89773-145">Pour plus d’informations sur l’utilisation de l’envoi de journaux avec la mise en miroir de bases de données, consultez [Mise en miroir de bases de données et copie des journaux de transaction &#40;SQL Server&#41;](database-mirroring-and-log-shipping-sql-server.md).</span><span class="sxs-lookup"><span data-stu-id="89773-145">For information on using log shipping with database mirroring, see [Database Mirroring and Log Shipping &#40;SQL Server&#41;](database-mirroring-and-log-shipping-sql-server.md).</span></span>  
  
###  <a name="the-impact-of-a-witness-on-high-performance-mode"></a><a name="WitnessImpactOnHighPerf"></a> <span data-ttu-id="89773-146">Impact d'un témoin sur le mode hautes performances</span><span class="sxs-lookup"><span data-stu-id="89773-146">The Impact of a Witness on High-Performance Mode</span></span>  
 <span data-ttu-id="89773-147">Si vous utilisez Transact-SQL pour configurer le mode hautes performances, chaque fois que la propriété SAFETY est désactivée (OFF), nous vous conseillons vivement d'affecter également la valeur OFF à la propriété WITNESS.</span><span class="sxs-lookup"><span data-stu-id="89773-147">If you use Transact-SQL to configure high-performance mode, whenever the SAFETY property is set to OFF, we strongly recommend that the WITNESS property also be set to OFF.</span></span> <span data-ttu-id="89773-148">Un témoin peut coexister avec le mode hautes performances, mais le témoin ne fournit aucun avantage et introduit un risque.</span><span class="sxs-lookup"><span data-stu-id="89773-148">A witness can coexist with high-performance mode, but the witness provides no benefit and introduces risk.</span></span>  
  
 <span data-ttu-id="89773-149">Si le témoin est déconnecté de la session lorsqu'un des partenaires s'arrête, la base de données n'est plus disponible.</span><span class="sxs-lookup"><span data-stu-id="89773-149">If the witness is disconnected from the session when either partner goes down, the database becomes unavailable.</span></span> <span data-ttu-id="89773-150">Cela s'explique par le fait que même si le mode hautes performance s ne requiert pas de témoin, si un témoin est défini, la session requiert un quorum composé d'au moins deux instances de serveur.</span><span class="sxs-lookup"><span data-stu-id="89773-150">This is because, even though high-performance mode does not require a witness, if one is set, the session requires a quorum consisting of two or more server instances.</span></span> <span data-ttu-id="89773-151">Si la session perd le quorum, elle ne peut pas servir la base de données.</span><span class="sxs-lookup"><span data-stu-id="89773-151">If the session losses quorum, it cannot serve the database.</span></span>  
  
 <span data-ttu-id="89773-152">Lorsqu'un témoin est défini dans une session en mode hautes performances, l'application du quorum signifie que :</span><span class="sxs-lookup"><span data-stu-id="89773-152">When a witness is set in a high-performance mode session, the enforcement of quorum means that:</span></span>  
  
-   <span data-ttu-id="89773-153">Si le serveur miroir est perdu, le serveur principal doit être connecté au témoin.</span><span class="sxs-lookup"><span data-stu-id="89773-153">If the mirror server is lost, the principal server must be connected to the witness.</span></span> <span data-ttu-id="89773-154">Sinon, le serveur principal met sa base de données hors connexion jusqu'à ce que le témoin ou le serveur miroir réintègre la session.</span><span class="sxs-lookup"><span data-stu-id="89773-154">Otherwise, the principal server takes its database offline until either the witness or mirror server rejoins the session.</span></span>  
  
-   <span data-ttu-id="89773-155">Si le serveur principal est perdu, forcer le service sur le serveur miroir exige que le serveur miroir soit connecté au témoin.</span><span class="sxs-lookup"><span data-stu-id="89773-155">If the principal server is lost, forcing service to the mirror server requires that the mirror server be connected to the witness.</span></span>  
  
> [!NOTE]  
>  <span data-ttu-id="89773-156">Pour plus d’informations sur les types de quorums, consultez [Quorum : effets d’un témoin sur la disponibilité de la base de données &#40;Mise en miroir de bases de données&#41;](quorum-how-a-witness-affects-database-availability-database-mirroring.md).</span><span class="sxs-lookup"><span data-stu-id="89773-156">For information about the types of quorums, see [Quorum: How a Witness Affects Database Availability &#40;Database Mirroring&#41;](quorum-how-a-witness-affects-database-availability-database-mirroring.md).</span></span>  
  
###  <a name="responding-to-failure-of-the-principal"></a><a name="WhenPrincipalFails"></a> <span data-ttu-id="89773-157">Réponse à la défaillance du principal</span><span class="sxs-lookup"><span data-stu-id="89773-157">Responding to Failure of the Principal</span></span>  
 <span data-ttu-id="89773-158">Si le principal se bloque, le propriétaire de la base de données dispose des options suivantes :</span><span class="sxs-lookup"><span data-stu-id="89773-158">When the principal fails, the database owner has several choices, as follows:</span></span>  
  
-   <span data-ttu-id="89773-159">Laisser la base de données indisponible jusqu'à ce que le principal soit à nouveau disponible.</span><span class="sxs-lookup"><span data-stu-id="89773-159">Leave the database unavailable until the principal becomes available again.</span></span>  
  
     <span data-ttu-id="89773-160">Si la base de données principale et son journal des transactions interagissent, cette option conserve l'ensemble des transactions validées aux dépens de la disponibilité.</span><span class="sxs-lookup"><span data-stu-id="89773-160">If the principal database and its transaction log are intact, this choice preserves all of the committed transactions at the expense of availability.</span></span>  
  
-   <span data-ttu-id="89773-161">Arrêter la session de mise en miroir de bases de données, mettre à jour manuellement la base de données, puis lancer une nouvelle session de mise en miroir de bases de données.</span><span class="sxs-lookup"><span data-stu-id="89773-161">Stop the database mirroring session, manually update the database, and then begin a new database mirroring session.</span></span>  
  
     <span data-ttu-id="89773-162">Si vous perdez la base de données principale alors que le serveur principal est toujours en cours d'exécution, tentez immédiatement de sauvegarder la fin du journal dans la base de données principale.</span><span class="sxs-lookup"><span data-stu-id="89773-162">If the principal database is lost but the principal server is still running, immediately attempt to back up the tail of the log on the principal database.</span></span> <span data-ttu-id="89773-163">Si cette opération de sauvegarde réussit, la suppression de la mise en miroir peut constituer la meilleure solution.</span><span class="sxs-lookup"><span data-stu-id="89773-163">If the tail-log backup succeeds, removing mirroring may be your best alternative.</span></span> <span data-ttu-id="89773-164">Une fois la mise en miroir supprimée, vous pouvez restaurer le journal dans la base de données miroir précédente, ce qui vous permet de préserver l'ensemble des données.</span><span class="sxs-lookup"><span data-stu-id="89773-164">After removing mirroring, you can restore the log onto the former mirror database, which preserves all of the data.</span></span>  
  
    > [!NOTE]  
    >  <span data-ttu-id="89773-165">Si l'opération de sauvegarde de la fin du journal a échoué et vous ne pouvez pas attendre le rétablissement du serveur principal, envisagez de forcer le service, ce qui offre l'avantage de conserver l'état de la session.</span><span class="sxs-lookup"><span data-stu-id="89773-165">If the tail-log backup failed and you cannot wait for the principal server to recover, consider forcing service, which has the advantage of maintaining the session state.</span></span>  
  
-   <span data-ttu-id="89773-166">Service forcé (avec perte de données potentielle) sur le serveur miroir.</span><span class="sxs-lookup"><span data-stu-id="89773-166">Force service (with possible data loss) on the mirror server.</span></span>  
  
     <span data-ttu-id="89773-167">Le service forcé est exclusivement une méthode de récupération en cas d'urgence qui doit être utilisée de manière limitée.</span><span class="sxs-lookup"><span data-stu-id="89773-167">Forced service is strictly a disaster recovery method and should be used sparingly.</span></span> <span data-ttu-id="89773-168">Il n'est possible de forcer le service que si le serveur principal est hors service, si la session est asynchrone (sécurité des transactions désactivée) et si la session ne possède pas de témoin (la propriété WITNESS a la valeur OFF) ou si le témoin est connecté au serveur miroir (c'est-à-dire, qu'ils ont un quorum).</span><span class="sxs-lookup"><span data-stu-id="89773-168">Forcing service is possible only if the principal server is down, the session is asynchronous (transaction safety is set to OFF), and either the session does not have any witness (the WITNESS property is set to OFF) or the witness is connected to the mirror server (that is, they have quorum).</span></span>  
  
     <span data-ttu-id="89773-169">Si vous forcez le service, le serveur miroir est contraint de jouer le rôle de principal et de servir sa propre copie de la base de données aux clients.</span><span class="sxs-lookup"><span data-stu-id="89773-169">Forcing service causes the mirror server to assume the role of principal and serve its copy of the database for clients.</span></span> <span data-ttu-id="89773-170">En cas de service forcé, les journaux des transactions que le principal n'a pas encore envoyés au serveur miroir sont perdus.</span><span class="sxs-lookup"><span data-stu-id="89773-170">When service is forced, whatever transaction logs the principal has not yet sent to the mirror server are lost.</span></span> <span data-ttu-id="89773-171">Par conséquent, il est conseillé de limiter le service forcé aux situations où un risque de perte de données est acceptable et où la disponibilité immédiate des bases de données est essentielle.</span><span class="sxs-lookup"><span data-stu-id="89773-171">Therefore, you should limit forced service to situations where possible data loss is acceptable and immediate database availability is critical.</span></span> <span data-ttu-id="89773-172">Pour plus d’informations sur le mode de fonctionnement du service forcé et sur les méthodes conseillées pour son utilisation, consultez [Basculement de rôle durant une session de mise en miroir de bases de données &#40;SQL Server&#41;](role-switching-during-a-database-mirroring-session-sql-server.md).</span><span class="sxs-lookup"><span data-stu-id="89773-172">For information on how forced service works and on best practices for using it, see [Role Switching During a Database Mirroring Session &#40;SQL Server&#41;](role-switching-during-a-database-mirroring-session-sql-server.md).</span></span>  
  
##  <a name="synchronous-database-mirroring-high-safety-mode"></a><a name="Sync"></a> <span data-ttu-id="89773-173">Mise en miroir synchrone de bases de données (mode Haute sécurité)</span><span class="sxs-lookup"><span data-stu-id="89773-173">Synchronous Database Mirroring (High-Safety Mode)</span></span>  
 <span data-ttu-id="89773-174">Cette section décrit le fonctionnement synchrone de la mise en miroir de bases de données, ainsi que des autres modes haute sécurité (avec basculement automatique et sans basculement automatique), et fournit des informations sur le rôle de témoin dans le basculement automatique.</span><span class="sxs-lookup"><span data-stu-id="89773-174">This section describes how synchronous database mirroring works, including the alternative high-safety modes (with automatic failover and without automatic failover), and contains information about the role of the witness in automatic failover.</span></span>  
  
 <span data-ttu-id="89773-175">Lorsque la sécurité des transactions est définie à FULL, la session de mise en miroir de la base de données s'exécute en mode haute sécurité et fonctionne de manière synchrone après une phase initiale de synchronisation.</span><span class="sxs-lookup"><span data-stu-id="89773-175">When transaction safety is set to FULL, the database mirroring session runs in high-safety mode and operates synchronously after an initial synchronizing phase.</span></span> <span data-ttu-id="89773-176">Cette section décrit en détail les sessions de mise en miroir de bases de données qui sont configurées pour fonctionner de manière synchrone.</span><span class="sxs-lookup"><span data-stu-id="89773-176">This section describes the details of database mirroring sessions that are configured for synchronous operation.</span></span>  
  
 <span data-ttu-id="89773-177">Pour passer en mode synchrone pour une session, le serveur miroir doit synchroniser la base de données miroir avec la base de données principale.</span><span class="sxs-lookup"><span data-stu-id="89773-177">To achieve synchronous operation for a session, the mirror server must synchronize the mirror database with the principal database.</span></span> <span data-ttu-id="89773-178">Lorsque la session commence, le serveur principal commence à envoyer son journal actif au serveur miroir.</span><span class="sxs-lookup"><span data-stu-id="89773-178">When the session begins, the principal server begins sending its active log to the mirror server.</span></span> <span data-ttu-id="89773-179">Le serveur miroir écrit aussi vite que possible tous les enregistrements de journal entrants sur le disque.</span><span class="sxs-lookup"><span data-stu-id="89773-179">The mirror server writes all of the incoming log records to disk as quickly as possible.</span></span> <span data-ttu-id="89773-180">Une fois cette opération effectuée, les bases de données sont synchronisées.</span><span class="sxs-lookup"><span data-stu-id="89773-180">As soon as all of the received log records have been written to disk, the databases are synchronized.</span></span> <span data-ttu-id="89773-181">Tant que les partenaires restent en communication, les bases de données sont synchronisées.</span><span class="sxs-lookup"><span data-stu-id="89773-181">As long as the partners remain in communication, the databases remain synchronized.</span></span>  
  
> [!NOTE]  
>  <span data-ttu-id="89773-182">Pour surveiller les modifications d'état dans une session de mise en miroir de base de données, utilisez la classe d'événements **Database Mirroring State Change** .</span><span class="sxs-lookup"><span data-stu-id="89773-182">To monitor state changes in a database mirroring session, use the **Database Mirroring State Change** event class.</span></span> <span data-ttu-id="89773-183">Pour plus d'informations, voir [Database Mirroring State Change Event Class](../../relational-databases/event-classes/database-mirroring-state-change-event-class.md).</span><span class="sxs-lookup"><span data-stu-id="89773-183">For more information, see [Database Mirroring State Change Event Class](../../relational-databases/event-classes/database-mirroring-state-change-event-class.md).</span></span>  
  
 <span data-ttu-id="89773-184">Après que la synchronisation a pris fin, chaque transaction validée dans la base de données principale l'est également sur le serveur miroir, ce qui garantit la protection des données.</span><span class="sxs-lookup"><span data-stu-id="89773-184">After synchronization finishes, every transaction committed on the principal database is also committed on the mirror server, guaranteeing protection of the data.</span></span> <span data-ttu-id="89773-185">En effet, la transaction n'est validée dans la base de données principale qu'une fois que le serveur principal a reçu un message du serveur miroir lui indiquant que le journal des transactions est bien renforcé sur le disque.</span><span class="sxs-lookup"><span data-stu-id="89773-185">This is achieved by waiting to commit a transaction on the principal database, until the principal server receives a message from the mirror server stating that it has hardened the transaction's log to disk.</span></span> <span data-ttu-id="89773-186">Notez que le fait d'attendre ce message augmente la latence de la transaction.</span><span class="sxs-lookup"><span data-stu-id="89773-186">Note the wait for this message increases the latency of the transaction.</span></span>  
  
 <span data-ttu-id="89773-187">Le temps nécessaire à la synchronisation dépend essentiellement du décalage de la base de données miroir par rapport à la base de données principale au début de la session (ce qui se mesure par le nombre de d'enregistrements du journal initialement reçus du serveur principal), de la charge de travail sur la base de données principale et de la vitesse du système de mise en miroir.</span><span class="sxs-lookup"><span data-stu-id="89773-187">The time required for synchronization depends essentially on how far the mirror database was behind the principal database at the start of the session (measured by the number of log records initially received from the principal server), the work load on the principal database, and the speed of the mirror system.</span></span> <span data-ttu-id="89773-188">Après la synchronisation d'une session, le journal renforcé qui doit être réutilisé sur la base de données miroir reste dans la file d'attente de restauration par progression.</span><span class="sxs-lookup"><span data-stu-id="89773-188">After a session is synchronized, the hardened log that has yet to be redone on the mirror database remains in the redo queue.</span></span>  
  
 <span data-ttu-id="89773-189">Dès que la base de données miroir est synchronisée, l'état des deux copies de la base de données devient SYNCHRONIZED.</span><span class="sxs-lookup"><span data-stu-id="89773-189">As soon as the mirror database becomes synchronized, the state of both the copies of the database changes to SYNCHRONIZED.</span></span>  
  
 <span data-ttu-id="89773-190">L'opération se déroule de la manière suivante :</span><span class="sxs-lookup"><span data-stu-id="89773-190">Synchronous operation is maintained in the following manner:</span></span>  
  
1.  <span data-ttu-id="89773-191">Lors de la réception d'une transaction d'un client, le serveur principal l'écrit dans le journal des transactions.</span><span class="sxs-lookup"><span data-stu-id="89773-191">On receiving a transaction from a client, the principal server writes the log for the transaction to the transaction log.</span></span>  
  
2.  <span data-ttu-id="89773-192">Le serveur principal écrit la transaction dans la base de données, et simultanément, il envoie l'enregistrement du journal au serveur miroir.</span><span class="sxs-lookup"><span data-stu-id="89773-192">The principal server writes the transaction to the database and, concurrently, sends the log record to the mirror server.</span></span> <span data-ttu-id="89773-193">Le serveur principal attend un accusé de réception du serveur miroir avant de confirmer un de ces éléments au client : une validation de transaction ou une restauration.</span><span class="sxs-lookup"><span data-stu-id="89773-193">The principal server waits for an acknowledgement from the mirror server before confirming either of the following to the client: a transaction commit or a rollback.</span></span>  
  
3.  <span data-ttu-id="89773-194">Le serveur miroir renforce le journal sur le disque et retourne un accusé de réception au serveur principal.</span><span class="sxs-lookup"><span data-stu-id="89773-194">The mirror server hardens the log to disk and returns an acknowledgement to the principal server.</span></span>  
  
4.  <span data-ttu-id="89773-195">Dès qu'il reçoit l'accusé de réception du serveur miroir, le serveur principal envoie un message de confirmation au client.</span><span class="sxs-lookup"><span data-stu-id="89773-195">On receiving the acknowledgement from the mirror server, the principal server sends a confirmation message to the client.</span></span>  
  
 <span data-ttu-id="89773-196">Le mode haute sécurité protège vos données en exigeant leur synchronisation entre deux emplacements.</span><span class="sxs-lookup"><span data-stu-id="89773-196">High-safety mode protects your data by requiring the data to be synchronized between two places.</span></span> <span data-ttu-id="89773-197">Toutes les transactions validées seront écrites sur le disque du serveur miroir.</span><span class="sxs-lookup"><span data-stu-id="89773-197">All the committed transactions are guaranteed to be written to disk on the mirror server.</span></span>  
  

  
###  <a name="high-safety-mode-without-automatic-failover"></a><a name="HighSafetyWithOutAutoFailover"></a> <span data-ttu-id="89773-198">Mode Haute sécurité sans basculement automatique</span><span class="sxs-lookup"><span data-stu-id="89773-198">High-Safety Mode Without Automatic Failover</span></span>  
 <span data-ttu-id="89773-199">La figure suivante illustre la configuration du mode haute sécurité sans basculement automatique.</span><span class="sxs-lookup"><span data-stu-id="89773-199">The following figure shows the configuration of high-safety mode without automatic failover.</span></span> <span data-ttu-id="89773-200">La configuration implique uniquement les deux partenaires.</span><span class="sxs-lookup"><span data-stu-id="89773-200">The configuration consists of only the two partners.</span></span>  
  
 <span data-ttu-id="89773-201">![Serveurs partenaires communiquant sans témoin](../media/dbm-high-protection-mode.gif "Serveurs partenaires communiquant sans témoin")</span><span class="sxs-lookup"><span data-stu-id="89773-201">![Partners communicating without a witness](../media/dbm-high-protection-mode.gif "Partners communicating without a witness")</span></span>  
  
 <span data-ttu-id="89773-202">Lorsque les partenaires sont connectés et que la base de données est déjà synchronisée, un basculement manuel est possible.</span><span class="sxs-lookup"><span data-stu-id="89773-202">When the partners are connected and the database is already synchronized, manual failover is supported.</span></span> <span data-ttu-id="89773-203">Si l'instance du serveur miroir s'arrête, l'instance du serveur principal n'est pas affectée par cet arrêt et s'exécute de manière exposée (à savoir, sans mise en miroir des données).</span><span class="sxs-lookup"><span data-stu-id="89773-203">If the mirror server instance goes down, the principal server instance is unaffected and runs exposed (that is without mirroring the data).</span></span> <span data-ttu-id="89773-204">En cas de perte du serveur principal, le miroir est suspendu mais le service peut être forcé sur le serveur miroir (perte de données possible).</span><span class="sxs-lookup"><span data-stu-id="89773-204">If the principal server is lost, the mirror is suspended, but service can be forced to the mirror server (with possible data loss).</span></span> <span data-ttu-id="89773-205">Pour plus d’informations, consultez [Basculement de rôle durant une session de mise en miroir de bases de données &#40;SQL Server&#41;](role-switching-during-a-database-mirroring-session-sql-server.md).</span><span class="sxs-lookup"><span data-stu-id="89773-205">For more information, see [Role Switching During a Database Mirroring Session &#40;SQL Server&#41;](role-switching-during-a-database-mirroring-session-sql-server.md).</span></span>  
  
###  <a name="high-safety-mode-with-automatic-failover"></a><a name="HighSafetyWithAutoFailover"></a> <span data-ttu-id="89773-206">Mode Haute sécurité avec basculement automatique</span><span class="sxs-lookup"><span data-stu-id="89773-206">High-Safety Mode with Automatic Failover</span></span>  
 <span data-ttu-id="89773-207">Pour garantir une disponibilité optimale, le basculement automatique s'assure que la base de données est toujours desservie après la perte d'un serveur.</span><span class="sxs-lookup"><span data-stu-id="89773-207">Automatic failover provides high availability by ensuring that the database is still served after the loss of one server.</span></span> <span data-ttu-id="89773-208">Le basculement automatique exige que la session dispose d'une troisième instance de serveur (le *témoin*) résidant de préférence sur un troisième ordinateur.</span><span class="sxs-lookup"><span data-stu-id="89773-208">Automatic failover requires that the session possess a third server instance, the *witness*, which ideally resides on a third computer.</span></span> <span data-ttu-id="89773-209">La figure suivante illustre la configuration d'une session en mode haute sécurité avec basculement automatique.</span><span class="sxs-lookup"><span data-stu-id="89773-209">The following figure shows the configuration of a high-safety mode session that supports automatic failover.</span></span>  
  
 <span data-ttu-id="89773-210">![Témoin et deux serveurs partenaires d’une session](../media/dbm-high-availability-mode.gif "Témoin et deux serveurs partenaires d’une session")</span><span class="sxs-lookup"><span data-stu-id="89773-210">![The witness and two partners of a session](../media/dbm-high-availability-mode.gif "The witness and two partners of a session")</span></span>  
  
 <span data-ttu-id="89773-211">Contrairement aux deux autres, le témoin ne dessert pas la base de données.</span><span class="sxs-lookup"><span data-stu-id="89773-211">Unlike the two partners, the witness does not serve the database.</span></span> <span data-ttu-id="89773-212">Le témoin prend simplement en charge le basculement automatique en vérifiant que le serveur principal est activé et qu'il fonctionne.</span><span class="sxs-lookup"><span data-stu-id="89773-212">The witness simply supports automatic failover by verifying whether the principal server is up and functioning.</span></span> <span data-ttu-id="89773-213">Le serveur miroir lance le basculement automatique uniquement si le miroir et le témoin restent connectés l'un à l'autre après que tous les deux aient été déconnectés du serveur principal.</span><span class="sxs-lookup"><span data-stu-id="89773-213">The mirror server initiates automatic failover only if the mirror and the witness remain connected to each other after both have been disconnected from the principal server.</span></span>  
  
 <span data-ttu-id="89773-214">Lorsque vous définissez un témoin, la session nécessite un *quorum*, c’est-à-dire une relation entre au moins deux instances de serveur qui permet de rendre disponible la base de données.</span><span class="sxs-lookup"><span data-stu-id="89773-214">When a witness is set, the session requires *quorum*-a relationship between at least two server instances that allows the database to be made available.</span></span> <span data-ttu-id="89773-215">Pour plus d’informations, consultez [Témoin de mise en miroir de base de données](database-mirroring-witness.md) et [Quorum : effets d’un témoin sur la disponibilité de la base de données &#40;Mise en miroir de bases de données&#41;](quorum-how-a-witness-affects-database-availability-database-mirroring.md).</span><span class="sxs-lookup"><span data-stu-id="89773-215">For more information, see [Database Mirroring Witness](database-mirroring-witness.md) and [Quorum: How a Witness Affects Database Availability &#40;Database Mirroring&#41;](quorum-how-a-witness-affects-database-availability-database-mirroring.md).</span></span>  
  
 <span data-ttu-id="89773-216">Le basculement automatique nécessite les conditions suivantes :</span><span class="sxs-lookup"><span data-stu-id="89773-216">Automatic failover requires the following conditions:</span></span>  
  
-   <span data-ttu-id="89773-217">La base de données est déjà synchronisée.</span><span class="sxs-lookup"><span data-stu-id="89773-217">The database is already synchronized.</span></span>  
  
-   <span data-ttu-id="89773-218">L'échec survient lorsque les trois instances de serveur sont connectées et le témoin et le serveur miroir sont toujours connectés.</span><span class="sxs-lookup"><span data-stu-id="89773-218">The failure occurs while all three server instances are connected, and the witness and mirror server remain connected.</span></span>  
  
 <span data-ttu-id="89773-219">La perte d'un partenaire a les effets suivants :</span><span class="sxs-lookup"><span data-stu-id="89773-219">The loss of a partner has the following effect:</span></span>  
  
-   <span data-ttu-id="89773-220">Si le serveur principal devient indisponible dans les conditions énoncées ci-avant, il y a basculement automatique.</span><span class="sxs-lookup"><span data-stu-id="89773-220">If the principal server becomes unavailable under the above conditions, automatic failover occurs.</span></span> <span data-ttu-id="89773-221">Le serveur miroir devient le principal et il propose sa base de données comme base de données principale.</span><span class="sxs-lookup"><span data-stu-id="89773-221">The mirror server switches to the role of principal, and it offers its database as the principal database.</span></span>  
  
-   <span data-ttu-id="89773-222">Si le serveur principal devient indisponible lorsque ces conditions sont respectées, il est possible de forcer le service (avec perte de données possible).</span><span class="sxs-lookup"><span data-stu-id="89773-222">If the principal server becomes unavailable when those conditions are not met, forcing service (with possible data loss) might be possible.</span></span> <span data-ttu-id="89773-223">Pour plus d’informations, consultez [Basculement de rôle durant une session de mise en miroir de bases de données &#40;SQL Server&#41;](role-switching-during-a-database-mirroring-session-sql-server.md).</span><span class="sxs-lookup"><span data-stu-id="89773-223">For more information, see [Role Switching During a Database Mirroring Session &#40;SQL Server&#41;](role-switching-during-a-database-mirroring-session-sql-server.md).</span></span>  
  
-   <span data-ttu-id="89773-224">Si le seul serveur miroir devient indisponible, le principal et le serveur témoin continuent de fonctionner.</span><span class="sxs-lookup"><span data-stu-id="89773-224">If the only mirror server becomes unavailable, the principal and witness continue.</span></span>  
  
 <span data-ttu-id="89773-225">Si la session perd son témoin, un quorum nécessite l'intervention des deux partenaires.</span><span class="sxs-lookup"><span data-stu-id="89773-225">If the session loses its witness, quorum requires both partners.</span></span> <span data-ttu-id="89773-226">Si l'un des partenaires perd le quorum, les deux partenaires perdent le quorum, et la base de données n'est plus disponible tant que le quorum n'a pas été rétabli.</span><span class="sxs-lookup"><span data-stu-id="89773-226">If either partner loses quorum, both partners lose quorum, and the database becomes unavailable until quorum is re-established.</span></span> <span data-ttu-id="89773-227">Cet impératif de quorum garantit que, en l'absence d'un témoin, la base de données ne s'exécute jamais de manière *exposée*, c'est-à-dire sans être mise en miroir.</span><span class="sxs-lookup"><span data-stu-id="89773-227">This quorum requirement makes sure that in the absence of a witness the database never runs *exposed*, that is without being mirrored.</span></span>  
  
> [!NOTE]  
>  <span data-ttu-id="89773-228">Si vous pensez que le témoin va rester déconnecté pendant un laps de temps important, nous vous recommandons de le supprimer de votre session jusqu'à ce qu'il devienne disponible.</span><span class="sxs-lookup"><span data-stu-id="89773-228">If you expect the witness to remain disconnected for a significant amount of time, we recommend that you remove the witness from the session until it becomes available.</span></span>  
  
##  <a name="transact-sql-settings-and-database-mirroring-operating-modes"></a><a name="TsqlSettingsAndOpModes"></a> <span data-ttu-id="89773-229">Paramètres Transact-SQL et modes d'opération de mise en miroir de bases de données</span><span class="sxs-lookup"><span data-stu-id="89773-229">Transact-SQL Settings and Database Mirroring Operating Modes</span></span>  
 <span data-ttu-id="89773-230">Cette section décrit une session de mise en miroir de bases de données du point de vue des paramètres inclus dans la clause ALTER DATABASE et des états de la base de données mise en miroir ainsi que du témoin, le cas échéant.</span><span class="sxs-lookup"><span data-stu-id="89773-230">This section describes a database mirroring session in terms of the ALTER DATABASE settings and states of the mirrored database and witness, if any.</span></span> <span data-ttu-id="89773-231">Cette section est destinée aux utilisateurs chargés de mettre en miroir la base de données prioritairement ou exclusivement à l'aide de [!INCLUDE[tsql](../../includes/tsql-md.md)]plutôt que [!INCLUDE[ssManStudioFull](../../includes/ssmanstudiofull-md.md)].</span><span class="sxs-lookup"><span data-stu-id="89773-231">The section is aimed at users who manage database mirroring primarily or exclusively using [!INCLUDE[tsql](../../includes/tsql-md.md)], rather than using [!INCLUDE[ssManStudioFull](../../includes/ssmanstudiofull-md.md)].</span></span>  
  
> [!TIP]  
>  <span data-ttu-id="89773-232">Au lieu d'utiliser [!INCLUDE[tsql](../../includes/tsql-md.md)], vous pouvez aussi contrôler le mode d'opération d'une session dans l'Explorateur d'objets à travers la page **Mise en miroir** se trouvant dans la boîte de dialogue **Propriétés de la base de données** .</span><span class="sxs-lookup"><span data-stu-id="89773-232">As an alternative to using [!INCLUDE[tsql](../../includes/tsql-md.md)], you can control the operating mode of a session in Object Explorer using the **Mirroring** page of the **Database Properties** dialog box.</span></span> <span data-ttu-id="89773-233">Pour plus d’informations, consultez [Établir une session de mise en miroir de bases de données au moyen de l’authentification Windows &#40;SQL Server Management Studio&#41;](establish-database-mirroring-session-windows-authentication.md).</span><span class="sxs-lookup"><span data-stu-id="89773-233">For more information, see [Establish a Database Mirroring Session Using Windows Authentication &#40;SQL Server Management Studio&#41;](establish-database-mirroring-session-windows-authentication.md).</span></span>  
  

  
###  <a name="how-transaction-safety-and-witness-state-affect-the-operating-mode"></a><a name="TxnSafetyAndWitness"></a> <span data-ttu-id="89773-234">Comment la sécurité liée aux transactions et l'état du témoin affectent le mode d'opération</span><span class="sxs-lookup"><span data-stu-id="89773-234">How Transaction Safety and Witness State Affect the Operating Mode</span></span>  
 <span data-ttu-id="89773-235">Le mode d'opération d'une session est déterminé par la combinaison entre le paramètre relatif à la sécurité des transactions et l'état du témoin.</span><span class="sxs-lookup"><span data-stu-id="89773-235">The operating mode of a session is determined by the combination of its transaction safety setting and the state of the witness.</span></span> <span data-ttu-id="89773-236">Le propriétaire de la base de données peut à tout moment modifier le niveau de sécurité des transactions et ajouter ou supprimer le témoin.</span><span class="sxs-lookup"><span data-stu-id="89773-236">At any time, the database owner can change the transaction safety level, and can add or remove the witness.</span></span>  
  

  
####  <a name="transaction-safety"></a><a name="TxnSafety"></a> <span data-ttu-id="89773-237">Transaction Safety</span><span class="sxs-lookup"><span data-stu-id="89773-237">Transaction Safety</span></span>  
 <span data-ttu-id="89773-238">La sécurité des transactions est une propriété de base de données spécifique de la mise en miroir qui permet de déterminer si une session de mise en miroir de bases de données opère de manière synchrone ou asynchrone.</span><span class="sxs-lookup"><span data-stu-id="89773-238">Transaction safety is a mirroring-specific database property that determines whether a database mirroring session operates synchronously or asynchronously.</span></span> <span data-ttu-id="89773-239">Il existe deux niveaux de sécurité : FULL (complète) et OFF (désactivée).</span><span class="sxs-lookup"><span data-stu-id="89773-239">There are two safety levels: FULL and OFF.</span></span>  
  
-   <span data-ttu-id="89773-240">SAFETY FULL</span><span class="sxs-lookup"><span data-stu-id="89773-240">SAFETY FULL</span></span>  
  
     <span data-ttu-id="89773-241">La sécurité de transactions complète entraîne le mode d'opération asynchrone de la session, en mode haute sécurité.</span><span class="sxs-lookup"><span data-stu-id="89773-241">Full transaction safety causes the session to operate synchronously in high-safety mode.</span></span> <span data-ttu-id="89773-242">En présence d'un témoin, une session prend en charge le basculement automatique.</span><span class="sxs-lookup"><span data-stu-id="89773-242">If a witness is present, a session supports automatic failover.</span></span>  
  
     <span data-ttu-id="89773-243">Lorsque vous créez une session à l'aide des instructions ALTER DATABASE, la session démarre avec le paramètre SAFETY défini à FULL, ce qui signifie qu'elle débute en mode haute sécurité.</span><span class="sxs-lookup"><span data-stu-id="89773-243">When you establish a session using ALTER DATABASE statements, the session begins with the SAFETY property set to FULL; that is, the session begins in high-safety mode.</span></span> <span data-ttu-id="89773-244">Après démarrage de la session, vous pouvez ajouter un témoin.</span><span class="sxs-lookup"><span data-stu-id="89773-244">After the session begins, you can add a witness.</span></span>  
  
     <span data-ttu-id="89773-245">Pour plus d’informations, consultez [Mise en miroir de bases de données synchrone (mode Haute sécurité)](#Sync), plus haut dans cette rubrique.</span><span class="sxs-lookup"><span data-stu-id="89773-245">For more information, see [Synchronous Database Mirroring (High-Safety Mode)](#Sync), earlier in this topic.</span></span>  
  
-   <span data-ttu-id="89773-246">SAFETY OFF</span><span class="sxs-lookup"><span data-stu-id="89773-246">SAFETY OFF</span></span>  
  
     <span data-ttu-id="89773-247">Désactiver la sécurité des transactions entraîne le mode d'opération asynchrone de la session, en mode hautes performances.</span><span class="sxs-lookup"><span data-stu-id="89773-247">Turning off transaction safety causes the session to operate asynchronously, in high-performance mode.</span></span> <span data-ttu-id="89773-248">Si la propriété SAFETY est définie à OFF, la propriété WITNESS doit également être définie sur cette valeur (valeur par défaut).</span><span class="sxs-lookup"><span data-stu-id="89773-248">If the SAFETY property is set to OFF, the WITNESS property should also be set to OFF (the default).</span></span> <span data-ttu-id="89773-249">Pour obtenir des informations sur l’impact du témoin en mode hautes performances, consultez la section [État du témoin](#WitnessState), plus loin dans cette rubrique.</span><span class="sxs-lookup"><span data-stu-id="89773-249">For information about the impact of the witness in high-performance mode, see [The State of the Witness](#WitnessState), later in this topic.</span></span> <span data-ttu-id="89773-250">Pour plus d’informations sur le fonctionnement avec la sécurité des transactions désactivée, consultez [Mise en miroir de bases de données asynchrone (mode Hautes performances)](#VisualElement), plus haut dans cette rubrique.</span><span class="sxs-lookup"><span data-stu-id="89773-250">For more information about running with transaction safety turned off, see [Asynchronous Database Mirroring (High-Performance Mode)](#VisualElement), earlier in this topic.</span></span>  
  
 <span data-ttu-id="89773-251">Le paramètre de sécurité des transactions de la base de données est enregistré pour chaque serveur partenaire dans la vue de catalogue **sys.database_mirroring** des colonnes **mirroring_safety_level** et **mirroring_safety_level_desc**.</span><span class="sxs-lookup"><span data-stu-id="89773-251">The transaction safety setting of the database is recorded on each partner in the **sys.database_mirroring** catalog view in the **mirroring_safety_level** and **mirroring_safety_level_desc** columns.</span></span> <span data-ttu-id="89773-252">Pour plus d’informations, consultez [sys.database_mirroring &#40;Transact-SQL&#41;](/sql/relational-databases/system-catalog-views/sys-database-mirroring-transact-sql).</span><span class="sxs-lookup"><span data-stu-id="89773-252">For more information, see [sys.database_mirroring &#40;Transact-SQL&#41;](/sql/relational-databases/system-catalog-views/sys-database-mirroring-transact-sql).</span></span>  
  
 <span data-ttu-id="89773-253">Le propriétaire de la base de données peut modifier le niveau de sécurité des transactions à tout moment.</span><span class="sxs-lookup"><span data-stu-id="89773-253">The database owner can change the transaction safety level at any time.</span></span>  
  
####  <a name="the-state-of-the-witness"></a><a name="WitnessState"></a> <span data-ttu-id="89773-254">État du témoin</span><span class="sxs-lookup"><span data-stu-id="89773-254">The State of the Witness</span></span>  
 <span data-ttu-id="89773-255">Si un témoin a été défini, I'utilisation d'un quorum justifiant en permanence l'importance du témoin est nécessaire.</span><span class="sxs-lookup"><span data-stu-id="89773-255">If a witness has been set, quorum is required, so the state of the witness is always significant.</span></span>  
  
 <span data-ttu-id="89773-256">S'il existe, le témoin affiche l'un des deux états suivants :</span><span class="sxs-lookup"><span data-stu-id="89773-256">If it exists, the witness has one of two states:</span></span>  
  
-   <span data-ttu-id="89773-257">Lorsque le témoin est connecté à un partenaire, il apparaît à l'état CONNECTED (connecté) par rapport au partenaire et possède un quorum avec ce dernier.</span><span class="sxs-lookup"><span data-stu-id="89773-257">When the witness is connected to a partner, the witness is in the CONNECTED state relative to that partner and has quorum with that partner.</span></span> <span data-ttu-id="89773-258">Dans ce cas, la base de données peut être mise à disposition même si l'un des partenaires n'est pas disponible.</span><span class="sxs-lookup"><span data-stu-id="89773-258">In this case, the database can be made available, even if one of the partners is unavailable.</span></span>  
  
-   <span data-ttu-id="89773-259">Lorsque le témoin existe mais n'est pas connecté à un partenaire, il apparaît à l'état UNKNOWN (inconnu) ou DISCONNECTED (déconnecté) par rapport au partenaire.</span><span class="sxs-lookup"><span data-stu-id="89773-259">When the witness exists but is not connected to a partner, the witness is in the UNKOWN or DISCONNECTED state relative to that partner.</span></span> <span data-ttu-id="89773-260">Dans ce cas, le témoin ne dispose d'aucun quorum avec ce partenaire et la base de données devient indisponible si les partenaires ne sont pas connectés entre eux.</span><span class="sxs-lookup"><span data-stu-id="89773-260">In this case, the witness lacks quorum with that partner, and if the partners are not connected to each other, the database becomes unavailable.</span></span>  
  
 <span data-ttu-id="89773-261">Pour plus d’informations sur les quorums, consultez [Quorum : effets d’un témoin sur la disponibilité de la base de données &#40;Mise en miroir de bases de données&#41;](quorum-how-a-witness-affects-database-availability-database-mirroring.md).</span><span class="sxs-lookup"><span data-stu-id="89773-261">For information about quorum, see [Quorum: How a Witness Affects Database Availability &#40;Database Mirroring&#41;](quorum-how-a-witness-affects-database-availability-database-mirroring.md).</span></span>  
  
 <span data-ttu-id="89773-262">L’état de chaque témoin d’une instance de serveur est enregistré dans la vue de catalogue **sys.database_mirroring** au niveau des colonnes **mirroring_witness_state** et **mirroring_witness_state_desc**.</span><span class="sxs-lookup"><span data-stu-id="89773-262">The state of each witness on a server instance is recorded in the **sys.database_mirroring** catalog view in the **mirroring_witness_state** and **mirroring_witness_state_desc** columns.</span></span> <span data-ttu-id="89773-263">Pour plus d’informations, consultez [sys.database_mirroring &#40;Transact-SQL&#41;](/sql/relational-databases/system-catalog-views/sys-database-mirroring-transact-sql).</span><span class="sxs-lookup"><span data-stu-id="89773-263">For more information, see [sys.database_mirroring &#40;Transact-SQL&#41;](/sql/relational-databases/system-catalog-views/sys-database-mirroring-transact-sql).</span></span>  
  
 <span data-ttu-id="89773-264">Le tableau suivant répertorie le mode d'opération d'une session dépendant de son paramètre relatif à la sécurité des transactions et de l'état du témoin.</span><span class="sxs-lookup"><span data-stu-id="89773-264">The following table summarizes how the operating mode of a session depends upon its transaction safety setting and on state of the witness.</span></span>  
  
|<span data-ttu-id="89773-265">Mode d'opération</span><span class="sxs-lookup"><span data-stu-id="89773-265">Operating mode</span></span>|<span data-ttu-id="89773-266">Sécurité des transactions</span><span class="sxs-lookup"><span data-stu-id="89773-266">Transaction safety</span></span>|<span data-ttu-id="89773-267">État du serveur</span><span class="sxs-lookup"><span data-stu-id="89773-267">Witness state</span></span>|  
|--------------------|------------------------|-------------------|  
|<span data-ttu-id="89773-268">Mode hautes performances</span><span class="sxs-lookup"><span data-stu-id="89773-268">High-performance mode</span></span>|<span data-ttu-id="89773-269">OFF</span><span class="sxs-lookup"><span data-stu-id="89773-269">OFF</span></span>|<span data-ttu-id="89773-270">NULL (pas de témoin)<sup>2</sup></span><span class="sxs-lookup"><span data-stu-id="89773-270">NULL (no witness)<sup>2</sup></span></span>|  
|<span data-ttu-id="89773-271">Mode Haute sécurité sans basculement automatique</span><span class="sxs-lookup"><span data-stu-id="89773-271">High-safety mode without automatic failover</span></span>|<span data-ttu-id="89773-272">FULL</span><span class="sxs-lookup"><span data-stu-id="89773-272">FULL</span></span>|<span data-ttu-id="89773-273">NULL (pas de témoin)</span><span class="sxs-lookup"><span data-stu-id="89773-273">NULL (no witness)</span></span>|  
|<span data-ttu-id="89773-274">Mode haute sécurité avec basculement automatique<sup>1</sup></span><span class="sxs-lookup"><span data-stu-id="89773-274">High-safety mode with automatic failover<sup>1</sup></span></span>|<span data-ttu-id="89773-275">FULL</span><span class="sxs-lookup"><span data-stu-id="89773-275">FULL</span></span>|<span data-ttu-id="89773-276">CONNECTED</span><span class="sxs-lookup"><span data-stu-id="89773-276">CONNECTED</span></span>|  
  
 <span data-ttu-id="89773-277"><sup>1</sup> si le témoin est déconnecté, nous vous recommandons de définir l’option Witness sur désactivé jusqu’à ce que l’instance de serveur témoin devienne disponible.</span><span class="sxs-lookup"><span data-stu-id="89773-277"><sup>1</sup> If the witness becomes disconnected, we recommend that you set WITNESS OFF until the witness server instance becomes available.</span></span>  
  
 <span data-ttu-id="89773-278"><sup>2</sup> si un témoin est présent en mode hautes performances, le témoin ne participe pas à la session.</span><span class="sxs-lookup"><span data-stu-id="89773-278"><sup>2</sup> If a witness is present in high-performance mode, the witness does not participate in the session.</span></span> <span data-ttu-id="89773-279">Cependant, pour rendre la base de données disponible, deux au moins des instances du serveur doivent rester connectées.</span><span class="sxs-lookup"><span data-stu-id="89773-279">However, to make the database available, at least two of the server instances must remain connected.</span></span> <span data-ttu-id="89773-280">Par conséquent, nous vous recommandons de conserver la propriété WITNESS défini à OFF dans les sessions en mode hautes performances.</span><span class="sxs-lookup"><span data-stu-id="89773-280">Therefore, we recommend keeping the WITNESS property set to OFF in high-performance mode sessions.</span></span> <span data-ttu-id="89773-281">Pour plus d’informations, consultez [Quorum : effets d’un témoin sur la disponibilité de la base de données &#40;Mise en miroir de bases de données&#41;](quorum-how-a-witness-affects-database-availability-database-mirroring.md).</span><span class="sxs-lookup"><span data-stu-id="89773-281">For more information, see [Quorum: How a Witness Affects Database Availability &#40;Database Mirroring&#41;](quorum-how-a-witness-affects-database-availability-database-mirroring.md).</span></span>  
  
###  <a name="viewing-the-safety-setting-and-state-of-the-witness"></a><a name="ViewWitness"></a> <span data-ttu-id="89773-282">Affichage du paramètre de sécurité et de l'état du témoin</span><span class="sxs-lookup"><span data-stu-id="89773-282">Viewing the Safety Setting and State of the Witness</span></span>  
 <span data-ttu-id="89773-283">Pour afficher le paramètre de sécurité et l’état du témoin d’une base de données, utilisez la vue de catalogue **sys.database_mirroring** .</span><span class="sxs-lookup"><span data-stu-id="89773-283">To view the safety setting and the state of the witness for a database, use the **sys.database_mirroring** catalog view.</span></span> <span data-ttu-id="89773-284">Les colonnes les plus pertinentes sont les suivantes :</span><span class="sxs-lookup"><span data-stu-id="89773-284">The relevant columns are as follows:</span></span>  
  
|<span data-ttu-id="89773-285">Factor</span><span class="sxs-lookup"><span data-stu-id="89773-285">Factor</span></span>|<span data-ttu-id="89773-286">Colonnes</span><span class="sxs-lookup"><span data-stu-id="89773-286">Columns</span></span>|<span data-ttu-id="89773-287">Description</span><span class="sxs-lookup"><span data-stu-id="89773-287">Description</span></span>|  
|------------|-------------|-----------------|  
|<span data-ttu-id="89773-288">Sécurité des transactions</span><span class="sxs-lookup"><span data-stu-id="89773-288">Transaction safety</span></span>|<span data-ttu-id="89773-289">**mirroring_safety_level** ou **mirroring_safety_level_desc**</span><span class="sxs-lookup"><span data-stu-id="89773-289">**mirroring_safety_level** or **mirroring_safety_level_desc**</span></span>|<span data-ttu-id="89773-290">Paramètre de sécurité des transactions pour les mises à jour de la base de données en miroir pouvant être défini sur l'une des valeurs suivantes :</span><span class="sxs-lookup"><span data-stu-id="89773-290">Transaction safety setting for updates on the mirror database, one of:</span></span><br /><br /> <span data-ttu-id="89773-291">UNKNOWN</span><span class="sxs-lookup"><span data-stu-id="89773-291">UNKNOWN</span></span><br /><br /> <span data-ttu-id="89773-292">OFF</span><span class="sxs-lookup"><span data-stu-id="89773-292">OFF</span></span><br /><br /> <span data-ttu-id="89773-293">FULL</span><span class="sxs-lookup"><span data-stu-id="89773-293">FULL</span></span><br /><br /> <span data-ttu-id="89773-294">NULL : la base de données n'est pas en ligne.</span><span class="sxs-lookup"><span data-stu-id="89773-294">NULL= database is not online.</span></span>|  
|<span data-ttu-id="89773-295">Un témoin existe-t-il ?</span><span class="sxs-lookup"><span data-stu-id="89773-295">Does a witness exist?</span></span>|<span data-ttu-id="89773-296">**mirroring_witness_name**</span><span class="sxs-lookup"><span data-stu-id="89773-296">**mirroring_witness_name**</span></span>|<span data-ttu-id="89773-297">Nom de serveur du témoin mis en miroir de la base de données ou mention NULL, indiquant que le témoin n'existe pas.</span><span class="sxs-lookup"><span data-stu-id="89773-297">Server name of the database mirroring witness or NULL, indicating that no witness exists.</span></span>|  
|<span data-ttu-id="89773-298">État du serveur</span><span class="sxs-lookup"><span data-stu-id="89773-298">Witness state</span></span>|<span data-ttu-id="89773-299">**mirroring_witness_state** ou **mirroring_witness_state_desc**</span><span class="sxs-lookup"><span data-stu-id="89773-299">**mirroring_witness_state** or **mirroring_witness_state_desc**</span></span>|<span data-ttu-id="89773-300">État du témoin dans la base de données d'un partenaire donné :</span><span class="sxs-lookup"><span data-stu-id="89773-300">State of the witness in the database on a given partner:</span></span><br /><br /> <span data-ttu-id="89773-301">UNKNOWN</span><span class="sxs-lookup"><span data-stu-id="89773-301">UNKNOWN</span></span><br /><br /> <span data-ttu-id="89773-302">CONNECTED</span><span class="sxs-lookup"><span data-stu-id="89773-302">CONNECTED</span></span><br /><br /> <span data-ttu-id="89773-303">DISCONNECTED</span><span class="sxs-lookup"><span data-stu-id="89773-303">DISCONNECTED</span></span><br /><br /> <span data-ttu-id="89773-304">NULL : aucun témoin n'existe ou la base de données n'est pas en ligne.</span><span class="sxs-lookup"><span data-stu-id="89773-304">NULL = no witness exists or the database is not online.</span></span>|  
  
 <span data-ttu-id="89773-305">Par exemple, saisissez sur le principal ou sur le serveur miroir :</span><span class="sxs-lookup"><span data-stu-id="89773-305">For example, on either the principal or mirror server, enter:</span></span>  
  
```  
SELECT mirroring_safety_level_desc, mirroring_witness_name, mirroring_witness_state_desc FROM sys.database_mirroring  
```  
  
 <span data-ttu-id="89773-306">Pour plus d’informations sur cette vue de catalogue, consultez [sys.database_mirroring &#40;Transact-SQL&#41;](/sql/relational-databases/system-catalog-views/sys-database-mirroring-transact-sql).</span><span class="sxs-lookup"><span data-stu-id="89773-306">For more information about this catalog view, see [sys.database_mirroring &#40;Transact-SQL&#41;](/sql/relational-databases/system-catalog-views/sys-database-mirroring-transact-sql).</span></span>  
  
###  <a name="factors-affecting-behavior-on-loss-of-the-principal-server"></a><a name="FactorsOnLossOfPrincipal"></a> <span data-ttu-id="89773-307">Facteurs influant sur le comportement provoqué par la perte du serveur principal</span><span class="sxs-lookup"><span data-stu-id="89773-307">Factors Affecting Behavior on Loss of the Principal Server</span></span>  
 <span data-ttu-id="89773-308">Le tableau suivant répertorie l'effet combiné du paramètre de sécurité propre aux transactions, de l'état de la base de données et de l'état du témoin sur le comportement adopté par une session de mise en miroir lors de la perte du serveur principal.</span><span class="sxs-lookup"><span data-stu-id="89773-308">The following table summarizes the combined effect of the transaction safety setting, the state of the database, and the state of the witness on the behavior of a mirroring session on the loss of the principal server.</span></span>  
  
|<span data-ttu-id="89773-309">Sécurité des transactions</span><span class="sxs-lookup"><span data-stu-id="89773-309">Transaction safety</span></span>|<span data-ttu-id="89773-310">État de la mise en miroir d'une base de données miroir</span><span class="sxs-lookup"><span data-stu-id="89773-310">Mirroring state of mirror database</span></span>|<span data-ttu-id="89773-311">État du serveur</span><span class="sxs-lookup"><span data-stu-id="89773-311">Witness state</span></span>|<span data-ttu-id="89773-312">Comportement lors de la perte de la connexion au principal</span><span class="sxs-lookup"><span data-stu-id="89773-312">Behavior when principal is lost</span></span>|  
|------------------------|----------------------------------------|-------------------|-------------------------------------|  
|<span data-ttu-id="89773-313">FULL</span><span class="sxs-lookup"><span data-stu-id="89773-313">FULL</span></span>|<span data-ttu-id="89773-314">SYNCHRONIZED</span><span class="sxs-lookup"><span data-stu-id="89773-314">SYNCHRONIZED</span></span>|<span data-ttu-id="89773-315">CONNECTED</span><span class="sxs-lookup"><span data-stu-id="89773-315">CONNECTED</span></span>|<span data-ttu-id="89773-316">Basculement automatique.</span><span class="sxs-lookup"><span data-stu-id="89773-316">Automatic failover occurs.</span></span>|  
|<span data-ttu-id="89773-317">FULL</span><span class="sxs-lookup"><span data-stu-id="89773-317">FULL</span></span>|<span data-ttu-id="89773-318">SYNCHRONIZED</span><span class="sxs-lookup"><span data-stu-id="89773-318">SYNCHRONIZED</span></span>|<span data-ttu-id="89773-319">DISCONNECTED</span><span class="sxs-lookup"><span data-stu-id="89773-319">DISCONNECTED</span></span>|<span data-ttu-id="89773-320">Le serveur miroir s'arrête, le basculement est alors impossible et la base de données n'est plus disponible.</span><span class="sxs-lookup"><span data-stu-id="89773-320">Mirror server stops; failover is not possible, and the database cannot be made available.</span></span>|  
|<span data-ttu-id="89773-321">OFF</span><span class="sxs-lookup"><span data-stu-id="89773-321">OFF</span></span>|<span data-ttu-id="89773-322">SUSPENDED ou DISCONNECTED</span><span class="sxs-lookup"><span data-stu-id="89773-322">SUSPENDED or DISCONNECTED</span></span>|<span data-ttu-id="89773-323">NULL (pas de témoin)</span><span class="sxs-lookup"><span data-stu-id="89773-323">NULL (no witness)</span></span>|<span data-ttu-id="89773-324">Le service peut être forcé sur le serveur miroir (perte de données possible).</span><span class="sxs-lookup"><span data-stu-id="89773-324">Service can be forced to the mirror server (with possible data loss).</span></span>|  
|<span data-ttu-id="89773-325">FULL</span><span class="sxs-lookup"><span data-stu-id="89773-325">FULL</span></span>|<span data-ttu-id="89773-326">SYNCHRONIZING ou SUSPENDED</span><span class="sxs-lookup"><span data-stu-id="89773-326">SYNCHRONIZING or SUSPENDED</span></span>|<span data-ttu-id="89773-327">NULL (pas de témoin)</span><span class="sxs-lookup"><span data-stu-id="89773-327">NULL (no witness)</span></span>|<span data-ttu-id="89773-328">Le service peut être forcé sur le serveur miroir (perte de données possible).</span><span class="sxs-lookup"><span data-stu-id="89773-328">Service can be forced to the mirror server (with possible data loss).</span></span>|  
  
##  <a name="related-tasks"></a><a name="RelatedTasks"></a> <span data-ttu-id="89773-329">Tâches associées</span><span class="sxs-lookup"><span data-stu-id="89773-329">Related Tasks</span></span>  
  
-   [<span data-ttu-id="89773-330">Ajouter ou remplacer un témoin de mise en miroir de bases de données &#40;SQL Server Management Studio&#41;</span><span class="sxs-lookup"><span data-stu-id="89773-330">Add or Replace a Database Mirroring Witness &#40;SQL Server Management Studio&#41;</span></span>](../database-mirroring/add-or-replace-a-database-mirroring-witness-sql-server-management-studio.md)  
  
-   [<span data-ttu-id="89773-331">Établir une session de mise en miroir de bases de données au moyen de l’authentification Windows &#40;SQL Server Management Studio&#41;</span><span class="sxs-lookup"><span data-stu-id="89773-331">Establish a Database Mirroring Session Using Windows Authentication &#40;SQL Server Management Studio&#41;</span></span>](establish-database-mirroring-session-windows-authentication.md)  
  
-   [<span data-ttu-id="89773-332">Ajouter un témoin de mise en miroir de bases de données à l’aide de l’authentification Windows &#40;Transact-SQL&#41;</span><span class="sxs-lookup"><span data-stu-id="89773-332">Add a Database Mirroring Witness Using Windows Authentication &#40;Transact-SQL&#41;</span></span>](add-a-database-mirroring-witness-using-windows-authentication-transact-sql.md)  
  
-   [<span data-ttu-id="89773-333">Supprimer le témoin d’une session de mise en miroir de bases de données &#40;SQL Server&#41;</span><span class="sxs-lookup"><span data-stu-id="89773-333">Remove the Witness from a Database Mirroring Session &#40;SQL Server&#41;</span></span>](remove-the-witness-from-a-database-mirroring-session-sql-server.md)  
  
-   [<span data-ttu-id="89773-334">Modifier la sécurité des transactions dans une session de mise en miroir de bases de données &#40;Transact-SQL&#41;</span><span class="sxs-lookup"><span data-stu-id="89773-334">Change Transaction Safety in a Database Mirroring Session &#40;Transact-SQL&#41;</span></span>](change-transaction-safety-in-a-database-mirroring-session-transact-sql.md)  
  
## <a name="see-also"></a><span data-ttu-id="89773-335">Voir aussi</span><span class="sxs-lookup"><span data-stu-id="89773-335">See Also</span></span>  
 <span data-ttu-id="89773-336">[Surveillance de la mise en miroir de bases de données &#40;SQL Server&#41;](monitoring-database-mirroring-sql-server.md) </span><span class="sxs-lookup"><span data-stu-id="89773-336">[Monitoring Database Mirroring &#40;SQL Server&#41;](monitoring-database-mirroring-sql-server.md) </span></span>  
 [<span data-ttu-id="89773-337">Témoin de mise en miroir de base de données</span><span class="sxs-lookup"><span data-stu-id="89773-337">Database Mirroring Witness</span></span>](database-mirroring-witness.md)  
