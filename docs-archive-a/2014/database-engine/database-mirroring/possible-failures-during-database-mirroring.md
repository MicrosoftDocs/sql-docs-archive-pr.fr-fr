---
title: Défaillances possibles pendant la mise en miroir d’une base de données | Microsoft Docs
ms.custom: ''
ms.date: 06/13/2017
ms.prod: sql-server-2014
ms.reviewer: ''
ms.technology: high-availability
ms.topic: conceptual
helpviewer_keywords:
- time-out period [SQL Server database mirroring]
- soft errors [SQL Server]
- database mirroring [SQL Server], troubleshooting
- timeout errors [SQL Server]
- troubleshooting [SQL Server], database mirroring
- hard errors
- failed database mirroring sessions [SQL Server]
ms.assetid: d7031f58-5f49-4e6d-9a62-9b420f2bb17e
author: MikeRayMSFT
ms.author: mikeray
ms.openlocfilehash: 25ba1ccc87c024fa3da370f2ff19251a1bee9f30
ms.sourcegitcommit: ad4d92dce894592a259721a1571b1d8736abacdb
ms.translationtype: MT
ms.contentlocale: fr-FR
ms.lasthandoff: 08/04/2020
ms.locfileid: "87701849"
---
# <a name="possible-failures-during-database-mirroring"></a><span data-ttu-id="d087f-102">Défaillances possibles pendant la mise en miroir d’une base de données</span><span class="sxs-lookup"><span data-stu-id="d087f-102">Possible Failures During Database Mirroring</span></span>
  <span data-ttu-id="d087f-103">Des problèmes physiques, de système d'exploitation ou propres à [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] peuvent être responsables de l'échec d'une session de mise en miroir de bases de données.</span><span class="sxs-lookup"><span data-stu-id="d087f-103">Physical, operating system, or [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] problems can cause a failure in a database mirroring session.</span></span> <span data-ttu-id="d087f-104">La mise en miroir de bases de données ne contrôle pas régulièrement les composants sur lesquels Sqlservr.exe s'appuie pour vérifier s'ils fonctionnent correctement ou s'ils ont échoué.</span><span class="sxs-lookup"><span data-stu-id="d087f-104">Database mirroring does not regularly check the components on which Sqlservr.exe relies to verify whether they are functioning correctly or have failed.</span></span> <span data-ttu-id="d087f-105">Toutefois, pour certains types d'échecs, le composant affecté signale une erreur à Sqlservr.exe.</span><span class="sxs-lookup"><span data-stu-id="d087f-105">However, for some types of failures, the affected component reports an error to Sqlservr.exe.</span></span> <span data-ttu-id="d087f-106">Une erreur signalée par un autre composant est appelée *erreur matérielle*.</span><span class="sxs-lookup"><span data-stu-id="d087f-106">An error reported by another component is called a *hard error*.</span></span> <span data-ttu-id="d087f-107">La mise en miroir de bases de données implémente ses propres mécanismes de délai d'attente pour détecter les autres erreurs qui passeraient sinon inaperçues.</span><span class="sxs-lookup"><span data-stu-id="d087f-107">To detect other failures that would otherwise go unnoticed, database mirroring implements its own time-out mechanism.</span></span> <span data-ttu-id="d087f-108">En cas de délai d’attente de la mise en miroir, une *erreur logicielle*se produit quand la mise en miroir de bases de données détermine qu’une défaillance s’est produite.</span><span class="sxs-lookup"><span data-stu-id="d087f-108">When a mirroring time-out occurs, database mirroring assumes that a failure has occurred and declares a *soft error*.</span></span> <span data-ttu-id="d087f-109">Toutefois, certaines erreurs qui se produisent au niveau de l'instance SQL Server n'entraîne pas de délai d'attente de la mise en miroir et peuvent ne pas être détectées.</span><span class="sxs-lookup"><span data-stu-id="d087f-109">However, some failures that happen at the SQL Server instance level do not cause mirroring to time-out and can go undetected.</span></span>  
  
> [!IMPORTANT]  
>  <span data-ttu-id="d087f-110">Les défaillances dans les bases de données autres que les bases de données mises en miroir ne sont pas détectables dans une session de mise en miroir de bases de données.</span><span class="sxs-lookup"><span data-stu-id="d087f-110">Failures in databases other than the mirrored database are not detectable in a database mirroring session.</span></span> <span data-ttu-id="d087f-111">En outre, il est peu vraisemblable qu'une défaillance du disque de données soit détectée, sauf si la base de données est redémarrée en raison de la défaillance d'un disque de données.</span><span class="sxs-lookup"><span data-stu-id="d087f-111">Moreover, a data disk failure is unlikely to be detected, unless the database is restarted because of a data disk failure.</span></span>  
  
 <span data-ttu-id="d087f-112">Le temps de détection de l'erreur et, par extension, le temps de réaction de la session de mise en miroir face à l'erreur varient selon que l'erreur est matérielle ou logicielle.</span><span class="sxs-lookup"><span data-stu-id="d087f-112">The speed of error detection and, therefore, the reaction time of the mirroring session to a failure, depends on whether the error is hard or soft.</span></span> <span data-ttu-id="d087f-113">Certaines erreurs matérielles, telles que les pannes de réseau sont signalées immédiatement.</span><span class="sxs-lookup"><span data-stu-id="d087f-113">Some hard errors, such as network failures are reported immediately.</span></span> <span data-ttu-id="d087f-114">Cependant, il arrive parfois que des délais d'attente spécifiques à un composant retardent la signalisation de certaines erreurs matérielles.</span><span class="sxs-lookup"><span data-stu-id="d087f-114">However, in some cases, component-specific time-out periods can delay the reporting of some hard errors.</span></span> <span data-ttu-id="d087f-115">Pour les erreurs logicielles, la durée du délai d'attente de la mise en miroir détermine le temps de la détection d'erreur.</span><span class="sxs-lookup"><span data-stu-id="d087f-115">For soft errors, the length of the mirroring time-out period determines the speed of error detection.</span></span> <span data-ttu-id="d087f-116">Par défaut, cette valeur est de 10 secondes.</span><span class="sxs-lookup"><span data-stu-id="d087f-116">By default, this period is 10 seconds.</span></span> <span data-ttu-id="d087f-117">Il s'agit de la valeur minimale recommandée.</span><span class="sxs-lookup"><span data-stu-id="d087f-117">This is the minimum recommended value.</span></span>  
  
## <a name="failures-due-to-hard-errors"></a><span data-ttu-id="d087f-118">Défaillances dues à des erreurs matérielles</span><span class="sxs-lookup"><span data-stu-id="d087f-118">Failures Due to Hard Errors</span></span>  
 <span data-ttu-id="d087f-119">Parmi les causes possibles d'erreurs matérielles figurent notamment, sans s'y limiter, les situations suivantes :</span><span class="sxs-lookup"><span data-stu-id="d087f-119">Possible causes of hard errors include (but are not limited to) the following conditions:</span></span>  
  
-   <span data-ttu-id="d087f-120">une connexion ou un câble coupé ;</span><span class="sxs-lookup"><span data-stu-id="d087f-120">A broken connection or wire</span></span>  
  
-   <span data-ttu-id="d087f-121">une carte réseau défaillante ;</span><span class="sxs-lookup"><span data-stu-id="d087f-121">A bad network card</span></span>  
  
-   <span data-ttu-id="d087f-122">un changement de routeur ;</span><span class="sxs-lookup"><span data-stu-id="d087f-122">A router change</span></span>  
  
-   <span data-ttu-id="d087f-123">des modifications au pare-feu ;</span><span class="sxs-lookup"><span data-stu-id="d087f-123">Changes in the firewall</span></span>  
  
-   <span data-ttu-id="d087f-124">une reconfiguration du point de terminaison ;</span><span class="sxs-lookup"><span data-stu-id="d087f-124">Endpoint reconfiguration</span></span>  
  
-   <span data-ttu-id="d087f-125">la perte du lecteur où se trouve le journal de transactions ;</span><span class="sxs-lookup"><span data-stu-id="d087f-125">Loss of the drive where the transaction log resides</span></span>  
  
-   <span data-ttu-id="d087f-126">une défaillance du système d'exploitation ou d'un processus.</span><span class="sxs-lookup"><span data-stu-id="d087f-126">Operating system or process failure</span></span>  
  
 <span data-ttu-id="d087f-127">Par exemple, lorsque le lecteur de journalisation de la base de données principale cesse de répondre et échoue, le système d'exploitation informe Sqlservr.exe qu'une erreur grave s'est produite.</span><span class="sxs-lookup"><span data-stu-id="d087f-127">For example, when the log drive on the principal database becomes unresponsive and fails, the operating system informs Sqlservr.exe that a serious error has occurred.</span></span>  
  
 <span data-ttu-id="d087f-128">Certains composants, tels que les composants réseau et certains sous-systèmes d'E/S, ont leurs propres délais d'attente pour détecter les défaillances.</span><span class="sxs-lookup"><span data-stu-id="d087f-128">Some components, such as network components and some IO subsystems, have their own time-outs to determine failures.</span></span> <span data-ttu-id="d087f-129">Ces délais sont indépendants de la mise en miroir de bases de données qui n'en a pas connaissance et n'est pas tenue au courant de leur comportement.</span><span class="sxs-lookup"><span data-stu-id="d087f-129">Such time-outs are independent of database mirroring, which has no knowledge of them and is completely unaware of their behavior.</span></span> <span data-ttu-id="d087f-130">Dans ces cas, la période de délai d'attente augmente la durée entre une défaillance et la réception de son erreur matérielle par la mise en miroir de la base de données.</span><span class="sxs-lookup"><span data-stu-id="d087f-130">In these cases, the time-out delay increases the time between a failure and when database mirroring receive the resulting hard error.</span></span>  
  
> [!NOTE]  
>  <span data-ttu-id="d087f-131">C'est uniquement dans le cas des erreurs logicielles que la détection des erreurs appliquée à la mise en miroir des bases de données est active.</span><span class="sxs-lookup"><span data-stu-id="d087f-131">The only active error checking performed for database mirroring occurs for soft error cases.</span></span> <span data-ttu-id="d087f-132">Pour plus d'informations, consultez « Défaillances dues à des erreurs logicielles » plus loin dans cette rubrique.</span><span class="sxs-lookup"><span data-stu-id="d087f-132">For more information, see "Failures Due to Soft Errors," later in this topic.</span></span>  
  
 <span data-ttu-id="d087f-133">Pour vous aider à interpréter les conditions d'erreur qui se produisent sur le réseau, demandez à un ingénieur réseau quels messages d'erreur sont envoyés à un port lorsque les événements ci-dessous se produisent sur une connexion TCP :</span><span class="sxs-lookup"><span data-stu-id="d087f-133">To help you interpret the error conditions that occur on the network, ask a network engineer what error messages are sent to a port when the following events occur on a TCP connection:</span></span>  
  
-   <span data-ttu-id="d087f-134">le DNS ne fonctionne pas ;</span><span class="sxs-lookup"><span data-stu-id="d087f-134">DNS is not working.</span></span>  
  
-   <span data-ttu-id="d087f-135">les câbles sont débranchés ;</span><span class="sxs-lookup"><span data-stu-id="d087f-135">Cables are unplugged.</span></span>  
  
-   [!INCLUDE[msCoName](../../includes/msconame-md.md)] <span data-ttu-id="d087f-136">Windows comprend un pare-feu qui bloque un port spécifique ;</span><span class="sxs-lookup"><span data-stu-id="d087f-136">Windows has a firewall that blocks a specific port.</span></span>  
  
-   <span data-ttu-id="d087f-137">l'application de surveillance d'un port ne fonctionne pas ;</span><span class="sxs-lookup"><span data-stu-id="d087f-137">The application that is monitoring a port fails.</span></span>  
  
-   <span data-ttu-id="d087f-138">un serveur Windows a été renommé ;</span><span class="sxs-lookup"><span data-stu-id="d087f-138">A Windows-based server is renamed.</span></span>  
  
-   <span data-ttu-id="d087f-139">un serveur Windows a été redémarré ;</span><span class="sxs-lookup"><span data-stu-id="d087f-139">A Windows-based server is rebooted.</span></span>  
  
> [!NOTE]  
>  <span data-ttu-id="d087f-140">La mise en miroir ne protège pas des problèmes spécifiques au client qui accède aux serveurs.</span><span class="sxs-lookup"><span data-stu-id="d087f-140">Mirroring does not protect against problems specific to client accessing the servers.</span></span> <span data-ttu-id="d087f-141">Par exemple, considérez un cas où une carte réseau publique traite les connexions clientes vers l'instance de serveur principal, tandis qu'une carte d'interface réseau privée traite l'ensemble du trafic de mise en miroir entre les instances de serveur.</span><span class="sxs-lookup"><span data-stu-id="d087f-141">For example, consider a case in which a public network adapter handles client connections to the principal server instance, while a private network interface card handles all mirroring traffic among server instances.</span></span> <span data-ttu-id="d087f-142">Dans ce cas, la défaillance de la carte réseau publique empêche les clients d'accéder à la base de données, même si la base de données continue d'être en miroir.</span><span class="sxs-lookup"><span data-stu-id="d087f-142">In this case, failure of the public network adapter would prevent clients from accessing the database, though the database would continue to be mirrored.</span></span>  
  
## <a name="failures-due-to-soft-errors"></a><span data-ttu-id="d087f-143">Défaillances dues à des erreurs logicielles</span><span class="sxs-lookup"><span data-stu-id="d087f-143">Failures Due to Soft Errors</span></span>  
 <span data-ttu-id="d087f-144">Parmi les conditions susceptibles de provoquer des délais d'attente de mise en miroir figurent notamment, sans s'y limiter, les situations suivantes :</span><span class="sxs-lookup"><span data-stu-id="d087f-144">Conditions that might cause mirroring time-outs include (but are not limited to) the following:</span></span>  
  
-   <span data-ttu-id="d087f-145">des erreurs réseau, par exemple, un dépassement de délai de la liaison TCP, des paquets supprimés ou endommagés, des paquets dans le désordre ;</span><span class="sxs-lookup"><span data-stu-id="d087f-145">Network errors such as TCP link time-outs, dropped or corrupted packets, or packets that are in an incorrect order.</span></span>  
  
-   <span data-ttu-id="d087f-146">un système d’exploitation, un serveur ou une base de données qui ne répond pas ;</span><span class="sxs-lookup"><span data-stu-id="d087f-146">An operating system, server, or database that is not responding.</span></span>  
  
-   <span data-ttu-id="d087f-147">un serveur Windows en cours de dépassement d'un délai d'expiration ;</span><span class="sxs-lookup"><span data-stu-id="d087f-147">A Windows server timing out.</span></span>  
  
-   <span data-ttu-id="d087f-148">des ressources informatiques insuffisantes, telles qu'une surcharge de l'unité centrale ou du disque, la taille limite atteinte par le journal de transactions ou l'absence de mémoire ou de threads disponibles.</span><span class="sxs-lookup"><span data-stu-id="d087f-148">Insufficient computing resources, such as a CPU or disk overload, the transaction log filling up, or the system is running out of memory or threads.</span></span> <span data-ttu-id="d087f-149">Dans de telles situations, vous devez augmenter le délai d'attente, réduire la charge de travail ou remplacer les matériels pour qu'ils supportent la charge de travail.</span><span class="sxs-lookup"><span data-stu-id="d087f-149">In these cases, you must increase the time-out period, reduce the workload, or change the hardware to handle the workload.</span></span>  
  
### <a name="the-mirroring-time-out-mechanism"></a><span data-ttu-id="d087f-150">Mécanisme du délai d'attente de la mise en miroir</span><span class="sxs-lookup"><span data-stu-id="d087f-150">The Mirroring Time-Out Mechanism</span></span>  
 <span data-ttu-id="d087f-151">Comme les erreurs logicielles ne sont pas directement détectables par une instance de serveur, une erreur logicielle peut entraîner le délai d'attente indéfini d'une instance de serveur.</span><span class="sxs-lookup"><span data-stu-id="d087f-151">Because soft errors are not detectable directly by a server instance, a soft error could potentially cause a server instance to wait indefinitely.</span></span> <span data-ttu-id="d087f-152">Pour empêcher cette situation, la mise en miroir de bases de données met en œuvre son propre mécanisme de délai d'attente basé sur l'envoi d'un ping par chaque instance de serveur d'une session de mise en miroir sur chaque connexion ouverte, à intervalles fixes.</span><span class="sxs-lookup"><span data-stu-id="d087f-152">To prevent this, database mirroring implements its own time-out mechanism, based on each server instance in a mirroring session sending out a ping on each open connection at a fixed interval.</span></span>  
  
 <span data-ttu-id="d087f-153">Pour garder une connexion ouverte, une instance de serveur doit recevoir un ping sur cette connexion au cours du délai d'attente défini, auquel s'ajoute le temps nécessaire à l'envoi d'un ping supplémentaire.</span><span class="sxs-lookup"><span data-stu-id="d087f-153">To keep a connection open, a server instance must receive a ping on that connection in the time-out period defined, plus the time that is required to send one more ping.</span></span> <span data-ttu-id="d087f-154">La réception d'un ping au cours du délai d'attente indique que la connexion est toujours ouverte et que les instances de serveur communiquent via celle-ci.</span><span class="sxs-lookup"><span data-stu-id="d087f-154">Receiving a ping during the time-out period indicates that the connection is still open and that the server instances are communicating over it.</span></span> <span data-ttu-id="d087f-155">À la réception du ping, une instance de serveur réinitialise son compteur de délai d'attente sur cette connexion.</span><span class="sxs-lookup"><span data-stu-id="d087f-155">On receiving a ping, a server instance resets its time-out counter on that connection.</span></span>  
  
 <span data-ttu-id="d087f-156">Si aucun ping n'est reçu sur une connexion durant le délai d'attente, une instance de serveur considère que la connexion a expiré. L'instance de serveur ferme la connexion ayant expiré et traite l'événement d'expiration en fonction de l'état et du mode de fonctionnement de la session.</span><span class="sxs-lookup"><span data-stu-id="d087f-156">If no ping is received on a connection during the time-out period, a server instance considers the connection to have timed out. The server instance closes the timed-out connection and handles the time-out event according to the state and operating mode of the session.</span></span>  
  
 <span data-ttu-id="d087f-157">Même si l'autre serveur fonctionne en réalité correctement, un dépassement de délai est considéré comme une défaillance.</span><span class="sxs-lookup"><span data-stu-id="d087f-157">Even if the other server is actually proceeding correctly, a time-out is considered a failure.</span></span> <span data-ttu-id="d087f-158">Si la valeur du délai d'attente est trop courte pour la réactivité normale d'un partenaire, des fausses défaillances peuvent se produire.</span><span class="sxs-lookup"><span data-stu-id="d087f-158">If the time-out value for a session is too short for the regular responsiveness of either partner, false failures can occur.</span></span> <span data-ttu-id="d087f-159">Une fausse défaillance se produit lorsqu'une instance de serveur réussit à contacter une autre instance de serveur dont le temps de réponse est tellement lent que ses pings ne sont pas reçus avant l'expiration du délai d'attente.</span><span class="sxs-lookup"><span data-stu-id="d087f-159">A false failure occurs when one server instance successfully contacts another whose response time is so slow that its pings are not received before the time-out period expires.</span></span>  
  
 <span data-ttu-id="d087f-160">Dans des sessions en mode hautes performances, le délai d'attente est toujours de 10 secondes.</span><span class="sxs-lookup"><span data-stu-id="d087f-160">In high-performance mode sessions, the time-out period is always 10 seconds.</span></span> <span data-ttu-id="d087f-161">Ce délai est suffisant le plus souvent pour éviter de fausses défaillances.</span><span class="sxs-lookup"><span data-stu-id="d087f-161">This is generally enough to avoid false failures.</span></span> <span data-ttu-id="d087f-162">Dans les sessions en mode haute sécurité, le délai d'attente par défaut est de 10 secondes, mais vous pouvez modifier la durée.</span><span class="sxs-lookup"><span data-stu-id="d087f-162">In high-safety mode sessions, the default time-out period is 10 seconds, but you can change the duration.</span></span> <span data-ttu-id="d087f-163">Pour éviter des fausses défaillances, la durée recommandée du délai d'attente de la mise en miroir est 10 secondes ou plus.</span><span class="sxs-lookup"><span data-stu-id="d087f-163">To avoid false failures, we recommend that the mirroring time-out period always be 10 seconds or more.</span></span>  
  
 <span data-ttu-id="d087f-164">**Pour modifier la valeur du délai d'attente (en mode haute sécurité uniquement).**</span><span class="sxs-lookup"><span data-stu-id="d087f-164">**To change the time-out value (high-safety mode only)**</span></span>  
  
-   <span data-ttu-id="d087f-165">Utilisez l’instruction [ALTER DATABASE \<database> SET PARTNER TIMEOUT \<integer>](/sql/t-sql/statements/alter-database-transact-sql).</span><span class="sxs-lookup"><span data-stu-id="d087f-165">Use the [ALTER DATABASE \<database> SET PARTNER TIMEOUT \<integer>](/sql/t-sql/statements/alter-database-transact-sql) statement.</span></span>  
  
 <span data-ttu-id="d087f-166">**Pour afficher la valeur actuelle du délai d'attente**</span><span class="sxs-lookup"><span data-stu-id="d087f-166">**To view the current time-out value**</span></span>  
  
-   <span data-ttu-id="d087f-167">Exécutez une requête sur **mirroring_connection_timeout** dans [sys.database_mirroring](/sql/relational-databases/system-catalog-views/sys-database-mirroring-transact-sql).</span><span class="sxs-lookup"><span data-stu-id="d087f-167">Query **mirroring_connection_timeout** in [sys.database_mirroring](/sql/relational-databases/system-catalog-views/sys-database-mirroring-transact-sql).</span></span>  
  
## <a name="responding-to-an-error"></a><span data-ttu-id="d087f-168">Réponse à une erreur</span><span class="sxs-lookup"><span data-stu-id="d087f-168">Responding to an Error</span></span>  
 <span data-ttu-id="d087f-169">Quel que soit le type d'erreur, une instance de serveur qui détecte une erreur réagit comme il le doit en fonction du rôle de l'instance, du mode d'opération de la session et de l'état des autres connexions de la session.</span><span class="sxs-lookup"><span data-stu-id="d087f-169">Regardless of the type of error, a server instance that detects an error responds appropriately based on the role of the instance, the operating mode of the session, and the state of any other connection in the session.</span></span> <span data-ttu-id="d087f-170">Pour plus d’informations sur les conséquences de la perte d’un partenaire, consultez [Modes de fonctionnement de la mise en miroir de bases de données](database-mirroring-operating-modes.md).</span><span class="sxs-lookup"><span data-stu-id="d087f-170">For information about what occurs on the loss of a partner, see [Database Mirroring Operating Modes](database-mirroring-operating-modes.md).</span></span>  
  
## <a name="see-also"></a><span data-ttu-id="d087f-171">Voir aussi</span><span class="sxs-lookup"><span data-stu-id="d087f-171">See Also</span></span>  
 <span data-ttu-id="d087f-172">[Estimer l’interruption de service au cours d’un basculement de rôle &#40;mise en miroir de bases de données&#41;](estimate-the-interruption-of-service-during-role-switching-database-mirroring.md) </span><span class="sxs-lookup"><span data-stu-id="d087f-172">[Estimate the Interruption of Service During Role Switching &#40;Database Mirroring&#41;](estimate-the-interruption-of-service-during-role-switching-database-mirroring.md) </span></span>  
 <span data-ttu-id="d087f-173">[Modes de fonctionnement de la mise en miroir de bases de données](database-mirroring-operating-modes.md) </span><span class="sxs-lookup"><span data-stu-id="d087f-173">[Database Mirroring Operating Modes](database-mirroring-operating-modes.md) </span></span>  
 <span data-ttu-id="d087f-174">[Basculement de rôle durant une session de mise en miroir de bases de données &#40;SQL Server&#41;](role-switching-during-a-database-mirroring-session-sql-server.md) </span><span class="sxs-lookup"><span data-stu-id="d087f-174">[Role Switching During a Database Mirroring Session &#40;SQL Server&#41;](role-switching-during-a-database-mirroring-session-sql-server.md) </span></span>  
 [<span data-ttu-id="d087f-175">Mise en miroir de bases de données &#40;SQL Server&#41;</span><span class="sxs-lookup"><span data-stu-id="d087f-175">Database Mirroring &#40;SQL Server&#41;</span></span>](database-mirroring-sql-server.md)  
  
  
