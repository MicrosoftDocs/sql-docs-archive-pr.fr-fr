---
title: Suspendre et reprendre la mise en miroir de bases de données (SQL Server) | Microsoft Docs
ms.custom: ''
ms.date: 06/13/2017
ms.prod: sql-server-2014
ms.reviewer: ''
ms.technology: high-availability
ms.topic: conceptual
helpviewer_keywords:
- sessions [SQL Server], database mirroring
- resuming database mirroring
- database mirroring [SQL Server], pausing
- database mirroring [SQL Server], resuming
- pausing database mirroring
ms.assetid: c67802c6-ee8c-4cbd-a6d4-f7b80413a4ab
author: MikeRayMSFT
ms.author: mikeray
ms.openlocfilehash: 8c231876b11303992e0e3300c9cb73c0cf53b3af
ms.sourcegitcommit: ad4d92dce894592a259721a1571b1d8736abacdb
ms.translationtype: MT
ms.contentlocale: fr-FR
ms.lasthandoff: 08/04/2020
ms.locfileid: "87701856"
---
# <a name="pausing-and-resuming-database-mirroring-sql-server"></a><span data-ttu-id="ab7f9-102">Suspendre et reprendre la mise en miroir de bases de données (SQL Server)</span><span class="sxs-lookup"><span data-stu-id="ab7f9-102">Pausing and Resuming Database Mirroring (SQL Server)</span></span>
  <span data-ttu-id="ab7f9-103">Le propriétaire de la base de données peut suspendre et reprendre ultérieurement une session de mise en miroir de bases de données à tout moment.</span><span class="sxs-lookup"><span data-stu-id="ab7f9-103">The database owner can pause and later resume a database mirroring session at any time.</span></span> <span data-ttu-id="ab7f9-104">La suspension conserve l'état de la session tout en suspendant la mise en miroir.</span><span class="sxs-lookup"><span data-stu-id="ab7f9-104">Pausing preserves the session state while suspending mirroring.</span></span> <span data-ttu-id="ab7f9-105">En cas de goulots, la suspension peut permettre d'améliorer les performances sur le serveur principal.</span><span class="sxs-lookup"><span data-stu-id="ab7f9-105">During bottlenecks, pausing might be useful to improve performance on the principal server.</span></span>  
  
 <span data-ttu-id="ab7f9-106">Lorsqu'une session est suspendue, la base de données principale reste disponible.</span><span class="sxs-lookup"><span data-stu-id="ab7f9-106">When a session is paused, the principal database remains available.</span></span> <span data-ttu-id="ab7f9-107">La suspension d'une session de mise en miroir fait passer son état à SUSPENDED, et la base de données miroir ne reflète plus la base de données principale, ce qui rend cette dernière vulnérable lors de son exécution.</span><span class="sxs-lookup"><span data-stu-id="ab7f9-107">Pausing sets the state of the mirroring session to SUSPENDED, and the mirror database no longer keeps up with the principal database, causing the principal database to run exposed.</span></span>  
  
 <span data-ttu-id="ab7f9-108">Nous vous recommandons de reprendre une session suspendue rapidement puisque le journal des transactions ne peut pas être tronqué tant que la session de mise en miroir de bases de données est suspendue.</span><span class="sxs-lookup"><span data-stu-id="ab7f9-108">We recommend that you resume a paused session quickly, because as long as a database mirroring session remains paused, the transaction log cannot be truncated.</span></span> <span data-ttu-id="ab7f9-109">Par conséquent, si la session de mise en miroir de bases de données est suspendue trop longtemps, le journal peut être plein, ce qui rend la base de données indisponible.</span><span class="sxs-lookup"><span data-stu-id="ab7f9-109">Therefore, if a database mirroring session is paused for too long, the transaction log fills up, making the database unavailable.</span></span> <span data-ttu-id="ab7f9-110">Pour une explication des causes de ce phénomène, consultez « Comment la suspension et la reprise affectent la troncature du journal » plus loin dans cette rubrique.</span><span class="sxs-lookup"><span data-stu-id="ab7f9-110">For an explanation of why this happens, see "How Pausing and Resuming Affect Log Truncation," later in this topic.</span></span>  
  
> [!IMPORTANT]  
>  <span data-ttu-id="ab7f9-111">Après un service forcé, lorsque le serveur principal d'origine se reconnecte, la mise en miroir est suspendue.</span><span class="sxs-lookup"><span data-stu-id="ab7f9-111">Following a forced service, when the original principal server reconnects mirroring is suspended.</span></span> <span data-ttu-id="ab7f9-112">La reprise de la mise en miroir dans cette situation peut entraîner des pertes de données sur le serveur principal d'origine.</span><span class="sxs-lookup"><span data-stu-id="ab7f9-112">Resuming mirroring in this situation could possibly cause data loss on the original principal server.</span></span> <span data-ttu-id="ab7f9-113">Pour plus d'informations sur la gestion des problèmes éventuels de perte de données, consultez [Database Mirroring Operating Modes](database-mirroring-operating-modes.md).</span><span class="sxs-lookup"><span data-stu-id="ab7f9-113">For information about managing the potential data loss, see [Database Mirroring Operating Modes](database-mirroring-operating-modes.md).</span></span>  
  
 <span data-ttu-id="ab7f9-114">**Dans cette rubrique :**</span><span class="sxs-lookup"><span data-stu-id="ab7f9-114">**In this Topic:**</span></span>  
  
-   [<span data-ttu-id="ab7f9-115">Comment la suspension et la reprise affectent la troncature du journal</span><span class="sxs-lookup"><span data-stu-id="ab7f9-115">How Pausing and Resuming Affect Log Truncation</span></span>](#EffectOnLogTrunc)  
  
-   [<span data-ttu-id="ab7f9-116">Éviter la saturation du journal des transactions</span><span class="sxs-lookup"><span data-stu-id="ab7f9-116">Avoid a Full Transaction Log</span></span>](#AvoidFullLog)  
  
-   [<span data-ttu-id="ab7f9-117">Tâches associées</span><span class="sxs-lookup"><span data-stu-id="ab7f9-117">Related Tasks</span></span>](#RelatedTasks)  
  
##  <a name="how-pausing-and-resuming-affect-log-truncation"></a><a name="EffectOnLogTrunc"></a> <span data-ttu-id="ab7f9-118">Comment la suspension et la reprise affectent la troncature du journal</span><span class="sxs-lookup"><span data-stu-id="ab7f9-118">How Pausing and Resuming Affect Log Truncation</span></span>  
 <span data-ttu-id="ab7f9-119">En général, lorsqu'un point de contrôle automatique est effectué sur une base de données, son journal des transactions est tronqué jusqu'à ce point de contrôle après la sauvegarde du journal suivante.</span><span class="sxs-lookup"><span data-stu-id="ab7f9-119">Normally, when an automatic checkpoint is performed on a database, its transaction log is truncated to that checkpoint after the next log backup.</span></span> <span data-ttu-id="ab7f9-120">Durant la suspension de la session de la mise en miroir de bases de données, tous les enregistrements du journal en cours restent actifs puisque le serveur principal attend de les envoyer au serveur miroir.</span><span class="sxs-lookup"><span data-stu-id="ab7f9-120">While a database mirroring session remains paused, all of the current log records remain active because the principal server is waiting to send them to the mirror server.</span></span> <span data-ttu-id="ab7f9-121">Les enregistrements de journal qui n'ont pas été envoyés s'accumulent dans le journal des transactions de la base de données principale en attendant que la session reprenne et que le serveur principal envoie les enregistrements du journal vers le serveur miroir.</span><span class="sxs-lookup"><span data-stu-id="ab7f9-121">The unsent log records accumulate in the transaction log of the principal database until the session resumes and the principal server has sent the log records to the mirror server.</span></span>  
  
 <span data-ttu-id="ab7f9-122">Lors de la reprise de la session, le serveur principal commence immédiatement l'envoi des enregistrements accumulés du journal vers le serveur miroir.</span><span class="sxs-lookup"><span data-stu-id="ab7f9-122">When the session is resumed, the principal server immediately begins sending the accumulated log records to the mirror server.</span></span> <span data-ttu-id="ab7f9-123">Après confirmation par le serveur miroir de la mise en file d'attente de l'enregistrement de journal correspondant jusqu'au point de contrôle automatique le plus ancien, le serveur principal tronque le journal de la base de données principale jusqu'à ce point de contrôle.</span><span class="sxs-lookup"><span data-stu-id="ab7f9-123">After the mirror server confirms that it has queued the log record corresponding to the oldest automatic checkpoint, the principal server truncates the log of the principal database to that checkpoint.</span></span> <span data-ttu-id="ab7f9-124">Le serveur miroir tronque la file d'attente de restauration au même enregistrement de journal.</span><span class="sxs-lookup"><span data-stu-id="ab7f9-124">The mirror server truncates the redo queue at the same log record.</span></span> <span data-ttu-id="ab7f9-125">Ce processus est répété pour chaque point de contrôle successif et le journal est tronqué par étape, point de contrôle par point de contrôle.</span><span class="sxs-lookup"><span data-stu-id="ab7f9-125">As this process is repeated for each successive checkpoint, the log is truncated in stages, checkpoint by checkpoint.</span></span>  
  
> [!NOTE]  
>  <span data-ttu-id="ab7f9-126">Pour plus d'informations sur les points de contrôle et la troncature du journal, consultez [Points de contrôle de base de données &#40;SQL Server&#41;](../../relational-databases/logs/database-checkpoints-sql-server.md).</span><span class="sxs-lookup"><span data-stu-id="ab7f9-126">For more information about the checkpoints and log truncation, see [Database Checkpoints &#40;SQL Server&#41;](../../relational-databases/logs/database-checkpoints-sql-server.md).</span></span>  
  
##  <a name="avoid-a-full-transaction-log"></a><a name="AvoidFullLog"></a> <span data-ttu-id="ab7f9-127">Éviter la saturation du journal des transactions</span><span class="sxs-lookup"><span data-stu-id="ab7f9-127">Avoid a Full Transaction Log</span></span>  
 <span data-ttu-id="ab7f9-128">Si le journal est plein (soit parce qu'il a atteint sa taille maximum, soit parce que l'instance du serveur manque de place), la base de données ne peut plus effectuer de mises à jour.</span><span class="sxs-lookup"><span data-stu-id="ab7f9-128">If the log fills up (either because it reaches its maximum size or the server instance runs out of space), the database cannot perform any more updates.</span></span> <span data-ttu-id="ab7f9-129">Pour éviter ce problème, vous avez deux solutions :</span><span class="sxs-lookup"><span data-stu-id="ab7f9-129">To avoid this problem, you have two alternatives:</span></span>  
  
-   <span data-ttu-id="ab7f9-130">Reprendre la session de mise en miroir de base de données avant que le journal ne soit plein, ou ajouter un espace journal supplémentaire.</span><span class="sxs-lookup"><span data-stu-id="ab7f9-130">Resume the database mirroring session before the log fills up, or add more log space.</span></span> <span data-ttu-id="ab7f9-131">La reprise de la mise en miroir de bases de données permet au serveur principal d'envoyer son journal actif cumulé au serveur miroir et met la base de données miroir en état SYNCHRONIZING.</span><span class="sxs-lookup"><span data-stu-id="ab7f9-131">Resuming database mirroring lets the principal server send its accumulated active log to the mirror server and puts the mirror database in the SYNCHRONIZING state.</span></span> <span data-ttu-id="ab7f9-132">Le serveur miroir peut alors renforcer le journal sur le disque et commencer à le refaire.</span><span class="sxs-lookup"><span data-stu-id="ab7f9-132">The mirror server can then harden the log to disk and start to redo it.</span></span>  
  
-   <span data-ttu-id="ab7f9-133">Arrêter la session de mise en miroir de bases de données en supprimant la mise en miroir.</span><span class="sxs-lookup"><span data-stu-id="ab7f9-133">Stop the database mirroring session by removing mirroring.</span></span>  
  
     <span data-ttu-id="ab7f9-134">Contrairement à la suspension d'une session, la suppression d'une mise en miroir supprime toutes les informations sur la session de mise en miroir.</span><span class="sxs-lookup"><span data-stu-id="ab7f9-134">Unlike pausing a session, removing mirroring drops all information about the mirroring session.</span></span> <span data-ttu-id="ab7f9-135">Chaque instance de serveur partenaire conserve sa propre copie de la base de données.</span><span class="sxs-lookup"><span data-stu-id="ab7f9-135">Each partner server instance retains its own copy of the database.</span></span> <span data-ttu-id="ab7f9-136">Si l'ancienne copie miroir est récupérée, elle divergera de l'ancienne copie principale et accusera un retard par rapport à la durée qui s'est écoulée depuis la suspension de la session.</span><span class="sxs-lookup"><span data-stu-id="ab7f9-136">If the former mirror copy is recovered, it will have diverged from the former principal copy and be behind by the amount of time that has elapsed since the session was paused.</span></span> <span data-ttu-id="ab7f9-137">Pour plus d’informations, consultez [Suppression d’une mise en miroir des bases de données &#40;SQL Server&#41;](database-mirroring-sql-server.md).</span><span class="sxs-lookup"><span data-stu-id="ab7f9-137">For more information, see [Removing Database Mirroring &#40;SQL Server&#41;](database-mirroring-sql-server.md).</span></span>  
  
##  <a name="related-tasks"></a><a name="RelatedTasks"></a> <span data-ttu-id="ab7f9-138">Tâches associées</span><span class="sxs-lookup"><span data-stu-id="ab7f9-138">Related Tasks</span></span>  
 <span data-ttu-id="ab7f9-139">**Pour suspendre ou reprendre la mise en miroir de bases de données**</span><span class="sxs-lookup"><span data-stu-id="ab7f9-139">**To pause or resume database mirroring**</span></span>  
  
-   [<span data-ttu-id="ab7f9-140">Suspendre ou reprendre une session de mise en miroir de bases de données &#40;SQL Server&#41;</span><span class="sxs-lookup"><span data-stu-id="ab7f9-140">Pause or Resume a Database Mirroring Session &#40;SQL Server&#41;</span></span>](pause-or-resume-a-database-mirroring-session-sql-server.md)  
  
 <span data-ttu-id="ab7f9-141">**Pour arrêter la mise en miroir de bases de données**</span><span class="sxs-lookup"><span data-stu-id="ab7f9-141">**To stop database mirroring**</span></span>  
  
-   [<span data-ttu-id="ab7f9-142">Supprimer une mise en miroir de bases de données &#40;SQL Server&#41;</span><span class="sxs-lookup"><span data-stu-id="ab7f9-142">Remove Database Mirroring &#40;SQL Server&#41;</span></span>](remove-database-mirroring-sql-server.md)  
  
## <a name="see-also"></a><span data-ttu-id="ab7f9-143">Voir aussi</span><span class="sxs-lookup"><span data-stu-id="ab7f9-143">See Also</span></span>  
 <span data-ttu-id="ab7f9-144">[ALTER DATABASE &#40;Transact-SQL&#41;](/sql/t-sql/statements/alter-database-transact-sql) </span><span class="sxs-lookup"><span data-stu-id="ab7f9-144">[ALTER DATABASE &#40;Transact-SQL&#41;](/sql/t-sql/statements/alter-database-transact-sql) </span></span>  
 <span data-ttu-id="ab7f9-145">[Mise en miroir de bases de données &#40;SQL Server&#41;](database-mirroring-sql-server.md) </span><span class="sxs-lookup"><span data-stu-id="ab7f9-145">[Database Mirroring &#40;SQL Server&#41;](database-mirroring-sql-server.md) </span></span>  
 [<span data-ttu-id="ab7f9-146">Suppression d’une mise en miroir des bases de données &#40;SQL Server&#41;</span><span class="sxs-lookup"><span data-stu-id="ab7f9-146">Removing Database Mirroring &#40;SQL Server&#41;</span></span>](database-mirroring-sql-server.md)  
  
  
