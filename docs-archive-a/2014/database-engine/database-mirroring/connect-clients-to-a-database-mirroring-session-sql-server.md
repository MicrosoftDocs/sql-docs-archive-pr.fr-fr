---
title: Connecter des clients à une session de mise en miroir de bases de données (SQL Server) | Microsoft Docs
ms.custom: ''
ms.date: 06/13/2017
ms.prod: sql-server-2014
ms.reviewer: ''
ms.technology: high-availability
ms.topic: conceptual
helpviewer_keywords:
- partners [SQL Server], connecting clients to
- database mirroring [SQL Server], connecting clients to
- client connections [SQL Server], database mirroring
- connections [SQL Server], database mirroring
ms.assetid: 0d5d2742-2614-43de-9ab9-864addb6299b
author: MikeRayMSFT
ms.author: mikeray
ms.openlocfilehash: 16faa8d02a22fba3e4cfa4cbe0bd6558fc140fdd
ms.sourcegitcommit: ad4d92dce894592a259721a1571b1d8736abacdb
ms.translationtype: MT
ms.contentlocale: fr-FR
ms.lasthandoff: 08/04/2020
ms.locfileid: "87603026"
---
# <a name="connect-clients-to-a-database-mirroring-session-sql-server"></a><span data-ttu-id="ff51a-102">Connecter des clients à une session de mise en miroir de bases de données (SQL Server)</span><span class="sxs-lookup"><span data-stu-id="ff51a-102">Connect Clients to a Database Mirroring Session (SQL Server)</span></span>
  <span data-ttu-id="ff51a-103">Pour établir une connexion avec une session de mise en miroir de bases de données, un client peut soit utiliser [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] Native Client, soit le fournisseur de données .NET Framework pour [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)].</span><span class="sxs-lookup"><span data-stu-id="ff51a-103">To connect to a database mirroring session, a client can use either [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] Native Client or .NET Framework Data Provider for [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)].</span></span> <span data-ttu-id="ff51a-104">S'ils sont configurés pour une base de données [!INCLUDE[ssCurrent](../../includes/sscurrent-md.md)] , ces deux fournisseurs d'accès aux données prennent pleinement en charge la mise en miroir de bases de données.</span><span class="sxs-lookup"><span data-stu-id="ff51a-104">When configured for a [!INCLUDE[ssCurrent](../../includes/sscurrent-md.md)] database, these data access providers both fully support database mirroring.</span></span> <span data-ttu-id="ff51a-105">Pour plus d'informations sur les éléments de programmation à prendre en compte pour l'utilisation d'une base de données mise en miroir, consultez [Using Database Mirroring](../../relational-databases/native-client/features/using-database-mirroring.md).</span><span class="sxs-lookup"><span data-stu-id="ff51a-105">For information about programming considerations for using a mirrored database, see [Using Database Mirroring](../../relational-databases/native-client/features/using-database-mirroring.md).</span></span> <span data-ttu-id="ff51a-106">Qui plus est, l'instance de serveur principal actuelle doit être disponible et la connexion du client doit avoir été créée dans l'instance de serveur.</span><span class="sxs-lookup"><span data-stu-id="ff51a-106">In addition, the current principal server instance must be available and the login of the client must have been created on the server instance.</span></span> <span data-ttu-id="ff51a-107">Pour plus d’informations, consultez [Dépanner des utilisateurs orphelins &#40;SQL Server&#41;](../../sql-server/failover-clusters/troubleshoot-orphaned-users-sql-server.md).</span><span class="sxs-lookup"><span data-stu-id="ff51a-107">For more information, see [Troubleshoot Orphaned Users &#40;SQL Server&#41;](../../sql-server/failover-clusters/troubleshoot-orphaned-users-sql-server.md).</span></span> <span data-ttu-id="ff51a-108">Les connexions clientes à une session de mise en miroir de base de données n'exigent pas l'intervention de l'instance de serveur témoin (le cas échéant).</span><span class="sxs-lookup"><span data-stu-id="ff51a-108">Client connections to a database mirroring session do not involve the witness server instance, if one exists.</span></span>  
  
 ##  <a name="making-the-initial-connection-to-a-database-mirroring-session"></a><a name="InitialConnection"></a> <span data-ttu-id="ff51a-109">Établissement de la connexion initiale à une session de mise en miroir de bases de données</span><span class="sxs-lookup"><span data-stu-id="ff51a-109">Making the Initial Connection to a Database Mirroring Session</span></span>  
 <span data-ttu-id="ff51a-110">Pour établir la connexion initiale avec une base de données mise en miroir, un client doit fournir une chaîne de connexion contenant au minimum le nom d'une instance de serveur.</span><span class="sxs-lookup"><span data-stu-id="ff51a-110">For the initial connection to a mirrored database, a client must supply a connection string that minimally supplies the name of a server instance.</span></span> <span data-ttu-id="ff51a-111">Ce nom de serveur obligatoire doit identifier l'instance du serveur principal actuel et est appelé *nom du serveur partenaire initial*.</span><span class="sxs-lookup"><span data-stu-id="ff51a-111">This required server name should identify the current principal server instance and is known as the *initial partner name*.</span></span>  
  
 <span data-ttu-id="ff51a-112">Éventuellement, la chaîne de connexion peut également fournir le nom d'une autre instance de serveur, qui doit alors identifier l'instance du serveur miroir actuel, à utiliser si le serveur partenaire initial n'est pas disponible lors de la première tentative de connexion.</span><span class="sxs-lookup"><span data-stu-id="ff51a-112">Optionally, the connection string can also supply the name of another server instance, which should identify the current mirror server instance, for use if the initial partner is unavailable during the first connection attempt.</span></span> <span data-ttu-id="ff51a-113">Ce deuxième nom est appelé *nom du partenaire de basculement*.</span><span class="sxs-lookup"><span data-stu-id="ff51a-113">The second name is known as the *failover partner name*.</span></span>  
  
 <span data-ttu-id="ff51a-114">La chaîne de connexion doit également contenir un nom de base de données.</span><span class="sxs-lookup"><span data-stu-id="ff51a-114">The connection string must also supply a database name.</span></span> <span data-ttu-id="ff51a-115">Cette information est requise pour permettre au fournisseur d'accès aux données d'effectuer des tentatives de basculement.</span><span class="sxs-lookup"><span data-stu-id="ff51a-115">This is necessary to enable failover attempts by the data access provider.</span></span>  
  
 <span data-ttu-id="ff51a-116">À la réception d'une chaîne de connexion, le fournisseur d'accès aux données stocke le nom du serveur partenaire initial et, le cas échéant, le nom du partenaire de basculement dans un cache de la mémoire volatile du client (pour le code managé, le cache se limite au domaine d'application).</span><span class="sxs-lookup"><span data-stu-id="ff51a-116">On receiving a connection string, the data access provider stores the initial partner name and the failover partner name, if supplied, in a cache in the client's volatile memory (for managed code, the cache is scoped to the application domain).</span></span> <span data-ttu-id="ff51a-117">Une fois mis en cache, le nom du serveur partenaire initial n'est jamais mis à jour par le fournisseur d'accès aux données.</span><span class="sxs-lookup"><span data-stu-id="ff51a-117">Once cached, the initial partner name is never updated by the data access provider.</span></span> <span data-ttu-id="ff51a-118">Lorsque le client fournit le nom du partenaire de basculement, le fournisseur d'accès aux données stocke aussi ce nom temporairement pour pouvoir se connecter s'il ne peut pas le faire en utilisant le nom du serveur partenaire initial.</span><span class="sxs-lookup"><span data-stu-id="ff51a-118">When the client supplies the failover partner name, the data access provider also stores this failover partner name temporarily in case the provider cannot connect using the initial partner name.</span></span>  
  
 <span data-ttu-id="ff51a-119">Une session de mise en miroir de bases de données ne fournit aucune protection contre les problèmes d'accès au serveur qui sont spécifiques aux clients, comme lorsqu'un ordinateur client n'arrive pas à communiquer avec le réseau.</span><span class="sxs-lookup"><span data-stu-id="ff51a-119">A database mirroring session does not protect against server-access problems that are specific to clients, such as when a client computer is having a problems communicating with the network.</span></span> <span data-ttu-id="ff51a-120">Une tentative de connexion à une base de données mise en miroir peut également échouer pour diverses raisons qui n'ont aucun rapport avec le fournisseur d'accès aux données ; par exemple, une tentative de connexion peut échouer parce que l'instance du serveur principal est inactive, comme c'est le cas pendant le basculement de la base de données, ou à cause d'une erreur réseau.</span><span class="sxs-lookup"><span data-stu-id="ff51a-120">A connection attempt to a mirrored database can also fail for a variety of reasons that are unrelated to the data-access provider; for example, a connection attempt can fail because the principal server instance is inactive, as occurs when the database is failing over, or because of a network error.</span></span>  
  
 <span data-ttu-id="ff51a-121">Lorsque le fournisseur d'accès aux données tente de se connecter, il commence par utiliser le nom du serveur partenaire initial.</span><span class="sxs-lookup"><span data-stu-id="ff51a-121">When attempting to connect, the data access provider begins by using the initial partner name.</span></span> <span data-ttu-id="ff51a-122">En règle générale, si l'instance de serveur spécifiée est disponible et qu'il s'agit bien de l'instance du serveur principal actuel, la tentative de connexion aboutit.</span><span class="sxs-lookup"><span data-stu-id="ff51a-122">If the specified server instance is available and is the current principal server instance, the connection attempt typically succeeds.</span></span>  
  
> [!NOTE]  
>  <span data-ttu-id="ff51a-123">Si la session de mise en miroir est suspendue, le client se connecte généralement au serveur principal et télécharge le nom du serveur partenaire.</span><span class="sxs-lookup"><span data-stu-id="ff51a-123">If the mirroring session is paused, the client typically connects to the principal server and the downloads the partner name.</span></span> <span data-ttu-id="ff51a-124">Cependant, le client ne peut pas accéder à la base de données tant que la mise en miroir n'a pas redémarré.</span><span class="sxs-lookup"><span data-stu-id="ff51a-124">However, the database is unavailable to the client until mirroring resumes.</span></span>  
  
 <span data-ttu-id="ff51a-125">Si cette tentative échoue, le fournisseur d'accès aux données essaie de se connecter à l'aide du nom du partenaire de basculement (s'il est disponible).</span><span class="sxs-lookup"><span data-stu-id="ff51a-125">If that attempt does not work, the data access provider tries the failover partner name, if available.</span></span> <span data-ttu-id="ff51a-126">Si l'un des noms de serveur partenaire identifie correctement le serveur principal actuel, le fournisseur d'accès aux données réussit généralement à ouvrir la connexion initiale.</span><span class="sxs-lookup"><span data-stu-id="ff51a-126">If either partner name correctly identifies the current principal server, the data access provider normally succeeds in opening the initial connection.</span></span> <span data-ttu-id="ff51a-127">Une fois cette connexion établie, le fournisseur d'accès aux données télécharge le nom d'instance de serveur du serveur miroir actuel.</span><span class="sxs-lookup"><span data-stu-id="ff51a-127">On completing this connection, the data access provider downloads the server instance name of the current mirror server.</span></span> <span data-ttu-id="ff51a-128">Ce nom est stocké dans le cache en tant que nom du partenaire de basculement et remplace, le cas échéant, le nom du partenaire de basculement fourni par le client.</span><span class="sxs-lookup"><span data-stu-id="ff51a-128">This name is stored in the cache as the failover partner name, overwriting the client-supplied failover partner name, if any.</span></span> <span data-ttu-id="ff51a-129">Par la suite, le fournisseur de données .NET Framework pour [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] ne met pas à jour le nom du partenaire de basculement.</span><span class="sxs-lookup"><span data-stu-id="ff51a-129">Thereafter, the .NET Framework Data Provider for [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] does not update the failover partner name.</span></span> <span data-ttu-id="ff51a-130">En revanche, [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] Native Client met le cache à jour à chaque fois qu'une connexion ou réinitialisation de connexion ultérieure retourne un nom de serveur partenaire différent.</span><span class="sxs-lookup"><span data-stu-id="ff51a-130">In contrast, [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] Native Client updates the cache whenever a subsequent connection or connection reset returns a different partner name.</span></span>  
  
 <span data-ttu-id="ff51a-131">La figure suivante représente une connexion cliente au serveur partenaire initial, **Partner_A**, pour une base de données en miroir appelée **Db_1**.</span><span class="sxs-lookup"><span data-stu-id="ff51a-131">The following figure illustrates a client connection to the initial partner, **Partner_A**, for a mirrored database named **Db_1**.</span></span> <span data-ttu-id="ff51a-132">Cette figure illustre le cas où le nom du serveur partenaire initial fourni par le client identifie correctement le serveur principal actuel, **Partner_A**.</span><span class="sxs-lookup"><span data-stu-id="ff51a-132">This figure shows a case in which the initial partner name supplied by the client correctly identifies the current principal server, **Partner_A**.</span></span> <span data-ttu-id="ff51a-133">La tentative de connexion initiale aboutit et le fournisseur d’accès aux données stocke le nom du serveur miroir (actuellement **Partner_B**) en tant que nom du partenaire de basculement dans le cache local.</span><span class="sxs-lookup"><span data-stu-id="ff51a-133">The initial connection attempt succeeds, and the data access provider stores the name of the mirror server (currently **Partner_B**) as the failover partner name in the local cache.</span></span> <span data-ttu-id="ff51a-134">Pour terminer, le client se connecte à la copie principale de la base de données **Db_1** .</span><span class="sxs-lookup"><span data-stu-id="ff51a-134">Finally, the client connects to the principal copy of the **Db_1** database.</span></span>  
  
 <span data-ttu-id="ff51a-135">![Connexion cliente si le serveur partenaire initial est le principal](../media/dbm-initial-connection.gif "Connexion cliente si le serveur partenaire initial est le principal")</span><span class="sxs-lookup"><span data-stu-id="ff51a-135">![Client connection if initial partner is principal](../media/dbm-initial-connection.gif "Client connection if initial partner is principal")</span></span>  
  
 <span data-ttu-id="ff51a-136">La tentative de connexion initiale peut échouer, entre autres, à cause d'une erreur réseau ou d'une instance de serveur inactive.</span><span class="sxs-lookup"><span data-stu-id="ff51a-136">The initial connection attempt may fail, for example, because of a network error or an inactive server instance.</span></span> <span data-ttu-id="ff51a-137">Étant donné que le serveur partenaire initial est alors indisponible, pour que le fournisseur d'accès aux données puisse essayer de se connecter au partenaire de basculement, le client doit avoir fourni le nom de ce dernier dans la chaîne de connexion.</span><span class="sxs-lookup"><span data-stu-id="ff51a-137">Because the initial partner is unavailable, for the data access provider to attempt to connect to the failover partner, the client must have supplied the failover partner name in the connection string.</span></span>  
  
 <span data-ttu-id="ff51a-138">Si ce n'est pas le cas et que le nom du partenaire de basculement n'est pas disponible, la tentative de connexion initiale se poursuit jusqu'à l'expiration de la connexion réseau ou jusqu'à ce qu'une erreur soit retournée (exactement comme pour une base de données qui n'est pas mise en miroir).</span><span class="sxs-lookup"><span data-stu-id="ff51a-138">In that case, if the failover partner name is unavailable, the original connection attempt continues until the network connection timeout or an error is returned (just as for a non-mirrored database).</span></span>  
  
 <span data-ttu-id="ff51a-139">Lorsque le nom du partenaire de basculement est fourni dans la chaîne de connexion, le comportement du fournisseur d'accès aux données dépend du protocole réseau et du système d'exploitation du client, comme indiqué ci-après :</span><span class="sxs-lookup"><span data-stu-id="ff51a-139">When the failover partner name is supplied in the connection string, the behavior of the data access provider depends on the network protocol and operating system of the client, as follows:</span></span>  
  
-   <span data-ttu-id="ff51a-140">Pour TCP/IP, les tentatives de connexion sont régies par un algorithme de délai entre deux tentatives de connexion spécifique à la mise en miroir de bases de données.</span><span class="sxs-lookup"><span data-stu-id="ff51a-140">For TCP/IP, the connection attempts are regulated by a connection retry algorithm that is specific to database mirroring.</span></span> <span data-ttu-id="ff51a-141">L’ *algorithme de délai entre deux tentatives de connexion* détermine la durée maximale (le *délai entre deux tentatives*) allouée à l’ouverture d’une connexion lors d’une tentative de connexion donnée.</span><span class="sxs-lookup"><span data-stu-id="ff51a-141">The *connection retry algorithm* determines the maximum time (the *retry time*) allotted for opening a connection in a given connection attempt.</span></span>  
  
-   <span data-ttu-id="ff51a-142">Pour les autres protocoles réseau</span><span class="sxs-lookup"><span data-stu-id="ff51a-142">For other network protocols</span></span>  
  
     <span data-ttu-id="ff51a-143">Si une erreur se produit ou si le serveur partenaire initial est indisponible, la tentative de connexion initiale attend l'expiration du délai d'attente de la connexion réseau ou du délai d'attente de la connexion du fournisseur d'accès aux données.</span><span class="sxs-lookup"><span data-stu-id="ff51a-143">If an error occurs or if the initial partner is unavailable, the initial connection attempt waits until the network connection timeout period expires or the login timeout period expires on the data access provider.</span></span> <span data-ttu-id="ff51a-144">En général, ce délai est de l'ordre de 20 à 30 secondes.</span><span class="sxs-lookup"><span data-stu-id="ff51a-144">Typically, this wait is on the order of 20 to 30 seconds.</span></span> <span data-ttu-id="ff51a-145">Ensuite, si la connexion du fournisseur d'accès aux données n'a pas expiré, le fournisseur tente de se connecter au partenaire de basculement.</span><span class="sxs-lookup"><span data-stu-id="ff51a-145">Thereafter, if the data access provider has not timed out, it attempts to connect to the failover partner.</span></span> <span data-ttu-id="ff51a-146">Si le délai d'attente de la connexion expire avant l'établissement de la connexion ou si le partenaire de basculement est indisponible, la tentative de connexion échoue.</span><span class="sxs-lookup"><span data-stu-id="ff51a-146">If the connection timeout period expires before the connection succeeds or the failover partner is unavailable, the connection attempt fails.</span></span> <span data-ttu-id="ff51a-147">Par contre, si le partenaire de basculement est disponible avant l'expiration du délai d'attente de la connexion et qu'il s'agit désormais du serveur principal, la tentative de connexion aboutit généralement.</span><span class="sxs-lookup"><span data-stu-id="ff51a-147">If failover partner is available within the login timeout period and is now the principal server, the connection attempt normally succeeds.</span></span>  

  
### <a name="connection-strings-for-a-mirrored-database"></a><span data-ttu-id="ff51a-148">Chaînes de connexion pour une base de données en miroir</span><span class="sxs-lookup"><span data-stu-id="ff51a-148">Connection Strings for a Mirrored Database</span></span>  
 <span data-ttu-id="ff51a-149">La chaîne de connexion fournie par le client contient des informations que le fournisseur d'accès aux données utilise pour se connecter à la base de données.</span><span class="sxs-lookup"><span data-stu-id="ff51a-149">The connection string supplied by the client contains information that the data access provider uses to connect to the database.</span></span> <span data-ttu-id="ff51a-150">Cette section présente les mots clés qui sont tout particulièrement appropriés pour se connecter à une base de données mise en miroir à l'aide d'une connexion au pilote ODBC de [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] Native Client.</span><span class="sxs-lookup"><span data-stu-id="ff51a-150">This section discusses the keywords that are specifically relevant for connecting to a mirrored database using a [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] Native Client ODBC Driver Connection.</span></span>  
  
#### <a name="network-attribute"></a><span data-ttu-id="ff51a-151">Attribut Network</span><span class="sxs-lookup"><span data-stu-id="ff51a-151">Network Attribute</span></span>  
 <span data-ttu-id="ff51a-152">La chaîne de connexion doit contenir l’attribut **Network** pour spécifier le protocole réseau.</span><span class="sxs-lookup"><span data-stu-id="ff51a-152">The connection string should contain the **Network** attribute to specify the network protocol.</span></span> <span data-ttu-id="ff51a-153">Cela permet d'assurer la persistance du protocole réseau spécifié entre les connexions avec différents serveurs partenaires.</span><span class="sxs-lookup"><span data-stu-id="ff51a-153">This ensures that the specified network protocol persists between connections to different partners.</span></span> <span data-ttu-id="ff51a-154">TCP/IP est le meilleur protocole pour se connecter à une base de données mise en miroir.</span><span class="sxs-lookup"><span data-stu-id="ff51a-154">The best protocol for connecting to a mirrored database is TCP/IP.</span></span> <span data-ttu-id="ff51a-155">Pour garantir que le client exige TCP/IP à chaque fois qu'il se connecte aux serveurs partenaires, la chaîne de connexion doit fournir l'attribut suivant :</span><span class="sxs-lookup"><span data-stu-id="ff51a-155">To ensure that the client requests TCP/IP for every connection to the partners, a connection string supplies the following attribute:</span></span>  
  
```  
Network=dbmssocn;   
```  
  
> [!IMPORTANT]  
>  <span data-ttu-id="ff51a-156">Nous vous recommandons de laisser TCP/IP en haut de la liste de protocoles d'un client.</span><span class="sxs-lookup"><span data-stu-id="ff51a-156">We recommend keeping TCP/IP at the top of a client's protocol list.</span></span> <span data-ttu-id="ff51a-157">Toutefois, si la chaîne de connexion spécifie l’attribut **Network** , l’ordre de cette liste est ignoré.</span><span class="sxs-lookup"><span data-stu-id="ff51a-157">However, if the connection string specifies the **Network** attribute, this overrides the list order.</span></span>  
  
 <span data-ttu-id="ff51a-158">Sinon, pour garantir que le client exige des canaux nommés chaque fois qu'il se connecte aux serveurs partenaires, la chaîne de connexion doit fournir l'attribut suivant :</span><span class="sxs-lookup"><span data-stu-id="ff51a-158">Alternatively, to ensure that the client requests named pipes for every connection to the partners, a connection string supplies the following attribute:</span></span>  
  
```  
Network=dbnmpntw;   
```  
  
> [!IMPORTANT]  
>  <span data-ttu-id="ff51a-159">Étant donné que le protocole des canaux nommés n'utilise pas l'algorithme de tentative de connexion TCP/IP, une tentative de connexion utilisant des canaux nommés risque, dans de nombreux cas, d'expirer avant de se connecter à une base de données mise en miroir.</span><span class="sxs-lookup"><span data-stu-id="ff51a-159">Because named pipes does not use the TCP/IP retry algorithm, in many cases, a named pipes connection attempt may time out before connecting to a mirrored database.</span></span>  
  
#### <a name="server-attribute"></a><span data-ttu-id="ff51a-160">Attribut Server</span><span class="sxs-lookup"><span data-stu-id="ff51a-160">Server Attribute</span></span>  
 <span data-ttu-id="ff51a-161">La chaîne de connexion doit contenir un attribut `Server` indiquant le nom du serveur partenaire initial, lequel doit identifier l'instance du serveur principal actuel.</span><span class="sxs-lookup"><span data-stu-id="ff51a-161">The connection string must contain a `Server` attribute that supplies the initial partner name, which should identify the current principal server instance.</span></span>  
  
 <span data-ttu-id="ff51a-162">La façon la plus simple d’identifier l’instance de serveur consiste à spécifier son nom : *<nom_serveur>* [ **\\** _<nom_instance_SQL_Server>_ ].</span><span class="sxs-lookup"><span data-stu-id="ff51a-162">The simplest way to identify the server instance is by specifying its name , *<server_name>*[**\\**_<SQL_Server_instance_name>_].</span></span> <span data-ttu-id="ff51a-163">Par exemple :</span><span class="sxs-lookup"><span data-stu-id="ff51a-163">For example:</span></span>  
  
 `Server=Partner_A;`  
  
 <span data-ttu-id="ff51a-164">or</span><span class="sxs-lookup"><span data-stu-id="ff51a-164">or</span></span>  
  
 `Server=Partner_A\Instance_2;`  
  
 <span data-ttu-id="ff51a-165">Cependant, lorsque le nom système est utilisé, le client doit effectuer une recherche DNS pour obtenir l'adresse IP du serveur et une requête SQL Server Browser pour obtenir le numéro de port du serveur sur lequel le serveur partenaire réside.</span><span class="sxs-lookup"><span data-stu-id="ff51a-165">However, when the system name is used, the client must perform a DNS lookup to obtain the IP address of the server and a SQL Server Browser query to obtain the port number of the server on which the partner resides.</span></span> <span data-ttu-id="ff51a-166">Ces recherches et requêtes peuvent être évitées en spécifiant l'adresse IP et le numéro de port du serveur partenaire dans l'attribut `Server`, au lieu de spécifier le nom du serveur.</span><span class="sxs-lookup"><span data-stu-id="ff51a-166">Those lookups and queries can be bypassed by specifying the IP address and port number of the partner in the `Server` attribute, rather than specifying the server name.</span></span> <span data-ttu-id="ff51a-167">Cette méthode est recommandée afin de minimiser la possibilité de délais externes pendant la connexion à ce serveur partenaire.</span><span class="sxs-lookup"><span data-stu-id="ff51a-167">This is recommended to minimize the possibility of external delays while connecting to that partner.</span></span>  
  
> [!NOTE]  
>  <span data-ttu-id="ff51a-168">Il est nécessaire d'effectuer une requête SQL Server Browser si la chaîne de connexion spécifie le nom de l'instance nommée et pas le port.</span><span class="sxs-lookup"><span data-stu-id="ff51a-168">A SQL Server Browser query is necessary if the connection string specifies the named instance name and not the port.</span></span>  
  
 <span data-ttu-id="ff51a-169">Pour spécifier l’adresse IP et le port, l' `Server` attribut prend la forme suivante, `Server=` *<ip_address>* `,` *\<port>* , par exemple :</span><span class="sxs-lookup"><span data-stu-id="ff51a-169">To specify the IP address and port, the `Server` attribute takes the following form, `Server=`*<ip_address>*`,`*\<port>*, for example:</span></span>  
  
```  
Server=123.34.45.56,4724;   
```  
  
> [!NOTE]  
>  <span data-ttu-id="ff51a-170">L'adresse IP peut être une adresse IP Version 4 (IPv4) ou IP Version 6 (IPv6).</span><span class="sxs-lookup"><span data-stu-id="ff51a-170">The IP address can be IP Version 4 (IPv4) or IP Version 6 (IPv6).</span></span>  
  
#### <a name="database-attribute"></a><span data-ttu-id="ff51a-171">Attribut Database</span><span class="sxs-lookup"><span data-stu-id="ff51a-171">Database Attribute</span></span>  
 <span data-ttu-id="ff51a-172">En outre, la chaîne de connexion doit spécifier l'attribut `Database` pour fournir le nom de la base de données mise en miroir.</span><span class="sxs-lookup"><span data-stu-id="ff51a-172">In addition, the connection string must specify the `Database` attribute to supply the name of the mirrored database.</span></span> <span data-ttu-id="ff51a-173">Si la base de données est indisponible lors de la tentative de connexion du client, une exception est générée.</span><span class="sxs-lookup"><span data-stu-id="ff51a-173">If the database is unavailable when the client attempts to connect, an exception is raised.</span></span>  
  
 <span data-ttu-id="ff51a-174">Par exemple, pour se connecter explicitement à la base de données **AdventureWorks** sur le serveur principal Partner_A, un client doit utiliser la chaîne de connexion suivante :</span><span class="sxs-lookup"><span data-stu-id="ff51a-174">For example, to expressly connect to the **AdventureWorks** database on the principal server Partner_A, a client uses the following connection string:</span></span>  
  
 `" Server=Partner_A; Database=AdventureWorks "`  
  
> [!NOTE]  
>  <span data-ttu-id="ff51a-175">Cette chaîne omet les informations d'authentification.</span><span class="sxs-lookup"><span data-stu-id="ff51a-175">This string omits authentication information.</span></span>  
  
> [!IMPORTANT]  
>  <span data-ttu-id="ff51a-176">Le regroupement du préfixe du protocole avec l' `Server` attribut ( `Server=tcp:` *\<servername>* ) n’est pas compatible avec l’attribut **Network** , et la spécification du protocole aux deux emplacements entraîne probablement une erreur.</span><span class="sxs-lookup"><span data-stu-id="ff51a-176">Bundling the protocol prefix with the `Server` attribute (`Server=tcp:`*\<servername>*) is incompatible with the **Network** attribute, and specifying the protocol in both places will likely result in an error.</span></span> <span data-ttu-id="ff51a-177">Par conséquent, nous recommandons qu’une chaîne de connexion spécifie le protocole à l’aide de l’attribut **Network** et spécifie uniquement le nom du serveur dans l' `Server` attribut ( `"Network=dbmssocn; Server=` *\<servername>* `"` ).</span><span class="sxs-lookup"><span data-stu-id="ff51a-177">Therefore, we recommend that a connection string specify the protocol using the **Network** attribute and specify only the server name in the `Server` attribute (`"Network=dbmssocn; Server=`*\<servername>*`"`).</span></span>  
  
#### <a name="failover-partner-attribute"></a><span data-ttu-id="ff51a-178">Attribut partenaire de basculement</span><span class="sxs-lookup"><span data-stu-id="ff51a-178">Failover Partner Attribute</span></span>  
 <span data-ttu-id="ff51a-179">Outre le nom du serveur partenaire initial, le client peut aussi spécifier le nom du partenaire de basculement, lequel doit identifier l'instance du serveur miroir actuel.</span><span class="sxs-lookup"><span data-stu-id="ff51a-179">In addition to the initial partner name, the client can also specify failover partner name, which should identify the current mirror server instance.</span></span> <span data-ttu-id="ff51a-180">Le partenaire de basculement est spécifié par l'un des mots clés pour l'attribut de partenaire de basculement.</span><span class="sxs-lookup"><span data-stu-id="ff51a-180">The failover partner is specified by one of the keywords for the failover partner attribute.</span></span> <span data-ttu-id="ff51a-181">Le mot clé de cet attribut dépend de l'API que vous utilisez.</span><span class="sxs-lookup"><span data-stu-id="ff51a-181">The keyword for this attribute depends on the API that you are using.</span></span> <span data-ttu-id="ff51a-182">La table suivante répertorie ces mots clés :</span><span class="sxs-lookup"><span data-stu-id="ff51a-182">The following table lists these keywords:</span></span>  
  
|<span data-ttu-id="ff51a-183">API</span><span class="sxs-lookup"><span data-stu-id="ff51a-183">API</span></span>|<span data-ttu-id="ff51a-184">Mot clé pour l'attribut de partenaire de basculement</span><span class="sxs-lookup"><span data-stu-id="ff51a-184">Keyword for failover partner attribute</span></span>|  
|---------|--------------------------------------------|  
|<span data-ttu-id="ff51a-185">Fournisseur OLE DB</span><span class="sxs-lookup"><span data-stu-id="ff51a-185">OLE DB Provider</span></span>|`FailoverPartner`|  
|<span data-ttu-id="ff51a-186">Pilote ODBC</span><span class="sxs-lookup"><span data-stu-id="ff51a-186">ODBC Driver</span></span>|`Failover_Partner`|  
|<span data-ttu-id="ff51a-187">ActiveX Data Objects (ADO)</span><span class="sxs-lookup"><span data-stu-id="ff51a-187">ActiveX Data Objects (ADO)</span></span>|`Failover Partner`|  
  
 <span data-ttu-id="ff51a-188">La façon la plus simple d’identifier l’instance de serveur consiste à employer son nom système : *<nom_serveur>* [ **\\** _<nom_instance_SQL_Server>_ ].</span><span class="sxs-lookup"><span data-stu-id="ff51a-188">The simplest way to identify the server instance is by its system name, *<server_name>*[**\\**_<SQL_Server_instance_name>_].</span></span>  
  
 <span data-ttu-id="ff51a-189">Sinon, l'adresse IP et le numéro de port peuvent être fournis dans l'attribut `Failover Partner`.</span><span class="sxs-lookup"><span data-stu-id="ff51a-189">Alternatively, the IP address and port number can be supplied in the `Failover Partner` attribute.</span></span> <span data-ttu-id="ff51a-190">Si la tentative de connexion initiale échoue au cours de la première connexion à la base de données, la tentative de connexion au partenaire de basculement ne sera pas tributaire de DNS et de SQL Server Browser.</span><span class="sxs-lookup"><span data-stu-id="ff51a-190">If the initial connection attempt fails during the first connection to the database, the attempt to connect to the failover partner will be freed from relying on DNS and SQL Server Browser.</span></span> <span data-ttu-id="ff51a-191">Une fois qu'une connexion est établie, le nom du partenaire de basculement sera remplacé par le nom du partenaire de basculement, si bien qu'en cas de basculement, les connexions redirigées feront appel à DNS et à SQL Server Browser.</span><span class="sxs-lookup"><span data-stu-id="ff51a-191">Once a connection is established, the failover partner name will be overwritten with the failover partner name, so if a failover occurs, the redirected connections will require DNS and SQL Server Browser.</span></span>  
  
> [!NOTE]  
>  <span data-ttu-id="ff51a-192">Lorsque seul le nom du serveur partenaire initial est fourni, les développeurs d'applications n'ont rien à faire, ni aucun code à écrire, mis à part le code relatif à la reconnexion.</span><span class="sxs-lookup"><span data-stu-id="ff51a-192">When only the initial partner name is provided, application developers do not need to take any action or write any code except about how to reconnect.</span></span>  
  
> [!NOTE]  
>  <span data-ttu-id="ff51a-193">Les développeurs d'applications en code managé fournissent le nom du partenaire de basculement dans la propriété `ConnectionString` de l'objet `SqlConnection`.</span><span class="sxs-lookup"><span data-stu-id="ff51a-193">Managed code application developers supply the failover partner name in the `ConnectionString` of the `SqlConnection` object.</span></span> <span data-ttu-id="ff51a-194">Pour plus d'informations sur l'utilisation de cette chaîne de connexion, consultez « Database Mirroring Support in the .NET Framework Data Provider for SQL Server » (en anglais) dans la documentation ADO.NET qui fait partie du kit de développement logiciel (SDK) [!INCLUDE[msCoName](../../includes/msconame-md.md)] .NET Framework.</span><span class="sxs-lookup"><span data-stu-id="ff51a-194">For information on using this connection string, see "Database Mirroring Support in the .NET Framework Data Provider for SQL Server" in the ADO.NET documentation, which is part of the [!INCLUDE[msCoName](../../includes/msconame-md.md)] .NET Framework SDK.</span></span>  
  
#### <a name="example-connection-string"></a><span data-ttu-id="ff51a-195">Exemple de chaîne de connexion</span><span class="sxs-lookup"><span data-stu-id="ff51a-195">Example Connection String</span></span>  
 <span data-ttu-id="ff51a-196">Par exemple, pour se connecter explicitement à l’aide de TCP/IP à la base de données **AdventureWorks** sur Partner_A ou sur Partner_B, une application cliente qui utilise le pilote ODBC peut fournir la chaîne de connexion suivante :</span><span class="sxs-lookup"><span data-stu-id="ff51a-196">For example, to explicitly connect using TCP/IP to the **AdventureWorks** database on either Partner_A or Partner_B, a client application that uses the ODBC Driver could supply the following connection string:</span></span>  
  
```  
"Server=Partner_A; Failover_Partner=Partner_B; Database=AdventureWorks; Network=dbmssocn"  
```  
  
 <span data-ttu-id="ff51a-197">Sinon, le client peut utiliser l'adresse IP et le numéro de port pour identifier le serveur partenaire initial, Partner_A ; par exemple, si l'adresse IP est 250.65.43.21 et le numéro de port est 4734, la chaîne de connexion est la suivante :</span><span class="sxs-lookup"><span data-stu-id="ff51a-197">Alternatively, the client could use the IP address and port number to identify the initial partner, Partner_A; for example, if the IP address is 250.65.43.21 and the port number is 4734, the connection string would be:</span></span>  
  
```  
"Server=250.65.43.21,4734; Failover_Partner=Partner_B; Database=AdventureWorks; Network=dbmssocn"  
```  
  
##  <a name="connection-retry-algorithm-for-tcpip-connections"></a><a name="RetryAlgorithm"></a> <span data-ttu-id="ff51a-198">Algorithme de délai entre deux tentatives de connexion (pour les connexions TCP/IP)</span><span class="sxs-lookup"><span data-stu-id="ff51a-198">Connection Retry Algorithm (for TCP/IP Connections)</span></span>  
 <span data-ttu-id="ff51a-199">Pour une connexion TCP/IP, lorsque les noms des deux partenaires sont dans le cache, le fournisseur d'accès aux données se conforme à un algorithme de délai entre deux tentatives de connexion.</span><span class="sxs-lookup"><span data-stu-id="ff51a-199">For a TCP/IP connection, when both partner names are in the cache, the data access provider adheres to a connection retry algorithm.</span></span> <span data-ttu-id="ff51a-200">Ceci s'applique lors de l'établissement de la connexion initiale à la session et lors de la reconnexion lorsqu'une connexion établie a été perdue.</span><span class="sxs-lookup"><span data-stu-id="ff51a-200">This is true both for making the initial connection to the session and for reconnecting after losing an established connection.</span></span> <span data-ttu-id="ff51a-201">Une fois qu'une connexion a été ouverte, la réalisation des opérations de préouverture et d'ouverture de session prend du temps.</span><span class="sxs-lookup"><span data-stu-id="ff51a-201">Once a connection has been opened, completing the pre-login and login steps takes additional time.</span></span>  
  
> [!NOTE]  
>  <span data-ttu-id="ff51a-202">Le temps consacré à l'établissement d'une connexion peut être supérieur au délai alloué entre deux tentatives en raison de facteurs externes, tels que les recherches DNS, un centre de distribution de clés de contrôleur de domaine/Kerberos lent, le temps consacré à contacter le service SQL Server Browser, un encombrement sur le réseau, etc.</span><span class="sxs-lookup"><span data-stu-id="ff51a-202">The time spent in opening a connection can exceed the retry time because of external factors, such as slow DNS lookups, slow domain controller/Kerberos Key Distribution Center (KDC), time spent contacting SQL Server Browser, network congestion, and so forth.</span></span> <span data-ttu-id="ff51a-203">Ces facteurs externes peuvent empêcher un client de se connecter à une base de données mise en miroir.</span><span class="sxs-lookup"><span data-stu-id="ff51a-203">Such external factors can prevent a client from connecting to a mirrored database.</span></span> <span data-ttu-id="ff51a-204">L'ouverture d'une connexion peut également être plus longue que le délai prévu entre deux tentatives en raison de facteurs externes.</span><span class="sxs-lookup"><span data-stu-id="ff51a-204">Also, external factors can cause a connection to take longer to open than the allotted retry time.</span></span> <span data-ttu-id="ff51a-205">Pour plus d'informations sur le contournement de DNS et du service SQL Server Browser afin de tenter d'établir une connexion au partenaire initial, consultez [Établissement de la connexion initiale à une session de mise en miroir de bases de données](#InitialConnection), plus haut dans cette rubrique.</span><span class="sxs-lookup"><span data-stu-id="ff51a-205">For information on bypassing DNS and SQL Server Browser for connection attempt to the initial partner, see [Making the Initial Connection to a Database Mirroring Session](#InitialConnection), earlier in this topic.</span></span>  
  
 <span data-ttu-id="ff51a-206">Si une tentative de connexion échoue ou si le délai entre deux tentatives expire avant que la connexion n'ait été établie, le fournisseur d'accès aux données se tourne vers l'autre partenaire.</span><span class="sxs-lookup"><span data-stu-id="ff51a-206">If a connection attempt fails or the retry time expires before it succeeds, the data access provider tries the other partner.</span></span> <span data-ttu-id="ff51a-207">Si une connexion n'est pas ouverte à ce stade, le fournisseur tente alors d'utiliser le nom du partenaire initial et celui du partenaire de basculement, jusqu'à ce qu'une connexion ait été ouverte ou que le délai de connexion ait expiré. Par défaut, le délai d'expiration de connexion est de 15 secondes.</span><span class="sxs-lookup"><span data-stu-id="ff51a-207">If a connection is not opened by this point, the provider alternately tries the initial and failover partner names, until a connection is opened or the login period times out. The default login time-out period is 15 seconds.</span></span> <span data-ttu-id="ff51a-208">Nous vous conseillons d'utiliser un délai d'expiration de connexion d'au moins 5 secondes.</span><span class="sxs-lookup"><span data-stu-id="ff51a-208">We recommend that the login time-out period be at least 5 seconds.</span></span> <span data-ttu-id="ff51a-209">Si vous spécifiez un délai d'expiration plus court, il est possible que toutes les tentatives de connexion échouent.</span><span class="sxs-lookup"><span data-stu-id="ff51a-209">Specifying a smaller time-out period might prevent any of the connection attempts from succeeding.</span></span>  
  
 <span data-ttu-id="ff51a-210">Le délai entre deux tentatives correspond à un pourcentage du délai de connexion.</span><span class="sxs-lookup"><span data-stu-id="ff51a-210">The retry time is a percentage of the login period.</span></span> <span data-ttu-id="ff51a-211">Le délai entre deux tentatives de connexion augmente lors de chaque essai successif.</span><span class="sxs-lookup"><span data-stu-id="ff51a-211">The retry time for a connection attempt is larger in each successive round.</span></span> <span data-ttu-id="ff51a-212">Lors du premier essai, le délai entre deux tentatives correspond à 8 % du délai de connexion total.</span><span class="sxs-lookup"><span data-stu-id="ff51a-212">In the first round, the retry time for each of the two attempts is 8 percent of the total login period.</span></span> <span data-ttu-id="ff51a-213">Lors de chaque essai qui suit, l'algorithme de délai entre deux tentatives augmente la durée maximale accordée en fonction de cette même valeur.</span><span class="sxs-lookup"><span data-stu-id="ff51a-213">In each successive round, the retry algorithm increases the maximum retry time by the same amount.</span></span> <span data-ttu-id="ff51a-214">Par conséquent, les valeurs de délai entre les huit premières tentatives de connexion sont les suivantes :</span><span class="sxs-lookup"><span data-stu-id="ff51a-214">Thus, the retry times for the first eight connection attempts is as follows:</span></span>  
  
 <span data-ttu-id="ff51a-215">8%, 8%, 16%, 16%, 24%, 24%, 32%, 32%</span><span class="sxs-lookup"><span data-stu-id="ff51a-215">8%, 8%, 16%, 16%, 24%, 24%, 32%, 32%</span></span>  
  
 <span data-ttu-id="ff51a-216">Le délai entre deux tentatives est calculé au moyen de la formule suivante :</span><span class="sxs-lookup"><span data-stu-id="ff51a-216">The retry time is calculated using the following formula:</span></span>  
  
 <span data-ttu-id="ff51a-217">_RetryTime_ **=** _PreviousRetryTime_ **+(** 0,08 **&#42;** _LoginTimeout_ **)**</span><span class="sxs-lookup"><span data-stu-id="ff51a-217">_RetryTime_ **=** _PreviousRetryTime_ **+(** 0.08 **&#42;**_LoginTimeout_**)**</span></span>  
  
 <span data-ttu-id="ff51a-218">Où *PreviousRetryTime* a la valeur 0 au départ.</span><span class="sxs-lookup"><span data-stu-id="ff51a-218">Where *PreviousRetryTime* is initially 0.</span></span>  
  
 <span data-ttu-id="ff51a-219">Par exemple, si vous utilisez le délai d’expiration de connexion par défaut de 15 secondes, *LoginTimeout* *= 15*.</span><span class="sxs-lookup"><span data-stu-id="ff51a-219">For example, if using the default login time-out period of 15 seconds, *LoginTimeout* *= 15*.</span></span> <span data-ttu-id="ff51a-220">Dans ce cas, les délais entre deux tentatives alloués lors des trois premiers essais sont les suivants :</span><span class="sxs-lookup"><span data-stu-id="ff51a-220">In this case, the retry times allotted in the first three rounds are as follows:</span></span>  
  
|<span data-ttu-id="ff51a-221">Round</span><span class="sxs-lookup"><span data-stu-id="ff51a-221">Round</span></span>|<span data-ttu-id="ff51a-222">Calcul de*RetryTime*</span><span class="sxs-lookup"><span data-stu-id="ff51a-222">*RetryTime* calculation</span></span>|<span data-ttu-id="ff51a-223">Délai entre chaque tentative</span><span class="sxs-lookup"><span data-stu-id="ff51a-223">Retry time per attempt</span></span>|  
|-----------|-----------------------------|----------------------------|  
|<span data-ttu-id="ff51a-224">1</span><span class="sxs-lookup"><span data-stu-id="ff51a-224">1</span></span>|<span data-ttu-id="ff51a-225">0 **+(** 0,08 **&#42;** 15 **)**</span><span class="sxs-lookup"><span data-stu-id="ff51a-225">0 **+(** 0.08 **&#42;** 15 **)**</span></span>|<span data-ttu-id="ff51a-226">1,2 secondes</span><span class="sxs-lookup"><span data-stu-id="ff51a-226">1.2 seconds</span></span>|  
|<span data-ttu-id="ff51a-227">2</span><span class="sxs-lookup"><span data-stu-id="ff51a-227">2</span></span>|<span data-ttu-id="ff51a-228">1,2 **+(** 0,08 **&#42;** 15 **)**</span><span class="sxs-lookup"><span data-stu-id="ff51a-228">1.2 **+(** 0.08 **&#42;** 15 **)**</span></span>|<span data-ttu-id="ff51a-229">2,4 secondes</span><span class="sxs-lookup"><span data-stu-id="ff51a-229">2.4 seconds</span></span>|  
|<span data-ttu-id="ff51a-230">3</span><span class="sxs-lookup"><span data-stu-id="ff51a-230">3</span></span>|<span data-ttu-id="ff51a-231">2,4 **+(** 0,08 **&#42;** 15 **)**</span><span class="sxs-lookup"><span data-stu-id="ff51a-231">2.4 **+(** 0.08 **&#42;** 15 **)**</span></span>|<span data-ttu-id="ff51a-232">3,6 secondes</span><span class="sxs-lookup"><span data-stu-id="ff51a-232">3.6 seconds</span></span>|  
|<span data-ttu-id="ff51a-233">4</span><span class="sxs-lookup"><span data-stu-id="ff51a-233">4</span></span>|<span data-ttu-id="ff51a-234">3,6 **+(** 0,08 **&#42;** 15 **)**</span><span class="sxs-lookup"><span data-stu-id="ff51a-234">3.6 **+(** 0.08 **&#42;** 15 **)**</span></span>|<span data-ttu-id="ff51a-235">4,8 secondes</span><span class="sxs-lookup"><span data-stu-id="ff51a-235">4.8 seconds</span></span>|   
  
 <span data-ttu-id="ff51a-236">Le tableau suivant illustre ces délais pour les tentatives de connexion successives, lesquelles excèdent toutes le délai d'expiration.</span><span class="sxs-lookup"><span data-stu-id="ff51a-236">The following figure illustrates these retry times for successive connection attempts, each of which times out.</span></span>  
  
 <span data-ttu-id="ff51a-237">![Délai maximal de reprise pour un délai de connexion de 15 secondes](../media/dbm-retry-algorithm.gif "Délai maximal de reprise pour un délai de connexion de 15 secondes")</span><span class="sxs-lookup"><span data-stu-id="ff51a-237">![Maximum retry delays for 15 second login timeout](../media/dbm-retry-algorithm.gif "Maximum retry delays for 15 second login timeout")</span></span>  
  
 <span data-ttu-id="ff51a-238">Pour le délai d'expiration de connexion par défaut, la durée maximale allouée aux trois premières tentatives de connexion est de 14,4 secondes.</span><span class="sxs-lookup"><span data-stu-id="ff51a-238">For the default login time-out period, the maximum time allotted to the first three rounds of connection attempts is 14.4 seconds.</span></span> <span data-ttu-id="ff51a-239">Si chaque tentative venait à utiliser la totalité du temps qui lui est alloué, il ne resterait alors que 0,6 secondes avant l'expiration du délai de connexion. Dans ce cas, la quatrième tentative serait écourtée et permettrait uniquement une dernière tentative de connexion rapide à l'aide du nom du partenaire initial.</span><span class="sxs-lookup"><span data-stu-id="ff51a-239">If every attempt were to use all of its allotted time, only 0.6 seconds of time would remain before the login period times out. In that case, the fourth round would be curtailed, allowing only a final quick attempt to connect using the initial partner name.</span></span> <span data-ttu-id="ff51a-240">Cependant, une tentative de connexion peut échouer avant le délai autorisé, surtout lors des tentatives ultérieures.</span><span class="sxs-lookup"><span data-stu-id="ff51a-240">However, a connection attempt may fail in less than its allotted retry time, particularly in later rounds.</span></span> <span data-ttu-id="ff51a-241">Par exemple, la réception d'une erreur réseau peut entraîner l'arrêt d'une tentative avant l'expiration du délai entre deux tentatives.</span><span class="sxs-lookup"><span data-stu-id="ff51a-241">For example, receiving a network error can cause an attempt to end before the retry time expires.</span></span> <span data-ttu-id="ff51a-242">Si les premières tentatives échouent en raison d'une erreur réseau, un délai supplémentaire est alors disponible pour la quatrième tentative, et éventuellement, pour des tentatives supplémentaires.</span><span class="sxs-lookup"><span data-stu-id="ff51a-242">If earlier attempts fail due to a network error, additional time would be available for the fourth round and, perhaps, additional rounds.</span></span>  
  
 <span data-ttu-id="ff51a-243">L'échec d'une tentative de connexion peut également être lié à une instance de serveur inactive, comme dans les cas de figure où une instance de serveur procède au basculement de sa base de données.</span><span class="sxs-lookup"><span data-stu-id="ff51a-243">Another cause of a failed attempt is an inactive server instance, as occurs when a server instance is engaged in failing over its database.</span></span> <span data-ttu-id="ff51a-244">Dans ce cas, un délai entre deux tentatives est imposé pour empêcher que les clients surchargent les partenaires de tentatives de connexion à répétition.</span><span class="sxs-lookup"><span data-stu-id="ff51a-244">In this case, a retry delay is imposed to prevent clients from overloading the partners with a rapid succession of connection attempts.</span></span>  
  
> [!NOTE]  
>  <span data-ttu-id="ff51a-245">Lorsque les noms des deux partenaires sont disponibles, si le délai d'expiration de connexion est illimité, le client tente de se reconnecter indéfiniment aux serveurs, en alternant entre le nom du partenaire initial et le nom du partenaire de basculement.</span><span class="sxs-lookup"><span data-stu-id="ff51a-245">When both partner names are available, if the login time-out period is infinite, the client attempts to reconnect to the servers indefinitely, alternating between the initial partner name and the failover partner name.</span></span>  
<span data-ttu-id="ff51a-246">)</span><span class="sxs-lookup"><span data-stu-id="ff51a-246">)</span></span>  
  
### <a name="retry-delays-during-failover"></a><span data-ttu-id="ff51a-247">Délais entre deux tentatives lors d'un basculement</span><span class="sxs-lookup"><span data-stu-id="ff51a-247">Retry Delays During Failover</span></span>  
 <span data-ttu-id="ff51a-248">Si un client tente de se connecter à un partenaire qui fait l'objet d'un basculement, le partenaire répond immédiatement qu'il est inactif.</span><span class="sxs-lookup"><span data-stu-id="ff51a-248">If a client attempts to connect to a partner that is failing over, the partner immediately responds that it is inactive.</span></span> <span data-ttu-id="ff51a-249">Dans ce cas, chaque nouvelle tentative de connexion est beaucoup plus brève que le délai imparti entre deux tentatives.</span><span class="sxs-lookup"><span data-stu-id="ff51a-249">In this case, each round of connection attempts are much briefer than the allotted retry time.</span></span> <span data-ttu-id="ff51a-250">Ceci signifie que de nombreux essais de connexion peuvent survenir avant l'expiration du délai de connexion. Pour éviter que les partenaires ne soient surchargés par une série rapide de tentatives de connexion lors d'un basculement, le fournisseur d'accès aux données ajoute un délai court entre deux tentatives après chaque cycle.</span><span class="sxs-lookup"><span data-stu-id="ff51a-250">This means that many rounds of connection attempts could happen before the login period times out. To avoid overloading the partners with a rapid series of connection attempts during a failover, the data access provider adds a brief retry delay after each retry cycle.</span></span> <span data-ttu-id="ff51a-251">La durée d'un délai entre deux tentatives est déterminée par l'algorithme de délai entre deux tentatives.</span><span class="sxs-lookup"><span data-stu-id="ff51a-251">The length of a given retry delay is determined by the retry-delay algorithm.</span></span> <span data-ttu-id="ff51a-252">Après le premier essai, le délai est de 100 millisecondes.</span><span class="sxs-lookup"><span data-stu-id="ff51a-252">After the first round, the delay is 100 milliseconds.</span></span> <span data-ttu-id="ff51a-253">Après chacun des trois essais suivants, le délai entre deux tentatives est multiplié par deux : 200, 400 et 800.</span><span class="sxs-lookup"><span data-stu-id="ff51a-253">After each of the next three rounds, the retry delay doubles-to 200, 400, and 800.</span></span> <span data-ttu-id="ff51a-254">Pour tous les essais ultérieurs, le délai entre deux tentatives est de 1 seconde tant que la tentative de connexion n'a pas réussi ou que le délai n'a pas expiré.</span><span class="sxs-lookup"><span data-stu-id="ff51a-254">For all later rounds, the retry delay is 1 second until the connection attempt succeeds or times out.</span></span>  
  
> [!NOTE]  
>  <span data-ttu-id="ff51a-255">Si l'instance de serveur n'est pas arrêtée, la demande de connexion échoue immédiatement.</span><span class="sxs-lookup"><span data-stu-id="ff51a-255">If the server instance is stopped, then the connection request fails immediately.</span></span>  
  
 <span data-ttu-id="ff51a-256">Le tableau suivant illustre l'incidence du délai entre deux tentatives de connexion lors d'un basculement manuel dans lequel les partenaires intervertissent leur rôle.</span><span class="sxs-lookup"><span data-stu-id="ff51a-256">The following figure illustrates how the retry delay affects connection attempts during a manual failover, in which the partners switch their roles.</span></span> <span data-ttu-id="ff51a-257">Le délai d'expiration de connexion est de 15 secondes.</span><span class="sxs-lookup"><span data-stu-id="ff51a-257">The login time-out period is 15 seconds.</span></span>  
  
 <span data-ttu-id="ff51a-258">![Algorithme de délai entre reprises](../media/dbm-retry-delay-algorithm.gif "Algorithme de délai entre reprises")</span><span class="sxs-lookup"><span data-stu-id="ff51a-258">![Retry-delay algorithm](../media/dbm-retry-delay-algorithm.gif "Retry-delay algorithm")</span></span>  
  
##  <a name="reconnecting-to-a-database-mirroring-session"></a><a name="Reconnecting"></a> <span data-ttu-id="ff51a-259">Reconnexion à une session de mise en miroir de bases de données</span><span class="sxs-lookup"><span data-stu-id="ff51a-259">Reconnecting to a Database Mirroring Session</span></span>  
 <span data-ttu-id="ff51a-260">Si une connexion établie à une session de mise en miroir de bases de données échoue pour une raison quelconque, par exemple suite au basculement de mise en miroir de bases de données, et que l'application tente de se reconnecter au serveur initial, le fournisseur d'accès aux données peut essayer de se reconnecter à l'aide du nom du partenaire de basculement stocké dans le cache du client.</span><span class="sxs-lookup"><span data-stu-id="ff51a-260">If an established connection to a database mirroring session fails for any reason, for example, due to a database mirroring failover, and the application attempts to reconnect to the initial server, the data access provider can attempt to reconnect using the failover partner name stored in the client's cache.</span></span> <span data-ttu-id="ff51a-261">La reconnexion n'est cependant pas automatique.</span><span class="sxs-lookup"><span data-stu-id="ff51a-261">Reconnecting is not automatic, however.</span></span> <span data-ttu-id="ff51a-262">L'application doit avoir connaissance de l'erreur.</span><span class="sxs-lookup"><span data-stu-id="ff51a-262">The application must become aware of the error.</span></span> <span data-ttu-id="ff51a-263">Ensuite, elle doit fermer la connexion qui a échoué et en ouvrir une nouvelle à l'aide des mêmes attributs de chaîne de connexion.</span><span class="sxs-lookup"><span data-stu-id="ff51a-263">Then, the application needs to close the failed connection and open a new connection using the same connection string attributes.</span></span> <span data-ttu-id="ff51a-264">À ce stade, le fournisseur d'accès aux données redirige la connexion vers le partenaire de basculement.</span><span class="sxs-lookup"><span data-stu-id="ff51a-264">At this point, the data access provider redirects the connection to the failover partner.</span></span> <span data-ttu-id="ff51a-265">Si l'instance de serveur identifiée par ce nom est actuellement le serveur principal, la tentative de connexion réussit en général.</span><span class="sxs-lookup"><span data-stu-id="ff51a-265">If the server instance identified by this name is currently the principal server, the connection attempt usually succeeds.</span></span> <span data-ttu-id="ff51a-266">S'il est incertain si une transaction a été validée ou restaurée, l'application doit vérifier son état, de la même façon que lors de la reconnexion à une instance de serveur autonome.</span><span class="sxs-lookup"><span data-stu-id="ff51a-266">If it is unclear whether a transaction was committed or rolled back, the application must check on the state of the transaction, in the same way as when reconnecting to a stand-alone server instance.</span></span>  
  
 <span data-ttu-id="ff51a-267">La reconnexion s'apparente à une connexion initiale pour laquelle la chaîne de connexion a fourni un nom de partenaire de basculement.</span><span class="sxs-lookup"><span data-stu-id="ff51a-267">Reconnecting resembles an initial connection for which the connection string supplied a failover partner name.</span></span> <span data-ttu-id="ff51a-268">Si la première tentative de connexion échoue, les tentatives de connexion alternent entre le nom du partenaire initial et le nom du partenaire de basculement jusqu'à ce que le client se connecte au serveur principal ou que le délai d'attente du fournisseur d'accès aux données soit atteint.</span><span class="sxs-lookup"><span data-stu-id="ff51a-268">If the first connection attempt fails, connection attempts alternate back and forth between the initial partner name and failover partner name until either the client connects to the  principal server or the data access provider times out.</span></span>  
  
> [!NOTE]  
>  [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] <span data-ttu-id="ff51a-269">Native Client vérifie qu’il se connecte à une instance de serveur principal, mais ne vérifie pas si cette instance est le serveur partenaire de l’instance de serveur spécifiée dans le nom de serveur partenaire initial de la chaîne de connexion.</span><span class="sxs-lookup"><span data-stu-id="ff51a-269">Native Client verifies that it connects to a principal server instance but not whether this instance is the partner of server instance specified in the initial partner name of the connection string.</span></span>  
  
 <span data-ttu-id="ff51a-270">Si les connexions utilisent TCP/IP, l'algorithme de délai entre deux tentatives de connexion détermine la durée allouée aux tentatives de connexion à chaque cycle.</span><span class="sxs-lookup"><span data-stu-id="ff51a-270">If the connections use TCP/IP, the connection retry algorithm determines the amount of time allotted to the connection attempts in each round.</span></span>  
  
> [!IMPORTANT]  
>  <span data-ttu-id="ff51a-271">Si le client se retrouve déconnecté de la base de données, le fournisseur d'accès aux données n'essaie pas de se reconnecter.</span><span class="sxs-lookup"><span data-stu-id="ff51a-271">If the client gets disconnected from the database, the data access provider does not attempt to reconnect.</span></span> <span data-ttu-id="ff51a-272">Le client doit faire une nouvelle demande de connexion.</span><span class="sxs-lookup"><span data-stu-id="ff51a-272">The client must issue a new connection request.</span></span> <span data-ttu-id="ff51a-273">De plus, si une application s'arrête suite à la perte de la connexion, elle perd les noms de partenaire mis en cache.</span><span class="sxs-lookup"><span data-stu-id="ff51a-273">Also, if an application shuts down on losing the connection, it will lose the cached partner names.</span></span> <span data-ttu-id="ff51a-274">Si la perte de la connexion est due à l'indisponibilité soudaine du serveur principal, la seule solution pour l'application de se reconnecter au serveur miroir consiste à fournir le nom du partenaire de basculement dans sa chaîne de connexion.</span><span class="sxs-lookup"><span data-stu-id="ff51a-274">If the connection was lost because the principal server became unavailable, the only way that the application can reconnect to the mirror server is by supplying the failover partner name in its connection string.</span></span>  
  
  
### <a name="impact-of-redirection-on-a-client-application"></a><span data-ttu-id="ff51a-275">Impact de la redirection sur une application cliente</span><span class="sxs-lookup"><span data-stu-id="ff51a-275">Impact of Redirection on a Client Application</span></span>  
 <span data-ttu-id="ff51a-276">Après un basculement, le fournisseur d'accès aux données redirige la connexion vers l'instance de serveur principal actuelle.</span><span class="sxs-lookup"><span data-stu-id="ff51a-276">After a failover, the data access provider redirects the connection to the current principal server instance.</span></span> <span data-ttu-id="ff51a-277">La redirection est cependant transparente pour les clients.</span><span class="sxs-lookup"><span data-stu-id="ff51a-277">However, the redirection is transparent to clients.</span></span> <span data-ttu-id="ff51a-278">Pour un client, une connexion redirigée semble être une connexion à l'instance de serveur identifiée par le nom de partenaire initial.</span><span class="sxs-lookup"><span data-stu-id="ff51a-278">To a client, a redirected connection appears to be a connection to the server instance identified by the initial partner name.</span></span> <span data-ttu-id="ff51a-279">Lorsque le partenaire initial est actuellement le serveur miroir, le client peut sembler être connecté au serveur miroir et mettre à jour la base de données miroir.</span><span class="sxs-lookup"><span data-stu-id="ff51a-279">When the initial partner is currently the mirror server, the client can appear to be connected to the mirror server and updating the mirror database.</span></span> <span data-ttu-id="ff51a-280">En réalité, le client a été redirigé vers le partenaire de basculement (qui est la base de données principale actuelle) et il met à jour la nouvelle base de données principale.</span><span class="sxs-lookup"><span data-stu-id="ff51a-280">Actually, however, the client has been redirected to the failover partner, which is the current principal database, and the client is updating the new principal database.</span></span>  
  
 <span data-ttu-id="ff51a-281">Après avoir été redirigé vers le partenaire de basculement, un client peut rencontrer des résultats inattendus lors de l'utilisation d'une instruction [!INCLUDE[tsql](../../includes/tsql-md.md)] USE pour utiliser une base de données différente.</span><span class="sxs-lookup"><span data-stu-id="ff51a-281">After being redirected to the failover partner, a client can experience unexpected results when using a [!INCLUDE[tsql](../../includes/tsql-md.md)] USE statement to use a different database.</span></span> <span data-ttu-id="ff51a-282">Cela peut se produire si l'instance de serveur principal actuelle (le partenaire de basculement) possède un ensemble de bases de données différent du serveur principal d'origine (le partenaire initial).</span><span class="sxs-lookup"><span data-stu-id="ff51a-282">This can happen if the current principal server instance (the failover partner) has a different set of databases than the original principal server (the initial partner).</span></span>  
  
##  <a name="the-impact-of-a-stale-failover-partner-name"></a><a name="StalePartnerName"></a> <span data-ttu-id="ff51a-283">Impact d'un nom de partenaire de basculement obsolète</span><span class="sxs-lookup"><span data-stu-id="ff51a-283">The Impact of a Stale Failover Partner Name</span></span>  
 <span data-ttu-id="ff51a-284">L'administrateur de base de données peut modifier le partenaire de basculement à tout moment.</span><span class="sxs-lookup"><span data-stu-id="ff51a-284">The database administrator can change the failover partner at any time.</span></span> <span data-ttu-id="ff51a-285">C’est pourquoi un nom de partenaire de basculement fourni par le client peut être périmé ou *obsolète*.</span><span class="sxs-lookup"><span data-stu-id="ff51a-285">Therefore, a client-supplied failover partner name might be out of date, or *stale*.</span></span> <span data-ttu-id="ff51a-286">Prenons par exemple un partenaire de basculement nommé Partner_B qui est remplacé par une autre instance de serveur nommée Partner_C.</span><span class="sxs-lookup"><span data-stu-id="ff51a-286">For example, consider a failover partner named Partner_B that is replaced by another server instance, Partner_C.</span></span> <span data-ttu-id="ff51a-287">Si un client fournit Partner_B comme nom de partenaire de basculement, ce nom est obsolète.</span><span class="sxs-lookup"><span data-stu-id="ff51a-287">Now, if a client supplies Partner_B as the failover partner name, that name is stale.</span></span> <span data-ttu-id="ff51a-288">Quand le nom du partenaire de basculement fourni par le client est obsolète, le comportement du fournisseur d'accès aux données est identique à celui adopté lorsque le nom du partenaire de basculement n'est pas fourni par le client.</span><span class="sxs-lookup"><span data-stu-id="ff51a-288">When the client-supplied failover partner name is stale, the behavior of the data access provider equates to the case in which a failover partner name is not supplied by the client.</span></span>  
  
 <span data-ttu-id="ff51a-289">Par exemple, imaginons une situation dans laquelle un client utilise une chaîne de connexion unique pour une série de quatre tentatives de connexion.</span><span class="sxs-lookup"><span data-stu-id="ff51a-289">For example, consider situation in which a client uses one connection string for a series of four connection attempts.</span></span> <span data-ttu-id="ff51a-290">Dans la chaîne de connexion, le nom du serveur partenaire initial est Partner_A et le nom du partenaire de basculement est Partner_B :</span><span class="sxs-lookup"><span data-stu-id="ff51a-290">In the connection string, the initial partner name is Partner_A, and the failover partner name is Partner_B:</span></span>  
  
```  
"Server=Partner_A; Failover Partner=Partner_B; Database=AdventureWorks"  
```  
  
 <span data-ttu-id="ff51a-291">Le tableau suivant représente quatre configurations de partenaire et indique pour chacune d'entre elles si la chaîne de connexion permet ou non de connecter le client la première fois.</span><span class="sxs-lookup"><span data-stu-id="ff51a-291">The following table shows four partner configurations and indicates for each whether this connection string works for connecting the client for the first time.</span></span>  
  
> [!NOTE]  
>  <span data-ttu-id="ff51a-292">Une application peut assurer le suivi des modifications de configuration et modifier sa chaîne de connexion en conséquence.</span><span class="sxs-lookup"><span data-stu-id="ff51a-292">An application can track configuration changes and change its connection string accordingly.</span></span> <span data-ttu-id="ff51a-293">Cela demande d'ajouter du code supplémentaire mais réduit la charge administrative.</span><span class="sxs-lookup"><span data-stu-id="ff51a-293">This requires extra code but reduces the administrative burden.</span></span>  
  
|<span data-ttu-id="ff51a-294">Configuration</span><span class="sxs-lookup"><span data-stu-id="ff51a-294">Configuration</span></span>|<span data-ttu-id="ff51a-295">Serveur principal</span><span class="sxs-lookup"><span data-stu-id="ff51a-295">Principal server</span></span>|<span data-ttu-id="ff51a-296">Serveur miroir</span><span class="sxs-lookup"><span data-stu-id="ff51a-296">Mirror server</span></span>|<span data-ttu-id="ff51a-297">Comportement lors de la tentative de connexion en spécifiant Partner_A et Partner_B</span><span class="sxs-lookup"><span data-stu-id="ff51a-297">Behavior when attempting to connect specifying Partner_A and Partner_B</span></span>|  
|-------------------|----------------------|-------------------|------------------------------------------------------------------------------|  
|<span data-ttu-id="ff51a-298">Configuration de la mise en miroir de départ.</span><span class="sxs-lookup"><span data-stu-id="ff51a-298">Original mirroring configuration.</span></span>|<span data-ttu-id="ff51a-299">Partner_A</span><span class="sxs-lookup"><span data-stu-id="ff51a-299">Partner_A</span></span>|<span data-ttu-id="ff51a-300">Partner_B</span><span class="sxs-lookup"><span data-stu-id="ff51a-300">Partner_B</span></span>|<span data-ttu-id="ff51a-301">Partner_A est mis en cache en tant que nom du partenaire initial.</span><span class="sxs-lookup"><span data-stu-id="ff51a-301">Partner_A is cached as the initial partner name.</span></span> <span data-ttu-id="ff51a-302">Le client réussit à se connecter à Partner_A.</span><span class="sxs-lookup"><span data-stu-id="ff51a-302">The client succeeds in connecting to Partner_A.</span></span> <span data-ttu-id="ff51a-303">Le client télécharge le nom du serveur miroir, Partner_B, et le met en cache en ignorant le nom du partenaire de basculement fourni par le client.</span><span class="sxs-lookup"><span data-stu-id="ff51a-303">The client downloads the name of mirror server, Partner_B, and caches it, ignoring the client-supplied failover partner name.</span></span>|  
|<span data-ttu-id="ff51a-304">Partner_A subit une défaillance matérielle et un basculement a lieu (suivi d'une déconnexion des clients).</span><span class="sxs-lookup"><span data-stu-id="ff51a-304">Partner_A experiences a hardware failure, and failover occurs (disconnecting clients).</span></span>|<span data-ttu-id="ff51a-305">Partner_B</span><span class="sxs-lookup"><span data-stu-id="ff51a-305">Partner_B</span></span>|<span data-ttu-id="ff51a-306">Aucun</span><span class="sxs-lookup"><span data-stu-id="ff51a-306">none</span></span>|<span data-ttu-id="ff51a-307">Partner_A est toujours mis en cache comme nom de partenaire initial, mais le nom de partenaire de basculement fourni par le client, Partner_B, permet au client de se connecter au serveur principal actuel.</span><span class="sxs-lookup"><span data-stu-id="ff51a-307">The Partner_A is still cached as the initial partner name, but the client-supplied failover partner name, Partner_B, permits the client to connect to the current principal server.</span></span>|  
|<span data-ttu-id="ff51a-308">L'administrateur de base de données arrête la mise en miroir (et déconnecte les clients), remplace Partner_A par Partner_C et redémarre la mise en miroir.</span><span class="sxs-lookup"><span data-stu-id="ff51a-308">The database administrator stops mirroring (disconnecting clients), replaces Partner_A with Partner_C, and restarts mirroring.</span></span>|<span data-ttu-id="ff51a-309">Partner_B</span><span class="sxs-lookup"><span data-stu-id="ff51a-309">Partner_B</span></span>|<span data-ttu-id="ff51a-310">Partner_C</span><span class="sxs-lookup"><span data-stu-id="ff51a-310">Partner_C</span></span>|<span data-ttu-id="ff51a-311">Le client essaie de se connecter à Partner_A sans succès. Ensuite, il essaie avec Partner_B (le serveur principal actuel) et sa tentative aboutit.</span><span class="sxs-lookup"><span data-stu-id="ff51a-311">The client attempts to connect to Partner_A and fails; then the client tries Partner_B (the current principal server) and succeeds.</span></span> <span data-ttu-id="ff51a-312">Le fournisseur d'accès aux données télécharge le nom du serveur miroir actuel, Partner_C, et le met en cache comme nom de partenaire de basculement.</span><span class="sxs-lookup"><span data-stu-id="ff51a-312">The data access provider downloads the name of the current mirror server, Partner_C, and caches it as the current failover partner name.</span></span>|  
|<span data-ttu-id="ff51a-313">Le service est manuellement basculé vers Partner_C (déconnexion des clients).</span><span class="sxs-lookup"><span data-stu-id="ff51a-313">Service is manually failed over to Partner_C (disconnecting clients).</span></span>|<span data-ttu-id="ff51a-314">Partner_C</span><span class="sxs-lookup"><span data-stu-id="ff51a-314">Partner_C</span></span>|<span data-ttu-id="ff51a-315">Partner_B</span><span class="sxs-lookup"><span data-stu-id="ff51a-315">Partner_B</span></span>|<span data-ttu-id="ff51a-316">Le client tente tout d'abord de se connecter à Partner_A, puis à Partner_B.</span><span class="sxs-lookup"><span data-stu-id="ff51a-316">Client attempts to connect to Partner_A initially, and then to Partner_B.</span></span> <span data-ttu-id="ff51a-317">Ces deux noms échouent et la demande de connexion finit par expirer et par échouer.</span><span class="sxs-lookup"><span data-stu-id="ff51a-317">Both names fail, and eventually the connection request times out and fails.</span></span>|  
  
## <a name="see-also"></a><span data-ttu-id="ff51a-318">Voir aussi</span><span class="sxs-lookup"><span data-stu-id="ff51a-318">See Also</span></span>  
 <span data-ttu-id="ff51a-319">[Mise en miroir de bases de données &#40;SQL Server&#41;](database-mirroring-sql-server.md) </span><span class="sxs-lookup"><span data-stu-id="ff51a-319">[Database Mirroring &#40;SQL Server&#41;](database-mirroring-sql-server.md) </span></span>  
 [<span data-ttu-id="ff51a-320">Défaillances possibles pendant la mise en miroir d’une base de données</span><span class="sxs-lookup"><span data-stu-id="ff51a-320">Possible Failures During Database Mirroring</span></span>](possible-failures-during-database-mirroring.md)  
  
  
