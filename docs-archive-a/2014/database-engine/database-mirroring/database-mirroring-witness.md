---
title: Témoin de mise en miroir de base de données | Microsoft Docs
ms.custom: ''
ms.date: 06/13/2017
ms.prod: sql-server-2014
ms.reviewer: ''
ms.technology: high-availability
ms.topic: conceptual
helpviewer_keywords:
- witness [SQL Server], about witness
- witness [SQL Server]
- database mirroring [SQL Server], witness
ms.assetid: 05606de8-90c3-451a-938d-1ed34211dad7
author: MikeRayMSFT
ms.author: mikeray
ms.openlocfilehash: 6ac02e2a5dbe86af72c15c07e14de70b12892b48
ms.sourcegitcommit: ad4d92dce894592a259721a1571b1d8736abacdb
ms.translationtype: MT
ms.contentlocale: fr-FR
ms.lasthandoff: 08/04/2020
ms.locfileid: "87601659"
---
# <a name="database-mirroring-witness"></a><span data-ttu-id="e1854-102">Témoin de mise en miroir de base de données</span><span class="sxs-lookup"><span data-stu-id="e1854-102">Database Mirroring Witness</span></span>
  <span data-ttu-id="e1854-103">Pour permettre la prise en charge du basculement automatique, une session de mise en miroir de bases de données doit être configurée en mode haute sécurité et disposer d’une troisième instance de serveur, appelée *témoin*.</span><span class="sxs-lookup"><span data-stu-id="e1854-103">To support automatic failover, a database mirroring session must be configured in high-safety mode and also possess a third server instance, known as the *witness*.</span></span> <span data-ttu-id="e1854-104">Le témoin correspond à une instance facultative de [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] qui active le serveur miroir dans une session en mode haute sécurité pour déterminer s'il est nécessaire d'initier un basculement automatique.</span><span class="sxs-lookup"><span data-stu-id="e1854-104">The witness is an optional instance of [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] that enables the mirror server in a high-safety mode session to recognize whether to initiate an automatic failover.</span></span> <span data-ttu-id="e1854-105">Contrairement aux deux autres, le témoin ne dessert pas la base de données.</span><span class="sxs-lookup"><span data-stu-id="e1854-105">Unlike the two partners, the witness does not serve the database.</span></span> <span data-ttu-id="e1854-106">La prise en charge du basculement automatique est le seul rôle rempli par le témoin.</span><span class="sxs-lookup"><span data-stu-id="e1854-106">Supporting automatic failover is the only role of the witness.</span></span>  
  
> [!NOTE]  
>  <span data-ttu-id="e1854-107">En mode haute sécurité, le témoin peut avoir une influence négative sur la disponibilité.</span><span class="sxs-lookup"><span data-stu-id="e1854-107">In high-performance mode, the witness can adversely affect availability.</span></span> <span data-ttu-id="e1854-108">Si un témoin est configuré pour une session de mise en miroir de base de données, le serveur principal doit être connecté à au moins une des autres instances de serveur, le serveur miroir ou le témoin, ou les deux.</span><span class="sxs-lookup"><span data-stu-id="e1854-108">If a witness is configured for a database mirroring session, the principal server must be connected at least to one of the other server instances, the mirror server or the witness, or both of them.</span></span> <span data-ttu-id="e1854-109">Sinon, la base de données n'est plus disponible et forcer le service (perte de données possible) est impossible.</span><span class="sxs-lookup"><span data-stu-id="e1854-109">Otherwise, the database becomes unavailable and forcing service (with possible data loss) is impossible.</span></span> <span data-ttu-id="e1854-110">Par conséquent, en mode haute performance, il est fortement recommandé de toujours conserver le témoin défini sur OFF.</span><span class="sxs-lookup"><span data-stu-id="e1854-110">Therefore, for high-performance mode, we strongly recommend that you always keep the witness set to OFF.</span></span> <span data-ttu-id="e1854-111">Pour plus d’informations sur l’incidence d’un témoin sur le mode hautes performances, consultez [Modes de fonctionnement de la mise en miroir de bases de données](database-mirroring-operating-modes.md).</span><span class="sxs-lookup"><span data-stu-id="e1854-111">For information about the impact of a witness on high-performance mode, see [Database Mirroring Operating Modes](database-mirroring-operating-modes.md).</span></span>  
  
 <span data-ttu-id="e1854-112">La figure ci-dessous présente une session en mode haute sécurité avec témoin.</span><span class="sxs-lookup"><span data-stu-id="e1854-112">The following illustration shows a high-safety mode session with a witness.</span></span>  
  
 <span data-ttu-id="e1854-113">![Session de mise en miroir avec un témoin](../media/dbm-3-way-session-intro.gif "Session de mise en miroir avec un témoin")</span><span class="sxs-lookup"><span data-stu-id="e1854-113">![Mirroring session with a witness](../media/dbm-3-way-session-intro.gif "Mirroring session with a witness")</span></span>  
  
 <span data-ttu-id="e1854-114">**Dans cette rubrique :**</span><span class="sxs-lookup"><span data-stu-id="e1854-114">**In This Topic:**</span></span>  
  
-   [<span data-ttu-id="e1854-115">Utilisation d'un témoin dans plusieurs sessions</span><span class="sxs-lookup"><span data-stu-id="e1854-115">Using a Witness in Multiple Sessions</span></span>](#InMultipleSessions)  
  
-   [<span data-ttu-id="e1854-116">Recommandations logicielles et matérielles</span><span class="sxs-lookup"><span data-stu-id="e1854-116">Software and Hardware Recommendations</span></span>](#SwHwRecommendations)  
  
-   [<span data-ttu-id="e1854-117">Rôle du témoin en basculement automatique</span><span class="sxs-lookup"><span data-stu-id="e1854-117">Role of the Witness in Automatic Failover</span></span>](#InAutoFo)  
  
-   [<span data-ttu-id="e1854-118">Pour ajouter ou supprimer un témoin</span><span class="sxs-lookup"><span data-stu-id="e1854-118">To Add or Remove a Witness</span></span>](#AddRemoveWitness)  
  
##  <a name="using-a-witness-in-multiple-sessions"></a><a name="InMultipleSessions"></a> <span data-ttu-id="e1854-119">Utilisation d'un témoin dans plusieurs sessions</span><span class="sxs-lookup"><span data-stu-id="e1854-119">Using a Witness in Multiple Sessions</span></span>  
 <span data-ttu-id="e1854-120">Une instance du serveur spécifique peut servir de témoin dans des sessions de mise en miroir de base de données simultanées, à raison d'une session par base de données différente.</span><span class="sxs-lookup"><span data-stu-id="e1854-120">A specific server instance can act as a witness in concurrent database mirroring sessions, each for a different database.</span></span> <span data-ttu-id="e1854-121">Différentes sessions ont lieu avec différents partenaires.</span><span class="sxs-lookup"><span data-stu-id="e1854-121">Different sessions can be with different partners.</span></span> <span data-ttu-id="e1854-122">L'illustration suivante montre une instance de serveur témoin qui participe à deux sessions de mise en miroir de base de données avec différents partenaires.</span><span class="sxs-lookup"><span data-stu-id="e1854-122">The following illustration shows a server instance that is a witness in two database mirroring sessions with different partners.</span></span>  
  
 <span data-ttu-id="e1854-123">![Instance de serveur témoin pour 2 bases de données](../media/dbm-witness-in-2-sessions.gif "Instance de serveur témoin pour 2 bases de données")</span><span class="sxs-lookup"><span data-stu-id="e1854-123">![Server instance that is a witness for 2 databases](../media/dbm-witness-in-2-sessions.gif "Server instance that is a witness for 2 databases")</span></span>  
  
 <span data-ttu-id="e1854-124">Une même instance de serveur peut également fonctionner simultanément en tant que témoin au sein de certaines sessions et en tant que partenaire au sein d'autres sessions.</span><span class="sxs-lookup"><span data-stu-id="e1854-124">A single-server instance can also function at the same time as a witness in some sessions and a partner in other sessions.</span></span> <span data-ttu-id="e1854-125">En pratique, cependant, une instance de serveur fonctionne typiquement soit en tant que témoin, soit en tant que partenaire.</span><span class="sxs-lookup"><span data-stu-id="e1854-125">However, in practice, a server instance typically functions as either a witness or a partner.</span></span> <span data-ttu-id="e1854-126">La raison en est que les serveurs partenaires nécessitent des ordinateurs sophistiqués disposant d'un niveau de matériel suffisant pour prendre en charge une base de données de production, alors que le serveur témoin peut s'exécuter sur tout système Windows disponible prenant en charge [!INCLUDE[ssCurrent](../../includes/sscurrent-md.md)].</span><span class="sxs-lookup"><span data-stu-id="e1854-126">This is because the partners require sophisticated computers that have enough hardware to support a production database, whereas the witness can run on any available Windows system that supports [!INCLUDE[ssCurrent](../../includes/sscurrent-md.md)].</span></span>  
  
##  <a name="software-and-hardware-recommendations"></a><a name="SwHwRecommendations"></a> <span data-ttu-id="e1854-127">Recommandations logicielles et matérielles</span><span class="sxs-lookup"><span data-stu-id="e1854-127">Software and Hardware Recommendations</span></span>  
 <span data-ttu-id="e1854-128">Nous vous recommandons vivement de placer le témoin sur un ordinateur distinct de celui des partenaires.</span><span class="sxs-lookup"><span data-stu-id="e1854-128">We strongly recommend that the witness reside on a separate computer from the partners.</span></span> <span data-ttu-id="e1854-129">Les serveurs partenaires de mise en miroir de bases de données sont pris en charge uniquement par l'édition [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] Standard et l'édition [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] Enterprise.</span><span class="sxs-lookup"><span data-stu-id="e1854-129">Database mirroring partners are supported only by [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] Standard edition and by [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] Enterprise edition.</span></span> <span data-ttu-id="e1854-130">Les témoins, en revanche, sont également pris en charge dans l'édition [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] Workgroup et l'édition [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] Express.</span><span class="sxs-lookup"><span data-stu-id="e1854-130">Witnesses, in contrast, are also supported by [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] Workgroup and by [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] Express.</span></span> <span data-ttu-id="e1854-131">À l'exception d'une mise à niveau depuis une version antérieure de [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)], les instances de serveur dans une session de mise en miroir doivent toutes exécuter la même version de [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)].</span><span class="sxs-lookup"><span data-stu-id="e1854-131">Except during an upgrade from an earlier version of [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)], the server instances in a mirroring session must all be running the same version of [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)].</span></span> <span data-ttu-id="e1854-132">Par exemple, un témoin [!INCLUDE[ssKatmai](../../includes/sskatmai-md.md)] est pris en charge lorsque vous effectuez une mise à niveau depuis une configuration de mise en miroir [!INCLUDE[ssKatmai](../../includes/sskatmai-md.md)] , mais ne peut pas être ajouté à une configuration de mise en miroir [!INCLUDE[ssKilimanjaro](../../includes/sskilimanjaro-md.md)] ou ultérieure.</span><span class="sxs-lookup"><span data-stu-id="e1854-132">For example, a [!INCLUDE[ssKatmai](../../includes/sskatmai-md.md)] witness is supported when you are upgrading from a [!INCLUDE[ssKatmai](../../includes/sskatmai-md.md)] mirroring configuration but cannot be added to an existing or new [!INCLUDE[ssKilimanjaro](../../includes/sskilimanjaro-md.md)] or later mirroring configuration.</span></span>  
  
 <span data-ttu-id="e1854-133">Un témoin peut s'exécuter sur tout système informatique fiable prenant en charge ces éditions de [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)].</span><span class="sxs-lookup"><span data-stu-id="e1854-133">A witness can run on any reliable computer system that supports any of these editions of [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)].</span></span> <span data-ttu-id="e1854-134">Cependant, nous recommandons que chaque instance de serveur utilisée en tant que témoin soit conforme à la configuration minimale requise pour la version de [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] Standard que vous exécutez.</span><span class="sxs-lookup"><span data-stu-id="e1854-134">However, we recommend that every server instance that is used as a witness correspond to the minimum configuration that is required for the [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] Standard version that you are running.</span></span> <span data-ttu-id="e1854-135">Pour plus d’informations sur ces conditions requises, consultez [configurations matérielle et logicielle requises pour l’installation de SQL Server 2014](../../sql-server/install/hardware-and-software-requirements-for-installing-sql-server.md).</span><span class="sxs-lookup"><span data-stu-id="e1854-135">For more information about these requirements, see [Hardware and Software Requirements for Installing SQL Server 2014](../../sql-server/install/hardware-and-software-requirements-for-installing-sql-server.md).</span></span>  
  
##  <a name="role-of-the-witness-in-automatic-failover"></a><a name="InAutoFo"></a> <span data-ttu-id="e1854-136">Rôle du témoin en basculement automatique</span><span class="sxs-lookup"><span data-stu-id="e1854-136">Role of the Witness in Automatic Failover</span></span>  
 <span data-ttu-id="e1854-137">Pendant tout le déroulement d'une session de mise en miroir d'une base de données, toutes les instances de serveur surveillent l'état de leur connexion.</span><span class="sxs-lookup"><span data-stu-id="e1854-137">Throughout a database mirroring session, all the server instances monitor their connection status.</span></span> <span data-ttu-id="e1854-138">Si les partenaires se déconnectent, ils s'en remettent au témoin pour vérifier qu'un seul d'entre eux sert actuellement la base de données.</span><span class="sxs-lookup"><span data-stu-id="e1854-138">If the partners become disconnected from each other, they rely on the witness to make sure that only one of them is currently serving the database.</span></span> <span data-ttu-id="e1854-139">Si un serveur miroir synchronisé perd sa connexion au serveur principal, mais reste connecté au témoin, le serveur miroir contacte le témoin pour déterminer si le témoin a perdu sa connexion au serveur principal :</span><span class="sxs-lookup"><span data-stu-id="e1854-139">If a synchronized mirror server loses its connection to the principal server but remains connected to the witness, the mirror server contacts the witness to determine whether the witness has lost its connection to the principal server:</span></span>  
  
-   <span data-ttu-id="e1854-140">Si le serveur principal est toujours connecté au témoin, le basculement automatique n'a pas lieu.</span><span class="sxs-lookup"><span data-stu-id="e1854-140">If the principal server is still connected to the witness, automatic failover does not occur.</span></span> <span data-ttu-id="e1854-141">Le serveur principal continue en fait à servir la base de données tout en accumulant les enregistrements du journal à envoyer au serveur miroir lorsque les partenaires se reconnectent.</span><span class="sxs-lookup"><span data-stu-id="e1854-141">Instead, the principal server continues to server the database while accumulating log records to send the mirror server when the partners reconnect.</span></span>  
  
-   <span data-ttu-id="e1854-142">Si le témoin est aussi déconnecté du serveur principal, le serveur miroir détecte que cette base de données principale n'est plus disponible.</span><span class="sxs-lookup"><span data-stu-id="e1854-142">If the witness is also disconnected from the principal server, the mirror server knows that principal database has become unavailable.</span></span> <span data-ttu-id="e1854-143">Dans ce cas, le serveur miroir initie immédiatement un basculement automatique.</span><span class="sxs-lookup"><span data-stu-id="e1854-143">In this case, the mirror server immediately initiates an automatic failover.</span></span>  
  
-   <span data-ttu-id="e1854-144">Si le serveur miroir est déconnecté du témoin ainsi que du serveur principal, le basculement automatique n'est pas possible, indépendamment de l'état du serveur principal.</span><span class="sxs-lookup"><span data-stu-id="e1854-144">If the mirror server is disconnected from the witness and also from the principal server, automatic failover is not possible, regardless of the state of the principal server.</span></span>  
  
 <span data-ttu-id="e1854-145">La condition selon laquelle au moins deux instances de serveur doivent être connectées s’appelle *quorum*.</span><span class="sxs-lookup"><span data-stu-id="e1854-145">The requirement that at least two of the server instances be connected is known as *quorum*.</span></span> <span data-ttu-id="e1854-146">Le quorum garantit que la base de données ne peut être servie que par un seul partenaire à la fois.</span><span class="sxs-lookup"><span data-stu-id="e1854-146">Quorum makes sure that the database can only be served by one partner at a time.</span></span> <span data-ttu-id="e1854-147">Pour plus d’informations sur le fonctionnement du quorum et son impact sur une session, consultez [Quorum : effets d’un témoin sur la disponibilité de la base de données &#40;Mise en miroir de bases de données&#41;](quorum-how-a-witness-affects-database-availability-database-mirroring.md).</span><span class="sxs-lookup"><span data-stu-id="e1854-147">For information about how quorum works and its impact on a session, see [Quorum: How a Witness Affects Database Availability &#40;Database Mirroring&#41;](quorum-how-a-witness-affects-database-availability-database-mirroring.md).</span></span>  
  
##  <a name="to-add-or-remove-a-witness"></a><a name="AddRemoveWitness"></a> <span data-ttu-id="e1854-148">Pour ajouter ou supprimer un témoin</span><span class="sxs-lookup"><span data-stu-id="e1854-148">To Add or Remove a Witness</span></span>  
 <span data-ttu-id="e1854-149">**Pour ajouter un témoin**</span><span class="sxs-lookup"><span data-stu-id="e1854-149">**To add a witness**</span></span>  
  
-   [<span data-ttu-id="e1854-150">Ajouter ou remplacer un témoin de mise en miroir de bases de données &#40;SQL Server Management Studio&#41;</span><span class="sxs-lookup"><span data-stu-id="e1854-150">Add or Replace a Database Mirroring Witness &#40;SQL Server Management Studio&#41;</span></span>](../database-mirroring/add-or-replace-a-database-mirroring-witness-sql-server-management-studio.md)  
  
-   [<span data-ttu-id="e1854-151">Ajouter un témoin de mise en miroir de bases de données à l’aide de l’authentification Windows &#40;Transact-SQL&#41;</span><span class="sxs-lookup"><span data-stu-id="e1854-151">Add a Database Mirroring Witness Using Windows Authentication &#40;Transact-SQL&#41;</span></span>](add-a-database-mirroring-witness-using-windows-authentication-transact-sql.md)  
  
 <span data-ttu-id="e1854-152">**Pour supprimer le témoin**</span><span class="sxs-lookup"><span data-stu-id="e1854-152">**To remove the witness**</span></span>  
  
-   [<span data-ttu-id="e1854-153">Supprimer le témoin d’une session de mise en miroir de bases de données &#40;SQL Server&#41;</span><span class="sxs-lookup"><span data-stu-id="e1854-153">Remove the Witness from a Database Mirroring Session &#40;SQL Server&#41;</span></span>](remove-the-witness-from-a-database-mirroring-session-sql-server.md)  
  
## <a name="see-also"></a><span data-ttu-id="e1854-154">Voir aussi</span><span class="sxs-lookup"><span data-stu-id="e1854-154">See Also</span></span>  
 <span data-ttu-id="e1854-155">[Basculement de rôle durant une session de mise en miroir de bases de données &#40;SQL Server&#41;](role-switching-during-a-database-mirroring-session-sql-server.md) </span><span class="sxs-lookup"><span data-stu-id="e1854-155">[Role Switching During a Database Mirroring Session &#40;SQL Server&#41;](role-switching-during-a-database-mirroring-session-sql-server.md) </span></span>  
 <span data-ttu-id="e1854-156">[Modes de fonctionnement de la mise en miroir de bases de données](database-mirroring-operating-modes.md) </span><span class="sxs-lookup"><span data-stu-id="e1854-156">[Database Mirroring Operating Modes](database-mirroring-operating-modes.md) </span></span>  
 <span data-ttu-id="e1854-157">[Quorum : effets d’un témoin sur la disponibilité de la base de données &#40;Mise en miroir de bases de données&#41;](quorum-how-a-witness-affects-database-availability-database-mirroring.md) </span><span class="sxs-lookup"><span data-stu-id="e1854-157">[Quorum: How a Witness Affects Database Availability &#40;Database Mirroring&#41;](quorum-how-a-witness-affects-database-availability-database-mirroring.md) </span></span>  
 <span data-ttu-id="e1854-158">[Défaillances possibles pendant la mise en miroir de bases de données](possible-failures-during-database-mirroring.md) </span><span class="sxs-lookup"><span data-stu-id="e1854-158">[Possible Failures During Database Mirroring](possible-failures-during-database-mirroring.md) </span></span>  
 [<span data-ttu-id="e1854-159">États de la mise en miroir &#40;SQL Server&#41;</span><span class="sxs-lookup"><span data-stu-id="e1854-159">Mirroring States &#40;SQL Server&#41;</span></span>](mirroring-states-sql-server.md)  
  
  
