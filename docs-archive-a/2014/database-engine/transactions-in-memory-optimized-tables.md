---
title: Transactions dans les tables optimisées en mémoire | Microsoft Docs
ms.custom: ''
ms.date: 03/06/2017
ms.prod: sql-server-2014
ms.reviewer: ''
ms.technology: in-memory-oltp
ms.topic: conceptual
ms.assetid: 2cd07d26-a1f1-4034-8d6f-f196eed1b763
author: stevestein
ms.author: sstein
ms.openlocfilehash: bc9109c7243e609e5ddd820b61386183761167bf
ms.sourcegitcommit: ad4d92dce894592a259721a1571b1d8736abacdb
ms.translationtype: MT
ms.contentlocale: fr-FR
ms.lasthandoff: 08/04/2020
ms.locfileid: "87709832"
---
# <a name="transactions-in-memory-optimized-tables"></a><span data-ttu-id="db333-102">Transactions dans les tables mémoire optimisées</span><span class="sxs-lookup"><span data-stu-id="db333-102">Transactions in Memory-Optimized Tables</span></span>
  <span data-ttu-id="db333-103">Le contrôle de version de ligne des tables sur disque (à l'aide de l'isolation SNAPSHOT ou avec READ_COMMITTED_SNAPSHOT) fournit un type de contrôle d'accès concurrentiel optimiste.</span><span class="sxs-lookup"><span data-stu-id="db333-103">Row versioning on disk-based tables (using SNAPSHOT isolation or READ_COMMITTED_SNAPSHOT) provides a form of optimistic concurrency control.</span></span> <span data-ttu-id="db333-104">Les programmes d'écriture et les programmes de lecture ne se bloquent pas les uns les autres.</span><span class="sxs-lookup"><span data-stu-id="db333-104">Readers and writers do not block each other.</span></span> <span data-ttu-id="db333-105">Avec les tables mémoire optimisées, les programmes d'écriture ne bloquent pas les autres programmes d'écriture.</span><span class="sxs-lookup"><span data-stu-id="db333-105">With memory-optimized tables, writers do not block writers.</span></span> <span data-ttu-id="db333-106">Avec le contrôle de version de ligne pour les tables sur disque, une transaction verrouille la ligne et les transactions concomitantes tentant de mettre à jour cette ligne sont bloquées.</span><span class="sxs-lookup"><span data-stu-id="db333-106">With row versioning on disk-based tables, one transaction locks the row and concurrent transactions attempting to update the row are blocked.</span></span> <span data-ttu-id="db333-107">Il n'existe pas de verrouillage avec les tables mémoire optimisées.</span><span class="sxs-lookup"><span data-stu-id="db333-107">There is no locking with memory-optimized tables.</span></span> <span data-ttu-id="db333-108">En revanche, si deux transactions tentent de mettre à jour la même ligne, un conflit d'écriture/écriture (erreur 41302) se produit.</span><span class="sxs-lookup"><span data-stu-id="db333-108">Instead, if two transactions attempt to update the same row, a write/write conflict (error 41302) will occur.</span></span>

 <span data-ttu-id="db333-109">Contrairement aux tables sur disque, les tables mémoire optimisées permettent le contrôle d'accès concurrentiel optimiste avec les niveaux d'isolation plus élevés, REPEATABLE READ et SERIALIZABLE.</span><span class="sxs-lookup"><span data-stu-id="db333-109">Unlike disk-based tables, memory-optimized tables allow optimistic concurrency control with the higher isolation levels, REPEATABLE READ and SERIALIZABLE.</span></span> <span data-ttu-id="db333-110">Les verrous ne sont pas utilisés pour appliquer les niveaux d'isolation.</span><span class="sxs-lookup"><span data-stu-id="db333-110">Locks are not taken to enforce the isolation levels.</span></span> <span data-ttu-id="db333-111">En revanche, à la fin de la transaction, une validation garantit les hypothèses de sérialisation ou de lecture renouvelable.</span><span class="sxs-lookup"><span data-stu-id="db333-111">Instead, at the end of the transaction validation ensures the repeatable read or serializability assumptions.</span></span> <span data-ttu-id="db333-112">Si les hypothèses ne sont pas respectées, la transaction est arrêtée.</span><span class="sxs-lookup"><span data-stu-id="db333-112">If the assumptions are violated, the transaction is terminated.</span></span> <span data-ttu-id="db333-113">Pour plus d’informations, consultez [Transaction Isolation Levels](../../2014/database-engine/transaction-isolation-levels.md).</span><span class="sxs-lookup"><span data-stu-id="db333-113">For more information, see [Transaction Isolation Levels](../../2014/database-engine/transaction-isolation-levels.md).</span></span>

 <span data-ttu-id="db333-114">Les sémantiques clés des transactions pour les tables mémoire optimisées sont les suivantes :</span><span class="sxs-lookup"><span data-stu-id="db333-114">The important transaction semantics for memory-optimized tables are:</span></span>

-   <span data-ttu-id="db333-115">Contrôles de version multiples</span><span class="sxs-lookup"><span data-stu-id="db333-115">Multi-versioning</span></span>

-   <span data-ttu-id="db333-116">Isolation d'instantané des transactions</span><span class="sxs-lookup"><span data-stu-id="db333-116">Snapshot-based transaction isolation</span></span>

-   <span data-ttu-id="db333-117">Optimistic</span><span class="sxs-lookup"><span data-stu-id="db333-117">Optimistic</span></span>

-   <span data-ttu-id="db333-118">Détection de conflit</span><span class="sxs-lookup"><span data-stu-id="db333-118">Conflict detection</span></span>

 <span data-ttu-id="db333-119">Chacune de ces sémantiques est expliquée dans les sections suivantes.</span><span class="sxs-lookup"><span data-stu-id="db333-119">Each of these semantics is explained in the following sections.</span></span>

## <a name="multi-versioning-in-memory-optimized-tables"></a><span data-ttu-id="db333-120">Contrôles de version multiples dans les tables mémoire optimisées</span><span class="sxs-lookup"><span data-stu-id="db333-120">Multi-Versioning in Memory-Optimized Tables</span></span>
 <span data-ttu-id="db333-121">Les lignes contenues dans les tables mémoire optimisées peuvent avoir plusieurs versions.</span><span class="sxs-lookup"><span data-stu-id="db333-121">Rows in memory-optimized tables can have different versions.</span></span> <span data-ttu-id="db333-122">Les transactions simultanées peuvent donc accéder à des versions différentes d'une même ligne.</span><span class="sxs-lookup"><span data-stu-id="db333-122">Concurrent transactions access potentially different versions of the same row.</span></span>

 <span data-ttu-id="db333-123">Les données de tables mémoire optimisées sont fondées sur la version.</span><span class="sxs-lookup"><span data-stu-id="db333-123">Memory-optimized table data is version-based.</span></span> <span data-ttu-id="db333-124">Chaque ligne peut avoir plusieurs versions, valides à différents moments.</span><span class="sxs-lookup"><span data-stu-id="db333-124">For any row there may be different row versions that are valid at different points in time.</span></span> <span data-ttu-id="db333-125">Les tables sur disque conservent des versions de ligne différentes lorsque l'option READ_COMMITTED_SNAPSHOT ou ALLOW_SNAPSHOT_ISOLATION est activée (ON).</span><span class="sxs-lookup"><span data-stu-id="db333-125">Disk-based tables maintain different row versions when READ_COMMITTED_SNAPSHOT or ALLOW_SNAPSHOT_ISOLATION is ON.</span></span> <span data-ttu-id="db333-126">Les tables mémoire optimisées conservent toujours des versions de ligne différentes, même si les options READ_COMMITTED_SNAPSHOT et ALLOW_SNAPSHOT_ISOLATION sont désactivées (OFF).</span><span class="sxs-lookup"><span data-stu-id="db333-126">Memory-optimized tables maintain different row versions, even if READ_COMMITTED_SNAPSHOT and ALLOW_SNAPSHOT_ISOLATION are OFF.</span></span> <span data-ttu-id="db333-127">Les versions de ligne des tables mémoire optimisées ne sont pas conservées dans tempdb.</span><span class="sxs-lookup"><span data-stu-id="db333-127">The row versions of memory-optimized tables are not maintained in tempdb.</span></span> <span data-ttu-id="db333-128">En revanche, elles sont conservées en ligne, dans les structures de données mémoire optimisées qui stockent les lignes en mémoire.</span><span class="sxs-lookup"><span data-stu-id="db333-128">Instead, the row versions are maintained in-line, as part of the memory-optimized data structures storing the rows in memory.</span></span>

## <a name="snapshot-based-transaction-isolation-for-memory-optimized-tables"></a><span data-ttu-id="db333-129">Isolation d'instantané des transactions pour les tables mémoire optimisées</span><span class="sxs-lookup"><span data-stu-id="db333-129">Snapshot-Based Transaction Isolation for Memory-Optimized Tables</span></span>
 <span data-ttu-id="db333-130">Toutes les opérations d'une même transaction utilisent le même instantané cohérent du point de vue transactionnel des tables mémoire optimisées.</span><span class="sxs-lookup"><span data-stu-id="db333-130">All operations in a single transaction use the same transactionally-consistent snapshot of the memory-optimized tables.</span></span> <span data-ttu-id="db333-131">Tous les niveaux d'isolation des transactions pour les tables mémoire optimisées sont basés sur un instantané.</span><span class="sxs-lookup"><span data-stu-id="db333-131">All transaction isolation for memory-optimized tables is snapshot-based.</span></span> <span data-ttu-id="db333-132">Par exemple, une transaction utilisant le niveau d'isolation SERIALIZABLE pour accéder aux tables mémoire optimisées exécute toutes les opérations dans le même instantané cohérent d'un point de vue transactionnel.</span><span class="sxs-lookup"><span data-stu-id="db333-132">For example, a transaction using the serializable isolation level to access memory-optimized tables will perform all operations on the same transactionally consistent snapshot.</span></span>

 <span data-ttu-id="db333-133">Les transactions qui accèdent aux tables mémoire optimisées utilisent le contrôle de version de ligne pour obtenir un instantané, cohérent d'un point de vue transactionnel, des lignes contenues dans les tables.</span><span class="sxs-lookup"><span data-stu-id="db333-133">Transactions that access memory-optimized tables use this row versioning to obtain a transactionally consistent snapshot of the rows in the tables.</span></span> <span data-ttu-id="db333-134">Les données lues par n'importe quelle instruction dans la transaction représenteront la version cohérente d'un point de vue transactionnel des données qui existaient au début de la transaction.</span><span class="sxs-lookup"><span data-stu-id="db333-134">The data read by any statement in the transaction will be the transactionally consistent version of the data that existed at the time the transaction started.</span></span> <span data-ttu-id="db333-135">Par conséquent, les modifications éventuelles apportées par d'autres transactions qui s'exécutent simultanément ne sont pas visibles par les instructions de la transaction actuelle.</span><span class="sxs-lookup"><span data-stu-id="db333-135">Therefore, any modifications made by concurrently running transactions are not visible to statements in the current transaction.</span></span>

## <a name="optimistic-concurrency-control-for-memory-optimized-tables"></a><span data-ttu-id="db333-136">Contrôle d'accès concurrentiel optimiste pour les tables mémoire optimisées</span><span class="sxs-lookup"><span data-stu-id="db333-136">Optimistic Concurrency Control for Memory-Optimized Tables</span></span>
 <span data-ttu-id="db333-137">Les conflits et les erreurs sont rares. Les transactions sur les tables mémoire optimisées partent du principe qu'il n'y a aucun conflit avec d'autres transactions simultanées et que les opérations se déroulent sans problème.</span><span class="sxs-lookup"><span data-stu-id="db333-137">Conflicts and failures are rare and transactions on memory-optimized tables assume there are no conflicts with concurrent transactions and operations succeed.</span></span> <span data-ttu-id="db333-138">Les transactions n'utilisent pas de verrous ni de verrous internes sur la table mémoire optimisée pour garantir leur isolation.</span><span class="sxs-lookup"><span data-stu-id="db333-138">Transactions do not take locks or latches on memory-optimized table to guarantee transaction isolation.</span></span> <span data-ttu-id="db333-139">Les programmes d'écriture ne bloquent pas les programmes de lecture.</span><span class="sxs-lookup"><span data-stu-id="db333-139">Writers do not block readers.</span></span> <span data-ttu-id="db333-140">Les programmes d'écriture ne bloquent pas les autres programmes d'écriture.</span><span class="sxs-lookup"><span data-stu-id="db333-140">Writers do not block writers.</span></span> <span data-ttu-id="db333-141">En revanche, les transactions se poursuivent dans l'hypothèse (optimiste) qu'il n'y a aucun conflit avec d'autres transactions.</span><span class="sxs-lookup"><span data-stu-id="db333-141">Instead, transactions proceed under the (optimistic) assumption that there will be no conflicts with other transactions.</span></span> <span data-ttu-id="db333-142">Le fait de ne pas utiliser de verrous ou de verrous internes et de ne pas attendre la fin de traitement des mêmes lignes par d'autres transactions améliore les performances.</span><span class="sxs-lookup"><span data-stu-id="db333-142">Not using locks and latches and not waiting for other transactions to finish processing the same rows improves performance.</span></span>

 <span data-ttu-id="db333-143">De plus, si une transaction (TxA) lit les lignes insérées ou modifiées par une autre transaction (TxB) qui est en cours de validation, le système suppose avec optimisme que l'autre transaction est validée plutôt que d'attendre la validation.</span><span class="sxs-lookup"><span data-stu-id="db333-143">In addition, if a transaction (TxA) reads rows that have been inserted or modified by another transaction (TxB) that is in the process of committing, it will optimistically assume the other transaction will commit rather than wait for the commit to occur.</span></span> <span data-ttu-id="db333-144">Dans ce cas, la transaction TxA prend une dépendance de validation sur la transaction TxB.</span><span class="sxs-lookup"><span data-stu-id="db333-144">In this case, transaction TxA will take a commit dependency on transaction TxB.</span></span>

## <a name="conflict-detection-validation-and-commit-dependency-checks"></a><span data-ttu-id="db333-145">Détection de conflit, validation et contrôles de dépendance de validation</span><span class="sxs-lookup"><span data-stu-id="db333-145">Conflict Detection, Validation, and Commit Dependency Checks</span></span>
 <span data-ttu-id="db333-146">Si [!INCLUDE[ssNoVersion](../includes/ssnoversion-md.md)] détecte des conflits entre des transactions simultanées, ou des violations de niveau d'isolation, il arrête l'une des transactions en conflit.</span><span class="sxs-lookup"><span data-stu-id="db333-146">[!INCLUDE[ssNoVersion](../includes/ssnoversion-md.md)] detects conflicts between concurrent transactions, as well as isolation level violations, and will doom one of the conflicting transactions.</span></span> <span data-ttu-id="db333-147">Cette transaction devra être réexécutée.</span><span class="sxs-lookup"><span data-stu-id="db333-147">This transaction will need to be retried.</span></span> <span data-ttu-id="db333-148">(Pour plus d'informations, consultez [Guidelines for Retry Logic for Transactions on Memory-Optimized Tables](../relational-databases/in-memory-oltp/memory-optimized-tables.md).)</span><span class="sxs-lookup"><span data-stu-id="db333-148">(For more information, see [Guidelines for Retry Logic for Transactions on Memory-Optimized Tables](../relational-databases/in-memory-oltp/memory-optimized-tables.md).)</span></span>

 <span data-ttu-id="db333-149">Le système suppose avec optimisme qu'il n'y a aucun conflit et aucune violation d'isolation de la transaction.</span><span class="sxs-lookup"><span data-stu-id="db333-149">The system optimistically assumes there are no conflicts and no violations of transaction isolation.</span></span> <span data-ttu-id="db333-150">S'il détecte la présence de conflits pouvant provoquer des incohérences dans la base de données ou pouvant enfreindre l'isolation des transactions, il met fin à la transaction en cause.</span><span class="sxs-lookup"><span data-stu-id="db333-150">If any conflicts occur that may cause inconsistencies in the database or that may violate transaction isolation, these conflicts are detected, and the transaction is terminated.</span></span>

 <span data-ttu-id="db333-151">Lorsqu'un conflit a été détecté et la transaction arrêtée, celle-ci doit être réexécutée par le client.</span><span class="sxs-lookup"><span data-stu-id="db333-151">If a conflict is detected, the transaction is terminated and the client needs to retry.</span></span>

 <span data-ttu-id="db333-152">Le tableau suivant récapitule les conditions d'erreur pour les transactions qui accèdent aux tables mémoire optimisées.</span><span class="sxs-lookup"><span data-stu-id="db333-152">The following table summarizes the error conditions for transactions that accesses memory-optimized tables.</span></span>

### <a name="error-conditions-for-transactions-accessing-memory-optimized-tables"></a><span data-ttu-id="db333-153">Conditions d'erreur des transactions qui accèdent aux tables mémoire optimisées.</span><span class="sxs-lookup"><span data-stu-id="db333-153">Error conditions for transactions accessing memory-optimized tables.</span></span>

|<span data-ttu-id="db333-154">Error</span><span class="sxs-lookup"><span data-stu-id="db333-154">Error</span></span>|<span data-ttu-id="db333-155">Scénario</span><span class="sxs-lookup"><span data-stu-id="db333-155">Scenario</span></span>|
|-----------|--------------|
|<span data-ttu-id="db333-156">Conflit d'écriture.</span><span class="sxs-lookup"><span data-stu-id="db333-156">Write conflict.</span></span> <span data-ttu-id="db333-157">Tentative de mettre à jour un enregistrement qui a été mis à jour depuis le début de la transaction.</span><span class="sxs-lookup"><span data-stu-id="db333-157">Attempting to update a record that has been updated since the transaction started.</span></span>|<span data-ttu-id="db333-158">Mise à jour (UPDATE) ou suppression (DELETE) d'une ligne ayant déjà été mise à jour ou supprimée par une transaction simultanée.</span><span class="sxs-lookup"><span data-stu-id="db333-158">UPDATE or DELETE a row that has been updated or deleted by a concurrent transaction.</span></span>|
|<span data-ttu-id="db333-159">Échec de la validation de lecture renouvelable</span><span class="sxs-lookup"><span data-stu-id="db333-159">Repeatable read validation failure.</span></span>|<span data-ttu-id="db333-160">Une ligne qui était lue par la transaction a été modifiée (mise à jour ou supprimée) depuis le début de la transaction.</span><span class="sxs-lookup"><span data-stu-id="db333-160">A row that was read by the transaction has changed (updated or deleted) since the transaction started.</span></span> <span data-ttu-id="db333-161">La validation de lecture renouvelable a généralement lieu lors de l'utilisation des niveaux d'isolation de transactions REPEATABLE READ et SERIALIZABLE.</span><span class="sxs-lookup"><span data-stu-id="db333-161">Repeatable read validation is typically occurs when using REPEATABLE READ and SERIALIZABLE transaction isolation levels.</span></span>|
|<span data-ttu-id="db333-162">Échec de la validation sérialisable</span><span class="sxs-lookup"><span data-stu-id="db333-162">Serializable validation failure.</span></span>|<span data-ttu-id="db333-163">Une nouvelle ligne (fantôme) a été insérée dans l'une des plages d'analyse dans la transaction, depuis le début de la transaction.</span><span class="sxs-lookup"><span data-stu-id="db333-163">A new (phantom) row has been inserted in one of the scan ranges in the transaction, since the transaction started.</span></span> <span data-ttu-id="db333-164">La ligne aurait été visible par la transaction si elle avait été validée dans la base de données avant le début de la transaction.</span><span class="sxs-lookup"><span data-stu-id="db333-164">The row would have been visible to the transaction if the row had been committed to the database before the transaction started.</span></span> <span data-ttu-id="db333-165">La validation SERIALIZABLE a généralement lieu lors de l'utilisation de l'isolation SERIALIZABLE et de la validation des contraintes PRIMARY KEY.</span><span class="sxs-lookup"><span data-stu-id="db333-165">SERIALIZABLE validation typically occurs when using SERIALIZABLE isolation and validating PRIMARY KEY constraints.</span></span>|
|<span data-ttu-id="db333-166">Échec de la dépendance de validation</span><span class="sxs-lookup"><span data-stu-id="db333-166">Commit dependency failure.</span></span>|<span data-ttu-id="db333-167">La transaction a pris une dépendance sur une autre transaction dont la validation a échoué, en raison de l'un des échecs indiqués dans ce tableau, d'une condition de mémoire insuffisante ou de l'échec de la validation dans le journal des transactions.</span><span class="sxs-lookup"><span data-stu-id="db333-167">The transaction took a dependency on another transaction that failed to commit, either due to one of the failures in this table, an out-of-memory condition, or due to failure to commit to the transaction log.</span></span> <span data-ttu-id="db333-168">Ce problème peut se produire avec des transactions de lecture/écriture et de lecture seule.</span><span class="sxs-lookup"><span data-stu-id="db333-168">This failure can occur with both read/write and read-only transactions.</span></span>|

### <a name="transaction-lifetime"></a><span data-ttu-id="db333-169">Durée de vie des transactions</span><span class="sxs-lookup"><span data-stu-id="db333-169">Transaction Lifetime</span></span>
 <span data-ttu-id="db333-170">Les problèmes mentionnés dans le tableau précédent peuvent se produire à différents stades au cours d'une transaction.</span><span class="sxs-lookup"><span data-stu-id="db333-170">The failures mentioned in the previous table can occur at different points during a transaction.</span></span> <span data-ttu-id="db333-171">L'illustration suivante montre les phases d'une transaction qui accède à des tables mémoire optimisées.</span><span class="sxs-lookup"><span data-stu-id="db333-171">The following figure illustrates the phases of a transaction that accesses memory-optimized tables.</span></span>

 <span data-ttu-id="db333-172">![Durée de vie d'une transaction.](../../2014/database-engine/media/hekaton-transactions.gif "Durée de vie d'une transaction.")</span><span class="sxs-lookup"><span data-stu-id="db333-172">![Lifetime of a transaction.](../../2014/database-engine/media/hekaton-transactions.gif "Lifetime of a transaction.")</span></span>
<span data-ttu-id="db333-173">Durée de vie d'une transaction qui accède à des tables mémoire optimisées.</span><span class="sxs-lookup"><span data-stu-id="db333-173">Lifetime of a transaction that accesses memory-optimized tables.</span></span>

#### <a name="regular-processing"></a><span data-ttu-id="db333-174">Traitement normal</span><span class="sxs-lookup"><span data-stu-id="db333-174">Regular Processing</span></span>
 <span data-ttu-id="db333-175">Durant cette phase, les instructions [!INCLUDE[tsql](../includes/tsql-md.md)] émises par l'utilisateur sont exécutées.</span><span class="sxs-lookup"><span data-stu-id="db333-175">During this phase, the user-issued [!INCLUDE[tsql](../includes/tsql-md.md)] statements are executed.</span></span> <span data-ttu-id="db333-176">Les lignes sont lues dans les tables, et les nouvelles versions de ligne sont écrites dans la base de données.</span><span class="sxs-lookup"><span data-stu-id="db333-176">Rows are read from the tables, and new row versions are written to the database.</span></span> <span data-ttu-id="db333-177">La transaction est isolée des autres transactions simultanées.</span><span class="sxs-lookup"><span data-stu-id="db333-177">The transaction is isolated from all other concurrent transactions.</span></span> <span data-ttu-id="db333-178">La transaction utilise l'instantané des tables mémoire optimisées tel qu'il existait au début de la transaction.</span><span class="sxs-lookup"><span data-stu-id="db333-178">The transaction uses the snapshot of the memory-optimized tables that exists at the start of the transaction.</span></span>

 <span data-ttu-id="db333-179">Les écritures dans les tables durant cette phase de la transaction ne sont pas encore visibles dans les autres transactions, à une exception près : les mises à jour et les suppressions de ligne sont visibles pour les opérations de mise à jour et de suppression effectuées dans d'autres transactions, afin de détecter les conflits d'écriture.</span><span class="sxs-lookup"><span data-stu-id="db333-179">Writes to the tables in this phase of the transaction are not yet visible to other transactions, with one exception: row updates and deletes are visible to update and delete operations in other transactions, in order to detect write conflicts.</span></span>

 <span data-ttu-id="db333-180">Si une opération de mise à jour ou de suppression détecte qu'une ligne a été mise à jour ou supprimée depuis le début logique de la transaction, l'opération échoue avec l'erreur 41302.</span><span class="sxs-lookup"><span data-stu-id="db333-180">If an update or delete operation sees that a row has been updated or deleted since the logical start of the transaction, the operation will fail with error 41302.</span></span> <span data-ttu-id="db333-181">Le message de l'erreur 41302 est « La transaction en cours a tenté de mettre à jour un enregistrement dans la table X qui a été mis à jour depuis le début de cette transaction.</span><span class="sxs-lookup"><span data-stu-id="db333-181">The message for error 41302 is "The current transaction attempted to update a record in table X that has been updated since this transaction started.</span></span> <span data-ttu-id="db333-182">La transaction a été abandonnée. ».</span><span class="sxs-lookup"><span data-stu-id="db333-182">The transaction was aborted."</span></span>

 <span data-ttu-id="db333-183">Cette erreur provoque l'arrêt de la transaction (même si XACT_ABORT est désactivé), ce qui signifie que la transaction sera restaurée à la fin de la session utilisateur.</span><span class="sxs-lookup"><span data-stu-id="db333-183">This error dooms the transaction (even if XACT_ABORT is OFF), meaning that the transaction will be rolled back when the user session ends.</span></span> <span data-ttu-id="db333-184">Les transactions vouées à l'échec ne peuvent pas être validées et prennent uniquement en charge les opérations de lecture qui n'écrivent pas dans le journal et n'accèdent pas aux tables mémoire optimisées.</span><span class="sxs-lookup"><span data-stu-id="db333-184">Doomed transactions cannot be committed and only support read operations that do not write to the log and do not access memory-optimized tables.</span></span>

#####  <a name="commit-dependencies"></a><a name="cd"></a><span data-ttu-id="db333-185">Dépendances de validation</span><span class="sxs-lookup"><span data-stu-id="db333-185">Commit Dependencies</span></span>
 <span data-ttu-id="db333-186">Lors du traitement normal, une transaction peut lire les lignes écrites par d'autres transactions qui sont en phase de validation, mais qui ne sont pas encore validées.</span><span class="sxs-lookup"><span data-stu-id="db333-186">During regular processing, a transaction can read rows written by other transactions that are in the validation or commit phase, but have not yet committed.</span></span> <span data-ttu-id="db333-187">Les lignes sont visibles, car l'heure de fin logique des transactions a été définie au début de la phase de validation.</span><span class="sxs-lookup"><span data-stu-id="db333-187">The rows are visible because the logical end time of the transactions has been assigned at the start of the validation phase.</span></span>

 <span data-ttu-id="db333-188">Si une transaction lit ces lignes non validées, elle prendra une dépendance de validation sur cette transaction.</span><span class="sxs-lookup"><span data-stu-id="db333-188">If a transaction reads such uncommitted rows, it will take a commit dependency on that transaction.</span></span> <span data-ttu-id="db333-189">Cela a deux conséquences principales :</span><span class="sxs-lookup"><span data-stu-id="db333-189">This has two main implications:</span></span>

-   <span data-ttu-id="db333-190">Une transaction ne peut pas être validée tant que les transactions dont elle dépend n'ont pas été validées.</span><span class="sxs-lookup"><span data-stu-id="db333-190">A transaction cannot commit until the transactions it depends on have committed.</span></span> <span data-ttu-id="db333-191">En d'autres termes, elle ne peut pas entrer dans la phase de validation tant que toutes les dépendances n'ont pas été annulées.</span><span class="sxs-lookup"><span data-stu-id="db333-191">In other words, it cannot enter the commit phase, until all dependencies have cleared.</span></span>

-   <span data-ttu-id="db333-192">En outre, les jeux de résultats ne sont pas retournés au client tant que toutes les dépendances n'ont pas été annulées.</span><span class="sxs-lookup"><span data-stu-id="db333-192">In addition, result sets are not returned to the client until all dependencies have cleared.</span></span> <span data-ttu-id="db333-193">Cela empêche le client de voir les données non validées.</span><span class="sxs-lookup"><span data-stu-id="db333-193">This prevents the client from observing uncommitted data.</span></span>

 <span data-ttu-id="db333-194">Si la validation de l'une des transactions liées échoue, il se produit une erreur de dépendance de validation.</span><span class="sxs-lookup"><span data-stu-id="db333-194">If any of the dependent transactions fails to commit, there is a commit dependency failure.</span></span> <span data-ttu-id="db333-195">Cela signifie que la validation de la transaction échouera avec l'erreur 41301 (« Une précédente transaction dont dépend la transaction en cours s'est arrêtée et la transaction en cours ne peut plus être validée. »).</span><span class="sxs-lookup"><span data-stu-id="db333-195">This means the transaction will fail to commit with error 41301 ("A previous transaction that the current transaction took a dependency on has aborted, and the current transaction can no longer commit.").</span></span>

#### <a name="validation-phase"></a><span data-ttu-id="db333-196">Phase de validation</span><span class="sxs-lookup"><span data-stu-id="db333-196">Validation Phase</span></span>
 <span data-ttu-id="db333-197">Pendant la phase de validation, le système vérifie que les hypothèses nécessaires pour le niveau d'isolation de la transaction demandé étaient vraies entre le début et la fin logiques de la transaction.</span><span class="sxs-lookup"><span data-stu-id="db333-197">During the validation phase, the system validates that the assumptions necessary for the requested transaction isolation level were true between the logical start and logical end of the transaction.</span></span>

 <span data-ttu-id="db333-198">Au début de la phase de validation, une heure de fin logique est attribuée à la transaction.</span><span class="sxs-lookup"><span data-stu-id="db333-198">At the start of the validation phase, the transaction is assigned a logical end time.</span></span> <span data-ttu-id="db333-199">Les versions de ligne écrites dans la base de données deviennent accessibles à d'autres transactions à l'heure de fin logique.</span><span class="sxs-lookup"><span data-stu-id="db333-199">The row versions written in the database become visible to other transactions at the logical end time.</span></span> <span data-ttu-id="db333-200">Pour plus d'informations, consultez [Dépendances de validation](#cd).</span><span class="sxs-lookup"><span data-stu-id="db333-200">For more information, see [Commit Dependencies](#cd).</span></span>

##### <a name="repeatable-read-validation"></a><span data-ttu-id="db333-201">Validation de lecture renouvelable</span><span class="sxs-lookup"><span data-stu-id="db333-201">Repeatable Read Validation</span></span>
 <span data-ttu-id="db333-202">Si le niveau d'isolation de la transaction est REPEATABLE READ ou SERIALIZABLE, ou que l'accès aux tables se fait avec l'isolation REPEATABLE READ ou SERIALIZABLE (pour plus d'informations, consultez la section « Isolation d'opérations individuelles » dans [Transaction Isolation Levels](../../2014/database-engine/transaction-isolation-levels.md)), le système confirme que les lectures sont renouvelables.</span><span class="sxs-lookup"><span data-stu-id="db333-202">If the isolation level of the transaction is REPEATABLE READ or SERIALIZABLE, or if tables are accessed under REPEATABLE READ or SERIALIZABLE isolation (for more information, see the section on Isolation of Individual Operations in [Transaction Isolation Levels](../../2014/database-engine/transaction-isolation-levels.md)), the system validates that the reads are repeatable.</span></span> <span data-ttu-id="db333-203">Cela signifie que le système vérifie que les versions des lignes lues par la transaction sont des versions de ligne encore valides à l'heure de fin logique de la transaction.</span><span class="sxs-lookup"><span data-stu-id="db333-203">This means it validates that the versions of the rows read by the transaction are still valid row versions at the logical end time of the transaction.</span></span>

 <span data-ttu-id="db333-204">Si l'une des lignes a été mise à jour ou modifiée, la transaction échoue avec l'erreur 41305 (« La transaction en cours n'a pas été validée en raison d'un échec de validation REPEATABLE READ. »).</span><span class="sxs-lookup"><span data-stu-id="db333-204">If any of the rows have been updated or changed, the transaction fails to commit with error 41305 ("The current transaction failed to commit due to a repeatable read validation failure.").</span></span>

 <span data-ttu-id="db333-205">Cette erreur peut également se produire si une table est supprimée après une insertion, une mise à jour ou une suppression, et avant la validation de la transaction.</span><span class="sxs-lookup"><span data-stu-id="db333-205">This error can also occur if a table is dropped after an insert, update, or delete operation and before the transaction commits.</span></span> <span data-ttu-id="db333-206">Cela s'applique uniquement aux opérations d'insertion, de mise à jour ou de suppression dans des procédures stockées compilées en mode natif.</span><span class="sxs-lookup"><span data-stu-id="db333-206">This applies only to insert, update, or delete operations in natively compiled stored procedures.</span></span> <span data-ttu-id="db333-207">De telles opérations d'écriture effectuées via le langage [!INCLUDE[tsql](../includes/tsql-md.md)] interprété provoquent le blocage de l'instruction DROP TABLE, et une temporisation jusqu'à ce que la transaction soit validée.</span><span class="sxs-lookup"><span data-stu-id="db333-207">Such write operations performed through interpreted [!INCLUDE[tsql](../includes/tsql-md.md)] cause the DROP TABLE statement to block and wait until the transaction commits.</span></span>

##### <a name="serializable-validation"></a><span data-ttu-id="db333-208">Validation sérialisable</span><span class="sxs-lookup"><span data-stu-id="db333-208">Serializable Validation</span></span>
 <span data-ttu-id="db333-209">La validation sérialisable est exécutée dans deux cas :</span><span class="sxs-lookup"><span data-stu-id="db333-209">Serializable validation is performed in two cases:</span></span>

-   <span data-ttu-id="db333-210">Le niveau d'isolation de la transaction est SERIALIZABLE ou les tables sont accessibles avec l'isolation SERIALIZABLE.</span><span class="sxs-lookup"><span data-stu-id="db333-210">If the isolation level of the transaction is SERIALIZABLE or tables are accessed under SERIALIZABLE isolation.</span></span>

-   <span data-ttu-id="db333-211">Les lignes sont insérées dans un index unique, tel que l'index créé pour une contrainte PRIMARY KEY.</span><span class="sxs-lookup"><span data-stu-id="db333-211">If rows are inserted in a unique index, such as the index created for a PRIMARY KEY constraint.</span></span> <span data-ttu-id="db333-212">Le système vérifie qu'aucune ligne avec la même clé n'a été insérée simultanément.</span><span class="sxs-lookup"><span data-stu-id="db333-212">The system validates that no rows with the same key have been concurrently inserted.</span></span>

 <span data-ttu-id="db333-213">Le système vérifie qu'aucune ligne fantôme n'a été écrite dans la base de données.</span><span class="sxs-lookup"><span data-stu-id="db333-213">The system validates that no phantom rows have been written to the database.</span></span> <span data-ttu-id="db333-214">Les opérations de lecture effectuées par la transaction sont évaluées pour déterminer qu'aucune nouvelle ligne n'a été insérée dans les plages d'analyse de ces opérations de lecture.</span><span class="sxs-lookup"><span data-stu-id="db333-214">The read operations performed by the transaction are evaluated to determine that no new rows were inserted in the scan ranges of these read operations.</span></span>

 <span data-ttu-id="db333-215">L'insertion d'une clé dans un index unique comprend une opération implicite de lecture, qui vérifie que la clé n'est pas un doublon.</span><span class="sxs-lookup"><span data-stu-id="db333-215">Insertion of a key in a unique index includes an implicit read operation, to determine that the key is not a duplicate.</span></span> <span data-ttu-id="db333-216">La validation sérialisable des index uniques garantit que ces index ne peuvent pas avoir de doublons au cas où deux transactions simultanées insèreraient la même clé.</span><span class="sxs-lookup"><span data-stu-id="db333-216">Serializable validation for unique indexes ensures these indexes cannot have duplicates in case two transactions concurrently insert the same key.</span></span>

 <span data-ttu-id="db333-217">Si des lignes fantômes sont détectées, la transaction échoue avec l'erreur 41325 (« La transaction actuelle n'a pas été validée en raison d'un échec de validation SERIALIZABLE. »).</span><span class="sxs-lookup"><span data-stu-id="db333-217">If phantom rows are detected, the transaction fails to commit with error 41325 ("The current transaction failed to commit due to a serializable validation failure.").</span></span>

#### <a name="commit-processing"></a><span data-ttu-id="db333-218">Traitement de la validation</span><span class="sxs-lookup"><span data-stu-id="db333-218">Commit Processing</span></span>
 <span data-ttu-id="db333-219">Si la première phase de validation réussit et que la transaction n'a plus de dépendances, la transaction entre dans la phase de traitement de la validation.</span><span class="sxs-lookup"><span data-stu-id="db333-219">If validation succeeds and all transaction dependencies clear, the transaction enters the commit processing phase.</span></span> <span data-ttu-id="db333-220">Durant cette phase, les modifications apportées aux tables durables sont écrites dans le journal, et le journal est écrit sur le disque, pour garantir la durabilité.</span><span class="sxs-lookup"><span data-stu-id="db333-220">During this phase the changes to durable tables are written to the log, and the log is written to disk, to ensure durability.</span></span> <span data-ttu-id="db333-221">Une fois que l'enregistrement de journal de la transaction a été écrit sur le disque, le contrôle est restitué au client.</span><span class="sxs-lookup"><span data-stu-id="db333-221">Once the log record for the transaction has been written to disk, control is returned to the client.</span></span>

 <span data-ttu-id="db333-222">Toutes les dépendances de validation de la transaction sont annulées, et toutes les transactions qui attendaient la validation de cette transaction peuvent continuer à s'exécuter.</span><span class="sxs-lookup"><span data-stu-id="db333-222">All commit dependencies on this transaction are cleared, and all transactions that had been waiting for this transaction to commit can proceed.</span></span>

## <a name="limitations"></a><span data-ttu-id="db333-223">Limites</span><span class="sxs-lookup"><span data-stu-id="db333-223">Limitations</span></span>

-   <span data-ttu-id="db333-224">Les transactions de bases de données croisées ne sont pas prises en charge avec les tables mémoire optimisées.</span><span class="sxs-lookup"><span data-stu-id="db333-224">Cross-database transactions are not supported with memory-optimized tables.</span></span> <span data-ttu-id="db333-225">Une transaction qui accède aux tables mémoire optimisées ne peut pas accéder à plus d'une base de données, à l'exception de l'accès en lecture/écriture à tempdb et de l'accès en lecture seule à la base de données système master.</span><span class="sxs-lookup"><span data-stu-id="db333-225">Every transaction that accesses memory-optimized tables cannot access more than one database, with the exception of read-write access to tempdb and read-only access to the system database master.</span></span>

-   <span data-ttu-id="db333-226">Les transactions distribuées ne sont pas prises en charge avec les tables mémoire optimisées.</span><span class="sxs-lookup"><span data-stu-id="db333-226">Distributed transactions are not supported with memory-optimized tables.</span></span> <span data-ttu-id="db333-227">Les transactions distribuées démarrées par BEGIN DISTRIBUTED TRANSACTION ne peuvent pas accéder aux tables mémoire optimisées.</span><span class="sxs-lookup"><span data-stu-id="db333-227">Distributed transactions started with BEGIN DISTRIBUTED TRANSACTION cannot access memory-optimized tables.</span></span>

-   <span data-ttu-id="db333-228">Les tables mémoire optimisées ne prennent pas en charge le verrouillage.</span><span class="sxs-lookup"><span data-stu-id="db333-228">Memory-optimized tables do not support locking.</span></span> <span data-ttu-id="db333-229">Les verrous explicites via les indicateurs de verrouillage (tels que TABLOCK, XLOCK, ROWLOCK) ne sont pas pris en charge avec les tables mémoire optimisées.</span><span class="sxs-lookup"><span data-stu-id="db333-229">Explicit locks through locking hints (such as TABLOCK, XLOCK, ROWLOCK) are not supported with memory-optimized tables.</span></span>

## <a name="see-also"></a><span data-ttu-id="db333-230">Voir aussi</span><span class="sxs-lookup"><span data-stu-id="db333-230">See Also</span></span>
 [<span data-ttu-id="db333-231">Comprendre les transactions sur les tables mémoire optimisées</span><span class="sxs-lookup"><span data-stu-id="db333-231">Understanding Transactions on Memory-Optimized Tables</span></span>](../../2014/database-engine/understanding-transactions-on-memory-optimized-tables.md)


