---
title: Utiliser des jetons dans les étapes d’un travail | Microsoft Docs
ms.custom: ''
ms.date: 06/13/2017
ms.prod: sql-server-2014
ms.reviewer: ''
ms.technology: ssms
ms.topic: conceptual
helpviewer_keywords:
- job steps [SQL Server Agent]
- security [SQL Server Agent], enabling alert job step tokens
- SQL Server Agent jobs, job steps
- tokens [SQL Server]
- escape macros [SQL Server Agent]
ms.assetid: 105bbb66-0ade-4b46-b8e4-f849e5fc4d43
author: stevestein
ms.author: sstein
ms.openlocfilehash: 9d90b6660dd4b65e4e1d9b832b39ffaa275c83bc
ms.sourcegitcommit: ad4d92dce894592a259721a1571b1d8736abacdb
ms.translationtype: MT
ms.contentlocale: fr-FR
ms.lasthandoff: 08/04/2020
ms.locfileid: "87710091"
---
# <a name="use-tokens-in-job-steps"></a><span data-ttu-id="f3f3e-102">Utiliser des jetons dans les étapes d'un travail</span><span class="sxs-lookup"><span data-stu-id="f3f3e-102">Use Tokens in Job Steps</span></span>
  [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] <span data-ttu-id="f3f3e-103">Agent vous permet d’utiliser des jetons dans des scripts d’étape de travail [!INCLUDE[tsql](../../includes/tsql-md.md)] .</span><span class="sxs-lookup"><span data-stu-id="f3f3e-103">Agent allows you to use tokens in [!INCLUDE[tsql](../../includes/tsql-md.md)] job step scripts.</span></span> <span data-ttu-id="f3f3e-104">Ces jetons avec lesquels vous rédigez des étapes de travail vous offrent la même flexibilité que les variables lors de l'écriture de programmes logiciels.</span><span class="sxs-lookup"><span data-stu-id="f3f3e-104">Using tokens when you write your job steps gives you the same flexibility that variables provide when you write software programs.</span></span> <span data-ttu-id="f3f3e-105">Après que vous avez inséré un jeton dans un script d'étape de travail, [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] Agent le remplace au moment de l'exécution avant que le sous-système [!INCLUDE[tsql](../../includes/tsql-md.md)] n'exécute l'étape de travail.</span><span class="sxs-lookup"><span data-stu-id="f3f3e-105">After you insert a token in a job step script, [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] Agent replaces the token at run time, before the job step is executed by the [!INCLUDE[tsql](../../includes/tsql-md.md)] subsystem.</span></span>  
  
> [!IMPORTANT]  
>  <span data-ttu-id="f3f3e-106">Depuis le Service Pack 1 [!INCLUDE[ssVersion2005](../../includes/ssversion2005-md.md)] , la syntaxe des jetons d'étape de travail [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] Agent a changé.</span><span class="sxs-lookup"><span data-stu-id="f3f3e-106">Starting with [!INCLUDE[ssVersion2005](../../includes/ssversion2005-md.md)] Service Pack 1, the [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] Agent job step token syntax changed.</span></span> <span data-ttu-id="f3f3e-107">Une macro d'échappement doit désormais accompagner tous les jetons employés dans les étapes de travail, sans quoi ces dernières échoueront.</span><span class="sxs-lookup"><span data-stu-id="f3f3e-107">As a result, an escape macro must now accompany all tokens used in job steps, or else those job steps will fail.</span></span> <span data-ttu-id="f3f3e-108">L'emploi de macros d'échappement et la mise à jour des étapes de travail [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] Agent utilisant des jetons sont abordés dans les sections « Utilisation de jetons », « Jetons et macros[!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] Agent » et « Mise à jour des étapes de travail pour l'utilisation de macros » ci-après.</span><span class="sxs-lookup"><span data-stu-id="f3f3e-108">Using escape macros and updating your [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] Agent job steps that use tokens are described in the following sections, "Understanding Using Tokens," "[!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] Agent Tokens and Macros," and "Updating Job Steps to Use Macros."</span></span> <span data-ttu-id="f3f3e-109">De plus, la syntaxe [!INCLUDE[ssVersion2000](../../includes/ssversion2000-md.md)] qui faisait usage de crochets pour identifier des jetons d'étape de travail [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] Agent (par exemple, «`[DATE]`») a également changé.</span><span class="sxs-lookup"><span data-stu-id="f3f3e-109">In addition, the [!INCLUDE[ssVersion2000](../../includes/ssversion2000-md.md)] syntax, which used square brackets to call out [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] Agent job step tokens (for example, "`[DATE]`") has also changed.</span></span> <span data-ttu-id="f3f3e-110">Vous devez désormais mettre les noms de jeton entre parenthèses et placer un signe dollar (`$`) au début de la syntaxe du jeton.</span><span class="sxs-lookup"><span data-stu-id="f3f3e-110">You must now enclose token names in parentheses and place a dollar sign (`$`) at the beginning of the token syntax.</span></span> <span data-ttu-id="f3f3e-111">Par exemple :</span><span class="sxs-lookup"><span data-stu-id="f3f3e-111">For example:</span></span>  
>   
>  <span data-ttu-id="f3f3e-112">`$(ESCAPE_` *macro name* `(DATE))`</span><span class="sxs-lookup"><span data-stu-id="f3f3e-112">`$(ESCAPE_` *macro name* `(DATE))`</span></span>  
  
## <a name="understanding-using-tokens"></a><span data-ttu-id="f3f3e-113">Utilisation de jetons</span><span class="sxs-lookup"><span data-stu-id="f3f3e-113">Understanding Using Tokens</span></span>  
  
> [!IMPORTANT]  
>  <span data-ttu-id="f3f3e-114">Tout utilisateur Windows qui dispose des autorisations d'écriture dans le journal des événements Windows peut accéder aux étapes de travail activées par les alertes WMI ou par les alertes de [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] Agent.</span><span class="sxs-lookup"><span data-stu-id="f3f3e-114">Any Windows user with write permissions on the Windows Event Log can access job steps that are activated by [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] Agent alerts or WMI alerts.</span></span> <span data-ttu-id="f3f3e-115">Pour éviter ce risque de sécurité, les jetons de [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] Agent qui peuvent être utilisés dans des travaux activés par des alertes sont désactivés par défaut.</span><span class="sxs-lookup"><span data-stu-id="f3f3e-115">To avoid this security risk, [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] Agent tokens that can be used in jobs activated by alerts are disabled by default.</span></span> <span data-ttu-id="f3f3e-116">Ces jetons sont : **a-DBN**, **a-SVR**, **a-Err**, **a-gravité**, **a-MSG**et **WMI ( *`property`* )**.</span><span class="sxs-lookup"><span data-stu-id="f3f3e-116">These tokens are: **A-DBN**, **A-SVR**, **A-ERR**, **A-SEV**, **A-MSG**., and **WMI(*`property`*)**.</span></span> <span data-ttu-id="f3f3e-117">Notez que dans cette version, l'utilisation des jetons est étendue toutes les alertes.</span><span class="sxs-lookup"><span data-stu-id="f3f3e-117">Note that in this release, use of tokens is extended to all alerting.</span></span>  
>   
>  <span data-ttu-id="f3f3e-118">Si vous devez utiliser ces jetons, assurez-vous d'abord que seuls les membres des groupes de sécurité Windows approuvés, comme le groupe Administrateurs, disposent des autorisations d'écriture pour le journal d'événements de l'ordinateur sur lequel [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] réside.</span><span class="sxs-lookup"><span data-stu-id="f3f3e-118">If you need to use these tokens, first ensure that only members of trusted Windows security groups, such as the Administrators group, have write permissions on the Event Log of the computer where [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] resides.</span></span> <span data-ttu-id="f3f3e-119">Ensuite, pour activer ces jetons, cliquez avec le bouton droit sur **SQL Server Agent** dans l’Explorateur d’objets, sélectionnez **Propriétés**, puis dans la page **Système d’alerte** qui s’affiche, sélectionnez l’option **Remplacer les jetons pour toutes les réponses de travaux aux alertes** .</span><span class="sxs-lookup"><span data-stu-id="f3f3e-119">Then, right-click **SQL Server Agent** in Object Explorer, select **Properties**, and on the **Alert System** page, select **Replace tokens for all job responses to alerts** to enable these tokens.</span></span>  
  
 [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] <span data-ttu-id="f3f3e-120">Agent : Le remplacement du jeton est simple et efficace, [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] Agent remplace le jeton par une valeur de chaîne littérale exacte.</span><span class="sxs-lookup"><span data-stu-id="f3f3e-120">Agent token replacement is simple and efficient: [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] Agent replaces an exact literal string value for the token.</span></span> <span data-ttu-id="f3f3e-121">Tous les jetons respectent la casse.</span><span class="sxs-lookup"><span data-stu-id="f3f3e-121">All tokens are case-sensitive.</span></span> <span data-ttu-id="f3f3e-122">Vous devez tenir compte de ce changement dans vos étapes de travail et nommer correctement les jetons utilisés, ou bien convertir la chaîne de remplacement en type de données correct.</span><span class="sxs-lookup"><span data-stu-id="f3f3e-122">Your job steps must take this into account and correctly quote the tokens you use or convert the replacement string to the correct data type.</span></span>  
  
 <span data-ttu-id="f3f3e-123">Par exemple, vous pouvez utiliser l'instruction suivante pour imprimer le nom de la base de données dans une étape de travail :</span><span class="sxs-lookup"><span data-stu-id="f3f3e-123">For example, you might use the following statement to print the name of the database in a job step:</span></span>  
  
 `PRINT N'Current database name is $(ESCAPE_SQUOTE(A-DBN))' ;`  
  
 <span data-ttu-id="f3f3e-124">Dans cet exemple, la macro **ESCAPE_SQUOTE** est insérée avec le jeton **A-DBN** .</span><span class="sxs-lookup"><span data-stu-id="f3f3e-124">In this example, the **ESCAPE_SQUOTE** macro is inserted with the **A-DBN** token.</span></span> <span data-ttu-id="f3f3e-125">Au moment de l’exécution, le jeton **A-DBN** est remplacé par le nom de base de données approprié.</span><span class="sxs-lookup"><span data-stu-id="f3f3e-125">At run time, the **A-DBN** token will be replaced with the appropriate database name.</span></span> <span data-ttu-id="f3f3e-126">La macro d'échappement interprète comme des caractères d'échappement tous les guillemets simples transmis par inadvertance à la chaîne de remplacement des jetons.</span><span class="sxs-lookup"><span data-stu-id="f3f3e-126">The escape macro escapes any single quotation marks that may be inadvertently passed in the token replacement string.</span></span> [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] <span data-ttu-id="f3f3e-127">Agent remplace un guillemet simple par un guillemet double dans la chaîne finale.</span><span class="sxs-lookup"><span data-stu-id="f3f3e-127">Agent will replace one single quotation mark with two single quotation marks in the final string.</span></span>  
  
 <span data-ttu-id="f3f3e-128">Par exemple, si la chaîne transmise en vue de remplacer le jeton est `AdventureWorks2012'SELECT @@VERSION --`, la commande exécutée par l'étape de travail [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] Agent sera la suivante :</span><span class="sxs-lookup"><span data-stu-id="f3f3e-128">For example, if the string passed to replace the token is `AdventureWorks2012'SELECT @@VERSION --`, the command executed by the [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] Agent job step will be:</span></span>  
  
 `PRINT N'Current database name is AdventureWorks2012''SELECT @@VERSION --' ;`  
  
 <span data-ttu-id="f3f3e-129">Dans ce cas, l'instruction insérée, `SELECT @@VERSION`, n'est pas exécutée.</span><span class="sxs-lookup"><span data-stu-id="f3f3e-129">In this case, the inserted statement, `SELECT @@VERSION`, does not execute.</span></span> <span data-ttu-id="f3f3e-130">À la place, le guillemet simple supplémentaire incite le serveur à analyser l'instruction insérée en tant que chaîne.</span><span class="sxs-lookup"><span data-stu-id="f3f3e-130">Instead, the extra single quotation mark causes the server to parse the inserted statement as a string.</span></span> <span data-ttu-id="f3f3e-131">Si la chaîne de remplacement de jetons ne contient aucun guillemet simple, aucun caractère n'est interprété comme caractère d'échappement et l'étape de travail contenant le jeton s'exécute comme prévu.</span><span class="sxs-lookup"><span data-stu-id="f3f3e-131">If the token replacement string does not contain a single quotation mark, no characters are escaped and the job step containing the token executes as intended.</span></span>  
  
 <span data-ttu-id="f3f3e-132">Pour déboguer l'usage de jetons dans vos étapes de travail, utilisez des instructions d'impression, telles que `PRINT N'$(ESCAPE_SQUOTE(SQLDIR))'` , et enregistrez la sortie des étapes de travail dans un fichier ou une table.</span><span class="sxs-lookup"><span data-stu-id="f3f3e-132">To debug token usage in your job steps, use print statements such as `PRINT N'$(ESCAPE_SQUOTE(SQLDIR))'` and save job step output to a file or table.</span></span> <span data-ttu-id="f3f3e-133">Ouvrez la page **Avancé** de la boîte de dialogue **Propriétés de l’étape du travail** pour spécifier une table ou un fichier de sortie pour les étapes de travail.</span><span class="sxs-lookup"><span data-stu-id="f3f3e-133">Use the **Advanced** page of the **Job Step Properties** dialog box to specify a job step output file or table.</span></span>  
  
## <a name="sql-server-agent-tokens-and-macros"></a><span data-ttu-id="f3f3e-134">Jetons et macros de SQL Server Agent</span><span class="sxs-lookup"><span data-stu-id="f3f3e-134">SQL Server Agent Tokens and Macros</span></span>  
 <span data-ttu-id="f3f3e-135">Les tableaux suivants répertorient et décrivent les jetons et les macros pris en charge par [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] Agent.</span><span class="sxs-lookup"><span data-stu-id="f3f3e-135">The following tables list and describe the tokens and macros that [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] Agent supports.</span></span>  
  
### <a name="sql-server-agent-tokens"></a><span data-ttu-id="f3f3e-136">Jetons de SQL Server Agent</span><span class="sxs-lookup"><span data-stu-id="f3f3e-136">SQL Server Agent Tokens</span></span>  
  
|<span data-ttu-id="f3f3e-137">par jeton</span><span class="sxs-lookup"><span data-stu-id="f3f3e-137">Token</span></span>|<span data-ttu-id="f3f3e-138">Description</span><span class="sxs-lookup"><span data-stu-id="f3f3e-138">Description</span></span>|  
|-----------|-----------------|  
|<span data-ttu-id="f3f3e-139">**(A-DBN)**</span><span class="sxs-lookup"><span data-stu-id="f3f3e-139">**(A-DBN)**</span></span>|<span data-ttu-id="f3f3e-140">Nom de la base de données.</span><span class="sxs-lookup"><span data-stu-id="f3f3e-140">Database name.</span></span> <span data-ttu-id="f3f3e-141">Si le travail est exécuté par une alerte, la valeur du nom de la base de données remplace automatiquement ce jeton dans l'étape de travail.</span><span class="sxs-lookup"><span data-stu-id="f3f3e-141">If the job is run by an alert, the database name value automatically replaces this token in the job step.</span></span>|  
|<span data-ttu-id="f3f3e-142">**(A-SVR)**</span><span class="sxs-lookup"><span data-stu-id="f3f3e-142">**(A-SVR)**</span></span>|<span data-ttu-id="f3f3e-143">Nom du serveur.</span><span class="sxs-lookup"><span data-stu-id="f3f3e-143">Server name.</span></span> <span data-ttu-id="f3f3e-144">Si le travail est exécuté par une alerte, la valeur du nom du serveur remplace automatiquement ce jeton dans l'étape de travail.</span><span class="sxs-lookup"><span data-stu-id="f3f3e-144">If the job is run by an alert, the server name value automatically replaces this token in the job step.</span></span>|  
|<span data-ttu-id="f3f3e-145">**(A-ERR)**</span><span class="sxs-lookup"><span data-stu-id="f3f3e-145">**(A-ERR)**</span></span>|<span data-ttu-id="f3f3e-146">Numéro d’erreur.</span><span class="sxs-lookup"><span data-stu-id="f3f3e-146">Error number.</span></span> <span data-ttu-id="f3f3e-147">Si le travail est exécuté par une alerte, la valeur du numéro d'erreur remplace automatiquement ce jeton dans l'étape de travail.</span><span class="sxs-lookup"><span data-stu-id="f3f3e-147">If the job is run by an alert, the error number value automatically replaces this token in the job step.</span></span>|  
|<span data-ttu-id="f3f3e-148">**(A-SEV)**</span><span class="sxs-lookup"><span data-stu-id="f3f3e-148">**(A-SEV)**</span></span>|<span data-ttu-id="f3f3e-149">Gravité de l'erreur</span><span class="sxs-lookup"><span data-stu-id="f3f3e-149">Error severity.</span></span> <span data-ttu-id="f3f3e-150">Si le travail est exécuté par une alerte, la valeur de la gravité de l'erreur remplace automatiquement ce jeton dans l'étape de travail.</span><span class="sxs-lookup"><span data-stu-id="f3f3e-150">If the job is run by an alert, the error severity value automatically replaces this token in the job step.</span></span>|  
|<span data-ttu-id="f3f3e-151">**(A-MSG)**</span><span class="sxs-lookup"><span data-stu-id="f3f3e-151">**(A-MSG)**</span></span>|<span data-ttu-id="f3f3e-152">Texte du message.</span><span class="sxs-lookup"><span data-stu-id="f3f3e-152">Message text.</span></span> <span data-ttu-id="f3f3e-153">Si le travail est exécuté par une alerte, la valeur du texte du message remplace automatiquement ce jeton dans l'étape de travail.</span><span class="sxs-lookup"><span data-stu-id="f3f3e-153">If the job is run by an alert, the message text value automatically replaces this token in the job step.</span></span>|  
|<span data-ttu-id="f3f3e-154">**Date**</span><span class="sxs-lookup"><span data-stu-id="f3f3e-154">**(DATE)**</span></span>|<span data-ttu-id="f3f3e-155">Date actuelle (au format AAAAMMJJ).</span><span class="sxs-lookup"><span data-stu-id="f3f3e-155">Current date (in YYYYMMDD format).</span></span>|  
|<span data-ttu-id="f3f3e-156">**INST**</span><span class="sxs-lookup"><span data-stu-id="f3f3e-156">**(INST)**</span></span>|<span data-ttu-id="f3f3e-157">Nom de l’instance.</span><span class="sxs-lookup"><span data-stu-id="f3f3e-157">Instance name.</span></span> <span data-ttu-id="f3f3e-158">Pour une instance par défaut, ce jeton aura le nom de l'instance par défaut : MSSQLSERVER.</span><span class="sxs-lookup"><span data-stu-id="f3f3e-158">For a default instance, this token will have the default instance name: MSSQLSERVER.</span></span>|  
|<span data-ttu-id="f3f3e-159">**JobID**</span><span class="sxs-lookup"><span data-stu-id="f3f3e-159">**(JOBID)**</span></span>|<span data-ttu-id="f3f3e-160">ID de travail.</span><span class="sxs-lookup"><span data-stu-id="f3f3e-160">Job ID.</span></span>|  
|<span data-ttu-id="f3f3e-161">**(MACH)**</span><span class="sxs-lookup"><span data-stu-id="f3f3e-161">**(MACH)**</span></span>|<span data-ttu-id="f3f3e-162">Nom de l’ordinateur.</span><span class="sxs-lookup"><span data-stu-id="f3f3e-162">Computer name.</span></span>|  
|<span data-ttu-id="f3f3e-163">**(MSSA)**</span><span class="sxs-lookup"><span data-stu-id="f3f3e-163">**(MSSA)**</span></span>|<span data-ttu-id="f3f3e-164">Nom du service SQLServerAgent principal.</span><span class="sxs-lookup"><span data-stu-id="f3f3e-164">Master SQLServerAgent service name.</span></span>|  
|<span data-ttu-id="f3f3e-165">**(OSCMD)**</span><span class="sxs-lookup"><span data-stu-id="f3f3e-165">**(OSCMD)**</span></span>|<span data-ttu-id="f3f3e-166">Préfixe du programme utilisé pour exécuter les étapes de travail **CmdExec** .</span><span class="sxs-lookup"><span data-stu-id="f3f3e-166">Prefix for the program used to run **CmdExec** job steps.</span></span>|  
|<span data-ttu-id="f3f3e-167">**(SQLDIR)**</span><span class="sxs-lookup"><span data-stu-id="f3f3e-167">**(SQLDIR)**</span></span>|<span data-ttu-id="f3f3e-168">Répertoire d'installation de [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] .</span><span class="sxs-lookup"><span data-stu-id="f3f3e-168">The directory in which [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] is installed.</span></span> <span data-ttu-id="f3f3e-169">La valeur par défaut est : C:\Program Files\Microsoft SQL Server\MSSQL.</span><span class="sxs-lookup"><span data-stu-id="f3f3e-169">By default, this value is C:\Program Files\Microsoft SQL Server\MSSQL.</span></span>|  
|<span data-ttu-id="f3f3e-170">**(SQLLOGDIR)**</span><span class="sxs-lookup"><span data-stu-id="f3f3e-170">**(SQLLOGDIR)**</span></span>|<span data-ttu-id="f3f3e-171">Jeton de remplacement pour le chemin du dossier des fichiers journaux des erreurs SQL Server, par exemple, $(ESCAPE_SQUOTE(SQLLOGDIR)).</span><span class="sxs-lookup"><span data-stu-id="f3f3e-171">Replacement token for the SQL Server error log folder path - for example, $(ESCAPE_SQUOTE(SQLLOGDIR)).</span></span>|  
|<span data-ttu-id="f3f3e-172">**(STEPCT)**</span><span class="sxs-lookup"><span data-stu-id="f3f3e-172">**(STEPCT)**</span></span>|<span data-ttu-id="f3f3e-173">Nombre de fois où cette étape a été exécutée (ne tient pas compte des nouvelles tentatives).</span><span class="sxs-lookup"><span data-stu-id="f3f3e-173">A count of the number of times this step has executed (excluding retries).</span></span> <span data-ttu-id="f3f3e-174">Peut être utilisé par la commande d'étape pour forcer l'arrêt d'une boucle multi-étape.</span><span class="sxs-lookup"><span data-stu-id="f3f3e-174">Can be used by the step command to force termination of a multistep loop.</span></span>|  
|<span data-ttu-id="f3f3e-175">**ID**</span><span class="sxs-lookup"><span data-stu-id="f3f3e-175">**(STEPID)**</span></span>|<span data-ttu-id="f3f3e-176">Numéro d'identification de l'étape.</span><span class="sxs-lookup"><span data-stu-id="f3f3e-176">Step ID.</span></span>|  
|<span data-ttu-id="f3f3e-177">**(SRVR)**</span><span class="sxs-lookup"><span data-stu-id="f3f3e-177">**(SRVR)**</span></span>|<span data-ttu-id="f3f3e-178">Nom de l'ordinateur sur lequel [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)]est exécuté.</span><span class="sxs-lookup"><span data-stu-id="f3f3e-178">Name of the computer running [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)].</span></span> <span data-ttu-id="f3f3e-179">Si l'instance [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] est une instance nommée, le nom de l'instance est compris.</span><span class="sxs-lookup"><span data-stu-id="f3f3e-179">If the [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] instance is a named instance, this includes the instance name.</span></span>|  
|<span data-ttu-id="f3f3e-180">**SIMULTANÉMENT**</span><span class="sxs-lookup"><span data-stu-id="f3f3e-180">**(TIME)**</span></span>|<span data-ttu-id="f3f3e-181">Heure actuelle (au format HHMMSS).</span><span class="sxs-lookup"><span data-stu-id="f3f3e-181">Current time (in HHMMSS format).</span></span>|  
|<span data-ttu-id="f3f3e-182">**(STRTTM)**</span><span class="sxs-lookup"><span data-stu-id="f3f3e-182">**(STRTTM)**</span></span>|<span data-ttu-id="f3f3e-183">Heure (au format HHMMSS) à laquelle l'exécution du travail a débuté.</span><span class="sxs-lookup"><span data-stu-id="f3f3e-183">The time (in HHMMSS format) that the job began executing.</span></span>|  
|<span data-ttu-id="f3f3e-184">**(STRTDT)**</span><span class="sxs-lookup"><span data-stu-id="f3f3e-184">**(STRTDT)**</span></span>|<span data-ttu-id="f3f3e-185">Date (au format AAAAMMJJ) à laquelle l'exécution du travail a débuté.</span><span class="sxs-lookup"><span data-stu-id="f3f3e-185">The date (in YYYYMMDD format) that the job began executing.</span></span>|  
|<span data-ttu-id="f3f3e-186">**(WMI(** *property* **))**</span><span class="sxs-lookup"><span data-stu-id="f3f3e-186">**(WMI(** *property* **))**</span></span>|<span data-ttu-id="f3f3e-187">Pour les travaux qui s’exécutent en réponse à des alertes WMI, la valeur de la propriété est spécifiée par *propriété*.</span><span class="sxs-lookup"><span data-stu-id="f3f3e-187">For jobs that run in response to WMI alerts, the value of the property specified by *property*.</span></span> <span data-ttu-id="f3f3e-188">Par exemple, `$(WMI(DatabaseName))` fournit la valeur de la propriété **DatabaseName** pour l’événement WMI qui a entraîné l’exécution de l’alerte.</span><span class="sxs-lookup"><span data-stu-id="f3f3e-188">For example, `$(WMI(DatabaseName))` provides the value of the **DatabaseName** property for the WMI event that caused the alert to run.</span></span>|  
  
### <a name="sql-server-agent-escape-macros"></a><span data-ttu-id="f3f3e-189">Macros d'échappement de SQL Server Agent</span><span class="sxs-lookup"><span data-stu-id="f3f3e-189">SQL Server Agent Escape Macros</span></span>  
  
|<span data-ttu-id="f3f3e-190">Macros d'échappement</span><span class="sxs-lookup"><span data-stu-id="f3f3e-190">Escape Macros</span></span>|<span data-ttu-id="f3f3e-191">Description</span><span class="sxs-lookup"><span data-stu-id="f3f3e-191">Description</span></span>|  
|-------------------|-----------------|  
|<span data-ttu-id="f3f3e-192">**$(ESCAPE_SQUOTE(** *token_name* **))**</span><span class="sxs-lookup"><span data-stu-id="f3f3e-192">**$(ESCAPE_SQUOTE(** *token_name* **))**</span></span>|<span data-ttu-id="f3f3e-193">Interprète les guillemets simples (') comme caractères d'échappement dans la chaîne de remplacement des jetons.</span><span class="sxs-lookup"><span data-stu-id="f3f3e-193">Escapes single quotation marks (') in the token replacement string.</span></span> <span data-ttu-id="f3f3e-194">Remplace un guillemet simple par un guillemet double.</span><span class="sxs-lookup"><span data-stu-id="f3f3e-194">Replaces one single quotation mark with two single quotation marks.</span></span>|  
|<span data-ttu-id="f3f3e-195">**$(ESCAPE_DQUOTE(** *token_name* **))**</span><span class="sxs-lookup"><span data-stu-id="f3f3e-195">**$(ESCAPE_DQUOTE(** *token_name* **))**</span></span>|<span data-ttu-id="f3f3e-196">Interprète les guillemets doubles (") comme caractères d'échappement dans la chaîne de remplacement des jetons.</span><span class="sxs-lookup"><span data-stu-id="f3f3e-196">Escapes double quotation marks (") in the token replacement string.</span></span> <span data-ttu-id="f3f3e-197">Remplace un guillemet double par deux guillemets doubles.</span><span class="sxs-lookup"><span data-stu-id="f3f3e-197">Replaces one double quotation mark with two double quotation marks.</span></span>|  
|<span data-ttu-id="f3f3e-198">**$(ESCAPE_RBRACKET(** *nom_jeton* **))**</span><span class="sxs-lookup"><span data-stu-id="f3f3e-198">**$(ESCAPE_RBRACKET(** *token_name* **))**</span></span>|<span data-ttu-id="f3f3e-199">Interprète les crochets droits (]) comme caractères d'échappement dans la chaîne de remplacement des jetons.</span><span class="sxs-lookup"><span data-stu-id="f3f3e-199">Escapes right brackets (]) in the token replacement string.</span></span> <span data-ttu-id="f3f3e-200">Remplace un crochet droit par deux crochets droits.</span><span class="sxs-lookup"><span data-stu-id="f3f3e-200">Replaces one right bracket with two right brackets.</span></span>|  
|<span data-ttu-id="f3f3e-201">**$(ESCAPE_NONE(** *token_name* **))**</span><span class="sxs-lookup"><span data-stu-id="f3f3e-201">**$(ESCAPE_NONE(** *token_name* **))**</span></span>|<span data-ttu-id="f3f3e-202">Remplace le jeton sans interpréter de caractères comme caractères d'échappement dans la chaîne.</span><span class="sxs-lookup"><span data-stu-id="f3f3e-202">Replaces token without escaping any characters in the string.</span></span> <span data-ttu-id="f3f3e-203">La macro est fournie pour des raisons de prise en charge de la compatibilité descendante dans des environnements où l'usage de chaînes de remplacement de jetons est généralement réservé à des utilisateurs approuvés.</span><span class="sxs-lookup"><span data-stu-id="f3f3e-203">This macro is provided to support backward compatibility in environments where token replacement strings are only expected from trusted users.</span></span> <span data-ttu-id="f3f3e-204">Pour plus d'informations, consultez la section « Mise à jour des étapes de travail pour l'utilisation de macros » plus loin dans cette rubrique.</span><span class="sxs-lookup"><span data-stu-id="f3f3e-204">For more information, see "Updating Job Steps to Use Macros," later in this topic.</span></span>|  
  
## <a name="updating-job-steps-to-use-macros"></a><span data-ttu-id="f3f3e-205">Mise à jour des étapes de travail pour l'utilisation de macros</span><span class="sxs-lookup"><span data-stu-id="f3f3e-205">Updating Job Steps to Use Macros</span></span>  
 <span data-ttu-id="f3f3e-206">Depuis [!INCLUDE[ssVersion2005](../../includes/ssversion2005-md.md)] Service Pack 1, les étapes de travail munies de jetons sans macros d'échappement échouent et retournent un message d'erreur indiquant que l'étape de travail contenant un ou plusieurs jetons doit être mise à jour à l'aide d'une macro avant l'exécution du travail.</span><span class="sxs-lookup"><span data-stu-id="f3f3e-206">Beginning with [!INCLUDE[ssVersion2005](../../includes/ssversion2005-md.md)] Service Pack 1, job steps that contain tokens without escape macros will fail and return an error message indicating the job step contains one or more tokens that must be updated with a macro before the job can run.</span></span>  
  
 <span data-ttu-id="f3f3e-207">Un script est disponible dans l’article 915845 [!INCLUDE[msCoName](../../includes/msconame-md.md)] Les étapes de travail de SQL Server Agent qui utilisent des jetons échouent dans SQL Server 2005 Service Pack 1 [de la Base de connaissances](https://support.microsoft.com/kb/915845). Vous pouvez vous servir de ce script pour mettre à jour toutes vos étapes de travail utilisant les jetons avec la macro **ESCAPE_NONE** .</span><span class="sxs-lookup"><span data-stu-id="f3f3e-207">A script is provided with [!INCLUDE[msCoName](../../includes/msconame-md.md)] Knowledge Base article 915845: [SQL Server Agent Job Steps That Use Tokens Fail in SQL Server 2005 Service Pack 1](https://support.microsoft.com/kb/915845).You can use this script to update all of your job steps that use tokens with the **ESCAPE_NONE** macro.</span></span> <span data-ttu-id="f3f3e-208">Après avoir appliqué ce script, nous vous recommandons de passer en revue vos étapes de travail qui utilisent des jetons le plus tôt possible, puis de remplacer la macro **ESCAPE_NONE** par une macro d’échappement adaptée au contexte de vos étapes de travail.</span><span class="sxs-lookup"><span data-stu-id="f3f3e-208">After using this script, we recommend that you review your job steps that use tokens as soon as possible, and replace the **ESCAPE_NONE** macro with an escape macro that is appropriate for the job step context.</span></span>  
  
 <span data-ttu-id="f3f3e-209">La table suivante décrit comment le remplacement des jetons est contrôlé par [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] Agent.</span><span class="sxs-lookup"><span data-stu-id="f3f3e-209">The following table describes how token replacement is handled by [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] Agent.</span></span> <span data-ttu-id="f3f3e-210">Pour activer/désactiver le remplacement des jetons, cliquez avec le bouton droit sur **SQL Server Agent** dans l’Explorateur d’objets, sélectionnez **Propriétés**, puis dans la page **Système d’alerte** , cochez ou décochez la case **Remplacer les jetons pour toutes les réponses de travaux aux alertes** .</span><span class="sxs-lookup"><span data-stu-id="f3f3e-210">To turn alert token replacement on or off, right-click **SQL Server Agent** in Object Explorer, select **Properties**, and on the **Alert System** page, select or clear the **Replace tokens for all job responses to alerts** check box.</span></span>  
  
|<span data-ttu-id="f3f3e-211">Syntaxe des jetons</span><span class="sxs-lookup"><span data-stu-id="f3f3e-211">Token syntax</span></span>|<span data-ttu-id="f3f3e-212">Remplacement de jetons d'alerte activé</span><span class="sxs-lookup"><span data-stu-id="f3f3e-212">Alert token replacement on</span></span>|<span data-ttu-id="f3f3e-213">Remplacement de jetons d'alerte désactivé</span><span class="sxs-lookup"><span data-stu-id="f3f3e-213">Alert token replacement off</span></span>|  
|------------------|--------------------------------|---------------------------------|  
|<span data-ttu-id="f3f3e-214">Macro ESCAPE utilisée</span><span class="sxs-lookup"><span data-stu-id="f3f3e-214">ESCAPE macro used</span></span>|<span data-ttu-id="f3f3e-215">Tous les jetons des travaux sont remplacés avec succès.</span><span class="sxs-lookup"><span data-stu-id="f3f3e-215">All tokens in jobs are successfully replaced.</span></span>|<span data-ttu-id="f3f3e-216">Les jetons activés par des alertes ne sont pas remplacés.</span><span class="sxs-lookup"><span data-stu-id="f3f3e-216">Tokens activated by alerts are not replaced.</span></span> <span data-ttu-id="f3f3e-217">Ces jetons sont **a-DBN**, **a-SVR**, **a-Err**, **a-gravité**, **a-MSG**et **WMI ( *`property`* )**.</span><span class="sxs-lookup"><span data-stu-id="f3f3e-217">These tokens are **A-DBN**, **A-SVR**, **A-ERR**, **A-SEV**, **A-MSG**, and **WMI(*`property`*)**.</span></span> <span data-ttu-id="f3f3e-218">Les autres jetons statiques sont remplacés comme il se doit.</span><span class="sxs-lookup"><span data-stu-id="f3f3e-218">Other static tokens are replaced successfully.</span></span>|  
|<span data-ttu-id="f3f3e-219">Aucune macro ESCAPE utilisée</span><span class="sxs-lookup"><span data-stu-id="f3f3e-219">No ESCAPE macro used</span></span>|<span data-ttu-id="f3f3e-220">Échec de tous les travaux contenant des jetons.</span><span class="sxs-lookup"><span data-stu-id="f3f3e-220">Any jobs containing tokens fail.</span></span>|<span data-ttu-id="f3f3e-221">Échec de tous les travaux contenant des jetons.</span><span class="sxs-lookup"><span data-stu-id="f3f3e-221">Any jobs containing tokens fail.</span></span>|  
  
## <a name="token-syntax-update-examples"></a><span data-ttu-id="f3f3e-222">Exemples de mise à jour de syntaxe de jeton</span><span class="sxs-lookup"><span data-stu-id="f3f3e-222">Token Syntax Update Examples</span></span>  
  
### <a name="a-using-tokens-in-non-nested-strings"></a><span data-ttu-id="f3f3e-223">R.</span><span class="sxs-lookup"><span data-stu-id="f3f3e-223">A.</span></span> <span data-ttu-id="f3f3e-224">Utilisation de jetons dans des chaînes non imbriquées</span><span class="sxs-lookup"><span data-stu-id="f3f3e-224">Using tokens in non-nested strings</span></span>  
 <span data-ttu-id="f3f3e-225">L'exemple suivant explique comment mettre à jour un script non imbriqué simple avec la macro d'échappement appropriée.</span><span class="sxs-lookup"><span data-stu-id="f3f3e-225">The following example shows how to update a simple non-nested script with the appropriate escape macro.</span></span> <span data-ttu-id="f3f3e-226">Avant d'exécuter le script de mise à jour, le script d'étape de travail suivant utilise un jeton d'étape de travail pour imprimer le nom de base de données correct :</span><span class="sxs-lookup"><span data-stu-id="f3f3e-226">Before running the update script, the following job step script uses a job step token to print the appropriate database name:</span></span>  
  
 `PRINT N'Current database name is $(A-DBN)' ;`  
  
 <span data-ttu-id="f3f3e-227">Après l'exécution du script de mise à jour, une `ESCAPE_NONE` macro est insérée avant le jeton `A-DBN` .</span><span class="sxs-lookup"><span data-stu-id="f3f3e-227">After running the update script, an `ESCAPE_NONE` macro is inserted before the `A-DBN` token.</span></span> <span data-ttu-id="f3f3e-228">Du fait que les guillemets simples sont utilisés pour délimiter la chaîne d'impression, vous devez mettre à jour l'étape de travail en insérant la macro `ESCAPE_SQUOTE` comme suit :</span><span class="sxs-lookup"><span data-stu-id="f3f3e-228">Because single quotation marks are used to delimit the print string, you must update the job step by inserting the `ESCAPE_SQUOTE` macro as follows:</span></span>  
  
 `PRINT N'Current database name is $(ESCAPE_SQUOTE(A-DBN))' ;`  
  
### <a name="b-using-tokens-in-nested-strings"></a><span data-ttu-id="f3f3e-229">B.</span><span class="sxs-lookup"><span data-stu-id="f3f3e-229">B.</span></span> <span data-ttu-id="f3f3e-230">Utilisation de jetons dans des chaînes imbriquées</span><span class="sxs-lookup"><span data-stu-id="f3f3e-230">Using tokens in nested strings</span></span>  
 <span data-ttu-id="f3f3e-231">Dans les scripts d'étape de travail où les jetons sont utilisés dans des chaînes ou des instructions imbriquées, les instructions imbriquées doivent être réécrites sous forme de plusieurs instructions avant d'insérer les macros d'échappement appropriées.</span><span class="sxs-lookup"><span data-stu-id="f3f3e-231">In job step scripts where tokens are used in nested strings or statements, the nested statements should be rewritten as multiple statements before inserting the appropriate escape macros.</span></span>  
  
 <span data-ttu-id="f3f3e-232">Par exemple, imaginez l'étape de travail suivante qui utilise le jeton `A-MSG` et n'a pas été mise à jour avec une macro d'échappement :</span><span class="sxs-lookup"><span data-stu-id="f3f3e-232">For example, consider the following job step, which uses the `A-MSG` token and has not been updated with an escape macro:</span></span>  
  
 `PRINT N'Print ''$(A-MSG)''' ;`  
  
 <span data-ttu-id="f3f3e-233">Après l'exécution du script de mise à jour, une macro `ESCAPE_NONE` est insérée avec le jeton.</span><span class="sxs-lookup"><span data-stu-id="f3f3e-233">After running the update script, an `ESCAPE_NONE` macro is inserted with the token.</span></span> <span data-ttu-id="f3f3e-234">Néanmoins, dans ce cas, il vous faudrait réécrire le script sans avoir recours à l'imbrication comme illustré ci-après, puis insérer la macro `ESCAPE_SQUOTE` pour interpréter correctement en tant que caractères d'échappement les délimiteurs susceptibles d'être transmis à la chaîne de remplacement des jetons :</span><span class="sxs-lookup"><span data-stu-id="f3f3e-234">However, in this case, you would have to rewrite the script without using nesting as follows and insert the `ESCAPE_SQUOTE` macro to properly escape delimiters that may be passed in the token replacement string:</span></span>  
  
 `DECLARE @msgString nvarchar(max)`  
  
 `SET @msgString = '$(ESCAPE_SQUOTE(A-MSG))'`  
  
 `SET @msgString = QUOTENAME(@msgString,'''')`  
  
 `PRINT N'Print ' + @msgString ;`  
  
 <span data-ttu-id="f3f3e-235">Notez également dans cet exemple que la fonction QUOTENAME définit le guillemet.</span><span class="sxs-lookup"><span data-stu-id="f3f3e-235">Note also in this example that the QUOTENAME function sets the quote character.</span></span>  
  
### <a name="c-using-tokens-with-the-escape_none-macro"></a><span data-ttu-id="f3f3e-236">C.</span><span class="sxs-lookup"><span data-stu-id="f3f3e-236">C.</span></span> <span data-ttu-id="f3f3e-237">Utilisation de jetons avec la macro ESCAPE_NONE</span><span class="sxs-lookup"><span data-stu-id="f3f3e-237">Using tokens with the ESCAPE_NONE macro</span></span>  
 <span data-ttu-id="f3f3e-238">L'exemple suivant s'inscrit dans un script chargé d'extraire le `job_id` dans la table `sysjobs` et utilise le jeton `JOBID` pour remplir la variable `@JobID` déclarée plus tôt dans le script en tant que type de données binaire.</span><span class="sxs-lookup"><span data-stu-id="f3f3e-238">The following example is part of a script that retrieves the `job_id` from the `sysjobs` table and uses the `JOBID` token to populate the `@JobID` variable, which was declared earlier in the script as a binary data type.</span></span> <span data-ttu-id="f3f3e-239">Notez que, du fait qu'aucun délimiteur n'est requis pour les types de données binaires, la macro `ESCAPE_NONE` est utilisée dans le jeton `JOBID` .</span><span class="sxs-lookup"><span data-stu-id="f3f3e-239">Note that because no delimiters are required for binary data types, the `ESCAPE_NONE` macro is used with the `JOBID` token.</span></span> <span data-ttu-id="f3f3e-240">Vous n'avez pas besoin de mettre ce travail à jour après avoir exécuté le script de mise à niveau.</span><span class="sxs-lookup"><span data-stu-id="f3f3e-240">You would not need to update this job step after running the update script.</span></span>  
  
 `SELECT * FROM msdb.dbo.sysjobs`  
  
 `WHERE @JobID = CONVERT(uniqueidentifier, $(ESCAPE_NONE(JOBID))) ;`  
  
## <a name="see-also"></a><span data-ttu-id="f3f3e-241">Voir aussi</span><span class="sxs-lookup"><span data-stu-id="f3f3e-241">See Also</span></span>  
 <span data-ttu-id="f3f3e-242">[Implémenter des travaux](implement-jobs.md) </span><span class="sxs-lookup"><span data-stu-id="f3f3e-242">[Implement Jobs](implement-jobs.md) </span></span>  
 [<span data-ttu-id="f3f3e-243">Gérer les étapes de travail</span><span class="sxs-lookup"><span data-stu-id="f3f3e-243">Manage Job Steps</span></span>](manage-job-steps.md)  
  
  
