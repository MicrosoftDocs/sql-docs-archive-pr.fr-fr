---
title: Enregistrements et champs de diagnostic | Microsoft Docs
ms.custom: ''
ms.date: 03/06/2017
ms.prod: sql-server-2014
ms.reviewer: ''
ms.technology: native-client
ms.topic: reference
helpviewer_keywords:
- header records [ODBC]
- SQL Server Native Client ODBC driver, errors
- messages [ODBC], diagnostic records
- ODBC error handling, diagnostic records
- SQLGetDiagField function
- diagnostic records [ODBC]
- errors [ODBC], diagnostic records
- fields [ODBC]
- status information [ODBC]
ms.assetid: 4949530c-62d1-4f1a-b592-144244444ce0
author: rothja
ms.author: jroth
ms.openlocfilehash: 4fe52b211eb6d5a0e4d875264609d036702b2b0b
ms.sourcegitcommit: ad4d92dce894592a259721a1571b1d8736abacdb
ms.translationtype: MT
ms.contentlocale: fr-FR
ms.lasthandoff: 08/04/2020
ms.locfileid: "87706463"
---
# <a name="diagnostic-records-and-fields"></a><span data-ttu-id="fc3d6-102">Enregistrements et champs de diagnostic</span><span class="sxs-lookup"><span data-stu-id="fc3d6-102">Diagnostic Records and Fields</span></span>
  <span data-ttu-id="fc3d6-103">Les enregistrements de diagnostic sont associés aux handles d'environnement, de connexion, d'instruction ou de descripteur ODBC.</span><span class="sxs-lookup"><span data-stu-id="fc3d6-103">Diagnostic records are associated with ODBC environment, connection, statement, or descriptor handles.</span></span> <span data-ttu-id="fc3d6-104">Lorsqu'une fonction ODBC déclenche un code de retour autre que SQL_SUCCESS ou SQL_INVALID_HANDLE, le handle appelé par la fonction est associé à des enregistrements de diagnostic qui contiennent des messages informationnels ou d'erreur.</span><span class="sxs-lookup"><span data-stu-id="fc3d6-104">When any ODBC function raises a return code other than SQL_SUCCESS or SQL_INVALID_HANDLE, the handle called by the function has associated diagnostic records that contain informational or error messages.</span></span> <span data-ttu-id="fc3d6-105">Ces enregistrements sont conservés jusqu'à ce qu'une autre fonction soit appelée à l'aide de ce handle, après quoi les enregistrements sont ignorés.</span><span class="sxs-lookup"><span data-stu-id="fc3d6-105">These records are retained until another function is called using that handle, at which time they are discarded.</span></span> <span data-ttu-id="fc3d6-106">Le nombre d'enregistrements de diagnostic pouvant être associés à un handle à un instant donné n'est pas limité.</span><span class="sxs-lookup"><span data-stu-id="fc3d6-106">There is no limit to the number of diagnostic records that can be associated with a handle at any one time.</span></span>  
  
 <span data-ttu-id="fc3d6-107">Les enregistrements de diagnostic sont de deux types : en-tête et état.</span><span class="sxs-lookup"><span data-stu-id="fc3d6-107">There are two types of diagnostic records: header and status.</span></span> <span data-ttu-id="fc3d6-108">L'enregistrement d'en-tête est l'enregistrement 0 ; lorsque des enregistrements d'état sont présents, ils prennent les valeurs 1 et supérieures.</span><span class="sxs-lookup"><span data-stu-id="fc3d6-108">The header record is record 0; when there are status records, they are records 1 and later.</span></span> <span data-ttu-id="fc3d6-109">Les enregistrements de diagnostic contiennent des champs différents pour l'enregistrement d'en-tête et les enregistrements d'état.</span><span class="sxs-lookup"><span data-stu-id="fc3d6-109">Diagnostic records contain different fields for the header record and the status records.</span></span> <span data-ttu-id="fc3d6-110">Des composants ODBC peuvent également définir leurs propres champs d'enregistrement de diagnostic.</span><span class="sxs-lookup"><span data-stu-id="fc3d6-110">ODBC components can also define their own diagnostic record fields.</span></span>  
  
 <span data-ttu-id="fc3d6-111">Les champs dans l'enregistrement d'en-tête contiennent des informations générales sur l'exécution d'une fonction, y compris le code de retour, le nombre de lignes, le nombre d'enregistrements d'état et le type d'instruction exécutée.</span><span class="sxs-lookup"><span data-stu-id="fc3d6-111">Fields in the header record contain general information about a function's execution, including the return code, row count, number of status records, and type of statement executed.</span></span> <span data-ttu-id="fc3d6-112">L'enregistrement d'en-tête est toujours créé à moins qu'une fonction ODBC ne retourne SQL_INVALID_HANDLE.</span><span class="sxs-lookup"><span data-stu-id="fc3d6-112">The header record is always created unless an ODBC function returns SQL_INVALID_HANDLE.</span></span> <span data-ttu-id="fc3d6-113">Pour obtenir la liste complète des champs de l’enregistrement d’en-tête, consultez [SQLGetDiagField](../native-client-odbc-api/sqlgetdiagfield.md).</span><span class="sxs-lookup"><span data-stu-id="fc3d6-113">For a complete list of fields in the header record, see [SQLGetDiagField](../native-client-odbc-api/sqlgetdiagfield.md).</span></span>  
  
 <span data-ttu-id="fc3d6-114">Les champs dans les enregistrements d'état contiennent des informations sur des erreurs ou des avertissements spécifiques retournés par le gestionnaire de pilotes, le pilote ou la source de données ODBC, y compris la valeur SQLSTATE, le numéro d'erreur native, le message de diagnostic, le numéro de colonne et le numéro de ligne.</span><span class="sxs-lookup"><span data-stu-id="fc3d6-114">Fields in the status records contain information about specific errors or warnings returned by the ODBC Driver Manager, driver, or data source, including the SQLSTATE, native error number, diagnostic message, column number, and row number.</span></span> <span data-ttu-id="fc3d6-115">Les enregistrements d'état sont créés uniquement si la fonction retourne SQL_ERROR, SQL_SUCCESS_WITH_INFO, SQL_NO_DATA, SQL_NEED_DATA ou SQL_STILL_EXECUTING.</span><span class="sxs-lookup"><span data-stu-id="fc3d6-115">Status records are created only if the function returns SQL_ERROR, SQL_SUCCESS_WITH_INFO, SQL_NO_DATA, SQL_NEED_DATA, or SQL_STILL_EXECUTING.</span></span> <span data-ttu-id="fc3d6-116">Pour obtenir la liste complète des champs dans les enregistrements d’État, consultez **SQLGetDiagField**.</span><span class="sxs-lookup"><span data-stu-id="fc3d6-116">For a complete list of fields in the status records, see **SQLGetDiagField**.</span></span>  
  
 <span data-ttu-id="fc3d6-117">**SQLGetDiagRec** récupère un enregistrement de diagnostic unique avec ses champs SQLSTATE ODBC, numéro d’erreur natif et message de diagnostic.</span><span class="sxs-lookup"><span data-stu-id="fc3d6-117">**SQLGetDiagRec** retrieves a single diagnostic record along with its ODBC SQLSTATE, native error number, and diagnostic-message fields.</span></span> <span data-ttu-id="fc3d6-118">Cette fonctionnalité est similaire à ODBC 2. fonction _x_**SQLError** .</span><span class="sxs-lookup"><span data-stu-id="fc3d6-118">This functionality is similar to the ODBC 2._x_**SQLError** function.</span></span> <span data-ttu-id="fc3d6-119">La fonction de gestion des erreurs la plus simple dans ODBC 3. *x* consiste à appeler **SQLGetDiagRec** à plusieurs reprises, en commençant par le paramètre *recnumber* défini sur 1 et en incrémentant *recnumber* de 1 jusqu’à ce que **SQLGetDiagRec** retourne SQL_NO_DATA.</span><span class="sxs-lookup"><span data-stu-id="fc3d6-119">The simplest error-handling function in ODBC 3.*x* is to repeatedly call **SQLGetDiagRec** starting with the *RecNumber* parameter set to 1 and incrementing *RecNumber* by 1 until **SQLGetDiagRec** returns SQL_NO_DATA.</span></span> <span data-ttu-id="fc3d6-120">Cela équivaut à ODBC 2. *x* application appelant **SQLError** jusqu’à ce qu’elle retourne SQL_NO_DATA_FOUND.</span><span class="sxs-lookup"><span data-stu-id="fc3d6-120">This is equivalent to an ODBC 2.*x* application calling **SQLError** until it returns SQL_NO_DATA_FOUND.</span></span>  
  
 <span data-ttu-id="fc3d6-121">ODBC 3. *x* prend en charge un plus grand nombre d’informations de diagnostic qu’ODBC 2. *x*.</span><span class="sxs-lookup"><span data-stu-id="fc3d6-121">ODBC 3.*x* supports much more diagnostic information than ODBC 2.*x*.</span></span> <span data-ttu-id="fc3d6-122">Ces informations sont stockées dans des champs supplémentaires dans les enregistrements de diagnostic récupérés à l’aide de **SQLGetDiagField**.</span><span class="sxs-lookup"><span data-stu-id="fc3d6-122">This information is stored in additional fields in diagnostic records retrieved by using **SQLGetDiagField**.</span></span>  
  
 <span data-ttu-id="fc3d6-123">Le [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] pilote ODBC native client contient des champs de diagnostic spécifiques au pilote qui peuvent être récupérés avec **SQLGetDiagField**.</span><span class="sxs-lookup"><span data-stu-id="fc3d6-123">The [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] Native Client ODBC driver has driver-specific diagnostic fields that can be retrieved with **SQLGetDiagField**.</span></span> <span data-ttu-id="fc3d6-124">Les étiquettes pour ces champs spécifiques au pilote sont définies dans sqlncli.h.</span><span class="sxs-lookup"><span data-stu-id="fc3d6-124">Labels for these driver-specific fields are defined in sqlncli.h.</span></span> <span data-ttu-id="fc3d6-125">Utilisez ces étiquettes pour récupérer l'état [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)], le niveau de gravité, le nom du serveur, le nom de la procédure et le numéro de ligne associés à chaque enregistrement de diagnostic.</span><span class="sxs-lookup"><span data-stu-id="fc3d6-125">Use these labels to retrieve the [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] state, severity level, server name, procedure name, and line number associated with each diagnostic record.</span></span> <span data-ttu-id="fc3d6-126">En outre, sqlncli. h contient les définitions des codes utilisés par le pilote pour identifier les instructions Transact-SQL si une application appelle **SQLGetDiagField** avec *DiagIdentifier* défini sur SQL_DIAG_DYNAMIC_FUNCTION_CODE.</span><span class="sxs-lookup"><span data-stu-id="fc3d6-126">Also, sqlncli.h contains definitions of the codes the driver uses to identify Transact-SQL statements if an application calls **SQLGetDiagField** with *DiagIdentifier* set to SQL_DIAG_DYNAMIC_FUNCTION_CODE.</span></span>  
  
 <span data-ttu-id="fc3d6-127">**SQLGetDiagField** est traité par le gestionnaire de pilotes ODBC à l’aide des informations d’erreur qu’il met en cache à partir du pilote sous-jacent.</span><span class="sxs-lookup"><span data-stu-id="fc3d6-127">**SQLGetDiagField** is processed by the ODBC Driver Manager using error information it caches from the underlying driver.</span></span> <span data-ttu-id="fc3d6-128">Le gestionnaire de pilotes ODBC ne met pas en cache les champs de diagnostic spécifiques aux pilotes tant qu'une connexion n'a pas été établie avec succès.</span><span class="sxs-lookup"><span data-stu-id="fc3d6-128">The ODBC Driver Manager does not cache driver-specific diagnostic fields until after a successful connection has been made.</span></span> <span data-ttu-id="fc3d6-129">**SQLGetDiagField** retourne SQL_ERROR s’il est appelé pour obtenir les champs de diagnostic spécifiques au pilote avant qu’une connexion réussie soit terminée.</span><span class="sxs-lookup"><span data-stu-id="fc3d6-129">**SQLGetDiagField** returns SQL_ERROR if it is called to get driver-specific diagnostic fields before a successful connection has been completed.</span></span> <span data-ttu-id="fc3d6-130">Si une fonction de connexion ODBC retourne SQL_SUCCESS_WITH_INFO, les champs de diagnostic spécifiques au pilote pour la fonction de connexion ne sont pas encore disponibles.</span><span class="sxs-lookup"><span data-stu-id="fc3d6-130">If an ODBC connect function returns SQL_SUCCESS_WITH_INFO, the driver-specific diagnostic fields for the connect function are not yet available.</span></span> <span data-ttu-id="fc3d6-131">Vous pouvez commencer à appeler **SQLGetDiagField** uniquement pour les champs de diagnostic spécifiques au pilote après avoir effectué un autre appel de fonction ODBC après la fonction Connect.</span><span class="sxs-lookup"><span data-stu-id="fc3d6-131">You can start calling **SQLGetDiagField** for driver-specific diagnostic fields only after you have made another ODBC function call after the connect function.</span></span>  
  
 <span data-ttu-id="fc3d6-132">La plupart des erreurs signalées par le [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] pilote ODBC Native Client peuvent être diagnostiquées efficacement à l’aide des informations retournées par **SQLGetDiagRec**.</span><span class="sxs-lookup"><span data-stu-id="fc3d6-132">Most errors reported by the [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] Native Client ODBC driver can be effectively diagnosed using only the information returned by **SQLGetDiagRec**.</span></span> <span data-ttu-id="fc3d6-133">Toutefois, dans certains cas, les informations retournées par les champs de diagnostic spécifiques au pilote sont importantes pour diagnostiquer une erreur.</span><span class="sxs-lookup"><span data-stu-id="fc3d6-133">In some cases, however, the information returned by the driver-specific diagnostic fields is important in diagnosing an error.</span></span> <span data-ttu-id="fc3d6-134">Lors du codage d’un gestionnaire d’erreurs ODBC pour des applications utilisant le [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] pilote ODBC Native Client, il est judicieux d’utiliser également **SQLGetDiagField** pour récupérer au moins les SQL_DIAG_SS_MSGSTATE et SQL_DIAG_SS_SEVERITY des champs spécifiques au pilote.</span><span class="sxs-lookup"><span data-stu-id="fc3d6-134">When coding an ODBC error handler for applications using the [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] Native Client ODBC driver, it is a good idea to also use **SQLGetDiagField** to retrieve at least the SQL_DIAG_SS_MSGSTATE and SQL_DIAG_SS_SEVERITY driver-specific fields.</span></span> <span data-ttu-id="fc3d6-135">Si une erreur particulière peut être déclenchée à plusieurs endroits dans le code [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)], SQL_DIAG_SS_MSGSTATE indique à un ingénieur du support technique Microsoft l'emplacement précis où une erreur a été déclenchée, ce qui peut parfois s'avérer utile pour diagnostiquer un problème.</span><span class="sxs-lookup"><span data-stu-id="fc3d6-135">If a particular error can be raised at several locations in the [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] code, SQL_DIAG_SS_MSGSTATE indicates to a Microsoft support engineer specifically where an error was raised, which sometimes aids in diagnosing a problem.</span></span>  
  
## <a name="see-also"></a><span data-ttu-id="fc3d6-136">Voir aussi</span><span class="sxs-lookup"><span data-stu-id="fc3d6-136">See Also</span></span>  
 [<span data-ttu-id="fc3d6-137">Gestion des erreurs et des messages</span><span class="sxs-lookup"><span data-stu-id="fc3d6-137">Handling Errors and Messages</span></span>](handling-errors-and-messages.md)  
  
  
