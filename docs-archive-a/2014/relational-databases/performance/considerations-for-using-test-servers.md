---
title: Observations relatives à l’utilisation de serveurs de test | Microsoft Docs
ms.custom: ''
ms.date: 06/13/2017
ms.prod: sql-server-2014
ms.reviewer: ''
ms.technology: performance
ms.topic: conceptual
helpviewer_keywords:
- overhead [Database Engine Tuning Advisor]
- tuning overhead [SQL Server]
- reducing production server tuning load
- Database Engine Tuning Advisor [SQL Server], test servers
- xp_msver
- test servers [Database Engine Tuning Advisor]
- production servers [SQL Server]
- offload tuning overhead [SQL Server]
ms.assetid: 94e6c3e5-1f09-4616-9da2-4e44d066d494
author: MikeRayMSFT
ms.author: mikeray
ms.openlocfilehash: 3fe835c1e92b382e3e2fadd7e80d4b2984929cc5
ms.sourcegitcommit: ad4d92dce894592a259721a1571b1d8736abacdb
ms.translationtype: MT
ms.contentlocale: fr-FR
ms.lasthandoff: 08/04/2020
ms.locfileid: "87697997"
---
# <a name="considerations-for-using-test-servers"></a><span data-ttu-id="84425-102">Observations relatives à l'utilisation de serveurs de test</span><span class="sxs-lookup"><span data-stu-id="84425-102">Considerations for Using Test Servers</span></span>
  <span data-ttu-id="84425-103">L’utilisation d’un serveur de test pour paramétrer une base de données sur un serveur de production constitue un avantage important de l’Assistant Paramétrage de [!INCLUDE[ssDE](../../includes/ssde-md.md)] .</span><span class="sxs-lookup"><span data-stu-id="84425-103">Using a test server to tune a database on a production server is an important benefit of [!INCLUDE[ssDE](../../includes/ssde-md.md)] Tuning Advisor.</span></span> <span data-ttu-id="84425-104">Avec cette fonctionnalité, vous pouvez transférer sur un serveur de test la charge de gestion du paramétrage sans copier les données réelles sur le serveur de test à partir du serveur de production.</span><span class="sxs-lookup"><span data-stu-id="84425-104">Using this feature, you can offload tuning overhead to a test server without copying the actual data over to the test server from the production server.</span></span>  
  
> [!NOTE]  
>  <span data-ttu-id="84425-105">La fonction de paramétrage du serveur de test n'est pas prise en charge par l'interface utilisateur graphique de l'Assistant Paramétrage du [!INCLUDE[ssDE](../../includes/ssde-md.md)] .</span><span class="sxs-lookup"><span data-stu-id="84425-105">The test server tuning feature is not supported in the [!INCLUDE[ssDE](../../includes/ssde-md.md)] Tuning Advisor graphical user interface (GUI).</span></span>  
  
 <span data-ttu-id="84425-106">Pour utiliser cette fonctionnalité efficacement, tenez compte des points répertoriés dans les sections suivantes.</span><span class="sxs-lookup"><span data-stu-id="84425-106">To use this feature successfully, review the considerations listed in the following sections.</span></span>  
  
## <a name="setting-up-the-test-serverproduction-server-environment"></a><span data-ttu-id="84425-107">Configuration de l'environnement serveur de test/serveur de production</span><span class="sxs-lookup"><span data-stu-id="84425-107">Setting Up the Test Server/Production Server Environment</span></span>  
  
-   <span data-ttu-id="84425-108">L'utilisateur qui souhaite se servir d'un serveur de test pour paramétrer une base de données sur un serveur de production doit exister sur les deux serveurs, sinon ce scénario ne fonctionne pas.</span><span class="sxs-lookup"><span data-stu-id="84425-108">The user who wants to use a test server to tune a database on a production server must exist on both servers, or this scenario will not work.</span></span>  
  
-   <span data-ttu-id="84425-109">La procédure stockée étendue( **xp_msver**) doit être activée pour utiliser le scénario serveur de test/serveur de production.</span><span class="sxs-lookup"><span data-stu-id="84425-109">The extended stored procedure, **xp_msver**, must be enabled to use the test server/production server scenario.</span></span> [!INCLUDE[ssDE](../../includes/ssde-md.md)] <span data-ttu-id="84425-110">L’Assistant Paramétrage utilise cette procédure stockée étendue pour extraire le nombre de processeurs et la mémoire disponible du serveur de production à utiliser pendant le paramétrage du serveur de test.</span><span class="sxs-lookup"><span data-stu-id="84425-110">Tuning Advisor uses this extended stored procedure to fetch the number of processors and the available memory of the production server to use while tuning the test server.</span></span> <span data-ttu-id="84425-111">Si **xp_msver** n’est pas activée, l’Assistant Paramétrage du [!INCLUDE[ssDE](../../includes/ssde-md.md)] suppose les caractéristiques matérielles de l’ordinateur où l’Assistant Paramétrage du [!INCLUDE[ssDE](../../includes/ssde-md.md)] est exécuté.</span><span class="sxs-lookup"><span data-stu-id="84425-111">If **xp_msver** is not enabled, [!INCLUDE[ssDE](../../includes/ssde-md.md)] Tuning Advisor assumes the hardware characteristics of the computer where [!INCLUDE[ssDE](../../includes/ssde-md.md)] Tuning Advisor is running.</span></span> <span data-ttu-id="84425-112">Si les caractéristiques matérielles de l'ordinateur où l'Assistant Paramétrage du [!INCLUDE[ssDE](../../includes/ssde-md.md)] est exécuté ne sont pas accessibles, la présence d'un processeur et de 1 024 mégaoctets (Mo) de mémoire est reconnue par défaut.</span><span class="sxs-lookup"><span data-stu-id="84425-112">If the hardware characteristics of the computer where [!INCLUDE[ssDE](../../includes/ssde-md.md)] Tuning Advisor is running are not available, one processor and 1024 megabytes (MBs) of memory are assumed.</span></span> <span data-ttu-id="84425-113">Cette procédure stockée étendue est activée par défaut lors de l'installation de [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)].</span><span class="sxs-lookup"><span data-stu-id="84425-113">This extended stored procedure is turned on by default when you install [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)].</span></span> <span data-ttu-id="84425-114">Pour plus d’informations, consultez [Configuration de la surface d’exposition](../security/surface-area-configuration.md) et [xp_msver &#40;Transact-SQL&#41;](/sql/relational-databases/system-stored-procedures/xp-msver-transact-sql).</span><span class="sxs-lookup"><span data-stu-id="84425-114">For more information, see [Surface Area Configuration](../security/surface-area-configuration.md) and [xp_msver &#40;Transact-SQL&#41;](/sql/relational-databases/system-stored-procedures/xp-msver-transact-sql).</span></span>  
  
-   [!INCLUDE[ssDE](../../includes/ssde-md.md)] <span data-ttu-id="84425-115">L’Assistant Paramétrage s’attend à ce que les versions de [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] soient les mêmes sur le serveur de test et sur le serveur de production.</span><span class="sxs-lookup"><span data-stu-id="84425-115">Tuning Advisor expects the editions of [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] to be the same on both the test server and the production server.</span></span> <span data-ttu-id="84425-116">Si deux versions différentes sont utilisées, la version installée sur le serveur de test a la priorité.</span><span class="sxs-lookup"><span data-stu-id="84425-116">If there are two different editions, the edition on the test server takes precedence.</span></span> <span data-ttu-id="84425-117">Par exemple, si le serveur de test exécute [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] Standard, l'Assistant Paramétrage du [!INCLUDE[ssDE](../../includes/ssde-md.md)] n'inclut pas les vues indexées, le partitionnement et les opérations en ligne dans ses recommandations, même si le serveur de production exécute [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] Enterprise.</span><span class="sxs-lookup"><span data-stu-id="84425-117">For example, if the test server is running [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] Standard, [!INCLUDE[ssDE](../../includes/ssde-md.md)] Tuning Advisor will not include indexed views, partitioning, and online operations in its recommendations even if the production server is running [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] Enterprise.</span></span>  
  
## <a name="about-test-serverproduction-server-behavior"></a><span data-ttu-id="84425-118">À propos du comportement du serveur de test/serveur de production</span><span class="sxs-lookup"><span data-stu-id="84425-118">About Test Server/Production Server Behavior</span></span>  
  
-   [!INCLUDE[ssDE](../../includes/ssde-md.md)] <span data-ttu-id="84425-119">L’Assistant Paramétrage tient compte des différences matérielles entre le serveur de production et le serveur de test lors de la création de recommandations.</span><span class="sxs-lookup"><span data-stu-id="84425-119">Tuning Advisor takes into account hardware differences between the production and the test server when creating recommendations.</span></span> <span data-ttu-id="84425-120">La recommandation est identique comme si le paramétrage avait été effectué uniquement sur le serveur de production.</span><span class="sxs-lookup"><span data-stu-id="84425-120">The recommendation is the same as though the tuning was done on the production server alone.</span></span>  
  
-   [!INCLUDE[ssDE](../../includes/ssde-md.md)] <span data-ttu-id="84425-121">L’Assistant Paramétrage peut imposer une charge sur le serveur de production pour la collecte de métadonnées, ainsi que pour la création des statistiques nécessaires au paramétrage.</span><span class="sxs-lookup"><span data-stu-id="84425-121">Tuning Advisor may impose some load on the production server for gathering metadata as well as creation of statistics necessary for tuning.</span></span>  
  
-   [!INCLUDE[ssDE](../../includes/ssde-md.md)] <span data-ttu-id="84425-122">L’Assistant Paramétrage ne copie pas de données réelles du serveur de production sur le serveur de test.</span><span class="sxs-lookup"><span data-stu-id="84425-122">Tuning Advisor does not copy actual data from the production server to the test server.</span></span> <span data-ttu-id="84425-123">Il copie uniquement les métadonnées des bases de données ainsi que les statistiques nécessaires.</span><span class="sxs-lookup"><span data-stu-id="84425-123">It only copies the metadata of the databases and the necessary statistics.</span></span>  
  
-   <span data-ttu-id="84425-124">Toutes les informations de session sont stockées dans la base de données **msdb** sur le serveur de production.</span><span class="sxs-lookup"><span data-stu-id="84425-124">All session information is stored in **msdb** on the production server.</span></span> <span data-ttu-id="84425-125">Tout serveur de test disponible pour le paramétrage est alors utilisable et les informations sur toutes les sessions sont accessibles à un endroit unique (le serveur de production).</span><span class="sxs-lookup"><span data-stu-id="84425-125">This allows you to exploit any available test server for tuning, and information about all sessions is available in one place (the production server).</span></span>  
  
## <a name="issues-related-to-the-shell-database"></a><span data-ttu-id="84425-126">Problèmes liés à la base de données shell</span><span class="sxs-lookup"><span data-stu-id="84425-126">Issues Related to the Shell Database</span></span>  
  
-   <span data-ttu-id="84425-127">Après le paramétrage, l'Assistant Paramétrage du [!INCLUDE[ssDE](../../includes/ssde-md.md)] doit supprimer toutes les métadonnées qu'il a créées sur le serveur de test pendant le processus de paramétrage,</span><span class="sxs-lookup"><span data-stu-id="84425-127">After tuning, [!INCLUDE[ssDE](../../includes/ssde-md.md)] Tuning Advisor should remove any metadata that it created on the test server during the tuning process.</span></span> <span data-ttu-id="84425-128">y compris la structure de base de données.</span><span class="sxs-lookup"><span data-stu-id="84425-128">This includes the shell database.</span></span> <span data-ttu-id="84425-129">Si vous exécutez une série de sessions de paramétrage avec les mêmes serveurs de production et de test, vous souhaiterez éventuellement conserver cette structure de base de données pour gagner du temps.</span><span class="sxs-lookup"><span data-stu-id="84425-129">If you are performing a series of tuning sessions with the same production and test servers, you may want to retain this shell database to save time.</span></span> <span data-ttu-id="84425-130">Dans le fichier d’entrée XML, spécifiez le sous-élément **RetainShellDB** avec les autres sous-éléments sous l’élément parent **TuningOptions** .</span><span class="sxs-lookup"><span data-stu-id="84425-130">In the XML input file, specify the **RetainShellDB** subelement with the other sub elements under the **TuningOptions** parent element.</span></span> <span data-ttu-id="84425-131">Si ces options sont utilisées, l'Assistant Paramétrage du [!INCLUDE[ssDE](../../includes/ssde-md.md)] conserve la base de données shell.</span><span class="sxs-lookup"><span data-stu-id="84425-131">Using these options causes [!INCLUDE[ssDE](../../includes/ssde-md.md)] Tuning Advisor to retain the shell database.</span></span> <span data-ttu-id="84425-132">Pour plus d’informations, consultez [Référence des fichiers d’entrée XML &#40;Assistant Paramétrage du moteur de base de données&#41;](database-engine-tuning-advisor.md).</span><span class="sxs-lookup"><span data-stu-id="84425-132">For more information, see [XML Input File Reference &#40;Database Engine Tuning Advisor&#41;](database-engine-tuning-advisor.md).</span></span>  
  
-   <span data-ttu-id="84425-133">Des bases de données shell risquent d’être laissées sur le serveur de test après la réussite d’une session de paramétrage du serveur de test ou du serveur de production, même si vous n’avez pas spécifié le sous-élément **RetainShellDB** .</span><span class="sxs-lookup"><span data-stu-id="84425-133">Shell databases may be left behind on the test server after a successful test server/production server tuning session even if you have not specified the **RetainShellDB** subelement.</span></span> <span data-ttu-id="84425-134">Ces bases de données shell indésirables risquent d'interférer avec les sessions de paramétrage suivantes et elles doivent être supprimées avant qu'une autre session de paramétrage du serveur de test ou du serveur de production soit effectuée.</span><span class="sxs-lookup"><span data-stu-id="84425-134">These unwanted shell databases may interfere with subsequent tuning sessions and should be dropped before performing another test server/production server tuning session.</span></span> <span data-ttu-id="84425-135">De plus, si une session de paramétrage existe de manière inattendue, les bases de données shell sur le serveur de test et les objets de ces bases de données risquent d'être laissés sur le serveur de test.</span><span class="sxs-lookup"><span data-stu-id="84425-135">In addition, if a tuning session exits unexpectedly, the shell databases on the test server and the objects within those databases may be left behind on the test server.</span></span> <span data-ttu-id="84425-136">Vous devez également supprimer ces bases de données et ces objets avant de démarrer une nouvelle session de paramétrage du serveur de test ou du serveur de production.</span><span class="sxs-lookup"><span data-stu-id="84425-136">You should also delete these databases and objects before starting a new test server/production server tuning session.</span></span>  
  
## <a name="issues-related-to-the-tuning-process"></a><span data-ttu-id="84425-137">Problèmes liés au processus de paramétrage</span><span class="sxs-lookup"><span data-stu-id="84425-137">Issues Related to the Tuning Process</span></span>  
  
-   <span data-ttu-id="84425-138">L'utilisateur doit rechercher dans le journal de paramétrage les erreurs de paramétrage dues aux différences entre les serveurs de production et de test, ainsi que les erreurs résultant de la copie de métadonnées du serveur de production au serveur de test.</span><span class="sxs-lookup"><span data-stu-id="84425-138">The user must check the tuning log for tuning errors that result from differences between the production and test servers, and for errors that result from copying metadata from the production to the test server.</span></span> <span data-ttu-id="84425-139">Par exemple, une connexion d'utilisateur peut ne pas exister sur le serveur de test.</span><span class="sxs-lookup"><span data-stu-id="84425-139">For example, a user login may not exist on the test server.</span></span> <span data-ttu-id="84425-140">Si une connexion d'utilisateur n'existe pas sur le serveur de test, les événements dans la charge de travail qui sont émis par cette connexion d'utilisateur risquent de ne pas être paramétrables.</span><span class="sxs-lookup"><span data-stu-id="84425-140">If a user login does not exist on the test server, those events in the workload that are issued by that user login may not be tunable.</span></span> <span data-ttu-id="84425-141">Utilisez l'interface utilisateur graphique de l'Assistant Paramétrage du [!INCLUDE[ssDE](../../includes/ssde-md.md)] pour afficher le journal de paramétrage.</span><span class="sxs-lookup"><span data-stu-id="84425-141">Use the [!INCLUDE[ssDE](../../includes/ssde-md.md)] Tuning Advisor GUI to view the tuning log.</span></span> <span data-ttu-id="84425-142">Pour plus d’informations, consultez [Afficher et utiliser la sortie de l’Assistant Paramétrage du moteur de base de données](view-and-work-with-the-output-from-the-database-engine-tuning-advisor.md).</span><span class="sxs-lookup"><span data-stu-id="84425-142">For more information, see [View and Work with the Output from the Database Engine Tuning Advisor](view-and-work-with-the-output-from-the-database-engine-tuning-advisor.md)</span></span>  
  
-   <span data-ttu-id="84425-143">Si l'Assistant Paramétrage du [!INCLUDE[ssDE](../../includes/ssde-md.md)] ne peut pas paramétrer de nombreux événements en raison d'objets manquants dans la base de données shell que l'Assistant Paramétrage du [!INCLUDE[ssDE](../../includes/ssde-md.md)] crée sur le serveur de test, l'utilisateur doit vérifier le journal de paramétrage.</span><span class="sxs-lookup"><span data-stu-id="84425-143">If [!INCLUDE[ssDE](../../includes/ssde-md.md)] Tuning Advisor cannot tune many events because objects are missing in the shell database that [!INCLUDE[ssDE](../../includes/ssde-md.md)] Tuning Advisor creates on the test server, the user must check the tuning log.</span></span> <span data-ttu-id="84425-144">Les événements ne pouvant pas être paramétrés sont consignés dans le journal.</span><span class="sxs-lookup"><span data-stu-id="84425-144">Events that cannot be tuned are listed in the log.</span></span> <span data-ttu-id="84425-145">Pour paramétrer correctement la base de données sur le serveur de test, l'utilisateur doit créer les objets manquants dans la structure de base de données, puis démarrer une nouvelle session de paramétrage.</span><span class="sxs-lookup"><span data-stu-id="84425-145">To successfully tune the database on the test server, the user must create the missing objects in the shell database, and then start a new tuning session.</span></span>  
  
-   <span data-ttu-id="84425-146">Si une base de données portant le même nom existe déjà sur le serveur de test, l'Assistant Paramétrage du [!INCLUDE[ssDE](../../includes/ssde-md.md)] ne copie pas les métadonnées, mais continue le paramétrage et collecte les statistiques nécessaires.</span><span class="sxs-lookup"><span data-stu-id="84425-146">If a database with the same name already exists on the test server, [!INCLUDE[ssDE](../../includes/ssde-md.md)] Tuning Advisor does not copy metadata, but continues tuning and gathers statistics as necessary.</span></span> <span data-ttu-id="84425-147">Cela est utile si l'utilisateur a déjà créé une base de données sur le serveur de test et a copié les métadonnées appropriées avant d'appeler l'Assistant Paramétrage du [!INCLUDE[ssDE](../../includes/ssde-md.md)] .</span><span class="sxs-lookup"><span data-stu-id="84425-147">This is useful if the user has already created a database on the test server and has copied the appropriate metadata before invoking [!INCLUDE[ssDE](../../includes/ssde-md.md)] Tuning Advisor.</span></span>  
  
-   <span data-ttu-id="84425-148">Si l'option DATE_CORRELATION_OPTIMIZATION est activée sur une base de données du serveur de production, les métadonnées et les données associées à cette option ne sont pas complètement traduites en script pendant le paramétrage du serveur de test.</span><span class="sxs-lookup"><span data-stu-id="84425-148">If the DATE_CORRELATION_OPTIMIZATION option is turned on for a database on the production server, metadata and the data associated with this option are not completely scripted while tuning the test server.</span></span> <span data-ttu-id="84425-149">Lors de l'exécution du paramétrage pour un scénario serveur de test/serveur de production, les problèmes suivants peuvent survenir :</span><span class="sxs-lookup"><span data-stu-id="84425-149">When tuning is performed for a test server/production server scenario, the following issues may apply:</span></span>  
  
    -   <span data-ttu-id="84425-150">Les utilisateurs peuvent avoir des plans de requête différents sur les serveurs pour les requêtes utilisant l'option DATE_CORRELATION_OPTIMIZATION.</span><span class="sxs-lookup"><span data-stu-id="84425-150">Users can have different query plans on the servers for queries that use the DATE_CORRELATION_OPTIMIZATION option.</span></span>  
  
    -   [!INCLUDE[ssDE](../../includes/ssde-md.md)] <span data-ttu-id="84425-151">L’Assistant Paramétrage peut suggérer la suppression des vues indexées qui appliquent l’option DATE_CORRELATION_OPTIMIZATION dans le script de recommandation.</span><span class="sxs-lookup"><span data-stu-id="84425-151">Tuning Advisor may suggest dropping indexed views that enforce the DATE_CORRELATION_OPTIMIZATION option in the recommendation script.</span></span>  
  
     <span data-ttu-id="84425-152">Par conséquent, vous souhaiterez éventuellement ignorer les recommandations que l'Assistant Paramétrage du [!INCLUDE[ssDE](../../includes/ssde-md.md)] effectue concernant les vues indexées qui contiennent des statistiques de corrélation, car l'Assistant Paramétrage du [!INCLUDE[ssDE](../../includes/ssde-md.md)] connaît leurs coûts, mais pas leurs avantages.</span><span class="sxs-lookup"><span data-stu-id="84425-152">Therefore, you may want to ignore any recommendations that [!INCLUDE[ssDE](../../includes/ssde-md.md)] Tuning Advisor makes about the indexed views that hold correlation statistics because [!INCLUDE[ssDE](../../includes/ssde-md.md)] Tuning Advisor knows their costs but not their benefits.</span></span> [!INCLUDE[ssDE](../../includes/ssde-md.md)] <span data-ttu-id="84425-153">L’Assistant Paramétrage peut ne pas recommander la sélection de certains index, tels que les index cluster sur les colonnes **datetime** , ce qui pourrait être intéressant lorsque l’option DATE_CORRELATION_OPTIMIZATION est activée.</span><span class="sxs-lookup"><span data-stu-id="84425-153">Tuning Advisor may not recommend selection of certain indexes such as clustered indexes on **datetime** columns, which could be beneficial when DATE_CORRELATION_OPTIMIZATION is enabled.</span></span>  
  
     <span data-ttu-id="84425-154">Pour déterminer si une vue est basée sur des statistiques de corrélation, sélectionnez la colonne **is_date_correlation_view** de l’affichage catalogue [sys.views](/sql/relational-databases/system-catalog-views/sys-views-transact-sql) .</span><span class="sxs-lookup"><span data-stu-id="84425-154">To determine if a view is based on correlation statistics, select the **is_date_correlation_view** column of the [sys.views](/sql/relational-databases/system-catalog-views/sys-views-transact-sql) catalog view.</span></span>  
  
  
