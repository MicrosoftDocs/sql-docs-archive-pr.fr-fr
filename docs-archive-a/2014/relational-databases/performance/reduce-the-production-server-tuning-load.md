---
title: Réduire la charge de paramétrage du serveur de production | Microsoft Docs
ms.custom: ''
ms.date: 06/13/2017
ms.prod: sql-server-2014
ms.reviewer: ''
ms.technology: performance
ms.topic: conceptual
helpviewer_keywords:
- overhead [Database Engine Tuning Advisor]
- tuning overhead [SQL Server]
- reducing production server tuning load
- Database Engine Tuning Advisor [SQL Server], test servers
- test servers [Database Engine Tuning Advisor]
- production servers [SQL Server]
- offload tuning overhead [SQL Server]
ms.assetid: bb95ecaf-444a-4771-a625-e0a91c8f0709
author: MikeRayMSFT
ms.author: mikeray
ms.openlocfilehash: 53a61b17793a50d6b819f7c1684afdc4de4377f4
ms.sourcegitcommit: ad4d92dce894592a259721a1571b1d8736abacdb
ms.translationtype: MT
ms.contentlocale: fr-FR
ms.lasthandoff: 08/04/2020
ms.locfileid: "87611736"
---
# <a name="reduce-the-production-server-tuning-load"></a><span data-ttu-id="34b3c-102">Réduire la charge de paramétrage du serveur de production</span><span class="sxs-lookup"><span data-stu-id="34b3c-102">Reduce the Production Server Tuning Load</span></span>
  [!INCLUDE[ssDE](../../../includes/ssde-md.md)] <span data-ttu-id="34b3c-103">L’Assistant Paramétrage compte sur l’optimiseur de requête pour analyser une charge de travail et faire des recommandations de paramétrage.</span><span class="sxs-lookup"><span data-stu-id="34b3c-103">Tuning Advisor relies on the query optimizer to analyze a workload and to make tuning recommendations.</span></span> <span data-ttu-id="34b3c-104">Le fait d'effectuer cette analyse sur le serveur de production augmente la charge du serveur et peut dégrader les performances du serveur pendant la session de paramétrage.</span><span class="sxs-lookup"><span data-stu-id="34b3c-104">Performing this analysis on the production server adds to the server load and can hurt server performance during the tuning session.</span></span> <span data-ttu-id="34b3c-105">Vous pouvez réduire l'impact sur la charge du serveur pendant une session de paramétrage en utilisant un serveur de test en plus du serveur de production.</span><span class="sxs-lookup"><span data-stu-id="34b3c-105">You can reduce the impact to the server load during a tuning session by using a test server in addition to the production server.</span></span>

## <a name="how-database-engine-tuning-advisor-uses-a-test-server"></a><span data-ttu-id="34b3c-106">Utilisation d'un serveur de test par l'Assistant Paramétrage du moteur de base de données</span><span class="sxs-lookup"><span data-stu-id="34b3c-106">How Database Engine Tuning Advisor Uses a Test Server</span></span>
 <span data-ttu-id="34b3c-107">En règle générale, pour utiliser un serveur de test, vous copiez toutes les données du serveur de production vers le serveur de test, paramétrez le serveur de test et implémentez la recommandation sur le serveur de production.</span><span class="sxs-lookup"><span data-stu-id="34b3c-107">The traditional way to use a test server is to copy all of the data from your production server to your test server, tune the test server, and then implement the recommendation on your production server.</span></span> <span data-ttu-id="34b3c-108">Cette méthode élimine le problème d'impact sur les performances du serveur de production, mais elle ne constitue pas la solution la plus efficace.</span><span class="sxs-lookup"><span data-stu-id="34b3c-108">This process eliminates the performance impact on your production server, but nevertheless is not the optimal solution.</span></span> <span data-ttu-id="34b3c-109">La copie d'une importante quantité de données du serveur de production vers le serveur de test, par exemple, s'avère longue et consomme un nombre substantiel de ressources.</span><span class="sxs-lookup"><span data-stu-id="34b3c-109">For example, copying large amounts of data from the production to the test server can consume substantial amounts of time and resources.</span></span> <span data-ttu-id="34b3c-110">En outre, le matériel du serveur de test est rarement aussi puissant que le matériel déployé pour les serveurs de production.</span><span class="sxs-lookup"><span data-stu-id="34b3c-110">In addition, test server hardware is seldom as powerful as the hardware that is deployed for production servers.</span></span> <span data-ttu-id="34b3c-111">Le processus de paramétrage repose sur l'optimiseur de requêtes. En outre, les recommandations qu'il génère sont partiellement basées sur le matériel sous-jacent.</span><span class="sxs-lookup"><span data-stu-id="34b3c-111">The tuning process relies on the query optimizer, and the recommendations it generates are based in part on the underlying hardware.</span></span> <span data-ttu-id="34b3c-112">Si les matériels des serveurs de test et de production ne sont pas identiques, la qualité de la recommandation de l’Assistant Paramétrage du [!INCLUDE[ssDE](../../../includes/ssde-md.md)] est moindre.</span><span class="sxs-lookup"><span data-stu-id="34b3c-112">If the test and production server hardware are not identical, the [!INCLUDE[ssDE](../../../includes/ssde-md.md)] Tuning Advisor recommendation quality is diminished.</span></span>

 <span data-ttu-id="34b3c-113">Pour éviter ces problèmes, l'Assistant Paramétrage du [!INCLUDE[ssDE](../../../includes/ssde-md.md)] paramètre une base de production sur un serveur de production en déchargeant la majorité de la charge de paramétrage vers un serveur de test.</span><span class="sxs-lookup"><span data-stu-id="34b3c-113">To avoid these problems, [!INCLUDE[ssDE](../../../includes/ssde-md.md)] Tuning Advisor tunes a database on a production server by offloading most of the tuning load onto a test server.</span></span> <span data-ttu-id="34b3c-114">Il procède ainsi en utilisant les informations de configuration matérielle du serveur de production et sans copier réellement les données du serveur de production vers le serveur de test.</span><span class="sxs-lookup"><span data-stu-id="34b3c-114">It does this by using the production server hardware configuration information and without actually copying the data from the production server to the test server.</span></span> [!INCLUDE[ssDE](../../../includes/ssde-md.md)] <span data-ttu-id="34b3c-115">L’Assistant Paramétrage ne copie pas de données réelles du serveur de production sur le serveur de test.</span><span class="sxs-lookup"><span data-stu-id="34b3c-115">Tuning Advisor does not copy actual data from the production server to the test server.</span></span> <span data-ttu-id="34b3c-116">Il copie uniquement les métadonnées et les statistiques nécessaires.</span><span class="sxs-lookup"><span data-stu-id="34b3c-116">It only copies the metadata and necessary statistics.</span></span>

 <span data-ttu-id="34b3c-117">Les étapes suivantes expliquent le processus de paramétrage d'une base de données de production sur un serveur de test :</span><span class="sxs-lookup"><span data-stu-id="34b3c-117">The following steps outline the process for tuning a production database on a test server:</span></span>

1.  <span data-ttu-id="34b3c-118">Vérifiez que l'utilisateur qui veut utiliser le serveur de test existe sur les deux serveurs.</span><span class="sxs-lookup"><span data-stu-id="34b3c-118">Make sure that the user who wants to use the test server exists on both servers.</span></span>

     <span data-ttu-id="34b3c-119">Avant de commencer, vérifiez que l'utilisateur qui veut utiliser le serveur de test pour paramétrer une base de données sur le serveur de production existe sur les deux serveurs.</span><span class="sxs-lookup"><span data-stu-id="34b3c-119">Before you start, make sure that the user who wants to use the test server to tune a database on the production server exists on both servers.</span></span> <span data-ttu-id="34b3c-120">Ceci implique de créer l'utilisateur et sa connexion sur le serveur de test.</span><span class="sxs-lookup"><span data-stu-id="34b3c-120">This requires that you create the user and his or her login on the test server.</span></span> <span data-ttu-id="34b3c-121">Si vous êtes membre du rôle de serveur fixe **sysadmin** sur les deux ordinateurs, cette étape n’est pas nécessaire.</span><span class="sxs-lookup"><span data-stu-id="34b3c-121">If you are a member of the **sysadmin** fixed server role on both computers, this step is not necessary.</span></span>

2.  <span data-ttu-id="34b3c-122">Paramétrez la charge de travail sur le serveur de test.</span><span class="sxs-lookup"><span data-stu-id="34b3c-122">Tune the workload on the test server.</span></span>

     <span data-ttu-id="34b3c-123">Pour paramétrer une charge de travail sur un serveur de test, vous devez utiliser un fichier d’entrée XML avec l’utilitaire de ligne de commande **dta** .</span><span class="sxs-lookup"><span data-stu-id="34b3c-123">To tune a workload on a test server, you must use an XML input file with the **dta** command-line utility.</span></span> <span data-ttu-id="34b3c-124">Dans le fichier d’entrée XML, définissez le nom du serveur de test avec le sous-élément **TestServer** et définissez les valeurs des autres sous-éléments sous l’élément parent **TuningOptions** .</span><span class="sxs-lookup"><span data-stu-id="34b3c-124">In the XML input file, specify the name of your test server with the **TestServer** subelement in addition to specifying the values for the other subelements under the **TuningOptions** parent element.</span></span>

     <span data-ttu-id="34b3c-125">Au cours du paramétrage, l'Assistant Paramétrage du moteur de base de données crée une base de données shell sur le serveur de test.</span><span class="sxs-lookup"><span data-stu-id="34b3c-125">During the tuning process, Database Engine Tuning Advisor creates a shell database on the test server.</span></span> <span data-ttu-id="34b3c-126">Pour créer cette base de données shell et la paramétrer, l'Assistant Paramétrage du moteur de base de données envoie des appels au serveur de production :</span><span class="sxs-lookup"><span data-stu-id="34b3c-126">To create this shell database and tune it, Database Engine Tuning Advisor makes calls to the production server for the following:</span></span>

    1.  [!INCLUDE[ssDE](../../../includes/ssde-md.md)] <span data-ttu-id="34b3c-127">L’Assistant Paramétrage importe des métadonnées de la base de données de production pour tester la base de données shell du serveur de test.</span><span class="sxs-lookup"><span data-stu-id="34b3c-127">Tuning Advisor imports metadata from the production database to the test server shell database.</span></span> <span data-ttu-id="34b3c-128">Les métadonnées incluent des tables, des index, des vues des procédures stockées, des déclencheurs vides, etc.</span><span class="sxs-lookup"><span data-stu-id="34b3c-128">This metadata includes empty tables, indexes, views, stored procedures, triggers, and so on.</span></span> <span data-ttu-id="34b3c-129">Ceci permet aux requêtes de charge de travail de s'exécuter par rapport à la base de données shell du serveur de test.</span><span class="sxs-lookup"><span data-stu-id="34b3c-129">This makes it possible for the workload queries to execute against the test server shell database.</span></span>

    2.  [!INCLUDE[ssDE](../../../includes/ssde-md.md)] <span data-ttu-id="34b3c-130">L’Assistant Paramétrage importe des statistiques du serveur de production pour que l’optimiseur de requêtes puisse optimiser précisément les requêtes sur le serveur de test.</span><span class="sxs-lookup"><span data-stu-id="34b3c-130">Tuning Advisor imports statistics from the production server so the query optimizer can accurately optimize queries on the test server.</span></span>

    3.  [!INCLUDE[ssDE](../../../includes/ssde-md.md)] <span data-ttu-id="34b3c-131">L’Assistant Paramétrage importe des paramètres matériels définissant le nombre de processeurs et la mémoire disponible sur le serveur de production, afin de fournir à l’optimiseur de requêtes les informations dont il a besoin pour générer un plan de requête.</span><span class="sxs-lookup"><span data-stu-id="34b3c-131">Tuning Advisor imports hardware parameters specifying the number of processors and available memory from the production server to provide the query optimizer with the information it needs to generate a query plan.</span></span>

3.  <span data-ttu-id="34b3c-132">Une fois que l’Assistant Paramétrage du [!INCLUDE[ssDE](../../../includes/ssde-md.md)] a paramétré la base de données shell du serveur de test, il génère une recommandation de paramétrage.</span><span class="sxs-lookup"><span data-stu-id="34b3c-132">After [!INCLUDE[ssDE](../../../includes/ssde-md.md)] Tuning Advisor finishes tuning the test server shell database, it generates a tuning recommendation.</span></span>

4.  <span data-ttu-id="34b3c-133">Appliquez la recommandation résultant du paramétrage du serveur de test au serveur de production.</span><span class="sxs-lookup"><span data-stu-id="34b3c-133">Apply the recommendation received from tuning the test server to the production server.</span></span>

 <span data-ttu-id="34b3c-134">L'illustration suivante montre le scénario du serveur de test et du serveur de production :</span><span class="sxs-lookup"><span data-stu-id="34b3c-134">The following illustration shows the test server and production server scenario:</span></span>

 <span data-ttu-id="34b3c-135">![Utilisation du serveur test de l’Assistant Paramétrage du moteur de base de données](../../database-engine/media/testsvr.gif "Utilisation du serveur test de l’Assistant Paramétrage du moteur de base de données")</span><span class="sxs-lookup"><span data-stu-id="34b3c-135">![Database Engine Tuning Advisor test server usage](../../database-engine/media/testsvr.gif "Database Engine Tuning Advisor test server usage")</span></span>

> [!NOTE]
>  <span data-ttu-id="34b3c-136">La fonction de paramétrage du serveur de test n'est pas prise en charge par l'interface utilisateur graphique de l'Assistant Paramétrage du [!INCLUDE[ssDE](../../../includes/ssde-md.md)] .</span><span class="sxs-lookup"><span data-stu-id="34b3c-136">The test server tuning feature is not supported in the [!INCLUDE[ssDE](../../../includes/ssde-md.md)] Tuning Advisor graphical user interface (GUI).</span></span>

## <a name="example"></a><span data-ttu-id="34b3c-137">Exemple</span><span class="sxs-lookup"><span data-stu-id="34b3c-137">Example</span></span>
 <span data-ttu-id="34b3c-138">Tout d'abord, vérifiez que l'utilisateur qui veut effectuer le paramétrage existe sur le serveur de test et sur le serveur de production.</span><span class="sxs-lookup"><span data-stu-id="34b3c-138">First, make sure that the user who wants to perform the tuning exists on both the test and production servers.</span></span>

 <span data-ttu-id="34b3c-139">Une fois les informations de l'utilisateur copiées sur le serveur de test, vous pouvez définir la session de paramétrage du serveur de test dans le fichier d'entrée XML de l'Assistant Paramétrage du [!INCLUDE[ssDE](../../../includes/ssde-md.md)] .</span><span class="sxs-lookup"><span data-stu-id="34b3c-139">After the user information is copied over to your test server, you can define your test server tuning session in the [!INCLUDE[ssDE](../../../includes/ssde-md.md)] Tuning Advisor XML input file.</span></span> <span data-ttu-id="34b3c-140">L'exemple suivant de fichier d'entrée XML montre comment définir un serveur de test pour paramétrer une base de données avec l'Assistant Paramétrage du [!INCLUDE[ssDE](../../../includes/ssde-md.md)] .</span><span class="sxs-lookup"><span data-stu-id="34b3c-140">The following example XML input file illustrates how to specify a test server to tune a database with [!INCLUDE[ssDE](../../../includes/ssde-md.md)] Tuning Advisor.</span></span>

 <span data-ttu-id="34b3c-141">Dans cet exemple, la base de données `MyDatabaseName` est paramétrée sur `MyServerName`.</span><span class="sxs-lookup"><span data-stu-id="34b3c-141">In this example, the `MyDatabaseName` database is being tuned on `MyServerName`.</span></span> <span data-ttu-id="34b3c-142">Le script [!INCLUDE[tsql](../../includes/tsql-md.md)] , `MyWorkloadScript.sql`, est utilisé comme charge de travail.</span><span class="sxs-lookup"><span data-stu-id="34b3c-142">The [!INCLUDE[tsql](../../includes/tsql-md.md)] script, `MyWorkloadScript.sql`, is used as the workload.</span></span> <span data-ttu-id="34b3c-143">Cette charge de travail contient les événements exécutés par rapport à `MyDatabaseName`.</span><span class="sxs-lookup"><span data-stu-id="34b3c-143">This workload contains events that execute against `MyDatabaseName`.</span></span> <span data-ttu-id="34b3c-144">La plupart des appels de l'optimiseur de requêtes vers cette base de données, qui sont effectués au cours du paramétrage, sont gérés par la base de données shell qui réside sur `MyTestServerName`.</span><span class="sxs-lookup"><span data-stu-id="34b3c-144">Most of the query optimizer calls to this database, which occur as part of the tuning process, are handled by the shell database that resides on `MyTestServerName`.</span></span> <span data-ttu-id="34b3c-145">La base de données shell est constituée de métadonnées et de statistiques.</span><span class="sxs-lookup"><span data-stu-id="34b3c-145">The shell database is composed of metadata and statistics.</span></span> <span data-ttu-id="34b3c-146">Ce processus permet de décharger la surcharge de paramétrage vers le serveur de test.</span><span class="sxs-lookup"><span data-stu-id="34b3c-146">This process results in the tuning overhead being offloaded to the test server.</span></span> <span data-ttu-id="34b3c-147">Lorsque l'Assistant Paramétrage du [!INCLUDE[ssDE](../../../includes/ssde-md.md)] génère sa recommandation de paramétrage en utilisant ce fichier d'entrée XML, il ne doit tenir compte que des index (`<FeatureSet>IDX</FeatureSet>`). Il ne doit pas tenir compte du partitionnement et il n'a pas besoin de conserver les structures de conception physiques existantes dans `MyDatabaseName`.</span><span class="sxs-lookup"><span data-stu-id="34b3c-147">When [!INCLUDE[ssDE](../../../includes/ssde-md.md)] Tuning Advisor generates its tuning recommendation using this XML input file, it should consider indexes only (`<FeatureSet>IDX</FeatureSet>`), no partitioning, and need not keep any of the existing physical design structures in `MyDatabaseName`.</span></span>

```
<?xml version="1.0" encoding="utf-16" ?>
<DTAXML xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xmlns="https://schemas.microsoft.com/sqlserver/2004/07/dta">
  <DTAInput>
    <Server>
      <Name>MyServerName</Name>
      <Database>
        <Name>MyDatabaseName</Name>
      </Database>
    </Server>
    <Workload>
      <File>MyWorkloadScript.sql</File>
    </Workload>
    <TuningOptions>
      <TestServer>MyTestServerName</TestServer>
      <FeatureSet>IDX</FeatureSet>
      <Partitioning>NONE</Partitioning>
      <KeepExisting>NONE</KeepExisting>
    </TuningOptions>
  </DTAInput>
</DTAXML>
```

## <a name="see-also"></a><span data-ttu-id="34b3c-148">Voir aussi</span><span class="sxs-lookup"><span data-stu-id="34b3c-148">See Also</span></span>
 <span data-ttu-id="34b3c-149">[Considérations relatives à l’utilisation des serveurs de test référence du](considerations-for-using-test-servers.md) [fichier d’entrée XML &#40;Assistant Paramétrage du moteur de base de données&#41;](database-engine-tuning-advisor.md)</span><span class="sxs-lookup"><span data-stu-id="34b3c-149">[Considerations for Using Test Servers](considerations-for-using-test-servers.md) [XML Input File Reference &#40;Database Engine Tuning Advisor&#41;](database-engine-tuning-advisor.md)</span></span>


