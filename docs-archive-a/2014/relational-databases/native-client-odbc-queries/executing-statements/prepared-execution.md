---
title: Exécution préparée | Microsoft Docs
ms.custom: ''
ms.date: 06/13/2017
ms.prod: sql-server-2014
ms.reviewer: ''
ms.technology: native-client
ms.topic: reference
helpviewer_keywords:
- deferred statement preparation
- prepared execution [ODBC]
- SQLPrepare function
- ODBC applications, statements
- SQLExecute function
- statements [ODBC], prepared execution
ms.assetid: f3a9d32b-6cd7-4f0c-b38d-c8ccc4ee40c3
author: rothja
ms.author: jroth
ms.openlocfilehash: 33ab9f35cd9d3eaf04e688a89390b5eb3f00ae58
ms.sourcegitcommit: ad4d92dce894592a259721a1571b1d8736abacdb
ms.translationtype: MT
ms.contentlocale: fr-FR
ms.lasthandoff: 08/04/2020
ms.locfileid: "87600856"
---
# <a name="prepared-execution"></a><span data-ttu-id="9a0e2-102">Exécution préparée</span><span class="sxs-lookup"><span data-stu-id="9a0e2-102">Prepared Execution</span></span>
  <span data-ttu-id="9a0e2-103">L'API ODBC définit l'exécution préparée comme un moyen de réduire la charge d'analyse et de compilation associée à l'exécution répétée d'une instruction [!INCLUDE[tsql](../../../includes/tsql-md.md)].</span><span class="sxs-lookup"><span data-stu-id="9a0e2-103">The ODBC API defines prepared execution as a way to reduce the parsing and compiling overhead associated with repeatedly executing a [!INCLUDE[tsql](../../../includes/tsql-md.md)] statement.</span></span> <span data-ttu-id="9a0e2-104">L'application génère une chaîne de caractères contenant une instruction SQL, puis l'exécute en deux étapes.</span><span class="sxs-lookup"><span data-stu-id="9a0e2-104">The application builds a character string containing an SQL statement and then executes it in two stages.</span></span> <span data-ttu-id="9a0e2-105">Elle appelle la [fonction SQLPrepare](https://go.microsoft.com/fwlink/?LinkId=59360) une fois pour que l’instruction soit analysée et compilée dans un plan d’exécution par le [!INCLUDE[ssDE](../../../includes/ssde-md.md)] .</span><span class="sxs-lookup"><span data-stu-id="9a0e2-105">It calls [SQLPrepare Function](https://go.microsoft.com/fwlink/?LinkId=59360) once to have the statement parsed and compiled into an execution plan by the [!INCLUDE[ssDE](../../../includes/ssde-md.md)].</span></span> <span data-ttu-id="9a0e2-106">Il appelle ensuite **SQLExecute** pour chaque exécution du plan d’exécution préparé.</span><span class="sxs-lookup"><span data-stu-id="9a0e2-106">It then calls **SQLExecute** for each execution of the prepared execution plan.</span></span> <span data-ttu-id="9a0e2-107">Cela permet de réduire la charge d'analyse et de compilation pour chaque exécution.</span><span class="sxs-lookup"><span data-stu-id="9a0e2-107">This saves the parsing and compiling overhead on each execution.</span></span> <span data-ttu-id="9a0e2-108">L'exécution préparée est couramment utilisée par les applications pour exécuter de manière répétée la même instruction SQL paramétrable.</span><span class="sxs-lookup"><span data-stu-id="9a0e2-108">Prepared execution is commonly used by applications to repeatedly execute the same, parameterized SQL statement.</span></span>  
  
 <span data-ttu-id="9a0e2-109">Avec la plupart des bases de données, l'exécution préparée est plus rapide que l'exécution directe pour les instructions qui sont exécutées plus de trois ou quatre fois principalement du fait que l'instruction est compilée une seule fois, alors que les instructions exécutées directement sont compilées chaque fois qu'elles sont exécutées.</span><span class="sxs-lookup"><span data-stu-id="9a0e2-109">For most databases, prepared execution is faster than direct execution for statements executed more than three or four times primarily because the statement is compiled only once, while statements executed directly are compiled each time they are executed.</span></span> <span data-ttu-id="9a0e2-110">L'exécution préparée peut également permettre de réduire le trafic réseau car le pilote peut envoyer un identificateur de plan d'exécution et les valeurs de paramètre, plutôt qu'une instruction SQL entière, à la source de données chaque fois que l'instruction est exécutée.</span><span class="sxs-lookup"><span data-stu-id="9a0e2-110">Prepared execution can also provide a reduction in network traffic because the driver can send an execution plan identifier and the parameter values, rather than an entire SQL statement, to the data source each time the statement is executed.</span></span>  
  
 [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)]<span data-ttu-id="9a0e2-111">réduit la différence de performances entre l’exécution directe et préparée via des algorithmes améliorés pour la détection et la réutilisation des plans d’exécution à partir de **SQLExecDirect**.</span><span class="sxs-lookup"><span data-stu-id="9a0e2-111">reduces the performance difference between direct and prepared execution through improved algorithms for detecting and reusing execution plans from **SQLExecDirect**.</span></span> <span data-ttu-id="9a0e2-112">Les avantages de l'exécution préparée en termes de performances s'étendent ainsi dans une certaine mesure aux instructions exécutées directement.</span><span class="sxs-lookup"><span data-stu-id="9a0e2-112">This makes some of the performance benefits of prepared execution available to statements executed directly.</span></span> <span data-ttu-id="9a0e2-113">Pour plus d’informations, consultez [exécution directe](direct-execution.md).</span><span class="sxs-lookup"><span data-stu-id="9a0e2-113">For more information, see [Direct Execution](direct-execution.md).</span></span>  
  
 [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] <span data-ttu-id="9a0e2-114">proposent également la prise en charge native de l'exécution préparée.</span><span class="sxs-lookup"><span data-stu-id="9a0e2-114">also provides native support for prepared execution.</span></span> <span data-ttu-id="9a0e2-115">Un plan d’exécution est créé sur **SQLPrepare** et exécuté ultérieurement lorsque **SQLExecute** est appelé.</span><span class="sxs-lookup"><span data-stu-id="9a0e2-115">An execution plan is built on **SQLPrepare** and later executed when **SQLExecute** is called.</span></span> <span data-ttu-id="9a0e2-116">Étant donné que [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] n’est pas requis pour générer des procédures stockées temporaires sur **SQLPrepare**, il n’y a aucune surcharge supplémentaire sur les tables système dans **tempdb**.</span><span class="sxs-lookup"><span data-stu-id="9a0e2-116">Because [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] is not required to build temporary stored procedures on **SQLPrepare**, there is no extra overhead on the system tables in **tempdb**.</span></span>  
  
 <span data-ttu-id="9a0e2-117">Pour des raisons de performances, la préparation de l’instruction est différée jusqu’à ce que **SQLExecute** soit appelé ou qu’une opération de métapropriété (telle que [SQLDescribeCol](../../native-client-odbc-api/sqldescribecol.md) ou [SQLDescribeParam](../../native-client-odbc-api/sqldescribeparam.md) dans ODBC) soit exécutée.</span><span class="sxs-lookup"><span data-stu-id="9a0e2-117">For performance reasons, the statement preparation is deferred until **SQLExecute** is called or a metaproperty operation (such as [SQLDescribeCol](../../native-client-odbc-api/sqldescribecol.md) or [SQLDescribeParam](../../native-client-odbc-api/sqldescribeparam.md) in ODBC) is performed.</span></span> <span data-ttu-id="9a0e2-118">Il s'agit du comportement par défaut.</span><span class="sxs-lookup"><span data-stu-id="9a0e2-118">This is the default behavior.</span></span> <span data-ttu-id="9a0e2-119">Toute erreur dans l'instruction en cours de préparée reste inconnue tant que l'instruction n'a pas été exécutée ou qu'une opération de métapropriété n'a pas été effectuée.</span><span class="sxs-lookup"><span data-stu-id="9a0e2-119">Any errors in the statement being prepared are not known until the statement is executed or a metaproperty operation is performed.</span></span> <span data-ttu-id="9a0e2-120">La définition de l'attribut SQL_SOPT_SS_DEFER_PREPARE de l'instruction spécifique au pilote ODBC  [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)]  Native Client sur  SQL_DP_OFF peut désactiver ce comportement par défaut.</span><span class="sxs-lookup"><span data-stu-id="9a0e2-120">Setting the [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] Native Client ODBC driver-specific statement attribute SQL_SOPT_SS_DEFER_PREPARE to SQL_DP_OFF can turn off this default behavior.</span></span>  
  
 <span data-ttu-id="9a0e2-121">Dans le cas d’une préparation différée, l’appel de **SQLDescribeCol** ou **SQLDescribeParam** avant l’appel de **SQLExecute** génère un aller-retour supplémentaire au serveur.</span><span class="sxs-lookup"><span data-stu-id="9a0e2-121">In case of deferred prepare, calling either **SQLDescribeCol** or **SQLDescribeParam** before calling **SQLExecute** generates an extra roundtrip to the server.</span></span> <span data-ttu-id="9a0e2-122">Sur **SQLDescribeCol**, le pilote supprime la clause WHERE de la requête et l’envoie au serveur avec SET FMTONLY on pour obtenir la description des colonnes du premier jeu de résultats retourné par la requête.</span><span class="sxs-lookup"><span data-stu-id="9a0e2-122">On **SQLDescribeCol**, the driver removes the WHERE clause from the query and sends it to the server with SET FMTONLY ON to get the description of the columns in the first result set returned by the query.</span></span> <span data-ttu-id="9a0e2-123">Sur **SQLDescribeParam**, le pilote appelle le serveur pour obtenir une description des expressions ou des colonnes référencées par les marqueurs de paramètres dans la requête.</span><span class="sxs-lookup"><span data-stu-id="9a0e2-123">On **SQLDescribeParam**, the driver calls the server to get a description of the expressions or columns referenced by any parameter markers in the query.</span></span> <span data-ttu-id="9a0e2-124">Cette méthode présente également certaines restrictions, comme le fait qu'elle ne permette pas de résoudre les paramètres dans les sous-requêtes.</span><span class="sxs-lookup"><span data-stu-id="9a0e2-124">This method also has some restrictions, such as not being able to resolve parameters in subqueries.</span></span>  
  
 <span data-ttu-id="9a0e2-125">L’utilisation excessive de **SQLPrepare** avec le [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] pilote ODBC Native Client dégrade les performances, en particulier quand il est connecté à des versions antérieures de SQL Server.</span><span class="sxs-lookup"><span data-stu-id="9a0e2-125">Excess use of **SQLPrepare** with the [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] Native Client ODBC driver degrades performance, especially when connected to earlier versions of SQL Server.</span></span> <span data-ttu-id="9a0e2-126">L'exécution préparée ne doit pas être utilisée pour les instructions exécutées une seule fois.</span><span class="sxs-lookup"><span data-stu-id="9a0e2-126">Prepared execution should not be used for statements executed a single time.</span></span> <span data-ttu-id="9a0e2-127">L'exécution préparée est plus lente que l'exécution directe en cas d'exécution unique d'une instruction car elle requiert un aller-retour réseau supplémentaire entre le client et le serveur.</span><span class="sxs-lookup"><span data-stu-id="9a0e2-127">Prepared execution is slower than direct execution for a single execution of a statement because it requires an extra network roundtrip from the client to the server.</span></span> <span data-ttu-id="9a0e2-128">Sur les versions antérieures de [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)], elle génère également une procédure stockée temporaire.</span><span class="sxs-lookup"><span data-stu-id="9a0e2-128">On earlier versions of [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] it also generates a temporary stored procedure.</span></span>  
  
 <span data-ttu-id="9a0e2-129">Les instructions préparées ne peuvent pas être utilisées pour la création d'objets temporaires dans [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)].</span><span class="sxs-lookup"><span data-stu-id="9a0e2-129">Prepared statements cannot be used to create temporary objects on [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)].</span></span>  
  
 <span data-ttu-id="9a0e2-130">Certaines anciennes applications ODBC utilisaient **SQLPrepare** à chaque fois que [SQLBindParameter](../../native-client-odbc-api/sqlbindparameter.md) était utilisé.</span><span class="sxs-lookup"><span data-stu-id="9a0e2-130">Some early ODBC applications used **SQLPrepare** any time [SQLBindParameter](../../native-client-odbc-api/sqlbindparameter.md) was used.</span></span> <span data-ttu-id="9a0e2-131">**SQLBindParameter** ne requiert pas l’utilisation de **SQLPrepare**, il peut être utilisé avec **SQLExecDirect**.</span><span class="sxs-lookup"><span data-stu-id="9a0e2-131">**SQLBindParameter** does not require the use of **SQLPrepare**, it can be used with **SQLExecDirect**.</span></span> <span data-ttu-id="9a0e2-132">Par exemple, utilisez **SQLExecDirect** avec **SQLBindParameter** pour récupérer le code de retour ou les paramètres de sortie d’une procédure stockée qui n’est exécutée qu’une seule fois.</span><span class="sxs-lookup"><span data-stu-id="9a0e2-132">For example, use **SQLExecDirect** with **SQLBindParameter** to retrieve the return code or output parameters from a stored procedure that is only executed one time.</span></span> <span data-ttu-id="9a0e2-133">N’utilisez pas **SQLPrepare** avec **SQLBindParameter** , sauf si la même instruction est exécutée plusieurs fois.</span><span class="sxs-lookup"><span data-stu-id="9a0e2-133">Do not use **SQLPrepare** with **SQLBindParameter** unless the same statement will be executed multiple times.</span></span>  
  
## <a name="see-also"></a><span data-ttu-id="9a0e2-134">Voir aussi</span><span class="sxs-lookup"><span data-stu-id="9a0e2-134">See Also</span></span>  
 [<span data-ttu-id="9a0e2-135">Exécution d’instructions &#40;ODBC&#41;</span><span class="sxs-lookup"><span data-stu-id="9a0e2-135">Executing Statements &#40;ODBC&#41;</span></span>](executing-statements-odbc.md)  
  
  
