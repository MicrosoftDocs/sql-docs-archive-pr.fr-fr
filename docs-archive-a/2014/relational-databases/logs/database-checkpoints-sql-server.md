---
title: Points de contrôle de base de données (SQL Server) | Microsoft Docs
ms.custom: ''
ms.date: 10/13/2015
ms.prod: sql-server-2014
ms.reviewer: ''
ms.technology: supportability
ms.topic: conceptual
helpviewer_keywords:
- automatic checkpoints
- transaction logs [SQL Server], checkpoints
- logs [SQL Server], active
- pages [SQL Server], dirty
- MinLSN
- checkpoints [SQL Server]
- pages [SQL Server], flushing
- dirty pages
- transaction logs [SQL Server], active logs
- recovery interval option [SQL Server]
- buffer cache [SQL Server]
- logs [SQL Server], checkpoints
- Minimum Recovery LSN
- flushing pages
- active logs
ms.assetid: 98a80238-7409-4708-8a7d-5defd9957185
author: MashaMSFT
ms.author: mathoma
ms.openlocfilehash: 5776d4a23223637c50ac40098fa44342d5cd94a9
ms.sourcegitcommit: ad4d92dce894592a259721a1571b1d8736abacdb
ms.translationtype: MT
ms.contentlocale: fr-FR
ms.lasthandoff: 08/04/2020
ms.locfileid: "87603992"
---
# <a name="database-checkpoints-sql-server"></a><span data-ttu-id="86a27-102">Points de contrôle de base de données (SQL Server)</span><span class="sxs-lookup"><span data-stu-id="86a27-102">Database Checkpoints (SQL Server)</span></span>
  <span data-ttu-id="86a27-103">Cette rubrique fournit une vue d'ensemble des points de contrôle de base de données [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] .</span><span class="sxs-lookup"><span data-stu-id="86a27-103">This topic provides an overview of [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] database checkpoints.</span></span> <span data-ttu-id="86a27-104">Un *point de contrôle* permet la création d'un point de référence connu et fiable à partir duquel le [!INCLUDE[ssDEnoversion](../../includes/ssdenoversion-md.md)] peut, lors d'une récupération faisant suite à une panne ou à un arrêt imprévu, commencer à appliquer les modifications contenues dans le journal.</span><span class="sxs-lookup"><span data-stu-id="86a27-104">A *checkpoint* creates a known good point from which the [!INCLUDE[ssDEnoversion](../../includes/ssdenoversion-md.md)] can start applying changes contained in the log during recovery after an unexpected shutdown or crash.</span></span>  
  
  
##  <a name="overview-of-checkpoints"></a><a name="Overview"></a><span data-ttu-id="86a27-105">Vue d’ensemble des points de contrôle</span><span class="sxs-lookup"><span data-stu-id="86a27-105">Overview of Checkpoints</span></span>  
 <span data-ttu-id="86a27-106">Pour des raisons de performances, le [!INCLUDE[ssDE](../../includes/ssde-md.md)] procède aux modifications des pages de base de données en mémoire (dans le cache des tampons) sans écrire ces pages sur le disque après chaque modification.</span><span class="sxs-lookup"><span data-stu-id="86a27-106">For performance reasons, the [!INCLUDE[ssDE](../../includes/ssde-md.md)] performs modifications to database pages in memory-in the buffer cache-and does not write these pages to disk after every change.</span></span> <span data-ttu-id="86a27-107">En revanche, le [!INCLUDE[ssDE](../../includes/ssde-md.md)] publie périodiquement un point de contrôle dans chaque base de données.</span><span class="sxs-lookup"><span data-stu-id="86a27-107">Rather, the [!INCLUDE[ssDE](../../includes/ssde-md.md)] periodically issues a checkpoint on each database.</span></span> <span data-ttu-id="86a27-108">Un *point de contrôle* écrit les pages modifiées en mémoire actuelles (appelées *pages de modifications*), les informations du journal des transactions de la mémoire vers le disque et enregistre également les informations concernant le journal des transactions.</span><span class="sxs-lookup"><span data-stu-id="86a27-108">A *checkpoint* writes the current in-memory modified pages (known as *dirty pages*) and transaction log information from memory to disk and, also, records information about the transaction log.</span></span>  
  
 <span data-ttu-id="86a27-109">Le [!INCLUDE[ssDE](../../includes/ssde-md.md)] prend en charge plusieurs types de points de contrôle : automatique, indirect, manuel et interne.</span><span class="sxs-lookup"><span data-stu-id="86a27-109">The [!INCLUDE[ssDE](../../includes/ssde-md.md)] supports several types of checkpoints: automatic, indirect, manual, and internal.</span></span> <span data-ttu-id="86a27-110">Le tableau suivant récapitule les types de points de contrôle.</span><span class="sxs-lookup"><span data-stu-id="86a27-110">The following table summarizes the types of checkpoints.</span></span>  
  
|<span data-ttu-id="86a27-111">Nom</span><span class="sxs-lookup"><span data-stu-id="86a27-111">Name</span></span>|[!INCLUDE[tsql](../../includes/tsql-md.md)] <span data-ttu-id="86a27-112">.</span><span class="sxs-lookup"><span data-stu-id="86a27-112">Interface</span></span>|<span data-ttu-id="86a27-113">Description</span><span class="sxs-lookup"><span data-stu-id="86a27-113">Description</span></span>|  
|----------|----------------------------------|-----------------|  
|<span data-ttu-id="86a27-114">Automatique</span><span class="sxs-lookup"><span data-stu-id="86a27-114">Automatic</span></span>|<span data-ttu-id="86a27-115">EXEC sp_configure \*\*« `recovery interval` », « *`seconds`* \*\* »</span><span class="sxs-lookup"><span data-stu-id="86a27-115">EXEC sp_configure **'`recovery interval`','*`seconds`*'**</span></span>|<span data-ttu-id="86a27-116">Émis automatiquement en arrière-plan pour respecter la limite de temps supérieure suggérée par l' `recovery interval` option de configuration de serveur.</span><span class="sxs-lookup"><span data-stu-id="86a27-116">Issued automatically in the background to meet the upper time limit suggested by the `recovery interval` server configuration option.</span></span> <span data-ttu-id="86a27-117">Les points de contrôle automatiques s'exécutent jusqu'à la fin.</span><span class="sxs-lookup"><span data-stu-id="86a27-117">Automatic checkpoints run to completion.</span></span>  <span data-ttu-id="86a27-118">Les points de contrôle automatiques sont accélérés en fonction du nombre d'écritures en attente et si le [!INCLUDE[ssDE](../../includes/ssde-md.md)] détecte une augmentation de latence d'écriture supérieure à 20 millisecondes.</span><span class="sxs-lookup"><span data-stu-id="86a27-118">Automatic checkpoints are throttled based on the number of outstanding writes and whether the [!INCLUDE[ssDE](../../includes/ssde-md.md)] detects an increase in write latency above 20 milliseconds.</span></span><br /><br /> <span data-ttu-id="86a27-119">Pour plus d'informations, consultez [Configure the recovery interval Server Configuration Option](../../database-engine/configure-windows/configure-the-recovery-interval-server-configuration-option.md).</span><span class="sxs-lookup"><span data-stu-id="86a27-119">For more information, see [Configure the recovery interval Server Configuration Option](../../database-engine/configure-windows/configure-the-recovery-interval-server-configuration-option.md).</span></span>|  
|<span data-ttu-id="86a27-120">Indirect</span><span class="sxs-lookup"><span data-stu-id="86a27-120">Indirect</span></span>|<span data-ttu-id="86a27-121">MODIFIER LA BASE DE DONNÉES... DÉFINIR TARGET_RECOVERY_TIME **=** _target_recovery_time_ {seconds &#124; minutes}</span><span class="sxs-lookup"><span data-stu-id="86a27-121">ALTER DATABASE ... SET TARGET_RECOVERY_TIME **=**_target_recovery_time_ { SECONDS &#124; MINUTES }</span></span>|<span data-ttu-id="86a27-122">Émis en arrière-plan pour obtenir un temps de récupération cible spécifié par l'utilisateur pour une base de données.</span><span class="sxs-lookup"><span data-stu-id="86a27-122">Issued in the background to meet a user-specified target recovery time for a given database.</span></span> <span data-ttu-id="86a27-123">Le temps de récupération cible par défaut est 0, ce qui provoque l'utilisation de l'heuristique du point de contrôle automatique sur la base de données.</span><span class="sxs-lookup"><span data-stu-id="86a27-123">The default target recovery time is 0, which causes automatic checkpoint heuristics to be used on the database.</span></span> <span data-ttu-id="86a27-124">Si vous avez utilisé ALTER DATABASE pour définir TARGET_RECOVERY_TIME à >0, cette valeur est utilisée, plutôt que l'intervalle de récupération spécifié pour l'instance de serveur.</span><span class="sxs-lookup"><span data-stu-id="86a27-124">If you have used ALTER DATABASE to set TARGET_RECOVERY_TIME to >0, this value is used, rather than the recovery interval specified for the server instance.</span></span><br /><br /> <span data-ttu-id="86a27-125">Pour plus d’informations, consultez [Modifier la durée de récupération cible d’une base de données &#40;SQL Server&#41;](change-the-target-recovery-time-of-a-database-sql-server.md).</span><span class="sxs-lookup"><span data-stu-id="86a27-125">For more information, see [Change the Target Recovery Time of a Database &#40;SQL Server&#41;](change-the-target-recovery-time-of-a-database-sql-server.md).</span></span>|  
|<span data-ttu-id="86a27-126">Manuel</span><span class="sxs-lookup"><span data-stu-id="86a27-126">Manual</span></span>|<span data-ttu-id="86a27-127">CHECKPOINT [ *checkpoint_duration* ]</span><span class="sxs-lookup"><span data-stu-id="86a27-127">CHECKPOINT [ *checkpoint_duration* ]</span></span>|<span data-ttu-id="86a27-128">Émis lorsque vous exécutez une commande CHECKPOINT [!INCLUDE[tsql](../../includes/tsql-md.md)] .</span><span class="sxs-lookup"><span data-stu-id="86a27-128">Issued when you execute a [!INCLUDE[tsql](../../includes/tsql-md.md)] CHECKPOINT command.</span></span> <span data-ttu-id="86a27-129">Le point de contrôle manuel intervient dans la base de données active pour votre connexion.</span><span class="sxs-lookup"><span data-stu-id="86a27-129">The manual checkpoint occurs in the current database for your connection.</span></span> <span data-ttu-id="86a27-130">Par défaut, les points de contrôle manuels s'exécutent jusqu'à la fin.</span><span class="sxs-lookup"><span data-stu-id="86a27-130">By default, manual checkpoints run to completion.</span></span> <span data-ttu-id="86a27-131">L'accélération fonctionne de la même manière que pour les points de contrôle automatiques.</span><span class="sxs-lookup"><span data-stu-id="86a27-131">Throttling works the same way as for automatic checkpoints.</span></span>  <span data-ttu-id="86a27-132">Le paramètre *checkpoint_duration* peut aussi spécifier la durée demandée (en secondes) de l’exécution du point de contrôle.</span><span class="sxs-lookup"><span data-stu-id="86a27-132">Optionally, the *checkpoint_duration* parameter specifies a requested amount of time, in seconds, for the checkpoint to complete.</span></span><br /><br /> <span data-ttu-id="86a27-133">Pour plus d'informations, consultez [CHECKPOINT &#40;Transact-SQL&#41;](/sql/t-sql/language-elements/checkpoint-transact-sql).</span><span class="sxs-lookup"><span data-stu-id="86a27-133">For more information, see [CHECKPOINT &#40;Transact-SQL&#41;](/sql/t-sql/language-elements/checkpoint-transact-sql).</span></span>|  
|<span data-ttu-id="86a27-134">Interne</span><span class="sxs-lookup"><span data-stu-id="86a27-134">Internal</span></span>|<span data-ttu-id="86a27-135">Aucun.</span><span class="sxs-lookup"><span data-stu-id="86a27-135">None.</span></span>|<span data-ttu-id="86a27-136">Émis par différentes opérations de serveur, telles que la création de sauvegarde et d'instantané de base de données pour garantir que les images de disque correspondent à l'état actuel du journal.</span><span class="sxs-lookup"><span data-stu-id="86a27-136">Issued by various server operations such as backup and database-snapshot creation to guarantee that disk images match the current state of the log.</span></span>|  
  
> [!NOTE]  
>  <span data-ttu-id="86a27-137">L'option d'installation avancée `-k`[!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] permet à un administrateur de base de données de limiter le comportement d'E/S de point de contrôle en fonction du débit du sous-système d'E/S pour certains types de points de contrôle.</span><span class="sxs-lookup"><span data-stu-id="86a27-137">The `-k`[!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] advanced setup option enables a database administrator to throttle checkpoint I/O behavior based on the throughput of the I/O subsystem for some types of checkpoints.</span></span> <span data-ttu-id="86a27-138">L' `-k` option d’installation s’applique aux points de contrôle automatiques et à tout autre point de contrôle interne et manuel non limité.</span><span class="sxs-lookup"><span data-stu-id="86a27-138">The `-k` setup option applies to automatic checkpoints and any otherwise unthrottled manual and internal checkpoints.</span></span>  
  
 <span data-ttu-id="86a27-139">Pour les points de contrôle automatiques, manuels et internes, seules les modifications apportées après le dernier point de contrôle doivent être restaurées par progression lors de la récupération de la base de données.</span><span class="sxs-lookup"><span data-stu-id="86a27-139">For automatic, manual, and internal checkpoints, only modifications made after the latest checkpoint need to be rolled forward during database recovery.</span></span> <span data-ttu-id="86a27-140">Cela réduit le temps nécessaire pour récupérer une base de données.</span><span class="sxs-lookup"><span data-stu-id="86a27-140">This reduces the time required to recover a database.</span></span>  
  
> [!IMPORTANT]  
>  <span data-ttu-id="86a27-141">Les transactions non validées longues augmentent le temps de récupération pour tous les types de points de contrôle.</span><span class="sxs-lookup"><span data-stu-id="86a27-141">Long-running uncommitted transactions increase recovery time for all types of checkpoints.</span></span>  
  
  
  
###  <a name="interaction-of-the-target_recovery_time-and-recovery-interval-options"></a><a name="InteractionBwnSettings"></a> <span data-ttu-id="86a27-142">Interaction des options TARGET_RECOVERY_TIME et « recovery interval »</span><span class="sxs-lookup"><span data-stu-id="86a27-142">Interaction of the TARGET_RECOVERY_TIME and 'recovery interval' Options</span></span>  
 <span data-ttu-id="86a27-143">Le tableau suivant résume l’interaction entre le paramètre de l' \*\*sp_configure `recovery interval` \*\* à l’ensemble du serveur et l’instruction ALTER DATABASE propre à la base de données... Paramètre TARGET_RECOVERY_TIME.</span><span class="sxs-lookup"><span data-stu-id="86a27-143">The following table summarizes the interaction between the server-wide **sp_configure'`recovery interval`'** setting and the database-specific ALTER DATABASE ... TARGET_RECOVERY_TIME setting.</span></span>  
  
|<span data-ttu-id="86a27-144">target_recovery_time</span><span class="sxs-lookup"><span data-stu-id="86a27-144">TARGET_RECOVERY_TIME</span></span>|<span data-ttu-id="86a27-145">'recovery interval'</span><span class="sxs-lookup"><span data-stu-id="86a27-145">'recovery interval'</span></span>|<span data-ttu-id="86a27-146">Type de point de contrôle utilisé</span><span class="sxs-lookup"><span data-stu-id="86a27-146">Type of Checkpoint Used</span></span>|  
|----------------------------|-------------------------|-----------------------------|  
|<span data-ttu-id="86a27-147">0</span><span class="sxs-lookup"><span data-stu-id="86a27-147">0</span></span>|<span data-ttu-id="86a27-148">0</span><span class="sxs-lookup"><span data-stu-id="86a27-148">0</span></span>|<span data-ttu-id="86a27-149">Points de contrôle automatiques dont l'intervalle de récupération cible est de 1 minute.</span><span class="sxs-lookup"><span data-stu-id="86a27-149">automatic checkpoints whose target recovery interval is 1 minute.</span></span>|  
|<span data-ttu-id="86a27-150">0</span><span class="sxs-lookup"><span data-stu-id="86a27-150">0</span></span>|<span data-ttu-id="86a27-151">>0</span><span class="sxs-lookup"><span data-stu-id="86a27-151">>0</span></span>|<span data-ttu-id="86a27-152">Points de contrôle automatiques dont l’intervalle de récupération cible est spécifié par le paramètre défini par l’utilisateur de l’option **sp_configurerecovery interval**.</span><span class="sxs-lookup"><span data-stu-id="86a27-152">Automatic checkpoints whose target recovery interval is specified by the user defined setting of the **sp_configurerecovery interval** option.</span></span>|  
|<span data-ttu-id="86a27-153">>0</span><span class="sxs-lookup"><span data-stu-id="86a27-153">>0</span></span>|<span data-ttu-id="86a27-154">Non applicable.</span><span class="sxs-lookup"><span data-stu-id="86a27-154">Not applicable.</span></span>|<span data-ttu-id="86a27-155">Points de contrôle indirects dont le temps de récupération cible est déterminé par le paramètre TARGET_RECOVERY_TIME, exprimé en secondes.</span><span class="sxs-lookup"><span data-stu-id="86a27-155">Indirect checkpoints whose target recovery time is determined by the TARGET_RECOVERY_TIME setting, expressed in seconds.</span></span>|  
  
###  <a name="automatic-checkpoints"></a><a name="AutomaticChkpt"></a><span data-ttu-id="86a27-156">Points de contrôle automatiques</span><span class="sxs-lookup"><span data-stu-id="86a27-156">Automatic Checkpoints</span></span>  
 <span data-ttu-id="86a27-157">Un point de contrôle automatique se produit chaque fois que le nombre d’enregistrements de journal atteint le nombre que le [!INCLUDE[ssDE](../../includes/ssde-md.md)] estime pouvoir traiter pendant la durée spécifiée dans l' `recovery interval` option de configuration de serveur.</span><span class="sxs-lookup"><span data-stu-id="86a27-157">An automatic checkpoint occurs each time that  the number of log records reaches the number the [!INCLUDE[ssDE](../../includes/ssde-md.md)] estimates it can process during the time specified in the `recovery interval` server configuration option.</span></span> <span data-ttu-id="86a27-158">Dans chaque base de données sans temps de récupération cible défini par l'utilisateur, le [!INCLUDE[ssDE](../../includes/ssde-md.md)] génère des points de contrôle automatiques.</span><span class="sxs-lookup"><span data-stu-id="86a27-158">In every database without a user-defined target recovery time, the [!INCLUDE[ssDE](../../includes/ssde-md.md)] generates automatic checkpoints.</span></span> <span data-ttu-id="86a27-159">La fréquence des points de contrôle automatiques dépend de l' `recovery interval` option de configuration de serveur avancée, qui spécifie la durée maximale pendant laquelle une instance de serveur donnée doit utiliser pour récupérer une base de données lors d’un redémarrage du système.</span><span class="sxs-lookup"><span data-stu-id="86a27-159">The frequency of automatic checkpoints depends on the `recovery interval` advanced server configuration option, which specifies the maximum time that a given server instance should use to recover a database during a system restart.</span></span> <span data-ttu-id="86a27-160">Le [!INCLUDE[ssDE](../../includes/ssde-md.md)] estime le nombre maximal d'enregistrements de journal qu'il peut traiter dans l'intervalle de récupération.</span><span class="sxs-lookup"><span data-stu-id="86a27-160">The [!INCLUDE[ssDE](../../includes/ssde-md.md)] estimates the maximum number of log records it can process within the recovery interval.</span></span> <span data-ttu-id="86a27-161">Lorsqu'une base de données qui utilise les points de contrôle automatiques atteint ce nombre maximal d'enregistrements du journal, le [!INCLUDE[ssDE](../../includes/ssde-md.md)] émet un point de contrôle sur la base de données.</span><span class="sxs-lookup"><span data-stu-id="86a27-161">When a database that is using automatic checkpoints reaches this maximum number of log records, the [!INCLUDE[ssDE](../../includes/ssde-md.md)] issues an checkpoint on the database.</span></span> <span data-ttu-id="86a27-162">L'intervalle de temps entre les points de contrôle automatiques peut varier fortement.</span><span class="sxs-lookup"><span data-stu-id="86a27-162">The time interval between automatic checkpoints can be highly variable.</span></span> <span data-ttu-id="86a27-163">Une base de données avec une charge de travail transactionnelle substantielle aura des points de contrôle plus fréquents qu'une base de données utilisée principalement pour des opérations en lecture seule.</span><span class="sxs-lookup"><span data-stu-id="86a27-163">A database with a substantial transaction workload will have more frequent checkpoints than a database that is used primarily for read-only operations.</span></span>  
  
 <span data-ttu-id="86a27-164">De plus, en mode de récupération simple, un point de contrôle automatique est également mis en file d'attente si le journal est rempli à 70 %.</span><span class="sxs-lookup"><span data-stu-id="86a27-164">Also, under the simple recovery model, an automatic checkpoint is also queued if the log becomes 70 percent full.</span></span>  
  
 <span data-ttu-id="86a27-165">En mode de récupération simple, à moins qu'un facteur retarde la troncation du journal, un point de contrôle automatique tronque la section inutilisée du journal des transactions.</span><span class="sxs-lookup"><span data-stu-id="86a27-165">Under the simple recovery model, unless some factor is delaying log truncation, an automatic checkpoint truncates the unused section of the transaction log.</span></span> <span data-ttu-id="86a27-166">À l'inverse, en mode de récupération utilisant les journaux de transactions, une fois qu'une chaîne de sauvegarde du journal a été établie, les points de contrôle automatiques ne provoquent pas la troncation du journal.</span><span class="sxs-lookup"><span data-stu-id="86a27-166">In contrast, under the full and bulk-logged recovery models, once a log backup chain has been established, automatic checkpoints do not cause log truncation.</span></span> <span data-ttu-id="86a27-167">Pour plus d'informations, consultez [Journal des transactions &#40;SQL Server&#41;](the-transaction-log-sql-server.md).</span><span class="sxs-lookup"><span data-stu-id="86a27-167">For more information, see [The Transaction Log &#40;SQL Server&#41;](the-transaction-log-sql-server.md).</span></span>  
  
 <span data-ttu-id="86a27-168">Après une panne système, le temps nécessaire pour récupérer une base de données dépend principalement de la quantité d'E/S aléatoire nécessaire aux pages de restauration par progression qui ont été modifiées au moment de l'incident.</span><span class="sxs-lookup"><span data-stu-id="86a27-168">After a system crash, the length of time required to recover a given database is largely dependent on the amount of random I/O needed to redo pages that were dirty at the time of the crash.</span></span> <span data-ttu-id="86a27-169">Cela signifie que le `recovery interval` paramètre n’est pas fiable.</span><span class="sxs-lookup"><span data-stu-id="86a27-169">This means that the `recovery interval` setting is unreliable.</span></span> <span data-ttu-id="86a27-170">Il ne peut pas déterminer une durée précise de récupération.</span><span class="sxs-lookup"><span data-stu-id="86a27-170">It cannot determine an accurate recovery duration.</span></span> <span data-ttu-id="86a27-171">De plus, lorsqu'un point de contrôle automatique est en cours, l'activité d'E/S générale des données augmente considérablement et de manière imprévisible.</span><span class="sxs-lookup"><span data-stu-id="86a27-171">Furthermore, when an automatic checkpoint is in progress, the general I/O activity for data increases significantly and quite unpredictably.</span></span>  
  
  
####  <a name="impact-of-recovery-interval-on-recovery-performance"></a><a name="PerformanceImpact"></a><span data-ttu-id="86a27-172">Impact de l’intervalle de récupération sur les performances de récupération</span><span class="sxs-lookup"><span data-stu-id="86a27-172">Impact of Recovery Interval on Recovery Performance</span></span>  
 <span data-ttu-id="86a27-173">Pour un système de traitement transactionnel en ligne (OLTP) utilisant des transactions courtes, `recovery interval` est le facteur principal déterminant le temps de récupération.</span><span class="sxs-lookup"><span data-stu-id="86a27-173">For an online transaction processing (OLTP) system using short transactions, `recovery interval` is the primary factor determining recovery time.</span></span> <span data-ttu-id="86a27-174">Toutefois, l' `recovery interval` option n’a aucune incidence sur le temps nécessaire à l’annulation d’une transaction de longue durée.</span><span class="sxs-lookup"><span data-stu-id="86a27-174">However, the `recovery interval` option does not affect the time required to undo a long-running transaction.</span></span> <span data-ttu-id="86a27-175">La récupération d’une base de données avec une transaction longue peut prendre beaucoup plus de temps que la valeur spécifiée dans l' `recovery interval` option.</span><span class="sxs-lookup"><span data-stu-id="86a27-175">Recovery of a database with a long-running transaction can take much longer than the specified in the `recovery interval` option.</span></span> <span data-ttu-id="86a27-176">Par exemple, si une transaction de longue durée prenait deux heures pour effectuer des mises à jour avant la désactivation de l’instance de serveur, la récupération réelle prend beaucoup plus de temps que la `recovery interval` valeur pour récupérer la transaction longue.</span><span class="sxs-lookup"><span data-stu-id="86a27-176">For example, if a long-running transaction took two hours to perform updates before the server instance became disabled, the actual recovery takes considerably longer than the `recovery interval` value to recover the long transaction.</span></span> <span data-ttu-id="86a27-177">Pour plus d’informations sur l’impact d’une transaction longue sur la durée de récupération, consultez [Journal des transactions &#40;SQL Server&#41;](the-transaction-log-sql-server.md).</span><span class="sxs-lookup"><span data-stu-id="86a27-177">For more information about the impact of a long running transaction on recovery time, see [The Transaction Log &#40;SQL Server&#41;](the-transaction-log-sql-server.md).</span></span>  
  
 <span data-ttu-id="86a27-178">En général, les valeurs par défaut fournissent les performances de récupération optimales.</span><span class="sxs-lookup"><span data-stu-id="86a27-178">Typically, the default values provides optimal recovery performance.</span></span> <span data-ttu-id="86a27-179">Toutefois, modifier l'intervalle de récupération peut améliorer les performances dans les circonstances suivantes :</span><span class="sxs-lookup"><span data-stu-id="86a27-179">However, changing the recovery interval might improve performance in the following circumstances:</span></span>  
  
-   <span data-ttu-id="86a27-180">Si la récupération prend régulièrement beaucoup plus d'une minute lorsque les transactions longues ne sont pas restaurées.</span><span class="sxs-lookup"><span data-stu-id="86a27-180">If recovery routinely takes significantly longer than 1 minute when long-running transactions are not being rolled back.</span></span>  
  
-   <span data-ttu-id="86a27-181">Si vous remarquez que les points de contrôle fréquents altèrent les performances sur une base de données.</span><span class="sxs-lookup"><span data-stu-id="86a27-181">If you notice that frequent checkpoints are impairing performance on a database.</span></span>  
  
 <span data-ttu-id="86a27-182">Si vous décidez d'augmenter le paramètre `recovery interval`, nous vous recommandons de l'augmenter progressivement par de petits incréments et d'évaluer l'effet de chaque augmentation incrémentielle sur les performances de récupération.</span><span class="sxs-lookup"><span data-stu-id="86a27-182">If you decide to increase the `recovery interval` setting, we recommend increasing it gradually by small increments and evaluating the effect of each incremental increase on recovery performance.</span></span> <span data-ttu-id="86a27-183">Cette approche est importante, car à mesure que le `recovery interval` paramètre augmente, la récupération de la base de données prend beaucoup plus de temps.</span><span class="sxs-lookup"><span data-stu-id="86a27-183">This approach is important because as the `recovery interval` setting increases, database recovery takes that many times longer to complete.</span></span> <span data-ttu-id="86a27-184">Par exemple, si vous modifiez `recovery interval` 10, la récupération prend environ 10 fois plus de temps que lorsque `recovery interval` est défini sur zéro.</span><span class="sxs-lookup"><span data-stu-id="86a27-184">For example, if you change `recovery interval` 10, recovery takes approximately 10 times longer to complete than when `recovery interval` is set to zero.</span></span>  
  
  
###  <a name="indirect-checkpoints"></a><a name="IndirectChkpt"></a><span data-ttu-id="86a27-185">Points de contrôle indirects</span><span class="sxs-lookup"><span data-stu-id="86a27-185">Indirect Checkpoints</span></span>  
 <span data-ttu-id="86a27-186">Les points de contrôle indirects, nouveauté de [!INCLUDE[ssSQL11](../../includes/sssql11-md.md)], fournissent une alternative au niveau de la base de données configurable aux points de contrôle automatiques.</span><span class="sxs-lookup"><span data-stu-id="86a27-186">Indirect checkpoints, new in [!INCLUDE[ssSQL11](../../includes/sssql11-md.md)], provide a configurable database-level alternative to automatic checkpoints.</span></span> <span data-ttu-id="86a27-187">En cas de panne système, les points de contrôle indirects fournissent un temps de récupération plus prédictible et plus rapide que les points de contrôle automatiques.</span><span class="sxs-lookup"><span data-stu-id="86a27-187">In the event of a system crash, indirect checkpoints provide potentially faster, more predictable recovery time than automatic checkpoints.</span></span> <span data-ttu-id="86a27-188">Les points de contrôle indirects offrent les avantages suivants :</span><span class="sxs-lookup"><span data-stu-id="86a27-188">Indirect checkpoints offer the following advantages:</span></span>  
  
-   <span data-ttu-id="86a27-189">Une charge de travail transactionnelle en ligne sur une base de données configurée pour les points de contrôle indirects peut rencontrer une dégradation des performances.</span><span class="sxs-lookup"><span data-stu-id="86a27-189">An online transactional workload on a database that is configured for indirect checkpoints could experience performance degradation.</span></span> <span data-ttu-id="86a27-190">Les points de contrôle indirects permettent de s’assurer que le nombre de pages de modifications est inférieur à un certain seuil afin que la récupération de la base de données se termine dans le temps de récupération cible.</span><span class="sxs-lookup"><span data-stu-id="86a27-190">Indirect checkpoints make sure that the number of dirty pages are below a certain threshold so that the database recovery completes within the target recovery time.</span></span> <span data-ttu-id="86a27-191">L’option de configuration de l’intervalle de récupération utilise le nombre de transactions pour déterminer le temps de récupération, contrairement aux points de contrôle indirects qui utilisent le nombre de pages de modifications.</span><span class="sxs-lookup"><span data-stu-id="86a27-191">The recovery interval configuration option uses the number of transactions to determine the recovery time as opposed to indirect checkpoints which makes use of number of dirty pages.</span></span> <span data-ttu-id="86a27-192">Quand des points de contrôle indirects sont activés sur une base de données recevant un grand nombre d’opérations DML, l’enregistreur en arrière-plan peut commencer à vider de manière intense les mémoires tampons modifiées sur le disque afin de s’assurer que le délai nécessaire à la récupération se situe dans le temps de récupération cible défini de la base de données.</span><span class="sxs-lookup"><span data-stu-id="86a27-192">When indirect checkpoints are enabled on a database receiving a large number of DML operations, the background writer can start aggressively flushing dirty buffers to disk to ensure that the time required to perform recovery is within the target recovery time set of the database.</span></span> <span data-ttu-id="86a27-193">Cela peut entraîner une activité supplémentaire en termes d’E/S sur certains systèmes, ce qui peut contribuer à un goulot d’étranglement des performances si le sous-système du disque fonctionne au-delà du seuil d’E/S ou s’en rapproche.</span><span class="sxs-lookup"><span data-stu-id="86a27-193">This can cause additional I/O activity on certain systems which can contribute to a performance bottleneck if the disk subsystem is operating above or nearing the I/O threshold.</span></span>  
  
-   <span data-ttu-id="86a27-194">Les points de contrôle indirects vous permettent de contrôler le temps de récupération de base de données de manière fiable en factorisant le coût des E/S aléatoires lors des récupérations de type REDO.</span><span class="sxs-lookup"><span data-stu-id="86a27-194">Indirect checkpoints enable you to reliably control database recovery time by factoring in the cost of random I/O during REDO.</span></span> <span data-ttu-id="86a27-195">Cela permet à une instance de serveur de rester dans la limite supérieure de temps de récupération pour une base de données (sauf lorsqu'une transaction longue entraîne des temps excessifs de récupération de type UNDO).</span><span class="sxs-lookup"><span data-stu-id="86a27-195">This enables a server instance to stay within an upper-bound on recovery times for a given database (except when a long-running transaction causes excessive UNDO times).</span></span>  
  
-   <span data-ttu-id="86a27-196">Les points de contrôle indirects réduisent les pics d'E/S associées au point de contrôle en entrant en continu des pages de modifications sur le disque en arrière-plan.</span><span class="sxs-lookup"><span data-stu-id="86a27-196">Indirect checkpoints reduce checkpoint-related I/O spiking by continually writing dirty pages to disk in the background.</span></span>  
  
 <span data-ttu-id="86a27-197">Toutefois, une charge de travail transactionnelle en ligne sur une base de données configurée pour les points de contrôle indirects peut rencontrer une dégradation des performances.</span><span class="sxs-lookup"><span data-stu-id="86a27-197">However, an online transactional workload on a database that is configured for indirect checkpoints could experience performance degradation.</span></span> <span data-ttu-id="86a27-198">Cela est dû au fait que l'enregistreur en arrière-plan utilisé par le point de contrôle indirect augmente parfois la charge d'écriture totale pour une instance de serveur.</span><span class="sxs-lookup"><span data-stu-id="86a27-198">This is because the background writer used by indirect checkpoint sometimes increases the total write load for a server instance.</span></span>  
  
  
###  <a name="internal-checkpoints"></a><a name="EventsCausingChkpt"></a><span data-ttu-id="86a27-199">Points de contrôle internes</span><span class="sxs-lookup"><span data-stu-id="86a27-199">Internal Checkpoints</span></span>  
 <span data-ttu-id="86a27-200">Les points de contrôle internes sont générés par les divers composants serveur pour garantir que les images de disque correspondent à l'état actuel du journal.</span><span class="sxs-lookup"><span data-stu-id="86a27-200">Internal Checkpoints are generated by various server components to guarantee that disk images match the current state of the log.</span></span> <span data-ttu-id="86a27-201">Les points de contrôle internes sont générés en réponse aux événements suivants :</span><span class="sxs-lookup"><span data-stu-id="86a27-201">Internal checkpoint are generated in response to the following events:</span></span>  
  
-   <span data-ttu-id="86a27-202">Des fichiers de base de données ont été ajoutés ou supprimés à l'aide de l'instruction ALTER DATABASE.</span><span class="sxs-lookup"><span data-stu-id="86a27-202">Database files have been added or removed by using ALTER DATABASE.</span></span>  
  
-   <span data-ttu-id="86a27-203">Une sauvegarde de la base de données est effectuée.</span><span class="sxs-lookup"><span data-stu-id="86a27-203">A database backup is taken.</span></span>  
  
-   <span data-ttu-id="86a27-204">Un instantané de base de données est créé, explicitement ou en interne pour DBCC CHECK.</span><span class="sxs-lookup"><span data-stu-id="86a27-204">A database snapshot is created, whether explicitly or internally for DBCC CHECK.</span></span>  
  
-   <span data-ttu-id="86a27-205">Une activité nécessitant l'arrêt de la base de données est effectuée.</span><span class="sxs-lookup"><span data-stu-id="86a27-205">An activity requiring a database shutdown is performed.</span></span> <span data-ttu-id="86a27-206">Par exemple, la valeur ON est attribuée à AUTO_CLOSE et la dernière connexion utilisateur à la base de données est fermée, ou une modification d'une option de base de données nécessitant un redémarrage de la base de données est effectuée.</span><span class="sxs-lookup"><span data-stu-id="86a27-206">For example, AUTO_CLOSE is ON and the last user connection to the database is closed, or a database option change is made that requires a restart of the database.</span></span>  
  
-   <span data-ttu-id="86a27-207">Une instance de [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] est arrêtée par l’arrêt du service [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] (MSSQLSERVER).</span><span class="sxs-lookup"><span data-stu-id="86a27-207">An instance of [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] is stopped by stopping the [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] (MSSQLSERVER) service .</span></span> <span data-ttu-id="86a27-208">Ces opérations provoquent la création d'un point de contrôle dans chaque base de données dans l'instance de [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)].</span><span class="sxs-lookup"><span data-stu-id="86a27-208">Either action  causes a checkpoint in each database in the instance of [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)].</span></span>  
  
-   <span data-ttu-id="86a27-209">La mise hors connexion d'une instance de cluster de basculement (FCI) [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] .</span><span class="sxs-lookup"><span data-stu-id="86a27-209">Bringing a [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] failover cluster instance (FCI) offline.</span></span>  
  
  
##  <a name="related-tasks"></a><a name="RelatedTasks"></a> <span data-ttu-id="86a27-210">Tâches associées</span><span class="sxs-lookup"><span data-stu-id="86a27-210">Related Tasks</span></span>  
 <span data-ttu-id="86a27-211">**Pour modifier l'intervalle de récupération sur une instance de serveur**</span><span class="sxs-lookup"><span data-stu-id="86a27-211">**To change the recovery interval on a server instance**</span></span>  
  
-   [<span data-ttu-id="86a27-212">Configurer l’option de configuration du serveur recovery interval</span><span class="sxs-lookup"><span data-stu-id="86a27-212">Configure the recovery interval Server Configuration Option</span></span>](../../database-engine/configure-windows/configure-the-recovery-interval-server-configuration-option.md)  
  
 <span data-ttu-id="86a27-213">**Pour configurer des points de contrôle indirects sur une base de données**</span><span class="sxs-lookup"><span data-stu-id="86a27-213">**To configure indirect checkpoints on a database**</span></span>  
  
-   [<span data-ttu-id="86a27-214">Modifier la durée de récupération cible d’une base de données &#40;SQL Server&#41;</span><span class="sxs-lookup"><span data-stu-id="86a27-214">Change the Target Recovery Time of a Database &#40;SQL Server&#41;</span></span>](change-the-target-recovery-time-of-a-database-sql-server.md)  
  
 <span data-ttu-id="86a27-215">**Pour émettre un point de contrôle manuel sur une base de données**</span><span class="sxs-lookup"><span data-stu-id="86a27-215">**To issue a manual checkpoint on a database**</span></span>  
  
-   [<span data-ttu-id="86a27-216">CHECKPOINT &#40;Transact-SQL&#41;</span><span class="sxs-lookup"><span data-stu-id="86a27-216">CHECKPOINT &#40;Transact-SQL&#41;</span></span>](/sql/t-sql/language-elements/checkpoint-transact-sql)  
  
  
##  <a name="related-content"></a><a name="RelatedContent"></a> <span data-ttu-id="86a27-217">Contenu associé</span><span class="sxs-lookup"><span data-stu-id="86a27-217">Related Content</span></span>  
  
-   <span data-ttu-id="86a27-218">[Architecture physique du journal des transactions](https://technet.microsoft.com/library/ms179355.aspx) (dans la documentation en ligne de [!INCLUDE[ssKilimanjaro](../../includes/sskilimanjaro-md.md)] )</span><span class="sxs-lookup"><span data-stu-id="86a27-218">[Transaction Log Physical Architecture](https://technet.microsoft.com/library/ms179355.aspx) (in [!INCLUDE[ssKilimanjaro](../../includes/sskilimanjaro-md.md)] Books Oline)</span></span>  
  
  
## <a name="see-also"></a><span data-ttu-id="86a27-219">Voir aussi</span><span class="sxs-lookup"><span data-stu-id="86a27-219">See Also</span></span>  
 [<span data-ttu-id="86a27-220">Journal des transactions &#40;SQL Server&#41;</span><span class="sxs-lookup"><span data-stu-id="86a27-220">The Transaction Log &#40;SQL Server&#41;</span></span>](the-transaction-log-sql-server.md)  
  
  
