---
title: Gérer la taille du fichier journal des transactions | Microsoft Docs
ms.custom: ''
ms.date: 06/13/2017
ms.prod: sql-server-2014
ms.reviewer: ''
ms.technology: supportability
ms.topic: conceptual
helpviewer_keywords:
- transaction logs [SQL Server], size management
ms.assetid: 3a70e606-303f-47a8-96d4-2456a18d4297
author: MashaMSFT
ms.author: mathoma
ms.openlocfilehash: 219ba0605d60bab0b13675f7f9f7ff01cace5755
ms.sourcegitcommit: ad4d92dce894592a259721a1571b1d8736abacdb
ms.translationtype: MT
ms.contentlocale: fr-FR
ms.lasthandoff: 08/04/2020
ms.locfileid: "87603985"
---
# <a name="manage-the-size-of-the-transaction-log-file"></a><span data-ttu-id="f8ba0-102">Gérer la taille du fichier journal des transactions</span><span class="sxs-lookup"><span data-stu-id="f8ba0-102">Manage the Size of the Transaction Log File</span></span>
  <span data-ttu-id="f8ba0-103">Dans certains cas, il peut être utile de réduire ou développer physiquement le fichier journal physique du journal des transactions d'une base de données [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] .</span><span class="sxs-lookup"><span data-stu-id="f8ba0-103">In some cases, it can be useful to physically shrink or expand the physical log file of the transaction log of a [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] database.</span></span> <span data-ttu-id="f8ba0-104">Cette rubrique contient des informations sur la façon de contrôler la taille d'un journal des transactions [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] , réduire le journal des transactions, ajouter ou agrandir un fichier journal de transactions, optimiser le taux de croissance du journal des transactions **tempdb** et contrôler la croissance d'un fichier journal de transactions.</span><span class="sxs-lookup"><span data-stu-id="f8ba0-104">This topic contains information about how to monitor the size of a [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] transaction log, shrink the transaction log, add or enlarge a transaction log file, optimize the **tempdb** transaction log growth rate, and control the growth of a transaction log file.</span></span>  
  
  
##  <a name="monitor-log-space-use"></a><a name="MonitorSpaceUse"></a><span data-ttu-id="f8ba0-105">Surveiller l’utilisation de l’espace du journal</span><span class="sxs-lookup"><span data-stu-id="f8ba0-105">Monitor Log Space Use</span></span>  
 <span data-ttu-id="f8ba0-106">Vous pouvez contrôler l'espace occupé par le journal à l'aide de DBCC SQLPERF(LOGSPACE).</span><span class="sxs-lookup"><span data-stu-id="f8ba0-106">You can monitor log space use by using DBCC SQLPERF (LOGSPACE).</span></span> <span data-ttu-id="f8ba0-107">Cette commande retourne des informations sur la quantité d'espace journal actuellement utilisée et indique à quel moment le journal des transactions a besoin d'être tronqué.</span><span class="sxs-lookup"><span data-stu-id="f8ba0-107">This command returns information about the amount of log space currently used and indicates when the transaction log is in need of truncation.</span></span> <span data-ttu-id="f8ba0-108">Pour plus d’informations, consultez [DBCC SQLPERF &#40;Transact-SQL&#41;](/sql/t-sql/database-console-commands/dbcc-sqlperf-transact-sql).</span><span class="sxs-lookup"><span data-stu-id="f8ba0-108">For more information, see [DBCC SQLPERF &#40;Transact-SQL&#41;](/sql/t-sql/database-console-commands/dbcc-sqlperf-transact-sql).</span></span> <span data-ttu-id="f8ba0-109">Pour plus d’informations sur la taille actuelle d’un fichier journal, sa taille maximale et l’option de croissance automatique du fichier, vous pouvez également utiliser les colonnes **size**, **max_size** et **growth** pour ce fichier journal dans **sys.database_files**.</span><span class="sxs-lookup"><span data-stu-id="f8ba0-109">For information about the current size of a log file, its maximum size, and the autogrow option for the file, you can also use the **size**, **max_size**, and **growth** columns for that log file in **sys.database_files**.</span></span> <span data-ttu-id="f8ba0-110">Pour plus d’informations, consultez [sys.database_files &#40;Transact-SQL&#41;](/sql/relational-databases/system-catalog-views/sys-database-files-transact-sql).</span><span class="sxs-lookup"><span data-stu-id="f8ba0-110">For more information, see [sys.database_files &#40;Transact-SQL&#41;](/sql/relational-databases/system-catalog-views/sys-database-files-transact-sql).</span></span>  
  
> [!IMPORTANT]  
>  <span data-ttu-id="f8ba0-111">Nous vous recommandons d'éviter de surcharger le disque du journal.</span><span class="sxs-lookup"><span data-stu-id="f8ba0-111">We recommend that you avoid overloading the log disk.</span></span>  
  
  
##  <a name="shrink-the-size-of-the-log-file"></a><a name="ShrinkSize"></a><span data-ttu-id="f8ba0-112">Réduire la taille du fichier journal</span><span class="sxs-lookup"><span data-stu-id="f8ba0-112">Shrink the Size of the Log File</span></span>  
 <span data-ttu-id="f8ba0-113">Pour réduire la taille physique d'un fichier journal physique, vous devez réduire le fichier journal.</span><span class="sxs-lookup"><span data-stu-id="f8ba0-113">To reduce the physical size of a physical log file, you must shrink the log file.</span></span> <span data-ttu-id="f8ba0-114">Cela est utile si vous savez qu'un fichier journal de transactions contient de l'espace inutilisé dont vous n'avez pas besoin.</span><span class="sxs-lookup"><span data-stu-id="f8ba0-114">This is useful if you know that a transaction log file contains unused space that you will not be needing.</span></span> <span data-ttu-id="f8ba0-115">La réduction d'un fichier journal ne peut avoir lieu que lorsque la base de données est en ligne et, également, lorsqu'au moins un fichier journal virtuel est libre.</span><span class="sxs-lookup"><span data-stu-id="f8ba0-115">Shrinking a log file can occur only while the database is online and, also, at least one virtual log file is free.</span></span> <span data-ttu-id="f8ba0-116">Dans certains cas, la réduction du journal peut n'être possible qu'après la troncation de journal suivante.</span><span class="sxs-lookup"><span data-stu-id="f8ba0-116">In some cases, shrinking the log may not be possible until after the next log truncation.</span></span>  
  
> [!NOTE]  
>  <span data-ttu-id="f8ba0-117">Certains facteurs (par exemple, une transaction longue) chargés de maintenir les fichiers journaux virtuels actifs pendant une période de temps prolongée peuvent limiter, voire empêcher, la réduction du journal.</span><span class="sxs-lookup"><span data-stu-id="f8ba0-117">Factors, such as a long-running transaction, that keep virtual log files active for an extended period can restrict log shrinkage or even prevent the log from shrinking at all.</span></span> <span data-ttu-id="f8ba0-118">Pour plus d’informations sur les facteurs susceptibles de retarder la troncation du journal, consultez [Journal des transactions &#40;SQL Server&#41;](the-transaction-log-sql-server.md).</span><span class="sxs-lookup"><span data-stu-id="f8ba0-118">For information about factors that can delay log truncation, see [The Transaction Log &#40;SQL Server&#41;](the-transaction-log-sql-server.md).</span></span>  
  
 <span data-ttu-id="f8ba0-119">La réduction d'un fichier journal supprime un ou plusieurs fichiers journaux virtuels qui ne contiennent aucune partie du journal logique (autrement dit, des *fichiers journaux virtuels inactifs*).</span><span class="sxs-lookup"><span data-stu-id="f8ba0-119">Shrinking a log file removes one or more virtual log files that do not hold any part of the logical log (that is, *inactive virtual log files*).</span></span> <span data-ttu-id="f8ba0-120">Lorsque vous réduisez un fichier journal de transactions, un nombre suffisant de fichiers journaux virtuels inactifs sont supprimés à la fin du fichier journal afin de réduire le journal et le ramener à une taille proche de la taille cible.</span><span class="sxs-lookup"><span data-stu-id="f8ba0-120">When a transaction log file is shrunk, enough inactive virtual log files are removed from the end of the log file to reduce the log to approximately the target size.</span></span>  
  
 <span data-ttu-id="f8ba0-121">**Pour réduire un fichier journal (sans réduire les fichiers de base de données)**</span><span class="sxs-lookup"><span data-stu-id="f8ba0-121">**To shrink a log file (without shrinking database files)**</span></span>  
  
-   [<span data-ttu-id="f8ba0-122">DBCC SHRINKFILE &#40;Transact-SQL&#41;</span><span class="sxs-lookup"><span data-stu-id="f8ba0-122">DBCC SHRINKFILE &#40;Transact-SQL&#41;</span></span>](/sql/t-sql/database-console-commands/dbcc-shrinkfile-transact-sql)  
  
-   [<span data-ttu-id="f8ba0-123">Réduire un fichier</span><span class="sxs-lookup"><span data-stu-id="f8ba0-123">Shrink a File</span></span>](../databases/shrink-a-file.md)  
  
 <span data-ttu-id="f8ba0-124">**Pour surveiller les événements de réduction du fichier journal**</span><span class="sxs-lookup"><span data-stu-id="f8ba0-124">**To monitor log-file shrink events**</span></span>  
  
-   <span data-ttu-id="f8ba0-125">[Log File Auto Shrink Event Class](../event-classes/log-file-auto-shrink-event-class.md).</span><span class="sxs-lookup"><span data-stu-id="f8ba0-125">[Log File Auto Shrink Event Class](../event-classes/log-file-auto-shrink-event-class.md).</span></span>  
  
 `To monitor log space`  
  
-   [<span data-ttu-id="f8ba0-126">DBCC SQLPERF &#40;Transact-SQL&#41;</span><span class="sxs-lookup"><span data-stu-id="f8ba0-126">DBCC SQLPERF &#40;Transact-SQL&#41;</span></span>](/sql/t-sql/database-console-commands/dbcc-sqlperf-transact-sql)  
  
-   <span data-ttu-id="f8ba0-127">[sys.database_files &#40;Transact-SQL&#41;](/sql/relational-databases/system-catalog-views/sys-database-files-transact-sql) (consultez les colonnes **size**, **max_size** et **growth** du ou des fichiers journaux.)</span><span class="sxs-lookup"><span data-stu-id="f8ba0-127">[sys.database_files &#40;Transact-SQL&#41;](/sql/relational-databases/system-catalog-views/sys-database-files-transact-sql) (See the **size**, **max_size**, and **growth** columns for the log file or files.)</span></span>  
  
> [!NOTE]  
>  <span data-ttu-id="f8ba0-128">Il est possible de définir une réduction automatique des fichiers de la base de données et des fichiers journaux.</span><span class="sxs-lookup"><span data-stu-id="f8ba0-128">Shrinking database and log files can be set to occur automatically.</span></span> <span data-ttu-id="f8ba0-129">Toutefois, nous vous déconseillons la réduction automatique, et la propriété de base de données `autoshrink` est définie par défaut par la valeur FALSE.</span><span class="sxs-lookup"><span data-stu-id="f8ba0-129">However, we recommend against automatic shrinking, and the `autoshrink` database property is set to FALSE by default.</span></span> <span data-ttu-id="f8ba0-130">Si `autoshrink` est définie par la valeur TRUE, la troncation automatique réduit la taille d'un fichier uniquement lorsque plus de 25 pour cent de son espace est inutilisé.</span><span class="sxs-lookup"><span data-stu-id="f8ba0-130">If `autoshrink` is set to TRUE, automatic shrinking reduces the size of a file only when more than 25 percent of its space is unused.</span></span> <span data-ttu-id="f8ba0-131">Le fichier est réduit soit à la taille à laquelle seuls 25 % de ce dernier sont inutilisés soit à sa taille d'origine, selon la valeur la plus élevée.</span><span class="sxs-lookup"><span data-stu-id="f8ba0-131">The file is shrunk either to the size at which only 25 percent of the file is unused space or to the original size of the file, whichever is larger.</span></span> <span data-ttu-id="f8ba0-132">Pour plus d’informations sur la modification du paramètre de la `autoshrink` propriété, consultez [afficher ou modifier les propriétés d’une base de données](../databases/view-or-change-the-properties-of-a-database.md)-utilisez la propriété **réduction automatique** de la page **options** ou [options ALTER DATABASE SET &#40;Transact-SQL&#41;](/sql/t-sql/statements/alter-database-transact-sql-set-options)-utilisez l’option AUTO_SHRINK.</span><span class="sxs-lookup"><span data-stu-id="f8ba0-132">For information about changing the setting of the `autoshrink` property, see [View or Change the Properties of a Database](../databases/view-or-change-the-properties-of-a-database.md)-use the **Auto Shrink** property on the **Options** page-or [ALTER DATABASE SET Options &#40;Transact-SQL&#41;](/sql/t-sql/statements/alter-database-transact-sql-set-options)-use the AUTO_SHRINK option.</span></span>  
  
  
##  <a name="add-or-enlarge-a-log-file"></a><a name="AddOrEnlarge"></a><span data-ttu-id="f8ba0-133">Ajouter ou agrandir un fichier journal</span><span class="sxs-lookup"><span data-stu-id="f8ba0-133">Add or Enlarge a Log File</span></span>  
 <span data-ttu-id="f8ba0-134">Une autre solution pour gagner de l'espace consiste à agrandir le fichier journal existant (si l'espace disque le permet) ou à ajouter un fichier journal à la base de données, généralement sur un autre disque.</span><span class="sxs-lookup"><span data-stu-id="f8ba0-134">Alternatively, you can gain space by enlarging the existing log file (if disk space permits) or by adding a log file to the database, typically on a different disk.</span></span>  
  
-   <span data-ttu-id="f8ba0-135">Pour ajouter un fichier journal à la base de données, utilisez la clause ADD LOG FILE de l'instruction ALTER DATABASE.</span><span class="sxs-lookup"><span data-stu-id="f8ba0-135">To add a log file to the database, use the ADD LOG FILE clause of the ALTER DATABASE statement.</span></span> <span data-ttu-id="f8ba0-136">L'ajout d'un fichier journal permet au journal de croître.</span><span class="sxs-lookup"><span data-stu-id="f8ba0-136">Adding a log file allows the log to grow.</span></span>  
  
-   <span data-ttu-id="f8ba0-137">Pour agrandir le fichier journal, utilisez la clause MODIFY FILE de l'instruction ALTER DATABASE en spécifiant la syntaxe SIZE et MAXSIZE.</span><span class="sxs-lookup"><span data-stu-id="f8ba0-137">To enlarge the log file, use the MODIFY FILE clause of the ALTER DATABASE statement, specifying the SIZE and MAXSIZE syntax.</span></span> <span data-ttu-id="f8ba0-138">Pour plus d’informations, consultez [ALTER DATABASE &#40;Transact-SQL&#41;](/sql/t-sql/statements/alter-database-transact-sql).</span><span class="sxs-lookup"><span data-stu-id="f8ba0-138">For more information, see [ALTER DATABASE &#40;Transact-SQL&#41;](/sql/t-sql/statements/alter-database-transact-sql).</span></span>  
  
  
##  <a name="optimize-the-size-of-the-tempdb-transaction-log"></a><a name="tempdbOptimize"></a><span data-ttu-id="f8ba0-139">Optimiser la taille du journal des transactions tempdb</span><span class="sxs-lookup"><span data-stu-id="f8ba0-139">Optimize the Size of the tempdb Transaction Log</span></span>  
 <span data-ttu-id="f8ba0-140">Le redémarrage d’une instance de serveur permet de redimensionner le journal des transactions de la base de données **tempdb** conformément à sa taille d’origine avant la croissance automatique.</span><span class="sxs-lookup"><span data-stu-id="f8ba0-140">Restarting a server instance resizes the transaction log of the **tempdb** database to its original, pre-autogrow size.</span></span> <span data-ttu-id="f8ba0-141">Ceci peut réduire les performances du journal des transactions **tempdb** .</span><span class="sxs-lookup"><span data-stu-id="f8ba0-141">This can reduce the performance of the **tempdb** transaction log.</span></span> <span data-ttu-id="f8ba0-142">Vous pouvez éviter cette surcharge en augmentant la taille du journal des transactions **tempdb** après avoir démarré ou redémarré l'instance de serveur.</span><span class="sxs-lookup"><span data-stu-id="f8ba0-142">You can avoid this overhead by increasing the size of the **tempdb** transaction log after starting or restarting the server instance.</span></span> <span data-ttu-id="f8ba0-143">Pour plus d'informations, consultez [tempdb Database](../databases/tempdb-database.md).</span><span class="sxs-lookup"><span data-stu-id="f8ba0-143">For more information, see [tempdb Database](../databases/tempdb-database.md).</span></span>  
  
  
##  <a name="control-the-growth-of-a-transaction-log-file"></a><a name="ControlGrowth"></a><span data-ttu-id="f8ba0-144">Contrôler la croissance d’un fichier journal de transactions</span><span class="sxs-lookup"><span data-stu-id="f8ba0-144">Control the Growth of a Transaction Log File</span></span>  
 <span data-ttu-id="f8ba0-145">Vous pouvez utiliser l’instruction [ALTER DATABASE &#40;Transact-SQL&#41;](/sql/t-sql/statements/alter-database-transact-sql) pour gérer la croissance d’un fichier journal de transactions.</span><span class="sxs-lookup"><span data-stu-id="f8ba0-145">You can use the [ALTER DATABASE &#40;Transact-SQL&#41;](/sql/t-sql/statements/alter-database-transact-sql) statement to manage the growth of a transaction log file.</span></span> <span data-ttu-id="f8ba0-146">Notez les points suivants :</span><span class="sxs-lookup"><span data-stu-id="f8ba0-146">Note the following:</span></span>  
  
-   <span data-ttu-id="f8ba0-147">Pour modifier la taille actuelle du fichier selon les unités Ko, Mo, Go et To, utilisez l'option SIZE.</span><span class="sxs-lookup"><span data-stu-id="f8ba0-147">To change the current file size in KB, MB, GB, and TB units, use the SIZE option.</span></span>  
  
-   <span data-ttu-id="f8ba0-148">Pour modifier l'incrément de croissance, utilisez l'option FILEGROWTH.</span><span class="sxs-lookup"><span data-stu-id="f8ba0-148">To change the growth increment, use the FILEGROWTH option.</span></span> <span data-ttu-id="f8ba0-149">Une valeur 0 indique que la croissance automatique est désactivée et qu'aucun espace supplémentaire n'est autorisé.</span><span class="sxs-lookup"><span data-stu-id="f8ba0-149">A value of 0 indicates that automatic growth is set to off and no additional space is permitted.</span></span> <span data-ttu-id="f8ba0-150">Un faible incrément de croissance automatique d'un fichier journal peut réduire les performances.</span><span class="sxs-lookup"><span data-stu-id="f8ba0-150">A small autogrowth increment on a log file can reduce performance.</span></span> <span data-ttu-id="f8ba0-151">L'incrément de croissance d'un fichier journal doit être suffisamment important pour éviter une expansion fréquente.</span><span class="sxs-lookup"><span data-stu-id="f8ba0-151">The file growth increment on a log file should be sufficiently large to avoid frequent expansion.</span></span> <span data-ttu-id="f8ba0-152">Un incrément de croissance par défaut de 10 % convient généralement.</span><span class="sxs-lookup"><span data-stu-id="f8ba0-152">The default growth increment of 10 percent is generally suitable.</span></span>  
  
     <span data-ttu-id="f8ba0-153">Pour plus d’informations sur la modification de la propriété de croissance d’un fichier journal, consultez [ALTER database &#40;Transact-SQL&#41;](/sql/t-sql/statements/alter-database-transact-sql).</span><span class="sxs-lookup"><span data-stu-id="f8ba0-153">For information on changing the file-growth property on a log file, see [ALTER DATABASE &#40;Transact-SQL&#41;](/sql/t-sql/statements/alter-database-transact-sql).</span></span>  
  
-   <span data-ttu-id="f8ba0-154">Pour contrôler la taille maximale d'un fichier journal en Ko, Mo, Go et To ou affecter la valeur UNLIMITED à la croissance, utilisez l'option MAXSIZE.</span><span class="sxs-lookup"><span data-stu-id="f8ba0-154">To control the maximum the size of a log file in KB, MB, GB, and TB units or to set growth to UNLIMITED, use the MAXSIZE option.</span></span>  
  
  
## <a name="see-also"></a><span data-ttu-id="f8ba0-155">Voir aussi</span><span class="sxs-lookup"><span data-stu-id="f8ba0-155">See Also</span></span>  
 <span data-ttu-id="f8ba0-156">[BACKUP &#40;Transact-SQL&#41;](/sql/t-sql/statements/backup-transact-sql) </span><span class="sxs-lookup"><span data-stu-id="f8ba0-156">[BACKUP &#40;Transact-SQL&#41;](/sql/t-sql/statements/backup-transact-sql) </span></span>  
 [<span data-ttu-id="f8ba0-157">Résoudre les problèmes liés à un journal des transactions saturé &#40;erreur SQL Server 9002&#41;</span><span class="sxs-lookup"><span data-stu-id="f8ba0-157">Troubleshoot a Full Transaction Log &#40;SQL Server Error 9002&#41;</span></span>](troubleshoot-a-full-transaction-log-sql-server-error-9002.md)  
  
  
