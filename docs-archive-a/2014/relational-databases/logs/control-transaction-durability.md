---
title: Contrôler la durabilité d’une transaction | Microsoft Docs
ms.custom: ''
ms.date: 05/19/2016
ms.prod: sql-server-2014
ms.reviewer: ''
ms.technology: supportability
ms.topic: conceptual
helpviewer_keywords:
- delayed durability
- Lazy Commit
ms.assetid: 3ac93b28-cac7-483e-a8ab-ac44e1cc1c76
author: MashaMSFT
ms.author: mathoma
ms.openlocfilehash: f37bcaf8719f4a2f3b1e7fbca1cf332717bd936e
ms.sourcegitcommit: ad4d92dce894592a259721a1571b1d8736abacdb
ms.translationtype: MT
ms.contentlocale: fr-FR
ms.lasthandoff: 08/04/2020
ms.locfileid: "87603995"
---
# <a name="control-transaction-durability"></a><span data-ttu-id="5af70-102">Contrôler la durabilité d'une transaction</span><span class="sxs-lookup"><span data-stu-id="5af70-102">Control Transaction Durability</span></span>
  <span data-ttu-id="5af70-103">Les validations de transactions[!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] peuvent avoir une durabilité complète, la durabilité par défaut de [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] ou une durabilité retardée (également appelée Validation différée).</span><span class="sxs-lookup"><span data-stu-id="5af70-103">[!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] transaction commits can be either fully durable, the [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] default, or delayed durable (also known as lazy commit).</span></span>  
  
 <span data-ttu-id="5af70-104">Les validations de transactions à durabilité complète sont synchrones. Elles signalent la réussite de la validation (COMMIT) et restituent le contrôle au client uniquement lorsque les enregistrements de journal de transactions ont été écrits sur le disque.</span><span class="sxs-lookup"><span data-stu-id="5af70-104">Fully durable transaction commits are synchronous and report a commit as successful and return control to the client only after the log records for the transaction are written to disk.</span></span> <span data-ttu-id="5af70-105">Les validations de transactions à durabilité retardée sont asynchrones. Elles signalent la réussite de la validation (COMMIT) avant que les enregistrements de journal de transactions ne soient écrits sur le disque.</span><span class="sxs-lookup"><span data-stu-id="5af70-105">Delayed durable transaction commits are asynchronous and report a commit as successful before the log records for the transaction are written to disk.</span></span> <span data-ttu-id="5af70-106">L'écriture des entrées du journal des transactions sur le disque est nécessaire pour qu'une transaction soit durable.</span><span class="sxs-lookup"><span data-stu-id="5af70-106">Writing the transaction log entries to disk is required for a transaction to be durable.</span></span> <span data-ttu-id="5af70-107">Les transactions à durabilité retardée deviennent durables lorsque les enregistrements de journal de transactions sont vidés sur le disque.</span><span class="sxs-lookup"><span data-stu-id="5af70-107">Delayed durable transactions become durable when the transaction log entries are flushed to disk.</span></span>  
  
 <span data-ttu-id="5af70-108">Cette rubrique décrit en détail les transactions à durabilité retardée.</span><span class="sxs-lookup"><span data-stu-id="5af70-108">This topic details delayed durable transactions.</span></span>  
  
## <a name="full-vs-delayed-transaction-durability"></a><span data-ttu-id="5af70-109">Durabilité complète/ retardée des transactions</span><span class="sxs-lookup"><span data-stu-id="5af70-109">Full vs. Delayed Transaction Durability</span></span>  
 <span data-ttu-id="5af70-110">La durabilité complète et la durabilité retardée des transactions présentent chacune des avantages et des inconvénients.</span><span class="sxs-lookup"><span data-stu-id="5af70-110">Both full and delayed transaction durability have their advantages and disadvantages.</span></span> <span data-ttu-id="5af70-111">Une application peut comporter à la fois des transactions à durabilité complète et à durabilité retardée.</span><span class="sxs-lookup"><span data-stu-id="5af70-111">An application can have a mix of fully and delayed durable transactions.</span></span> <span data-ttu-id="5af70-112">Vous devez évaluer soigneusement vos besoins professionnels et déterminer de quelle manière chaque méthode peut y répondre.</span><span class="sxs-lookup"><span data-stu-id="5af70-112">You should carefully consider your business needs and how each fits into those needs.</span></span>  
  
### <a name="full-transaction-durability"></a><span data-ttu-id="5af70-113">Durabilité complète des transactions</span><span class="sxs-lookup"><span data-stu-id="5af70-113">Full transaction durability</span></span>  
 <span data-ttu-id="5af70-114">Les transactions à durabilité complète écrivent la sécurisation du journal des transactions sur le disque avant de restituer le contrôle au client.</span><span class="sxs-lookup"><span data-stu-id="5af70-114">Fully durable transactions write the transaction log to disk before returning control to the client.</span></span> <span data-ttu-id="5af70-115">Vous devez utiliser des transactions à durabilité complète dans les cas suivants :</span><span class="sxs-lookup"><span data-stu-id="5af70-115">You should use fully durable transactions whenever:</span></span>  
  
-   <span data-ttu-id="5af70-116">Le système ne tolère aucune perte de données.</span><span class="sxs-lookup"><span data-stu-id="5af70-116">Your system cannot tolerate any data loss.</span></span>   
    <span data-ttu-id="5af70-117">Consultez la section [Quand puis-je perdre des données ?](#when-can-i-lose-data) pour obtenir des informations sur la perte de certaines données.</span><span class="sxs-lookup"><span data-stu-id="5af70-117">See the section [When can I lose data?](#when-can-i-lose-data) for information on when you can lose some of your data.</span></span>  
  
-   <span data-ttu-id="5af70-118">Le goulot d'étranglement n'est pas attribuable à une latence d'écriture du journal des transactions.</span><span class="sxs-lookup"><span data-stu-id="5af70-118">The bottleneck is not due to transaction log write latency.</span></span>  
  
 <span data-ttu-id="5af70-119">La durabilité retardée des transactions réduit la latence attribuable aux E/S du journal, car elle permet de conserver les enregistrements du journal de transactions en mémoire et d'écrire ces enregistrements par lots, ce qui nécessite moins d'opérations d'E/S.</span><span class="sxs-lookup"><span data-stu-id="5af70-119">Delayed transaction durability reduces the latency due to log I/O by keeping the transaction log records in memory and writing to the transaction log in batches, thus requiring fewer I/O operations.</span></span> <span data-ttu-id="5af70-120">La durabilité différée des transactions réduit potentiellement les contentions d'E/S du journal, et diminue de fait les temps d'attente dans le système.</span><span class="sxs-lookup"><span data-stu-id="5af70-120">Delayed transaction durability potentially reduces log I/O contention, thus reducing waits in the system.</span></span>  
  
 <span data-ttu-id="5af70-121">**Garanties offertes par la durabilité complète des transactions**</span><span class="sxs-lookup"><span data-stu-id="5af70-121">**Full Transaction Durability Guarantees**</span></span>  
  
-   <span data-ttu-id="5af70-122">Une fois qu'une transaction a été validée, les modifications apportées par la transaction sont visibles par les autres transactions du système.</span><span class="sxs-lookup"><span data-stu-id="5af70-122">Once transaction commit succeeds, the changes made by the transaction are visible to the other transactions in the system.</span></span> <span data-ttu-id="5af70-123">Pour plus d’informations, consultez la rubrique [niveaux d’isolation des transactions](../../database-engine/transaction-isolation-levels.md) .</span><span class="sxs-lookup"><span data-stu-id="5af70-123">See the topic [Transaction Isolation Levels](../../database-engine/transaction-isolation-levels.md) for more information.</span></span>  
  
-   <span data-ttu-id="5af70-124">La durabilité est garantie lors de la validation.</span><span class="sxs-lookup"><span data-stu-id="5af70-124">Durability is guaranteed on commit.</span></span> <span data-ttu-id="5af70-125">Les enregistrements de journal correspondants sont conservés sur le disque jusqu'à ce que la transaction soit validée et que le contrôle soit restitué au client.</span><span class="sxs-lookup"><span data-stu-id="5af70-125">Corresponding log records are persisted to disk before the transaction commit succeeds and returns control to the client.</span></span>  
  
### <a name="delayed-transaction-durability"></a><span data-ttu-id="5af70-126">Durabilité retardée des transactions</span><span class="sxs-lookup"><span data-stu-id="5af70-126">Delayed transaction durability</span></span>  
 <span data-ttu-id="5af70-127">La durabilité retardée des transactions est obtenue par des écritures asynchrones d'enregistrements de journal sur le disque.</span><span class="sxs-lookup"><span data-stu-id="5af70-127">Delayed transaction durability is accomplished using asynchronous log writes to disk.</span></span> <span data-ttu-id="5af70-128">Les enregistrements du journal des transactions sont conservés dans une mémoire tampon et écrits sur le disque lorsque la mémoire tampon se remplit ou qu'un événement de vidage de la mémoire tampon a lieu.</span><span class="sxs-lookup"><span data-stu-id="5af70-128">Transaction log records are kept in a buffer and written to disk when the buffer fills or a buffer flushing event takes place.</span></span> <span data-ttu-id="5af70-129">La durabilité retardée des transactions réduit à la fois la latence et les contentions dans le système pour les raisons suivantes :</span><span class="sxs-lookup"><span data-stu-id="5af70-129">Delayed transaction durability reduces both latency and contention within the system because:</span></span>  
  
-   <span data-ttu-id="5af70-130">Les validations de transactions sont effectuées sans attendre la fin des E/S du journal et la restitution du contrôle au client.</span><span class="sxs-lookup"><span data-stu-id="5af70-130">The transaction commit processing does not wait for log IO to finish and return control to the client.</span></span>  
  
-   <span data-ttu-id="5af70-131">Les transactions concomitantes sont moins susceptibles d'entrer en conflit pour les E/S du journal ; à la place, le tampon journal peut être vidé sur le disque sous forme de blocs plus volumineux, ce qui réduit les risques de contention et augmente le débit.</span><span class="sxs-lookup"><span data-stu-id="5af70-131">Concurrent transactions are less likely to contend for log IO; instead, the log buffer can be flushed to disk in larger chunks, reducing contention, and increasing throughput.</span></span>  
  
    > [!NOTE]  
    >  <span data-ttu-id="5af70-132">Vous pouvez toujours assister à une contention d'E/S du journal s'il existe un niveau élevé d'accès concurrentiel, en particulier si vous remplissez le tampon journal plus vite que vous ne le videz.</span><span class="sxs-lookup"><span data-stu-id="5af70-132">You may still have log I/O contention if there is a high degree of concurrency, particularly if you fill up the log buffer faster than you flush it.</span></span>  
  
 <span data-ttu-id="5af70-133">**Circonstances dans lesquelles utiliser la durabilité retardée des transactions**</span><span class="sxs-lookup"><span data-stu-id="5af70-133">**When to use delayed transaction durability**</span></span>  
  
 <span data-ttu-id="5af70-134">Voici quelques-uns des cas dans lesquels vous pouvez tirer parti de l'utilisation de la durabilité retardée des transactions :</span><span class="sxs-lookup"><span data-stu-id="5af70-134">Some of the cases in which you could benefit from using delayed transaction durability are:</span></span>  
  
 <span data-ttu-id="5af70-135">**Vous tolérez la perte de certaines données.** </span><span class="sxs-lookup"><span data-stu-id="5af70-135">**You can tolerate some data loss.**</span></span>  
 <span data-ttu-id="5af70-136">Si vous tolérez la perte de certaines données, par exemple des enregistrements qui ne sont pas indispensables tant que vous disposez de la majeure partie des données, il peut être intéressant d'utiliser la durabilité retardée.</span><span class="sxs-lookup"><span data-stu-id="5af70-136">If you can tolerate some data loss, for example, where individual records are not critical as long as you have most of the data, then delayed durability may be worth considering.</span></span> <span data-ttu-id="5af70-137">Si, en revanche, vous ne tolérez aucune perte de données, n'utilisez pas la durabilité retardée des transactions.</span><span class="sxs-lookup"><span data-stu-id="5af70-137">If you cannot tolerate any data loss, do not use delayed transaction durability.</span></span>  
  
 <span data-ttu-id="5af70-138">**Vous rencontrez un goulot d’étranglement au niveau des écritures du journal de transactions.** </span><span class="sxs-lookup"><span data-stu-id="5af70-138">**You are experiencing a bottleneck on transaction log writes.**</span></span>  
 <span data-ttu-id="5af70-139">Si les problèmes de performances sont attribuables à une latence dans les écritures du journal de transactions, votre application bénéficiera probablement de l'utilisation de la durabilité retardée des transactions.</span><span class="sxs-lookup"><span data-stu-id="5af70-139">If your performance issues are due to latency in transaction log writes, your application will likely benefit from using delayed transaction durability.</span></span>  
  
 <span data-ttu-id="5af70-140">**Vos charges de travail présentent un niveau de contention élevé.** </span><span class="sxs-lookup"><span data-stu-id="5af70-140">**Your workloads have a high contention rate.**</span></span>  
 <span data-ttu-id="5af70-141">Si votre système a des charges de travail présentant un haut degré de contention, beaucoup de temps est perdu à attendre la libération de verrous.</span><span class="sxs-lookup"><span data-stu-id="5af70-141">If your system has workloads with a high contention level much time is lost waiting for locks to be released.</span></span> <span data-ttu-id="5af70-142">La durabilité retardée des transactions réduit la durée de validation. De ce fait, les verrous sont libérés plus rapidement, ce qui se traduit par un débit supérieur.</span><span class="sxs-lookup"><span data-stu-id="5af70-142">Delayed transaction durability reduces commit time and thus releases locks faster which results in higher throughput.</span></span>  
  
 <span data-ttu-id="5af70-143">**Garanties offertes par la durabilité retardée des transactions**</span><span class="sxs-lookup"><span data-stu-id="5af70-143">**Delayed Transaction Durability Guarantees**</span></span>  
  
-   <span data-ttu-id="5af70-144">Une fois qu'une transaction a été validée, les modifications apportées par la transaction sont visibles par les autres transactions du système.</span><span class="sxs-lookup"><span data-stu-id="5af70-144">Once transaction commit succeeds, the changes made by the transaction are visible to the other transactions in the system.</span></span>  
  
-   <span data-ttu-id="5af70-145">La durabilité des transactions est garantie uniquement après un vidage du journal des transactions en mémoire sur le disque.</span><span class="sxs-lookup"><span data-stu-id="5af70-145">Transaction durability is guaranteed only following a flush of the in-memory transaction log to disk.</span></span> <span data-ttu-id="5af70-146">Le journal des transactions en mémoire est vidé sur le disque dans les circonstances suivantes :</span><span class="sxs-lookup"><span data-stu-id="5af70-146">The in-memory transaction log is flushed to disk when:</span></span>  
  
    -   <span data-ttu-id="5af70-147">Une transaction à durabilité complète dans la même base de données apporte une modification dans la base de données, puis est validée.</span><span class="sxs-lookup"><span data-stu-id="5af70-147">A fully durable transaction in the same database makes a change in the database and successfully commits.</span></span>  
  
    -   <span data-ttu-id="5af70-148">L'utilisateur exécute la procédure stockée système `sp_flush_log` avec succès.</span><span class="sxs-lookup"><span data-stu-id="5af70-148">The user executes the system stored procedure `sp_flush_log` successfully.</span></span>  
  
    -   <span data-ttu-id="5af70-149">Le tampon du journal de transactions en mémoire se remplit et se vide automatiquement sur le disque.</span><span class="sxs-lookup"><span data-stu-id="5af70-149">The in-memory transaction log buffer fills up and automatically flushes to disk.</span></span>  
  
     <span data-ttu-id="5af70-150">Si une transaction à durabilité complète ou un sp_flush_log est validé avec succès, toutes les transactions à durabilité retardée déjà validées ont été rendues durables.</span><span class="sxs-lookup"><span data-stu-id="5af70-150">If a fully durable transaction or sp_flush_log successfully commit, all previously committed delayed durability transactions have been made durable.</span></span>  
  
 <span data-ttu-id="5af70-151">Le journal peut être périodiquement vidé sur le disque.</span><span class="sxs-lookup"><span data-stu-id="5af70-151">The log may be flushed to disk periodically.</span></span> <span data-ttu-id="5af70-152">Cependant, [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] ne fournit pas de garantie de durabilité autre que les transactions durables et sp_flush_log.</span><span class="sxs-lookup"><span data-stu-id="5af70-152">However, [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] does not provide any durability guarantees other than durable transactions and sp_flush_log.</span></span>  
  
## <a name="how-to-control-transaction-durability"></a><span data-ttu-id="5af70-153">Procédure pour contrôler la durabilité d'une transaction</span><span class="sxs-lookup"><span data-stu-id="5af70-153">How to control transaction durability</span></span>  
  
### <a name="database-level-control"></a><span data-ttu-id="5af70-154">Contrôle au niveau de la base de données</span><span class="sxs-lookup"><span data-stu-id="5af70-154">Database level control</span></span>  
 <span data-ttu-id="5af70-155">En tant qu'administrateur de base de données, vous pouvez contrôler si les utilisateurs peuvent utiliser la durabilité retardée des transactions sur une base de données avec l'instruction suivante.</span><span class="sxs-lookup"><span data-stu-id="5af70-155">You, the DBA, can control whether users can use delayed transaction durability on a database with the following statement.</span></span> <span data-ttu-id="5af70-156">Vous devez définir le paramètre de durabilité retardée avec ALTER DATABASE.</span><span class="sxs-lookup"><span data-stu-id="5af70-156">You must set the delayed durability setting with ALTER DATABASE.</span></span>  
  
```sql  
ALTER DATABASE ... SET DELAYED_DURABILITY = { DISABLED | ALLOWED | FORCED }  
```  
  
 `DISABLED`  
 <span data-ttu-id="5af70-157">[Valeur par défaut] Avec ce paramètre, toutes les transactions qui sont validées sur la base de données ont une durabilité complète, quel que soit le paramètre de niveau de validation ([DELAYED_DURABILITY= ON | OFF]).</span><span class="sxs-lookup"><span data-stu-id="5af70-157">[default] With this setting, all transactions that commit on the database are fully durable, regardless of the commit level setting (DELAYED_DURABILITY=[ON | OFF]).</span></span> <span data-ttu-id="5af70-158">Aucune modification ni recompilation de procédure stockée n'est nécessaire.</span><span class="sxs-lookup"><span data-stu-id="5af70-158">There is no need for stored procedure change and recompilation.</span></span> <span data-ttu-id="5af70-159">Cela vous permet de vous assurer que les données ne sont jamais mises en danger par la durabilité retardée.</span><span class="sxs-lookup"><span data-stu-id="5af70-159">This allows you to ensure that no data is ever put at risk by delayed durability.</span></span>  
  
 `ALLOWED`  
 <span data-ttu-id="5af70-160">Avec ce paramètre, la durabilité de chaque transaction est déterminée au niveau de la transaction - DELAYED_DURABILITY = { *OFF* | ON }.</span><span class="sxs-lookup"><span data-stu-id="5af70-160">With this setting, each transaction's durability is determined at the transaction level - DELAYED_DURABILITY = { *OFF* | ON }.</span></span> <span data-ttu-id="5af70-161">Pour plus d’informations, consultez [contrôle de niveau de bloc atomique-procédures stockées compilées en mode natif](#atomic-block-level-control---natively-compiled-stored-procedures) et [contrôle de niveau de validation-Transact-SQL](#commit-level-control---t-sql) .</span><span class="sxs-lookup"><span data-stu-id="5af70-161">See [Atomic block level control - Natively Compiled Stored Procedures](#atomic-block-level-control---natively-compiled-stored-procedures) and [COMMIT level control - Transact-SQL](#commit-level-control---t-sql) for more information.</span></span>  
  
 `FORCED`  
 <span data-ttu-id="5af70-162">Avec ce paramètre, chaque transaction qui est validée sur la base de données a une durabilité retardée,</span><span class="sxs-lookup"><span data-stu-id="5af70-162">With this setting, every transaction that commits on the database is delayed durable.</span></span> <span data-ttu-id="5af70-163">même si la transaction spécifie une durabilité complète (DELAYED_DURABILITY = OFF) ou omette toute indication de durabilité.</span><span class="sxs-lookup"><span data-stu-id="5af70-163">Whether the transaction specifies fully durable (DELAYED_DURABILITY = OFF) or makes no specification, the transaction is delayed durable.</span></span> <span data-ttu-id="5af70-164">Ce paramètre est utile lorsque la durabilité retardée des transactions a un intérêt pour une base de données, mais que vous ne souhaitez pas modifier le code de l'application.</span><span class="sxs-lookup"><span data-stu-id="5af70-164">This setting is useful when delayed transaction durability is useful for a database and you do not want to change any application code.</span></span>  
  
### <a name="atomic-block-level-control---natively-compiled-stored-procedures"></a><span data-ttu-id="5af70-165"> Contrôle au niveau du bloc atomique - Procédures stockées compilées en mode natif</span><span class="sxs-lookup"><span data-stu-id="5af70-165">Atomic block level control - Natively Compiled Stored Procedures</span></span>  
 <span data-ttu-id="5af70-166">Le code suivant s'insère à l'intérieur du bloc atomique.</span><span class="sxs-lookup"><span data-stu-id="5af70-166">The following code goes inside the atomic block.</span></span>  
  
```sql  
DELAYED_DURABILITY = { OFF | ON }  
```  
  
 `OFF`  
 <span data-ttu-id="5af70-167">[Valeur par défaut] La transaction a une durabilité complète, sauf si l'option de base de données DELAYED_DURABLITY = FORCED est activée, auquel cas la validation COMMIT est asynchrone et donc à durabilité retardée.</span><span class="sxs-lookup"><span data-stu-id="5af70-167">[default] The transaction is fully durable, unless the database option DELAYED_DURABLITY = FORCED is in effect, in which case the commit is asynchronous and thus delayed durable.</span></span> <span data-ttu-id="5af70-168">Pour plus d’informations, consultez [Contrôle au niveau de la base de données](#database-level-control) .</span><span class="sxs-lookup"><span data-stu-id="5af70-168">See [Database level control](#database-level-control) for more information.</span></span>  
  
 `ON`  
 <span data-ttu-id="5af70-169">La transaction a une durabilité retardée, sauf si l'option de base de données DELAYED_DURABLITY = DISABLED est activée, auquel cas la validation COMMIT est synchrone et donc à durabilité complète.</span><span class="sxs-lookup"><span data-stu-id="5af70-169">The transaction is delayed durable, unless the database option DELAYED_DURABLITY = DISABLED is in effect, in which case the commit is synchronous and thus fully durable.</span></span>  <span data-ttu-id="5af70-170">Pour plus d’informations, consultez [Contrôle au niveau de la base de données](#database-level-control) .</span><span class="sxs-lookup"><span data-stu-id="5af70-170">See [Database level control](#database-level-control) for more information.</span></span>  
  
 <span data-ttu-id="5af70-171">**Exemple de code :**</span><span class="sxs-lookup"><span data-stu-id="5af70-171">**Example Code:**</span></span>  
  
```sql  
CREATE PROCEDURE <procedureName> ...  
WITH NATIVE_COMPILATION, SCHEMABINDING, EXECUTE AS OWNER  
AS BEGIN ATOMIC WITH   
(  
    DELAYED_DURABILITY = ON,  
    TRANSACTION ISOLATION LEVEL = SNAPSHOT,  
    LANGUAGE = N'English'  
    ...  
)  
END  
```  
  
### <a name="table-1-durability-in-atomic-blocks"></a><span data-ttu-id="5af70-172">Tableau 1 : durabilité dans les blocs atomiques</span><span class="sxs-lookup"><span data-stu-id="5af70-172">Table 1: Durability in Atomic Blocks</span></span>  
  
|<span data-ttu-id="5af70-173">Option de durabilité de bloc atomique</span><span class="sxs-lookup"><span data-stu-id="5af70-173">Atomic block durability option</span></span>|<span data-ttu-id="5af70-174">Aucune transaction existante</span><span class="sxs-lookup"><span data-stu-id="5af70-174">No existing transaction</span></span>|<span data-ttu-id="5af70-175">Transaction en cours (à durabilité complète ou retardée)</span><span class="sxs-lookup"><span data-stu-id="5af70-175">Transaction in process (fully or delayed durable)</span></span>|  
|------------------------------------|-----------------------------|---------------------------------------------------------|  
|`DELAYED_DURABILITY = OFF`|<span data-ttu-id="5af70-176">Le bloc atomique démarre une nouvelle transaction à durabilité complète.</span><span class="sxs-lookup"><span data-stu-id="5af70-176">Atomic block starts a new fully durable transaction.</span></span>|<span data-ttu-id="5af70-177">Le bloc atomique crée un point d'enregistrement dans la transaction existante, puis démarre la nouvelle transaction.</span><span class="sxs-lookup"><span data-stu-id="5af70-177">Atomic block creates a save point in the existing transaction, then begins the new transaction.</span></span>|  
|`DELAYED_DURABILITY = ON`|<span data-ttu-id="5af70-178">Le bloc atomique démarre une nouvelle transaction à durabilité retardée.</span><span class="sxs-lookup"><span data-stu-id="5af70-178">Atomic block starts a new delayed durable transaction.</span></span>|<span data-ttu-id="5af70-179">Le bloc atomique crée un point d'enregistrement dans la transaction existante, puis démarre la nouvelle transaction.</span><span class="sxs-lookup"><span data-stu-id="5af70-179">Atomic block creates a save point in the existing transaction, then begins the new transaction.</span></span>|  
  
### <a name="commit-level-control---t-sql"></a><span data-ttu-id="5af70-180">Contrôle de niveau de validation-(T-SQL)</span><span class="sxs-lookup"><span data-stu-id="5af70-180">COMMIT level control - (T-SQL)</span></span>
 <span data-ttu-id="5af70-181">La syntaxe de l'option COMMIT est étendue pour vous permettre de forcer la durabilité retardée des transactions.</span><span class="sxs-lookup"><span data-stu-id="5af70-181">The COMMIT syntax is extended so you can force delayed transaction durability.</span></span> <span data-ttu-id="5af70-182">Si DELAYED_DURABILITY a la valeur DISABLED ou FORCED au niveau de la base de données (voir ci-dessus), cette option COMMIT est ignorée.</span><span class="sxs-lookup"><span data-stu-id="5af70-182">If DELAYED_DURABILITY is DISABLED or FORCED at the database level (see above) this COMMIT option is ignored.</span></span>  
  
```sql  
COMMIT [ { TRAN | TRANSACTION } ] [ transaction_name | @tran_name_variable ] ] [ WITH ( DELAYED_DURABILITY = { OFF | ON } ) ]  
  
```  
  
 `OFF`  
 <span data-ttu-id="5af70-183">[Valeur par défaut] La validation COMMIT de la transaction a une durabilité complète, sauf si l'option de base de données DELAYED_DURABLITY = FORCED est activée, auquel cas la validation COMMIT est asynchrone et donc à durabilité retardée.</span><span class="sxs-lookup"><span data-stu-id="5af70-183">[default] The transaction COMMIT is fully durable, unless the database option DELAYED_DURABLITY = FORCED is in effect, in which case the COMMIT is asynchronous and thus delayed durable.</span></span> <span data-ttu-id="5af70-184">Pour plus d’informations, consultez [Contrôle au niveau de la base de données](#database-level-control) .</span><span class="sxs-lookup"><span data-stu-id="5af70-184">See [Database level control](#database-level-control) for more information.</span></span>  
  
 `ON`  
 <span data-ttu-id="5af70-185">La validation COMMIT de la transaction a une durabilité retardée, sauf si l'option de base de données DELAYED_DURABLITY = DISABLED est activée, auquel cas la validation COMMIT est synchrone et donc à durabilité complète.</span><span class="sxs-lookup"><span data-stu-id="5af70-185">The transaction COMMIT is delayed durable, unless the database option DELAYED_DURABLITY = DISABLED is in effect, in which case the COMMIT is synchronous and thus fully durable.</span></span> <span data-ttu-id="5af70-186">Pour plus d’informations, consultez [Contrôle au niveau de la base de données](#database-level-control) .</span><span class="sxs-lookup"><span data-stu-id="5af70-186">See [Database level control](#database-level-control) for more information.</span></span>  
  
### <a name="summary-of-options-and-their-interactions"></a><span data-ttu-id="5af70-187">Récapitulatif des options et de leurs interactions</span><span class="sxs-lookup"><span data-stu-id="5af70-187">Summary of options and their interactions</span></span>  
 <span data-ttu-id="5af70-188">Ce tableau récapitule les interactions entre les paramètres de durabilité retardée au niveau de la base de données et les paramètres au niveau de la validation.</span><span class="sxs-lookup"><span data-stu-id="5af70-188">This table summarizes the interactions between database level delayed durability settings and commit level settings.</span></span> <span data-ttu-id="5af70-189">Les paramètres au niveau de la base de données ont toujours priorité sur les paramètres au niveau de la validation.</span><span class="sxs-lookup"><span data-stu-id="5af70-189">Database level settings always take precedence over commit level settings.</span></span>  
  
|<span data-ttu-id="5af70-190">Paramètre de validation (COMMIT)/Paramètre de base de données</span><span class="sxs-lookup"><span data-stu-id="5af70-190">COMMIT setting/Database setting</span></span>|<span data-ttu-id="5af70-191">DELAYED_DURABILITY = DISABLED</span><span class="sxs-lookup"><span data-stu-id="5af70-191">DELAYED_DURABILITY = DISABLED</span></span>|<span data-ttu-id="5af70-192">DELAYED_DURABILITY = ALLOWED</span><span class="sxs-lookup"><span data-stu-id="5af70-192">DELAYED_DURABILITY = ALLOWED</span></span>|<span data-ttu-id="5af70-193">DELAYED_DURABILITY = FORCED</span><span class="sxs-lookup"><span data-stu-id="5af70-193">DELAYED_DURABILITY = FORCED</span></span>|  
|--------------------------------------|-------------------------------------|------------------------------------|-----------------------------------|  
|<span data-ttu-id="5af70-194">Transactions au niveau de la base de données `DELAYED_DURABILITY = OFF`.</span><span class="sxs-lookup"><span data-stu-id="5af70-194">`DELAYED_DURABILITY = OFF` Database level transactions.</span></span>|<span data-ttu-id="5af70-195">La transaction a une durabilité complète.</span><span class="sxs-lookup"><span data-stu-id="5af70-195">Transaction is fully durable.</span></span>|<span data-ttu-id="5af70-196">La transaction a une durabilité complète.</span><span class="sxs-lookup"><span data-stu-id="5af70-196">Transaction is fully durable.</span></span>|<span data-ttu-id="5af70-197">La transaction a une durabilité retardée.</span><span class="sxs-lookup"><span data-stu-id="5af70-197">Transaction is delayed durable.</span></span>|  
|<span data-ttu-id="5af70-198">Transactions au niveau de la base de données `DELAYED_DURABILITY = ON`.</span><span class="sxs-lookup"><span data-stu-id="5af70-198">`DELAYED_DURABILITY = ON` Database level transactions.</span></span>|<span data-ttu-id="5af70-199">La transaction a une durabilité complète.</span><span class="sxs-lookup"><span data-stu-id="5af70-199">Transaction is fully durable.</span></span>|<span data-ttu-id="5af70-200">La transaction a une durabilité retardée.</span><span class="sxs-lookup"><span data-stu-id="5af70-200">Transaction is delayed durable.</span></span>|<span data-ttu-id="5af70-201">La transaction a une durabilité retardée.</span><span class="sxs-lookup"><span data-stu-id="5af70-201">Transaction is delayed durable.</span></span>|  
|<span data-ttu-id="5af70-202">Transaction distribuée ou de bases de données croisées `DELAYED_DURABILITY = OFF`.</span><span class="sxs-lookup"><span data-stu-id="5af70-202">`DELAYED_DURABILITY = OFF` Cross database or distributed transaction.</span></span>|<span data-ttu-id="5af70-203">La transaction a une durabilité complète.</span><span class="sxs-lookup"><span data-stu-id="5af70-203">Transaction is fully durable.</span></span>|<span data-ttu-id="5af70-204">La transaction a une durabilité complète.</span><span class="sxs-lookup"><span data-stu-id="5af70-204">Transaction is fully durable.</span></span>|<span data-ttu-id="5af70-205">La transaction a une durabilité complète.</span><span class="sxs-lookup"><span data-stu-id="5af70-205">Transaction is fully durable.</span></span>|  
|<span data-ttu-id="5af70-206">Transaction distribuée ou de bases de données croisées `DELAYED_DURABILITY = ON`.</span><span class="sxs-lookup"><span data-stu-id="5af70-206">`DELAYED_DURABILITY = ON` Cross database or distributed transaction.</span></span>|<span data-ttu-id="5af70-207">La transaction a une durabilité complète.</span><span class="sxs-lookup"><span data-stu-id="5af70-207">Transaction is fully durable.</span></span>|<span data-ttu-id="5af70-208">La transaction a une durabilité complète.</span><span class="sxs-lookup"><span data-stu-id="5af70-208">Transaction is fully durable.</span></span>|<span data-ttu-id="5af70-209">La transaction a une durabilité complète.</span><span class="sxs-lookup"><span data-stu-id="5af70-209">Transaction is fully durable.</span></span>|  
  
## <a name="how-to-force-a-transaction-log-flush"></a><span data-ttu-id="5af70-210">Procédure pour forcer le vidage du journal de transactions</span><span class="sxs-lookup"><span data-stu-id="5af70-210">How to force a transaction log flush</span></span>  
 <span data-ttu-id="5af70-211">Il existe deux moyens pour forcer le vidage du journal de transactions sur le disque.</span><span class="sxs-lookup"><span data-stu-id="5af70-211">There are two means to force flush the transaction log to disk.</span></span>  
  
-   <span data-ttu-id="5af70-212">Exécutez chaque transaction à durabilité complète qui modifie la même base de données.</span><span class="sxs-lookup"><span data-stu-id="5af70-212">Execute any fully durable transaction that alters the same database.</span></span> <span data-ttu-id="5af70-213">De cette façon, vous forcez le vidage sur le disque des enregistrements de journal de toutes les transactions à durabilité retardée déjà validées.</span><span class="sxs-lookup"><span data-stu-id="5af70-213">This forces a flush of the log records of all preceding committed delayed durability transactions to disk.</span></span>  
  
-   <span data-ttu-id="5af70-214">Exécutez la procédure stockée système `sp_flush_log`.</span><span class="sxs-lookup"><span data-stu-id="5af70-214">Execute the system stored procedure `sp_flush_log`.</span></span> <span data-ttu-id="5af70-215">Cette procédure force le vidage sur le disque des enregistrements de journal de toutes les transactions à durabilité retardée déjà validées.</span><span class="sxs-lookup"><span data-stu-id="5af70-215">This procedure forces a flush of the log records of all preceding committed delayed durable transactions to disk.</span></span> <span data-ttu-id="5af70-216">Pour plus d’informations, consultez [sys.sp_flush_log &#40;Transact-SQL&#41;](/sql/relational-databases/system-stored-procedures/sys-sp-flush-log-transact-sql).</span><span class="sxs-lookup"><span data-stu-id="5af70-216">For more information see [sys.sp_flush_log &#40;Transact-SQL&#41;](/sql/relational-databases/system-stored-procedures/sys-sp-flush-log-transact-sql).</span></span>  
  
##  <a name="delayed-durability-and-other-sql-server-features"></a><span data-ttu-id="5af70-217">Durabilité retardée et autres fonctionnalités de SQL Server</span><span class="sxs-lookup"><span data-stu-id="5af70-217">Delayed durability and other SQL Server features</span></span>  
 <span data-ttu-id="5af70-218">**Suivi des modifications et capture de données modifiées**</span><span class="sxs-lookup"><span data-stu-id="5af70-218">**Change tracking and change data capture**</span></span>  
 <span data-ttu-id="5af70-219">Toutes les transactions avec suivi des modifications ont une durabilité complète.</span><span class="sxs-lookup"><span data-stu-id="5af70-219">All transactions with change tracking are fully durable.</span></span> <span data-ttu-id="5af70-220">Une transaction présente la propriété de suivi des modifications si elle effectue des opérations d’écriture dans des tables qui sont activées pour le suivi des modifications.</span><span class="sxs-lookup"><span data-stu-id="5af70-220">A transaction has the change tracking property if it does any write operations to tables that are enabled for change tracking.</span></span> <span data-ttu-id="5af70-221">L’utilisation de la durabilité différée n’est pas prise en charge pour les bases de données qui utilisent la capture de données modifiées (CDC).</span><span class="sxs-lookup"><span data-stu-id="5af70-221">The use of delayed durability is not supported for databases which use change data capture (CDC).</span></span>   
  
 <span data-ttu-id="5af70-222">**Récupération sur incident**</span><span class="sxs-lookup"><span data-stu-id="5af70-222">**Crash recovery**</span></span>  
 <span data-ttu-id="5af70-223">La cohérence est garantie, mais certaines modifications des transactions à durabilité retardée qui ont été validées peuvent être perdues.</span><span class="sxs-lookup"><span data-stu-id="5af70-223">Consistency is guaranteed, but some changes from delayed durable transactions that have committed may be lost.</span></span>  
  
 <span data-ttu-id="5af70-224">**Bases de données croisées et DTC**</span><span class="sxs-lookup"><span data-stu-id="5af70-224">**Cross-database and DTC**</span></span>  
 <span data-ttu-id="5af70-225">Les transactions distribuées ou de bases de données croisées ont une durabilité complète, quel que soit le paramètre de validation des bases de données ou des transactions.</span><span class="sxs-lookup"><span data-stu-id="5af70-225">If a transaction is cross-database or distributed, if is fully durable, regardless of any database or transaction commit setting.</span></span>  
  
 <span data-ttu-id="5af70-226">**Groupes de disponibilité Always On et mise en miroir**</span><span class="sxs-lookup"><span data-stu-id="5af70-226">**Always On Availability Groups and Mirroring**</span></span>  
 <span data-ttu-id="5af70-227">Les transactions à durabilité retardée ne garantissent aucune durabilité sur le réplica principal ni sur les réplicas secondaires.</span><span class="sxs-lookup"><span data-stu-id="5af70-227">Delayed durable transactions do not guarantee any durability on either the primary or any of the secondaries.</span></span> <span data-ttu-id="5af70-228">En outre, elles ne garantissent aucune information sur la transaction au niveau du réplica secondaire.</span><span class="sxs-lookup"><span data-stu-id="5af70-228">In addition, they do not guarantee any knowledge about the transaction at the secondary.</span></span> <span data-ttu-id="5af70-229">Après une validation (COMMIT), le contrôle est restitué au client avant qu'un accusé de réception (ACK) ne soit reçu d'un réplica synchrone secondaire.</span><span class="sxs-lookup"><span data-stu-id="5af70-229">After commit, control is returned to the client before any acknowledgement is received from any synchronous secondary.</span></span>  
  
 <span data-ttu-id="5af70-230">**Clustering de basculement**</span><span class="sxs-lookup"><span data-stu-id="5af70-230">**Failover clustering**</span></span>  
 <span data-ttu-id="5af70-231">Certaines écritures de transactions à durabilité retardée peuvent être perdues.</span><span class="sxs-lookup"><span data-stu-id="5af70-231">Some delayed durable transaction writes might be lost.</span></span>  
  
 <span data-ttu-id="5af70-232">**Réplication de transaction**</span><span class="sxs-lookup"><span data-stu-id="5af70-232">**Transaction Replication**</span></span>  
 <span data-ttu-id="5af70-233">Les transactions durables différées ne sont pas prises en charge avec la réplication transactionnelle.</span><span class="sxs-lookup"><span data-stu-id="5af70-233">Delayed durable transactions is not supported with Transactional Replication.</span></span>  
  
 <span data-ttu-id="5af70-234">**Copie des journaux de transaction**</span><span class="sxs-lookup"><span data-stu-id="5af70-234">**Log shipping**</span></span>  
 <span data-ttu-id="5af70-235">Seules les transactions rendues durables sont incluses dans le journal qui est copié.</span><span class="sxs-lookup"><span data-stu-id="5af70-235">Only transactions that have been made durable are included in the log that is shipped.</span></span>  
  
 <span data-ttu-id="5af70-236">**Sauvegarde de journal**</span><span class="sxs-lookup"><span data-stu-id="5af70-236">**Log Backup**</span></span>  
 <span data-ttu-id="5af70-237">Seules les transactions rendues durables sont incluses dans la sauvegarde.</span><span class="sxs-lookup"><span data-stu-id="5af70-237">Only transactions that have been made durable are included in the backup.</span></span>  
  
## <a name="when-can-i-lose-data"></a><span data-ttu-id="5af70-238">Quand puis-je perdre des données ?</span><span class="sxs-lookup"><span data-stu-id="5af70-238">When can I lose data?</span></span>  
 <span data-ttu-id="5af70-239">Si vous implémentez la durabilité retardée sur l'une de vos tables, certaines circonstances peuvent entraîner une perte de données.</span><span class="sxs-lookup"><span data-stu-id="5af70-239">If you implement delayed durability on any of your tables, you should understand that certain circumstances can lead to data loss.</span></span> <span data-ttu-id="5af70-240">Si vous ne pouvez pas vous permettre de perdre des données, n'utilisez pas la durabilité retardée sur les tables.</span><span class="sxs-lookup"><span data-stu-id="5af70-240">If you cannot tolerate any data loss, you should not use delayed durability on your tables.</span></span>  
  
### <a name="catastrophic-events"></a><span data-ttu-id="5af70-241">Événements graves</span><span class="sxs-lookup"><span data-stu-id="5af70-241">Catastrophic events</span></span>  
 <span data-ttu-id="5af70-242">Dans le cas d'événements graves, par exemple une défaillance du serveur, vous pouvez perdre les données de toutes les transactions validées qui n'ont pas été enregistrées sur le disque.</span><span class="sxs-lookup"><span data-stu-id="5af70-242">In the case of a catastrophic event, like a server crash, you will lose the data for all committed transactions that have not been saved to disk.</span></span> <span data-ttu-id="5af70-243">Les transactions durables retardées sont enregistrées sur le disque quand une transaction à durabilité complète est exécutée sur une table (durable optimisé en mémoire ou sur disque) dans la base de données, ou quand `sp_flush_log` est appelé.</span><span class="sxs-lookup"><span data-stu-id="5af70-243">Delayed durable transactions are saved to disk whenever a fully durable transaction is executed against any table (durable memory-optimized or disk-based) in the database, or `sp_flush_log` is called.</span></span> <span data-ttu-id="5af70-244">Si vous utilisez des transactions durables retardées, vous pouvez créer une petite table dans la base de données afin de mettre à jour ou d'appeler périodiquement `sp_flush_log` pour enregistrer toutes les transactions validées en attente.</span><span class="sxs-lookup"><span data-stu-id="5af70-244">If you are using delayed durable transactions, you may want to create a small table in the database that you can periodically update or periodically call `sp_flush_log` to save all outstanding committed transactions.</span></span> <span data-ttu-id="5af70-245">Le journal des transactions est également vidé quand il est plein, mais cela est difficile à prévoir et impossible à contrôler.</span><span class="sxs-lookup"><span data-stu-id="5af70-245">The transaction log also flushes whenever it becomes full, but that is hard to predict and impossible to control.</span></span>  
  
### <a name="sql-server-shutdown-and-restart"></a><span data-ttu-id="5af70-246">SQL Server l’arrêt et le redémarrage</span><span class="sxs-lookup"><span data-stu-id="5af70-246">SQL Server shutdown and restart</span></span>  
 <span data-ttu-id="5af70-247">Pour une durabilité retardée, il n'y a pas de différence entre un arrêt inattendu et un arrêt/redémarrage attendu de [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)].</span><span class="sxs-lookup"><span data-stu-id="5af70-247">For delayed durability, there is no difference between an unexpected shutdown and an expected shutdown/restart of [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)].</span></span> <span data-ttu-id="5af70-248">Comme pour les événements graves, vous devez prévoir une perte de données.</span><span class="sxs-lookup"><span data-stu-id="5af70-248">Like catastrophic events, you should plan for data loss.</span></span> <span data-ttu-id="5af70-249">Dans un arrêt/redémarrage planifié, certaines transactions qui n'ont pas été écrites sur disque peuvent tout d'abord l'être, mais vous ne pouvez pas planifier cela.</span><span class="sxs-lookup"><span data-stu-id="5af70-249">In a planned shutdown/restart some transactions that have not been written to disk may first be saved to disk, but you should not plan on it.</span></span> <span data-ttu-id="5af70-250">La planification comme pour un arrêt/redémarrage, planifiée ou non, entraîne la perte de données comme pour un événement grave.</span><span class="sxs-lookup"><span data-stu-id="5af70-250">Plan as though a shutdown/restart, whether planned or unplanned, loses the data the same as a catastrophic event.</span></span>  
  
## <a name="see-also"></a><span data-ttu-id="5af70-251">Voir aussi</span><span class="sxs-lookup"><span data-stu-id="5af70-251">See Also</span></span>  
 <span data-ttu-id="5af70-252">[Niveaux d’isolation des transactions](../../database-engine/transaction-isolation-levels.md) </span><span class="sxs-lookup"><span data-stu-id="5af70-252">[Transaction Isolation Levels](../../database-engine/transaction-isolation-levels.md) </span></span>  
 [<span data-ttu-id="5af70-253">Instructions pour les niveaux d'isolement des transactions sur les tables mémoire optimisées</span><span class="sxs-lookup"><span data-stu-id="5af70-253">Guidelines for Transaction Isolation Levels with Memory-Optimized Tables</span></span>](../in-memory-oltp/memory-optimized-tables.md)  
  
  
