---
title: Comprendre le fournisseur WMI pour les événements de serveur | Microsoft Docs
ms.custom: ''
ms.date: 03/06/2017
ms.prod: sql-server-2014
ms.reviewer: ''
ms.technology: wmi
ms.topic: reference
helpviewer_keywords:
- architecture [WMI]
- SQL Server Agent [WMI]
- WMI Provider for Server Events, about WMI Provider for Server Events
ms.assetid: 8fd7bd18-76d0-4b28-8fee-8ad861441ab2
author: CarlRabeler
ms.author: carlrab
ms.openlocfilehash: ef583d479e473b6f5e71fef59f2221697248b45f
ms.sourcegitcommit: ad4d92dce894592a259721a1571b1d8736abacdb
ms.translationtype: MT
ms.contentlocale: fr-FR
ms.lasthandoff: 08/04/2020
ms.locfileid: "87707332"
---
# <a name="understanding-the-wmi-provider-for-server-events"></a><span data-ttu-id="573e9-102">Présentation du fournisseur WMI pour les événements serveur</span><span class="sxs-lookup"><span data-stu-id="573e9-102">Understanding the WMI Provider for Server Events</span></span>
  <span data-ttu-id="573e9-103">Le fournisseur WMI pour les événements de serveur vous permet d'utiliser WMI (Windows Management Instrumentation) pour surveiller les événements dans [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)].</span><span class="sxs-lookup"><span data-stu-id="573e9-103">The WMI Provider for Server Events lets you use the Windows Management Instrumentation (WMI) to monitor events in [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)].</span></span> <span data-ttu-id="573e9-104">Ce fournisseur fonctionne en transformant [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] en un objet WMI managé.</span><span class="sxs-lookup"><span data-stu-id="573e9-104">The provider works by turning [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] into a managed WMI object.</span></span> <span data-ttu-id="573e9-105">Tout événement qui peut générer une notification d'événements dans [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] peut tirer parti de WMI via ce fournisseur.</span><span class="sxs-lookup"><span data-stu-id="573e9-105">Any event that can generate an event notification in [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] can be leveraged by the WMI by using this provider.</span></span> <span data-ttu-id="573e9-106">En outre, l'Agent [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)], en tant qu'application de gestion qui interagit avec WMI, peut répondre à ces événements, ce qui augmente l'étendue des événements traités par l'Agent [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] par rapport aux versions antérieures.</span><span class="sxs-lookup"><span data-stu-id="573e9-106">Additionally, as a management application that interacts with the WMI, [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] Agent can respond to these events, increasing the scope of events covered by [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] Agent over earlier releases.</span></span>

 <span data-ttu-id="573e9-107">Les applications de gestion telles que l'Agent [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] peuvent accéder aux événements [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] via le fournisseur WMI pour les événements serveur en publiant des instructions WQL (WMI Query Language).</span><span class="sxs-lookup"><span data-stu-id="573e9-107">Management applications such as [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] Agent can access [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] events using the WMI Provider for Server Events by issuing WMI Query Language (WQL) statements.</span></span> <span data-ttu-id="573e9-108">Le langage WQL est un sous-ensemble simplifié du langage SQL, avec quelques extensions spécifiques à WMI.</span><span class="sxs-lookup"><span data-stu-id="573e9-108">WQL is a simplified subset of structured query language (SQL), with some WMI-specific extensions.</span></span> <span data-ttu-id="573e9-109">À l'aide du langage WQL, une application récupère un type d'événement à partir d'une base de données ou d'un objet de base de données spécifique.</span><span class="sxs-lookup"><span data-stu-id="573e9-109">In using WQL, an application retrieves an event type against a specific database or database object.</span></span> <span data-ttu-id="573e9-110">Le fournisseur WMI pour les événements serveur traduit la requête en une notification d'événements, ce qui entraîne la création effective d'une notification d'événements dans la base de données cible.</span><span class="sxs-lookup"><span data-stu-id="573e9-110">The WMI Provider for Server Events translates the query into an event notification, effectively creating an event notification in the target database.</span></span> <span data-ttu-id="573e9-111">Pour plus d’informations sur le fonctionnement des notifications d’événements dans [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] , consultez [fournisseur WMI pour les concepts des événements de serveur](https://technet.microsoft.com/library/ms180560.aspx).</span><span class="sxs-lookup"><span data-stu-id="573e9-111">For more information about how event notifications work in [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)], see [WMI Provider for Server Events Concepts](https://technet.microsoft.com/library/ms180560.aspx).</span></span> <span data-ttu-id="573e9-112">Les événements qui peuvent être interrogés sont répertoriés dans [fournisseur WMI pour les classes et les propriétés d’événements de serveur](../../relational-databases/wmi-provider-server-events/wmi-provider-for-server-events-classes-and-properties.md).</span><span class="sxs-lookup"><span data-stu-id="573e9-112">The events that can be queried are listed in [WMI Provider for Server Events Classes and Properties](../../relational-databases/wmi-provider-server-events/wmi-provider-for-server-events-classes-and-properties.md).</span></span>

 <span data-ttu-id="573e9-113">Lorsqu’un événement qui déclenche la notification d’événement pour envoyer un message se produit, le message est envoyé à un service cible prédéfini dans **msdb** , nommé **SQL/Notifications/ProcessWMIEventProviderNotification/v 1.0**.</span><span class="sxs-lookup"><span data-stu-id="573e9-113">When an event occurs that triggers the event notification to send a message, the message goes to a predefined target service in **msdb** that is named **SQL/Notifications/ProcessWMIEventProviderNotification/v1.0**.</span></span> <span data-ttu-id="573e9-114">Le service place l’événement dans une file d’attente prédéfinie dans la base de données **msdb** nommée **WMIEventProviderNotificationQueue**.</span><span class="sxs-lookup"><span data-stu-id="573e9-114">The service puts the event into a predefined queue in **msdb** that is named **WMIEventProviderNotificationQueue**.</span></span> <span data-ttu-id="573e9-115">(Le service et la file d’attente sont créés dynamiquement par le fournisseur lorsqu’il se connecte pour la première fois à [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] .) Le fournisseur lit ensuite les données d’événement de cette file d’attente et les transforme en MOF (Managed Object Format) avant de les retourner à l’application.</span><span class="sxs-lookup"><span data-stu-id="573e9-115">(Both the service and the queue are created dynamically by the provider when it first connects to [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)].) The provider then reads the event data from this queue and transforms it into managed object format (MOF) before returning it to the application.</span></span> <span data-ttu-id="573e9-116">L'illustration ci-dessous montre ce processus.</span><span class="sxs-lookup"><span data-stu-id="573e9-116">The following illustration shows this process.</span></span>

 <span data-ttu-id="573e9-117">![Diagramme de flux du fournisseur WMI pour les événements de serveur](../../../2014/database-engine/dev-guide/media/wmi-provider-functional-spec.gif "Diagramme de flux du fournisseur WMI pour les événements de serveur")</span><span class="sxs-lookup"><span data-stu-id="573e9-117">![Flow diagram of the WMI Provider for Server Events](../../../2014/database-engine/dev-guide/media/wmi-provider-functional-spec.gif "Flow diagram of the WMI Provider for Server Events")</span></span>

 <span data-ttu-id="573e9-118">Examinons, par exemple, la requête WQL suivante :</span><span class="sxs-lookup"><span data-stu-id="573e9-118">For example, consider the following WQL Query:</span></span>

```
SELECT * FROM DDL_DATABASE_LEVEL_EVENTS
WHERE DatabaseName = 'AdventureWorks'
```

 <span data-ttu-id="573e9-119">En réponse à cette requête, le fournisseur WMI pour les événements serveur crée la notification d'événements équivalente dans la base de données cible :</span><span class="sxs-lookup"><span data-stu-id="573e9-119">In response to this query, the WMI Provider for Server Events creates the equivalent event notification in the target database:</span></span>

```
USE AdventureWorks ;
GO
CREATE EVENT NOTIFICATION SQLWEP_76CF38C1_18BB_42DD_A7DC_C8820155B0E9
    ON DATABASE
    WITH FAN_IN
    FOR DDL_DATABASE_LEVEL_EVENTS
    TO SERVICE
        'SQL/Notifications/ProcessWMIEventProviderNotification/v1.0', 
        'A7E5521A-1CA6-4741-865D-826F804E5135';
GO
```

 <span data-ttu-id="573e9-120">Dans cet exemple, `SQLWEP_76CF38C1_18BB_42DD_A7DC_C8820155B0E9` est un identificateur [!INCLUDE[tsql](../../includes/tsql-md.md)] composé du préfixe `SQLWEP_` et d'un GUID.</span><span class="sxs-lookup"><span data-stu-id="573e9-120">In this example, `SQLWEP_76CF38C1_18BB_42DD_A7DC_C8820155B0E9` is a [!INCLUDE[tsql](../../includes/tsql-md.md)] identifier that is made up of the prefix `SQLWEP_` and a GUID.</span></span> <span data-ttu-id="573e9-121">`SQLWEP` crée un GUID pour chaque identificateur.</span><span class="sxs-lookup"><span data-stu-id="573e9-121">`SQLWEP` creates a new GUID for each identifier.</span></span> <span data-ttu-id="573e9-122">La valeur `A7E5521A-1CA6-4741-865D-826F804E5135` dans la `TO SERVICE` clause est le GUID qui identifie l’instance Broker dans la base de données **msdb** .</span><span class="sxs-lookup"><span data-stu-id="573e9-122">The value `A7E5521A-1CA6-4741-865D-826F804E5135` in the `TO SERVICE` clause is the GUID that identifies the broker instance in the **msdb** database.</span></span>

 <span data-ttu-id="573e9-123">Pour plus d’informations sur l’utilisation de WQL, consultez [utilisation de WQL avec le fournisseur WMI pour les événements de serveur](https://technet.microsoft.com/library/ms180524\(v=sql.105\).aspx).</span><span class="sxs-lookup"><span data-stu-id="573e9-123">For more information about how to work with WQL, see [Using WQL with the WMI Provider for Server Events](https://technet.microsoft.com/library/ms180524\(v=sql.105\).aspx).</span></span>

 <span data-ttu-id="573e9-124">Les applications de gestion dirigent le fournisseur WMI pour les événements serveur vers une instance de [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] en se connectant à un espace de noms WMI défini par le fournisseur.</span><span class="sxs-lookup"><span data-stu-id="573e9-124">Management applications direct the WMI Provider for Server Events to an instance of [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] by connecting to a WMI namespace that is defined by the provider.</span></span> <span data-ttu-id="573e9-125">Le service WMI de Windows mappe cet espace de noms à la DLL de fournisseur, Sqlwep.dll, puis la charge en mémoire.</span><span class="sxs-lookup"><span data-stu-id="573e9-125">The Windows WMI service maps this namespace to the provider DLL, Sqlwep.dll, and loads it into memory.</span></span> <span data-ttu-id="573e9-126">Le fournisseur gère un espace de noms WMI pour les événements serveur pour chaque instance de [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] et le format est : \\ \\ . \\ *root*\Microsoft\SqlServer\ServerEvents racine \\ *instance_name*, où *instance_name* par défaut est MSSQLSERVER.</span><span class="sxs-lookup"><span data-stu-id="573e9-126">The provider manages a WMI namespace for Server Events for each instance of [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)], and the format is: \\\\.\\*root*\Microsoft\SqlServer\ServerEvents\\*instance_name*, where *instance_name* defaults to MSSQLSERVER.</span></span> <span data-ttu-id="573e9-127">Pour plus d’informations sur la façon de se connecter à un espace de noms WMI pour une instance de [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] , consultez [utilisation de WQL avec le fournisseur WMI pour les événements de serveur](https://technet.microsoft.com/library/ms180524\(v=sql.105\).aspx).</span><span class="sxs-lookup"><span data-stu-id="573e9-127">For more information about how to connect to a WMI namespace for an instance of [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)], see [Using WQL with the WMI Provider for Server Events](https://technet.microsoft.com/library/ms180524\(v=sql.105\).aspx).</span></span>

 <span data-ttu-id="573e9-128">La DLL de fournisseur, Sqlwep.dll, est chargée une seule fois dans le service hôte WMI du système d'exploitation du serveur, indépendamment du nombre d'instances de [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] présentes sur le serveur.</span><span class="sxs-lookup"><span data-stu-id="573e9-128">The provider DLL, Sqlwep.dll, is loaded only one time into the WMI host service of the operating system of the server, regardless of how many instances of [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] are on the server.</span></span>

 <span data-ttu-id="573e9-129">Pour obtenir un exemple d' [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] application de gestion d’agent qui utilise le fournisseur WMI pour les événements de serveur, consultez [exemple : création d’une alerte de SQL Server agent à l’aide du fournisseur WMI pour les événements de serveur](https://technet.microsoft.com/library/ms186385.aspx).</span><span class="sxs-lookup"><span data-stu-id="573e9-129">For an example of a [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] Agent management application that uses the WMI Provider for Server Events, see [Sample: Creating a SQL Server Agent Alert Using the WMI Provider for Server Events](https://technet.microsoft.com/library/ms186385.aspx).</span></span> <span data-ttu-id="573e9-130">Pour obtenir un exemple d’application de gestion qui utilise le fournisseur WMI pour les événements de serveur dans le code managé, consultez [exemple : utilisation du fournisseur d’événements WMI dans du code managé](https://technet.microsoft.com/library/ms179315.aspx).</span><span class="sxs-lookup"><span data-stu-id="573e9-130">For an example of a management application that uses the WMI Provider for Server Events in managed code, see [Sample: Using the WMI Event Provider in Managed Code](https://technet.microsoft.com/library/ms179315.aspx).</span></span> <span data-ttu-id="573e9-131">Des informations supplémentaires sont également disponibles sur WMI dans le [!INCLUDE[msCoName](../../includes/msconame-md.md)] [!INCLUDE[dnprdnshort](../../includes/dnprdnshort-md.md)] Kit de développement logiciel (SDK).</span><span class="sxs-lookup"><span data-stu-id="573e9-131">More information is also available about WMI in the [!INCLUDE[msCoName](../../includes/msconame-md.md)] [!INCLUDE[dnprdnshort](../../includes/dnprdnshort-md.md)] SDK.</span></span>

## <a name="see-also"></a><span data-ttu-id="573e9-132">Voir aussi</span><span class="sxs-lookup"><span data-stu-id="573e9-132">See Also</span></span>
 [<span data-ttu-id="573e9-133">Fournisseur WMI pour les concepts des événements de serveur</span><span class="sxs-lookup"><span data-stu-id="573e9-133">WMI Provider for Server Events Concepts</span></span>](https://technet.microsoft.com/library/ms180560.aspx)


