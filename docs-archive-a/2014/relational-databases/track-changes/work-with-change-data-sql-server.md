---
title: Utiliser les données modifiées (SQL Server) | Microsoft Docs
ms.custom: ''
ms.date: 06/13/2017
ms.prod: sql-server-2014
ms.reviewer: ''
ms.technology: ''
ms.topic: conceptual
helpviewer_keywords:
- change data [SQL Server]
- change data capture [SQL Server], query function scenarios
- change data capture [SQL Server], LSN boundaries
- change data capture [SQL Server], query functions
ms.assetid: 5346b852-1af8-4080-b278-12efb9b735eb
author: rothja
ms.author: jroth
ms.openlocfilehash: 018d5add95e5d0936f6055e1c6710b6a8ddabdab
ms.sourcegitcommit: ad4d92dce894592a259721a1571b1d8736abacdb
ms.translationtype: MT
ms.contentlocale: fr-FR
ms.lasthandoff: 08/04/2020
ms.locfileid: "87611633"
---
# <a name="work-with-change-data-sql-server"></a><span data-ttu-id="9b3e8-102">Utiliser les données modifiées (SQL Server)</span><span class="sxs-lookup"><span data-stu-id="9b3e8-102">Work with Change Data (SQL Server)</span></span>
  <span data-ttu-id="9b3e8-103">Les données modifiées sont mises à disposition des consommateurs de capture de données modifiées par le biais de fonctions table.</span><span class="sxs-lookup"><span data-stu-id="9b3e8-103">Change data is made available to change data capture consumers through table-valued functions (TVFs).</span></span> <span data-ttu-id="9b3e8-104">Toutes les requêtes de ces fonctions requièrent deux paramètres afin de définir la plage de numéros séquentiels dans le journal (LSN) éligibles lors du développement du jeu de résultats retourné.</span><span class="sxs-lookup"><span data-stu-id="9b3e8-104">All queries of these functions require two parameters to define the range of Log Sequence Numbers (LSNs) that are eligible for consideration when developing the returned result set.</span></span> <span data-ttu-id="9b3e8-105">Les valeurs supérieures et inférieures de ces numéros qui lient l'intervalle sont considérées comme étant incluses dans l'intervalle.</span><span class="sxs-lookup"><span data-stu-id="9b3e8-105">Both the upper and lower LSN values that bound the interval are considered to be included within the interval.</span></span>  
  
 <span data-ttu-id="9b3e8-106">Plusieurs fonctions sont fournies pour aider à déterminer les valeurs LSN appropriées utilisables dans l'interrogation d'une fonction table.</span><span class="sxs-lookup"><span data-stu-id="9b3e8-106">Several functions are provided to help determine appropriate LSN values for use in querying a TVF.</span></span> <span data-ttu-id="9b3e8-107">La fonction [sys.fn_cdc_get_min_lsn](/sql/relational-databases/system-functions/sys-fn-cdc-get-min-lsn-transact-sql) retourne la valeur LSN la plus faible associée à un intervalle de validité d’instance de capture.</span><span class="sxs-lookup"><span data-stu-id="9b3e8-107">The function [sys.fn_cdc_get_min_lsn](/sql/relational-databases/system-functions/sys-fn-cdc-get-min-lsn-transact-sql) returns the smallest LSN that is associated with a capture instance validity interval.</span></span> <span data-ttu-id="9b3e8-108">L'intervalle de validité est l'intervalle de temps pendant lequel des données modifiées sont disponibles pour leurs instances de capture.</span><span class="sxs-lookup"><span data-stu-id="9b3e8-108">The validity interval is the time interval for which change data is currently available for its capture instances.</span></span> <span data-ttu-id="9b3e8-109">La fonction [sys.fn_cdc_get_max_lsn](/sql/relational-databases/system-functions/sys-fn-cdc-get-max-lsn-transact-sql) retourne la valeur LSN la plus élevée dans l’intervalle de validité.</span><span class="sxs-lookup"><span data-stu-id="9b3e8-109">The function [sys.fn_cdc_get_max_lsn](/sql/relational-databases/system-functions/sys-fn-cdc-get-max-lsn-transact-sql) returns the largest LSN in the validity interval.</span></span> <span data-ttu-id="9b3e8-110">Les fonctions [sys.fn_cdc_map_time_to_lsn](/sql/relational-databases/system-functions/sys-fn-cdc-map-time-to-lsn-transact-sql) et [sys.fn_cdc_map_lsn_to_time](/sql/relational-databases/system-functions/sys-fn-cdc-map-lsn-to-time-transact-sql) aident à placer des valeurs LSN sur une chronologie classique.</span><span class="sxs-lookup"><span data-stu-id="9b3e8-110">The functions [sys.fn_cdc_map_time_to_lsn](/sql/relational-databases/system-functions/sys-fn-cdc-map-time-to-lsn-transact-sql) and [sys.fn_cdc_map_lsn_to_time](/sql/relational-databases/system-functions/sys-fn-cdc-map-lsn-to-time-transact-sql) are available to help place LSN values on a conventional timeline.</span></span> <span data-ttu-id="9b3e8-111">Étant donné que la capture de données modifiées utilise des intervalles de requête fermés, il est quelquefois nécessaire de générer la valeur LSN suivante dans une séquence afin de s'assurer que les modifications ne sont pas dupliquées dans des fenêtres de requête consécutives.</span><span class="sxs-lookup"><span data-stu-id="9b3e8-111">Because change data capture uses closed query intervals, it is sometimes necessary to generate the next LSN value in a sequence to ensure that changes are not duplicated in consecutive query windows.</span></span> <span data-ttu-id="9b3e8-112">Les fonctions [sys.fn_cdc_increment_lsn](/sql/relational-databases/system-functions/sys-fn-cdc-increment-lsn-transact-sql) et [sys.fn_cdc_decrement_lsn](/sql/relational-databases/system-functions/sys-fn-cdc-decrement-lsn-transact-sql) sont utiles quand un ajustement incrémentiel d’une valeur LSN est nécessaire.</span><span class="sxs-lookup"><span data-stu-id="9b3e8-112">The functions [sys.fn_cdc_increment_lsn](/sql/relational-databases/system-functions/sys-fn-cdc-increment-lsn-transact-sql) and [sys.fn_cdc_decrement_lsn](/sql/relational-databases/system-functions/sys-fn-cdc-decrement-lsn-transact-sql) are useful when an incremental adjustment to an LSN value is required.</span></span>  
  
##  <a name="validating-lsn-boundaries"></a><a name="LSN"></a> <span data-ttu-id="9b3e8-113">Validation de limites LSN</span><span class="sxs-lookup"><span data-stu-id="9b3e8-113">Validating LSN Boundaries</span></span>  
 <span data-ttu-id="9b3e8-114">Nous vous recommandons de procéder à la validation préalable des limites LSN à utiliser dans une requête de fonction table.</span><span class="sxs-lookup"><span data-stu-id="9b3e8-114">We recommend validating the LSN boundaries that are to be used in a TVF query before their use.</span></span> <span data-ttu-id="9b3e8-115">Les points de terminaison nuls ou ceux qui se trouvent à l'extérieur de l'intervalle de validité pour une instance de capture forcent le retour d'une erreur par une fonction table de capture de données modifiées.</span><span class="sxs-lookup"><span data-stu-id="9b3e8-115">Null endpoints or endpoints that lie outside the validity interval for a capture instance will force an error to be returned by a change data capture TVF.</span></span>  
  
 <span data-ttu-id="9b3e8-116">Ainsi, l'erreur ci-après est retournée dans le cadre d'une recherche portant sur toutes les modifications lorsqu'un paramètre utilisé pour définir l'intervalle de requête n'est pas valide, est hors limites, ou lorsque l'option de filtre de lignes n'est pas valide.</span><span class="sxs-lookup"><span data-stu-id="9b3e8-116">For example, the following error is returned for a query for all changes when a parameter that is used to define the query interval is not valid, or is out of range, or the row filter option is invalid.</span></span>  
  
 `Msg 313, Level 16, State 3, Line 1`  
  
 `An insufficient number of arguments were supplied for the procedure or function cdc.fn_cdc_get_all_changes_ ...`  
  
 <span data-ttu-id="9b3e8-117">L'erreur correspondante retournée pour une requête `net changes` est la suivante :</span><span class="sxs-lookup"><span data-stu-id="9b3e8-117">The corresponding error returned for a `net changes` query is the following:</span></span>  
  
 `Msg 313, Level 16, State 3, Line 1`  
  
 `An insufficient number of arguments were supplied for the procedure or function cdc.fn_cdc_get_net_changes_ ...`  
  
> [!NOTE]  
>  <span data-ttu-id="9b3e8-118">Il est reconnu que le message pour Msg 313 est trompeur et n'indique pas la cause réelle de l'échec.</span><span class="sxs-lookup"><span data-stu-id="9b3e8-118">It is recognized that the message for Msg 313 is misleading and does not convey the actual cause of the failure.</span></span> <span data-ttu-id="9b3e8-119">Cette utilisation maladroite provient de l'incapacité à lever une erreur explicite à partir d'une fonction table.</span><span class="sxs-lookup"><span data-stu-id="9b3e8-119">This awkward usage stems from the inability to raise an explicit error from within a TVF.</span></span> <span data-ttu-id="9b3e8-120">Néanmoins, il a été jugé préférable de retourner une erreur reconnaissable (quoiqu'inexacte) plutôt que de simplement retourner un résultat vide.</span><span class="sxs-lookup"><span data-stu-id="9b3e8-120">Nevertheless, the value of returning a recognizable, if inaccurate, error was deemed preferable to simply returning an empty result.</span></span> <span data-ttu-id="9b3e8-121">Il aurait été impossible de faire la distinction entre un jeu de résultats vide et une requête valide ne retournant aucune modification.</span><span class="sxs-lookup"><span data-stu-id="9b3e8-121">An empty result set would not be distinguishable from a valid query returning no changes.</span></span>  
  
 <span data-ttu-id="9b3e8-122">Les échecs d'autorisation retournent des erreurs lors de la recherche de toutes les modifications, comme indiqué ci-dessous :</span><span class="sxs-lookup"><span data-stu-id="9b3e8-122">Authorization failures will return failures when querying for all changes, as shown:</span></span>  
  
 `Msg 229, Level 14, State 5, Line 1`  
  
 `The SELECT permission was denied on the object 'fn_cdc_get_all_changes_...', database 'MyDB', schema 'cdc'.`  
  
 <span data-ttu-id="9b3e8-123">Ceci est également valable lors de l'interrogation des modifications nettes :</span><span class="sxs-lookup"><span data-stu-id="9b3e8-123">The same is true when querying for net changes:</span></span>  
  
 `Msg 229, Level 14, State 5, Line 1`  
  
 `The SELECT permission was denied on the object fn_cdc_get_net_changes_...', database 'MyDB', schema 'cdc'.`  
  
 <span data-ttu-id="9b3e8-124">Consultez le modèle utilisé pour énumérer des modifications nettes à l'aide de TRY CATCH afin de voir comment intercepter ces erreurs de fonction table connues et retourner des informations plus explicites à propos de l'échec.</span><span class="sxs-lookup"><span data-stu-id="9b3e8-124">See the template Enumerate Net Changes Using TRY CATCH for a demonstration of how to intercept these known TVF errors and return more meaningful information about the failure.</span></span>  
  
> [!NOTE]  
>  <span data-ttu-id="9b3e8-125">Pour rechercher des modèles de capture de données modifiées dans SQL Server Management Studio, dans le menu **Affichage** , cliquez sur **Explorateur de modèles**, développez **Modèles SQL Server** , puis développez le dossier **Capture de données modifiées** .</span><span class="sxs-lookup"><span data-stu-id="9b3e8-125">To locate change data capture templates in SQL Server Management Studio, on the **View** menu, click **Template Explorer**, expand **SQL Server Templates** and then expand the **Change Data Capture** folder.</span></span>  
  
##  <a name="query-functions"></a><a name="Functions"></a> <span data-ttu-id="9b3e8-126">Fonctions de requête</span><span class="sxs-lookup"><span data-stu-id="9b3e8-126">Query Functions</span></span>  
 <span data-ttu-id="9b3e8-127">Selon les caractéristiques de la table source faisant l'objet d'un suivi et la configuration de son instance de capture, une ou deux fonctions table sont générées pour la recherche des données modifiées.</span><span class="sxs-lookup"><span data-stu-id="9b3e8-127">Depending on the characteristics of the source table being tracked and the way in which its capture instance is configured, either one or two TVFs for querying change data are generated.</span></span>  
  
-   <span data-ttu-id="9b3e8-128">La fonction [cdc.fn_cdc_get_all_changes_<instance_de_capture>](/sql/relational-databases/system-functions/cdc-fn-cdc-get-all-changes-capture-instance-transact-sql) retourne toutes les modifications qui ont été effectuées pendant l’intervalle spécifié.</span><span class="sxs-lookup"><span data-stu-id="9b3e8-128">The function [cdc.fn_cdc_get_all_changes_<capture_instance>](/sql/relational-databases/system-functions/cdc-fn-cdc-get-all-changes-capture-instance-transact-sql) returns all changes that occurred for the specified interval.</span></span> <span data-ttu-id="9b3e8-129">Cette fonction est toujours générée.</span><span class="sxs-lookup"><span data-stu-id="9b3e8-129">This function is always generated.</span></span> <span data-ttu-id="9b3e8-130">Les entrées sont toujours retournées triées, tout d'abord par le numéro LSN de validation de transaction de la modification, puis par une valeur qui classe la modification dans sa transaction.</span><span class="sxs-lookup"><span data-stu-id="9b3e8-130">Entries are always returned sorted, first by the transaction commit LSN of the change, and then by a value that sequences the change within its transaction.</span></span> <span data-ttu-id="9b3e8-131">Selon l'option de filtre de lignes choisie, la ligne finale est retournée lors de la mise à jour (option de filtre de lignes « all ») ou les valeurs ancienne et nouvelle sont toutes deux retournées lors de la mise à jour (option de filtre de lignes « all update old »).</span><span class="sxs-lookup"><span data-stu-id="9b3e8-131">Depending on the row filter option chosen, either the final row is returned on update (row filter option "all") or both the new and old values are returned on update (row filter option "all update old"').</span></span>  
  
-   <span data-ttu-id="9b3e8-132">La fonction [cdc.fn_cdc_get_net_changes_<instance_de_capture>](/sql/relational-databases/system-functions/cdc-fn-cdc-get-net-changes-capture-instance-transact-sql) est générée quand le paramètre @supports_net_changes a pour valeur 1 quand la table source est activée.</span><span class="sxs-lookup"><span data-stu-id="9b3e8-132">The function [cdc.fn_cdc_get_net_changes_<capture_instance>](/sql/relational-databases/system-functions/cdc-fn-cdc-get-net-changes-capture-instance-transact-sql) is generated when the parameter @supports_net_changes is set to 1 when the source table is enabled.</span></span>  
  
    > [!NOTE]  
    >  <span data-ttu-id="9b3e8-133">Cette option est prise en charge uniquement si la table source possède une clé primaire définie ou si le paramètre @index_name a été utilisé pour identifier un index unique.</span><span class="sxs-lookup"><span data-stu-id="9b3e8-133">This option is only supported if the source table has a defined primary key or if the parameter @index_name has been used to identify a unique index.</span></span>  
  
     <span data-ttu-id="9b3e8-134">La fonction **netchanges** retourne une modification par ligne de table source modifiée.</span><span class="sxs-lookup"><span data-stu-id="9b3e8-134">The **netchanges** function returns one change per modified source table row.</span></span> <span data-ttu-id="9b3e8-135">Si plusieurs modifications sont enregistrées pour la ligne pendant l'intervalle spécifié, les valeurs de colonne reflètent le contenu final de la ligne.</span><span class="sxs-lookup"><span data-stu-id="9b3e8-135">If more than one change is logged for the row during the specified interval, the column values will reflect the final contents of the row.</span></span> <span data-ttu-id="9b3e8-136">Pour identifier correctement l'opération requise pour la mise à jour de l'environnement cible, la fonction table doit prendre en compte à la fois l'opération initiale sur la ligne pendant l'intervalle et la dernière opération sur la ligne.</span><span class="sxs-lookup"><span data-stu-id="9b3e8-136">To correctly identify the operation that is necessary to update the target environment, the TVF must consider both the initial operation on the row during the interval and the final operation on the row.</span></span> <span data-ttu-id="9b3e8-137">Lorsque l'option de filtre de lignes « all » est spécifiée, les opérations retournées par une interrogation `net changes` sont insertion, suppression ou mise à jour (nouvelles valeurs).</span><span class="sxs-lookup"><span data-stu-id="9b3e8-137">When the row filter option 'all' is specified, the operations that are returned by a `net changes` query will either be insert, delete, or update (new values).</span></span> <span data-ttu-id="9b3e8-138">Cette option retourne toujours la valeur Null pour le masque de mise à jour car un coût est associé au calcul d'un masque d'agrégation.</span><span class="sxs-lookup"><span data-stu-id="9b3e8-138">This option always returns the update mask as null because there is a cost associated with computing an aggregate mask.</span></span> <span data-ttu-id="9b3e8-139">Si vous avez besoin d'un masque d'agrégation qui reflète toutes les modifications apportées à une ligne, utilisez l'option « all with mask ».</span><span class="sxs-lookup"><span data-stu-id="9b3e8-139">If you require an aggregate mask that reflects all changes to a row, use the 'all with mask' option.</span></span> <span data-ttu-id="9b3e8-140">Si la distinction entre les insertions et les mises à jour n'est pas nécessaire pour le traitement en aval, utilisez l'option « all with merge ».</span><span class="sxs-lookup"><span data-stu-id="9b3e8-140">If downstream processing does not require inserts and updates to be distinguished, use the 'all with merge' option.</span></span> <span data-ttu-id="9b3e8-141">Dans ce cas, l'opération prendra uniquement deux valeurs : 1 pour une suppression et 5 pour une insertion ou une mise à jour.</span><span class="sxs-lookup"><span data-stu-id="9b3e8-141">In this case, the operation value will only take on two values: 1 for delete and 5 for an operation that could be either an insert or an update.</span></span> <span data-ttu-id="9b3e8-142">Cette option supprime le traitement supplémentaire requis pour déterminer si l'opération dérivée doit être une insertion ou une mise à jour. Cela permet d'améliorer les performances de la requête lorsque cette distinction n'est pas nécessaire.</span><span class="sxs-lookup"><span data-stu-id="9b3e8-142">This option eliminates the additional processing needed to determine whether the derived operation should be an insert or an update, and can improve the performance of the query when this differentiation is not necessary.</span></span>  
  
 <span data-ttu-id="9b3e8-143">Le masque de mise à jour retourné par une fonction d'interrogation est une représentation compacte qui identifie toutes les colonnes ayant changé sur une ligne de données modifiées.</span><span class="sxs-lookup"><span data-stu-id="9b3e8-143">The update mask that is returned from a query function is a compact representation that identifies all columns that changed in a row of change data.</span></span> <span data-ttu-id="9b3e8-144">En général, ces informations sont nécessaires uniquement pour un petit sous-ensemble des colonnes capturées.</span><span class="sxs-lookup"><span data-stu-id="9b3e8-144">Typically, this information is only required for a small subset of the captured columns.</span></span> <span data-ttu-id="9b3e8-145">Des fonctions permettant d'extraire des informations du masque dans un format directement exploitable par les applications sont disponibles.</span><span class="sxs-lookup"><span data-stu-id="9b3e8-145">Functions are available to assist in extracting information from the mask in a form that is more directly usable by applications.</span></span> <span data-ttu-id="9b3e8-146">La fonction [sys.fn_cdc_get_column_ordinal](/sql/relational-databases/system-functions/sys-fn-cdc-get-column-ordinal-transact-sql) retourne la position ordinale d’une colonne nommée pour une instance de capture donnée, alors que la fonction [sys.fn_cdc_is_bit_set](/sql/relational-databases/system-functions/sys-fn-cdc-is-bit-set-transact-sql) retourne la parité du bit dans le masque fourni, en fonction de la position ordinale transmise dans l’appel de fonction.</span><span class="sxs-lookup"><span data-stu-id="9b3e8-146">The function [sys.fn_cdc_get_column_ordinal](/sql/relational-databases/system-functions/sys-fn-cdc-get-column-ordinal-transact-sql) returns the ordinal position of a named column for a given capture instance, whereas the function [sys.fn_cdc_is_bit_set](/sql/relational-databases/system-functions/sys-fn-cdc-is-bit-set-transact-sql) returns the parity of the bit in the provided mask based on the ordinal that was passed in the function call.</span></span> <span data-ttu-id="9b3e8-147">Ces deux fonctions permettent d'extraire efficacement les informations du masque de mise à jour et de les retourner avec la requête de données modifiées.</span><span class="sxs-lookup"><span data-stu-id="9b3e8-147">Together, these two functions allow information from the update mask to be efficiently extracted and returned with the request for change data.</span></span> <span data-ttu-id="9b3e8-148">Consultez le modèle utilisé pour énumérer les modifications nettes à l'aide du modèle « All With Mask » afin de voir comment ces fonctions sont utilisées.</span><span class="sxs-lookup"><span data-stu-id="9b3e8-148">See the template Enumerate Net Changes Using All With Mask for a demonstration of how these functions are used.</span></span>  
  
##  <a name="query-function-scenarios"></a><a name="Scenarios"></a> <span data-ttu-id="9b3e8-149">Scénarios de fonction de requête</span><span class="sxs-lookup"><span data-stu-id="9b3e8-149">Query Function Scenarios</span></span>  
 <span data-ttu-id="9b3e8-150">Les sections ci-après décrivent des scénarios courants permettant de rechercher des données de capture des données modifiées en utilisant les fonctions de requête cdc.fn_cdc_get_all_changes_<instance_capture> et cdc.fn_cdc_get_net_changes_<instance_capture>.</span><span class="sxs-lookup"><span data-stu-id="9b3e8-150">The following sections describe common scenarios for querying change data capture data by using the query functions cdc.fn_cdc_get_all_changes_<capture_instance> and cdc.fn_cdc_get_net_changes_<capture_instance>.</span></span>  
  
### <a name="querying-for-all-changes-within-the-capture-instance-validity-interval"></a><span data-ttu-id="9b3e8-151">Recherche de toutes les modifications dans l'intervalle de validité d'instance de capture</span><span class="sxs-lookup"><span data-stu-id="9b3e8-151">Querying for All Changes Within the Capture Instance Validity Interval</span></span>  
 <span data-ttu-id="9b3e8-152">La recherche de données modifiées la plus simple est celle qui retourne toutes les données modifiées actuelles dans l’intervalle de validité d’une instance de capture.</span><span class="sxs-lookup"><span data-stu-id="9b3e8-152">The most straightforward request for change data is one that returns all of the current change data in a capture instance's validity interval.</span></span> <span data-ttu-id="9b3e8-153">Avant d'exécuter cette requête, commencez par déterminer les limites LSN inférieures et supérieures de l'intervalle de validité.</span><span class="sxs-lookup"><span data-stu-id="9b3e8-153">To make this request, first determine the lower and upper LSN boundaries of the validity interval.</span></span> <span data-ttu-id="9b3e8-154">Ensuite, utilisez ces valeurs pour identifier les paramètres @from_lsn et @to_lsn transmis à la fonction de requête cdc.fn_cdc_get_all_changes<instance_capture> ou cdc.fn_cdc_get_net_changes_<instance_capture>.</span><span class="sxs-lookup"><span data-stu-id="9b3e8-154">Then, use these values to identify the parameters @from_lsn and @to_lsn passed to the query function cdc.fn_cdc_get_all_changes_<capture_instance> or cdc.fn_cdc_get_net_changes_<capture_instance>.</span></span> <span data-ttu-id="9b3e8-155">Utilisez la fonction [sys.fn_cdc_get_min_lsn](/sql/relational-databases/system-functions/sys-fn-cdc-get-min-lsn-transact-sql) pour obtenir la limite inférieure et la fonction [sys.fn_cdc_get_max_lsn](/sql/relational-databases/system-functions/sys-fn-cdc-get-max-lsn-transact-sql) pour obtenir la limite supérieure.</span><span class="sxs-lookup"><span data-stu-id="9b3e8-155">Use the function [sys.fn_cdc_get_min_lsn](/sql/relational-databases/system-functions/sys-fn-cdc-get-min-lsn-transact-sql) to obtain the lower bound, and [sys.fn_cdc_get_max_lsn](/sql/relational-databases/system-functions/sys-fn-cdc-get-max-lsn-transact-sql) to obtain the upper bound.</span></span> <span data-ttu-id="9b3e8-156">Consultez le modèle utilisé pour énumérer toutes les modifications pour la plage valide afin d'obtenir un exemple de code dans lequel toutes les modifications valides actuelles sont recherchées à l'aide de la fonction de requête cdc.fn_cdc_get_all_changes_<instance_capture>.</span><span class="sxs-lookup"><span data-stu-id="9b3e8-156">See the template Enumerate All Changes for the Valid Range for sample code to query for all current valid changes by using the query function cdc.fn_cdc_get_all_changes_<capture_instance>.</span></span> <span data-ttu-id="9b3e8-157">Consultez le modèle utilisé pour énumérer les modifications nettes pour la plage valide afin d'obtenir un exemple semblable d'utilisation de la fonction cdc.fn_cdc_get_net_changes_<instance_capture>.</span><span class="sxs-lookup"><span data-stu-id="9b3e8-157">See the template Enumerate Net Changes for the Valid Range for a similar example of using the function cdc.fn_cdc_get_net_changes_<capture_instance>.</span></span>  
  
### <a name="querying-for-all-new-changes-since-the-last-set-of-changes"></a><span data-ttu-id="9b3e8-158">Recherche de toutes les nouvelles modifications depuis le dernier ensemble de modifications</span><span class="sxs-lookup"><span data-stu-id="9b3e8-158">Querying for All New Changes Since the Last Set of Changes</span></span>  
 <span data-ttu-id="9b3e8-159">Pour les applications conventionnelles, la recherche de données modifiées est un processus continu, qui effectue des demandes périodiques pour toutes les modifications qui se sont produites depuis la dernière demande.</span><span class="sxs-lookup"><span data-stu-id="9b3e8-159">For typical applications, querying for change data will be an ongoing process, making periodic requests for all of the changes that occurred since the last request.</span></span> <span data-ttu-id="9b3e8-160">Avec de telles requêtes, vous pouvez utiliser la fonction [sys.fn_cdc_increment_lsn](/sql/relational-databases/system-functions/sys-fn-cdc-increment-lsn-transact-sql) pour obtenir la limite inférieure de la requête actuelle à partir de la limite supérieure de la requête précédente.</span><span class="sxs-lookup"><span data-stu-id="9b3e8-160">For such queries, you can use the function [sys.fn_cdc_increment_lsn](/sql/relational-databases/system-functions/sys-fn-cdc-increment-lsn-transact-sql) to derive the lower bound of the current query from the upper bound of the previous query.</span></span> <span data-ttu-id="9b3e8-161">Cette méthode garantit qu'aucune ligne n'est répétée car l'intervalle de requête est toujours traité comme un intervalle fermé dans lequel les deux points d'arrêt sont inclus.</span><span class="sxs-lookup"><span data-stu-id="9b3e8-161">This method ensures that no rows are repeated because the query interval is always treated as a closed interval where both end-points are included in the interval.</span></span> <span data-ttu-id="9b3e8-162">Ensuite, utilisez la fonction [sys.fn_cdc_get_max_lsn](/sql/relational-databases/system-functions/sys-fn-cdc-get-max-lsn-transact-sql) pour obtenir le point d’arrêt supérieur pour le nouvel intervalle de requête.</span><span class="sxs-lookup"><span data-stu-id="9b3e8-162">Then, use the function [sys.fn_cdc_get_max_lsn](/sql/relational-databases/system-functions/sys-fn-cdc-get-max-lsn-transact-sql) to obtain the high end-point for the new request interval.</span></span> <span data-ttu-id="9b3e8-163">Consultez le modèle utilisé pour énumérer toutes les modifications depuis la dernière demande afin d'obtenir un exemple de code permettant de déplacer systématiquement la fenêtre de requête et d'obtenir toutes les modifications depuis la dernière demande.</span><span class="sxs-lookup"><span data-stu-id="9b3e8-163">See the template Enumerate All Changes Since Previous Request for sample code to systematically move the query window to obtain all changes since the last request.</span></span>  
  
### <a name="querying-for-all-new-changes-up-until-now"></a><span data-ttu-id="9b3e8-164">Recherche de toutes les nouvelles modifications jusqu'à maintenant</span><span class="sxs-lookup"><span data-stu-id="9b3e8-164">Querying for all New Changes Up Until Now</span></span>  
 <span data-ttu-id="9b3e8-165">Une contrainte type placée sur les modifications retournées par une fonction de requête consiste à inclure uniquement les modifications qui se sont produites entre la demande précédente et la date et l'heure du jour.</span><span class="sxs-lookup"><span data-stu-id="9b3e8-165">A typical constraint that is placed on the changes returned by a query function is to include only the changes that occurred between the previous request until the current date and time.</span></span> <span data-ttu-id="9b3e8-166">Pour cette requête, appliquez la fonction sys.fn_cdc_increment_lsn à la valeur @from_lsn qui a été utilisée dans la demande précédente, afin de déterminer la limite inférieure.</span><span class="sxs-lookup"><span data-stu-id="9b3e8-166">For this query, apply the function sys.fn_cdc_increment_lsn to the @from_lsn value that was used in the previous request to determine the lower bound.</span></span> <span data-ttu-id="9b3e8-167">Étant donné que la limite supérieure de l'intervalle de temps est exprimée comme une limite dans le temps spécifique, elle doit être convertie en une valeur LSN avant de pouvoir être utilisée par une fonction de requête.</span><span class="sxs-lookup"><span data-stu-id="9b3e8-167">Because the upper bound on the time interval is expressed as a specific point in time, it must be converted to an LSN value before it can be used by a query function.</span></span> <span data-ttu-id="9b3e8-168">Avant que la valeur datetime puisse être convertie en une valeur LSN correspondante, vous devez vous assurer que le processus de capture a terminé le traitement de toutes les modifications validées jusqu'à la limite supérieure spécifiée.</span><span class="sxs-lookup"><span data-stu-id="9b3e8-168">Before the datetime value can be converted to a corresponding LSN value, you must ensure that the capture process has processed all changes that were committed through the specified upper bound.</span></span> <span data-ttu-id="9b3e8-169">Cette condition est nécessaire pour garantir que toutes les modifications applicables ont été propagées à la table de modifications.</span><span class="sxs-lookup"><span data-stu-id="9b3e8-169">This is required to ensure that all the qualifying changes have been propagated to the change table.</span></span> <span data-ttu-id="9b3e8-170">L'une des méthodes possibles consiste à structurer une boucle d'attente qui vérifie périodiquement si la valeur LSN de validation maximale actuelle enregistrée pour toute table de modifications de base de données dépasse l'heure de fin souhaitée de l'intervalle de demande.</span><span class="sxs-lookup"><span data-stu-id="9b3e8-170">One way to do this is to structure a wait loop that periodically checks to see if the current maximum commit lsn recorded for any database change table exceeds the desired end time of the request interval.</span></span>  
  
 <span data-ttu-id="9b3e8-171">Une fois que la boucle d’attente a vérifié que le processus de capture a déjà traité toutes les entrées de journal pertinentes, utilisez la fonction [sys.fn_cdc_map_time_to_lsn](/sql/relational-databases/system-functions/sys-fn-cdc-map-time-to-lsn-transact-sql) pour déterminer le nouveau point d’arrêt supérieur exprimé comme valeur LSN.</span><span class="sxs-lookup"><span data-stu-id="9b3e8-171">After the delay loop verifies that the capture process has already processed all the relevant log entries, use the function [sys.fn_cdc_map_time_to_lsn](/sql/relational-databases/system-functions/sys-fn-cdc-map-time-to-lsn-transact-sql) to determine the new high end-point expressed as an LSN value.</span></span> <span data-ttu-id="9b3e8-172">Pour faire en sorte que toutes les entrées validées jusqu'à l'heure spécifiée soient extraites, appelez la fonction sys.fn_cdc_map_time_to_lsn et utilisez l'option « largest less than or equal ».</span><span class="sxs-lookup"><span data-stu-id="9b3e8-172">To ensure that all entries that were committed through the specified time are retrieved, call the function sys.fn_cdc_map_time_to_lsn, and use the option 'largest less than or equal'.</span></span>  
  
> [!NOTE]  
>  <span data-ttu-id="9b3e8-173">Dans des périodes d'inactivité, une entrée factice est ajoutée à la table cdc.lsn_time_mapping pour indiquer que le processus de capture a traité les modifications jusqu'à une heure de validation donnée.</span><span class="sxs-lookup"><span data-stu-id="9b3e8-173">In periods of inactivity, a dummy entry is added to the table cdc.lsn_time_mapping to mark the fact that the capture process has processed the changes up to a given commit time.</span></span> <span data-ttu-id="9b3e8-174">Cela empêche le processus de capture d'apparaître comme ayant pris du retard alors qu'il n'y a simplement plus aucune modification récente à traiter.</span><span class="sxs-lookup"><span data-stu-id="9b3e8-174">This prevents it from appearing that the capture process has fallen behind when there are simply no recent changes to process.</span></span>  
  
 <span data-ttu-id="9b3e8-175">Le modèle utilisé pour énumérer toutes les modifications jusqu'à maintenant montre comment utiliser la stratégie précédente pour lancer une recherche de données modifiées.</span><span class="sxs-lookup"><span data-stu-id="9b3e8-175">The template Enumerate All Changes Up Until Now demonstrates how to use the previous strategy to query for change data.</span></span>  
  
### <a name="adding-a-commit-time-to-an-all-changes-result-set"></a><span data-ttu-id="9b3e8-176">Ajout d'une heure de validation à un jeu de résultats contenant toutes les modifications</span><span class="sxs-lookup"><span data-stu-id="9b3e8-176">Adding a Commit Time to an All Changes Result Set</span></span>  
 <span data-ttu-id="9b3e8-177">L’heure de validation de chaque transaction avec une entrée associée dans une table de modifications de base de données est disponible dans la table [cdc.lsn_time_mapping](/sql/relational-databases/system-tables/cdc-lsn-time-mapping-transact-sql).</span><span class="sxs-lookup"><span data-stu-id="9b3e8-177">The commit time of each transaction with an associated entry in a database change table is available in the table [cdc.lsn_time_mapping](/sql/relational-databases/system-tables/cdc-lsn-time-mapping-transact-sql).</span></span> <span data-ttu-id="9b3e8-178">En joignant la valeur __$start_lsn retournée dans une demande de toutes les modifications avec la valeur start_lsn d'une entrée de table cdc.lsn_time_mapping, vous pouvez retourner la valeur tran_end_time avec les données modifiées pour horodater la modification avec l'heure de validation de la transaction à la source.</span><span class="sxs-lookup"><span data-stu-id="9b3e8-178">By joining the __$start_lsn value returned in a request for all changes with the start_lsn value of a cdc.lsn_time_mapping table entry, you can return the tran_end_time along with the change data to stamp the change with the commit time of the transaction at the source.</span></span> <span data-ttu-id="9b3e8-179">Le modèle utilisé pour ajouter une heure de validation à un jeu de résultats contenant toutes les modifications montre comment effectuer cette jointure.</span><span class="sxs-lookup"><span data-stu-id="9b3e8-179">The template Append Commit Time to All Changes Result Set demonstrates how to perform this join.</span></span>  
  
### <a name="joining-change-data-with-other-data-from-the-same-transaction"></a><span data-ttu-id="9b3e8-180">Jointure de données modifiées avec d'autres données de la même transaction</span><span class="sxs-lookup"><span data-stu-id="9b3e8-180">Joining Change Data with Other Data from the Same Transaction</span></span>  
 <span data-ttu-id="9b3e8-181">Il est parfois utile de joindre les données modifiées avec d'autres informations relatives à la transaction collectées lors de la validation de celle-ci à la source.</span><span class="sxs-lookup"><span data-stu-id="9b3e8-181">Occasionally, it is useful to join change data with other information gathered about the transaction when it committed at the source.</span></span> <span data-ttu-id="9b3e8-182">La colonne tran_begin_lsn dans la table cdc.lsn_time_mapping fournit les informations nécessaires pour effectuer une telle jointure.</span><span class="sxs-lookup"><span data-stu-id="9b3e8-182">The tran_begin_lsn column in the table cdc.lsn_time_mapping provides the information needed to perform such a join.</span></span> <span data-ttu-id="9b3e8-183">Quand la mise à jour de la source se produit, la valeur de database_transaction_begin_lsn dans la vue dynamique système [sys.dm_tran_database_transactions](/sql/relational-databases/system-dynamic-management-views/sys-dm-tran-database-transactions-transact-sql) doit être enregistrée en même temps que toutes les autres informations à joindre avec les données modifiées.</span><span class="sxs-lookup"><span data-stu-id="9b3e8-183">When the update of the source occurs, the value for database_transaction_begin_lsn from the system dynamic view [sys.dm_tran_database_transactions](/sql/relational-databases/system-dynamic-management-views/sys-dm-tran-database-transactions-transact-sql) must be saved along with any other information to be joined with the change data.</span></span> <span data-ttu-id="9b3e8-184">Utilisez la fonction fn_convertnumericlsntobinary pour comparer les valeurs database_transaction_begin_lsn et tran_begin_lsn.</span><span class="sxs-lookup"><span data-stu-id="9b3e8-184">Use the function fn_convertnumericlsntobinary to compare the database_transaction_begin_lsn and tran_begin_lsn values.</span></span> <span data-ttu-id="9b3e8-185">Le code permettant de créer cette fonction est disponible dans la fonction de création de modèle fn_convertnumericlsntobinary.</span><span class="sxs-lookup"><span data-stu-id="9b3e8-185">The code to create this function is available in the template Create Function fn_convertnumericlsntobinary.</span></span> <span data-ttu-id="9b3e8-186">Le modèle utilisé pour retourner toutes les modifications avec une valeur tran_begin_lsn donnée montre comment effectuer la jointure.</span><span class="sxs-lookup"><span data-stu-id="9b3e8-186">The template Return All Changes with a Given tran_begin_lsn demonstrates how to effect the join.</span></span>  
  
### <a name="querying-using-datetime-wrapper-functions"></a><span data-ttu-id="9b3e8-187">Recherche à l'aide de fonctions Wrapper Datetime</span><span class="sxs-lookup"><span data-stu-id="9b3e8-187">Querying Using Datetime Wrapper Functions</span></span>  
 <span data-ttu-id="9b3e8-188">Un scénario d'application type de recherche de données modifiées consiste à demander périodiquement des données modifiées en utilisant une fenêtre glissante délimitée par des valeurs datetime.</span><span class="sxs-lookup"><span data-stu-id="9b3e8-188">A typical application scenario for querying for change data is to periodically request change data by using a sliding window bounded by datetime values.</span></span> <span data-ttu-id="9b3e8-189">Pour cette classe de consommateurs, la capture des données modifiées fournit la procédure stockée [sys.sp_cdc_generate_wrapper_function](/sql/relational-databases/system-stored-procedures/sys-sp-cdc-generate-wrapper-function-transact-sql) qui génère des scripts permettant de créer des fonctions Wrapper personnalisées pour les fonctions de requête de capture des données modifiées.</span><span class="sxs-lookup"><span data-stu-id="9b3e8-189">For this class of consumers, change data capture provides the stored procedure [sys.sp_cdc_generate_wrapper_function](/sql/relational-databases/system-stored-procedures/sys-sp-cdc-generate-wrapper-function-transact-sql) that generates scripts to create custom wrapper functions for the change data capture query functions.</span></span> <span data-ttu-id="9b3e8-190">Ces wrappers personnalisés permettent d'exprimer l'intervalle de requête comme une paire de valeurs datetime.</span><span class="sxs-lookup"><span data-stu-id="9b3e8-190">These custom wrappers allow the query interval to be expressed as a datetime pair.</span></span>  
  
 <span data-ttu-id="9b3e8-191">L'appel d'options pour la procédure stockée permet de générer des wrappers pour toutes les instances de capture auquel l'appelant a accès, ou uniquement pour une instance de capture spécifiée.</span><span class="sxs-lookup"><span data-stu-id="9b3e8-191">Calling options for the stored procedure allow for wrappers to be generated for all capture instances that the caller has access to, or only a specified capture instance.</span></span> <span data-ttu-id="9b3e8-192">Les options prises en charge incluent également la capacité de spécifier si le point d'arrêt supérieur de l'intervalle de capture doit être ouvert ou fermé, laquelle des colonnes capturées disponibles doit être incluse dans le jeu de résultats et laquelle des colonnes incluses doit être associée à des indicateurs de mise à jour.</span><span class="sxs-lookup"><span data-stu-id="9b3e8-192">Supported options also include the ability to specify whether the high end-point of the capture interval should be open or closed, which of the available captured columns should be included in the result set and which of the included columns should have associated update flags.</span></span> <span data-ttu-id="9b3e8-193">La procédure retourne un jeu de résultats avec deux colonnes : le nom de fonction généré, qui peut être dérivé du nom d'instance de capture, et l'instruction de création pour la procédure stockée de wrapper.</span><span class="sxs-lookup"><span data-stu-id="9b3e8-193">The procedure returns a result set with two columns: the generated function name, which is derivable from the capture instance name, and the create statement for the wrapper stored procedure.</span></span> <span data-ttu-id="9b3e8-194">La fonction permettant d'inclure dans un wrapper la requête de recherche de toutes les modifications est toujours générée.</span><span class="sxs-lookup"><span data-stu-id="9b3e8-194">The function to wrap the all changes query is always generated.</span></span> <span data-ttu-id="9b3e8-195">Si le paramètre @supports_net_changes a été défini lors de la création de l’instance de capture, la fonction permettant d’inclure dans un wrapper la fonction de recherche des modifications nettes est également générée.</span><span class="sxs-lookup"><span data-stu-id="9b3e8-195">If the @supports_net_changes parameter was set when the capture instance was created, the function to wrap the net changes function is also generated.</span></span>  
  
 <span data-ttu-id="9b3e8-196">Le concepteur d'applications est chargé d'appeler la procédure stockée de génération de script afin de générer les instructions de création pour les procédures stockées de wrapper et d'exécuter les scripts de création résultants pour créer les fonctions.</span><span class="sxs-lookup"><span data-stu-id="9b3e8-196">It is the responsibility of the application designer to call the script generation stored procedure to generate the create statements for the wrapper stored procedures, and to execute the resulting create scripts to create the functions.</span></span> <span data-ttu-id="9b3e8-197">Cela ne se produit pas automatiquement lorsqu'une instance de capture est créée.</span><span class="sxs-lookup"><span data-stu-id="9b3e8-197">This does not occur automatically when a capture instance is created.</span></span>  
  
 <span data-ttu-id="9b3e8-198">Les wrappers datetime appartiennent à l'utilisateur et ne sont pas créés dans le schéma par défaut de l'appelant.</span><span class="sxs-lookup"><span data-stu-id="9b3e8-198">Datetime wrappers are owned by the user, and not are created in the default schema of the caller.</span></span> <span data-ttu-id="9b3e8-199">La fonction générée peut être utilisée par la plupart des utilisateurs, sans être modifiée.</span><span class="sxs-lookup"><span data-stu-id="9b3e8-199">The generated function is suitable without modification for most users.</span></span> <span data-ttu-id="9b3e8-200">Toutefois, il est toujours possible d'effectuer des tâches de personnalisation supplémentaires sur le script généré avant de créer la fonction.</span><span class="sxs-lookup"><span data-stu-id="9b3e8-200">However, further customization can always be applied to the generated script prior to creating the function.</span></span>  
  
 <span data-ttu-id="9b3e8-201">Le nom de la fonction permettant d'inclure dans un wrapper la requête de recherche de toutes les modifications est fn_all_changes_ suivi du nom de l'instance de capture.</span><span class="sxs-lookup"><span data-stu-id="9b3e8-201">The name of the function to wrap the all changes query is fn_all_changes_ followed by the capture instance name.</span></span> <span data-ttu-id="9b3e8-202">Le préfixe utilisé pour le wrapper des modifications nettes est fn_net_changes_.</span><span class="sxs-lookup"><span data-stu-id="9b3e8-202">The prefix that is used for the net changes wrapper is fn_net_changes_.</span></span> <span data-ttu-id="9b3e8-203">Les deux fonctions utilisent trois arguments, tout comme leurs fonctions table de capture de données modifiées associées.</span><span class="sxs-lookup"><span data-stu-id="9b3e8-203">Both functions take three arguments, just as their associated change data capture TVFs do.</span></span> <span data-ttu-id="9b3e8-204">Toutefois, l'intervalle de requête pour les wrappers est délimité par deux valeurs datetime au lieu de deux valeurs LSN.</span><span class="sxs-lookup"><span data-stu-id="9b3e8-204">However, the query interval for the wrappers is bounded by two datetime values instead of than by two LSN values.</span></span> <span data-ttu-id="9b3e8-205">Le paramètre @row_filter_option pour les deux ensembles de fonctions est le même.</span><span class="sxs-lookup"><span data-stu-id="9b3e8-205">The @row_filter_option parameter for both sets of functions are the same.</span></span>  
  
 <span data-ttu-id="9b3e8-206">Les fonctions wrapper générées prennent en charge la convention suivante pour parcourir systématiquement la chronologie de capture de données modifiées : le paramètre @end_time de l’intervalle précédent est censé être utilisé comme paramètre @start_time de l’intervalle suivant.</span><span class="sxs-lookup"><span data-stu-id="9b3e8-206">The generated wrapper functions support the following convention for systematically walking the change data capture timeline: It is expected that the @end_time parameter of the previous interval be used as the @start_time parameter of the subsequent interval.</span></span> <span data-ttu-id="9b3e8-207">La fonction wrapper se charge de mapper les valeurs datetime aux valeurs LSN et de garantir qu'aucune donnée n'est perdue ou répétée si cette convention est suivie.</span><span class="sxs-lookup"><span data-stu-id="9b3e8-207">The wrapper function takes care of mapping the datetime values to LSN values and ensuring that no data is lost or repeated if this convention is followed.</span></span>  
  
 <span data-ttu-id="9b3e8-208">Les wrappers peuvent être générés pour prendre en charge une limite supérieure fermée ou une limite supérieure ouverte sur la fenêtre de requête spécifiée.</span><span class="sxs-lookup"><span data-stu-id="9b3e8-208">The wrappers can be generated to support either a closed upper bound or an open upper bound on the specified query window.</span></span> <span data-ttu-id="9b3e8-209">Autrement dit, l'appelant peut spécifier si les entrées ayant une heure de validation égale à la limite supérieure de l'intervalle d'extraction doivent être incluses dans l'intervalle.</span><span class="sxs-lookup"><span data-stu-id="9b3e8-209">That is, the caller can specify whether entries having a commit time equal to the upper bound of the extraction interval are to be included within the interval.</span></span> <span data-ttu-id="9b3e8-210">Par défaut, la limite supérieure est incluse.</span><span class="sxs-lookup"><span data-stu-id="9b3e8-210">By default, the upper bound is included.</span></span>  
  
 <span data-ttu-id="9b3e8-211">Alors que les fonctions table de requête générées échouent si elles ont fourni une valeur Null pour @from_lsn ou @to_lsn, les fonctions wrapper datetime utilisent une valeur Null pour permettre aux wrappers datetime de retourner toutes les modifications actuelles.</span><span class="sxs-lookup"><span data-stu-id="9b3e8-211">While the generated query TVFs fail if supplied a null value for either the @from_lsn value or the @to_lsn value, the datetime wrapper functions use null to allow the datetime wrappers to return all current changes.</span></span> <span data-ttu-id="9b3e8-212">Autrement dit, si une valeur Null est transmise comme point d'arrêt inférieur de la fenêtre de requête au wrapper datetime, le point d'arrêt inférieur de l'intervalle de validité d'instance de capture est utilisé dans l'instruction SELECT sous-jacente appliquée à la fonction table de requête.</span><span class="sxs-lookup"><span data-stu-id="9b3e8-212">That is, if null is passed as the low end-point of the query window to the datetime wrapper, the low end point of the capture instance validity interval is used in the underlying SELECT statement that is applied to the query TVF.</span></span> <span data-ttu-id="9b3e8-213">De la même façon, si une valeur Null est transmise comme point d'arrêt supérieur de la fenêtre de requête, le point d'arrêt supérieur de l'intervalle de validité d'instance de capture est utilisé lors de la sélection de la fonction table de requête.</span><span class="sxs-lookup"><span data-stu-id="9b3e8-213">Similarly, if null is passed as the high end-point of the query window, the high end-point of the capture instance validity interval is used when selecting from the query TVF.</span></span>  
  
 <span data-ttu-id="9b3e8-214">Le jeu de résultats retourné par une fonction wrapper inclut toutes les colonnes demandées suivies d'une colonne d'opération, réécrite sous forme d'un ou de deux caractères pour identifier l'opération associée à la ligne.</span><span class="sxs-lookup"><span data-stu-id="9b3e8-214">The result set returned by a wrapper function includes all the requested columns followed by an operation column, recoded as one or two characters to identify the operation that is associated with the row.</span></span> <span data-ttu-id="9b3e8-215">Si des indicateurs de mise à jour ont été demandés, ils apparaissent sous la forme de colonnes de bits après le code d’opération et dans l’ordre spécifié dans le paramètre @update_flag_list.</span><span class="sxs-lookup"><span data-stu-id="9b3e8-215">If update flags have been requested, they appear as bit columns after the operation code, in the order specified in the @update_flag_list parameter.</span></span> <span data-ttu-id="9b3e8-216">Pour plus d’informations sur les options d’appel permettant de personnaliser les wrappers datetime générés, consultez [sys.sp_cdc_generate_wrapper_function &#40;Transact-SQL&#41;](/sql/relational-databases/system-stored-procedures/sys-sp-cdc-generate-wrapper-function-transact-sql).</span><span class="sxs-lookup"><span data-stu-id="9b3e8-216">For information about the calling options for customizing the generated datetime wrappers, see [sys.sp_cdc_generate_wrapper_function &#40;Transact-SQL&#41;](/sql/relational-databases/system-stored-procedures/sys-sp-cdc-generate-wrapper-function-transact-sql).</span></span>  
  
 <span data-ttu-id="9b3e8-217">Le modèle utilisé pour instancier une fonction table wrapper avec un indicateur de mise à jour montre comment personnaliser une fonction wrapper générée afin d'ajouter un indicateur de mise à jour pour une colonne spécifiée au jeu de résultats retourné par une requête de modifications nettes.</span><span class="sxs-lookup"><span data-stu-id="9b3e8-217">The template Instantiate a Wrapper TVF With Update Flag shows how to customize a generated wrapper function to append an update flag for a specified column to the result set returned by a net changes query.</span></span> <span data-ttu-id="9b3e8-218">Le modèle utilisé pour instancier des fonctions table wrapper CDC pour un schéma montre comment instancier les wrappers Datetime pour les fonctions table de requête pour toutes les instances de capture créées pour les tables sources dans un schéma de base de données spécifique.</span><span class="sxs-lookup"><span data-stu-id="9b3e8-218">The template Instantiate CDC Wrapper TVFs for a Schema shows how to instantiate the Datetime Wrappers for the Query TVFs for all of the capture instances created for the source tables in a given database schema.</span></span>  
  
 <span data-ttu-id="9b3e8-219">Le modèle utilisé pour obtenir des modifications nettes à l'aide d'un wrapper avec des indicateurs de mise à jour contient un exemple qui utilise un wrapper datetime pour rechercher des données modifiées.</span><span class="sxs-lookup"><span data-stu-id="9b3e8-219">For an example that uses a datetime wrapper to query for change data, see the template Get Net Changes Using Wrapper With Update Flags.</span></span> <span data-ttu-id="9b3e8-220">Ce modèle montre comment lancer une recherche de modifications nettes avec une fonction wrapper lorsque le wrapper est configuré pour retourner des indicateurs de mise à jour.</span><span class="sxs-lookup"><span data-stu-id="9b3e8-220">This template demonstrates how to query for net changes with a wrapper function when the wrapper is configured to return update flags.</span></span> <span data-ttu-id="9b3e8-221">Notez que l'option de filtre de lignes « all with mask » est requise pour que la fonction de requête sous-jacente retourne un masque de mise à jour non Null lors d'une mise à jour.</span><span class="sxs-lookup"><span data-stu-id="9b3e8-221">Note that the row filter option 'all with mask' is required for the underlying query function to return a non-null update mask on update.</span></span> <span data-ttu-id="9b3e8-222">Les valeurs Null sont transmises pour les limites inférieure et supérieure de l'intervalle datetime afin de signaler à la fonction qu'elle doit utiliser le point d'arrêt inférieur et le point d'arrêt supérieur de l'intervalle de validité pour l'instance de capture lorsqu'elle effectue la requête LSN sous-jacente.</span><span class="sxs-lookup"><span data-stu-id="9b3e8-222">Null values are passed for both the lower and upper datetime interval boundaries to signal the function to use the low end point and the high end point of the validity interval for the capture instance when performing the underlying LSN based query.</span></span> <span data-ttu-id="9b3e8-223">La requête retourne une ligne pour chaque modification apportée à une ligne source dans la plage valide pour l'instance de capture.</span><span class="sxs-lookup"><span data-stu-id="9b3e8-223">The query returns one row for each modification to a source row that occurred within the valid range for the capture instance.</span></span>  
  
### <a name="using-the-datetime-wrapper-functions-to-transition-between-capture-instances"></a><span data-ttu-id="9b3e8-224">Utilisation des fonctions wrapper Datetime pour assurer la transition entre des instances de capture</span><span class="sxs-lookup"><span data-stu-id="9b3e8-224">Using the Datetime Wrapper Functions to Transition Between Capture Instances</span></span>  
 <span data-ttu-id="9b3e8-225">La capture de données modifiées prend en charge jusqu'à deux instances de capture pour une seule table source suivie.</span><span class="sxs-lookup"><span data-stu-id="9b3e8-225">Change data capture supports up to two capture instances for a single tracked source table.</span></span> <span data-ttu-id="9b3e8-226">Cette fonction est principalement utilisée pour permettre une transition entre plusieurs instances de capture lorsque les modifications de langage de définition de données (DDL) effectuées sur la table source étendent le jeu des colonnes disponibles à des fins de suivi.</span><span class="sxs-lookup"><span data-stu-id="9b3e8-226">The principal use of this capability is to accommodate a transition between multiple capture instances when data definition language (DDL) changes to the source table expand the set of available columns for tracking.</span></span> <span data-ttu-id="9b3e8-227">Lors de la transition vers une nouvelle instance de capture, l'une des méthodes permettant de protéger les niveaux d'application supérieurs contre tout changement éventuel de nom des fonctions de requête sous-jacentes consiste à utiliser une fonction wrapper pour inclure dans un wrapper l'appel sous-jacent.</span><span class="sxs-lookup"><span data-stu-id="9b3e8-227">When transitioning to a new capture instance, one way to protect higher application levels from changes in the names of the underlying query functions is to use a wrapper function to wrap the underlying call.</span></span> <span data-ttu-id="9b3e8-228">Ensuite, vous devez vous assurer que le nom de la fonction wrapper reste le même.</span><span class="sxs-lookup"><span data-stu-id="9b3e8-228">Then, ensure that the name of the wrapper function remains the same.</span></span> <span data-ttu-id="9b3e8-229">Lorsque le changement est sur le point de se produire, l'ancienne fonction wrapper peut être supprimée, et une nouvelle fonction wrapper portant le même nom et faisant référence aux nouvelles fonctions de requête peut être créée.</span><span class="sxs-lookup"><span data-stu-id="9b3e8-229">When the switch is to occur, the old wrapper function can be dropped, and a new one with the same name created that references the new query functions.</span></span> <span data-ttu-id="9b3e8-230">Le fait de commencer par modifier le script généré pour créer une fonction wrapper du même nom vous permet de passer à une nouvelle instance de capture sans affecter les couches d'application supérieures.</span><span class="sxs-lookup"><span data-stu-id="9b3e8-230">By first modifying the generated script to create a wrapper function of the same name, you can make the switch to a new capture instance without affecting higher application layers.</span></span>  
  
## <a name="see-also"></a><span data-ttu-id="9b3e8-231">Voir aussi</span><span class="sxs-lookup"><span data-stu-id="9b3e8-231">See Also</span></span>  
 <span data-ttu-id="9b3e8-232">[Suivi des modifications de données &#40;SQL Server&#41;](../track-changes/track-data-changes-sql-server.md) </span><span class="sxs-lookup"><span data-stu-id="9b3e8-232">[Track Data Changes &#40;SQL Server&#41;](../track-changes/track-data-changes-sql-server.md) </span></span>  
 <span data-ttu-id="9b3e8-233">[À propos de la capture de données modifiées &#40;SQL Server&#41;](../track-changes/about-change-data-capture-sql-server.md) </span><span class="sxs-lookup"><span data-stu-id="9b3e8-233">[About Change Data Capture &#40;SQL Server&#41;](../track-changes/about-change-data-capture-sql-server.md) </span></span>  
 <span data-ttu-id="9b3e8-234">[Activer et désactiver la capture de données modifiées &#40;SQL Server&#41;](../track-changes/enable-and-disable-change-data-capture-sql-server.md) </span><span class="sxs-lookup"><span data-stu-id="9b3e8-234">[Enable and Disable Change Data Capture &#40;SQL Server&#41;](../track-changes/enable-and-disable-change-data-capture-sql-server.md) </span></span>  
 [<span data-ttu-id="9b3e8-235">Administrer et surveiller la capture de données modifiées &#40;SQL Server&#41;</span><span class="sxs-lookup"><span data-stu-id="9b3e8-235">Administer and Monitor Change Data Capture &#40;SQL Server&#41;</span></span>](../track-changes/administer-and-monitor-change-data-capture-sql-server.md)  
  
  
