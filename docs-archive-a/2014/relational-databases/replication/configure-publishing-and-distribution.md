---
title: Configurer la publication et la distribution | Microsoft Docs
ms.custom: ''
ms.date: 06/30/2017
ms.prod: sql-server-2014
ms.reviewer: ''
ms.technology: replication
ms.topic: conceptual
helpviewer_keywords:
- replication [SQL Server], distribution
- distribution configuration [SQL Server replication]
- publishing [SQL Server replication], configuring
ms.assetid: 3cfc8966-833e-42fa-80cb-09175d1feed7
author: MashaMSFT
ms.author: mathoma
ms.openlocfilehash: afd1544b5412c6ce2d83a9a1e9a50ddf662b3056
ms.sourcegitcommit: ad4d92dce894592a259721a1571b1d8736abacdb
ms.translationtype: MT
ms.contentlocale: fr-FR
ms.lasthandoff: 08/04/2020
ms.locfileid: "87600837"
---
# <a name="configure-publishing-and-distribution"></a><span data-ttu-id="5f5fe-102">Configurer la publication et la distribution</span><span class="sxs-lookup"><span data-stu-id="5f5fe-102">Configure Publishing and Distribution</span></span>
  <span data-ttu-id="5f5fe-103">Cette rubrique explique comment configurer la publication et la distribution dans [!INCLUDE[ssCurrent](../../includes/sscurrent-md.md)] à l'aide de [!INCLUDE[ssManStudioFull](../../includes/ssmanstudiofull-md.md)], [!INCLUDE[tsql](../../includes/tsql-md.md)]ou d'objets RMO (Replication Management Objects).</span><span class="sxs-lookup"><span data-stu-id="5f5fe-103">This topic describes how to configure publishing and distribution in [!INCLUDE[ssCurrent](../../includes/sscurrent-md.md)] by using [!INCLUDE[ssManStudioFull](../../includes/ssmanstudiofull-md.md)], [!INCLUDE[tsql](../../includes/tsql-md.md)], or Replication Management Objects (RMO).</span></span>  
  
  
##  <a name="before-you-begin"></a><a name="BeforeYouBegin"></a> <span data-ttu-id="5f5fe-104">Avant de commencer</span><span class="sxs-lookup"><span data-stu-id="5f5fe-104">Before You Begin</span></span>  
  
###  <a name="security"></a><a name="Security"></a> <span data-ttu-id="5f5fe-105">Sécurité</span><span class="sxs-lookup"><span data-stu-id="5f5fe-105">Security</span></span>  
 <span data-ttu-id="5f5fe-106">Pour plus d’informations, consultez [sécuriser le déploiement de la réplication](security/view-and-modify-replication-security-settings.md).</span><span class="sxs-lookup"><span data-stu-id="5f5fe-106">For more information, see [Secure Replication Deployment](security/view-and-modify-replication-security-settings.md).</span></span>  
  
##  <a name="using-sql-server-management-studio"></a><a name="SSMSProcedure"></a> <span data-ttu-id="5f5fe-107">Utilisation de SQL Server Management Studio</span><span class="sxs-lookup"><span data-stu-id="5f5fe-107">Using SQL Server Management Studio</span></span>  
 <span data-ttu-id="5f5fe-108">Configurez la distribution à l'aide de l'Assistant Nouvelle publication ou de l'Assistant Configuration de la distribution.</span><span class="sxs-lookup"><span data-stu-id="5f5fe-108">Configure distribution using the New Publication Wizard or the Configure Distribution Wizard.</span></span> <span data-ttu-id="5f5fe-109">Après avoir configuré le serveur de distribution, affichez et modifiez des propriétés dans la boîte de dialogue **Propriétés du serveur de distribution - \<Distributor>** .</span><span class="sxs-lookup"><span data-stu-id="5f5fe-109">After the Distributor is configured, view and modify properties in the **Distributor Properties - \<Distributor>** dialog box.</span></span> <span data-ttu-id="5f5fe-110">Utilisez l'Assistant Configuration de la distribution si vous voulez configurer un serveur de distribution de telle sorte que les membres des rôles de base de données fixes **db_owner** puissent créer des publications, ou parce que vous voulez configurer un serveur distant de distribution qui ne soit pas serveur de publication.</span><span class="sxs-lookup"><span data-stu-id="5f5fe-110">Use the Configure Distribution Wizard if you want to configure a Distributor so that members of the **db_owner** fixed database roles can create publications, or because you want to configure a remote Distributor that is not a Publisher.</span></span>  
  
#### <a name="to-configure-distribution"></a><span data-ttu-id="5f5fe-111">Pour configurer la distribution</span><span class="sxs-lookup"><span data-stu-id="5f5fe-111">To configure distribution</span></span>  
  
1.  <span data-ttu-id="5f5fe-112">Dans [!INCLUDE[msCoName](../../includes/msconame-md.md)] [!INCLUDE[ssManStudioFull](../../includes/ssmanstudiofull-md.md)], connectez-vous au serveur qui servira de serveur de distribution (souvent, le serveur de publication et le serveur de distribution sont les mêmes), puis développez le nœud du serveur.</span><span class="sxs-lookup"><span data-stu-id="5f5fe-112">In [!INCLUDE[msCoName](../../includes/msconame-md.md)] [!INCLUDE[ssManStudioFull](../../includes/ssmanstudiofull-md.md)], connect to the server that will be the Distributor (in many cases, the Publisher and Distributor are the same server), and then expand the server node.</span></span>  
  
2.  <span data-ttu-id="5f5fe-113">Cliquez avec le bouton droit sur le dossier **Réplication** , puis cliquez sur **Configurer la distribution**.</span><span class="sxs-lookup"><span data-stu-id="5f5fe-113">Right-click the **Replication** folder, and then click **Configure Distribution**.</span></span>  
  
3.  <span data-ttu-id="5f5fe-114">Suivez les instructions de l'Assistant Configuration de la distribution pour :</span><span class="sxs-lookup"><span data-stu-id="5f5fe-114">Follow the Configure Distribution Wizard to:</span></span>  
  
    -   <span data-ttu-id="5f5fe-115">Sélectionner un serveur de distribution.</span><span class="sxs-lookup"><span data-stu-id="5f5fe-115">Select a Distributor.</span></span> <span data-ttu-id="5f5fe-116">Pour utiliser un serveur de distribution local, sélectionnez **« \<ServerName> » agit comme son propre serveur de distribution ; SQL Server créera une base de données de distribution et un journal**.</span><span class="sxs-lookup"><span data-stu-id="5f5fe-116">To use a local Distributor, select **'\<ServerName>' will act as its own Distributor; SQL Server will create a distribution database and log**.</span></span> <span data-ttu-id="5f5fe-117">Pour utiliser un serveur de distribution distant, sélectionnez l'option **Utiliser le serveur suivant comme serveur de distribution**, puis sélectionnez un serveur.</span><span class="sxs-lookup"><span data-stu-id="5f5fe-117">To use a remote Distributor, select **Use the following server as the Distributor**, and then select a server.</span></span> <span data-ttu-id="5f5fe-118">Ce dernier doit déjà être configuré comme un serveur de distribution et le serveur de publication configuré pour utiliser ce serveur de distribution.</span><span class="sxs-lookup"><span data-stu-id="5f5fe-118">The server must already be configured as a Distributor, and the Publisher must be enabled to use the Distributor.</span></span> <span data-ttu-id="5f5fe-119">Pour plus d’informations, consultez [Activer un serveur de publication distant sur un serveur de distribution &#40;SQL Server Management Studio&#41;](enable-a-remote-publisher-at-a-distributor-sql-server-management-studio.md).</span><span class="sxs-lookup"><span data-stu-id="5f5fe-119">For more information, see [Enable a Remote Publisher at a Distributor &#40;SQL Server Management Studio&#41;](enable-a-remote-publisher-at-a-distributor-sql-server-management-studio.md).</span></span>  
  
         <span data-ttu-id="5f5fe-120">Si vous sélectionnez un serveur de distribution distant, vous devez entrer un mot de passe dans la page **Mot de passe d'administration** pour les connexions effectuées à partir du serveur de publication sur le serveur de distribution.</span><span class="sxs-lookup"><span data-stu-id="5f5fe-120">If you select a remote Distributor, you must enter a password on the **Administrative Password** page for connections made from the Publisher to the Distributor.</span></span> <span data-ttu-id="5f5fe-121">Ce mot de passe doit correspondre à celui qui a été spécifié lorsque le serveur de publication a été activé sur le serveur de distribution distant.</span><span class="sxs-lookup"><span data-stu-id="5f5fe-121">This password must match the password specified when the Publisher was enabled at the remote Distributor.</span></span>  
  
    -   <span data-ttu-id="5f5fe-122">Spécifier un dossier d'instantanés racine (pour un serveur de distribution local).</span><span class="sxs-lookup"><span data-stu-id="5f5fe-122">Specify a root snapshot folder (for a local Distributor).</span></span> <span data-ttu-id="5f5fe-123">Le dossier d'instantanés correspond à un simple répertoire que vous définissez sous la forme d'un partage ; les agents qui lisent et écrivent dans le dossier doivent disposer des autorisations suffisantes pour pouvoir y accéder.</span><span class="sxs-lookup"><span data-stu-id="5f5fe-123">The snapshot folder is simply a directory that you have designated as a share; agents that read from and write to this folder must have sufficient permissions to access it.</span></span> <span data-ttu-id="5f5fe-124">Chaque serveur de publication qui utilise ce serveur de distribution crée un dossier sous le dossier racine, et chaque publication crée des dossiers sous le dossier Serveur de publication, pour y stocker les fichiers d'instantanés.</span><span class="sxs-lookup"><span data-stu-id="5f5fe-124">Each Publisher that uses this Distributor creates a folder under the root folder, and each publication creates folders under the Publisher folder in which to store snapshot files.</span></span> <span data-ttu-id="5f5fe-125">Pour plus d’informations sur une sécurisation appropriée du dossier, consultez [Sécuriser le dossier d’instantané](security/secure-the-snapshot-folder.md).</span><span class="sxs-lookup"><span data-stu-id="5f5fe-125">For more information on securing the folder appropriately, see [Secure the Snapshot Folder](security/secure-the-snapshot-folder.md).</span></span>  
  
    -   <span data-ttu-id="5f5fe-126">Spécifier la base de données de distribution (pour un serveur de distribution local).</span><span class="sxs-lookup"><span data-stu-id="5f5fe-126">Specify the distribution database (for a local Distributor).</span></span> <span data-ttu-id="5f5fe-127">La base de données de distribution stocke les métadonnées et les données d'historique pour tous les types de réplications, et les transactions pour la réplication transactionnelle.</span><span class="sxs-lookup"><span data-stu-id="5f5fe-127">The distribution database stores metadata and history data for all types of replication and transactions for transactional replication.</span></span>  
  
    -   <span data-ttu-id="5f5fe-128">Permettre en option aux autres serveurs de publication d'utiliser le serveur de distribution.</span><span class="sxs-lookup"><span data-stu-id="5f5fe-128">Optionally enable other Publishers to use the Distributor.</span></span> <span data-ttu-id="5f5fe-129">Si d'autres serveurs de publication sont activés pour utiliser le serveur de distribution, vous devez entrer un mot de passe dans la page **Mot de passe du serveur de distribution** pour les connexions effectuées à partir de ces serveurs de publication sur le serveur de distribution.</span><span class="sxs-lookup"><span data-stu-id="5f5fe-129">If other Publishers are enabled to use the Distributor, you must enter a password on the **Distributor Password** page for connections made from these Publishers to the Distributor.</span></span>  
  
    -   <span data-ttu-id="5f5fe-130">Scripter en option les paramètres de configuration.</span><span class="sxs-lookup"><span data-stu-id="5f5fe-130">Optionally script configuration settings.</span></span> <span data-ttu-id="5f5fe-131">Pour plus d'informations, voir [Scripting Replication](scripting-replication.md).</span><span class="sxs-lookup"><span data-stu-id="5f5fe-131">For more information, see [Scripting Replication](scripting-replication.md).</span></span>  
  
##  <a name="using-transact-sql"></a><a name="TsqlProcedure"></a> <span data-ttu-id="5f5fe-132">Utilisation de Transact-SQL</span><span class="sxs-lookup"><span data-stu-id="5f5fe-132">Using Transact-SQL</span></span>  
 <span data-ttu-id="5f5fe-133">La publication et la distribution de réplication peuvent être configurées par programme à l'aide de procédures stockées de réplication.</span><span class="sxs-lookup"><span data-stu-id="5f5fe-133">Replication publishing and distribution can be configured programmatically using replication stored procedures.</span></span>  
  
#### <a name="to-configure-publishing-using-a-local-distributor"></a><span data-ttu-id="5f5fe-134">Pour configurer la publication à l'aide d'un serveur de distribution local</span><span class="sxs-lookup"><span data-stu-id="5f5fe-134">To configure publishing using a local distributor</span></span>  
  
1.  <span data-ttu-id="5f5fe-135">Exécutez [sp_get_distributor &#40;Transact-SQL&#41;](/sql/relational-databases/system-stored-procedures/sp-get-distributor-transact-sql) pour déterminer si le serveur est déjà configuré comme serveur de distribution.</span><span class="sxs-lookup"><span data-stu-id="5f5fe-135">Execute [sp_get_distributor &#40;Transact-SQL&#41;](/sql/relational-databases/system-stored-procedures/sp-get-distributor-transact-sql) to determine if the server is already configured as a Distributor.</span></span>  
  
    -   <span data-ttu-id="5f5fe-136">Dans le jeu de résultats, si **installed** a la valeur **0**, exécutez [sp_adddistributor &#40;Transact-SQL&#41;](/sql/relational-databases/system-stored-procedures/sp-adddistributor-transact-sql) sur le serveur de distribution, sur la base de données MASTER.</span><span class="sxs-lookup"><span data-stu-id="5f5fe-136">If the value of **installed** in the result set is **0**, execute [sp_adddistributor &#40;Transact-SQL&#41;](/sql/relational-databases/system-stored-procedures/sp-adddistributor-transact-sql) at the Distributor on the master database.</span></span>  
  
    -   <span data-ttu-id="5f5fe-137">Dans le jeu de résultats, si **distribution db installed** a la valeur **0**, exécutez [sp_adddistributiondb &#40;Transact-SQL&#41;](/sql/relational-databases/system-stored-procedures/sp-adddistributiondb-transact-sql) sur le serveur de distribution, sur la base de données MASTER.</span><span class="sxs-lookup"><span data-stu-id="5f5fe-137">If the value of **distribution db installed** in the result set is **0**, execute [sp_adddistributiondb &#40;Transact-SQL&#41;](/sql/relational-databases/system-stored-procedures/sp-adddistributiondb-transact-sql) at the Distributor on the master database.</span></span> <span data-ttu-id="5f5fe-138">Spécifiez le nom de la base de données de distribution pour la \*\* \@ base de données\*\*.</span><span class="sxs-lookup"><span data-stu-id="5f5fe-138">Specify the name of the distribution database for **\@database**.</span></span> <span data-ttu-id="5f5fe-139">Si vous le souhaitez, vous pouvez spécifier la période maximale de rétention transactionnelle pour \*\* \@ max_distretention\*\* et la période de rétention de l’historique pour \*\* \@ history_retention\*\*.</span><span class="sxs-lookup"><span data-stu-id="5f5fe-139">Optionally, you can specify the maximum transactional retention period for **\@max_distretention** and the history retention period for **\@history_retention**.</span></span> <span data-ttu-id="5f5fe-140">Si une nouvelle base de données est créée, spécifiez les paramètres de propriété de base de données de votre choix.</span><span class="sxs-lookup"><span data-stu-id="5f5fe-140">If a new database is being created, specify the desired database property parameters.</span></span>  
  
2.  <span data-ttu-id="5f5fe-141">Sur le serveur de distribution, qui est également le serveur de publication, exécutez [sp_adddistpublisher &#40;Transact-SQL&#41;](/sql/relational-databases/system-stored-procedures/sp-adddistpublisher-transact-sql), en spécifiant le partage UNC qui sera utilisé comme dossier d’instantanés par défaut pour \*\* \@ working_directory\*\*.</span><span class="sxs-lookup"><span data-stu-id="5f5fe-141">At the Distributor, which is also the Publisher, execute [sp_adddistpublisher &#40;Transact-SQL&#41;](/sql/relational-databases/system-stored-procedures/sp-adddistpublisher-transact-sql), specifying the UNC share that will be used as default snapshot folder for **\@working_directory**.</span></span>  
  
3.  <span data-ttu-id="5f5fe-142">Sur le serveur de publication, exécutez [sp_replicationdboption &#40;Transact-SQL&#41;](/sql/relational-databases/system-stored-procedures/sp-replicationdboption-transact-sql).</span><span class="sxs-lookup"><span data-stu-id="5f5fe-142">At the Publisher, execute [sp_replicationdboption &#40;Transact-SQL&#41;](/sql/relational-databases/system-stored-procedures/sp-replicationdboption-transact-sql).</span></span> <span data-ttu-id="5f5fe-143">Spécifiez la base de données publiée pour \*\* \@ dbname**, le type de réplication pour \*\* \@ nom_d**'objet et la valeur `true` pour \*\* \@ value\*\*.</span><span class="sxs-lookup"><span data-stu-id="5f5fe-143">Specify the database being published for **\@dbname**, the type of replication for **\@optname**, and a value of `true` for **\@value**.</span></span>  
  
#### <a name="to-configure-publishing-using-a-remote-distributor"></a><span data-ttu-id="5f5fe-144">Pour configurer la publication à l'aide d'un serveur de distribution distant</span><span class="sxs-lookup"><span data-stu-id="5f5fe-144">To configure publishing using a remote distributor</span></span>  
  
1.  <span data-ttu-id="5f5fe-145">Exécutez [sp_get_distributor &#40;Transact-SQL&#41;](/sql/relational-databases/system-stored-procedures/sp-get-distributor-transact-sql) pour déterminer si le serveur est déjà configuré comme serveur de distribution.</span><span class="sxs-lookup"><span data-stu-id="5f5fe-145">Execute [sp_get_distributor &#40;Transact-SQL&#41;](/sql/relational-databases/system-stored-procedures/sp-get-distributor-transact-sql) to determine if the server is already configured as a Distributor.</span></span>  
  
    -   <span data-ttu-id="5f5fe-146">Dans le jeu de résultats, si **installed** a la valeur **0**, exécutez [sp_adddistributor &#40;Transact-SQL&#41;](/sql/relational-databases/system-stored-procedures/sp-adddistributor-transact-sql) sur le serveur de distribution, sur la base de données MASTER.</span><span class="sxs-lookup"><span data-stu-id="5f5fe-146">If the value of **installed** in the result set is **0**, execute [sp_adddistributor &#40;Transact-SQL&#41;](/sql/relational-databases/system-stored-procedures/sp-adddistributor-transact-sql) at the Distributor on the master database.</span></span> <span data-ttu-id="5f5fe-147">Spécifiez un mot de passe fort pour le \*\* \@ mot de passe\*\*.</span><span class="sxs-lookup"><span data-stu-id="5f5fe-147">Specify a strong password for **\@password**.</span></span> <span data-ttu-id="5f5fe-148">Ce mot de passe du compte **distributor_admin** sera utilisé par le serveur de publication lors de la connexion au serveur de distribution.</span><span class="sxs-lookup"><span data-stu-id="5f5fe-148">This password for the **distributor_admin** account will be used by the Publisher when connecting to the Distributor.</span></span>  
  
    -   <span data-ttu-id="5f5fe-149">Dans le jeu de résultats, si **distribution db installed** a la valeur **0**, exécutez [sp_adddistributiondb &#40;Transact-SQL&#41;](/sql/relational-databases/system-stored-procedures/sp-adddistributiondb-transact-sql) sur le serveur de distribution, sur la base de données MASTER.</span><span class="sxs-lookup"><span data-stu-id="5f5fe-149">If the value of **distribution db installed** in the result set is **0**, execute [sp_adddistributiondb &#40;Transact-SQL&#41;](/sql/relational-databases/system-stored-procedures/sp-adddistributiondb-transact-sql) at the Distributor on the master database.</span></span> <span data-ttu-id="5f5fe-150">Spécifiez le nom de la base de données de distribution pour la \*\* \@ base de données\*\*.</span><span class="sxs-lookup"><span data-stu-id="5f5fe-150">Specify the name of the distribution database for **\@database**.</span></span> <span data-ttu-id="5f5fe-151">Si vous le souhaitez, vous pouvez spécifier la période maximale de rétention transactionnelle pour \*\* \@ max_distretention\*\* et la période de rétention de l’historique pour \*\* \@ history_retention\*\*.</span><span class="sxs-lookup"><span data-stu-id="5f5fe-151">Optionally, you can specify the maximum transactional retention period for **\@max_distretention** and the history retention period for **\@history_retention**.</span></span> <span data-ttu-id="5f5fe-152">Si une nouvelle base de données est créée, spécifiez les paramètres de propriété de base de données de votre choix.</span><span class="sxs-lookup"><span data-stu-id="5f5fe-152">If a new database is being created, specify the desired database property parameters.</span></span>  
  
2.  <span data-ttu-id="5f5fe-153">Sur le serveur de distribution, exécutez [sp_adddistpublisher &#40;Transact-SQL&#41;](/sql/relational-databases/system-stored-procedures/sp-adddistpublisher-transact-sql), en spécifiant le partage UNC qui sera utilisé comme dossier d’instantanés par défaut pour \*\* \@ working_directory\*\*.</span><span class="sxs-lookup"><span data-stu-id="5f5fe-153">At the Distributor, execute [sp_adddistpublisher &#40;Transact-SQL&#41;](/sql/relational-databases/system-stored-procedures/sp-adddistpublisher-transact-sql), specifying the UNC share that will be used as default snapshot folder for **\@working_directory**.</span></span> <span data-ttu-id="5f5fe-154">Si le serveur de distribution doit utiliser l' [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] authentification lors de la connexion au serveur de publication, vous devez également spécifier la valeur **0** pour \*\* \@ security_mode\*\* et les [!INCLUDE[msCoName](../../includes/msconame-md.md)] [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] informations de connexion pour la \*\* \@ connexion\*\* et le \*\* \@ mot de passe\*\*.</span><span class="sxs-lookup"><span data-stu-id="5f5fe-154">If the Distributor will use [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] Authentication when connecting to the Publisher, you must also specify a value of **0** for **\@security_mode** and the [!INCLUDE[msCoName](../../includes/msconame-md.md)] [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] login information for **\@login** and **\@password**.</span></span>  
  
3.  <span data-ttu-id="5f5fe-155">Sur le serveur de publication, sur la base de données MASTER, exécutez [sp_adddistributor &#40;Transact-SQL&#41;](/sql/relational-databases/system-stored-procedures/sp-adddistributor-transact-sql).</span><span class="sxs-lookup"><span data-stu-id="5f5fe-155">At the Publisher on the master database, execute [sp_adddistributor &#40;Transact-SQL&#41;](/sql/relational-databases/system-stored-procedures/sp-adddistributor-transact-sql).</span></span> <span data-ttu-id="5f5fe-156">Spécifiez le mot de passe fort utilisé à l’étape 1 pour le \*\* \@ mot de passe\*\*.</span><span class="sxs-lookup"><span data-stu-id="5f5fe-156">Specify the strong password used in step 1 for **\@password**.</span></span> <span data-ttu-id="5f5fe-157">Ce mot de passe sera utilisé par le serveur de publication lors de la connexion au serveur de distribution.</span><span class="sxs-lookup"><span data-stu-id="5f5fe-157">This password will be used by the Publisher when connecting to the Distributor.</span></span>  
  
4.  <span data-ttu-id="5f5fe-158">Sur le serveur de publication, exécutez [sp_replicationdboption &#40;Transact-SQL&#41;](/sql/relational-databases/system-stored-procedures/sp-replicationdboption-transact-sql).</span><span class="sxs-lookup"><span data-stu-id="5f5fe-158">At the Publisher, execute [sp_replicationdboption &#40;Transact-SQL&#41;](/sql/relational-databases/system-stored-procedures/sp-replicationdboption-transact-sql).</span></span> <span data-ttu-id="5f5fe-159">Spécifiez la base de données publiée pour \*\* \@ dbname**, le type de réplication pour \*\* \@ nom_d**'objet et la valeur true pour \*\* \@ value\*\*.</span><span class="sxs-lookup"><span data-stu-id="5f5fe-159">Specify the database being published for **\@dbname**, the type of replication for **\@optname**, and a value of true for **\@value**.</span></span>  
  
###  <a name="example-transact-sql"></a><a name="TsqlExample"></a> <span data-ttu-id="5f5fe-160">Exemple (Transact-SQL)</span><span class="sxs-lookup"><span data-stu-id="5f5fe-160">Example (Transact-SQL)</span></span>  
 <span data-ttu-id="5f5fe-161">L'exemple ci-dessous montre comment configurer par programme la publication et la distribution.</span><span class="sxs-lookup"><span data-stu-id="5f5fe-161">The following example demonstrates how to configure publishing and distribution programmatically.</span></span> <span data-ttu-id="5f5fe-162">Dans cet exemple, le nom du serveur configuré comme serveur de publication et serveur de distribution local est fourni au moyen de variables de script.</span><span class="sxs-lookup"><span data-stu-id="5f5fe-162">In this example, the name of the server that is being configured as a publisher and a local distributor is supplied using scripting variables.</span></span> <span data-ttu-id="5f5fe-163">La publication et la distribution de réplication peuvent être configurées par programme à l'aide de procédures stockées de réplication.</span><span class="sxs-lookup"><span data-stu-id="5f5fe-163">Replication publishing and distribution can be configured programmatically using replication stored procedures.</span></span>  
  
 [!code-sql[HowTo#AddDistPub](../../snippets/tsql/SQL15/replication/howto/tsql/adddistpub.sql#adddistpub)]  
  
##  <a name="using-replication-management-objects-rmo"></a><a name="RMOProcedure"></a> <span data-ttu-id="5f5fe-164">Utilisation d'objets RMO (Replication Management Objects)</span><span class="sxs-lookup"><span data-stu-id="5f5fe-164">Using Replication Management Objects (RMO)</span></span>  
  
#### <a name="to-configure-publishing-and-distribution-on-a-single-server"></a><span data-ttu-id="5f5fe-165">Pour configurer la publication et la distribution sur un serveur unique</span><span class="sxs-lookup"><span data-stu-id="5f5fe-165">To configure publishing and distribution on a single server</span></span>  
  
1.  <span data-ttu-id="5f5fe-166">Créez une connexion au serveur en utilisant la classe <xref:Microsoft.SqlServer.Management.Common.ServerConnection> .</span><span class="sxs-lookup"><span data-stu-id="5f5fe-166">Create a connection to the server by using the <xref:Microsoft.SqlServer.Management.Common.ServerConnection> class.</span></span>  
  
2.  <span data-ttu-id="5f5fe-167">Créez une instance de la classe <xref:Microsoft.SqlServer.Replication.ReplicationServer>.</span><span class="sxs-lookup"><span data-stu-id="5f5fe-167">Create an instance of the <xref:Microsoft.SqlServer.Replication.ReplicationServer> class.</span></span> <span data-ttu-id="5f5fe-168">Passez l'objet <xref:Microsoft.SqlServer.Management.Common.ServerConnection> créé à l'étape 1.</span><span class="sxs-lookup"><span data-stu-id="5f5fe-168">Pass the <xref:Microsoft.SqlServer.Management.Common.ServerConnection> from step 1.</span></span>  
  
3.  <span data-ttu-id="5f5fe-169">Créez une instance de la classe <xref:Microsoft.SqlServer.Replication.DistributionDatabase>.</span><span class="sxs-lookup"><span data-stu-id="5f5fe-169">Create an instance of the <xref:Microsoft.SqlServer.Replication.DistributionDatabase> class.</span></span>  
  
4.  <span data-ttu-id="5f5fe-170">Affectez le nom de la base de données à la propriété <xref:Microsoft.SqlServer.Replication.DistributionDatabase.Name%2A> et le <xref:Microsoft.SqlServer.Replication.ReplicationObject.ConnectionContext%2A> créé à l'étape 1 à la propriété <xref:Microsoft.SqlServer.Management.Common.ServerConnection> .</span><span class="sxs-lookup"><span data-stu-id="5f5fe-170">Set the <xref:Microsoft.SqlServer.Replication.DistributionDatabase.Name%2A> property to the database name and set the <xref:Microsoft.SqlServer.Replication.ReplicationObject.ConnectionContext%2A> property to the <xref:Microsoft.SqlServer.Management.Common.ServerConnection> from step 1.</span></span>  
  
5.  <span data-ttu-id="5f5fe-171">Installez le serveur de distribution en appelant la méthode <xref:Microsoft.SqlServer.Replication.ReplicationServer.InstallDistributor%2A> .</span><span class="sxs-lookup"><span data-stu-id="5f5fe-171">Install the Distributor by calling the <xref:Microsoft.SqlServer.Replication.ReplicationServer.InstallDistributor%2A> method.</span></span> <span data-ttu-id="5f5fe-172">Passez l'objet <xref:Microsoft.SqlServer.Replication.DistributionDatabase> créé à l'étape 3.</span><span class="sxs-lookup"><span data-stu-id="5f5fe-172">Pass the <xref:Microsoft.SqlServer.Replication.DistributionDatabase> object from step 3.</span></span>  
  
6.  <span data-ttu-id="5f5fe-173">Créez une instance de la classe <xref:Microsoft.SqlServer.Replication.DistributionPublisher>.</span><span class="sxs-lookup"><span data-stu-id="5f5fe-173">Create an instance of the <xref:Microsoft.SqlServer.Replication.DistributionPublisher> class.</span></span>  
  
7.  <span data-ttu-id="5f5fe-174">Définissez les propriétés suivantes de <xref:Microsoft.SqlServer.Replication.DistributionPublisher>:</span><span class="sxs-lookup"><span data-stu-id="5f5fe-174">Set the following properties of <xref:Microsoft.SqlServer.Replication.DistributionPublisher>:</span></span>  
  
    -   <span data-ttu-id="5f5fe-175"><xref:Microsoft.SqlServer.Replication.DistributionPublisher.Name%2A> - nom du serveur de publication.</span><span class="sxs-lookup"><span data-stu-id="5f5fe-175"><xref:Microsoft.SqlServer.Replication.DistributionPublisher.Name%2A> - name of the Publisher.</span></span>  
  
    -   <span data-ttu-id="5f5fe-176"><xref:Microsoft.SqlServer.Replication.ReplicationObject.ConnectionContext%2A> - <xref:Microsoft.SqlServer.Management.Common.ServerConnection> créé à l'étape 1.</span><span class="sxs-lookup"><span data-stu-id="5f5fe-176"><xref:Microsoft.SqlServer.Replication.ReplicationObject.ConnectionContext%2A> - the <xref:Microsoft.SqlServer.Management.Common.ServerConnection> from step 1.</span></span>  
  
    -   <span data-ttu-id="5f5fe-177"><xref:Microsoft.SqlServer.Replication.DistributionPublisher.DistributionDatabase%2A> - nom de la base de données créée à l'étape 5.</span><span class="sxs-lookup"><span data-stu-id="5f5fe-177"><xref:Microsoft.SqlServer.Replication.DistributionPublisher.DistributionDatabase%2A> - the name of the database created in step 5.</span></span>  
  
    -   <span data-ttu-id="5f5fe-178"><xref:Microsoft.SqlServer.Replication.DistributionPublisher.WorkingDirectory%2A> - partage utilisé pour accéder aux fichiers d'instantanés.</span><span class="sxs-lookup"><span data-stu-id="5f5fe-178"><xref:Microsoft.SqlServer.Replication.DistributionPublisher.WorkingDirectory%2A> - the share used to access snapshot files.</span></span>  
  
    -   <span data-ttu-id="5f5fe-179"><xref:Microsoft.SqlServer.Replication.DistributionPublisher.PublisherSecurity%2A> - Mode de sécurité utilisé lors de la connexion au serveur de publication.</span><span class="sxs-lookup"><span data-stu-id="5f5fe-179"><xref:Microsoft.SqlServer.Replication.DistributionPublisher.PublisherSecurity%2A> - the security mode used when connecting to the Publisher.</span></span> <span data-ttu-id="5f5fe-180"><xref:Microsoft.SqlServer.Replication.ConnectionSecurityContext.WindowsAuthentication%2A> est recommandé.</span><span class="sxs-lookup"><span data-stu-id="5f5fe-180"><xref:Microsoft.SqlServer.Replication.ConnectionSecurityContext.WindowsAuthentication%2A> is recommended.</span></span>  
  
8.  <span data-ttu-id="5f5fe-181">Appelez la méthode <xref:Microsoft.SqlServer.Replication.DistributionPublisher.Create%2A> .</span><span class="sxs-lookup"><span data-stu-id="5f5fe-181">Call the <xref:Microsoft.SqlServer.Replication.DistributionPublisher.Create%2A> method.</span></span>  
  
#### <a name="to-configure-publishing-and-distribution-using-a-remote-distributor"></a><span data-ttu-id="5f5fe-182">Pour configurer la publication et la distribution à l'aide d'un serveur de distribution distant</span><span class="sxs-lookup"><span data-stu-id="5f5fe-182">To configure publishing and distribution using a remote Distributor</span></span>  
  
1.  <span data-ttu-id="5f5fe-183">Créez une connexion au serveur de distribution distant en utilisant la classe <xref:Microsoft.SqlServer.Management.Common.ServerConnection> .</span><span class="sxs-lookup"><span data-stu-id="5f5fe-183">Create a connection to the remote Distributor server by using the <xref:Microsoft.SqlServer.Management.Common.ServerConnection> class.</span></span>  
  
2.  <span data-ttu-id="5f5fe-184">Créez une instance de la classe <xref:Microsoft.SqlServer.Replication.ReplicationServer>.</span><span class="sxs-lookup"><span data-stu-id="5f5fe-184">Create an instance of the <xref:Microsoft.SqlServer.Replication.ReplicationServer> class.</span></span> <span data-ttu-id="5f5fe-185">Passez l'objet <xref:Microsoft.SqlServer.Management.Common.ServerConnection> créé à l'étape 1.</span><span class="sxs-lookup"><span data-stu-id="5f5fe-185">Pass the <xref:Microsoft.SqlServer.Management.Common.ServerConnection> from step 1.</span></span>  
  
3.  <span data-ttu-id="5f5fe-186">Créez une instance de la classe <xref:Microsoft.SqlServer.Replication.DistributionDatabase>.</span><span class="sxs-lookup"><span data-stu-id="5f5fe-186">Create an instance of the <xref:Microsoft.SqlServer.Replication.DistributionDatabase> class.</span></span>  
  
4.  <span data-ttu-id="5f5fe-187">Affectez le nom de la base de données à la propriété <xref:Microsoft.SqlServer.Replication.DistributionDatabase.Name%2A> et le <xref:Microsoft.SqlServer.Replication.ReplicationObject.ConnectionContext%2A> créé à l'étape 1 à la propriété <xref:Microsoft.SqlServer.Management.Common.ServerConnection> .</span><span class="sxs-lookup"><span data-stu-id="5f5fe-187">Set the <xref:Microsoft.SqlServer.Replication.DistributionDatabase.Name%2A> property to the database name, and set the <xref:Microsoft.SqlServer.Replication.ReplicationObject.ConnectionContext%2A> property to the <xref:Microsoft.SqlServer.Management.Common.ServerConnection> from step 1.</span></span>  
  
5.  <span data-ttu-id="5f5fe-188">Installez le serveur de distribution en appelant la méthode <xref:Microsoft.SqlServer.Replication.ReplicationServer.InstallDistributor%2A> .</span><span class="sxs-lookup"><span data-stu-id="5f5fe-188">Install the Distributor by calling the <xref:Microsoft.SqlServer.Replication.ReplicationServer.InstallDistributor%2A> method.</span></span> <span data-ttu-id="5f5fe-189">Spécifiez un mot de passe sécurisé (utilisé par le serveur de publication lors de la connexion au serveur de distribution distant) et l'objet <xref:Microsoft.SqlServer.Replication.DistributionDatabase> créé à l'étape 3.</span><span class="sxs-lookup"><span data-stu-id="5f5fe-189">Specify a secure password (used by the Publisher when connecting to the remote Distributor) and the <xref:Microsoft.SqlServer.Replication.DistributionDatabase> object from step 3.</span></span> <span data-ttu-id="5f5fe-190">Pour plus d’informations, consultez [Protéger le serveur de distribution](security/secure-the-distributor.md).</span><span class="sxs-lookup"><span data-stu-id="5f5fe-190">For more information, see [Secure the Distributor](security/secure-the-distributor.md).</span></span>  
  
    > [!IMPORTANT]  
    >  <span data-ttu-id="5f5fe-191">Lorsque c'est possible, demande aux utilisateurs de fournir les informations d'identification au moment de l'exécution.</span><span class="sxs-lookup"><span data-stu-id="5f5fe-191">When possible, prompt users to enter security credentials at runtime.</span></span> <span data-ttu-id="5f5fe-192">Si vous devez stocker des informations d'identification, utilisez les [Services de chiffrement](https://go.microsoft.com/fwlink/?LinkId=34733) fournis par [!INCLUDE[msCoName](../../includes/msconame-md.md)] Windows .NET Framework.</span><span class="sxs-lookup"><span data-stu-id="5f5fe-192">If you must store credentials, use the [cryptographic services](https://go.microsoft.com/fwlink/?LinkId=34733) provided by the [!INCLUDE[msCoName](../../includes/msconame-md.md)] Windows .NET Framework.</span></span>  
  
6.  <span data-ttu-id="5f5fe-193">Créez une instance de la classe <xref:Microsoft.SqlServer.Replication.DistributionPublisher>.</span><span class="sxs-lookup"><span data-stu-id="5f5fe-193">Create an instance of the <xref:Microsoft.SqlServer.Replication.DistributionPublisher> class.</span></span>  
  
7.  <span data-ttu-id="5f5fe-194">Définissez les propriétés suivantes de <xref:Microsoft.SqlServer.Replication.DistributionPublisher>:</span><span class="sxs-lookup"><span data-stu-id="5f5fe-194">Set the following properties of <xref:Microsoft.SqlServer.Replication.DistributionPublisher>:</span></span>  
  
    -   <span data-ttu-id="5f5fe-195"><xref:Microsoft.SqlServer.Replication.DistributionPublisher.Name%2A> - nom du serveur de publication local.</span><span class="sxs-lookup"><span data-stu-id="5f5fe-195"><xref:Microsoft.SqlServer.Replication.DistributionPublisher.Name%2A> - name of the local Publisher server.</span></span>  
  
    -   <span data-ttu-id="5f5fe-196"><xref:Microsoft.SqlServer.Replication.ReplicationObject.ConnectionContext%2A> - <xref:Microsoft.SqlServer.Management.Common.ServerConnection> créé à l'étape 1.</span><span class="sxs-lookup"><span data-stu-id="5f5fe-196"><xref:Microsoft.SqlServer.Replication.ReplicationObject.ConnectionContext%2A> - the <xref:Microsoft.SqlServer.Management.Common.ServerConnection> from step 1.</span></span>  
  
    -   <span data-ttu-id="5f5fe-197"><xref:Microsoft.SqlServer.Replication.DistributionPublisher.DistributionDatabase%2A> - nom de la base de données créée à l'étape 5.</span><span class="sxs-lookup"><span data-stu-id="5f5fe-197"><xref:Microsoft.SqlServer.Replication.DistributionPublisher.DistributionDatabase%2A> - the name of the database created in step 5.</span></span>  
  
    -   <span data-ttu-id="5f5fe-198"><xref:Microsoft.SqlServer.Replication.DistributionPublisher.WorkingDirectory%2A> - partage utilisé pour accéder aux fichiers d'instantanés.</span><span class="sxs-lookup"><span data-stu-id="5f5fe-198"><xref:Microsoft.SqlServer.Replication.DistributionPublisher.WorkingDirectory%2A> - the share used to access snapshot files.</span></span>  
  
    -   <span data-ttu-id="5f5fe-199"><xref:Microsoft.SqlServer.Replication.DistributionPublisher.PublisherSecurity%2A> - Mode de sécurité utilisé lors de la connexion au serveur de publication.</span><span class="sxs-lookup"><span data-stu-id="5f5fe-199"><xref:Microsoft.SqlServer.Replication.DistributionPublisher.PublisherSecurity%2A> - the security mode used when connecting to the Publisher.</span></span> <span data-ttu-id="5f5fe-200"><xref:Microsoft.SqlServer.Replication.ConnectionSecurityContext.WindowsAuthentication%2A> est recommandé.</span><span class="sxs-lookup"><span data-stu-id="5f5fe-200"><xref:Microsoft.SqlServer.Replication.ConnectionSecurityContext.WindowsAuthentication%2A> is recommended.</span></span>  
  
8.  <span data-ttu-id="5f5fe-201">Appelez la méthode <xref:Microsoft.SqlServer.Replication.DistributionPublisher.Create%2A> .</span><span class="sxs-lookup"><span data-stu-id="5f5fe-201">Call the <xref:Microsoft.SqlServer.Replication.DistributionPublisher.Create%2A> method.</span></span>  
  
9. <span data-ttu-id="5f5fe-202">Créez une connexion au serveur de publication local en utilisant la classe <xref:Microsoft.SqlServer.Management.Common.ServerConnection> .</span><span class="sxs-lookup"><span data-stu-id="5f5fe-202">Create a connection to the local Publisher server by using the <xref:Microsoft.SqlServer.Management.Common.ServerConnection> class.</span></span>  
  
10. <span data-ttu-id="5f5fe-203">Créez une instance de la classe <xref:Microsoft.SqlServer.Replication.ReplicationServer>.</span><span class="sxs-lookup"><span data-stu-id="5f5fe-203">Create an instance of the <xref:Microsoft.SqlServer.Replication.ReplicationServer> class.</span></span> <span data-ttu-id="5f5fe-204">Passez l’objet <xref:Microsoft.SqlServer.Management.Common.ServerConnection> créé à l’étape 9.</span><span class="sxs-lookup"><span data-stu-id="5f5fe-204">Pass the <xref:Microsoft.SqlServer.Management.Common.ServerConnection> from step 9.</span></span>  
  
11. <span data-ttu-id="5f5fe-205">Appelez la méthode <xref:Microsoft.SqlServer.Replication.ReplicationServer.InstallDistributor%2A> .</span><span class="sxs-lookup"><span data-stu-id="5f5fe-205">Call the <xref:Microsoft.SqlServer.Replication.ReplicationServer.InstallDistributor%2A> method.</span></span> <span data-ttu-id="5f5fe-206">Passez le nom du serveur de distribution distant et son mot de passe spécifié à l'étape 5.</span><span class="sxs-lookup"><span data-stu-id="5f5fe-206">Pass the name of the remote Distributor and the password for the remote Distributor specified in step 5.</span></span>  
  
    > [!IMPORTANT]  
    >  <span data-ttu-id="5f5fe-207">Lorsque c'est possible, demande aux utilisateurs de fournir les informations d'identification au moment de l'exécution.</span><span class="sxs-lookup"><span data-stu-id="5f5fe-207">When possible, prompt users to enter security credentials at runtime.</span></span> <span data-ttu-id="5f5fe-208">Si vous devez stocker des informations d'identification, utilisez les [Services de chiffrement](https://go.microsoft.com/fwlink/?LinkId=34733) fournis par Windows .NET Framework.</span><span class="sxs-lookup"><span data-stu-id="5f5fe-208">If you must store credentials, use the [cryptographic services](https://go.microsoft.com/fwlink/?LinkId=34733) provided by the Windows .NET Framework.</span></span>  
  
###  <a name="example-rmo"></a><a name="PShellExample"></a> <span data-ttu-id="5f5fe-209">Exemple (RMO)</span><span class="sxs-lookup"><span data-stu-id="5f5fe-209">Example (RMO)</span></span>  
 <span data-ttu-id="5f5fe-210">Vous pouvez configurer par programme la publication et la distribution de la réplication à l'aide d'objets RMO (Replication Management Objects).</span><span class="sxs-lookup"><span data-stu-id="5f5fe-210">You can programmatically configure replication publishing and distribution by using Replication Management Objects (RMO).</span></span>  
  
 [!code-csharp[HowTo#rmo_AddDistPub](../../snippets/csharp/SQL15/replication/howto/cs/rmotestevelope.cs#rmo_adddistpub)]  
  
 [!code-vb[HowTo#rmo_vb_AddDistPub](../../snippets/visualbasic/SQL15/replication/howto/vb/rmotestenv.vb#rmo_vb_adddistpub)]  
  
## <a name="see-also"></a><span data-ttu-id="5f5fe-211">Voir aussi</span><span class="sxs-lookup"><span data-stu-id="5f5fe-211">See Also</span></span>  
 <span data-ttu-id="5f5fe-212">[Afficher et modifier les propriétés d’un serveur de distribution et d’un serveur de publication](view-and-modify-distributor-and-publisher-properties.md) </span><span class="sxs-lookup"><span data-stu-id="5f5fe-212">[View and Modify Distributor and Publisher Properties](view-and-modify-distributor-and-publisher-properties.md) </span></span>  
 <span data-ttu-id="5f5fe-213">[Concepts liés aux procédures stockées système de réplication](concepts/replication-system-stored-procedures-concepts.md) </span><span class="sxs-lookup"><span data-stu-id="5f5fe-213">[Replication System Stored Procedures Concepts](concepts/replication-system-stored-procedures-concepts.md) </span></span>  
 <span data-ttu-id="5f5fe-214">[Configurer la distribution](configure-distribution.md) </span><span class="sxs-lookup"><span data-stu-id="5f5fe-214">[Configure Distribution](configure-distribution.md) </span></span>  
 <span data-ttu-id="5f5fe-215">[Concepts liés à RMO (Replication Management Objects)](concepts/replication-management-objects-concepts.md) </span><span class="sxs-lookup"><span data-stu-id="5f5fe-215">[Replication Management Objects Concepts](concepts/replication-management-objects-concepts.md) </span></span>  
 [<span data-ttu-id="5f5fe-216">Configurer la réplication pour groupes de disponibilité AlwaysOn &#40;SQL Server&#41;</span><span class="sxs-lookup"><span data-stu-id="5f5fe-216">Configure Replication for AlwaysOn Availability Groups &#40;SQL Server&#41;</span></span>](../../database-engine/availability-groups/windows/always-on-availability-groups-sql-server.md) 
  
  
