---
title: Réplication d’instantané | Microsoft Docs
ms.custom: ''
ms.date: 06/13/2017
ms.prod: sql-server-2014
ms.reviewer: ''
ms.technology: replication
ms.topic: conceptual
helpviewer_keywords:
- snapshot replication [SQL Server], about snapshot replication
- snapshot replication [SQL Server]
ms.assetid: 5d745f22-9c6b-4e11-8c62-bc50e9a8bf38
author: MashaMSFT
ms.author: mathoma
ms.openlocfilehash: 6192c196e31c4c5772099074c79b3c6c4ca7aeed
ms.sourcegitcommit: ad4d92dce894592a259721a1571b1d8736abacdb
ms.translationtype: MT
ms.contentlocale: fr-FR
ms.lasthandoff: 08/04/2020
ms.locfileid: "87710584"
---
# <a name="snapshot-replication"></a><span data-ttu-id="da5e0-102">Réplication d'instantané</span><span class="sxs-lookup"><span data-stu-id="da5e0-102">Snapshot Replication</span></span>
  <span data-ttu-id="da5e0-103">La réplication d'instantané transmet les données telles qu'elles apparaissent à un moment précis, sans contrôler les mises à jour des données.</span><span class="sxs-lookup"><span data-stu-id="da5e0-103">Snapshot replication distributes data exactly as it appears at a specific moment in time and does not monitor for updates to the data.</span></span> <span data-ttu-id="da5e0-104">Lors de la synchronisation, l'intégralité de l'instantané est générée et envoyée aux abonnés.</span><span class="sxs-lookup"><span data-stu-id="da5e0-104">When synchronization occurs, the entire snapshot is generated and sent to Subscribers.</span></span>  
  
> [!NOTE]  
>  <span data-ttu-id="da5e0-105">La réplication d'instantané peut être utilisée seule, mais le processus d'instantané (qui crée une copie de tous les objets et données spécifiés par une publication) est également couramment utilisé pour fournir le jeu initial de données et d'objets de base de données pour les publications transactionnelles et de fusion.</span><span class="sxs-lookup"><span data-stu-id="da5e0-105">Snapshot replication can be used by itself, but the snapshot process (which creates a copy of all of the objects and data specified by a publication) is also commonly used to provide the initial set of data and database objects for transactional and merge publications.</span></span>  
  
 <span data-ttu-id="da5e0-106">L'utilisation de la réplication d'instantané seule est la plus appropriée quand une ou plusieurs des conditions suivantes sont remplies :</span><span class="sxs-lookup"><span data-stu-id="da5e0-106">Using snapshot replication by itself is most appropriate when one or more of the following is true:</span></span>  
  
-   <span data-ttu-id="da5e0-107">Les données changent peu fréquemment.</span><span class="sxs-lookup"><span data-stu-id="da5e0-107">Data changes infrequently.</span></span>  
  
-   <span data-ttu-id="da5e0-108">Il est acceptable que des copies des données ne soient pas à jour relativement au serveur de publication pendant un certain temps.</span><span class="sxs-lookup"><span data-stu-id="da5e0-108">It is acceptable to have copies of data that are out of date with respect to the Publisher for a period of time.</span></span>  
  
-   <span data-ttu-id="da5e0-109">de faibles volumes de données sont répliqués ;</span><span class="sxs-lookup"><span data-stu-id="da5e0-109">Replicating small volumes of data.</span></span>  
  
-   <span data-ttu-id="da5e0-110">Un gros volume de modifications survient au cours d'une brève période de temps.</span><span class="sxs-lookup"><span data-stu-id="da5e0-110">A large volume of changes occurs over a short period of time.</span></span>  
  
 <span data-ttu-id="da5e0-111">La réplication d'instantané est plus appropriée quand les modifications de données sont substantielles mais peu fréquentes.</span><span class="sxs-lookup"><span data-stu-id="da5e0-111">Snapshot replication is most appropriate when data changes are substantial but infrequent.</span></span> <span data-ttu-id="da5e0-112">Par exemple, si une entreprise commerciale gère des tarifs de produits, et que ces tarifs sont tous mis à jour en même temps, une à deux fois par an, il est recommandé de procéder à une réplication de l'intégralité de l'instantané des données modifiées.</span><span class="sxs-lookup"><span data-stu-id="da5e0-112">For example, if a sales organization maintains a product price list and the prices are all updated at the same time once or twice each year, replicating the entire snapshot of data after it has changed is recommended.</span></span> <span data-ttu-id="da5e0-113">Suivant certains types de données, des instantanés plus fréquents peuvent également être appropriés.</span><span class="sxs-lookup"><span data-stu-id="da5e0-113">Given certain types of data, more frequent snapshots may also be appropriate.</span></span> <span data-ttu-id="da5e0-114">Par exemple, si une table relativement petite est mise à jour sur le serveur de publication dans la journée mais qu'une certaine latence est tolérée, les modifications peuvent être remises pendant la nuit en tant qu'instantané.</span><span class="sxs-lookup"><span data-stu-id="da5e0-114">For example, if a relatively small table is updated at the Publisher during the day, but some latency is acceptable, changes can be delivered nightly as a snapshot.</span></span>  
  
 <span data-ttu-id="da5e0-115">La charge continue sur le serveur de publication est plus faible sur une réplication d'instantané que sur une réplication transactionnelle, car les modifications incrémentielles ne sont pas suivies.</span><span class="sxs-lookup"><span data-stu-id="da5e0-115">Snapshot replication has a lower continuous overhead on the Publisher than transactional replication, because incremental changes are not tracked.</span></span> <span data-ttu-id="da5e0-116">Toutefois, si l'ensemble du dataset à répliquer est très grand, d'importantes ressources seront nécessaires pour générer et appliquer l'instantané.</span><span class="sxs-lookup"><span data-stu-id="da5e0-116">However, if the dataset set being replicated is very large, it will require substantial resources to generate and apply the snapshot.</span></span> <span data-ttu-id="da5e0-117">Prenez en considération la taille du jeu de données complet et la fréquence des modifications sur les données lorsque vous envisagez d'utiliser la réplication d'instantané.</span><span class="sxs-lookup"><span data-stu-id="da5e0-117">Consider the size of the entire data set and the frequency of changes to the data when evaluating whether to utilize snapshot replication.</span></span>  
  
 <span data-ttu-id="da5e0-118">**Dans cette rubrique**</span><span class="sxs-lookup"><span data-stu-id="da5e0-118">**In this topic**</span></span>  
  
 [<span data-ttu-id="da5e0-119">Fonctionnement de la réplication d'instantané</span><span class="sxs-lookup"><span data-stu-id="da5e0-119">How Snapshot Replication Works</span></span>](#HowWorks)  
  
 [<span data-ttu-id="da5e0-120">Agent d’instantané</span><span class="sxs-lookup"><span data-stu-id="da5e0-120">Snapshot Agent</span></span>](#SnapshotAgent)  
  
 [<span data-ttu-id="da5e0-121">Agent de distribution et Agent de fusion</span><span class="sxs-lookup"><span data-stu-id="da5e0-121">Distribution and Merge Agents</span></span>](#DistAgent)  
  
##  <a name="how-snapshot-replication-works"></a><a name="HowWorks"></a> <span data-ttu-id="da5e0-122">Fonctionnement de la réplication d'instantané</span><span class="sxs-lookup"><span data-stu-id="da5e0-122">How Snapshot Replication Works</span></span>  
 <span data-ttu-id="da5e0-123">Par défaut, les trois types de réplication utilisent un instantané pour initialiser les abonnés.</span><span class="sxs-lookup"><span data-stu-id="da5e0-123">By default, all three types of replication use a snapshot to initialize Subscribers.</span></span> <span data-ttu-id="da5e0-124">L'Agent d'instantané [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] génère toujours les fichiers d'instantanés, mais l'Agent qui remet les fichiers diffère selon le type de réplication utilisé.</span><span class="sxs-lookup"><span data-stu-id="da5e0-124">The [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] Snapshot Agent always generates the snapshot files, but the agent that delivers the files differs depending on the type of replication being used.</span></span> <span data-ttu-id="da5e0-125">La réplication d'instantané et la réplication transactionnelle utilisent l'Agent de distribution pour remettre les fichiers, alors que la réplication de fusion utilise l'Agent de fusion [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] .</span><span class="sxs-lookup"><span data-stu-id="da5e0-125">Snapshot replication and transactional replication use the Distribution Agent to deliver the files, whereas merge replication uses the [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] Merge Agent.</span></span> <span data-ttu-id="da5e0-126">L'Agent d'instantané s'exécute sur le serveur de distribution.</span><span class="sxs-lookup"><span data-stu-id="da5e0-126">The Snapshot Agent runs at the Distributor.</span></span> <span data-ttu-id="da5e0-127">L'Agent de distribution et l'Agent de fusion s'exécutent sur le serveur de distribution pour les abonnements par envoi de données (push), ou sur les abonnés pour les abonnements par extraction de données (pull).</span><span class="sxs-lookup"><span data-stu-id="da5e0-127">The Distribution Agent and Merge Agent run at the Distributor for push subscriptions, or at Subscribers for pull subscriptions.</span></span>  
  
 <span data-ttu-id="da5e0-128">Les instantanés peuvent être générés et appliqués soit immédiatement après la création de l'abonnement, ou selon une planification définie lors de la création de la publication.</span><span class="sxs-lookup"><span data-stu-id="da5e0-128">Snapshots can be generated and applied either immediately after the subscription is created or according to a schedule set at the time the publication is created.</span></span> <span data-ttu-id="da5e0-129">L'Agent d'instantané prépare les fichiers d'instantanés contenant les schémas ainsi que les données des tables et des objets de base de données publiés, stocke les fichiers dans le dossier d'instantanés du serveur de publication, et enregistre les informations de suivi dans la base de données de distribution sur le serveur de distribution.</span><span class="sxs-lookup"><span data-stu-id="da5e0-129">The Snapshot Agent prepares snapshot files containing the schema and data of published tables and database objects, stores the files in the snapshot folder for the Publisher, and records tracking information in the distribution database on the Distributor.</span></span> <span data-ttu-id="da5e0-130">Le dossier d'instantanés par défaut est spécifié lorsque vous configurez un serveur de distribution, vous pouvez également spécifier un emplacement de remplacement pour une publication pour remplacer ou suppléer le dossier par défaut.</span><span class="sxs-lookup"><span data-stu-id="da5e0-130">You specify a default snapshot folder when you configure a Distributor, but you can specify an alternate location for a publication instead of or in addition to the default.</span></span>  
  
 <span data-ttu-id="da5e0-131">En plus du processus d'instantané standard décrit dans cette rubrique, un processus d'instantané en deux parties est utilisé pour les publications de fusion avec filtres paramétrés.</span><span class="sxs-lookup"><span data-stu-id="da5e0-131">In addition to the standard snapshot process described in this topic, a two-part snapshot process is used for merge publications with parameterized filters.</span></span>  
  
 <span data-ttu-id="da5e0-132">L'illustration suivante montre les principaux composants de la réplication d'instantané.</span><span class="sxs-lookup"><span data-stu-id="da5e0-132">The following illustration shows the principal components of snapshot replication.</span></span>  
  
 <span data-ttu-id="da5e0-133">![Composants et flux de données de réplication d’instantané](media/snapshot.gif "Composants et flux de données de réplication d’instantané")</span><span class="sxs-lookup"><span data-stu-id="da5e0-133">![Snapshot replication components and data flow](media/snapshot.gif "Snapshot replication components and data flow")</span></span>  
  
##  <a name="snapshot-agent"></a><a name="SnapshotAgent"></a> <span data-ttu-id="da5e0-134">Agent d'instantané</span><span class="sxs-lookup"><span data-stu-id="da5e0-134">Snapshot Agent</span></span>  
 <span data-ttu-id="da5e0-135">Pour la réplication de fusion, un instantané est généré à chaque exécution de l'Agent d'instantané.</span><span class="sxs-lookup"><span data-stu-id="da5e0-135">For merge replication, a snapshot is generated every time the Snapshot Agent runs.</span></span> <span data-ttu-id="da5e0-136">Pour la réplication transactionnelle, la génération d'instantané dépend du paramétrage de la propriété de publication **immediate_sync**.</span><span class="sxs-lookup"><span data-stu-id="da5e0-136">For transactional replication, snapshot generation depends on the setting of the publication property **immediate_sync**.</span></span> <span data-ttu-id="da5e0-137">Si la propriété est définie avec la valeur TRUE (valeur par défaut lors de l'utilisation de l'Assistant Nouvelle publication), un instantané est généré à chaque exécution de l'Agent d'instantané, et peut être appliqué à un abonné à tout moment.</span><span class="sxs-lookup"><span data-stu-id="da5e0-137">If the property is set to TRUE (the default when using the New Publication Wizard), a snapshot is generated every time the Snapshot Agent runs, and it can be applied to a Subscriber at any time.</span></span> <span data-ttu-id="da5e0-138">Si la propriété est définie avec la valeur FALSE (valeur par défaut lors de l'utilisation de **sp_addpublication**), l'instantané est généré uniquement si un nouvel abonnement a été ajouté depuis la dernière exécution de l'Agent d'instantané ; les abonnés doivent attendre que l'Agent d'instantané se termine avant de pouvoir se synchroniser.</span><span class="sxs-lookup"><span data-stu-id="da5e0-138">If the property is set to FALSE (the default when using **sp_addpublication**), the snapshot is generated only if a new subscription has been added since the last Snapshot Agent run; Subscribers must wait for the Snapshot Agent to complete before they can synchronize.</span></span>  
  
 <span data-ttu-id="da5e0-139">L'Agent d'instantané exécute les étapes suivantes :</span><span class="sxs-lookup"><span data-stu-id="da5e0-139">The Snapshot Agent performs the following steps:</span></span>  
  
1.  <span data-ttu-id="da5e0-140">Il établit une connexion du serveur de distribution au serveur de publication, puis applique des verrous sur les tables publiées si nécessaire :</span><span class="sxs-lookup"><span data-stu-id="da5e0-140">Establishes a connection from the Distributor to the Publisher, and then takes locks on published tables if necessary:</span></span>  
  
    -   <span data-ttu-id="da5e0-141">Pour les publications de fusion, l'Agent d'instantané n'utilise aucun verrou.</span><span class="sxs-lookup"><span data-stu-id="da5e0-141">For merge publications, the Snapshot Agent does not take any locks.</span></span>  
  
    -   <span data-ttu-id="da5e0-142">Pour les publications transactionnelles, par défaut l'Agent d'instantané utilise des verrous uniquement lors de la phase initiale de génération d'instantané.</span><span class="sxs-lookup"><span data-stu-id="da5e0-142">For transactional publications, by default the Snapshot Agent take locks only during the initial phase of snapshot generation.</span></span>  
  
    -   <span data-ttu-id="da5e0-143">Pour les publications d'instantanés, les verrous sont utilisés pendant tout le processus de génération d'instantané.</span><span class="sxs-lookup"><span data-stu-id="da5e0-143">For snapshot publications, locks are held during the entire snapshot generation process.</span></span>  
  
2.  <span data-ttu-id="da5e0-144">Il enregistre une copie du schéma de la table pour chaque article sur un fichier .sch.</span><span class="sxs-lookup"><span data-stu-id="da5e0-144">Writes a copy of the table schema for each article to a .sch file.</span></span> <span data-ttu-id="da5e0-145">Si d'autres objets de base de données sont publiés, comme les index, les contraintes, les procédures stockées, les vues, les fonctions définies par l'utilisateur, etc., des fichiers script supplémentaires sont générés.</span><span class="sxs-lookup"><span data-stu-id="da5e0-145">If other database objects are published, such as indexes, constraints, stored procedures, views, user-defined functions, and so on, additional script files are generated.</span></span>  
  
3.  <span data-ttu-id="da5e0-146">Il copie les données à partir de la table publiée sur le serveur de publication et enregistre les données dans le dossier d'instantanés.</span><span class="sxs-lookup"><span data-stu-id="da5e0-146">Copies the data from the published table at the Publisher and writes the data to the snapshot folder.</span></span> <span data-ttu-id="da5e0-147">L'instantané est généré comme un ensemble de fichiers programme de copie en bloc (BCP).</span><span class="sxs-lookup"><span data-stu-id="da5e0-147">The snapshot is generated as a set of bulk copy program (BCP) files.</span></span>  
  
4.  <span data-ttu-id="da5e0-148">Pour les publications d'instantané et transactionnelle, l'Agent d'instantané ajoute des lignes aux tables **MSrepl_commands** et **MSrepl_transactions** dans la base de données de distribution.</span><span class="sxs-lookup"><span data-stu-id="da5e0-148">For snapshot and transactional publications, the Snapshot Agent appends rows to the **MSrepl_commands** and **MSrepl_transactions** tables in the distribution database.</span></span> <span data-ttu-id="da5e0-149">Les entrées de la table **MSrepl_commands** sont des commandes indiquant l'emplacement des fichiers .sch et .bcp, des autres fichiers d'instantanés, et des références à tout script d'avant ou après l'instantané.</span><span class="sxs-lookup"><span data-stu-id="da5e0-149">The entries in the **MSrepl_commands** table are commands indicating the location of .sch and .bcp files, any other snapshot files, and references to any pre- or post-snapshot scripts.</span></span> <span data-ttu-id="da5e0-150">Les entrées de la table **MSrepl_transactions** sont des commandes concernant la synchronisation de l'Abonné.</span><span class="sxs-lookup"><span data-stu-id="da5e0-150">The entries in the **MSrepl_transactions** table are commands relevant to synchronizing the Subscriber.</span></span>  
  
     <span data-ttu-id="da5e0-151">Pour les publications de fusion, l'Agent d'instantané effectue des étapes supplémentaires.</span><span class="sxs-lookup"><span data-stu-id="da5e0-151">For merge publications, the Snapshot Agent performs additional steps.</span></span>  
  
5.  <span data-ttu-id="da5e0-152">Il libère tous les verrous sur les tables publiées.</span><span class="sxs-lookup"><span data-stu-id="da5e0-152">Releases any locks on published tables.</span></span>  
  
 <span data-ttu-id="da5e0-153">Vous ne pouvez pas effectuer de modifications de schéma sur les tables publiées pendant la génération d'instantané.</span><span class="sxs-lookup"><span data-stu-id="da5e0-153">During snapshot generation, you cannot make schema changes on published tables.</span></span> <span data-ttu-id="da5e0-154">Une fois les fichiers d'instantanés générés, vous pouvez les visualiser dans le dossier d'instantanés à l'aide de l'Explorateur Windows.</span><span class="sxs-lookup"><span data-stu-id="da5e0-154">After the snapshot files are generated, you can view them in the snapshot folder using Windows Explorer.</span></span>  
  
##  <a name="distribution-agent-and-merge-agent"></a><a name="DistAgent"></a> <span data-ttu-id="da5e0-155">Agent de distribution et Agent de fusion</span><span class="sxs-lookup"><span data-stu-id="da5e0-155">Distribution Agent and Merge Agent</span></span>  
 <span data-ttu-id="da5e0-156">Pour les publications d'instantanés, chaque fois que l'Agent de distribution s'exécute pour la publication, il déplace le nouvel instantané sur chaque abonné n'ayant pas encore été synchronisé, ayant été marqué pour une réinitialisation, ou incluant de nouveaux articles.</span><span class="sxs-lookup"><span data-stu-id="da5e0-156">For snapshot publications, each time the Distribution Agent runs for the publication, it moves a new snapshot to each Subscriber that has not yet been synchronized, has been marked for reinitialization, or includes new articles.</span></span>  
  
 <span data-ttu-id="da5e0-157">Pour la réplication d'instantané ou transactionnelle, l'Agent de distribution effectue les étapes suivantes :</span><span class="sxs-lookup"><span data-stu-id="da5e0-157">For snapshot and transactional replication, the Distribution Agent performs the following steps:</span></span>  
  
1.  <span data-ttu-id="da5e0-158">Il établit une connexion au serveur de distribution.</span><span class="sxs-lookup"><span data-stu-id="da5e0-158">Establishes a connection to the Distributor.</span></span>  
  
2.  <span data-ttu-id="da5e0-159">Il examine les tables **MSrepl_commands** et **MSrepl_transactions** de la base de données de distribution sur le serveur de distribution.</span><span class="sxs-lookup"><span data-stu-id="da5e0-159">Examines the **MSrepl_commands** and **MSrepl_transactions** tables in the distribution database on the Distributor.</span></span> <span data-ttu-id="da5e0-160">L'Agent lit l'emplacement des fichiers d'instantanés dans la première table et les commandes de synchronisation de l'Abonné dans les deux tables.</span><span class="sxs-lookup"><span data-stu-id="da5e0-160">The agent reads the location of the snapshot files from the first table and Subscriber synchronization commands from both tables.</span></span>  
  
3.  <span data-ttu-id="da5e0-161">Il applique le schéma et les commandes à la base de données d'abonnement.</span><span class="sxs-lookup"><span data-stu-id="da5e0-161">Applies the schema and commands to the subscription database.</span></span>  
  
 <span data-ttu-id="da5e0-162">Pour une publication de réplication de fusion non filtrée, l'Agent de fusion effectue les étapes suivantes :</span><span class="sxs-lookup"><span data-stu-id="da5e0-162">For an unfiltered merge replication publication, the Merge Agent performs the following steps:</span></span>  
  
1.  <span data-ttu-id="da5e0-163">Il établit une connexion au serveur de publication.</span><span class="sxs-lookup"><span data-stu-id="da5e0-163">Establishes a connection to the Publisher.</span></span>  
  
2.  <span data-ttu-id="da5e0-164">Il examine la table **sysmergeschemachange** sur le serveur de publication et détermine si un nouvel instantané doit être appliqué sur l'Abonné.</span><span class="sxs-lookup"><span data-stu-id="da5e0-164">Examines the **sysmergeschemachange** table on the Publisher and determines whether there is a new snapshot that should be applied at the Subscriber.</span></span>  
  
3.  <span data-ttu-id="da5e0-165">Si un nouvel instantané est disponible, l'Agent de fusion applique les fichiers d'instantanés à la base de données d'abonnement à partir de l'emplacement spécifié dans **sysmergeschemachange**.</span><span class="sxs-lookup"><span data-stu-id="da5e0-165">If a new snapshot is available, the Merge Agent applies to the subscription database the snapshot files from the location specified in **sysmergeschemachange**.</span></span>  
  
  
