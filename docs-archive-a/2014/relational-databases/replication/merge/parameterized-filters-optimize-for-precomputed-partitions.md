---
title: Optimiser les performances des filtres paramétrés avec des partitions précalculées | Microsoft Docs
ms.custom: ''
ms.date: 03/06/2017
ms.prod: sql-server-2014
ms.reviewer: ''
ms.technology: replication
ms.topic: conceptual
helpviewer_keywords:
- precomputed partitions [SQL Server replication]
- merge replication precomputed partitions [SQL Server replication]
- merge replication precomputed partitions [SQL Server replication], about precomputed partitions
ms.assetid: 85654bf4-e25f-4f04-8e34-bbbd738d60fa
author: MashaMSFT
ms.author: mathoma
ms.openlocfilehash: 4ad0a33f0a5951256ff94bc78e7f09a88c05f227
ms.sourcegitcommit: ad4d92dce894592a259721a1571b1d8736abacdb
ms.translationtype: MT
ms.contentlocale: fr-FR
ms.lasthandoff: 08/04/2020
ms.locfileid: "87708199"
---
# <a name="optimize-parameterized-filter-performance-with-precomputed-partitions"></a><span data-ttu-id="25b46-102">Optimiser les performances des filtres paramétrés avec des partitions précalculées</span><span class="sxs-lookup"><span data-stu-id="25b46-102">Optimize Parameterized Filter Performance with Precomputed Partitions</span></span>
  <span data-ttu-id="25b46-103">Les partitions précalculées représentent une optimisation des performances pouvant être utilisée avec les publications de fusion filtrées.</span><span class="sxs-lookup"><span data-stu-id="25b46-103">Precomputed partitions is a performance optimization that can be used with filtered merge publications.</span></span> <span data-ttu-id="25b46-104">Les partitions précalculées sont également une condition requise pour l'utilisation d'enregistrements logiques sur les publications filtrées.</span><span class="sxs-lookup"><span data-stu-id="25b46-104">Precomputed partitions is also a requirement for using logical records on filtered publications.</span></span> <span data-ttu-id="25b46-105">Pour plus d’informations sur les enregistrements logiques, consultez [Regrouper les modifications apportées à des lignes connexes à l’aide d’enregistrements logiques](group-changes-to-related-rows-with-logical-records.md).</span><span class="sxs-lookup"><span data-stu-id="25b46-105">For more information about logical records, see [Group Changes to Related Rows with Logical Records](group-changes-to-related-rows-with-logical-records.md).</span></span>  
  
 <span data-ttu-id="25b46-106">Lorsqu'un abonné synchronise avec un serveur de publication, ce dernier doit évaluer les filtres de l'Abonné pour déterminer quelles lignes appartiennent à la partition, ou à l'ensemble de données de cet abonné.</span><span class="sxs-lookup"><span data-stu-id="25b46-106">When a Subscriber synchronizes with a Publisher, the Publisher must evaluate the Subscriber's filters to determine which rows belong to that Subscriber's partition, or data set.</span></span> <span data-ttu-id="25b46-107">Le processus permettant de déterminer l'appartenance d'une partition aux modifications sur le serveur de publication pour chaque abonné recevant un dataset filtré est dénommé *évaluation de partition*.</span><span class="sxs-lookup"><span data-stu-id="25b46-107">This process of determining partition membership of changes at the Publisher for each Subscriber receiving a filtered dataset is referred to as *partition evaluation*.</span></span> <span data-ttu-id="25b46-108">Sans partitions précalculées, l'évaluation de partition doit être effectuée pour chaque modification apportée à une colonne filtrée sur le serveur de publication depuis la dernière exécution de l'Agent de fusion pour un abonné spécifique, et ce processus doit être répété pour chaque abonné synchronisant avec le serveur de publication.</span><span class="sxs-lookup"><span data-stu-id="25b46-108">Without precomputed partitions, partition evaluation must be performed for each change made to a filtered column at the Publisher since the last time the Merge Agent ran for a specific Subscriber, and this process has to be repeated for every Subscriber that synchronizes with the Publisher.</span></span>  
  
 <span data-ttu-id="25b46-109">Toutefois, si le serveur de publication et l’abonné s’exécutent sur [!INCLUDE[msCoName](../../../includes/msconame-md.md)] [!INCLUDE[ssVersion2005](../../../includes/ssversion2005-md.md)] ou une version ultérieure et que vous utilisez des partitions précalculées, l’appartenance à une partition pour toutes les modifications sur le serveur de publication est précalculée et persistante au moment où les modifications sont effectuées.</span><span class="sxs-lookup"><span data-stu-id="25b46-109">However, if the Publisher and Subscriber are running on [!INCLUDE[msCoName](../../../includes/msconame-md.md)] [!INCLUDE[ssVersion2005](../../../includes/ssversion2005-md.md)] or a later version and you use precomputed partitions, partition membership for all changes at the Publisher is precomputed and persisted at the time that the changes are made.</span></span> <span data-ttu-id="25b46-110">Il en résulte que lorsque l'Abonné synchronise avec le serveur de publication, il peut commencer immédiatement à télécharger les modifications concernant sa partition, sans avoir à passer par le processus d'évaluation de partition.</span><span class="sxs-lookup"><span data-stu-id="25b46-110">As a result, when a Subscriber synchronizes with the Publisher, it can immediately start to download changes relevant to its partition without having to go through the partition evaluation process.</span></span> <span data-ttu-id="25b46-111">Cela peut entraîner d'importantes améliorations en terme de performance, lorsqu'une publication comporte beaucoup de modifications, d'abonnés ou d'articles dans la publication.</span><span class="sxs-lookup"><span data-stu-id="25b46-111">This can lead to significant performance gains when a publication has a large number of changes, Subscribers, or articles in the publication.</span></span>  
  
 <span data-ttu-id="25b46-112">En plus d'utiliser des partitions précalculées, prégénérez des instantanés et/ou permettez aux Abonnés de demander la génération et l'application d'un instantané la première fois qu'ils se synchronisent.</span><span class="sxs-lookup"><span data-stu-id="25b46-112">In addition to using precomputed partitions, pre-generate snapshots and/or allow Subscribers to request snapshot generation and application the first time they synchronize.</span></span> <span data-ttu-id="25b46-113">Utilisez l'une ou l'autre de ces options ou les deux pour fournir des instantanés pour les publications qui utilisent des filtres paramétrés.</span><span class="sxs-lookup"><span data-stu-id="25b46-113">Use one or both of these options to provide snapshots for publications that use parameterized filters.</span></span> <span data-ttu-id="25b46-114">Si vous ne spécifiez pas une de ces options, les abonnements sont initialisés à l'aide d'une série d'instructions SELECT et INSERT au lieu d'utiliser l'utilitaire **bcp** , ce processus étant beaucoup plus lent.</span><span class="sxs-lookup"><span data-stu-id="25b46-114">If you do not specify one of these options, subscriptions are initialized using a series of SELECT and INSERT statements, rather than using the **bcp** utility; this process is much slower.</span></span> <span data-ttu-id="25b46-115">Pour plus d'informations, voir [Snapshots for Merge Publications with Parameterized Filters](../snapshots-for-merge-publications-with-parameterized-filters.md).</span><span class="sxs-lookup"><span data-stu-id="25b46-115">For more information, see [Snapshots for Merge Publications with Parameterized Filters](../snapshots-for-merge-publications-with-parameterized-filters.md).</span></span>  
  
 <span data-ttu-id="25b46-116">**Pour utiliser les partitions précalculées**</span><span class="sxs-lookup"><span data-stu-id="25b46-116">**To use precomputed partitions**</span></span>  
  
 <span data-ttu-id="25b46-117">Les partitions précalculées sont activées par défaut sur toutes les publications, nouvelles ou existantes, répondant aux conditions décrites ci-dessous.</span><span class="sxs-lookup"><span data-stu-id="25b46-117">Precomputed partitions are enabled by default on all new and existing publications that adhere to the guidelines described above.</span></span> <span data-ttu-id="25b46-118">Le paramétrage peut être modifié via [!INCLUDE[ssManStudioFull](../../../includes/ssmanstudiofull-md.md)] ou par programme.</span><span class="sxs-lookup"><span data-stu-id="25b46-118">The setting can be changed through [!INCLUDE[ssManStudioFull](../../../includes/ssmanstudiofull-md.md)] or programmatically.</span></span> <span data-ttu-id="25b46-119">Pour plus d’informations, consultez [Optimize Parameterized Row Filters](../publish/optimize-parameterized-row-filters.md).</span><span class="sxs-lookup"><span data-stu-id="25b46-119">For more information, see [Optimize Parameterized Row Filters](../publish/optimize-parameterized-row-filters.md).</span></span>  
  
## <a name="requirements-for-using-precomputed-partitions"></a><span data-ttu-id="25b46-120">Conditions requises à l'utilisation des partitions précalculées</span><span class="sxs-lookup"><span data-stu-id="25b46-120">Requirements for Using Precomputed Partitions</span></span>  
 <span data-ttu-id="25b46-121">Si les conditions requises sont atteintes, les nouvelles publications sont créées par défaut avec les partitions précalculées activées, et les publications existantes sont mises à niveau automatiquement afin d'utiliser cette fonctionnalité.</span><span class="sxs-lookup"><span data-stu-id="25b46-121">If the following requirements are met, new merge publications are, by default, created with precomputed partitions enabled, and existing publications are automatically upgraded to use the feature.</span></span> <span data-ttu-id="25b46-122">Si une publication ne répond pas aux conditions requises, elle peut être modifiée pour que les partitions précalculées puissent ensuite être activées.</span><span class="sxs-lookup"><span data-stu-id="25b46-122">If a publication does not meet the requirements, it can be changed, and then precomputed partitions can be enabled.</span></span> <span data-ttu-id="25b46-123">Si quelques articles répondent aux conditions requises et d'autres non, envisagez de créer deux publications dont l'une d'entre elles est activée pour les partitions précalculées.</span><span class="sxs-lookup"><span data-stu-id="25b46-123">If some articles meet these requirements and some do not, consider creating two publications, with one enabled for precomputed partitions.</span></span>  
  
### <a name="requirements-for-filter-clauses"></a><span data-ttu-id="25b46-124">Conditions requises pour les clauses de filtres</span><span class="sxs-lookup"><span data-stu-id="25b46-124">Requirements for Filter Clauses</span></span>  
  
-   <span data-ttu-id="25b46-125">Toutes les fonctions utilisées dans le filtre de lignes paramétrable, telles que HOST_NAME() et SUSER_SNAME(), doivent apparaître directement dans la clause du filtre paramétrable et ne pas être imbriquées dans une vue ou une fonction dynamique.</span><span class="sxs-lookup"><span data-stu-id="25b46-125">Any functions used in parameterized row filters, such as HOST_NAME() and SUSER_SNAME(), should appear directly in the parameterized filter clause and not be nested inside of a view or dynamic function.</span></span> <span data-ttu-id="25b46-126">Pour plus d’informations sur ces fonctions, consultez [HOST_NAME &#40;Transact-SQL&#41;](/sql/t-sql/functions/host-name-transact-sql), [SUSER_SNAME &#40;Transact-SQL&#41;](/sql/t-sql/functions/suser-sname-transact-sql) et [Filtres de lignes paramétrés](parameterized-filters-parameterized-row-filters.md).</span><span class="sxs-lookup"><span data-stu-id="25b46-126">For more information about these functions, see [HOST_NAME &#40;Transact-SQL&#41;](/sql/t-sql/functions/host-name-transact-sql), [SUSER_SNAME &#40;Transact-SQL&#41;](/sql/t-sql/functions/suser-sname-transact-sql), and [Parameterized Row Filters](parameterized-filters-parameterized-row-filters.md).</span></span>  
  
-   <span data-ttu-id="25b46-127">Les valeurs renvoyées pour chaque abonné ne doivent pas être modifiées une fois que la partition a été créée.</span><span class="sxs-lookup"><span data-stu-id="25b46-127">The values returned for each Subscriber should not change after the partition is created.</span></span> <span data-ttu-id="25b46-128">Par exemple, si vous utilisez HOST_NAME() dans un filtre (sans remplacer la valeur HOST_NAME()), ne modifiez pas le nom de l'ordinateur sur l'Abonné.</span><span class="sxs-lookup"><span data-stu-id="25b46-128">For example, if you use HOST_NAME() in a filter (and do not override the HOST_NAME() value) do not change the computer name at the Subscriber.</span></span>  
  
-   <span data-ttu-id="25b46-129">Les filtres de jointure ne doivent pas contenir de fonctions dynamiques (telles que des fonctions HOST_NAME() et SUSER_SNAME() qui évaluent à une valeur différente selon l'Abonné qui se synchronise).</span><span class="sxs-lookup"><span data-stu-id="25b46-129">Join filters should not contain dynamic functions (functions such as HOST_NAME() and SUSER_SNAME() that evaluate to a different value depending upon the Subscriber that is synchronizing).</span></span> <span data-ttu-id="25b46-130">Seuls les filtres de lignes paramétrables doivent contenir des fonctions dynamiques.</span><span class="sxs-lookup"><span data-stu-id="25b46-130">Only parameterized row filters should contain dynamic functions.</span></span>  
  
-   <span data-ttu-id="25b46-131">Les fonctions non déterministes ne peuvent pas s'utiliser dans une clause de filtre.</span><span class="sxs-lookup"><span data-stu-id="25b46-131">Nondeterministic functions cannot be used in a filter clause.</span></span> <span data-ttu-id="25b46-132">Pour plus d'informations sur les fonctions non déterministes, consultez [Deterministic and Nondeterministic Functions](../../user-defined-functions/deterministic-and-nondeterministic-functions.md).</span><span class="sxs-lookup"><span data-stu-id="25b46-132">For more information about nondeterministic functions, see [Deterministic and Nondeterministic Functions](../../user-defined-functions/deterministic-and-nondeterministic-functions.md).</span></span>  
  
-   <span data-ttu-id="25b46-133">Les vues référencées dans les clauses de filtres de jointure ou de filtre paramétré ne doivent pas contenir de fonctions dynamiques.</span><span class="sxs-lookup"><span data-stu-id="25b46-133">Views referenced in join filter clauses or parameterized filter clauses should not contain dynamic functions.</span></span>  
  
-   <span data-ttu-id="25b46-134">Aucune relation de filtre de jointure circulaire ne doit exister dans la publication.</span><span class="sxs-lookup"><span data-stu-id="25b46-134">There should be no circular join filter relationships in the publication.</span></span>  
  
### <a name="database-collation"></a><span data-ttu-id="25b46-135">Classement de base de données</span><span class="sxs-lookup"><span data-stu-id="25b46-135">Database Collation</span></span>  
  
-   <span data-ttu-id="25b46-136">Lorsque les partitions précalculées sont utilisées, le classement de base de données est toujours utilisé lorsque des comparaisons sont effectuées, plutôt que le classement de la table ou de la colonne.</span><span class="sxs-lookup"><span data-stu-id="25b46-136">When precomputed partitions are used, the collation of the database is always used when making comparisons, rather than the collation of the table or column.</span></span> <span data-ttu-id="25b46-137">Examinez le cas suivant :</span><span class="sxs-lookup"><span data-stu-id="25b46-137">Consider the following scenario:</span></span>  
  
    -   <span data-ttu-id="25b46-138">Une base de données avec un classement respectant les accents contient une table avec un classement ne respectant pas les accents.</span><span class="sxs-lookup"><span data-stu-id="25b46-138">A database with a case-sensitive collation contains a table with a case-insensitive collation.</span></span>  
  
    -   <span data-ttu-id="25b46-139">La table contient une colonne **Nom de l'ordinateur**qui est comparée avec le nom d'hôte de l'Abonné dans un filtre paramétré.</span><span class="sxs-lookup"><span data-stu-id="25b46-139">The table contains a column **ComputerName**, which is compared against the host name of the Subscriber in a parameterized filter.</span></span>  
  
    -   <span data-ttu-id="25b46-140">La table contient une ligne avec la valeur « POSTE DE TRAVAIL » et une ligne avec la valeur « poste de travail » dans cette colonne.</span><span class="sxs-lookup"><span data-stu-id="25b46-140">The table contains one row with the value "MYCOMPUTER" and one row with the value "mycomputer" in this column.</span></span>  
  
     <span data-ttu-id="25b46-141">Si l'Abonné synchronise avec un nom d'hôte « poste de travail », il ne reçoit qu'une ligne car la comparaison respecte les accents (le classement de la base de données).</span><span class="sxs-lookup"><span data-stu-id="25b46-141">If the Subscriber synchronizes with a host name of "mycomputer", the Subscriber receives only one row because the comparison is case-sensitive (the collation of the database).</span></span> <span data-ttu-id="25b46-142">Si les partitions précalculées ne sont pas utilisées, l'Abonné reçoit les deux lignes, car la table dispose d'un classement qui ne respecte pas les accents.</span><span class="sxs-lookup"><span data-stu-id="25b46-142">If precomputed partitions are not used, the Subscriber receives both rows, because the table has a case-insensitive collation.</span></span>  
  
## <a name="performance-of-precomputed-partitions"></a><span data-ttu-id="25b46-143">Performances et partitions précalculées</span><span class="sxs-lookup"><span data-stu-id="25b46-143">Performance of Precomputed Partitions</span></span>  
 <span data-ttu-id="25b46-144">Les partitions précalculées engendrent une légère perte de performance lorsque les modifications sont chargées de l'Abonné au serveur de publication, mais comme la majorité du temps de traitement de fusion est passé à évaluer les partitions et à charger les modifications du serveur de publication sur l'Abonné, le gain en terme de performance peut quand même s'avérer important.</span><span class="sxs-lookup"><span data-stu-id="25b46-144">There is a small performance cost with precomputed partitions when changes are uploaded from the Subscriber to the Publisher, but the bulk of merge processing time is spent evaluating partitions and downloading changes from the Publisher to the Subscriber, so the net gain can still be significant.</span></span> <span data-ttu-id="25b46-145">L'amélioration des performances peut varier en fonction du nombre d'abonnés synchronisant simultanément, et le nombre de mises à jour par synchronisation déplaçant les lignes d'une partition à l'autre.</span><span class="sxs-lookup"><span data-stu-id="25b46-145">The performance benefit will vary, depending on the number of Subscribers synchronizing concurrently and the number of updates per synchronization that move rows from one partition to another.</span></span>  
  
## <a name="see-also"></a><span data-ttu-id="25b46-146">Voir aussi</span><span class="sxs-lookup"><span data-stu-id="25b46-146">See Also</span></span>  
 [<span data-ttu-id="25b46-147">Filtres de lignes paramétrés</span><span class="sxs-lookup"><span data-stu-id="25b46-147">Parameterized Row Filters</span></span>](parameterized-filters-parameterized-row-filters.md)  
  
  
