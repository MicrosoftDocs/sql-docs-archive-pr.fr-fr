---
title: Répliquer des colonnes d’identité | Microsoft Docs
ms.custom: ''
ms.date: 10/04/2016
ms.prod: sql-server-2014
ms.reviewer: ''
ms.technology: replication
ms.topic: conceptual
helpviewer_keywords:
- identities [SQL Server replication]
- identity values [SQL Server replication]
- merge replication [SQL Server replication], identity range management
- publishing [SQL Server replication], identity columns
- transactional replication, identity range management
- identity columns [SQL Server], replication
ms.assetid: eb2f23a8-7ec2-48af-9361-0e3cb87ebaf7
author: MashaMSFT
ms.author: mathoma
ms.openlocfilehash: c899d902e403e9f7cdbdfd1a83cde110e627ab11
ms.sourcegitcommit: ad4d92dce894592a259721a1571b1d8736abacdb
ms.translationtype: MT
ms.contentlocale: fr-FR
ms.lasthandoff: 08/04/2020
ms.locfileid: "87602049"
---
# <a name="replicate-identity-columns"></a><span data-ttu-id="485bb-102">Répliquer des colonnes d'identité</span><span class="sxs-lookup"><span data-stu-id="485bb-102">Replicate Identity Columns</span></span>
  <span data-ttu-id="485bb-103">Quand vous attribuez une propriété IDENTITY à une colonne, [!INCLUDE[msCoName](../../../includes/msconame-md.md)] [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] génère automatiquement des numéros séquentiels pour les nouvelles lignes insérées dans la table contenant la colonne d’identité.</span><span class="sxs-lookup"><span data-stu-id="485bb-103">When you assign an IDENTITY property to a column, [!INCLUDE[msCoName](../../../includes/msconame-md.md)] [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] automatically generates sequential numbers for new rows inserted in the table containing the identity column.</span></span> <span data-ttu-id="485bb-104">Pour plus d’informations, consultez [IDENTITY &#40;propriété&#41; &#40;Transact-SQL&#41;](/sql/t-sql/statements/create-table-transact-sql-identity-property).</span><span class="sxs-lookup"><span data-stu-id="485bb-104">For more information, see [IDENTITY &#40;Property&#41; &#40;Transact-SQL&#41;](/sql/t-sql/statements/create-table-transact-sql-identity-property).</span></span> <span data-ttu-id="485bb-105">Les colonnes d'identité devant être incluses comme composantes de la clé primaire, il est important d'éviter les valeurs dupliquées dans les colonnes d'identité.</span><span class="sxs-lookup"><span data-stu-id="485bb-105">Because identity columns might be included as a part of the primary key, it is important to avoid duplicate values in the identity columns.</span></span> <span data-ttu-id="485bb-106">Pour utiliser des colonnes d'identité dans une topologie de réplication qui a des mises à jour sur plusieurs nœuds, chaque nœud de cette topologie de réplication doit avoir une plage différente de valeurs d'identité, de façon à ce qu'il n'y ait pas de valeurs dupliquées.</span><span class="sxs-lookup"><span data-stu-id="485bb-106">To use identity columns in a replication topology that has updates at more than one node, each node in the replication topology must use a different range of identity values, so that duplicates do not occur.</span></span>  
  
 <span data-ttu-id="485bb-107">Par exemple, la plage 1-100 pourrait être affectée au serveur de publication, la plage 101-200 à l'abonné A et la plage 201-300 à l'abonné B.</span><span class="sxs-lookup"><span data-stu-id="485bb-107">For example, the Publisher could be assigned the range 1-100, Subscriber A the range 101-200, and Subscriber B the range 201-300.</span></span> <span data-ttu-id="485bb-108">Si une ligne est insérée au niveau du serveur de publication et la valeur d'identité est, par exemple, 65, cette valeur est répliquée sur chaque abonné.</span><span class="sxs-lookup"><span data-stu-id="485bb-108">If a row is inserted at the Publisher and the identity value is, for example, 65, that value is replicated to each Subscriber.</span></span> <span data-ttu-id="485bb-109">Quand la réplication insère des données sur chaque Abonné, elle n'incrémente pas la valeur de la colonne d'identité dans la table de l'Abonné ; c'est au contraire la valeur littérale 65 qui est insérée.</span><span class="sxs-lookup"><span data-stu-id="485bb-109">When replication inserts data at each Subscriber, it does not increment the identity column value in the Subscriber table; instead, the literal value 65 is inserted.</span></span> <span data-ttu-id="485bb-110">Seules les insertions des utilisateurs - et pas les insertions des agents de réplication - provoquent l'incrémentation de la valeur de la colonne d'identité.</span><span class="sxs-lookup"><span data-stu-id="485bb-110">Only user inserts, but not replication agent inserts cause the identity column value to be incremented.</span></span>  
  
 <span data-ttu-id="485bb-111">La réplication gère les colonnes d'identité à travers tous les types de publications et d'abonnements ; elle vous permet de gérer les colonnes manuellement ou de demander à ce que la réplication les gère automatiquement.</span><span class="sxs-lookup"><span data-stu-id="485bb-111">Replication handles identity columns across all publication and subscription types, allowing you to manage the columns manually or have replication manage them automatically.</span></span>  
  
> [!NOTE]  
>  <span data-ttu-id="485bb-112">L'ajout d'une colonne d'identité à une table publiée n'est pas pris en charge, car la nouvelle colonne peut entraîner une non-convergence quand la colonne est répliquée vers l'Abonné.</span><span class="sxs-lookup"><span data-stu-id="485bb-112">Adding an identity column to a published table is not supported, because it can result in non-convergence when the column is replicated to the Subscriber.</span></span> <span data-ttu-id="485bb-113">Les valeurs de la colonne d'identité sur l'Abonné dépendent de l'ordre dans lequel les lignes sont physiquement stockées dans la table affectée.</span><span class="sxs-lookup"><span data-stu-id="485bb-113">The values in the identity column at the Publisher depend on the order in which the rows for the affected table are physically stored.</span></span> <span data-ttu-id="485bb-114">Les lignes sont susceptibles d'être stockées différemment sur l'Abonné ; la valeur de la colonne d'identité peut donc être différente pour les mêmes lignes.</span><span class="sxs-lookup"><span data-stu-id="485bb-114">The rows might be stored differently at the Subscriber; therefore the value for the identity column can be different for the same rows.</span></span>  
  
## <a name="specifying-an-identity-range-management-option"></a><span data-ttu-id="485bb-115">Spécification d'une option de gestion des plages d'identités</span><span class="sxs-lookup"><span data-stu-id="485bb-115">Specifying an Identity Range Management Option</span></span>  
 <span data-ttu-id="485bb-116">La réplication offre trois options de gestion des plages d'identités :</span><span class="sxs-lookup"><span data-stu-id="485bb-116">Replication offers three identity range management options:</span></span>  
  
-   <span data-ttu-id="485bb-117">Automatique.</span><span class="sxs-lookup"><span data-stu-id="485bb-117">Automatic.</span></span> <span data-ttu-id="485bb-118">Utilisée pour la réplication de fusion et la réplication transactionnelle avec des mises à jour sur l'Abonné.</span><span class="sxs-lookup"><span data-stu-id="485bb-118">Used for merge replication and transactional replication with updates at the Subscriber.</span></span> <span data-ttu-id="485bb-119">Spécifiez des plages de taille pour le serveur de publication et les Abonnés, et la réplication gère automatiquement l'affectation des nouvelles plages.</span><span class="sxs-lookup"><span data-stu-id="485bb-119">Specify size ranges for the Publisher and Subscribers, and replication automatically manages the assignment of new ranges.</span></span> <span data-ttu-id="485bb-120">La réplication définit l'option NOT FOR REPLICATION pour la colonne d'identité sur l'Abonné, de sorte que seules les insertions des utilisateurs provoquent l'incrémentation de la valeur sur l'Abonné.</span><span class="sxs-lookup"><span data-stu-id="485bb-120">Replication sets the NOT FOR REPLICATION option on the identity column at the Subscriber, so that only user inserts cause the value to be incremented at the Subscriber.</span></span>  
  
    > [!NOTE]  
    >  <span data-ttu-id="485bb-121">Les Abonnés doivent se synchroniser avec le serveur de publication pour recevoir de nouvelles plages.</span><span class="sxs-lookup"><span data-stu-id="485bb-121">Subscribers must synchronize with the Publisher to receive new ranges.</span></span> <span data-ttu-id="485bb-122">Les plages d'identité étant affectées automatiquement aux Abonnés, il est possible pour les Abonnés d'épuiser la totalité des plages d'identité disponibles s'ils requièrent de nouvelles plages de façon répétée.</span><span class="sxs-lookup"><span data-stu-id="485bb-122">Because Subscribers are assigned identity ranges automatically, it is possible for any Subscriber to exhaust the entire supply of identity ranges if it repeatedly requests new ranges.</span></span>  
  
-   <span data-ttu-id="485bb-123">Manuel.</span><span class="sxs-lookup"><span data-stu-id="485bb-123">Manual.</span></span> <span data-ttu-id="485bb-124">Utilisée pour la réplication d'instantané et la réplication transactionnelle sans mises à jour sur l'Abonné, pour la réplication transactionnelle d'égal à égal ou si votre application doit contrôler les plages d'identité par programmation.</span><span class="sxs-lookup"><span data-stu-id="485bb-124">Used for snapshot and transactional replication without updates at the Subscriber, peer-to-peer transactional replication, or if your application must control identity ranges programmatically.</span></span> <span data-ttu-id="485bb-125">Si vous spécifiez une gestion manuelle, vous devez vérifier que les plages sont affectées au serveur de publication et à chaque Abonné, et que de nouvelles plages sont attribuées si les plages initiales sont utilisées.</span><span class="sxs-lookup"><span data-stu-id="485bb-125">If you specify manual management, you must ensure that ranges are assigned to the Publisher and each Subscriber and that new ranges are assigned if the initial ranges are used.</span></span> <span data-ttu-id="485bb-126">La réplication définit l'option NOT FOR REPLICATION sur la colonne d'identité sur l'Abonné.</span><span class="sxs-lookup"><span data-stu-id="485bb-126">Replication sets the NOT FOR REPLICATION option on the identity column at the Subscriber.</span></span>  
  
-   <span data-ttu-id="485bb-127">Aucun.</span><span class="sxs-lookup"><span data-stu-id="485bb-127">None.</span></span> <span data-ttu-id="485bb-128">Cette option n'est recommandée que pour assurer une compatibilité amont avec les versions antérieures de [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] et elle est disponible seulement à partir de l'interface des procédures stockées pour les publications transactionnelles.</span><span class="sxs-lookup"><span data-stu-id="485bb-128">This option is recommended only for backwards compatibility with earlier versions of [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] and is available only from the stored procedure interface for transactional publications.</span></span>  
  
 <span data-ttu-id="485bb-129">Pour spécifier une option de gestion des plages d’identité, consultez [Gestion de plages d’identités](manage-identity-columns.md).</span><span class="sxs-lookup"><span data-stu-id="485bb-129">To specify an identity range management option, see [Manage Identity Columns](manage-identity-columns.md).</span></span>  
  
## <a name="assigning-identity-ranges"></a><span data-ttu-id="485bb-130">Attribution de plages d'identité</span><span class="sxs-lookup"><span data-stu-id="485bb-130">Assigning Identity Ranges</span></span>  
 <span data-ttu-id="485bb-131">La réplication de fusion et la réplication transactionnelle utilisent différentes méthodes pour l'attribution des plages ; ces méthodes sont décrites dans cette section.</span><span class="sxs-lookup"><span data-stu-id="485bb-131">Merge replication and transactional replication use different methods for assigning ranges; these methods are described in this section.</span></span>  
  
 <span data-ttu-id="485bb-132">Il existe deux types de plages à prendre en compte lors de la réplication de colonnes d'identité : les plages attribuées au serveur de publication et aux Abonnés, et la plage du type de données de la colonne.</span><span class="sxs-lookup"><span data-stu-id="485bb-132">There are two types of ranges to take into account when replicating identity columns: the ranges assigned to the Publisher and Subscribers, and the range of the data type in the column.</span></span> <span data-ttu-id="485bb-133">Le tableau suivant indique les plages disponibles pour les types de données généralement utilisés dans les colonnes d'identité.</span><span class="sxs-lookup"><span data-stu-id="485bb-133">The following table shows the ranges available for the data types typically used in identity columns.</span></span> <span data-ttu-id="485bb-134">La plage est utilisée à travers tous les nœuds d'une topologie.</span><span class="sxs-lookup"><span data-stu-id="485bb-134">The range is used across all nodes in a topology.</span></span> <span data-ttu-id="485bb-135">Par exemple, si vous utilisez `smallint` à partir de 1 avec un incrément de 1, le nombre maximal d’insertions est de 32 767 pour le serveur de publication et pour tous les abonnés.</span><span class="sxs-lookup"><span data-stu-id="485bb-135">For example, if you use `smallint` starting at 1 with an increment of 1, the maximum number of inserts is 32,767 for the Publisher and all Subscribers.</span></span> <span data-ttu-id="485bb-136">Le nombre réel d'insertions dépend de la présence d'interruptions dans les valeurs et de l'utilisation d'une valeur de seuil.</span><span class="sxs-lookup"><span data-stu-id="485bb-136">The actual number of inserts depends on whether there are gaps in the values used and whether a threshold value is used.</span></span> <span data-ttu-id="485bb-137">Pour plus d'informations sur les seuils, consultez les sections suivantes, « Réplication de fusion » et « Réplication transactionnelle avec des abonnements mis à jour en attente ».</span><span class="sxs-lookup"><span data-stu-id="485bb-137">For more information about thresholds, see the following sections "Merge Replication" and "Transactional Replication with Queued Updating Subscriptions".</span></span>  
  
 <span data-ttu-id="485bb-138">Si le serveur de publication épuise sa plage d'identité après une insertion, il peut automatiquement attribuer une nouvelle plage si l'insertion a été effectuée par un membre du rôle de base de données fixe **db_owner** .</span><span class="sxs-lookup"><span data-stu-id="485bb-138">If the Publisher exhausts its identity range after an insert, it can automatically assign a new range if the insert was performed by a member of the **db_owner** fixed database role.</span></span> <span data-ttu-id="485bb-139">Si l’insertion a été effectuée par un utilisateur qui ne fait pas partie de ce rôle, l’Agent de lecture du journal, l’Agent de fusion ou un utilisateur qui est membre du rôle **db_owner** doit exécuter [sp_adjustpublisheridentityrange &#40;Transact-SQL&#41;](/sql/relational-databases/system-stored-procedures/sp-adjustpublisheridentityrange-transact-sql).</span><span class="sxs-lookup"><span data-stu-id="485bb-139">If the insert was performed by a user not in that role, the Log Reader Agent, Merge Agent, or a user who is a member of the **db_owner** role must run [sp_adjustpublisheridentityrange &#40;Transact-SQL&#41;](/sql/relational-databases/system-stored-procedures/sp-adjustpublisheridentityrange-transact-sql).</span></span> <span data-ttu-id="485bb-140">Pour les publications transactionnelles, l'Agent de lecture du journal doit être en cours d'exécution pour allouer automatiquement une nouvelle plage (la configuration par défaut est que l'agent s'exécute en continu).</span><span class="sxs-lookup"><span data-stu-id="485bb-140">For transactional publications, the Log Reader Agent must be running to automatically allocate a new range (the default is for the agent to run continuously).</span></span>  
  
> [!WARNING]  
>  <span data-ttu-id="485bb-141">Pendant l'insertion d'un lot volumineux, le déclencheur de réplication n'est exécuté qu'une seule fois, et non pour chaque ligne de l'insertion.</span><span class="sxs-lookup"><span data-stu-id="485bb-141">During a large batch insert the replication trigger is fired only once, not for each row of the insert.</span></span> <span data-ttu-id="485bb-142">Cela peut entraîner un échec de l'instruction d'insertion si une plage d'identités est épuisée pendant une insertion importante, telle qu'une instruction `INSERT INTO`.</span><span class="sxs-lookup"><span data-stu-id="485bb-142">This can lead to a failure of the insert statement if an identity range is exhausted during an large insert, such as an `INSERT INTO` statement.</span></span>  
  
|<span data-ttu-id="485bb-143">Type de données</span><span class="sxs-lookup"><span data-stu-id="485bb-143">Data type</span></span>|<span data-ttu-id="485bb-144">Plage</span><span class="sxs-lookup"><span data-stu-id="485bb-144">Range</span></span>|  
|---------------|-----------|  
|`tinyint`|<span data-ttu-id="485bb-145">Non pris en charge pour la gestion automatique</span><span class="sxs-lookup"><span data-stu-id="485bb-145">Not supported for automatic management</span></span>|  
|`smallint`|<span data-ttu-id="485bb-146">-2^15 (-32 768) à 2^15-1 (32 767)</span><span class="sxs-lookup"><span data-stu-id="485bb-146">-2^15 (-32,768) to 2^15-1 (32,767)</span></span>|  
|`int`|<span data-ttu-id="485bb-147">-2^31 (-2 147 483 648) à 2^31-1 (2 147 483 647)</span><span class="sxs-lookup"><span data-stu-id="485bb-147">-2^31 (-2,147,483,648) to 2^31-1 (2,147,483,647)</span></span>|  
|`bigint`|<span data-ttu-id="485bb-148">-2^63 (-9 223 372 036 854 775 808) à 2^63-1 (9 223 372 036 854 775 807)</span><span class="sxs-lookup"><span data-stu-id="485bb-148">-2^63 (-9,223,372,036,854,775,808) to 2^63-1 (9,223,372,036,854,775,807)</span></span>|  
|<span data-ttu-id="485bb-149">`decimal` et `numeric`</span><span class="sxs-lookup"><span data-stu-id="485bb-149">`decimal` and `numeric`</span></span>|<span data-ttu-id="485bb-150">-10^38+1 à 10^38-1</span><span class="sxs-lookup"><span data-stu-id="485bb-150">-10^38+1 through 10^38-1</span></span>|  
  
> [!NOTE]  
>  <span data-ttu-id="485bb-151">Pour créer un numéro à incrémentation automatique qui peut être utilisé dans plusieurs tables ou être appelé par des applications sans faire référence à une table, consultez [Numéros de séquence](../../sequence-numbers/sequence-numbers.md).</span><span class="sxs-lookup"><span data-stu-id="485bb-151">To create an automatically incrementing number that can be used in multiple tables or that can be called from applications without referencing any table, see [Sequence Numbers](../../sequence-numbers/sequence-numbers.md).</span></span>  
  
### <a name="merge-replication"></a><span data-ttu-id="485bb-152">Réplication de fusion</span><span class="sxs-lookup"><span data-stu-id="485bb-152">Merge Replication</span></span>  
 <span data-ttu-id="485bb-153">Les plages d'identité sont gérées par le serveur de publication et propagées aux Abonnés par l'Agent de fusion (dans une hiérarchie de réédition, les plages sont gérées par le serveur de publication racine et les rééditeurs).</span><span class="sxs-lookup"><span data-stu-id="485bb-153">Identity ranges are managed by the Publisher and propagated to Subscribers by the Merge Agent (in a republishing hierarchy, ranges are managed by the root Publisher and the republishers).</span></span> <span data-ttu-id="485bb-154">Les valeurs d'identité sont affectées à partir d'un pool au serveur de publication.</span><span class="sxs-lookup"><span data-stu-id="485bb-154">The identity values are assigned from a pool at the Publisher.</span></span> <span data-ttu-id="485bb-155">Quand vous ajoutez un article avec une colonne d’identité à une publication dans l’Assistant Nouvelle publication ou à l’aide de [sp_addmergearticle &#40;Transact-SQL&#41;](/sql/relational-databases/system-stored-procedures/sp-addmergearticle-transact-sql), vous spécifiez des valeurs pour :</span><span class="sxs-lookup"><span data-stu-id="485bb-155">When you add an article with an identity column to a publication in the New Publication Wizard or by using [sp_addmergearticle &#40;Transact-SQL&#41;](/sql/relational-databases/system-stored-procedures/sp-addmergearticle-transact-sql), you specify values for:</span></span>  
  
-   <span data-ttu-id="485bb-156">Le paramètre \*\* \@ identity_range\*\* , qui contrôle la taille de la plage d’identité allouée initialement au serveur de publication et aux abonnés avec les abonnements clients.</span><span class="sxs-lookup"><span data-stu-id="485bb-156">The **\@identity_range** parameter, which controls the identity range size initially allocated both to the Publisher and to Subscribers with client subscriptions.</span></span>  
  
    > [!NOTE]  
    >  <span data-ttu-id="485bb-157">Pour les abonnés exécutant des versions antérieures de [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] , ce paramètre (plutôt que le paramètre \*\* \@ pub_identity_range\*\* ) contrôle également la taille de la plage d’identité sur les abonnés de republication.</span><span class="sxs-lookup"><span data-stu-id="485bb-157">For Subscribers running previous versions of [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)], this parameter (rather than the **\@pub_identity_range** parameter) also controls the identity range size at republishing Subscribers.</span></span>  
  
-   <span data-ttu-id="485bb-158">Le paramètre \*\* \@ pub_identity_range\*\* , qui contrôle la taille de la plage d’identité pour la republication allouée aux abonnés avec des abonnements serveur (requis pour la republication des données).</span><span class="sxs-lookup"><span data-stu-id="485bb-158">The **\@pub_identity_range** parameter, which controls the identity range size for republishing allocated to Subscribers with server subscriptions (required for republishing data).</span></span> <span data-ttu-id="485bb-159">Tous les Abonnés avec des abonnements serveur reçoivent une plage pour la réédition, même s'ils ne rééditent pas réellement des données.</span><span class="sxs-lookup"><span data-stu-id="485bb-159">All Subscribers with server subscriptions receive a range for republishing, even if they don't actually republish data.</span></span>  
  
-   <span data-ttu-id="485bb-160">Le paramètre \*\* \@ Threshold\*\* , qui est utilisé pour déterminer quand une nouvelle plage d’identités est requise pour un abonnement à [!INCLUDE[ssEW](../../../includes/ssew-md.md)] ou à une version précédente de [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] .</span><span class="sxs-lookup"><span data-stu-id="485bb-160">The **\@threshold** parameter, which is used to determine when a new range of identities is required for a subscription to [!INCLUDE[ssEW](../../../includes/ssew-md.md)] or a previous version of [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)].</span></span>  
  
 <span data-ttu-id="485bb-161">Par exemple, vous pouvez spécifier 10000 pour \*\* \@ identity_range\*\* et 500000 pour \*\* \@ pub_identity_range\*\*.</span><span class="sxs-lookup"><span data-stu-id="485bb-161">For example, you could specify 10000 for **\@identity_range** and 500000 for **\@pub_identity_range**.</span></span> <span data-ttu-id="485bb-162">Une plage principale de 10 000 est assignée au serveur de publication et à tous les Abonnés qui exécutent [!INCLUDE[ssVersion2005](../../../includes/ssversion2005-md.md)] ou une version ultérieure, y compris l'Abonné avec l'abonnement serveur.</span><span class="sxs-lookup"><span data-stu-id="485bb-162">The Publisher and all Subscribers running [!INCLUDE[ssVersion2005](../../../includes/ssversion2005-md.md)] or a later version, including the Subscriber with the server subscription, are assigned a primary range of 10000.</span></span> <span data-ttu-id="485bb-163">L’abonné avec l’abonnement serveur se voit également attribuer une plage principale de 500000, qui peut être utilisée par les abonnés qui se synchronisent avec l’abonné de republication (vous devez également spécifier \*\* \@ identity_range**, \*\* \@ pub_identity_range**et \*\* \@ seuil\*\* pour les Articles de la publication sur l’abonné de republication).</span><span class="sxs-lookup"><span data-stu-id="485bb-163">The Subscriber with the server subscription is also assigned a primary range of 500000, which can be used by Subscribers that synchronize with the republishing Subscriber (you must also specify **\@identity_range**, **\@pub_identity_range**, and **\@threshold** for the articles in the publication at the republishing Subscriber).</span></span>  
  
 <span data-ttu-id="485bb-164">Chaque Abonné exécutant [!INCLUDE[ssVersion2005](../../../includes/ssversion2005-md.md)] ou une version ultérieure reçoit aussi une plage d'identités secondaire.</span><span class="sxs-lookup"><span data-stu-id="485bb-164">Each Subscriber running [!INCLUDE[ssVersion2005](../../../includes/ssversion2005-md.md)] or a later version also receives a secondary identity range.</span></span> <span data-ttu-id="485bb-165">La plage secondaire a une taille équivalente à celle de la plage principale ; quand la plage principale est épuisée, la plage secondaire est utilisée et l'Agent de fusion attribue une nouvelle plage à l'Abonné.</span><span class="sxs-lookup"><span data-stu-id="485bb-165">The secondary range is equal in size to the primary range; when the primary range is exhausted, the secondary range is used, and the Merge Agent assigns a new range to the Subscriber.</span></span> <span data-ttu-id="485bb-166">La nouvelle plage devient la plage secondaire et le processus continue tant que l'Abonné utilise des valeurs d'identité.</span><span class="sxs-lookup"><span data-stu-id="485bb-166">The new range becomes the secondary range, and the process continues as the Subscriber uses identity values.</span></span>  
  
  
### <a name="transactional-replication-with-queued-updating-subscriptions"></a><span data-ttu-id="485bb-167">Réplication transactionnelle avec des abonnements mis à jour en attente</span><span class="sxs-lookup"><span data-stu-id="485bb-167">Transactional Replication with Queued Updating Subscriptions</span></span>  
 <span data-ttu-id="485bb-168">Les plages d'identités sont gérées par le serveur de distribution et propagées aux Abonnés par l'Agent de distribution.</span><span class="sxs-lookup"><span data-stu-id="485bb-168">Identity ranges are managed by the Distributor and propagated to Subscribers by the Distribution Agent.</span></span> <span data-ttu-id="485bb-169">Les valeurs d'identité sont attribuées à partir d'un pool au serveur de distribution.</span><span class="sxs-lookup"><span data-stu-id="485bb-169">The identity values are assigned from a pool at the Distributor.</span></span> <span data-ttu-id="485bb-170">La taille du pool est basée sur la taille du type de données et sur l'incrément utilisé par la colonne d'identité.</span><span class="sxs-lookup"><span data-stu-id="485bb-170">The pool size is based on the size of the data type and the increment used for the identity column.</span></span> <span data-ttu-id="485bb-171">Quand vous ajoutez un article avec une colonne d’identité à une publication dans l’Assistant Nouvelle publication ou à l’aide de [sp_addarticle &#40;Transact-SQL&#41;](/sql/relational-databases/system-stored-procedures/sp-addarticle-transact-sql), vous spécifiez des valeurs pour :</span><span class="sxs-lookup"><span data-stu-id="485bb-171">When you add an article with an identity column to a publication in the New Publication Wizard or by using [sp_addarticle &#40;Transact-SQL&#41;](/sql/relational-databases/system-stored-procedures/sp-addarticle-transact-sql), you specify values for:</span></span>  
  
-   <span data-ttu-id="485bb-172">Le paramètre \*\* \@ identity_range\*\* , qui contrôle la taille de la plage d’identité initialement allouée à tous les abonnés.</span><span class="sxs-lookup"><span data-stu-id="485bb-172">The **\@identity_range** parameter, which controls the identity range size initially allocated to all Subscribers.</span></span>  
  
-   <span data-ttu-id="485bb-173">Le paramètre \*\* \@ pub_identity_range\*\* , qui contrôle la taille de la plage d’identité allouée au serveur de publication.</span><span class="sxs-lookup"><span data-stu-id="485bb-173">The **\@pub_identity_range** parameter, which controls the identity range size allocated to the Publisher.</span></span>  
  
-   <span data-ttu-id="485bb-174">Le paramètre \*\* \@ Threshold\*\* , qui est utilisé pour déterminer quand une nouvelle plage d’identités est requise pour un abonnement.</span><span class="sxs-lookup"><span data-stu-id="485bb-174">The **\@threshold** parameter, which is used to determine when a new range of identities is required for a subscription.</span></span>  
  
 <span data-ttu-id="485bb-175">Par exemple, vous pouvez spécifier 10000 pour \*\* \@ pub_identity_range**, 1000 pour \*\* \@ identity_range** (en supposant moins de mises à jour sur l’abonné) et 80 pour cent pour le \*\* \@ seuil\*\*.</span><span class="sxs-lookup"><span data-stu-id="485bb-175">For example, you could specify 10000 for **\@pub_identity_range**, 1000 for **\@identity_range** (assuming fewer updates at the Subscriber), and 80 percent for **\@threshold**.</span></span> <span data-ttu-id="485bb-176">Après 800 insertions sur un Abonné (80 pour cent de 1 000), un Abonné se voit attribuer une nouvelle plage.</span><span class="sxs-lookup"><span data-stu-id="485bb-176">After 800 inserts at a Subscriber (80 percent of 1000), a Subscriber is assigned a new range.</span></span> <span data-ttu-id="485bb-177">Après 8 000 insertions sur l'Abonné, le serveur de publication se voit attribuer une nouvelle plage.</span><span class="sxs-lookup"><span data-stu-id="485bb-177">After 8000 inserts at the Publisher, the Publisher is assigned a new range.</span></span> <span data-ttu-id="485bb-178">Quand une nouvelle plage est attribuée, il y aura une interruption dans les valeurs de plage d'identités de la  table.</span><span class="sxs-lookup"><span data-stu-id="485bb-178">When a new range is assigned, there will be a gap in the identity range values in the table.</span></span> <span data-ttu-id="485bb-179">La spécification d'un seuil plus élevé donne des interruptions plus courtes, mais le système tolère moins les pannes : si l'agent de distribution ne peut pas être exécuté pour une raison quelconque, un abonné peut tomber plus facilement à court d'identités.</span><span class="sxs-lookup"><span data-stu-id="485bb-179">Specifying a higher threshold results in smaller gaps, but the system is less fault-tolerant: if the Distribution Agent cannot run for some reason, a Subscriber could more easily run out of identities.</span></span>  
  
## <a name="assigning-ranges-for-manual-identity-range-management"></a><span data-ttu-id="485bb-180">Attribution de plages pour la gestion manuelle des plages d'identité</span><span class="sxs-lookup"><span data-stu-id="485bb-180">Assigning ranges for manual identity range management</span></span>  
 <span data-ttu-id="485bb-181">Si vous spécifiez une gestion manuelle des plages d'identité, vous devez vérifier que le serveur de publication et que chaque Abonné utilisent des plages d'identités différentes.</span><span class="sxs-lookup"><span data-stu-id="485bb-181">If you specify manual identity range management, you must ensure that the Publisher and each Subscriber use different identity ranges.</span></span> <span data-ttu-id="485bb-182">Par exemple, supposons une table sur le serveur de publication avec une colonne d'identité définié en tant que `IDENTITY(1,1)`: la colonne d'identité commence à 1 et elle est incrémentée de 1 chaque fois qu'une ligne est insérée.</span><span class="sxs-lookup"><span data-stu-id="485bb-182">For example, consider a table at the Publisher with an identity column defined as `IDENTITY(1,1)`: the identity column starts at 1 and is incremented by 1 each time a row is inserted.</span></span> <span data-ttu-id="485bb-183">Si la table sur le serveur de publication a 5 000 lignes et que vous vous attendez à un accroissement de la table au cours de la durée de vie de l'application, le serveur de publication peut utiliser la plage 1 à 10 000.</span><span class="sxs-lookup"><span data-stu-id="485bb-183">If the table at the Publisher has 5,000 rows, and you expect some growth in the table over the life of the application, the Publisher could use the range 1-10,000.</span></span> <span data-ttu-id="485bb-184">Étant donnés deux Abonnés, l’Abonné A peut utiliser la plage 10 001 à 20 000 et l’Abonné B peut utiliser la plage 20 001 à 30 000.</span><span class="sxs-lookup"><span data-stu-id="485bb-184">Given two Subscribers, Subscriber A could use 10,001-20,000, and Subscriber B could use 20,001-30,000.</span></span>  
  
 <span data-ttu-id="485bb-185">Après qu'un Abonné ait été initialisé avec un instantané ou via un autre moyen, exécutez DBCC CHECKIDENT pour attribuer un point de départ pour sa plage d'identités.</span><span class="sxs-lookup"><span data-stu-id="485bb-185">After a Subscriber is initialized with a snapshot or through another means, execute DBCC CHECKIDENT to assign the Subscriber a starting point for its identity range.</span></span> <span data-ttu-id="485bb-186">Par exemple, sur l'Abonné A, vous pouvez exécuter `DBCC CHECKIDENT('<TableName>','reseed',10001)`.</span><span class="sxs-lookup"><span data-stu-id="485bb-186">For example, at Subscriber A, you would execute `DBCC CHECKIDENT('<TableName>','reseed',10001)`.</span></span> <span data-ttu-id="485bb-187">Sur l'Abonné B, vous pouvez exécuter `CHECKIDENT('<TableName>','reseed',20001)`.</span><span class="sxs-lookup"><span data-stu-id="485bb-187">At Subscriber B, you would execute `CHECKIDENT('<TableName>','reseed',20001)`.</span></span>  
  
 <span data-ttu-id="485bb-188">Pour attribuer de nouvelles plages au serveur de publication ou aux Abonnés, exécutez DBCC CHECKIDENT et spécifiez une nouvelle valeur permettant de réalimenter la table.</span><span class="sxs-lookup"><span data-stu-id="485bb-188">To assign new ranges to the Publisher or Subscribers, execute DBCC CHECKIDENT and specify a new value to reseed the table.</span></span> <span data-ttu-id="485bb-189">Vous devez disposer d'un moyen quelconque pour déterminer quand une nouvelle plage doit être attribuée.</span><span class="sxs-lookup"><span data-stu-id="485bb-189">You should have some way to determine when a new range must be assigned.</span></span> <span data-ttu-id="485bb-190">Par exemple, votre application peut avoir un mécanisme détectant quand un nœud est sur le point d'utiliser la totalité de sa plage et attribuant une nouvelle plage à l'aide de DBCC CHECKIDENT.</span><span class="sxs-lookup"><span data-stu-id="485bb-190">For example, your application could have a mechanism that detects when a node is about to use up its range and assign a new range using DBCC CHECKIDENT.</span></span> <span data-ttu-id="485bb-191">Vous pouvez aussi ajouter une contrainte de vérification pour garantir qu'une ligne ne peut pas être ajoutée si une valeur de colonne d'identité en dehors de la page devait être utilisée.</span><span class="sxs-lookup"><span data-stu-id="485bb-191">You can also add a check constraint to ensure that a row cannot be added if it would cause an out of range identity value to be used.</span></span>  
  
## <a name="handling-identity-ranges-after-a-database-restore"></a><span data-ttu-id="485bb-192">Gestion des plages d'identités après la restauration d'une base de données</span><span class="sxs-lookup"><span data-stu-id="485bb-192">Handling Identity Ranges after a Database Restore</span></span>  
 <span data-ttu-id="485bb-193">Si vous utilisez la gestion automatique des plages d'identités, quand un Abonné est restauré à partir d'une sauvegarde, il requiert automatiquement une nouvelle plage de valeurs d'identité.</span><span class="sxs-lookup"><span data-stu-id="485bb-193">If you are using automatic identity range management, when a Subscriber is restored from a backup, it automatically requests a new range of identity values.</span></span> <span data-ttu-id="485bb-194">Si un serveur de publication est restauré à partir d'une sauvegarde, vous devez vérifier que le serveur de publication se voit attribuer une plage appropriée.</span><span class="sxs-lookup"><span data-stu-id="485bb-194">If a Publisher is restored from a backup, you must ensure that the Publisher is assigned an appropriate range.</span></span> <span data-ttu-id="485bb-195">Pour la réplication de fusion, attribuez une nouvelle plage à l’aide de [sp_restoremergeidentityrange &#40;Transact-SQL&#41;](/sql/relational-databases/system-stored-procedures/sp-restoremergeidentityrange-transact-sql).</span><span class="sxs-lookup"><span data-stu-id="485bb-195">For merge replication, assign a new range using [sp_restoremergeidentityrange &#40;Transact-SQL&#41;](/sql/relational-databases/system-stored-procedures/sp-restoremergeidentityrange-transact-sql).</span></span> <span data-ttu-id="485bb-196">Pour la réplication transactionnelle, déterminez la valeur la plus élevée qui a été utilisée, puis définissez le point de départ pour les nouvelles plages.</span><span class="sxs-lookup"><span data-stu-id="485bb-196">For transactional replication, determine the highest value that has been used and then set the starting point for new ranges.</span></span> <span data-ttu-id="485bb-197">Utilisez la procédure suivante après que la base de données de publication ait été restaurée :</span><span class="sxs-lookup"><span data-stu-id="485bb-197">Use the following procedure after the publication database has been restored:</span></span>  
  
1.  <span data-ttu-id="485bb-198">Arrêtez toutes les activités sur tous les Abonnés.</span><span class="sxs-lookup"><span data-stu-id="485bb-198">Stop all activity on all Subscribers.</span></span>  
  
2.  <span data-ttu-id="485bb-199">Pour chaque table publiée comportant une colonne d'identité :</span><span class="sxs-lookup"><span data-stu-id="485bb-199">For each published table that includes an identity column:</span></span>  
  
    1.  <span data-ttu-id="485bb-200">Dans la base de données d'abonnement sur chaque Abonné, exécutez `IDENT_CURRENT('<TableName>')`.</span><span class="sxs-lookup"><span data-stu-id="485bb-200">In the subscription database at each Subscriber, execute `IDENT_CURRENT('<TableName>')`.</span></span>  
  
    2.  <span data-ttu-id="485bb-201">Enregistrez la valeur la plus élevée trouvée parmi tous les Abonnés.</span><span class="sxs-lookup"><span data-stu-id="485bb-201">Record the highest value found across all Subscribers.</span></span>  
  
    3.  <span data-ttu-id="485bb-202">Dans la base de données de publication sur le serveur de publication, exécutez `DBCC CHECKIDENT(<TableName>','reseed',<HighestValueFound+1>`.</span><span class="sxs-lookup"><span data-stu-id="485bb-202">In the publication database at the Publisher, execute `DBCC CHECKIDENT(<TableName>','reseed',<HighestValueFound+1>`).</span></span>  
  
    4.  <span data-ttu-id="485bb-203">Dans la base de données de publication sur le serveur de publication, exécutez `sp_adjustpublisheridentityrange <PublicationName>, <TableName>`.</span><span class="sxs-lookup"><span data-stu-id="485bb-203">In the publication database at the Publisher, execute `sp_adjustpublisheridentityrange <PublicationName>, <TableName>`.</span></span>  
  
    > [!NOTE]  
    >  <span data-ttu-id="485bb-204">Si la valeur de la colonne d'identité est définie pour se décrémenter au lieu de s'incrémenter, enregistrez la valeur la plus faible, puis réalimentez la table avec cette valeur.</span><span class="sxs-lookup"><span data-stu-id="485bb-204">If the value in the identity column is set to decrement rather than increment, record the lowest value found, and then reseed with that value.</span></span>  
  
## <a name="see-also"></a><span data-ttu-id="485bb-205">Voir aussi</span><span class="sxs-lookup"><span data-stu-id="485bb-205">See Also</span></span>  
 <span data-ttu-id="485bb-206">[BACKUP &#40;Transact-SQL&#41;](/sql/t-sql/statements/backup-transact-sql) </span><span class="sxs-lookup"><span data-stu-id="485bb-206">[BACKUP &#40;Transact-SQL&#41;](/sql/t-sql/statements/backup-transact-sql) </span></span>  
 <span data-ttu-id="485bb-207">[DBCC CHECKIDENT &#40;Transact-SQL&#41;](/sql/t-sql/database-console-commands/dbcc-checkident-transact-sql) </span><span class="sxs-lookup"><span data-stu-id="485bb-207">[DBCC CHECKIDENT &#40;Transact-SQL&#41;](/sql/t-sql/database-console-commands/dbcc-checkident-transact-sql) </span></span>  
 <span data-ttu-id="485bb-208">[IDENT_CURRENT &#40;Transact-SQL&#41;](/sql/t-sql/functions/ident-current-transact-sql) </span><span class="sxs-lookup"><span data-stu-id="485bb-208">[IDENT_CURRENT &#40;Transact-SQL&#41;](/sql/t-sql/functions/ident-current-transact-sql) </span></span>  
 <span data-ttu-id="485bb-209">[IDENTITY, propriété &#40;Transact-SQL&#41;](/sql/t-sql/statements/create-table-transact-sql-identity-property) </span><span class="sxs-lookup"><span data-stu-id="485bb-209">[IDENTITY &#40;Property&#41; &#40;Transact-SQL&#41;](/sql/t-sql/statements/create-table-transact-sql-identity-property) </span></span>  
 [<span data-ttu-id="485bb-210">sp_adjustpublisheridentityrange &#40;Transact-SQL&#41;</span><span class="sxs-lookup"><span data-stu-id="485bb-210">sp_adjustpublisheridentityrange &#40;Transact-SQL&#41;</span></span>](/sql/relational-databases/system-stored-procedures/sp-adjustpublisheridentityrange-transact-sql)  
  
  
