---
title: Remettre un instantané via FTP | Microsoft Docs
ms.custom: ''
ms.date: 06/13/2017
ms.prod: sql-server-2014
ms.reviewer: ''
ms.technology: replication
ms.topic: conceptual
helpviewer_keywords:
- snapshots [SQL Server replication], FTP snapshots
- FTP snapshots [SQL Server replication]
- snapshot replication [SQL Server], FTP
ms.assetid: 99872c4f-40ce-4405-8fd4-44052d3bd827
author: MashaMSFT
ms.author: mathoma
ms.openlocfilehash: 2e6700e6989a5a7e32202a0710bc663978a136cf
ms.sourcegitcommit: ad4d92dce894592a259721a1571b1d8736abacdb
ms.translationtype: MT
ms.contentlocale: fr-FR
ms.lasthandoff: 08/04/2020
ms.locfileid: "87602065"
---
# <a name="deliver-a-snapshot-through-ftp"></a><span data-ttu-id="338a2-102">Remettre un instantané via FTP</span><span class="sxs-lookup"><span data-stu-id="338a2-102">Deliver a Snapshot Through FTP</span></span>
  <span data-ttu-id="338a2-103">Cette rubrique explique comment remettre un instantané via FTP dans [!INCLUDE[ssCurrent](../../../includes/sscurrent-md.md)] à l'aide de [!INCLUDE[ssManStudioFull](../../../includes/ssmanstudiofull-md.md)] ou de [!INCLUDE[tsql](../../../includes/tsql-md.md)].</span><span class="sxs-lookup"><span data-stu-id="338a2-103">This topic describes how to deliver a snapshot through FTP in [!INCLUDE[ssCurrent](../../../includes/sscurrent-md.md)] by using [!INCLUDE[ssManStudioFull](../../../includes/ssmanstudiofull-md.md)] or [!INCLUDE[tsql](../../../includes/tsql-md.md)].</span></span>  
  
##  <a name="limitations-and-restrictions"></a><a name="Restrictions"></a> <span data-ttu-id="338a2-104">Limitations et restrictions</span><span class="sxs-lookup"><span data-stu-id="338a2-104">Limitations and Restrictions</span></span>  
  
-   <span data-ttu-id="338a2-105">L'Agent d'instantané doit posséder des autorisations en écriture sur le répertoire spécifié et les Agents de distribution et de fusion des autorisations en lecture.</span><span class="sxs-lookup"><span data-stu-id="338a2-105">The Snapshot Agent must have write permissions for the directory you specify, and the Distribution Agent or Merge Agent must have read permissions.</span></span> <span data-ttu-id="338a2-106">Si vous utilisez des abonnements extraits, vous devez définir un répertoire partagé en tant que chemin UNC, par exemple \\\ftpserver\home\snapshots.</span><span class="sxs-lookup"><span data-stu-id="338a2-106">If pull subscriptions are used, you must specify a shared directory as a universal naming convention (UNC) path, such as \\\ftpserver\home\snapshots.</span></span> <span data-ttu-id="338a2-107">Pour plus d’informations, consultez [Sécuriser le dossier d’instantanés](../security/secure-the-snapshot-folder.md).</span><span class="sxs-lookup"><span data-stu-id="338a2-107">For more information, see [Secure the Snapshot Folder](../security/secure-the-snapshot-folder.md).</span></span>  
  
###  <a name="prerequisites"></a><a name="Prerequisites"></a> <span data-ttu-id="338a2-108">Conditions préalables</span><span class="sxs-lookup"><span data-stu-id="338a2-108">Prerequisites</span></span>  
  
-   <span data-ttu-id="338a2-109">Pour transférer des fichiers d'instantanés via FTP (File Transfer Protocol), vous devez avant tout configurer un serveur FTP.</span><span class="sxs-lookup"><span data-stu-id="338a2-109">To transfer snapshot files using File Transfer Protocol (FTP), you must first configure an FTP server.</span></span> <span data-ttu-id="338a2-110">Pour plus d'informations, consultez la documentation de [!INCLUDE[msCoName](../../../includes/msconame-md.md)] Internet Information Services (IIS).</span><span class="sxs-lookup"><span data-stu-id="338a2-110">For more information, see the [!INCLUDE[msCoName](../../../includes/msconame-md.md)] Internet Information Services (IIS) documentation.</span></span>  
  
###  <a name="security"></a><a name="Security"></a> <span data-ttu-id="338a2-111">Sécurité</span><span class="sxs-lookup"><span data-stu-id="338a2-111">Security</span></span>  
 <span data-ttu-id="338a2-112">Pour améliorer la sécurité, nous vous recommandons d'implémenter un réseau privé virtuel (VPN) lorsque vous utilisez la remise d'instantanés via FTP sur Internet.</span><span class="sxs-lookup"><span data-stu-id="338a2-112">To help improve security, we recommend that you implement a virtual private network (VPN) when using FTP snapshot delivery over the Internet.</span></span> <span data-ttu-id="338a2-113">Pour plus d’informations, consultez [Publier des données sur Internet à l’aide d’un réseau privé virtuel](../publish-data-over-the-internet-using-vpn.md).</span><span class="sxs-lookup"><span data-stu-id="338a2-113">For more information, see [Publish Data over the Internet Using VPN](../publish-data-over-the-internet-using-vpn.md).</span></span>  
  
 <span data-ttu-id="338a2-114">La méthode de sécurité conseillée consiste à désactiver l'accès anonyme au serveur FTP.</span><span class="sxs-lookup"><span data-stu-id="338a2-114">As a security best practice, do not allow anonymous logins to the FTP server.</span></span> <span data-ttu-id="338a2-115">L'Agent d'instantané doit posséder des autorisations en écriture sur le répertoire spécifié et les Agents de distribution et de fusion des autorisations en lecture.</span><span class="sxs-lookup"><span data-stu-id="338a2-115">The Snapshot Agent must have write permissions for the directory you specify, and the Distribution Agent or Merge Agent must have read permissions.</span></span> <span data-ttu-id="338a2-116">Si vous utilisez des abonnements extraits, vous devez définir un répertoire partagé en tant que chemin UNC, par exemple \\\ftpserver\home\snapshots.</span><span class="sxs-lookup"><span data-stu-id="338a2-116">If pull subscriptions are used, you must specify a shared directory as a universal naming convention (UNC) path, such as \\\ftpserver\home\snapshots.</span></span> <span data-ttu-id="338a2-117">Pour plus d’informations, consultez [Sécuriser le dossier d’instantanés](../security/secure-the-snapshot-folder.md).</span><span class="sxs-lookup"><span data-stu-id="338a2-117">For more information, see [Secure the Snapshot Folder](../security/secure-the-snapshot-folder.md).</span></span>  
  
 <span data-ttu-id="338a2-118">Lorsque cela est possible, invitez les utilisateurs à saisir leurs informations d'identification au moment de l'exécution.</span><span class="sxs-lookup"><span data-stu-id="338a2-118">When possible, prompt users to enter their credentials at runtime.</span></span> <span data-ttu-id="338a2-119">Si vous stockez les informations d'identification dans un fichier de script, vous devez sécuriser ce fichier.</span><span class="sxs-lookup"><span data-stu-id="338a2-119">If you store credentials in a script file, you must secure the file.</span></span>  
  
##  <a name="using-sql-server-management-studio"></a><a name="SSMSProcedure"></a> <span data-ttu-id="338a2-120">Utilisation de SQL Server Management Studio</span><span class="sxs-lookup"><span data-stu-id="338a2-120">Using SQL Server Management Studio</span></span>  
 <span data-ttu-id="338a2-121">Après avoir configuré le serveur FTP, spécifiez des informations de répertoire et de sécurité pour ce serveur dans la boîte de dialogue **Propriétés de la publication\<Publication>** .</span><span class="sxs-lookup"><span data-stu-id="338a2-121">After the FTP server is configured, specify directory and security information for this server in the **Publication Properties \<Publication>** dialog box.</span></span> <span data-ttu-id="338a2-122">Pour plus d'informations sur l'accès à cette boîte de dialogue, consultez [Afficher et modifier les propriétés d’un serveur de publication](view-and-modify-publication-properties.md).</span><span class="sxs-lookup"><span data-stu-id="338a2-122">For more information about accessing this dialog box, see [View and Modify Publication Properties](view-and-modify-publication-properties.md).</span></span>  
  
#### <a name="to-specify-ftp-information"></a><span data-ttu-id="338a2-123">Pour spécifier des informations FTP</span><span class="sxs-lookup"><span data-stu-id="338a2-123">To specify FTP information</span></span>  
  
1.  <span data-ttu-id="338a2-124">Dans la boîte de dialogue **Propriétés de la publication - \<Publication>** , sélectionnez **Autoriser les abonnés à télécharger des fichiers d'instantanés via le protocole FTP (File Transfer Protocol)** dans l'une des pages suivantes :</span><span class="sxs-lookup"><span data-stu-id="338a2-124">In the **Publication Properties - \<Publication>** dialog box, select **Allow Subscribers to download snapshot files using FTP** from one of the following pages:</span></span>   
    -   <span data-ttu-id="338a2-125">Page **Instantané FTP**, pour les publications transactionnelles et d’instantané ainsi que les publications de fusion pour les serveurs de publication exécutant des versions antérieures à [!INCLUDE[msCoName](../../../includes/msconame-md.md)] [!INCLUDE[ssVersion2005](../../../includes/ssversion2005-md.md)].</span><span class="sxs-lookup"><span data-stu-id="338a2-125">The **FTP Snapshot** page, for snapshot and transactional publications, and merge publications for Publishers running versions prior to [!INCLUDE[msCoName](../../../includes/msconame-md.md)] [!INCLUDE[ssVersion2005](../../../includes/ssversion2005-md.md)].</span></span>    
    -   <span data-ttu-id="338a2-126">Page **Instantané FTP et Internet** , pour les publications de fusion des serveurs de publication exécutant [!INCLUDE[ssVersion2005](../../../includes/ssversion2005-md.md)] ou ultérieur.</span><span class="sxs-lookup"><span data-stu-id="338a2-126">The **FTP Snapshot and Internet** page, for merge publications from Publishers running [!INCLUDE[ssVersion2005](../../../includes/ssversion2005-md.md)] or later.</span></span>    
2.  <span data-ttu-id="338a2-127">Spécifiez des valeurs dans les zones de texte **Nom du serveur FTP**, **Numéro de port**, **Chemin d'accès au dossier racine FTP**, **Nom de connexion**et **Mot de passe**.</span><span class="sxs-lookup"><span data-stu-id="338a2-127">Specify values for **FTP server name**, **Port number**, **Path from the FTP root folder**, **Login**, and **Password**.</span></span>    
     <span data-ttu-id="338a2-128">Si, par exemple la racine du serveur FTP est \\\ftpserver\home et que vous souhaitez stocker les instantanés dans \\\ftpserver\home\snapshots, spécifiez \snapshots\ftp pour la propriété **Chemin d’accès au dossier racine FTP** (la réplication ajoute « ftp » au chemin d’accès au dossier d’instantanés lorsqu’il crée les fichiers d’instantanés).</span><span class="sxs-lookup"><span data-stu-id="338a2-128">For example, if the FTP server root is \\\ftpserver\home and you want snapshots to be stored at \\\ftpserver\home\snapshots, specify \snapshots\ftp for the property **Path from the FTP root folder** (replication appends 'ftp' to the snapshot folder path when it creates snapshot files).</span></span>    
3.  <span data-ttu-id="338a2-129">Spécifiez que l'Agent d'instantané doit écrire les fichiers d'instantanés dans le répertoire défini à l'étape 2.</span><span class="sxs-lookup"><span data-stu-id="338a2-129">Specify that the Snapshot Agent should write the snapshot files to the directory specified in step 2.</span></span> <span data-ttu-id="338a2-130">Par exemple, pour que l’Agent d’instantané écrive les fichiers d’instantanés dans \\\ftpserver\home\snapshots\ftp, vous devez définir le chemin \\\ftpserver\home\snapshots dans l’un ou l’autre emplacement :</span><span class="sxs-lookup"><span data-stu-id="338a2-130">For example, to have the Snapshot Agent write the snapshot files to \\\ftpserver\home\snapshots\ftp, you must specify the path \\\ftpserver\home\snapshots in one of two places:</span></span>    
    -   <span data-ttu-id="338a2-131">Emplacement des instantanés par défaut sur le serveur de distribution associé à cette publication.</span><span class="sxs-lookup"><span data-stu-id="338a2-131">The default snapshot location for the Distributor associated with this publication.</span></span>    
         <span data-ttu-id="338a2-132">Pour plus d’informations sur la spécification de l’emplacement par défaut des instantanés, consultez [spécifier l’emplacement par défaut des instantanés](../snapshot-options.md#snapshot-folder-locations).</span><span class="sxs-lookup"><span data-stu-id="338a2-132">For more information about specifying the default snapshot location, see [Specify the Default Snapshot Location](../snapshot-options.md#snapshot-folder-locations).</span></span>    
    -   <span data-ttu-id="338a2-133">Autre emplacement de dossier d'instantanés pour cette publication.</span><span class="sxs-lookup"><span data-stu-id="338a2-133">An alternate snapshot folder location for this publication.</span></span> <span data-ttu-id="338a2-134">Un autre emplacement est requis si l'instantané est compressé.</span><span class="sxs-lookup"><span data-stu-id="338a2-134">An alternate location is required if the snapshot is compressed.</span></span>    
         <span data-ttu-id="338a2-135">Entrez le chemin d’accès dans la zone de texte **Placer les fichiers dans le dossier suivant** de la page instantané de la boîte de dialogue Propriétés de la \*\*publication- \<Publication> \*\* .</span><span class="sxs-lookup"><span data-stu-id="338a2-135">Enter the path in the **Put files in the following folder** textbox on the Snapshot page of the **Publication Properties - \<Publication>** dialog box.</span></span>   
4.  [!INCLUDE[clickOK](../../../includes/clickok-md.md)]  
  
##  <a name="using-transact-sql"></a><a name="TsqlProcedure"></a> <span data-ttu-id="338a2-136">Utilisation de Transact-SQL</span><span class="sxs-lookup"><span data-stu-id="338a2-136">Using Transact-SQL</span></span>  
 <span data-ttu-id="338a2-137">L'option permettant de rendre disponibles sur un serveur FTP des fichiers d'instantanés peut être définie et ces paramètres FTP peuvent être modifiés par programme en utilisant des procédures stockées de réplication.</span><span class="sxs-lookup"><span data-stu-id="338a2-137">The option to make snapshot files available on an FTP server can be set and these FTP settings can be modified programmatically using replication stored procedures.</span></span> <span data-ttu-id="338a2-138">La procédure utilisée dépend du type de publication.</span><span class="sxs-lookup"><span data-stu-id="338a2-138">The procedure used depends on the type of publication.</span></span> <span data-ttu-id="338a2-139">La remise d'instantanés via FTP est utilisée uniquement avec les abonnements par extraction.</span><span class="sxs-lookup"><span data-stu-id="338a2-139">FTP snapshot delivery is only used with pull subscriptions.</span></span>  
  
#### <a name="to-enable-ftp-snapshot-delivery-for-a-snapshot-or-transactional-publication"></a><span data-ttu-id="338a2-140">Pour activer la remise d'instantanés via FTP pour une publication transactionnelle ou d'instantané</span><span class="sxs-lookup"><span data-stu-id="338a2-140">To enable FTP snapshot delivery for a snapshot or transactional publication</span></span>  
  
1.  <span data-ttu-id="338a2-141">Dans la base de données de publication sur le serveur de publication, exécutez [sp_addpublication](/sql/relational-databases/system-stored-procedures/sp-addpublication-transact-sql).</span><span class="sxs-lookup"><span data-stu-id="338a2-141">At the Publisher on the publication database, execute [sp_addpublication](/sql/relational-databases/system-stored-procedures/sp-addpublication-transact-sql).</span></span> <span data-ttu-id="338a2-142">Spécifiez **@publication** , la valeur `true` pour **@enabled_for_internet** et les valeurs appropriées pour les paramètres suivants :</span><span class="sxs-lookup"><span data-stu-id="338a2-142">Specify **@publication**, a value of `true` for **@enabled_for_internet**, and appropriate values for the following parameters:</span></span>    
    -   <span data-ttu-id="338a2-143">**@ftp_address**: adresse du serveur FTP utilisé pour remettre l’instantané.</span><span class="sxs-lookup"><span data-stu-id="338a2-143">**@ftp_address** - the address of the FTP server used to deliver the snapshot.</span></span>    
    -   <span data-ttu-id="338a2-144">(Facultatif) **@ftp_port** -le port utilisé par le serveur FTP.</span><span class="sxs-lookup"><span data-stu-id="338a2-144">(Optional) **@ftp_port** - the port used by the FTP server.</span></span>    
    -   <span data-ttu-id="338a2-145">(Facultatif) **@ftp_subdirectory** -le sous-répertoire du répertoire FTP par défaut affecté à une connexion FTP.</span><span class="sxs-lookup"><span data-stu-id="338a2-145">(Optional) **@ftp_subdirectory** - the subdirectory of the default FTP directory assigned to an FTP login.</span></span> <span data-ttu-id="338a2-146">Par exemple, si la racine du serveur FTP est \\ \ftpserver\home et que vous souhaitez stocker les instantanés dans \\ \ftpserver\home\snapshots, spécifiez **\snapshots\ftp** pour **@ftp_subdirectory** (la réplication ajoute « FTP » au chemin d’accès du dossier d’instantanés lorsqu’il crée des fichiers d’instantanés).</span><span class="sxs-lookup"><span data-stu-id="338a2-146">For example, if the FTP server root is \\\ftpserver\home and you want snapshots to be stored at \\\ftpserver\home\snapshots, specify **\snapshots\ftp** for **@ftp_subdirectory** (replication appends 'ftp' to the snapshot folder path when it creates snapshot files).</span></span>    
    -   <span data-ttu-id="338a2-147">(Facultatif) **@ftp_login** -un compte de connexion utilisé lors de la connexion au serveur FTP.</span><span class="sxs-lookup"><span data-stu-id="338a2-147">(Optional) **@ftp_login** - a login account used when connecting to the FTP server.</span></span>    
    -   <span data-ttu-id="338a2-148">(Facultatif) **@ftp_password** : mot de passe de la connexion FTP.</span><span class="sxs-lookup"><span data-stu-id="338a2-148">(Optional) **@ftp_password** - the password for the FTP login.</span></span>  
  
     <span data-ttu-id="338a2-149">Une publication qui utilise FTP est alors créée.</span><span class="sxs-lookup"><span data-stu-id="338a2-149">This creates a publication that uses FTP.</span></span> <span data-ttu-id="338a2-150">Pour plus d’informations, voir [Create a Publication](create-a-publication.md).</span><span class="sxs-lookup"><span data-stu-id="338a2-150">For more information, see [Create a Publication](create-a-publication.md).</span></span>  
  
#### <a name="to-enable-ftp-snapshot-delivery-for-a-merge-publication"></a><span data-ttu-id="338a2-151">Pour activer la remise d'instantanés via FTP pour une publication de fusion</span><span class="sxs-lookup"><span data-stu-id="338a2-151">To enable FTP snapshot delivery for a merge publication</span></span>  
  
1.  <span data-ttu-id="338a2-152">Dans la base de données de publication sur le serveur de publication, exécutez [sp_addmergepublication](/sql/relational-databases/system-stored-procedures/sp-addmergepublication-transact-sql).</span><span class="sxs-lookup"><span data-stu-id="338a2-152">At the Publisher on the publication database, execute [sp_addmergepublication](/sql/relational-databases/system-stored-procedures/sp-addmergepublication-transact-sql).</span></span> <span data-ttu-id="338a2-153">Spécifiez **@publication** , la valeur `true` pour **@enabled_for_internet** et les valeurs appropriées pour les paramètres suivants :</span><span class="sxs-lookup"><span data-stu-id="338a2-153">Specify **@publication**, a value of `true` for **@enabled_for_internet** and appropriate values for the following parameters:</span></span>  
  
    -   <span data-ttu-id="338a2-154">**@ftp_address**: adresse du serveur FTP utilisé pour remettre l’instantané.</span><span class="sxs-lookup"><span data-stu-id="338a2-154">**@ftp_address** - the address of the FTP server used to deliver the snapshot.</span></span>    
    -   <span data-ttu-id="338a2-155">(Facultatif) **@ftp_port** -le port utilisé par le serveur FTP.</span><span class="sxs-lookup"><span data-stu-id="338a2-155">(Optional) **@ftp_port** - the port used by the FTP server.</span></span>    
    -   <span data-ttu-id="338a2-156">(Facultatif) **@ftp_subdirectory** -le sous-répertoire du répertoire FTP par défaut affecté à une connexion FTP.</span><span class="sxs-lookup"><span data-stu-id="338a2-156">(Optional) **@ftp_subdirectory** - the subdirectory of the default FTP directory assigned to an FTP login.</span></span> <span data-ttu-id="338a2-157">Par exemple, si la racine du serveur FTP est \\ \ftpserver\home et que vous souhaitez stocker les instantanés dans \\ \ftpserver\home\snapshots, spécifiez **\snapshots\ftp** pour **@ftp_subdirectory** (la réplication ajoute « FTP » au chemin d’accès du dossier d’instantanés lorsqu’il crée des fichiers d’instantanés).</span><span class="sxs-lookup"><span data-stu-id="338a2-157">For example, if the FTP server root is \\\ftpserver\home and you want snapshots to be stored at \\\ftpserver\home\snapshots, specify **\snapshots\ftp** for **@ftp_subdirectory** (replication appends 'ftp' to the snapshot folder path when it creates snapshot files).</span></span>    
    -   <span data-ttu-id="338a2-158">(Facultatif) **@ftp_login** -un compte de connexion utilisé lors de la connexion au serveur FTP.</span><span class="sxs-lookup"><span data-stu-id="338a2-158">(Optional) **@ftp_login** - a login account used when connecting to the FTP server.</span></span>    
    -   <span data-ttu-id="338a2-159">(Facultatif) **@ftp_password** : mot de passe de la connexion FTP.</span><span class="sxs-lookup"><span data-stu-id="338a2-159">(Optional) **@ftp_password** - the password for the FTP login.</span></span>  
  
     <span data-ttu-id="338a2-160">Une publication qui utilise FTP est alors créée.</span><span class="sxs-lookup"><span data-stu-id="338a2-160">This creates a publication that uses FTP.</span></span> <span data-ttu-id="338a2-161">Pour plus d’informations, voir [Create a Publication](create-a-publication.md).</span><span class="sxs-lookup"><span data-stu-id="338a2-161">For more information, see [Create a Publication](create-a-publication.md).</span></span>  
  
#### <a name="to-create-a-pull-subscription-to-a-snapshot-or-transactional-publication-that-uses-ftp-snapshot-delivery"></a><span data-ttu-id="338a2-162">Pour créer un abonnement par extraction vers une publication transactionnelle ou d'instantané qui utilise la remise d'instantanés via FTP</span><span class="sxs-lookup"><span data-stu-id="338a2-162">To create a pull subscription to a snapshot or transactional publication that uses FTP snapshot delivery</span></span>  
  
1.  <span data-ttu-id="338a2-163">Dans la base de données d'abonnement de l'Abonné, exécutez [sp_addpullsubscription](/sql/relational-databases/system-stored-procedures/sp-addpullsubscription-transact-sql).</span><span class="sxs-lookup"><span data-stu-id="338a2-163">At the Subscriber on the subscription database, execute [sp_addpullsubscription](/sql/relational-databases/system-stored-procedures/sp-addpullsubscription-transact-sql).</span></span> <span data-ttu-id="338a2-164">Spécifiez **@publisher** et **@publication** .</span><span class="sxs-lookup"><span data-stu-id="338a2-164">Specify **@publisher** and **@publication**.</span></span>  
  
    -   <span data-ttu-id="338a2-165">Dans la base de données d'abonnement de l'Abonné, exécutez [sp_addpullsubscription_agent](/sql/relational-databases/system-stored-procedures/sp-addpullsubscription-agent-transact-sql).</span><span class="sxs-lookup"><span data-stu-id="338a2-165">At the Subscriber on the subscription database, execute [sp_addpullsubscription_agent](/sql/relational-databases/system-stored-procedures/sp-addpullsubscription-agent-transact-sql).</span></span> <span data-ttu-id="338a2-166">Spécifiez **@publisher** , **@publisher_db** , **@publication** , les [!INCLUDE[msCoName](../../../includes/msconame-md.md)] informations d’identification Windows sous lesquelles l’agent de distribution sur l’abonné s’exécute pour **@job_login** et **@job_password** , et la valeur `true` pour **@use_ftp** .</span><span class="sxs-lookup"><span data-stu-id="338a2-166">Specify **@publisher**, **@publisher_db**, **@publication**, the [!INCLUDE[msCoName](../../../includes/msconame-md.md)] Windows credentials under which the Distribution Agent at the Subscriber runs for **@job_login** and **@job_password**, and a value of `true` for **@use_ftp**.</span></span>  
  
2.  <span data-ttu-id="338a2-167">Dans la base de données de publication sur le serveur de publication, exécutez [sp_addsubscription](/sql/relational-databases/system-stored-procedures/sp-addsubscription-transact-sql) pour inscrire l'abonnement par extraction.</span><span class="sxs-lookup"><span data-stu-id="338a2-167">At the Publisher on the publication database, execute [sp_addsubscription](/sql/relational-databases/system-stored-procedures/sp-addsubscription-transact-sql) to register the pull subscription.</span></span> <span data-ttu-id="338a2-168">Pour plus d’informations, consultez [Créer un abonnement par extraction de données (pull)](../create-a-pull-subscription.md).</span><span class="sxs-lookup"><span data-stu-id="338a2-168">For more information, see [Create a Pull Subscription](../create-a-pull-subscription.md).</span></span>  
  
#### <a name="to-create-a-pull-subscription-to-a-merge-publication-that-uses-ftp-snapshot-delivery"></a><span data-ttu-id="338a2-169">Pour créer un abonnement par extraction à une publication de fusion qui utilise la remise d'instantanés via FTP</span><span class="sxs-lookup"><span data-stu-id="338a2-169">To create a pull subscription to a merge publication that uses FTP snapshot delivery</span></span>  
  
1.  <span data-ttu-id="338a2-170">Dans la base de données d'abonnement de l'Abonné, exécutez [sp_addmergepullsubscription](/sql/relational-databases/system-stored-procedures/sp-addmergepullsubscription-transact-sql).</span><span class="sxs-lookup"><span data-stu-id="338a2-170">At the Subscriber on the subscription database, execute [sp_addmergepullsubscription](/sql/relational-databases/system-stored-procedures/sp-addmergepullsubscription-transact-sql).</span></span> <span data-ttu-id="338a2-171">Spécifiez **@publisher** et **@publication** .</span><span class="sxs-lookup"><span data-stu-id="338a2-171">Specify **@publisher** and **@publication**.</span></span>   
2.  <span data-ttu-id="338a2-172">Dans la base de données d'abonnement de l'Abonné, exécutez [sp_addmergepullsubscription_agent](/sql/relational-databases/system-stored-procedures/sp-addmergepullsubscription-agent-transact-sql).</span><span class="sxs-lookup"><span data-stu-id="338a2-172">At the Subscriber on the subscription database, execute [sp_addmergepullsubscription_agent](/sql/relational-databases/system-stored-procedures/sp-addmergepullsubscription-agent-transact-sql).</span></span> <span data-ttu-id="338a2-173">Spécifiez **@publisher** , **@publisher_db** , **@publication** , les informations d’identification Windows sous lesquelles l’agent de distribution sur l’abonné s’exécute pour **@job_login** et **@job_password** , et la valeur `true` pour **@use_ftp** .</span><span class="sxs-lookup"><span data-stu-id="338a2-173">Specify **@publisher**, **@publisher_db**, **@publication**, the Windows credentials under which the Distribution Agent at the Subscriber runs for **@job_login** and **@job_password**, and a value of `true` for **@use_ftp**.</span></span>    
3.  <span data-ttu-id="338a2-174">Dans la base de données de publication sur le serveur de publication, exécutez [sp_addmergesubscription](/sql/relational-databases/system-stored-procedures/sp-addmergesubscription-transact-sql) pour inscrire l'abonnement par extraction.</span><span class="sxs-lookup"><span data-stu-id="338a2-174">At the Publisher on the publication database, execute [sp_addmergesubscription](/sql/relational-databases/system-stored-procedures/sp-addmergesubscription-transact-sql) to register the pull subscription.</span></span> <span data-ttu-id="338a2-175">Pour plus d’informations, consultez [Créer un abonnement par extraction de données (pull)](../create-a-pull-subscription.md).</span><span class="sxs-lookup"><span data-stu-id="338a2-175">For more information, see [Create a Pull Subscription](../create-a-pull-subscription.md).</span></span>  
  
#### <a name="to-change-one-or-more-ftp-snapshot-delivery-settings-for-a-snapshot-or-transactional-publication"></a><span data-ttu-id="338a2-176">Pour modifier un ou plusieurs paramètres de remise d'instantanés sur FTP pour une publication transactionnelle ou d'instantané</span><span class="sxs-lookup"><span data-stu-id="338a2-176">To change one or more FTP snapshot delivery settings for a snapshot or transactional publication</span></span>  
  
1.  <span data-ttu-id="338a2-177">Dans la base de données de publication sur le serveur de publication, exécutez [sp_changepublication](/sql/relational-databases/system-stored-procedures/sp-changepublication-transact-sql).</span><span class="sxs-lookup"><span data-stu-id="338a2-177">At the Publisher on the publication database, execute [sp_changepublication](/sql/relational-databases/system-stored-procedures/sp-changepublication-transact-sql).</span></span> <span data-ttu-id="338a2-178">Spécifiez l’une des valeurs suivantes pour **@property** et une nouvelle valeur de ce paramètre pour **@value** :</span><span class="sxs-lookup"><span data-stu-id="338a2-178">Specify one of the following values for **@property** and a new value of this setting for **@value**:</span></span>    
    -   <span data-ttu-id="338a2-179">`ftp_address` - l'adresse du serveur FTP utilisé pour remettre l'instantané.</span><span class="sxs-lookup"><span data-stu-id="338a2-179">`ftp_address` - the address of the FTP server used to deliver the snapshot.</span></span>    
    -   <span data-ttu-id="338a2-180">`ftp_port` - le port utilisé par le serveur FTP.</span><span class="sxs-lookup"><span data-stu-id="338a2-180">`ftp_port` - the port used by the FTP server.</span></span>    
    -   <span data-ttu-id="338a2-181">`ftp_subdirectory` - le sous-répertoire du répertoire FTP par défaut utilisé pour l'instantané FTP.</span><span class="sxs-lookup"><span data-stu-id="338a2-181">`ftp_subdirectory` - the subdirectory of the default FTP directory used for the FTP snapshot.</span></span>    
    -   <span data-ttu-id="338a2-182">`ftp_login` - une connexion utilisée pour la connexion au serveur FTP.</span><span class="sxs-lookup"><span data-stu-id="338a2-182">`ftp_login` - a login used to connect to the FTP server.</span></span>    
    -   <span data-ttu-id="338a2-183">`ftp_password` - le mot de passe utilisé pour la connexion FTP.</span><span class="sxs-lookup"><span data-stu-id="338a2-183">`ftp_password` - the password for the FTP login.</span></span>  
  
2.  <span data-ttu-id="338a2-184">(Facultatif) Répétez l'étape 1 pour chaque paramètre FTP modifié.</span><span class="sxs-lookup"><span data-stu-id="338a2-184">(Optional) Repeat step 1 for each FTP setting being changed.</span></span>    
3.  <span data-ttu-id="338a2-185">(Facultatif) Pour désactiver la remise d'instantanés via FTP, exécutez [sp_changepublication](/sql/relational-databases/system-stored-procedures/sp-changepublication-transact-sql) au niveau du serveur de publication dans la base de données de publication.</span><span class="sxs-lookup"><span data-stu-id="338a2-185">(Optional) To disable FTP snapshot delivery, execute [sp_changepublication](/sql/relational-databases/system-stored-procedures/sp-changepublication-transact-sql) at the Publisher on the publication database.</span></span> <span data-ttu-id="338a2-186">Spécifiez la valeur `enabled_for_internet` pour **@property** et la valeur `false` pour **@value** .</span><span class="sxs-lookup"><span data-stu-id="338a2-186">Specify a value of `enabled_for_internet` for **@property** and a value of `false` for **@value**.</span></span>  
  
#### <a name="to-change-ftp-snapshot-delivery-settings-for-a-merge-publication"></a><span data-ttu-id="338a2-187">Pour modifier les paramètres de remise d'instantanés via FTP pour une publication de fusion</span><span class="sxs-lookup"><span data-stu-id="338a2-187">To change FTP snapshot delivery settings for a merge publication</span></span>  
  
1.  <span data-ttu-id="338a2-188">Dans la base de données de publication sur le serveur de publication, exécutez [sp_changemergepublication](/sql/relational-databases/system-stored-procedures/sp-changemergepublication-transact-sql).</span><span class="sxs-lookup"><span data-stu-id="338a2-188">At the Publisher on the publication database, execute [sp_changemergepublication](/sql/relational-databases/system-stored-procedures/sp-changemergepublication-transact-sql).</span></span> <span data-ttu-id="338a2-189">Spécifiez l’une des valeurs suivantes pour **@property** et une nouvelle valeur de ce paramètre pour **@value** :</span><span class="sxs-lookup"><span data-stu-id="338a2-189">Specify one of the following values for **@property** and a new value of this setting for **@value**:</span></span>  
  
    -   <span data-ttu-id="338a2-190">`ftp_address` - l'adresse du serveur FTP utilisé pour remettre l'instantané.</span><span class="sxs-lookup"><span data-stu-id="338a2-190">`ftp_address` - the address of the FTP server used to deliver the snapshot.</span></span>    
    -   <span data-ttu-id="338a2-191">`ftp_port` - le port utilisé par le serveur FTP.</span><span class="sxs-lookup"><span data-stu-id="338a2-191">`ftp_port` - the port used by the FTP server.</span></span>    
    -   <span data-ttu-id="338a2-192">`ftp_subdirectory` - le sous-répertoire du répertoire FTP par défaut utilisé pour l'instantané FTP.</span><span class="sxs-lookup"><span data-stu-id="338a2-192">`ftp_subdirectory` - the subdirectory of the default FTP directory used for the FTP snapshot.</span></span>   
    -   <span data-ttu-id="338a2-193">`ftp_login` - une connexion utilisée pour la connexion au serveur FTP.</span><span class="sxs-lookup"><span data-stu-id="338a2-193">`ftp_login` - a login used to connect to the FTP server.</span></span>    
    -   <span data-ttu-id="338a2-194">`ftp_password` - le mot de passe utilisé pour la connexion FTP.</span><span class="sxs-lookup"><span data-stu-id="338a2-194">`ftp_password` - the password for the FTP login.</span></span>    
2.  <span data-ttu-id="338a2-195">(Facultatif) Répétez l'étape 1 pour chaque paramètre FTP modifié.</span><span class="sxs-lookup"><span data-stu-id="338a2-195">(Optional) Repeat step 1 for each FTP setting being changed.</span></span>    
3.  <span data-ttu-id="338a2-196">(Facultatif) Pour désactiver la remise d'instantanés via FTP, exécutez [sp_changemergepublication](/sql/relational-databases/system-stored-procedures/sp-changemergepublication-transact-sql) au niveau du serveur de publication dans la base de données de publication.</span><span class="sxs-lookup"><span data-stu-id="338a2-196">(Optional) To disable FTP snapshot delivery, execute [sp_changemergepublication](/sql/relational-databases/system-stored-procedures/sp-changemergepublication-transact-sql) at the Publisher on the publication database.</span></span> <span data-ttu-id="338a2-197">Spécifiez la valeur `enabled_for_internet` pour **@property** et la valeur `false` pour **@value** .</span><span class="sxs-lookup"><span data-stu-id="338a2-197">Specify a value of `enabled_for_internet` for **@property** and a value of `false` for **@value**.</span></span>  
  
###  <a name="examples-transact-sql"></a><a name="TsqlExample"></a> <span data-ttu-id="338a2-198">Exemples (Transact-SQL)</span><span class="sxs-lookup"><span data-stu-id="338a2-198">Examples (Transact-SQL)</span></span>  
 <span data-ttu-id="338a2-199">L'exemple suivant crée une publication de fusion qui permet aux Abonnés d'accéder aux données des  instantanés en utilisant FTP.</span><span class="sxs-lookup"><span data-stu-id="338a2-199">The following example creates a merge publication that allows Subscribers to access the snapshot data using FTP.</span></span> <span data-ttu-id="338a2-200">L'Abonné doit utiliser une connexion VPN sécurisée lors de l'accès au partage FTP.</span><span class="sxs-lookup"><span data-stu-id="338a2-200">The Subscriber should use a secure VPN connection when accessing the FTP share.</span></span> <span data-ttu-id="338a2-201">Les variables de script**sqlcmd** sont utilisées pour fournir les valeurs de connexion et de mot de passe.</span><span class="sxs-lookup"><span data-stu-id="338a2-201">**sqlcmd** scripting variables are used to supply login and password values.</span></span> <span data-ttu-id="338a2-202">Pour plus d’informations, consultez [Utiliser sqlcmd avec des variables de script](../../scripting/sqlcmd-use-with-scripting-variables.md).</span><span class="sxs-lookup"><span data-stu-id="338a2-202">For more information, see [Use sqlcmd with Scripting Variables](../../scripting/sqlcmd-use-with-scripting-variables.md).</span></span>  
  
 [!code-sql[HowTo#sp_createmergepub_ftp](../../../snippets/tsql/SQL15/replication/howto/tsql/createmergepubftp.sql#sp_createmergepub_ftp)]  
  
 <span data-ttu-id="338a2-203">L'exemple suivant crée un abonnement à une publication de fusion, dans lequel l'Abonné obtient l'instantané en utilisant FTP.</span><span class="sxs-lookup"><span data-stu-id="338a2-203">The following example creates a subscription to a merge publication, where the Subscriber obtains the snapshot using FTP.</span></span> <span data-ttu-id="338a2-204">L'Abonné doit utiliser une connexion VPN sécurisée lors de l'accès au partage FTP.</span><span class="sxs-lookup"><span data-stu-id="338a2-204">The Subscriber should use a secure VPN connection when accessing the FTP share.</span></span> <span data-ttu-id="338a2-205">Les variables de script**sqlcmd** sont utilisées pour fournir les valeurs de connexion et de mot de passe.</span><span class="sxs-lookup"><span data-stu-id="338a2-205">**sqlcmd** scripting variables are used to supply login and password values.</span></span> <span data-ttu-id="338a2-206">Pour plus d’informations, consultez [Utiliser sqlcmd avec des variables de script](../../scripting/sqlcmd-use-with-scripting-variables.md).</span><span class="sxs-lookup"><span data-stu-id="338a2-206">For more information, see [Use sqlcmd with Scripting Variables](../../scripting/sqlcmd-use-with-scripting-variables.md).</span></span>  
  
 [!code-sql[HowTo#sp_createmergepullsub_ftp](../../../snippets/tsql/SQL15/replication/howto/tsql/createmergepullsubftp.sql#sp_createmergepullsub_ftp)]  
  
 [!code-sql[HowTo#sp_createmergepullsubagent_ftp](../../../snippets/tsql/SQL15/replication/howto/tsql/createmergepullsubftp.sql#sp_createmergepullsubagent_ftp)]  
  
## <a name="see-also"></a><span data-ttu-id="338a2-207">Voir aussi</span><span class="sxs-lookup"><span data-stu-id="338a2-207">See Also</span></span>  
 <span data-ttu-id="338a2-208">[Concepts liés aux procédures stockées système de réplication](../concepts/replication-system-stored-procedures-concepts.md) </span><span class="sxs-lookup"><span data-stu-id="338a2-208">[Replication System Stored Procedures Concepts](../concepts/replication-system-stored-procedures-concepts.md) </span></span>  
 <span data-ttu-id="338a2-209">[Transférer des instantanés via FTP](../transfer-snapshots-through-ftp.md) </span><span class="sxs-lookup"><span data-stu-id="338a2-209">[Transfer Snapshots Through FTP](../transfer-snapshots-through-ftp.md) </span></span>  
 <span data-ttu-id="338a2-210">[Changer les propriétés des publications et des articles](change-publication-and-article-properties.md) </span><span class="sxs-lookup"><span data-stu-id="338a2-210">[Change Publication and Article Properties](change-publication-and-article-properties.md) </span></span>  
 [<span data-ttu-id="338a2-211">Initialiser un abonnement avec un instantané</span><span class="sxs-lookup"><span data-stu-id="338a2-211">Initialize a Subscription with a Snapshot</span></span>](../initialize-a-subscription-with-a-snapshot.md)  
  
  
