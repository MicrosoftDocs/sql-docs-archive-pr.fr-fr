---
title: Définir une relation d’enregistrement logique entre des articles de table de fusion | Microsoft Docs
ms.custom: ''
ms.date: 06/30/2017
ms.prod: sql-server-2014
ms.reviewer: ''
ms.technology: replication
ms.topic: conceptual
helpviewer_keywords:
- merge replication logical records [SQL Server replication]
- articles [SQL Server replication], logical records
- logical records [SQL Server replication]
ms.assetid: ff847b3a-c6b0-4eaf-b225-2ffc899c5558
author: MashaMSFT
ms.author: mathoma
ms.openlocfilehash: 60c92a237562704e5bc5d43717f863aa78a14b55
ms.sourcegitcommit: ad4d92dce894592a259721a1571b1d8736abacdb
ms.translationtype: MT
ms.contentlocale: fr-FR
ms.lasthandoff: 08/04/2020
ms.locfileid: "87709147"
---
# <a name="define-a-logical-record-relationship-between-merge-table-articles"></a><span data-ttu-id="c8634-102">Définir une relation d'enregistrement logique entre des articles de table de fusion</span><span class="sxs-lookup"><span data-stu-id="c8634-102">Define a Logical Record Relationship Between Merge Table Articles</span></span>
  <span data-ttu-id="c8634-103">Cette rubrique explique comment définir une relation d'enregistrement logique entre des articles de table de fusion dans [!INCLUDE[ssCurrent](../../../includes/sscurrent-md.md)] à l'aide de [!INCLUDE[ssManStudioFull](../../../includes/ssmanstudiofull-md.md)], [!INCLUDE[tsql](../../../includes/tsql-md.md)]ou d'objets RMO (Replication Management Objects).</span><span class="sxs-lookup"><span data-stu-id="c8634-103">This topic describes how to define a logical record relationship between merge table articles in [!INCLUDE[ssCurrent](../../../includes/sscurrent-md.md)] by using [!INCLUDE[ssManStudioFull](../../../includes/ssmanstudiofull-md.md)], [!INCLUDE[tsql](../../../includes/tsql-md.md)], or Replication Management Objects (RMO).</span></span>  
  
 <span data-ttu-id="c8634-104">La réplication de fusion vous permet de définir une relation entre des lignes connexes dans des tables distinctes.</span><span class="sxs-lookup"><span data-stu-id="c8634-104">Merge replication allows you to define a relationship between related rows in different tables.</span></span> <span data-ttu-id="c8634-105">Ces lignes peuvent alors être traitées comme une unité transactionnelle au cours de la synchronisation.</span><span class="sxs-lookup"><span data-stu-id="c8634-105">These rows can then be processed as a transactional unit during synchronization.</span></span> <span data-ttu-id="c8634-106">Un enregistrement logique peut être défini entre deux articles qu'ils aient ou non une relation de filtre de jointure.</span><span class="sxs-lookup"><span data-stu-id="c8634-106">A logical record can be defined between two articles whether or not they have a join filter relationship.</span></span> <span data-ttu-id="c8634-107">Pour plus d’informations, consultez [Regrouper les modifications apportées à des lignes connexes à l’aide d’enregistrements logiques](../merge/group-changes-to-related-rows-with-logical-records.md).</span><span class="sxs-lookup"><span data-stu-id="c8634-107">For more information, see [Group Changes to Related Rows with Logical Records](../merge/group-changes-to-related-rows-with-logical-records.md).</span></span>  
  
> [!NOTE]  
>  [!INCLUDE[ssNoteDepFutureAvoid](../../../includes/ssnotedepfutureavoid-md.md)]  
  
 <span data-ttu-id="c8634-108">**Dans cette rubrique**</span><span class="sxs-lookup"><span data-stu-id="c8634-108">**In This Topic**</span></span>  
  
-   <span data-ttu-id="c8634-109">**Avant de commencer :**</span><span class="sxs-lookup"><span data-stu-id="c8634-109">**Before you begin:**</span></span>  
  
     [<span data-ttu-id="c8634-110">Limitations et restrictions</span><span class="sxs-lookup"><span data-stu-id="c8634-110">Limitations and Restrictions</span></span>](#Restrictions)  
  
-   <span data-ttu-id="c8634-111">**Pour définir une relation d'enregistrement logique entre des articles de table de fusion à l'aide de :**</span><span class="sxs-lookup"><span data-stu-id="c8634-111">**To define a logical record relationship between merge table articles, using:**</span></span>  
  
     [<span data-ttu-id="c8634-112">SQL Server Management Studio</span><span class="sxs-lookup"><span data-stu-id="c8634-112">SQL Server Management Studio</span></span>](#SSMSProcedure)  
  
     [<span data-ttu-id="c8634-113">Transact-SQL</span><span class="sxs-lookup"><span data-stu-id="c8634-113">Transact-SQL</span></span>](#TsqlProcedure)  
  
     [<span data-ttu-id="c8634-114">Objets RMO (Replication Management Objects)</span><span class="sxs-lookup"><span data-stu-id="c8634-114">Replication Management Objects (RMO)</span></span>](#RMOProcedure)  
  
##  <a name="before-you-begin"></a><a name="BeforeYouBegin"></a> <span data-ttu-id="c8634-115">Avant de commencer</span><span class="sxs-lookup"><span data-stu-id="c8634-115">Before You Begin</span></span>  
  
###  <a name="limitations-and-restrictions"></a><a name="Restrictions"></a> <span data-ttu-id="c8634-116">Limitations et restrictions</span><span class="sxs-lookup"><span data-stu-id="c8634-116">Limitations and Restrictions</span></span>  
  
-   <span data-ttu-id="c8634-117">Si vous ajoutez, modifiez ou supprimez un enregistrement logique après que les abonnements à la publication aient été initialisés, vous devez générer un nouvel instantané et réinitialiser tous les abonnements après avoir effectué la modification.</span><span class="sxs-lookup"><span data-stu-id="c8634-117">If you add, modify, or delete a logical record after subscriptions to the publication have been initialized, you must generate a new snapshot and reinitialize all subscriptions after making the change.</span></span> <span data-ttu-id="c8634-118">Pour plus d’informations sur les exigences relatives aux changements de propriétés, consultez [Changer les propriétés des publications et des articles](change-publication-and-article-properties.md).</span><span class="sxs-lookup"><span data-stu-id="c8634-118">For more information about requirements for property changes, see [Change Publication and Article Properties](change-publication-and-article-properties.md).</span></span>  
  
##  <a name="using-sql-server-management-studio"></a><a name="SSMSProcedure"></a> <span data-ttu-id="c8634-119">Utilisation de SQL Server Management Studio</span><span class="sxs-lookup"><span data-stu-id="c8634-119">Using SQL Server Management Studio</span></span>  
 <span data-ttu-id="c8634-120">Définissez des enregistrements logiques dans la boîte de dialogue **Ajouter une jointure**, disponible dans l’Assistant Nouvelle publication, ainsi que dans la boîte de dialogue **Propriétés de la publication - \<Publication>** .</span><span class="sxs-lookup"><span data-stu-id="c8634-120">Define logical records in the **Add Join** dialog box, which is available in the New Publication Wizard and the **Publication Properties - \<Publication>** dialog box.</span></span> <span data-ttu-id="c8634-121">Pour plus d’informations sur l’utilisation de l’Assistant et sur l’accès à la boîte de dialogue, consultez [Créer une publication](create-a-publication.md) et [Afficher et modifier les propriétés d’une publication](view-and-modify-publication-properties.md).</span><span class="sxs-lookup"><span data-stu-id="c8634-121">For more information about using the wizard and accessing the dialog box, see [Create a Publication](create-a-publication.md) and [View and Modify Publication Properties](view-and-modify-publication-properties.md).</span></span>  
  
 <span data-ttu-id="c8634-122">Les enregistrements logiques peuvent être définis dans la boîte de dialogue **Ajouter une jointure** seulement s'ils sont appliqués à un filtre de jointure dans une publication de fusion, et si la publication satisfait aux conditions requises pour l'utilisation de partitions précalculées.</span><span class="sxs-lookup"><span data-stu-id="c8634-122">Logical records can be defined in the **Add Join** dialog box only if they are applied to a join filter in a merge publication, and the publication follows the requirements for using precomputed partitions.</span></span> <span data-ttu-id="c8634-123">Pour définir des enregistrements logiques qui ne sont pas appliqués à des filtres de jointure et pour définir la détection et la résolution des conflits au niveau des enregistrements logiques, vous devez utiliser des procédures stockées.</span><span class="sxs-lookup"><span data-stu-id="c8634-123">To define logical records that are not applied to join filters and to set conflict detection and resolution at the logical record level, you must use stored procedures.</span></span>  
  
#### <a name="to-define-a-logical-record-relationship"></a><span data-ttu-id="c8634-124">Pour définir une relation d'enregistrement logique</span><span class="sxs-lookup"><span data-stu-id="c8634-124">To define a logical record relationship</span></span>  
  
1.  <span data-ttu-id="c8634-125">Dans la page **Filtrer les lignes de la table** de l’Assistant Nouvelle publication ou la page **Filtrer les lignes** de la boîte de dialogue **Propriétés de la publication - \<Publication>** , sélectionnez un filtre de lignes dans le volet **Tables filtrées**.</span><span class="sxs-lookup"><span data-stu-id="c8634-125">On the **Filter Table Rows** page of the New Publication Wizard or the **Filter Rows** page of the **Publication Properties - \<Publication>** dialog box, select a row filter in the **Filtered Tables** pane.</span></span>  
  
     <span data-ttu-id="c8634-126">Une relation d'enregistrement logique est associée à un filtre de jointure, qui étend un filtre de lignes.</span><span class="sxs-lookup"><span data-stu-id="c8634-126">A logical record relationship is associated with a join filter, which extends a row filter.</span></span> <span data-ttu-id="c8634-127">Vous devez donc définir un filtre de lignes avant de pouvoir étendre le filtre avec une jointure et appliquer une relation d'enregistrement logique.</span><span class="sxs-lookup"><span data-stu-id="c8634-127">Therefore you must define a row filter before you can extend the filter with a join and apply a logical record relationship.</span></span> <span data-ttu-id="c8634-128">Après avoir défini un filtre de jointure, vous pouvez l'étendre avec un autre filtre de jointure.</span><span class="sxs-lookup"><span data-stu-id="c8634-128">After one join filter is defined, you can extend this join filter with another join filter.</span></span> <span data-ttu-id="c8634-129">Pour plus d'informations sur la définition de filtres de jointure, consultez [Définir et modifier un filtre de jointure entre des articles de fusion](define-and-modify-a-join-filter-between-merge-articles.md).</span><span class="sxs-lookup"><span data-stu-id="c8634-129">For more information about defining join filters, see [Define and Modify a Join Filter Between Merge Articles](define-and-modify-a-join-filter-between-merge-articles.md).</span></span>  
  
2.  <span data-ttu-id="c8634-130">Cliquez sur **Ajouter**, puis sur **Ajouter une jointure pour étendre le filtre sélectionné**.</span><span class="sxs-lookup"><span data-stu-id="c8634-130">Click **Add**, and then click **Add Join to Extend the Selected Filter**.</span></span>  
  
3.  <span data-ttu-id="c8634-131">Définissez un filtre de jointure dans la boîte de dialogue **Ajouter une jointure** , puis activez la case à cocher **Enregistrement logique**.</span><span class="sxs-lookup"><span data-stu-id="c8634-131">Define a join filter in the **Add Join** dialog box, and then select the check box **Logical Record**.</span></span>  
  
4.  <span data-ttu-id="c8634-132">Si vous êtes dans la boîte de dialogue **Propriétés de la publication - \<Publication>** , cliquez sur **OK** pour enregistrer et fermer la boîte de dialogue.</span><span class="sxs-lookup"><span data-stu-id="c8634-132">If you are in the **Publication Properties - \<Publication>** dialog box, click **OK** to save and close the dialog box.</span></span>  
  
#### <a name="to-delete-a-logical-record-relationship"></a><span data-ttu-id="c8634-133">Pour supprimer une relation d'enregistrement logique</span><span class="sxs-lookup"><span data-stu-id="c8634-133">To delete a logical record relationship</span></span>  
  
-   <span data-ttu-id="c8634-134">Supprimer seulement la relation d'enregistrement logique ou supprimer la relation d'enregistrement logique et le filtre de jointure qui y est associé.</span><span class="sxs-lookup"><span data-stu-id="c8634-134">Delete only the logical record relationship or delete the logical record relationship and the join filter associated with it.</span></span>  
  
     <span data-ttu-id="c8634-135">Pour supprimer seulement la relation d'enregistrement logique :</span><span class="sxs-lookup"><span data-stu-id="c8634-135">To delete only the logical record relationship:</span></span>  
  
    1.  <span data-ttu-id="c8634-136">Dans la page **Filtrer les lignes** de l’Assistant Nouvelle publication ou dans la page **Filtrer les lignes** de la boîte de dialogue **Propriétés de la publication - \<Publication>** , sélectionnez le filtre de jointure associé à la relation d’enregistrements logiques dans le volet **Tables filtrées**, puis cliquez sur **Modifier**.</span><span class="sxs-lookup"><span data-stu-id="c8634-136">On the **Filter Rows** page of the New Publication Wizard or the **Filter Rows** page of the **Publication Properties - \<Publication>** dialog box, select the join filter associated with the logical record relationship in the **Filtered Tables** pane, and then click **Edit**.</span></span>  
  
    2.  <span data-ttu-id="c8634-137">Dans la boîte de dialogue **Modifier une jointure** , désactivez la case à cocher **Enregistrement logique**.</span><span class="sxs-lookup"><span data-stu-id="c8634-137">In the **Edit Join** dialog box, clear the check box **Logical Record**.</span></span>  
  
    3.  [!INCLUDE[clickOK](../../../includes/clickok-md.md)]  
  
     <span data-ttu-id="c8634-138">Pour supprimer la relation d'enregistrement logique et le filtre de jointure qui y est associé :</span><span class="sxs-lookup"><span data-stu-id="c8634-138">To delete the logical record relationship and join filter associated with it:</span></span>  
  
    -   <span data-ttu-id="c8634-139">Dans la page **Filtrer les lignes** de l’Assistant Nouvelle publication ou dans la boîte de dialogue **Propriétés de la publication - \<Publication>** , sélectionnez un filtre dans le volet **Tables filtrées**, puis cliquez sur **Supprimer**.</span><span class="sxs-lookup"><span data-stu-id="c8634-139">On the **Filter Rows** page of the New Publication Wizard or **Publication Properties - \<Publication>** dialog box, select a filter in the **Filtered Tables** pane, and then click **Delete**.</span></span> <span data-ttu-id="c8634-140">Si le filtre de jointure que vous supprimez est lui-même étendu par d'autres jointures, ces jointures seront aussi supprimées.</span><span class="sxs-lookup"><span data-stu-id="c8634-140">If the join filter you delete is itself extended by other joins, those joins will also be deleted.</span></span>  
  
##  <a name="using-transact-sql"></a><a name="TsqlProcedure"></a> <span data-ttu-id="c8634-141">Utilisation de Transact-SQL</span><span class="sxs-lookup"><span data-stu-id="c8634-141">Using Transact-SQL</span></span>  
 <span data-ttu-id="c8634-142">Vous pouvez spécifier par programme des relations d'enregistrements logiques entre des articles en utilisant des procédures stockées de réplication.</span><span class="sxs-lookup"><span data-stu-id="c8634-142">You can programmatically specify logical record relationships between articles using replication stored procedures.</span></span>  
  
#### <a name="to-define-a-logical-record-relationship-without-an-associated-join-filter"></a><span data-ttu-id="c8634-143">Pour définir une relation d'enregistrement logique sans filtre de jointure associé</span><span class="sxs-lookup"><span data-stu-id="c8634-143">To define a logical record relationship without an associated join filter</span></span>  
  
1.  <span data-ttu-id="c8634-144">Si la publication contient des articles filtrés, exécutez [sp_helpmergepublication](/sql/relational-databases/system-stored-procedures/sp-helpmergepublication-transact-sql)et notez la valeur de **use_partition_groups** dans le jeu de résultats.</span><span class="sxs-lookup"><span data-stu-id="c8634-144">If the publication contains any articles that are filtered, execute [sp_helpmergepublication](/sql/relational-databases/system-stored-procedures/sp-helpmergepublication-transact-sql), and note the value of **use_partition_groups** in the result set.</span></span>  
  
    -   <span data-ttu-id="c8634-145">Si la valeur est **1**, les partitions précalculées sont déjà utilisées.</span><span class="sxs-lookup"><span data-stu-id="c8634-145">If the value is **1**, then precomputed partitions are already being used.</span></span>  
  
    -   <span data-ttu-id="c8634-146">Si la valeur est **0**, exécutez [sp_changemergepublication](/sql/relational-databases/system-stored-procedures/sp-changemergepublication-transact-sql) au niveau du serveur de publication dans la base de données de publication.</span><span class="sxs-lookup"><span data-stu-id="c8634-146">If the value is **0**, then execute [sp_changemergepublication](/sql/relational-databases/system-stored-procedures/sp-changemergepublication-transact-sql) at the Publisher on the publication database.</span></span> <span data-ttu-id="c8634-147">Affectez la valeur **use_partition_groups** à **@property** et la valeur **true** à **@value**.</span><span class="sxs-lookup"><span data-stu-id="c8634-147">Specify a value of **use_partition_groups** for **@property** and a value of **true** for **@value**.</span></span>  
  
        > [!NOTE]  
        >  <span data-ttu-id="c8634-148">Si la publication ne prend pas en charge les partitions précalculées, les enregistrements logiques ne peuvent pas être utilisés.</span><span class="sxs-lookup"><span data-stu-id="c8634-148">If the publication does not support precomputed partitions, then logical records cannot be used.</span></span> <span data-ttu-id="c8634-149">Pour plus d’informations, consultez « Conditions requises à l’utilisation des partitions précalculées » dans la rubrique [Optimiser les performances des filtres paramétrés avec des partitions précalculées](../merge/parameterized-filters-optimize-for-precomputed-partitions.md).</span><span class="sxs-lookup"><span data-stu-id="c8634-149">For more information, see Requirements for Using Precomputed Partitions in the topic [Optimize Parameterized Filter Performance with Precomputed Partitions](../merge/parameterized-filters-optimize-for-precomputed-partitions.md).</span></span>  
  
    -   <span data-ttu-id="c8634-150">Si la valeur est NULL, l'Agent d'instantané doit être exécuté pour générer l'instantané initial de la publication.</span><span class="sxs-lookup"><span data-stu-id="c8634-150">If the value is NULL, then the Snapshot Agent needs to be run to generate the initial snapshot for the publication.</span></span>  
  
2.  <span data-ttu-id="c8634-151">Si les articles qui constitueront l'enregistrement logique n'existent pas, exécutez [sp_addmergearticle](/sql/relational-databases/system-stored-procedures/sp-addmergearticle-transact-sql) au niveau du serveur de publication dans la base de données de publication.</span><span class="sxs-lookup"><span data-stu-id="c8634-151">If the articles that will comprise the logical record do not exist, execute [sp_addmergearticle](/sql/relational-databases/system-stored-procedures/sp-addmergearticle-transact-sql) at the Publisher on the publication database.</span></span> <span data-ttu-id="c8634-152">Spécifiez l'une des options de détection et de résolution des conflits suivantes pour l'enregistrement logique :</span><span class="sxs-lookup"><span data-stu-id="c8634-152">Specify one of the following conflict detection and resolution options for the logical record:</span></span>  
  
    -   <span data-ttu-id="c8634-153">Pour détecter et résoudre les conflits qui se produisent dans des lignes connexes de l'enregistrement logique, affectez la valeur **true** à **@logical_record_level_conflict_detection** et **@logical_record_level_conflict_resolution**.</span><span class="sxs-lookup"><span data-stu-id="c8634-153">To detect and resolve conflicts that occur within related rows in the logic record, specify a value of **true** for **@logical_record_level_conflict_detection** and **@logical_record_level_conflict_resolution**.</span></span>  
  
    -   <span data-ttu-id="c8634-154">Pour utiliser la détection et la résolution standard des conflits au niveau des lignes ou des colonnes, spécifiez `false` la valeur pour **@logical_record_level_conflict_detection** et **@logical_record_level_conflict_resolution** , qui est la valeur par défaut.</span><span class="sxs-lookup"><span data-stu-id="c8634-154">To use the standard row- or column-level conflict detection and resolution, specify a value of `false` for **@logical_record_level_conflict_detection** and **@logical_record_level_conflict_resolution**, which is the default.</span></span>  
  
3.  <span data-ttu-id="c8634-155">Répétez l'étape 2 pour chaque article qui constituera l'enregistrement logique.</span><span class="sxs-lookup"><span data-stu-id="c8634-155">Repeat step 2 for each article that will comprise the logical record.</span></span> <span data-ttu-id="c8634-156">Vous devez utiliser la même option de détection et de résolution des conflits pour chaque article de l'enregistrement logique.</span><span class="sxs-lookup"><span data-stu-id="c8634-156">You must use the same conflict detection and resolution option for each article in the logical record.</span></span> <span data-ttu-id="c8634-157">Pour plus d'informations, voir [Détection et résolution des conflits dans les enregistrements logiques](../merge/advanced-merge-replication-conflict-resolving-in-logical-record.md).</span><span class="sxs-lookup"><span data-stu-id="c8634-157">For more information, see [Detecting and Resolving Conflicts in Logical Records](../merge/advanced-merge-replication-conflict-resolving-in-logical-record.md).</span></span>  
  
4.  <span data-ttu-id="c8634-158">Dans la base de données de publication sur le serveur de publication, exécutez [sp_addmergefilter](/sql/relational-databases/system-stored-procedures/sp-addmergefilter-transact-sql).</span><span class="sxs-lookup"><span data-stu-id="c8634-158">At the publisher on the publication database, execute [sp_addmergefilter](/sql/relational-databases/system-stored-procedures/sp-addmergefilter-transact-sql).</span></span> <span data-ttu-id="c8634-159">Spécifiez **@publication** , le nom d’un article dans la relation pour **@article** , le nom du deuxième article pour, le nom de **@join_articlename** la relation pour **@filtername** , une clause qui définit la relation entre les deux articles pour **@join_filterclause** , le type de jointure pour **@join_unique_key** et l’une des valeurs suivantes pour **@filter_type** :</span><span class="sxs-lookup"><span data-stu-id="c8634-159">Specify **@publication**, the name of one article in the relationship for **@article**, the name of the second article for **@join_articlename**, a name for the relationship for **@filtername**, a clause that defines the relationship between the two articles for **@join_filterclause**, the type of join for **@join_unique_key** and one of the following values for **@filter_type**:</span></span>  
  
    -   <span data-ttu-id="c8634-160">**2** - définit une relation logique.</span><span class="sxs-lookup"><span data-stu-id="c8634-160">**2** - Defines a logical relationship.</span></span>  
  
    -   <span data-ttu-id="c8634-161">**3** - définit une relation logique avec un filtre de jointure.</span><span class="sxs-lookup"><span data-stu-id="c8634-161">**3** - Defines a logical relationship with a join filter.</span></span>  
  
    > [!NOTE]  
    >  <span data-ttu-id="c8634-162">Si aucun filtre de jointure n'est pas utilisé, la direction de la relation entre les deux articles n'est pas importante.</span><span class="sxs-lookup"><span data-stu-id="c8634-162">If a join filter is not used, the direction of the relationship between the two articles is not important.</span></span>  
  
5.  <span data-ttu-id="c8634-163">Répétez l'étape 2 pour chaque relation d'enregistrement logique restante dans la publication.</span><span class="sxs-lookup"><span data-stu-id="c8634-163">Repeat step 2 for each remaining logical record relationship in the publication.</span></span>  
  
#### <a name="to-change-conflict-detection-and-resolution-for-logical-records"></a><span data-ttu-id="c8634-164">Pour modifier la détection et la résolution des conflits pour les enregistrements logiques</span><span class="sxs-lookup"><span data-stu-id="c8634-164">To change conflict detection and resolution for logical records</span></span>  
  
1.  <span data-ttu-id="c8634-165">Pour détecter et résoudre les conflits qui se produisent dans des lignes connexes de l'enregistrement logique :</span><span class="sxs-lookup"><span data-stu-id="c8634-165">To detect and resolve conflicts that occur within related rows in the logical record:</span></span>  
  
    -   <span data-ttu-id="c8634-166">Dans la base de données de publication sur le serveur de publication, exécutez [sp_changemergearticle](/sql/relational-databases/system-stored-procedures/sp-changemergearticle-transact-sql).</span><span class="sxs-lookup"><span data-stu-id="c8634-166">At the Publisher on the publication database, execute [sp_changemergearticle](/sql/relational-databases/system-stored-procedures/sp-changemergearticle-transact-sql).</span></span> <span data-ttu-id="c8634-167">Affectez la valeur **logical_record_level_conflict_detection** à **@property** et la valeur **true** à **@value**.</span><span class="sxs-lookup"><span data-stu-id="c8634-167">Specify a value of **logical_record_level_conflict_detection** for **@property** and a value of **true** for **@value**.</span></span> <span data-ttu-id="c8634-168">Affectez la valeur **1** à **@force_invalidate_snapshot** et **@force_reinit_subscription**.</span><span class="sxs-lookup"><span data-stu-id="c8634-168">Specify a value of **1** for **@force_invalidate_snapshot** and **@force_reinit_subscription**.</span></span>  
  
    -   <span data-ttu-id="c8634-169">Dans la base de données de publication sur le serveur de publication, exécutez [sp_changemergearticle](/sql/relational-databases/system-stored-procedures/sp-changemergearticle-transact-sql).</span><span class="sxs-lookup"><span data-stu-id="c8634-169">At the Publisher on the publication database, execute [sp_changemergearticle](/sql/relational-databases/system-stored-procedures/sp-changemergearticle-transact-sql).</span></span> <span data-ttu-id="c8634-170">Affectez la valeur **logical_record_level_conflict_resolution** à **@property** et la valeur **true** à **@value**.</span><span class="sxs-lookup"><span data-stu-id="c8634-170">Specify a value of **logical_record_level_conflict_resolution** for **@property** and a value of **true** for **@value**.</span></span> <span data-ttu-id="c8634-171">Affectez la valeur **1** à **@force_invalidate_snapshot** et **@force_reinit_subscription**.</span><span class="sxs-lookup"><span data-stu-id="c8634-171">Specify a value of **1** for **@force_invalidate_snapshot** and **@force_reinit_subscription**.</span></span>  
  
2.  <span data-ttu-id="c8634-172">Pour utiliser la détection et la résolution standard des conflits au niveau des lignes ou des colonnes :</span><span class="sxs-lookup"><span data-stu-id="c8634-172">To use the standard row-level or column-level conflict detection and resolution:</span></span>  
  
    -   <span data-ttu-id="c8634-173">Dans la base de données de publication sur le serveur de publication, exécutez [sp_changemergearticle](/sql/relational-databases/system-stored-procedures/sp-changemergearticle-transact-sql).</span><span class="sxs-lookup"><span data-stu-id="c8634-173">At the Publisher on the publication database, execute [sp_changemergearticle](/sql/relational-databases/system-stored-procedures/sp-changemergearticle-transact-sql).</span></span> <span data-ttu-id="c8634-174">Spécifiez une valeur de **logical_record_level_conflict_detection** pour **@property** et une valeur `false` pour **@value** .</span><span class="sxs-lookup"><span data-stu-id="c8634-174">Specify a value of **logical_record_level_conflict_detection** for **@property** and a value of `false` for **@value**.</span></span> <span data-ttu-id="c8634-175">Affectez la valeur **1** à **@force_invalidate_snapshot** et **@force_reinit_subscription**.</span><span class="sxs-lookup"><span data-stu-id="c8634-175">Specify a value of **1** for **@force_invalidate_snapshot** and **@force_reinit_subscription**.</span></span>  
  
    -   <span data-ttu-id="c8634-176">Dans la base de données de publication sur le serveur de publication, exécutez [sp_changemergearticle](/sql/relational-databases/system-stored-procedures/sp-changemergearticle-transact-sql).</span><span class="sxs-lookup"><span data-stu-id="c8634-176">At the Publisher on the publication database, execute [sp_changemergearticle](/sql/relational-databases/system-stored-procedures/sp-changemergearticle-transact-sql).</span></span> <span data-ttu-id="c8634-177">Spécifiez une valeur de **logical_record_level_conflict_resolution** pour **@property** et une valeur `false` pour **@value** .</span><span class="sxs-lookup"><span data-stu-id="c8634-177">Specify a value of **logical_record_level_conflict_resolution** for **@property** and a value of `false` for **@value**.</span></span> <span data-ttu-id="c8634-178">Affectez la valeur **1** à **@force_invalidate_snapshot** et **@force_reinit_subscription**.</span><span class="sxs-lookup"><span data-stu-id="c8634-178">Specify a value of **1** for **@force_invalidate_snapshot** and **@force_reinit_subscription**.</span></span>  
  
#### <a name="to-remove-a-logical-record-relationship"></a><span data-ttu-id="c8634-179">Pour supprimer une relation d'enregistrements logiques</span><span class="sxs-lookup"><span data-stu-id="c8634-179">To remove a logical record relationship</span></span>  
  
1.  <span data-ttu-id="c8634-180">Dans la base de données de publication sur le serveur de publication, exécutez la requête suivante afin que des informations sur toutes les relations d'enregistrements logiques définies pour la publication spécifiée soient retournées :</span><span class="sxs-lookup"><span data-stu-id="c8634-180">At the Publisher on the publication database, execute the following query to return information about all logical record relationships defined for the specified publication:</span></span>  
  
     [!code-sql[HowTo#sp_ReturnMergeLogicalRecords](../../../snippets/tsql/SQL15/replication/howto/tsql/createlogicalrecordpub.sql#sp_returnmergelogicalrecords)]  
  
     <span data-ttu-id="c8634-181">Notez le nom de la relation d'enregistrements logiques en cours de suppression dans la colonne `filtername` du jeu de résultats.</span><span class="sxs-lookup"><span data-stu-id="c8634-181">Note the name of the logical record relationship being removed in the `filtername` column in the result set.</span></span>  
  
    > [!NOTE]  
    >  <span data-ttu-id="c8634-182">Cette requête retourne les mêmes informations que [sp_helpmergefilter](/sql/relational-databases/system-stored-procedures/sp-helpmergefilter-transact-sql)Toutefois, cette procédure stockée système retourne seulement des informations sur les relations d'enregistrements logiques qui sont également des filtres de jointure.</span><span class="sxs-lookup"><span data-stu-id="c8634-182">This query returns the same information as [sp_helpmergefilter](/sql/relational-databases/system-stored-procedures/sp-helpmergefilter-transact-sql); however, this system stored procedure only returns information about logical record relationships that are also join filters.</span></span>  
  
2.  <span data-ttu-id="c8634-183">Dans la base de données de publication sur le serveur de publication, exécutez [sp_dropmergefilter](/sql/relational-databases/system-stored-procedures/sp-dropmergefilter-transact-sql).</span><span class="sxs-lookup"><span data-stu-id="c8634-183">At the Publisher on the publication database, execute [sp_dropmergefilter](/sql/relational-databases/system-stored-procedures/sp-dropmergefilter-transact-sql).</span></span> <span data-ttu-id="c8634-184">Spécifiez **@publication** , le nom de l’un des Articles de la relation pour **@article** et le nom de la relation de l’étape 1 pour **@filtername** .</span><span class="sxs-lookup"><span data-stu-id="c8634-184">Specify **@publication**, the name of one of the articles in the relationship for **@article**, and the name of the relationship from step 1 for **@filtername**.</span></span>  
  
###  <a name="example-transact-sql"></a><a name="TsqlExample"></a> <span data-ttu-id="c8634-185">Exemple (Transact-SQL)</span><span class="sxs-lookup"><span data-stu-id="c8634-185">Example (Transact-SQL)</span></span>  
 <span data-ttu-id="c8634-186">Cet exemple active les partitions précalculées sur une publication existante et crée un enregistrement logique qui comprend les deux nouveaux articles des tables `SalesOrderHeader` et `SalesOrderDetail` .</span><span class="sxs-lookup"><span data-stu-id="c8634-186">This example enables precomputed partitions on an existing publication, and creates a logical record comprising the two new articles for the `SalesOrderHeader` and `SalesOrderDetail` tables.</span></span>  
  
 [!code-sql[HowTo#sp_AddMergeLogicalRecord](../../../snippets/tsql/SQL15/replication/howto/tsql/createlogicalrecordpub.sql#sp_addmergelogicalrecord)]  
  
##  <a name="using-replication-management-objects-rmo"></a><a name="RMOProcedure"></a> <span data-ttu-id="c8634-187">Utilisation d'objets RMO (Replication Management Objects)</span><span class="sxs-lookup"><span data-stu-id="c8634-187">Using Replication Management Objects (RMO)</span></span>  
  
> [!NOTE]  
>  <span data-ttu-id="c8634-188">La réplication de fusion vous permet de spécifier que les conflits soient suivis et résolus au niveau des enregistrements logiques, mais ces options ne peuvent pas être définies à l'aide des objets RMO.</span><span class="sxs-lookup"><span data-stu-id="c8634-188">Merge replication allows you to specify that conflicts be tracked and resolved at the logical record level, but these options cannot be set using RMO.</span></span>  
  
#### <a name="to-define-a-logical-record-relationship-without-an-associated-join-filter"></a><span data-ttu-id="c8634-189">Pour définir une relation d'enregistrement logique sans filtre de jointure associé</span><span class="sxs-lookup"><span data-stu-id="c8634-189">To define a logical record relationship without an associated join filter</span></span>  
  
1.  <span data-ttu-id="c8634-190">Créez une connexion au serveur de publication en utilisant la classe <xref:Microsoft.SqlServer.Management.Common.ServerConnection> .</span><span class="sxs-lookup"><span data-stu-id="c8634-190">Create a connection to the Publisher by using the <xref:Microsoft.SqlServer.Management.Common.ServerConnection> class.</span></span>  
  
2.  <span data-ttu-id="c8634-191">Créez une instance de la classe <xref:Microsoft.SqlServer.Replication.MergePublication> , définissez les propriétés <xref:Microsoft.SqlServer.Replication.Publication.Name%2A> et <xref:Microsoft.SqlServer.Replication.Publication.DatabaseName%2A> pour la publication et définissez la propriété <xref:Microsoft.SqlServer.Replication.ReplicationObject.ConnectionContext%2A> sur la connexion créée à l'étape 1.</span><span class="sxs-lookup"><span data-stu-id="c8634-191">Create an instance of the <xref:Microsoft.SqlServer.Replication.MergePublication> class, set the <xref:Microsoft.SqlServer.Replication.Publication.Name%2A> and <xref:Microsoft.SqlServer.Replication.Publication.DatabaseName%2A> properties for the publication, and set the <xref:Microsoft.SqlServer.Replication.ReplicationObject.ConnectionContext%2A> property to the connection created in step 1.</span></span>  
  
3.  <span data-ttu-id="c8634-192">Appelez la méthode <xref:Microsoft.SqlServer.Replication.ReplicationObject.LoadProperties%2A> pour obtenir les propriétés de l'objet.</span><span class="sxs-lookup"><span data-stu-id="c8634-192">Call the <xref:Microsoft.SqlServer.Replication.ReplicationObject.LoadProperties%2A> method to get the properties of the object.</span></span> <span data-ttu-id="c8634-193">Si cette méthode retourne `false`, soit les propriétés de la publication ont été définies de manière incorrecte à l'étape 2, soit la publication n'existe pas.</span><span class="sxs-lookup"><span data-stu-id="c8634-193">If this method returns `false`, either the publication properties in step 2 were defined incorrectly or the publication does not exist.</span></span>  
  
4.  <span data-ttu-id="c8634-194">Si la propriété <xref:Microsoft.SqlServer.Replication.MergePublication.PartitionGroupsOption%2A> a la valeur <xref:Microsoft.SqlServer.Replication.PartitionGroupsOption.False>, affectez-lui la valeur <xref:Microsoft.SqlServer.Replication.PartitionGroupsOption.True>.</span><span class="sxs-lookup"><span data-stu-id="c8634-194">If the <xref:Microsoft.SqlServer.Replication.MergePublication.PartitionGroupsOption%2A> property is set to <xref:Microsoft.SqlServer.Replication.PartitionGroupsOption.False>, set it to <xref:Microsoft.SqlServer.Replication.PartitionGroupsOption.True>.</span></span>  
  
5.  <span data-ttu-id="c8634-195">Si les articles devant inclure l'enregistrement logique n'existent pas, créez une instance de la classe <xref:Microsoft.SqlServer.Replication.MergeArticle> et définissez les propriétés suivantes :</span><span class="sxs-lookup"><span data-stu-id="c8634-195">If the articles that are to comprise the logical record do not exist, create an instance of the <xref:Microsoft.SqlServer.Replication.MergeArticle> class, and set the following properties:</span></span>  
  
    -   <span data-ttu-id="c8634-196">Le nom de l'article pour <xref:Microsoft.SqlServer.Replication.Article.Name%2A>.</span><span class="sxs-lookup"><span data-stu-id="c8634-196">The name of the article for <xref:Microsoft.SqlServer.Replication.Article.Name%2A>.</span></span>  
  
    -   <span data-ttu-id="c8634-197">Le nom de la publication pour <xref:Microsoft.SqlServer.Replication.Article.PublicationName%2A>.</span><span class="sxs-lookup"><span data-stu-id="c8634-197">The name of the publication for <xref:Microsoft.SqlServer.Replication.Article.PublicationName%2A>.</span></span>  
  
    -   <span data-ttu-id="c8634-198">(Facultatif) Si l'article est filtré horizontalement, spécifiez la clause de filtre de lignes pour la propriété <xref:Microsoft.SqlServer.Replication.MergeArticle.FilterClause%2A> .</span><span class="sxs-lookup"><span data-stu-id="c8634-198">(Optional) If the article is horizontally filtered, specify the row filter clause for the <xref:Microsoft.SqlServer.Replication.MergeArticle.FilterClause%2A> property.</span></span> <span data-ttu-id="c8634-199">Utilisez cette propriété pour spécifier un filtre de lignes statique ou paramétrable.</span><span class="sxs-lookup"><span data-stu-id="c8634-199">Use this property to specify a static or parameterized row filter.</span></span> <span data-ttu-id="c8634-200">Pour plus d'informations, voir [Parameterized Row Filters](../merge/parameterized-filters-parameterized-row-filters.md).</span><span class="sxs-lookup"><span data-stu-id="c8634-200">For more information, see [Parameterized Row Filters](../merge/parameterized-filters-parameterized-row-filters.md).</span></span>  
  
     <span data-ttu-id="c8634-201">Pour plus d’informations, consultez [définir un Article](define-an-article.md).</span><span class="sxs-lookup"><span data-stu-id="c8634-201">For more information, see [Define an Article](define-an-article.md).</span></span>  
  
6.  <span data-ttu-id="c8634-202">Appelez la méthode <xref:Microsoft.SqlServer.Replication.Article.Create%2A> .</span><span class="sxs-lookup"><span data-stu-id="c8634-202">Call the <xref:Microsoft.SqlServer.Replication.Article.Create%2A> method.</span></span>  
  
7.  <span data-ttu-id="c8634-203">Répétez les étapes 5 et 6 pour chaque article qui comprend l'enregistrement logique.</span><span class="sxs-lookup"><span data-stu-id="c8634-203">Repeat steps 5 and 6 for each article comprising the logical record.</span></span>  
  
8.  <span data-ttu-id="c8634-204">Créez une instance de la classe <xref:Microsoft.SqlServer.Replication.MergeJoinFilter> pour définir la relation d'enregistrement logique entre les articles.</span><span class="sxs-lookup"><span data-stu-id="c8634-204">Create an instance of the <xref:Microsoft.SqlServer.Replication.MergeJoinFilter> class to define the logical record relationship between articles.</span></span> <span data-ttu-id="c8634-205">Définissez ensuite les propriétés suivantes :</span><span class="sxs-lookup"><span data-stu-id="c8634-205">Then, set the following properties:</span></span>  
  
    -   <span data-ttu-id="c8634-206">Le nom de l'article enfant dans la relation d'enregistrement logique pour la propriété <xref:Microsoft.SqlServer.Replication.MergeJoinFilter.ArticleName%2A> .</span><span class="sxs-lookup"><span data-stu-id="c8634-206">The name of the child article in the logical record relationship for the <xref:Microsoft.SqlServer.Replication.MergeJoinFilter.ArticleName%2A> property.</span></span>  
  
    -   <span data-ttu-id="c8634-207">Le nom de l'article parent existant dans la relation d'enregistrement logique pour la propriété <xref:Microsoft.SqlServer.Replication.MergeJoinFilter.JoinArticleName%2A> .</span><span class="sxs-lookup"><span data-stu-id="c8634-207">The name of the existing, parent article in the logical record relationship for the <xref:Microsoft.SqlServer.Replication.MergeJoinFilter.JoinArticleName%2A> property.</span></span>  
  
    -   <span data-ttu-id="c8634-208">Un nom pour la relation d'enregistrement logique pour la propriété <xref:Microsoft.SqlServer.Replication.MergeJoinFilter.FilterName%2A> .</span><span class="sxs-lookup"><span data-stu-id="c8634-208">A name for the logical record relationship for the <xref:Microsoft.SqlServer.Replication.MergeJoinFilter.FilterName%2A> property.</span></span>  
  
    -   <span data-ttu-id="c8634-209">L'expression qui définit la relation pour la propriété <xref:Microsoft.SqlServer.Replication.MergeJoinFilter.JoinFilterClause%2A> .</span><span class="sxs-lookup"><span data-stu-id="c8634-209">The expression that defines the relationship for the <xref:Microsoft.SqlServer.Replication.MergeJoinFilter.JoinFilterClause%2A> property.</span></span>  
  
    -   <span data-ttu-id="c8634-210">Une valeur de <xref:Microsoft.SqlServer.Replication.FilterTypes.LogicalRecordLink> pour la propriété <xref:Microsoft.SqlServer.Replication.MergeJoinFilter.FilterTypes%2A> .</span><span class="sxs-lookup"><span data-stu-id="c8634-210">A value of <xref:Microsoft.SqlServer.Replication.FilterTypes.LogicalRecordLink> for the <xref:Microsoft.SqlServer.Replication.MergeJoinFilter.FilterTypes%2A> property.</span></span> <span data-ttu-id="c8634-211">Si la relation d'enregistrement logique correspond également à un filtre de jointure, spécifiez une valeur de <xref:Microsoft.SqlServer.Replication.FilterTypes.JoinFilterAndLogicalRecordLink> pour cette propriété.</span><span class="sxs-lookup"><span data-stu-id="c8634-211">If the logical record relationship is also a join filter, specify a value of <xref:Microsoft.SqlServer.Replication.FilterTypes.JoinFilterAndLogicalRecordLink> for this property.</span></span> <span data-ttu-id="c8634-212">Pour plus d’informations, consultez [Regrouper les modifications apportées à des lignes connexes à l’aide d’enregistrements logiques](../merge/group-changes-to-related-rows-with-logical-records.md).</span><span class="sxs-lookup"><span data-stu-id="c8634-212">For more information, see [Group Changes to Related Rows with Logical Records](../merge/group-changes-to-related-rows-with-logical-records.md).</span></span>  
  
9. <span data-ttu-id="c8634-213">Appelez la méthode <xref:Microsoft.SqlServer.Replication.MergeArticle.AddMergeJoinFilter%2A> sur l'objet qui représente l'article enfant dans la relation.</span><span class="sxs-lookup"><span data-stu-id="c8634-213">Call the <xref:Microsoft.SqlServer.Replication.MergeArticle.AddMergeJoinFilter%2A> method on the object that represents the child article in the relationship.</span></span> <span data-ttu-id="c8634-214">Passez l'objet <xref:Microsoft.SqlServer.Replication.MergeJoinFilter> créé à l'étape 8 pour définir la relation.</span><span class="sxs-lookup"><span data-stu-id="c8634-214">Pass the <xref:Microsoft.SqlServer.Replication.MergeJoinFilter> object from step 8 to define the relationship.</span></span>  
  
10. <span data-ttu-id="c8634-215">Répétez les étapes 8 et 9 pour chaque relation d'enregistrement logique restante dans la publication.</span><span class="sxs-lookup"><span data-stu-id="c8634-215">Repeat steps 8 and 9 for each remaining logical record relationship in the publication.</span></span>  
  
###  <a name="example-rmo"></a><a name="PShellExample"></a> <span data-ttu-id="c8634-216">Exemple (RMO)</span><span class="sxs-lookup"><span data-stu-id="c8634-216">Example (RMO)</span></span>  
 <span data-ttu-id="c8634-217">Cet exemple crée un enregistrement logique qui comprend les deux nouveaux articles pour les tables `SalesOrderHeader` et `SalesOrderDetail` .</span><span class="sxs-lookup"><span data-stu-id="c8634-217">This example creates a logical record comprising the two new articles for the `SalesOrderHeader` and `SalesOrderDetail` tables.</span></span>  
  
 [!code-csharp[HowTo#rmo_CreateLogicalRecord](../../../snippets/csharp/SQL15/replication/howto/cs/rmotestevelope.cs#rmo_createlogicalrecord)]  
  
 [!code-vb[HowTo#rmo_vb_CreateLogicalRecord](../../../snippets/visualbasic/SQL15/replication/howto/vb/rmotestenv.vb#rmo_vb_createlogicalrecord)]  
  
## <a name="see-also"></a><span data-ttu-id="c8634-218">Voir aussi</span><span class="sxs-lookup"><span data-stu-id="c8634-218">See Also</span></span>  
 <span data-ttu-id="c8634-219">[Définir et modifier un filtre de jointure entre des articles de fusion](define-and-modify-a-join-filter-between-merge-articles.md) </span><span class="sxs-lookup"><span data-stu-id="c8634-219">[Define and Modify a Join Filter Between Merge Articles](define-and-modify-a-join-filter-between-merge-articles.md) </span></span>  
 <span data-ttu-id="c8634-220">[Définir et modifier un filtre de lignes paramétrable pour un article de fusion](define-and-modify-a-parameterized-row-filter-for-a-merge-article.md) </span><span class="sxs-lookup"><span data-stu-id="c8634-220">[Define and Modify a Parameterized Row Filter for a Merge Article](define-and-modify-a-parameterized-row-filter-for-a-merge-article.md) </span></span>  
 <span data-ttu-id="c8634-221">[Définir et modifier un filtre de lignes statique](define-and-modify-a-static-row-filter.md) </span><span class="sxs-lookup"><span data-stu-id="c8634-221">[Define and Modify a Static Row Filter](define-and-modify-a-static-row-filter.md) </span></span>  
 <span data-ttu-id="c8634-222">[Regrouper les modifications apportées à des lignes connexes à l’aide d’enregistrements logiques](../merge/group-changes-to-related-rows-with-logical-records.md) </span><span class="sxs-lookup"><span data-stu-id="c8634-222">[Group Changes to Related Rows with Logical Records](../merge/group-changes-to-related-rows-with-logical-records.md) </span></span>  
 <span data-ttu-id="c8634-223">[Optimiser les performances des filtres paramétrés avec des partitions précalculées](../merge/parameterized-filters-optimize-for-precomputed-partitions.md) </span><span class="sxs-lookup"><span data-stu-id="c8634-223">[Optimize Parameterized Filter Performance with Precomputed Partitions](../merge/parameterized-filters-optimize-for-precomputed-partitions.md) </span></span>  
 [<span data-ttu-id="c8634-224">Regrouper les modifications apportées à des lignes connexes à l’aide d’enregistrements logiques</span><span class="sxs-lookup"><span data-stu-id="c8634-224">Group Changes to Related Rows with Logical Records</span></span>](../merge/group-changes-to-related-rows-with-logical-records.md)  
  
  
