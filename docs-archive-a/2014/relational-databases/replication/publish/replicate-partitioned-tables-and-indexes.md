---
title: Répliquer des tables et des index partitionnés | Microsoft Docs
ms.custom: ''
ms.date: 09/10/2015
ms.prod: sql-server-2014
ms.reviewer: ''
ms.technology: replication
ms.topic: conceptual
helpviewer_keywords:
- partitioned indexes [SQL Server], replicating
- partitioned tables [SQL Server], replicating
- replication [SQL Server], partitioned tables
- publishing [SQL Server replication], partitioned tables
- transactional replication, partitioned tables
ms.assetid: c9fa81b1-6c81-4c11-927b-fab16301a8f5
author: MashaMSFT
ms.author: mathoma
ms.openlocfilehash: 616707bfb11b48b170fc8f0e8872076d2cd09d1c
ms.sourcegitcommit: ad4d92dce894592a259721a1571b1d8736abacdb
ms.translationtype: MT
ms.contentlocale: fr-FR
ms.lasthandoff: 08/04/2020
ms.locfileid: "87602048"
---
# <a name="replicate-partitioned-tables-and-indexes"></a><span data-ttu-id="78b7d-102">Répliquer des tables et des index partitionnés</span><span class="sxs-lookup"><span data-stu-id="78b7d-102">Replicate Partitioned Tables and Indexes</span></span>
  <span data-ttu-id="78b7d-103">Le partitionnement facilite la gestion des tables et des index de grande taille, car il permet de gérer et d'accéder rapidement et efficacement à des sous-ensembles de données, tout en conservant l'intégrité d'une collecte de données.</span><span class="sxs-lookup"><span data-stu-id="78b7d-103">Partitioning makes large tables or indexes more manageable because partitioning enables you to manage and access subsets of data quickly and efficiently, and maintain the integrity of a data collection at the same time.</span></span> <span data-ttu-id="78b7d-104">Pour plus d’informations, consultez [Tables et index partitionnés](../../partitions/partitioned-tables-and-indexes.md).</span><span class="sxs-lookup"><span data-stu-id="78b7d-104">For more information, see [Partitioned Tables and Indexes](../../partitions/partitioned-tables-and-indexes.md).</span></span> <span data-ttu-id="78b7d-105">La réplication prend en charge le partitionnement en fournissant un ensemble de propriétés qui indiquent comment les tables et les index partitionnés doivent être traités.</span><span class="sxs-lookup"><span data-stu-id="78b7d-105">Replication supports partitioning by providing a set of properties that specify how partitioned tables and indexes should be treated.</span></span>  
  
## <a name="article-properties-for-transactional-and-merge-replication"></a><span data-ttu-id="78b7d-106">Propriétés d'article pour la réplication transactionnelle et de fusion</span><span class="sxs-lookup"><span data-stu-id="78b7d-106">Article Properties for Transactional and Merge Replication</span></span>  
 <span data-ttu-id="78b7d-107">Le tableau suivant répertorie les objets utilisés pour partitionner des données.</span><span class="sxs-lookup"><span data-stu-id="78b7d-107">The following table lists the objects that are used to partition data.</span></span>  
  
|<span data-ttu-id="78b7d-108">Object</span><span class="sxs-lookup"><span data-stu-id="78b7d-108">Object</span></span>|<span data-ttu-id="78b7d-109">Créé en utilisant</span><span class="sxs-lookup"><span data-stu-id="78b7d-109">Created by using</span></span>|  
|------------|----------------------|  
|<span data-ttu-id="78b7d-110">Table ou index partitionné</span><span class="sxs-lookup"><span data-stu-id="78b7d-110">Partitioned table or index</span></span>|<span data-ttu-id="78b7d-111">CREATE TABLE ou CREATE INDEX</span><span class="sxs-lookup"><span data-stu-id="78b7d-111">CREATE TABLE or CREATE INDEX</span></span>|  
|<span data-ttu-id="78b7d-112">Fonction de partition</span><span class="sxs-lookup"><span data-stu-id="78b7d-112">Partition function</span></span>|<span data-ttu-id="78b7d-113">CREATE PARTITION FUNCTION</span><span class="sxs-lookup"><span data-stu-id="78b7d-113">CREATE PARTITION FUNCTION</span></span>|  
|<span data-ttu-id="78b7d-114">Schéma de partition</span><span class="sxs-lookup"><span data-stu-id="78b7d-114">Partition scheme</span></span>|<span data-ttu-id="78b7d-115">CREATE PARTITION SCHEME</span><span class="sxs-lookup"><span data-stu-id="78b7d-115">CREATE PARTITION SCHEME</span></span>|  
  
 <span data-ttu-id="78b7d-116">Le premier ensemble de propriétés en rapport avec le partitionnement correspond aux options de schéma d'article qui déterminent si le partitionnement d'objets doit être copié vers l'Abonné.</span><span class="sxs-lookup"><span data-stu-id="78b7d-116">The first set of properties related to partitioning are the article schema options that determine whether partitioning objects should be copied to the Subscriber.</span></span> <span data-ttu-id="78b7d-117">Ces options de schéma peuvent être définies de plusieurs façons :</span><span class="sxs-lookup"><span data-stu-id="78b7d-117">These schema options can be set in the following ways:</span></span>  
  
-   <span data-ttu-id="78b7d-118">Sur la page **Propriétés de l'article** de l'Assistant Nouvelle publication ou la boîte de dialogue Propriétés de la publication.</span><span class="sxs-lookup"><span data-stu-id="78b7d-118">In the **Article Properties** page of the New Publication Wizard or the Publication Properties dialog box.</span></span> <span data-ttu-id="78b7d-119">Pour copier les objets listés dans le tableau précédent, spécifiez `true` la valeur pour les propriétés **copier les schémas de partition de table** et copier les schémas de partition d' **index**.</span><span class="sxs-lookup"><span data-stu-id="78b7d-119">To copy the objects listed in the previous table, specify a value of `true` for the properties **Copy table partitioning schemes** and **Copy index partitioning schemes**.</span></span> <span data-ttu-id="78b7d-120">Pour plus d’informations sur la façon d’accéder à la page **Propriétés de l’article**, consultez [Afficher et modifier des propriétés de publication](view-and-modify-publication-properties.md).</span><span class="sxs-lookup"><span data-stu-id="78b7d-120">For information about how to access the **Article Properties** page, see [View and Modify Publication Properties](view-and-modify-publication-properties.md).</span></span>  
  
-   <span data-ttu-id="78b7d-121">En utilisant le paramètre *schema_option* de l'une des procédures stockées suivantes :</span><span class="sxs-lookup"><span data-stu-id="78b7d-121">By using the *schema_option* parameter of one of the following stored procedures:</span></span>  
  
    -   <span data-ttu-id="78b7d-122">[sp_addarticle](/sql/relational-databases/system-stored-procedures/sp-addarticle-transact-sql) ou [sp_changearticle](/sql/relational-databases/system-stored-procedures/sp-changearticle-transact-sql) pour la réplication transactionnelle</span><span class="sxs-lookup"><span data-stu-id="78b7d-122">[sp_addarticle](/sql/relational-databases/system-stored-procedures/sp-addarticle-transact-sql) or [sp_changearticle](/sql/relational-databases/system-stored-procedures/sp-changearticle-transact-sql) for transactional replication</span></span>  
  
    -   <span data-ttu-id="78b7d-123">[sp_addmergearticle](/sql/relational-databases/system-stored-procedures/sp-addmergearticle-transact-sql) ou [sp_changemergearticle](/sql/relational-databases/system-stored-procedures/sp-changemergearticle-transact-sql) pour la réplication de fusion</span><span class="sxs-lookup"><span data-stu-id="78b7d-123">[sp_addmergearticle](/sql/relational-databases/system-stored-procedures/sp-addmergearticle-transact-sql) or [sp_changemergearticle](/sql/relational-databases/system-stored-procedures/sp-changemergearticle-transact-sql) for merge replication</span></span>  
  
     <span data-ttu-id="78b7d-124">Pour copier les objets répertoriés dans le tableau précédent, spécifiez les valeurs d'options de schéma appropriées.</span><span class="sxs-lookup"><span data-stu-id="78b7d-124">To copy the objects listed in the previous table, specify the appropriate schema option values.</span></span> <span data-ttu-id="78b7d-125">Pour plus d'informations sur la spécification d'options de schéma, consultez [Specify Schema Options](specify-schema-options.md).</span><span class="sxs-lookup"><span data-stu-id="78b7d-125">For information about how to specify schema options, see [Specify Schema Options](specify-schema-options.md).</span></span>  
  
 <span data-ttu-id="78b7d-126">La réplication copie les objets vers l'Abonné pendant la synchronisation initiale.</span><span class="sxs-lookup"><span data-stu-id="78b7d-126">Replication copies objects to the Subscriber during the initial synchronization.</span></span> <span data-ttu-id="78b7d-127">Si le schéma de partition utilise des groupes de fichiers autres que le groupe de fichiers PRIMARY, ces groupes de fichiers doivent exister sur l'Abonné avant la synchronisation initiale.</span><span class="sxs-lookup"><span data-stu-id="78b7d-127">If the partition scheme uses filegroups other than the PRIMARY filegroup, those filegroups must exist on the Subscriber before the initial synchronization.</span></span>  
  
 <span data-ttu-id="78b7d-128">Après avoir initialisé l'Abonné, les modifications de données sont propagées à l'Abonné et appliquées aux partitions appropriées.</span><span class="sxs-lookup"><span data-stu-id="78b7d-128">After the Subscriber is initialized, data changes are propagated to the Subscriber and applied to the appropriate partitions.</span></span> <span data-ttu-id="78b7d-129">Toutefois, les modifications apportées au schéma de partition ne sont pas prises en charge.</span><span class="sxs-lookup"><span data-stu-id="78b7d-129">However, changes to the partition scheme are not supported.</span></span> <span data-ttu-id="78b7d-130">La réplication transactionnelle et de fusion ne prend pas en charge la réplication des commandes suivantes : ALTER PARTITION FUNCTION, ALTER PARTITION SCHEME ou l’instruction REBUILD WITH PARTITION d’ALTER INDEX.</span><span class="sxs-lookup"><span data-stu-id="78b7d-130">Transactional and merge replication do not support replicating the following commands: ALTER PARTITION FUNCTION, ALTER PARTITION SCHEME, or the REBUILD WITH PARTITION statement of ALTER INDEX.</span></span>  <span data-ttu-id="78b7d-131">Les modifications associées ne sont pas automatiquement répliquées sur l’Abonné.</span><span class="sxs-lookup"><span data-stu-id="78b7d-131">The changes associated with them will not be automatically replicated to the Subscriber.</span></span> <span data-ttu-id="78b7d-132">Il incombe à l'utilisateur d'apporter des modifications similaires manuellement sur l'Abonné.</span><span class="sxs-lookup"><span data-stu-id="78b7d-132">It is the responsibility of the user to make similar changes manually at the Subscriber.</span></span>  
  
## <a name="replication-support-for-partition-switching"></a><span data-ttu-id="78b7d-133">Prise en charge de la réplication pour le basculement de partition</span><span class="sxs-lookup"><span data-stu-id="78b7d-133">Replication Support for Partition Switching</span></span>  
 <span data-ttu-id="78b7d-134">La possibilité de déplacer rapidement et efficacement des sous-ensembles de données entre des partitions constitue l'un des principaux avantages du partitionnement de table.</span><span class="sxs-lookup"><span data-stu-id="78b7d-134">One of the key benefits of table partitioning is the ability to quickly and efficiently move subsets of data between partitions.</span></span> <span data-ttu-id="78b7d-135">Les données sont déplacées à l'aide de la commande SWITCH PARTITION.</span><span class="sxs-lookup"><span data-stu-id="78b7d-135">Data is moved by using the SWITCH PARTITION command.</span></span> <span data-ttu-id="78b7d-136">Par défaut, lorsqu'une table est activée pour la réplication, les opérations SWITCH PARTITION sont bloquées pour les raisons suivantes :</span><span class="sxs-lookup"><span data-stu-id="78b7d-136">By default, when a table is enabled for replication, SWITCH PARTITION operations are blocked for the following reasons:</span></span>  
  
-   <span data-ttu-id="78b7d-137">Si les données sont déplacées dans ou hors d'une table qui existe sur le serveur de publication mais pas sur l'Abonné, le serveur de publication et l'Abonné risquent de devenir incohérents entre eux.</span><span class="sxs-lookup"><span data-stu-id="78b7d-137">If data is moved into or out of a table that exists at the Publisher but does not exist at the Subscriber, the Publisher and Subscriber could become inconsistent with one another.</span></span> <span data-ttu-id="78b7d-138">Ce problème se produit généralement lorsque les données sont déplacées dans ou hors d'une table intermédiaire.</span><span class="sxs-lookup"><span data-stu-id="78b7d-138">This problem typically occurs when data is moved into or out of a staging table.</span></span>  
  
-   <span data-ttu-id="78b7d-139">Si l'Abonné et le serveur de publication ont des définitions différentes pour la table partitionnée, l'Agent de distribution échouera lorsqu'il tentera d'appliquer des modifications à l'Abonné.</span><span class="sxs-lookup"><span data-stu-id="78b7d-139">If the Subscriber has a different definition for the partitioned table than the Publisher, the Distribution Agent will fail when it tries to apply changes at the Subscriber.</span></span>  
  
 <span data-ttu-id="78b7d-140">Malgré ces problèmes potentiels, le basculement de partition peut être activé pour la réplication transactionnelle.</span><span class="sxs-lookup"><span data-stu-id="78b7d-140">Despite these potential issues, partition switching can be enabled for transactional replication.</span></span> <span data-ttu-id="78b7d-141">Avant d'activer le basculement de partition, assurez-vous que toutes les tables impliquées dans cette opération existent sur le serveur de publication et sur l'Abonné, et vérifiez que la définition des tables et de la partition sont identiques.</span><span class="sxs-lookup"><span data-stu-id="78b7d-141">Before you enable partition switching, make sure that all tables that are involved in partition switching exist at the Publisher and Subscriber, and make sure that the table and partition definitions are the same.</span></span>  
  
 <span data-ttu-id="78b7d-142">Lorsque des partitions ont exactement le même schéma de partition sur les serveurs de publication et les abonnés, vous pouvez activer *allow_partition_switch* avec *replication_partition_switch* pour répliquer uniquement l'instruction de basculement de partition vers l'abonné.</span><span class="sxs-lookup"><span data-stu-id="78b7d-142">When partitions have the exact same partition scheme at the publishers and subscribers you can turn on *allow_partition_switch* along with *replication_partition_switch* which will only replicate the partition switch statement to the subscriber.</span></span> <span data-ttu-id="78b7d-143">Vous pouvez également activer *allow_partition_switch* sans répliquer le DDL.</span><span class="sxs-lookup"><span data-stu-id="78b7d-143">You can also turn on *allow_partition_switch* without replicating the DDL.</span></span> <span data-ttu-id="78b7d-144">Cela s'avère utile lorsque vous souhaitez supprimer des mois antérieurs de la partition tout en conservant la réplication de la partition pendant une autre année à des fins de sauvegarde sur l'abonné.</span><span class="sxs-lookup"><span data-stu-id="78b7d-144">This is useful in the case where you want to roll old months out of the partition but keep the replicated partition in place for another year for backup purposes at the subscriber.</span></span>  
  
 <span data-ttu-id="78b7d-145">Si vous activez le basculement de partition (sur SQL Server 2008 R2 jusqu’à la version actuelle), vous devrez peut-être également fractionner et fusionner des opérations dans un futur proche.</span><span class="sxs-lookup"><span data-stu-id="78b7d-145">If you enable partition switching on SQL Server 2008 R2 through the current version, you might also need split and merge operations in near future.</span></span> <span data-ttu-id="78b7d-146">Avant d’exécuter une opération de fractionnement ou de fusion sur une table répliquée, vérifiez que la partition en question n’a pas de commandes répliquées en attente.</span><span class="sxs-lookup"><span data-stu-id="78b7d-146">Before executing a split or merge operation on a replicated table ensure that the partition in question does not have any pending replicated commands.</span></span> <span data-ttu-id="78b7d-147">Vous devez également vous assurer qu’aucune opération DML n’est exécutée sur la partition pendant les opérations de fractionnement et de fusion.</span><span class="sxs-lookup"><span data-stu-id="78b7d-147">You should also ensure that no DML operations are executed on the partition during the split and merge operations.</span></span> <span data-ttu-id="78b7d-148">Si des transactions n’ont pas été traitées par le lecteur de journal ou que des opérations DML sont exécutées sur la partition d’une table répliquée en même temps qu’une opération de fractionnement ou de fusion (sur la même partition), il est possible que l’Agent de lecture du journal fasse l’objet d’une erreur de traitement.</span><span class="sxs-lookup"><span data-stu-id="78b7d-148">If there are transactions which the log reader has not processed, or if DML operations are performed on a partition of a replicated table while a split or merge operation is executed (involving the same partition), it could lead to a processing error with log reader agent.</span></span> <span data-ttu-id="78b7d-149">Pour corriger l'erreur, une réinitialisation de l'abonnement peut s'avérer nécessaire.</span><span class="sxs-lookup"><span data-stu-id="78b7d-149">In order to correct the error, it might require a re-initialization of the subscription.</span></span>  
  
> [!WARNING]  
>  <span data-ttu-id="78b7d-150">Vous ne devez pas activer le basculement de partition pour les publications d'égal à égal, en raison de la colonne masquée utilisée pour détecter et résoudre le conflit.</span><span class="sxs-lookup"><span data-stu-id="78b7d-150">You should not enable partition switching for Peer-to-Peer publications, due to the hidden column which is used to detect and resolve conflict.</span></span>  
  
### <a name="enabling-partition-switching"></a><span data-ttu-id="78b7d-151">Activation du basculement de partition</span><span class="sxs-lookup"><span data-stu-id="78b7d-151">Enabling Partition Switching</span></span>  
 <span data-ttu-id="78b7d-152">Les propriétés suivantes pour les publications transactionnelles permettent aux utilisateurs de contrôler le comportement de l'insertion de partition dans un environnement répliqué :</span><span class="sxs-lookup"><span data-stu-id="78b7d-152">The following properties for transactional publications enable users to control the behavior of partition switching in a replicated environment:</span></span>  
  
-   <span data-ttu-id="78b7d-153">\*\* \@ allow_partition_switch\*\*, si la valeur `true` est, Switch partition peut être exécuté sur la base de données de publication.</span><span class="sxs-lookup"><span data-stu-id="78b7d-153">**\@allow_partition_switch**, when set to `true`, SWITCH PARTITION can be executed against the publication database.</span></span>  
  
-   <span data-ttu-id="78b7d-154">\*\* \@ replicate_partition_switch\*\* détermine si l’instruction switch partition DDL doit être répliquée sur les abonnés.</span><span class="sxs-lookup"><span data-stu-id="78b7d-154">**\@replicate_partition_switch** determines whether the SWITCH PARTITION DDL statement should be replicated to Subscribers.</span></span> <span data-ttu-id="78b7d-155">Cette option est valide uniquement lorsque \*\* \@ allow_partition_switch\*\* a la valeur `true` .</span><span class="sxs-lookup"><span data-stu-id="78b7d-155">This option is valid only when **\@allow_partition_switch** is set to `true`.</span></span>  
  
 <span data-ttu-id="78b7d-156">Vous pouvez définir ces propriétés en utilisant [sp_addpublication](/sql/relational-databases/system-stored-procedures/sp-addpublication-transact-sql) lors de la création de la publication, ou en utilisant [sp_changepublication](/sql/relational-databases/system-stored-procedures/sp-changepublication-transact-sql) après la création de la publication.</span><span class="sxs-lookup"><span data-stu-id="78b7d-156">You can set these properties by using [sp_addpublication](/sql/relational-databases/system-stored-procedures/sp-addpublication-transact-sql) when the publication is created, or by using [sp_changepublication](/sql/relational-databases/system-stored-procedures/sp-changepublication-transact-sql) after the publication is created.</span></span> <span data-ttu-id="78b7d-157">Comme indiqué précédemment, la réplication de fusion ne prend pas en charge le basculement de partition.</span><span class="sxs-lookup"><span data-stu-id="78b7d-157">As noted earlier, merge replication does not support partition switching.</span></span> <span data-ttu-id="78b7d-158">Pour exécuter SWITCH PARTITION sur une table qui est activée pour la réplication de fusion, supprimez la table de la publication.</span><span class="sxs-lookup"><span data-stu-id="78b7d-158">To execute SWITCH PARTITION on a table that is enabled for merge replication, remove the table from the publication.</span></span>  
  
## <a name="see-also"></a><span data-ttu-id="78b7d-159">Voir aussi</span><span class="sxs-lookup"><span data-stu-id="78b7d-159">See Also</span></span>  
 [<span data-ttu-id="78b7d-160">Publier des données et des objets de base de données</span><span class="sxs-lookup"><span data-stu-id="78b7d-160">Publish Data and Database Objects</span></span>](publish-data-and-database-objects.md)  
  
  
