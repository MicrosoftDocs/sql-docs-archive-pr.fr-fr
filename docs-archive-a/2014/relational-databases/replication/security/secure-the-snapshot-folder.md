---
title: Sécuriser le dossier d’instantanés | Microsoft Docs
ms.custom: ''
ms.date: 03/06/2017
ms.prod: sql-server-2014
ms.reviewer: ''
ms.technology: replication
ms.topic: conceptual
helpviewer_keywords:
- snapshots [SQL Server replication], security
ms.assetid: 3cd877d1-ffb8-48fd-a72b-98eb948aad27
author: MashaMSFT
ms.author: mathoma
ms.openlocfilehash: c977936ad2aca6e5a98ee685a15662a00b625494
ms.sourcegitcommit: ad4d92dce894592a259721a1571b1d8736abacdb
ms.translationtype: MT
ms.contentlocale: fr-FR
ms.lasthandoff: 08/04/2020
ms.locfileid: "87612225"
---
# <a name="secure-the-snapshot-folder"></a><span data-ttu-id="288fc-102">Sécuriser le dossier d'instantané</span><span class="sxs-lookup"><span data-stu-id="288fc-102">Secure the Snapshot Folder</span></span>
  <span data-ttu-id="288fc-103">Le dossier d'instantané est un répertoire qui stocke les fichiers d'instantanés ; il vous est recommandé de dédier ce dossier au stockage des instantanés.</span><span class="sxs-lookup"><span data-stu-id="288fc-103">The snapshot folder is a directory that stores snapshot files; it is recommended that you dedicate the directory for snapshot storage.</span></span> <span data-ttu-id="288fc-104">Accordez à l'Agent d'instantané l'autorisation d'écriture sur ce dossier, et assurez-vous que l'autorisation de lecture n'est accordée qu'au compte Windows qu'utilise l'Agent de fusion ou l'Agent de distribution lorsqu'il accède à ce dossier.</span><span class="sxs-lookup"><span data-stu-id="288fc-104">Grant the Snapshot Agent write permission to the folder, and ensure that read permission is granted only to the Windows account that the Merge Agent or Distribution agent uses when accessing the folder.</span></span> <span data-ttu-id="288fc-105">Pour accéder à un dossier d'instantané situé sur un ordinateur distant, le compte Windows associé à l'Agent doit être un compte de domaine.</span><span class="sxs-lookup"><span data-stu-id="288fc-105">The Windows account associated with the agent must be a domain account to access a snapshot folder that is located on a remote computer.</span></span>  
  
> [!NOTE]  
>  <span data-ttu-id="288fc-106">Le contrôle de compte d'utilisateur (UAC) aide les administrateurs à gérer leurs droits utilisateur élevés (parfois appelés *privilèges*).</span><span class="sxs-lookup"><span data-stu-id="288fc-106">User Account Control (UAC)  helps administrators manage their elevated user rights (sometimes called *privileges*).</span></span> <span data-ttu-id="288fc-107">Dans les systèmes d'exploitation dans lesquels le contrôle de compte d'utilisateur est activé, les administrateurs n'utilisent pas leurs droits d'administration.</span><span class="sxs-lookup"><span data-stu-id="288fc-107">When running on operating systems that have UAC enabled, administrators do not use their administrative rights.</span></span> <span data-ttu-id="288fc-108">À la place, ils effectuent la plupart des actions en tant qu'utilisateurs standard (non administratifs), assumant temporairement leurs droits d'administration seulement lorsque cela est nécessaire.</span><span class="sxs-lookup"><span data-stu-id="288fc-108">Instead, they perform most actions as standard (non-administrative) users, temporarily assuming their administrative rights only when it is required.</span></span> <span data-ttu-id="288fc-109">La fonctionnalité Contrôle de compte d'utilisateur peut empêcher l'accès administratif au partage de fichiers d'instantanés.</span><span class="sxs-lookup"><span data-stu-id="288fc-109">UAC can prevent administrative access to the snapshot share.</span></span> <span data-ttu-id="288fc-110">Vous devez donc octroyer explicitement des autorisations sur le partage de fichiers d'instantanés aux comptes Windows qui sont utilisés par l'Agent d'instantané, l'Agent de distribution et l'Agent de fusion.</span><span class="sxs-lookup"><span data-stu-id="288fc-110">You must therefore explicitly grant snapshot share permissions to the Windows accounts that are used by the Snapshot Agent, Distribution Agent, and Merge Agent.</span></span> <span data-ttu-id="288fc-111">Vous devez effectuer cette opération même si les comptes Windows sont membres du groupe Administrateurs.</span><span class="sxs-lookup"><span data-stu-id="288fc-111">You must do this even if the Windows accounts are members of the Administrators group.</span></span>  
  
 <span data-ttu-id="288fc-112">Quand vous configurez un serveur de distribution au moyen de l’Assistant Configuration de distribution ou de l’Assistant Nouvelle publication, le dossier d’instantané est installé par défaut sur un chemin local : X:\Program Files\Microsoft SQL Server\\ *\<instance>* \MSSQL\ReplData.</span><span class="sxs-lookup"><span data-stu-id="288fc-112">When configuring a Distributor through the Configure Distribution Wizard or the New Publication Wizard, the snapshot folder defaults to a local path: X:\Program Files\Microsoft SQL Server\\*\<instance>* \MSSQL\ReplData.</span></span> <span data-ttu-id="288fc-113">Si vous utilisez un serveur de distribution distant ou des abonnements par extraction, vous devez spécifier un partage réseau UNC (tel que \\\\<*nom_ordinateur>* \snapshot) plutôt qu’un chemin local.</span><span class="sxs-lookup"><span data-stu-id="288fc-113">If you are using a remote Distributor or pull subscriptions, you must specify a UNC network share (such as \\\\<*computername>* \snapshot) rather than a local path.</span></span>  
  
 <span data-ttu-id="288fc-114">Lorsque vous accordez des autorisations d'accès au dossier d'instantané, faites-le en fonction du mode d'accès au dossier.</span><span class="sxs-lookup"><span data-stu-id="288fc-114">When granting permissions to access the snapshot folder, you must grant them according to the way in which the folder is accessed.</span></span> <span data-ttu-id="288fc-115">Les onglets de boîte de dialogue suivants sont utilisés dans [!INCLUDE[msCoName](../../../includes/msconame-md.md)] Windows 2003 :</span><span class="sxs-lookup"><span data-stu-id="288fc-115">The following dialog box tabs are used in [!INCLUDE[msCoName](../../../includes/msconame-md.md)] Windows 2003:</span></span>  
  
-   <span data-ttu-id="288fc-116">Si vous spécifiez un chemin local, accordez les autorisations dans l'onglet **Sécurité** de la boîte de dialogue **Propriétés** du dossier.</span><span class="sxs-lookup"><span data-stu-id="288fc-116">If you specify a local path, grant permissions through the **Security** tab of the **Properties** dialog box for the folder.</span></span>  
  
-   <span data-ttu-id="288fc-117">Si vous spécifiez un partage réseau, accordez les autorisations dans l'onglet **Partage** de la boîte de dialogue **Propriétés** du dossier.</span><span class="sxs-lookup"><span data-stu-id="288fc-117">If you specify a network share, grant permissions through the **Sharing** tab of the **Properties** dialog box for the folder.</span></span>  
  
    > [!NOTE]  
    >  <span data-ttu-id="288fc-118">Si l'agent de réplication est exécuté sur le serveur de distribution, utilisez les options de l'onglet **Sécurité** (boîte de dialogue **Propriétés** ) du dossier pour accorder des autorisations au compte Windows servant à l'exécution de l'agent.</span><span class="sxs-lookup"><span data-stu-id="288fc-118">If the replication agent runs on the Distributor, use the **Security** tab of the **Properties** dialog box for the folder to grant permissions to the Windows account used to run the agent.</span></span> <span data-ttu-id="288fc-119">Faites-le même si vous utilisez un partage réseau.</span><span class="sxs-lookup"><span data-stu-id="288fc-119">Do this even when a network share is used.</span></span> <span data-ttu-id="288fc-120">Cette situation concerne l'Agent de fusion et l'Agent de distribution dans le cadre d'un abonnement par envoi de données (push) et l'Agent d'instantané lorsque les serveurs de publication et de distribution se trouvent sur le même ordinateur.</span><span class="sxs-lookup"><span data-stu-id="288fc-120">This applies to the Merge Agent and Distribution Agent for a push subscription and to the Snapshot Agent when the Publisher and Distributor are on the same computer.</span></span>  
  
 <span data-ttu-id="288fc-121">Pour plus d'informations sur la définition d'autorisations pour les chemins locaux et les partages réseau, consultez la documentation Windows.</span><span class="sxs-lookup"><span data-stu-id="288fc-121">For more information about setting permissions for local paths and network shares, see the Windows documentation.</span></span>  
  
> [!NOTE]  
>  <span data-ttu-id="288fc-122">Si une publication est abandonnée, la réplication tente de supprimer le dossier d'instantané dans le contexte de sécurité du compte de service [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] .</span><span class="sxs-lookup"><span data-stu-id="288fc-122">If a publication is dropped, replication attempts to remove the snapshot folder under the security context of the [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] service account.</span></span> <span data-ttu-id="288fc-123">Si ce compte ne détient pas les privilèges suffisants, connectez-vous à l'aide d'un compte qui dispose des bons privilèges et supprimez le dossier manuellement.</span><span class="sxs-lookup"><span data-stu-id="288fc-123">If this account does not have sufficient privileges, log in with an account that does have sufficient privileges and remove the folder manually.</span></span> <span data-ttu-id="288fc-124">La suppression d'un dossier nécessite le privilège **Modification** si le dossier a un chemin local, et le privilège **Contrôle total** si le dossier a un chemin réseau.</span><span class="sxs-lookup"><span data-stu-id="288fc-124">Removing a folder requires the **Modify** privilege if the folder is a local path or the **Full Control** privilege if the folder is a network path.</span></span>  
  
## <a name="delivering-snapshots-through-ftp"></a><span data-ttu-id="288fc-125">Remise d'instantanés via FTP</span><span class="sxs-lookup"><span data-stu-id="288fc-125">Delivering Snapshots Through FTP</span></span>  
 <span data-ttu-id="288fc-126">Une pratique de sécurité vous recommande de stocker les instantanés dans un partage UNC, mais ils peuvent également être stockés dans un partage FTP puis remis à un Abonné via FTP.</span><span class="sxs-lookup"><span data-stu-id="288fc-126">It is recommended as a security best practice that snapshots be stored in a UNC share, but snapshots can be stored in an FTP share and then delivered to a Subscriber through FTP.</span></span> <span data-ttu-id="288fc-127">Lors de la configuration du serveur FTP, assurez-vous que le répertoire virtuel expose un partage UNC sous-jacent qui accorde à l'Agent d'instantané un accès en écriture pour la publication.</span><span class="sxs-lookup"><span data-stu-id="288fc-127">When configuring the FTP server, ensure that the virtual directory exposes an underlying UNC share that permits write access by the Snapshot Agent for the publication.</span></span>  
  
 <span data-ttu-id="288fc-128">Pour configurer un Abonné pour qu'il récupère l'instantané via FTP, commencez par configurer un serveur FTP avec un nom de connexion et un mot de passe FTP donnant aux Abonnés un accès en lecture (ou accès « get ») pour leur permettre de télécharger les fichiers d'instantanés.</span><span class="sxs-lookup"><span data-stu-id="288fc-128">To configure a Subscriber to retrieve the Snapshot via FTP, first set up an FTP server with an FTP login and password that allows Subscribers read (or "get") access to allow the snapshot files to be downloaded.</span></span>  
  
 <span data-ttu-id="288fc-129">Pour remettre des instantanés via FTP, consultez [Remettre un instantané via FTP](../publish/deliver-a-snapshot-through-ftp.md).</span><span class="sxs-lookup"><span data-stu-id="288fc-129">To deliver snapshots through FTP, see [Deliver a Snapshot Through FTP](../publish/deliver-a-snapshot-through-ftp.md).</span></span>  
  
 <span data-ttu-id="288fc-130">Pour plus d'informations sur la définition et la modification du mot de passe d'accès aux instantanés via FTP, consultez la section « Remise d'instantanés via FTP » dans [Secure the Publisher](secure-the-publisher.md).</span><span class="sxs-lookup"><span data-stu-id="288fc-130">For information about setting and changing the password for access to snapshots through FTP, see the section "FTP Snapshot Delivery" in the topic [Secure the Publisher](secure-the-publisher.md).</span></span>  
  
## <a name="see-also"></a><span data-ttu-id="288fc-131">Voir aussi</span><span class="sxs-lookup"><span data-stu-id="288fc-131">See Also</span></span>  
 <span data-ttu-id="288fc-132">[Autres emplacements de dossier d’instantanés](../alternate-snapshot-folder-locations.md) </span><span class="sxs-lookup"><span data-stu-id="288fc-132">[Alternate Snapshot Folder Locations](../alternate-snapshot-folder-locations.md) </span></span>  
 <span data-ttu-id="288fc-133">[Initialiser un abonnement avec un instantané](../initialize-a-subscription-with-a-snapshot.md) </span><span class="sxs-lookup"><span data-stu-id="288fc-133">[Initialize a Subscription with a Snapshot](../initialize-a-subscription-with-a-snapshot.md) </span></span>  
 <span data-ttu-id="288fc-134">[Replication Security Best Practices](replication-security-best-practices.md) </span><span class="sxs-lookup"><span data-stu-id="288fc-134">[Replication Security Best Practices](replication-security-best-practices.md) </span></span>  
 <span data-ttu-id="288fc-135">[Sécurité Réplication SQL Server](view-and-modify-replication-security-settings.md) </span><span class="sxs-lookup"><span data-stu-id="288fc-135">[SQL Server Replication Security](view-and-modify-replication-security-settings.md) </span></span>  
 [<span data-ttu-id="288fc-136">Transférer des instantanés via FTP</span><span class="sxs-lookup"><span data-stu-id="288fc-136">Transfer Snapshots Through FTP</span></span>](../transfer-snapshots-through-ftp.md)  
  
  
