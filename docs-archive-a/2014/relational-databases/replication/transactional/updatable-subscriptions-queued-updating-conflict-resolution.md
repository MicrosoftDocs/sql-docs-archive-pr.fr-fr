---
title: Détection et résolution des conflits de mise à jour en attente | Microsoft Docs
ms.custom: ''
ms.date: 06/13/2017
ms.prod: sql-server-2014
ms.reviewer: ''
ms.technology: replication
ms.topic: conceptual
helpviewer_keywords:
- conflict resolution [SQL Server replication], queued updating subscriptions
- viewing queued updating conflicts
- conflict resolution [SQL Server replication]
- queued updating subscriptions [SQL Server replication]
- articles [SQL Server replication], conflict resolution
ms.assetid: 084ac587-25e7-4bd0-a385-556bbe07d02f
author: MashaMSFT
ms.author: mathoma
ms.openlocfilehash: 8c4608347ab119e25caa45b0ee4a592a953e34a4
ms.sourcegitcommit: ad4d92dce894592a259721a1571b1d8736abacdb
ms.translationtype: MT
ms.contentlocale: fr-FR
ms.lasthandoff: 08/04/2020
ms.locfileid: "87614489"
---
# <a name="queued-updating-conflict-detection-and-resolution"></a><span data-ttu-id="4a771-102">Queued Updating Conflict Detection and Resolution</span><span class="sxs-lookup"><span data-stu-id="4a771-102">Queued Updating Conflict Detection and Resolution</span></span>
  <span data-ttu-id="4a771-103">Étant donné que les abonnements mis à jour en attente permettent d'apporter des modifications aux mêmes données à différents emplacements, des conflits sont susceptibles de se produire lors de la synchronisation des données sur le serveur de publication.</span><span class="sxs-lookup"><span data-stu-id="4a771-103">Because queued updating subscriptions allow modifications to the same data at multiple locations, there may be conflicts when data is synchronized at the Publisher.</span></span> <span data-ttu-id="4a771-104">La réplication détecte les éventuels conflits lors de la synchronisation des modifications avec le serveur de publication et les résout à l'aide de la stratégie de résolution que vous avez sélectionnée lors de la création de la publication.</span><span class="sxs-lookup"><span data-stu-id="4a771-104">Replication detects any conflicts when changes are synchronized with the Publisher and resolves those conflicts using the resolution policy you selected when creating the publication.</span></span> <span data-ttu-id="4a771-105">Les conflits suivants peuvent se produire :</span><span class="sxs-lookup"><span data-stu-id="4a771-105">The following conflicts can occur:</span></span>  
  
-   <span data-ttu-id="4a771-106">Conflits de mise à jour et d'insertion.</span><span class="sxs-lookup"><span data-stu-id="4a771-106">Update and insert conflicts.</span></span> <span data-ttu-id="4a771-107">Ce type de conflit survient lorsque les mêmes données sont modifiées dans deux endroits.</span><span class="sxs-lookup"><span data-stu-id="4a771-107">This conflict happens when the same data is changed at two locations.</span></span> <span data-ttu-id="4a771-108">L'un « gagne », l'autre « perd ».</span><span class="sxs-lookup"><span data-stu-id="4a771-108">One change wins, and the other one loses.</span></span>  
  
-   <span data-ttu-id="4a771-109">Conflits de suppression.</span><span class="sxs-lookup"><span data-stu-id="4a771-109">Delete conflicts.</span></span> <span data-ttu-id="4a771-110">Ce type de conflits survient lorsque la même ligne est supprimée à un endroit et modifiée à un autre.</span><span class="sxs-lookup"><span data-stu-id="4a771-110">This conflict occurs when the same row is deleted at one location and changed at the other.</span></span>  
  
 <span data-ttu-id="4a771-111">La détection et la résolution des conflits pouvant s'avérer gourmandes en temps et en ressources, il est préférable d'éviter au maximum les conflits dans l'application en créant des partitions de données pour que les différents Abonnés modifient des sous-ensembles de données différents.</span><span class="sxs-lookup"><span data-stu-id="4a771-111">Conflict detection and resolution can be a time-consuming and resource-intensive process; therefore, it is best to minimize conflicts in the application by creating data partitions so that different Subscribers modify different subsets of data.</span></span>  
  
## <a name="detecting-conflicts"></a><span data-ttu-id="4a771-112">Détection des conflits</span><span class="sxs-lookup"><span data-stu-id="4a771-112">Detecting Conflicts</span></span>  
 <span data-ttu-id="4a771-113">Lorsque vous créez une publication et activez les mises à jour en attente, la réplication ajoute à la table sous-jacente une colonne de type **uniqueidentifier** (**msrepl_tran_version**) ayant comme valeur par défaut **newid()** .</span><span class="sxs-lookup"><span data-stu-id="4a771-113">When creating a publication and enabling queued updating, replication adds a **uniqueidentifier** column (**msrepl_tran_version**) with the default of **newid()** to the underlying table.</span></span> <span data-ttu-id="4a771-114">Lorsque les données publiées sont modifiées sur l'éditeur ou sur l'abonné, la ligne reçoit un nouvel identificateur global unique (GUID) indiquant qu'il s'agit d'une nouvelle version.</span><span class="sxs-lookup"><span data-stu-id="4a771-114">When published data is changed at either the Publisher or the Subscriber, the row receives a new globally unique identifier (GUID) to indicate that a new row version exists.</span></span> <span data-ttu-id="4a771-115">L'Agent de lecture de la file d'attente utilise cette colonne au cours de la synchronisation pour déterminer si un conflit existe.</span><span class="sxs-lookup"><span data-stu-id="4a771-115">The Queue Reader Agent uses this column during synchronization to determine if a conflict exists.</span></span>  
  
 <span data-ttu-id="4a771-116">Une transaction en file d'attente conserve les valeurs de l'ancienne et de la nouvelle version de ligne.</span><span class="sxs-lookup"><span data-stu-id="4a771-116">A transaction in a queue maintains the old and new row version values.</span></span> <span data-ttu-id="4a771-117">Lorsque la transaction est appliquée sur l'éditeur, le GUID provenant de la transaction et celui contenu dans la publication sont comparés.</span><span class="sxs-lookup"><span data-stu-id="4a771-117">When the transaction is applied at the Publisher, the GUIDs from the transaction and the GUID in the publication are compared.</span></span> <span data-ttu-id="4a771-118">Si l'ancien GUID stocké dans la transaction correspond à celui contenu dans la publication, la publication est mise à jour et la ligne reçoit le nouveau GUID généré par l'abonné.</span><span class="sxs-lookup"><span data-stu-id="4a771-118">If the old GUID stored in the transaction matches the GUID in the publication, the publication is updated and the row is assigned the new GUID that was generated by the Subscriber.</span></span> <span data-ttu-id="4a771-119">La mise à jour de la publication avec le GUID issu de la transaction permet d'obtenir des versions de lignes identiques dans la publication et dans la transaction.</span><span class="sxs-lookup"><span data-stu-id="4a771-119">By updating the publication with the GUID from the transaction, you have matching row versions in the publication and in the transaction.</span></span>  
  
 <span data-ttu-id="4a771-120">Si l'ancien GUID stocké dans la transaction ne correspond pas au GUID contenu dans la publication, un conflit est détecté.</span><span class="sxs-lookup"><span data-stu-id="4a771-120">If the old GUID stored in the transaction does not match the GUID in the publication, a conflict is detected.</span></span> <span data-ttu-id="4a771-121">Le nouveau GUID contenu dans la publication indique l'existence de deux versions de ligne : l'une dans la transaction que soumet l'abonné et l'autre, plus récente, sur le serveur de publication.</span><span class="sxs-lookup"><span data-stu-id="4a771-121">The new GUID in the publication indicates that two different row versions exist: one in the transaction being submitted by the Subscriber and a newer one that exists on the Publisher.</span></span> <span data-ttu-id="4a771-122">Cela signifie qu'un autre abonné ou l'éditeur a mis à jour la même ligne dans la publication avant que la transaction soumise par l'abonné ne soit synchronisée.</span><span class="sxs-lookup"><span data-stu-id="4a771-122">In this case, another Subscriber or the Publisher updated the same row in the publication before this Subscriber transaction was synchronized.</span></span>  
  
 <span data-ttu-id="4a771-123">À la différence de la réplication de fusion, la colonne GUID n'est pas utilisée pour identifier la ligne proprement dite, mais pour vérifier si elle a changé.</span><span class="sxs-lookup"><span data-stu-id="4a771-123">Unlike merge replication, the use of a GUID column is not used to identify the row itself, but is used to check if the row has changed.</span></span>  
  
## <a name="resolving-conflicts"></a><span data-ttu-id="4a771-124">Résolution de conflits</span><span class="sxs-lookup"><span data-stu-id="4a771-124">Resolving Conflicts</span></span>  
 <span data-ttu-id="4a771-125">Lorsque vous créez une publication acceptant les mises à jour en attente, vous sélectionnez un programme de résolution de conflits qui sera utilisé en cas de détection de conflit.</span><span class="sxs-lookup"><span data-stu-id="4a771-125">When you create a publication using queued updating, you select a conflict resolver to be used if any conflicts are detected.</span></span> <span data-ttu-id="4a771-126">Le programme de résolution de conflits indique à l'Agent de lecture de la file d'attente comment il doit traiter les différentes versions d'une même ligne rencontrées au cours de la synchronisation.</span><span class="sxs-lookup"><span data-stu-id="4a771-126">The conflict resolver governs how the Queue Reader Agent handles different versions of the same row encountered during synchronization.</span></span> <span data-ttu-id="4a771-127">Vous pouvez modifier la stratégie de résolution de conflit après avoir créé la publication tant qu'aucun abonnement n'est associé à celle-ci.</span><span class="sxs-lookup"><span data-stu-id="4a771-127">You can change the conflict resolution policy after the publication is created as long as there are no subscriptions to the publication.</span></span> <span data-ttu-id="4a771-128">Le programme de résolution de conflits propose les choix suivants :</span><span class="sxs-lookup"><span data-stu-id="4a771-128">The conflict resolver choices are the following:</span></span>  
  
-   <span data-ttu-id="4a771-129">Le serveur de publication gagne (valeur par défaut)</span><span class="sxs-lookup"><span data-stu-id="4a771-129">Publisher wins (the default)</span></span>  
  
-   <span data-ttu-id="4a771-130">L'éditeur gagne et l'abonnement est réinitialisé</span><span class="sxs-lookup"><span data-stu-id="4a771-130">Publisher wins and the subscription is reinitialized</span></span>  
  
-   <span data-ttu-id="4a771-131">L'abonné gagne</span><span class="sxs-lookup"><span data-stu-id="4a771-131">Subscriber wins</span></span>  
  
 <span data-ttu-id="4a771-132">Les conflits sont enregistrés et peuvent être visualisés à l'aide de l'outil d'affichage des conflits.</span><span class="sxs-lookup"><span data-stu-id="4a771-132">Conflicts are recorded and can be viewed using the Conflict Viewer.</span></span>  
  
 <span data-ttu-id="4a771-133">**Pour définir la stratégie de résolution des conflits de mise à jour en attente**</span><span class="sxs-lookup"><span data-stu-id="4a771-133">**To set the queued updating conflict resolution policy**</span></span>  
  
-   [!INCLUDE[ssManStudioFull](../../../includes/ssmanstudiofull-md.md)] <span data-ttu-id="4a771-134">: [Définir des options de résolution des conflits de mise à jour en attente &#40;SQL Server Management Studio&#41;](../publish/create-an-updatable-subscription-to-a-transactional-publication.md)</span><span class="sxs-lookup"><span data-stu-id="4a771-134">: [Set Queued Updating Conflict Resolution Options &#40;SQL Server Management Studio&#41;](../publish/create-an-updatable-subscription-to-a-transactional-publication.md)</span></span>  
  
-   <span data-ttu-id="4a771-135">Programmation Transact-SQL de la réplication : [Activer les abonnements pouvant être mis à jour pour les publications transactionnelles](../publish/enable-updating-subscriptions-for-transactional-publications.md)</span><span class="sxs-lookup"><span data-stu-id="4a771-135">Replication Transact-SQL programming: [Enable Updating Subscriptions for Transactional Publications](../publish/enable-updating-subscriptions-for-transactional-publications.md)</span></span>  
  
 <span data-ttu-id="4a771-136">**Pour afficher les conflits de données**</span><span class="sxs-lookup"><span data-stu-id="4a771-136">**To view data conflicts**</span></span>  
  
-   [!INCLUDE[ssManStudioFull](../../../includes/ssmanstudiofull-md.md)] <span data-ttu-id="4a771-137">: [Afficher les conflits de données pour les publications transactionnelles &#40;SQL Server Management Studio&#41;](../view-data-conflicts-for-transactional-publications-sql-server-management-studio.md)</span><span class="sxs-lookup"><span data-stu-id="4a771-137">: [View Data Conflicts for Transactional Publications &#40;SQL Server Management Studio&#41;](../view-data-conflicts-for-transactional-publications-sql-server-management-studio.md)</span></span>  
  
### <a name="publisher-wins"></a><span data-ttu-id="4a771-138">L'éditeur gagne</span><span class="sxs-lookup"><span data-stu-id="4a771-138">Publisher Wins</span></span>  
 <span data-ttu-id="4a771-139">Lorsque la résolution de conflit appliquée est « Le serveur de publication gagne », la cohérence transactionnelle est conservée dans les données situées sur le serveur de publication.</span><span class="sxs-lookup"><span data-stu-id="4a771-139">When the conflict resolution is set to the Publisher wins, transactional consistency is maintained based on the data at the Publisher.</span></span> <span data-ttu-id="4a771-140">La transaction en conflit est annulée sur l'abonné qui l'a initialisée.</span><span class="sxs-lookup"><span data-stu-id="4a771-140">The conflicting transaction is rolled back at the Subscriber that initiated it.</span></span>  
  
 <span data-ttu-id="4a771-141">L'Agent de lecture de la file d'attente détecte un conflit, puis des commandes de compensation sont générées et propagées vers l'abonné par l'intermédiaire de la base de données de distribution.</span><span class="sxs-lookup"><span data-stu-id="4a771-141">The Queue Reader Agent detects a conflict and compensating commands are generated and propagated to the Subscriber by posting them in the distribution database.</span></span> <span data-ttu-id="4a771-142">L'Agent de distribution applique ensuite les commandes de compensation à l'abonné responsable de la transaction conflictuelle.</span><span class="sxs-lookup"><span data-stu-id="4a771-142">The Distribution Agent then applies the compensating commands to the Subscriber that originated the conflicting transaction.</span></span> <span data-ttu-id="4a771-143">Les opérations de compensation mettent à jour les lignes sur l'Abonné afin qu'elles correspondent à celles du serveur de publication.</span><span class="sxs-lookup"><span data-stu-id="4a771-143">The compensating actions update the rows on the Subscriber to match the rows on the Publisher.</span></span>  
  
 <span data-ttu-id="4a771-144">Avant que les commandes de compensation ne soient appliquées, il est possible de lire les résultats d'une transaction qui sera finalement annulée sur l'Abonné.</span><span class="sxs-lookup"><span data-stu-id="4a771-144">Until the compensating commands are applied, it is possible to read the results of a transaction that will eventually be rolled back at the Subscriber.</span></span> <span data-ttu-id="4a771-145">Cela équivaut à une lecture incorrecte (niveau d'isolation lecture non validée).</span><span class="sxs-lookup"><span data-stu-id="4a771-145">This is equivalent to a dirty read (read uncommitted isolation level).</span></span> <span data-ttu-id="4a771-146">Il n'y a pas de compensation pour les transactions suivantes qui peuvent en découler.</span><span class="sxs-lookup"><span data-stu-id="4a771-146">There is no compensation for the subsequent dependent transactions that can occur.</span></span> <span data-ttu-id="4a771-147">Toutefois, les limites des transactions sont respectées et les actions comprises dans une transaction sont soit toutes validées, soit (en cas de conflit) toutes annulées.</span><span class="sxs-lookup"><span data-stu-id="4a771-147">However, transaction boundaries are honored and all the actions within a transaction are either committed, or in the case of a conflict, rolled back.</span></span>  
  
### <a name="publisher-wins-and-the-subscription-is-reinitialized"></a><span data-ttu-id="4a771-148">L'éditeur gagne et l'abonnement est réinitialisé</span><span class="sxs-lookup"><span data-stu-id="4a771-148">Publisher Wins and the Subscription Is Reinitialized</span></span>  
 <span data-ttu-id="4a771-149">La réinitialisation de l'Abonné pour résoudre les conflits permet de conserver une cohérence transactionnelle stricte sur l'Abonné mais peut prendre beaucoup de temps si la publication contient d'importants volumes de données.</span><span class="sxs-lookup"><span data-stu-id="4a771-149">Reinitializing the Subscriber to resolve conflicts maintains strict transactional consistency at the Subscriber, but it can be time consuming if the publication contains large amounts of data.</span></span>  
  
 <span data-ttu-id="4a771-150">Lorsque l'Agent de lecture de la file d'attente détecte un conflit, toutes les transactions qui figurent dans la file d'attente (y compris la transaction en conflit) sont rejetées et l'abonné est marqué pour la réinitialisation.</span><span class="sxs-lookup"><span data-stu-id="4a771-150">When the Queue Reader Agent detects a conflict, all remaining transactions in the queue (including the transaction in conflict) are rejected, and the Subscriber is marked for reinitialization.</span></span> <span data-ttu-id="4a771-151">L'instantané suivant généré pour la publication est appliqué à l'Abonné par l'Agent de distribution.</span><span class="sxs-lookup"><span data-stu-id="4a771-151">The next snapshot generated for the publication is applied by the Distribution Agent to the Subscriber.</span></span>  
  
### <a name="subscriber-wins"></a><span data-ttu-id="4a771-152">L'abonné gagne</span><span class="sxs-lookup"><span data-stu-id="4a771-152">Subscriber Wins</span></span>  
 <span data-ttu-id="4a771-153">La détection de conflit d'après la stratégie " L'abonné gagne " signifie que la dernière transaction de l'abonné destinée à mettre à jour l'éditeur l'emporte.</span><span class="sxs-lookup"><span data-stu-id="4a771-153">Conflict detection under the Subscriber wins policy means the last Subscriber transaction to update the Publisher wins.</span></span> <span data-ttu-id="4a771-154">Dans ce cas, en cas de détection de conflit, la transaction envoyée par l'abonné est utilisée et l'éditeur est mis à jour.</span><span class="sxs-lookup"><span data-stu-id="4a771-154">In this case, when a conflict is detected, the transaction sent by the Subscriber is still used and the Publisher is updated.</span></span> <span data-ttu-id="4a771-155">Cette stratégie s'adresse aux applications où de telles modifications ne compromettent pas l'intégrité des données.</span><span class="sxs-lookup"><span data-stu-id="4a771-155">This policy is suitable for applications where such changes do not compromise data integrity.</span></span>  
  
## <a name="see-also"></a><span data-ttu-id="4a771-156">Voir aussi</span><span class="sxs-lookup"><span data-stu-id="4a771-156">See Also</span></span>  
 [<span data-ttu-id="4a771-157">Updatable Subscriptions for Transactional Replication</span><span class="sxs-lookup"><span data-stu-id="4a771-157">Updatable Subscriptions for Transactional Replication</span></span>](updatable-subscriptions-for-transactional-replication.md)  
  
  
