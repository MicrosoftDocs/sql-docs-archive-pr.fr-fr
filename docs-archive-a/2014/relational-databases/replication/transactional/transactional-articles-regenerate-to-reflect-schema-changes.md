---
title: Regénérer des procédures transactionnelles personnalisées pour refléter des modifications de schéma | Microsoft Docs
ms.custom: ''
ms.date: 06/13/2017
ms.prod: sql-server-2014
ms.reviewer: ''
ms.technology: replication
ms.topic: conceptual
helpviewer_keywords:
- custom procedures [SQL Server replication]
- transactional replication, replicating schema changes
- schemas [SQL Server replication], replicating changes
ms.assetid: ccf68a13-e748-4455-8168-90e6d2868098
author: MashaMSFT
ms.author: mathoma
ms.openlocfilehash: 7b41b5309816e037ce3619e880b796e0653c7506
ms.sourcegitcommit: ad4d92dce894592a259721a1571b1d8736abacdb
ms.translationtype: MT
ms.contentlocale: fr-FR
ms.lasthandoff: 08/04/2020
ms.locfileid: "87706368"
---
# <a name="regenerate-custom-transactional-procedures-to-reflect-schema-changes"></a><span data-ttu-id="334c2-102">Régénérer des procédures transactionnelles personnalisées pour refléter des modifications de schéma</span><span class="sxs-lookup"><span data-stu-id="334c2-102">Regenerate Custom Transactional Procedures to Reflect Schema Changes</span></span>
  <span data-ttu-id="334c2-103">Par défaut, la réplication transactionnelle effectue toutes les modifications de données sur l'Abonné via des procédures stockées qui sont générées par des procédures internes pour chaque article de table de la publication.</span><span class="sxs-lookup"><span data-stu-id="334c2-103">By default transactional replication makes all data changes at Subscribers through stored procedures that are generated by internal procedures for each table article in the publication.</span></span> <span data-ttu-id="334c2-104">Les trois procédures (une pour les insertions, une pour les mises à jour et une pour les suppressions) sont copiées vers l'Abonné et s'exécutent quand une insertion, une mise à jour ou une suppression est répliquée vers l'Abonné.</span><span class="sxs-lookup"><span data-stu-id="334c2-104">The three procedures (one each for inserts, updates, and deletes) are copied to the Subscriber and execute when an insert, update, or delete is replicated to the Subscriber.</span></span> <span data-ttu-id="334c2-105">Quand une modification de schéma est apportée à une table sur un serveur de publication [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] , la réplication régénère automatiquement ces procédures en appelant le même ensemble de procédures de script internes, de façon à ce que les nouvelles procédures correspondent au nouveau schéma (la réplication de modifications de schéma n'est pas prise en charge pour les serveurs de publication Oracle).</span><span class="sxs-lookup"><span data-stu-id="334c2-105">When a schema change is made to a table on a [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] Publisher, replication regenerates these procedures automatically by calling the same set of internal scripting procedures so that the new procedures match the new schema (replication of schema changes is not supported for Oracle Publishers).</span></span>  
  
 <span data-ttu-id="334c2-106">Il est également possible de spécifier des procédures personnalisées pour remplacer une ou plusieurs des procédures par défaut.</span><span class="sxs-lookup"><span data-stu-id="334c2-106">It is also possible to specify custom procedures to replace one or more of the default procedures.</span></span> <span data-ttu-id="334c2-107">Les procédures personnalisées doivent être modifiées si la modification de schéma affecte la procédure.</span><span class="sxs-lookup"><span data-stu-id="334c2-107">The custom procedures should be changed if the schema change will affect the procedure.</span></span> <span data-ttu-id="334c2-108">Par exemple, si une procédure référence une colonne qui est supprimée dans une modification de schéma, les références à la colonne doivent être supprimées de la procédure.</span><span class="sxs-lookup"><span data-stu-id="334c2-108">For example, if a procedure references a column that is dropped in a schema change, references to the column should be removed from the procedure.</span></span> <span data-ttu-id="334c2-109">Il y a deux façons pour la réplication de propager une nouvelle procédure personnalisée vers les Abonnés :</span><span class="sxs-lookup"><span data-stu-id="334c2-109">There are two ways for replication to propagate a new custom procedure to Subscribers:</span></span>  
  
-   <span data-ttu-id="334c2-110">La première option consiste à utiliser une procédure de script personnalisée pour remplacer les procédures par défaut utilisées par la réplication :</span><span class="sxs-lookup"><span data-stu-id="334c2-110">The first option is to use a custom scripting procedure to replace the defaults used by replication:</span></span>  
  
    1.  <span data-ttu-id="334c2-111">Lors de l’exécution de [sp_addarticle &#40;&#41;Transact-SQL ](/sql/relational-databases/system-stored-procedures/sp-addarticle-transact-sql), assurez-vous que le **@schema_option** bit 0x02 a la **valeur true**.</span><span class="sxs-lookup"><span data-stu-id="334c2-111">When executing [sp_addarticle &#40;Transact-SQL&#41;](/sql/relational-databases/system-stored-procedures/sp-addarticle-transact-sql), ensure the **@schema_option** 0x02 bit is to **true**.</span></span>  
  
    2.  <span data-ttu-id="334c2-112">Exécutez [sp_register_custom_scripting &#40;Transact-SQL&#41;](/sql/relational-databases/system-stored-procedures/sp-register-custom-scripting-transact-sql) et spécifiez la valeur’Insert', 'Update’ou’Delete’pour le paramètre **@type** et le nom de la procédure de script personnalisée pour le paramètre **@value** .</span><span class="sxs-lookup"><span data-stu-id="334c2-112">Execute [sp_register_custom_scripting &#40;Transact-SQL&#41;](/sql/relational-databases/system-stored-procedures/sp-register-custom-scripting-transact-sql) and specify a value of 'insert', 'update', or 'delete' for the parameter **@type** and the name of the custom scripting procedure for the parameter **@value**.</span></span>  
  
     <span data-ttu-id="334c2-113">La prochaine fois qu'une modification de schéma est effectuée, la réplication appelle cette procédure stockée pour générer le script de la définition de la nouvelle procédure stockée personnalisée définie par l'utilisateur, puis propage la procédure à chaque Abonné.</span><span class="sxs-lookup"><span data-stu-id="334c2-113">The next time a schema change is made, replication calls this stored procedure to script out the definition for the new user defined custom stored procedure, and then propagates the procedure to each Subscriber.</span></span>  
  
-   <span data-ttu-id="334c2-114">La deuxième option consiste à utiliser un script qui contient une nouvelle définition de procédure personnalisée :</span><span class="sxs-lookup"><span data-stu-id="334c2-114">The second option is to use a script that contains a new custom procedure definition:</span></span>  
  
    1.  <span data-ttu-id="334c2-115">Lors de l’exécution de [sp_addarticle &#40;Transact-SQL&#41;](/sql/relational-databases/system-stored-procedures/sp-addarticle-transact-sql), affectez la valeur **@schema_option** **false** au bit 0x02 afin que la réplication ne génère pas automatiquement de procédures personnalisées sur l’abonné.</span><span class="sxs-lookup"><span data-stu-id="334c2-115">When executing [sp_addarticle &#40;Transact-SQL&#41;](/sql/relational-databases/system-stored-procedures/sp-addarticle-transact-sql), set the **@schema_option** 0x02 bit to **false** so replication does not automatically generate custom procedures at the Subscriber.</span></span>  
  
    2.  <span data-ttu-id="334c2-116">Avant chaque modification de schéma, créez un nouveau fichier de script et inscrivez le script avec la réplication en exécutant [sp_register_custom_scripting &#40;Transact-SQL&#41;](/sql/relational-databases/system-stored-procedures/sp-register-custom-scripting-transact-sql).</span><span class="sxs-lookup"><span data-stu-id="334c2-116">Before each schema change, create a new script file and register the script with replication by executing [sp_register_custom_scripting &#40;Transact-SQL&#41;](/sql/relational-databases/system-stored-procedures/sp-register-custom-scripting-transact-sql).</span></span> <span data-ttu-id="334c2-117">Spécifiez la valeur « custom_script » pour le paramètre **@type** et le chemin d’accès au script sur le serveur de publication pour le paramètre **@value** .</span><span class="sxs-lookup"><span data-stu-id="334c2-117">Specify a value of 'custom_script' for the parameter **@type** and the path to the script on the Publisher for the parameter **@value**.</span></span>  
  
     <span data-ttu-id="334c2-118">La prochaine fois qu'une modification de schéma pertinente est effectuée, ce script s'exécutera sur chaque Abonné au sein de la même transaction que la commande DDL.</span><span class="sxs-lookup"><span data-stu-id="334c2-118">The next time a relevant schema change is made, this script executes on each Subscriber within the same transaction as the DDL command.</span></span> <span data-ttu-id="334c2-119">Quand la modification de schéma est effectuée, le script est désinscrit.</span><span class="sxs-lookup"><span data-stu-id="334c2-119">After the schema change is made, the script is unregistered.</span></span> <span data-ttu-id="334c2-120">Vous devez réinscrire le script pour qu'il soit exécuté après une modification de schéma ultérieure.</span><span class="sxs-lookup"><span data-stu-id="334c2-120">You must re-register the script to have it executed after a subsequent schema change.</span></span>  
  
## <a name="see-also"></a><span data-ttu-id="334c2-121">Voir aussi</span><span class="sxs-lookup"><span data-stu-id="334c2-121">See Also</span></span>  
 <span data-ttu-id="334c2-122">[Spécifier le mode de propagation des modifications des articles transactionnels](transactional-articles-specify-how-changes-are-propagated.md) </span><span class="sxs-lookup"><span data-stu-id="334c2-122">[Specify How Changes Are Propagated for Transactional Articles](transactional-articles-specify-how-changes-are-propagated.md) </span></span>  
 [<span data-ttu-id="334c2-123">Modifier le schéma dans les bases de données de publication</span><span class="sxs-lookup"><span data-stu-id="334c2-123">Make Schema Changes on Publication Databases</span></span>](../publish/make-schema-changes-on-publication-databases.md)  
  
  
