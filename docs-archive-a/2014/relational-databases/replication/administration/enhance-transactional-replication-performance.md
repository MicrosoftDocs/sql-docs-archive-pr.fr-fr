---
title: Améliorer les performances de la réplication transactionnelle | Microsoft Docs
ms.custom: ''
ms.date: 06/13/2017
ms.prod: sql-server-2014
ms.reviewer: ''
ms.technology: replication
ms.topic: conceptual
helpviewer_keywords:
- publications [SQL Server replication], design and performance
- performance [SQL Server replication], transactional replication
- designing databases [SQL Server], replication performance
- performance [SQL Server replication], snapshot replication
- snapshot replication [SQL Server], performance
- subscriptions [SQL Server replication], performance considerations
- agents [SQL Server replication], performance
- Distribution Agent, performance
- transactional replication, performance
- Log Reader Agent, performance
ms.assetid: 67084a67-43ff-4065-987a-3b16d1841565
author: MashaMSFT
ms.author: mathoma
ms.openlocfilehash: fe802796b129ff9bdb50e5dea13e1fe98beee269
ms.sourcegitcommit: ad4d92dce894592a259721a1571b1d8736abacdb
ms.translationtype: MT
ms.contentlocale: fr-FR
ms.lasthandoff: 08/04/2020
ms.locfileid: "87709232"
---
# <a name="enhance-transactional-replication-performance"></a><span data-ttu-id="07799-102">Améliorer les performances de la réplication transactionnelle</span><span class="sxs-lookup"><span data-stu-id="07799-102">Enhance Transactional Replication Performance</span></span>
  <span data-ttu-id="07799-103">Après avoir tenu compte des conseils de performances générales décrites dans [Amélioration des performances générales de la réplication](enhance-general-replication-performance.md), envisagez ces domaines supplémentaires spécifiques à la réplication transactionnelle.</span><span class="sxs-lookup"><span data-stu-id="07799-103">After considering the general performance tips described in [Enhancing General Replication Performance](enhance-general-replication-performance.md), consider these additional areas specific to transactional replication.</span></span>  
  
## <a name="database-design"></a><span data-ttu-id="07799-104">Création de bases de données</span><span class="sxs-lookup"><span data-stu-id="07799-104">Database Design</span></span>  
  
-   <span data-ttu-id="07799-105">Réduisez la taille de transaction dans la conception de votre application.</span><span class="sxs-lookup"><span data-stu-id="07799-105">Minimize transaction size in your application design.</span></span>  
  
     <span data-ttu-id="07799-106">Par défaut, la réplication transactionnelle propage les modifications en fonction des limites des transactions.</span><span class="sxs-lookup"><span data-stu-id="07799-106">By default, transactional replication propagates changes according to transaction boundaries.</span></span> <span data-ttu-id="07799-107">Si les transactions sont plus petites, il est moins probable que l'Agent de distribution doive renvoyer une transaction à cause de problèmes réseau.</span><span class="sxs-lookup"><span data-stu-id="07799-107">If transactions are smaller, it is less likely that the Distribution Agent will have to resend a transaction due to network issues.</span></span> <span data-ttu-id="07799-108">S'il est demandé à l'Agent de renvoyer une transaction, la quantité de données envoyée est moins importante.</span><span class="sxs-lookup"><span data-stu-id="07799-108">If the agent is required to resend a transaction, the amount of data sent is smaller.</span></span>  
  
## <a name="distributor-configuration"></a><span data-ttu-id="07799-109">Configuration du serveur de distribution</span><span class="sxs-lookup"><span data-stu-id="07799-109">Distributor Configuration</span></span>  
  
-   <span data-ttu-id="07799-110">Configurez le serveur de distribution sur un serveur dédié.</span><span class="sxs-lookup"><span data-stu-id="07799-110">Configure the Distributor on a dedicated server.</span></span>  
  
     <span data-ttu-id="07799-111">Vous pouvez réduire la charge de traitement sur le serveur de publication en configurant un serveur de distribution distant.</span><span class="sxs-lookup"><span data-stu-id="07799-111">You can reduce processing overhead on the Publisher by configuring a remote Distributor.</span></span> <span data-ttu-id="07799-112">Pour plus d'informations, voir [Configure Distribution](../configure-distribution.md).</span><span class="sxs-lookup"><span data-stu-id="07799-112">For more information, see [Configure Distribution](../configure-distribution.md).</span></span>  
  
-   <span data-ttu-id="07799-113">Dimensionnez correctement la base de données de distribution.</span><span class="sxs-lookup"><span data-stu-id="07799-113">Size the distribution database appropriately.</span></span>  
  
     <span data-ttu-id="07799-114">Testez la réplication avec une charge normale pour votre système afin de déterminer l'espace nécessaire au stockage des commandes.</span><span class="sxs-lookup"><span data-stu-id="07799-114">Test replication with a typical load for your system to determine how much space is required to store commands.</span></span> <span data-ttu-id="07799-115">Assurez-vous que la base de données est suffisamment volumineuse pour stocker les commandes sans avoir fréquemment recours à l'extension automatique.</span><span class="sxs-lookup"><span data-stu-id="07799-115">Ensure the database is large enough to store commands without having to auto-grow frequently.</span></span> <span data-ttu-id="07799-116">Pour plus d’informations sur la modification de la taille d’une base de données, consultez [ALTER DATABASE &#40;Transact-SQL&#41;](/sql/t-sql/statements/alter-database-transact-sql).</span><span class="sxs-lookup"><span data-stu-id="07799-116">For more information about changing the size of a database, see [ALTER DATABASE &#40;Transact-SQL&#41;](/sql/t-sql/statements/alter-database-transact-sql).</span></span>  
  
## <a name="publication-design"></a><span data-ttu-id="07799-117">Conception de la publication</span><span class="sxs-lookup"><span data-stu-id="07799-117">Publication Design</span></span>  
  
-   <span data-ttu-id="07799-118">Répliquez l'exécution d'une procédure stockée lors de mises à jour par lot de tables publiées.</span><span class="sxs-lookup"><span data-stu-id="07799-118">Replicate stored procedure execution when making batch updates to published tables.</span></span>  
  
     <span data-ttu-id="07799-119">Si des mises à jour par lots concernent parfois de nombreuses lignes sur l'abonné, vous devez envisager la mise à jour de la table publiée à l'aide d'une procédure stockée puis publier l'exécution de la procédure stockée.</span><span class="sxs-lookup"><span data-stu-id="07799-119">If you have batch updates that occasionally affect a large number of rows at the Subscriber, you should consider updating the published table using a stored procedure and publish the execution of the stored procedure.</span></span> <span data-ttu-id="07799-120">Au lieu d'envoyer une mise à jour ou une suppression pour chaque ligne affectée, l'Agent de distribution exécute la même procédure sur l'Abonné à partir des mêmes valeurs de paramètres.</span><span class="sxs-lookup"><span data-stu-id="07799-120">Instead of sending an update or delete for every row affected, the Distribution Agent executes the same procedure at the Subscriber with the same parameter values.</span></span> <span data-ttu-id="07799-121">Pour plus d’informations, consultez [Publishing Stored Procedure Execution in Transactional Replication](../transactional/publishing-stored-procedure-execution-in-transactional-replication.md).</span><span class="sxs-lookup"><span data-stu-id="07799-121">For more information, see [Publishing Stored Procedure Execution in Transactional Replication](../transactional/publishing-stored-procedure-execution-in-transactional-replication.md).</span></span>  
  
-   <span data-ttu-id="07799-122">Répartissez les articles à travers plusieurs publications.</span><span class="sxs-lookup"><span data-stu-id="07799-122">Spread articles across multiple publications.</span></span>  
  
     <span data-ttu-id="07799-123">Si vous ne pouvez pas utiliser le paramètre **-SubscriptionStreams** (décrit ultérieurement dans cette rubrique), envisagez de créer plusieurs publications.</span><span class="sxs-lookup"><span data-stu-id="07799-123">If you cannot use the **-SubscriptionStreams** parameter (described later in this topic), consider creating multiple publications.</span></span> <span data-ttu-id="07799-124">La répartition d'articles sur ces publications permet à la réplication d'appliquer en parallèle les modifications sur les abonnés.</span><span class="sxs-lookup"><span data-stu-id="07799-124">Spreading articles across these publications allows replication to apply changes in parallel to Subscribers.</span></span>  
  
## <a name="subscription-considerations"></a><span data-ttu-id="07799-125">Considérations sur les abonnements</span><span class="sxs-lookup"><span data-stu-id="07799-125">Subscription Considerations</span></span>  
  
-   <span data-ttu-id="07799-126">Utilisez les agents indépendants plutôt que les agents partagés si vous avez plusieurs publications sur le même serveur de publication (valeur par défaut pour l'Assistant Nouvelle publication).</span><span class="sxs-lookup"><span data-stu-id="07799-126">Use independent agents rather than shared agents if you have multiple publications on the same Publisher (this is the default for the New Publication Wizard).</span></span>  
  
-   <span data-ttu-id="07799-127">Exécutez les agents en mode continu et non par l'intermédiaire de planifications très fréquentes.</span><span class="sxs-lookup"><span data-stu-id="07799-127">Run agents continuously instead of on very frequent schedules.</span></span>  
  
     <span data-ttu-id="07799-128">Le fait de configurer les agents afin qu'ils s'exécutent en mode continu au lieu de planifier de fréquentes exécutions (par exemple, toutes les minutes) permet d'améliorer les performances de la réplication, car l'Agent n'a pas besoin de démarrer et de s'arrêter.</span><span class="sxs-lookup"><span data-stu-id="07799-128">Setting the agents to run continuously rather than creating frequent schedules (such as every minute) improves replication performance, because the agent does not have to start and stop.</span></span> <span data-ttu-id="07799-129">Lorsque vous configurez l'Agent de distribution pour qu'il s'exécute en mode continu, les modifications sont diffusées avec une faible latence aux autres serveurs de la topologie qui sont connectés.</span><span class="sxs-lookup"><span data-stu-id="07799-129">When you set the Distribution Agent to run continuously, changes are propagated with low latency to the other servers that are connected in the topology.</span></span> <span data-ttu-id="07799-130">Pour plus d'informations, consultez les pages suivantes :</span><span class="sxs-lookup"><span data-stu-id="07799-130">For more information, see:</span></span>  
  
    -   [!INCLUDE[ssManStudioFull](../../../includes/ssmanstudiofull-md.md)]<span data-ttu-id="07799-131">: [Spécifier des planifications de synchronisation](../specify-synchronization-schedules.md)</span><span class="sxs-lookup"><span data-stu-id="07799-131">: [Specify Synchronization Schedules](../specify-synchronization-schedules.md)</span></span>  
  
## <a name="distribution-agent-and-log-reader-agent-parameters"></a><span data-ttu-id="07799-132">Paramètres de l'Agent de distribution et de l'Agent de lecture du journal</span><span class="sxs-lookup"><span data-stu-id="07799-132">Distribution Agent and Log Reader Agent Parameters</span></span>  
  
-   <span data-ttu-id="07799-133">Pour résoudre les goulets d’étranglement accidentels, utilisez le paramètre **-MaxCmdsInTran** pour l’agent de lecture du journal.</span><span class="sxs-lookup"><span data-stu-id="07799-133">To resolve accidental, one-time bottlenecks use the **-MaxCmdsInTran** parameter for the Log Reader Agent.</span></span>  
  
     <span data-ttu-id="07799-134">Le paramètre **-MaxCmdsInTran** spécifie le nombre maximal d’instructions regroupées dans une transaction lorsque le lecteur du journal écrit des commandes dans la base de données de distribution.</span><span class="sxs-lookup"><span data-stu-id="07799-134">The **-MaxCmdsInTran** parameter specifies the maximum number of statements grouped into a transaction as the Log Reader writes commands to the distribution database.</span></span> <span data-ttu-id="07799-135">L'utilisation de ce paramètre permet à l'Agent de lecture du journal et à l'Agent de distribution de scinder les transactions importantes (constituées de plusieurs commandes) sur le serveur de publication en plusieurs transactions plus petites, lors de l'application des commandes sur l'Abonné.</span><span class="sxs-lookup"><span data-stu-id="07799-135">Using this parameter allows the Log Reader Agent and Distribution Agent to divide large transactions (consisting of many commands) at the Publisher into several smaller transactions when applying commands at the Subscriber.</span></span> <span data-ttu-id="07799-136">La spécification de ce paramètre permet de réduire les contentions sur le serveur de distribution et de réduire la latence entre le serveur de publication et l'Abonné.</span><span class="sxs-lookup"><span data-stu-id="07799-136">Specifying this parameter can reduce contention at the Distributor and reduce latency between the Publisher and Subscriber.</span></span> <span data-ttu-id="07799-137">Du fait que la transaction d'origine est appliquée en plusieurs morceaux, l'Abonné peut accéder aux lignes d'une importante transaction logique du serveur de publication avant la fin de la transaction d'origine, ce qui rompt la stricte atomicité transactionnelle.</span><span class="sxs-lookup"><span data-stu-id="07799-137">Because the original transaction is applied in smaller units, the Subscriber can access rows of a large logical Publisher transaction prior to the end of the original transaction, breaking strict transactional atomicity.</span></span> <span data-ttu-id="07799-138">La valeur par défaut est **0**, ce qui permet de conserver les limites de la transaction du serveur de publication.</span><span class="sxs-lookup"><span data-stu-id="07799-138">The default is **0**, which preserves the transaction boundaries of the Publisher.</span></span> <span data-ttu-id="07799-139">Ce paramètre ne s'applique pas aux serveurs de publication Oracle.</span><span class="sxs-lookup"><span data-stu-id="07799-139">This parameter does not apply to Oracle Publishers.</span></span>  
  
    > [!WARNING]  
    >  <span data-ttu-id="07799-140">`MaxCmdsInTran` n'a pas été conçu pour rester toujours activé.</span><span class="sxs-lookup"><span data-stu-id="07799-140">`MaxCmdsInTran` was not designed to be always turned on.</span></span> <span data-ttu-id="07799-141">Il permet de contourner le problème lorsqu'un utilisateur a accidentellement exécuté un grand nombre d'opérations DML dans une seule transaction (provoquant un retard dans la distribution des commandes jusqu'à ce que la transaction entière soit dans la base de données de distribution, le maintien de verrous, etc.).</span><span class="sxs-lookup"><span data-stu-id="07799-141">It exists to work around cases where someone accidentally performed a large number of DML operations in a single transaction (causing delay in distribution of commands until the entire transaction is in distribution database, locks being held, etc.).</span></span> <span data-ttu-id="07799-142">Si vous rencontrez régulièrement ce problème, vous devriez vérifier vos applications et trouver un moyen de réduire la taille des transactions.</span><span class="sxs-lookup"><span data-stu-id="07799-142">If you routinely fall into this situation, you should review your applications and find ways to reduce the transaction size.</span></span>  
  
-   <span data-ttu-id="07799-143">Utilisez le paramètre **-SubscriptionStreams** pour l’agent de distribution.</span><span class="sxs-lookup"><span data-stu-id="07799-143">Use the **-SubscriptionStreams** parameter for the Distribution Agent.</span></span>  
  
     <span data-ttu-id="07799-144">Le paramètre **-SubscriptionStreams** peut améliorer le débit de la réplication globale.</span><span class="sxs-lookup"><span data-stu-id="07799-144">The **-SubscriptionStreams** parameter can greatly improve aggregate replication throughput.</span></span> <span data-ttu-id="07799-145">Il autorise plusieurs connexions à l'Abonné pour appliquer des traitements de modifications en parallèle, tout en conservant la plupart des caractéristiques transactionnelles présentes lors de l'utilisation d'un thread unique.</span><span class="sxs-lookup"><span data-stu-id="07799-145">It allows multiple connections to a Subscriber to apply batches of changes in parallel, while maintaining many of the transactional characteristics present when using a single thread.</span></span> <span data-ttu-id="07799-146">Si l'une des connexions ne réussit pas à s'exécuter ou n'est pas validée, toutes les connexions abandonneront le lot actuel, et l'Agent utilisera un flux unique pour une nouvelle tentative sur les lots ayant échoué.</span><span class="sxs-lookup"><span data-stu-id="07799-146">If one of the connections fails to execute or commit, all connections will abort the current batch, and the agent will use a single stream to retry the failed batches.</span></span> <span data-ttu-id="07799-147">Avant que cette phase de nouvelle tentative ne se termine, il peut se produire des incohérences transactionnelles temporaires sur l'Abonné.</span><span class="sxs-lookup"><span data-stu-id="07799-147">Before this retry phase completes, there can be temporary transactional inconsistencies at the Subscriber.</span></span> <span data-ttu-id="07799-148">Une fois que les lots ayant échoué sont validés avec succès, l'Abonné retrouve un état de cohérence transactionnelle.</span><span class="sxs-lookup"><span data-stu-id="07799-148">After the failed batches are successfully committed, the Subscriber is brought back to a state of transactional consistency.</span></span>  
  
     <span data-ttu-id="07799-149">Vous pouvez spécifier une valeur pour ce paramètre d’agent à l’aide de l' \*\* \@ subscriptionstreams\*\* de [SP_ADDSUBSCRIPTION &#40;Transact-SQL&#41;](/sql/relational-databases/system-stored-procedures/sp-addsubscription-transact-sql).</span><span class="sxs-lookup"><span data-stu-id="07799-149">A value for this agent parameter can be specified using the **\@subscriptionstreams** of [sp_addsubscription &#40;Transact-SQL&#41;](/sql/relational-databases/system-stored-procedures/sp-addsubscription-transact-sql).</span></span>  
  
-   <span data-ttu-id="07799-150">Augmentez la valeur du paramètre **-ReadBatchSize** pour l’Agent de lecture du journal.</span><span class="sxs-lookup"><span data-stu-id="07799-150">Increase the value of the **-ReadBatchSize** parameter for the Log Reader Agent.</span></span>  
  
     <span data-ttu-id="07799-151">L'Agent de lecture du journal et l'Agent de distribution prennent en charge des tailles de traitements pour les opérations de lecture et de validation des transactions.</span><span class="sxs-lookup"><span data-stu-id="07799-151">The Log Reader Agent and Distribution Agent support batch sizes for transaction read and commit operations.</span></span> <span data-ttu-id="07799-152">Par défaut, la taille de traitement est de 500 transactions.</span><span class="sxs-lookup"><span data-stu-id="07799-152">Batch sizes default to 500 transactions.</span></span> <span data-ttu-id="07799-153">Dans ce cas, l'Agent de lecture du journal ne lit dans le journal que le nombre de transactions indiqué, que celles-ci soient marquées ou non pour réplication.</span><span class="sxs-lookup"><span data-stu-id="07799-153">The Log Reader Agent reads the specific number of transactions from the log, whether or not they are marked for replication.</span></span> <span data-ttu-id="07799-154">Quand de nombreuses transactions sont enregistrées dans une base de données de publication, mais que seules quelques-unes d’entre elles sont marquées pour réplication, vous avez intérêt à utiliser le paramètre **-ReadBatchSize** pour augmenter la taille de traitement de l’Agent de lecture du journal.</span><span class="sxs-lookup"><span data-stu-id="07799-154">When a large number of transactions is written to a publication database, but only a small subset of those are marked for replication, you should use the **-ReadBatchSize** parameter to increase the read batch size of the Log Reader Agent.</span></span> <span data-ttu-id="07799-155">Ce paramètre ne s'applique pas aux serveurs de publication Oracle.</span><span class="sxs-lookup"><span data-stu-id="07799-155">This parameter does not apply to Oracle Publishers.</span></span>  
  
-   <span data-ttu-id="07799-156">Augmentez la valeur du paramètre **-CommitBatchSize** pour l’Agent de distribution.</span><span class="sxs-lookup"><span data-stu-id="07799-156">Increase the value of the **-CommitBatchSize** parameter for the Distribution Agent.</span></span>  
  
     <span data-ttu-id="07799-157">La validation d'un ensemble de transactions comporte une charge fixe ; en validant un grand nombre de transactions moins fréquemment, la charge est répartie sur un volume de données plus important.</span><span class="sxs-lookup"><span data-stu-id="07799-157">Committing a set of transactions has a fixed overhead; by committing a larger number of transactions less frequently, the overhead is spread across a larger volume of data.</span></span> <span data-ttu-id="07799-158">Cependant, l'avantage obtenu par l'augmentation de ce paramètre disparaît car le coût d'application des modifications est lié à d'autres facteurs, comme l'E/S maximum du disque contenant le journal.</span><span class="sxs-lookup"><span data-stu-id="07799-158">However, the benefit of increasing this parameter drops off as the cost of applying changes is gated by other factors, such as the maximum I/O of the disk that contains the log.</span></span> <span data-ttu-id="07799-159">De plus, un compromis peut être envisagé : toute défaillance entraînant le redémarrage de l'Agent de distribution doit restaurer et appliquer à nouveau une grande quantité de transactions.</span><span class="sxs-lookup"><span data-stu-id="07799-159">Additionally, there is a trade off to be considered: any failure that causes the Distribution Agent to start over must rollback and reapply a larger number of transactions.</span></span> <span data-ttu-id="07799-160">Pour les réseaux non fiables, il peut résulter d'une valeur moins importante une diminution des défaillances et un nombre de transactions moins élevé à restaurer et à réappliquer si une défaillance se produit.</span><span class="sxs-lookup"><span data-stu-id="07799-160">For unreliable networks, a lower value can result in less failures and a smaller number of transactions to rollback and reapply if a failure occurs.</span></span>  
  
-   <span data-ttu-id="07799-161">Réduisez la valeur du paramètre **-PollingInterval** pour l’Agent de lecture du journal.</span><span class="sxs-lookup"><span data-stu-id="07799-161">Decrease the value of the **-PollingInterval** parameter for the Log Reader Agent.</span></span>  
  
     <span data-ttu-id="07799-162">Le paramètre **-PollingInterval** indique la fréquence d’interrogation du journal des transactions d’une base de données publiée pour que les transactions soient répliquées.</span><span class="sxs-lookup"><span data-stu-id="07799-162">The **-PollingInterval** parameter specifies how often the transaction log of a published database is queried for transactions to replicate.</span></span> <span data-ttu-id="07799-163">La valeur par défaut est 5 secondes.</span><span class="sxs-lookup"><span data-stu-id="07799-163">The default is 5 seconds.</span></span> <span data-ttu-id="07799-164">Si vous réduisez cette valeur, le journal est interrogé plus fréquemment, ce qui peut entraîner une latence plus faible pour la remise des transactions de la base de données de publication sur la base de données de distribution.</span><span class="sxs-lookup"><span data-stu-id="07799-164">If you decrease this value, the log is polled more frequently, which can result in lower latency for the delivery of transactions from the publication database to the distribution database.</span></span> <span data-ttu-id="07799-165">Cependant, vous devriez équilibrer les besoins d'une latence plus faible en fonction de l'augmentation de la charge sur le serveur causée par une interrogation plus fréquente.</span><span class="sxs-lookup"><span data-stu-id="07799-165">However, you should balance the need for lower latency against the increased load on the server from polling more frequently.</span></span>  
  
 <span data-ttu-id="07799-166">Les paramètres des agents peuvent être spécifiés dans des profils d'agent et sur la ligne de commande.</span><span class="sxs-lookup"><span data-stu-id="07799-166">Agent parameters can be specified in agent profiles and on the command line.</span></span> <span data-ttu-id="07799-167">Pour plus d'informations, consultez les pages suivantes :</span><span class="sxs-lookup"><span data-stu-id="07799-167">For more information, see:</span></span>  
  
-   [<span data-ttu-id="07799-168">Utiliser des profils d’agent de réplication</span><span class="sxs-lookup"><span data-stu-id="07799-168">Work with Replication Agent Profiles</span></span>](../agents/replication-agent-profiles.md)  
  
-   [<span data-ttu-id="07799-169">Afficher et modifier des paramètres d’invite de commandes d’un Agent de réplication &#40;SQL Server Management Studio&#41;</span><span class="sxs-lookup"><span data-stu-id="07799-169">View and Modify Replication Agent Command Prompt Parameters &#40;SQL Server Management Studio&#41;</span></span>](../agents/view-and-modify-replication-agent-command-prompt-parameters.md)  
  
-   [<span data-ttu-id="07799-170">Concepts des exécutables de l'agent de réplication</span><span class="sxs-lookup"><span data-stu-id="07799-170">Replication Agent Executables Concepts</span></span>](../concepts/replication-agent-executables-concepts.md)  
  
  
