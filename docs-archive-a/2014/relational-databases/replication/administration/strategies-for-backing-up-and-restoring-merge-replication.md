---
title: Stratégies de sauvegarde et de restauration de la réplication de fusion | Microsoft Docs
ms.custom: ''
ms.date: 03/09/2017
ms.prod: sql-server-2014
ms.reviewer: ''
ms.technology: replication
ms.topic: conceptual
helpviewer_keywords:
- recovery [SQL Server replication], merge replication
- backups [SQL Server replication], merge replication
- restoring [SQL Server replication], merge replication
- merge replication [SQL Server replication], backup and restore
ms.assetid: b8ae31c6-d76f-4dd7-8f46-17d023ca3eca
author: MashaMSFT
ms.author: mathoma
ms.openlocfilehash: 45e3259d93af4735569fcb6b6a9c7b9eddd52730
ms.sourcegitcommit: ad4d92dce894592a259721a1571b1d8736abacdb
ms.translationtype: MT
ms.contentlocale: fr-FR
ms.lasthandoff: 08/04/2020
ms.locfileid: "87705084"
---
# <a name="strategies-for-backing-up-and-restoring-merge-replication"></a><span data-ttu-id="50779-102">Stratégies de sauvegarde et de restauration de la réplication de fusion</span><span class="sxs-lookup"><span data-stu-id="50779-102">Strategies for Backing Up and Restoring Merge Replication</span></span>
  <span data-ttu-id="50779-103">Pour la réplication de fusion, effectuez régulièrement des sauvegardes des bases de données suivantes :</span><span class="sxs-lookup"><span data-stu-id="50779-103">For merge replication, back up the following databases regularly:</span></span>  
  
-   <span data-ttu-id="50779-104">La base de données de publication au niveau du serveur de publication</span><span class="sxs-lookup"><span data-stu-id="50779-104">The publication database at the Publisher</span></span>   
-   <span data-ttu-id="50779-105">La base de données de distribution au niveau du serveur de distribution</span><span class="sxs-lookup"><span data-stu-id="50779-105">The distribution database at the Distributor</span></span>    
-   <span data-ttu-id="50779-106">La base de données d'abonnement sur chaque Abonné</span><span class="sxs-lookup"><span data-stu-id="50779-106">The subscription database at each Subscriber</span></span>    
-   <span data-ttu-id="50779-107">Bases de données système **master** et **msdb** sur le serveur de publication, sur le serveur de distribution et sur tous les Abonnés.</span><span class="sxs-lookup"><span data-stu-id="50779-107">The **master** and **msdb** system databases at the Publisher, Distributor and all Subscribers.</span></span> <span data-ttu-id="50779-108">Il est recommandé de sauvegarder ces bases de données en même temps, ainsi que la base de données de réplication appropriée.</span><span class="sxs-lookup"><span data-stu-id="50779-108">These databases should be backed up at the same time as each other and the relevant replication database.</span></span> <span data-ttu-id="50779-109">Par exemple, sauvegardez les bases de données **master** et **msdb** au niveau du serveur de publication en même temps que la base de données de publication.</span><span class="sxs-lookup"><span data-stu-id="50779-109">For example, back up the **master** and **msdb** databases at the Publisher at the same time you back up the publication database.</span></span> <span data-ttu-id="50779-110">Si la base de données de publication est restaurée, vérifiez que les bases de données **master** et **msdb** sont cohérentes avec la base de données de publication en termes de configuration de la réplication et de paramètres.</span><span class="sxs-lookup"><span data-stu-id="50779-110">If the publication database is restored, ensure that the **master** and **msdb** database are consistent with the publication database in terms of replication configuration and settings.</span></span>  
  
 <span data-ttu-id="50779-111">Si vous effectuez des sauvegardes régulières des journaux, toutes les modifications liées à la réplication doivent être capturées dans les sauvegardes des journaux.</span><span class="sxs-lookup"><span data-stu-id="50779-111">If you perform regular log backups, any replication-related changes should be captured in the log backups.</span></span> <span data-ttu-id="50779-112">Si vous n'effectuez pas de sauvegardes des journaux, une sauvegarde doit être effectuée si un paramètre concernant la réplication est modifié.</span><span class="sxs-lookup"><span data-stu-id="50779-112">If you don't perform log backups, a backup should be performed whenever a setting relevant to replication is changed.</span></span> <span data-ttu-id="50779-113">Pour en savoir plus, voir [Common Actions Requiring an Updated Backup](common-actions-requiring-an-updated-backup.md).</span><span class="sxs-lookup"><span data-stu-id="50779-113">For more information, see [Common Actions Requiring an Updated Backup](common-actions-requiring-an-updated-backup.md).</span></span>  
  
 <span data-ttu-id="50779-114">Choisissez une des approches détaillées ci-dessous pour la sauvegarde et la restauration de la base de données de publication, puis suivez les recommandations indiquées pour la base de données de distribution et les bases de données d'abonnement.</span><span class="sxs-lookup"><span data-stu-id="50779-114">Choose one of the approaches detailed below for backing up and restoring the publication database, and then follow the recommendations listed for the distribution database and subscription databases.</span></span>  
  
## <a name="backing-up-and-restoring-the-publication-database"></a><span data-ttu-id="50779-115">Sauvegarde et restauration de la base de données de publication</span><span class="sxs-lookup"><span data-stu-id="50779-115">Backing Up and Restoring the Publication Database</span></span>  
 <span data-ttu-id="50779-116">Il y a deux approches pour la restauration d'une base de données de publication de fusion.</span><span class="sxs-lookup"><span data-stu-id="50779-116">There are two approaches to restoring a merge publication database.</span></span> <span data-ttu-id="50779-117">Après la restauration de la base de données de publication à partir d'une sauvegarde, il est recommandé d'effectuer l'une des deux actions suivantes :</span><span class="sxs-lookup"><span data-stu-id="50779-117">After restoring the publication database from a backup, you should either:</span></span>  
  
-   <span data-ttu-id="50779-118">Synchroniser la base de données de publication avec une base de données d'abonnement.</span><span class="sxs-lookup"><span data-stu-id="50779-118">Synchronize the publication database with a subscription database.</span></span>  
  
-   <span data-ttu-id="50779-119">Réinitialiser tous les abonnements associés aux publications figurant dans la base de données de publication.</span><span class="sxs-lookup"><span data-stu-id="50779-119">Reinitialize all subscriptions to the publications in the publication database.</span></span>  
  
 <span data-ttu-id="50779-120">L'utilisation de l'une de ces deux méthodes garantit que, après une restauration, le serveur de publication et tous les Abonnés sont synchronisés.</span><span class="sxs-lookup"><span data-stu-id="50779-120">Using either of these methods ensures that after a restore is performed, the Publisher and all Subscribers are synchronized.</span></span>  
  
> [!NOTE]  
>  <span data-ttu-id="50779-121">Si des tables contiennent des colonnes d'identité, vous devez vérifier que les plages d'identité correctes sont attribuées après une restauration.</span><span class="sxs-lookup"><span data-stu-id="50779-121">If any tables contain identity columns, you must ensure the correct identity ranges are assigned after a restore.</span></span> <span data-ttu-id="50779-122">Pour plus d’informations, consultez [ Répliquer des colonnes d’identité](../publish/replicate-identity-columns.md).</span><span class="sxs-lookup"><span data-stu-id="50779-122">For more information, see [Replicate Identity Columns](../publish/replicate-identity-columns.md).</span></span>  
  
### <a name="synchronizing-the-publication-database"></a><span data-ttu-id="50779-123">Synchronisation de la base de données de publication</span><span class="sxs-lookup"><span data-stu-id="50779-123">Synchronizing the Publication Database</span></span>  
 <span data-ttu-id="50779-124">La synchronisation d'une base de données de publication avec une base de données d'abonnement vous permet de charger à partir d'une ou plusieurs bases de données d'abonnement les modifications précédemment effectuées dans la base de données de publication, mais qui ne sont pas représentées dans la sauvegarde restaurée.</span><span class="sxs-lookup"><span data-stu-id="50779-124">Synchronizing a publication database with a subscription database allows you to upload from one or more subscription databases those changes made previously in the publication database, but not represented in the restored backup.</span></span> <span data-ttu-id="50779-125">Les données qui peuvent être chargées dépendent de la façon dont une publication est filtrée :</span><span class="sxs-lookup"><span data-stu-id="50779-125">The data that can be uploaded depends on the way in which a publication is filtered:</span></span>  
  
-   <span data-ttu-id="50779-126">Si la publication n'est pas filtrée, vous devriez pouvoir mettre à jour la base de données de publication en la synchronisant avec l'Abonné le plus à jour.</span><span class="sxs-lookup"><span data-stu-id="50779-126">If the publication is not filtered, you should be able to bring the publication database up-to-date by synchronizing with the most up-to-date Subscriber.</span></span>  
  
-   <span data-ttu-id="50779-127">Si la publication est filtrée, il est possible que vous ne puissiez pas mettre à jour la base de données de publication.</span><span class="sxs-lookup"><span data-stu-id="50779-127">If the publication is filtered, you might not be able to bring the publication database up-to-date.</span></span> <span data-ttu-id="50779-128">Prenez une table qui est partitionnée de telle façon que chaque abonnement reçoit des données client seulement pour une région : Nord, Est, Sud et Ouest.</span><span class="sxs-lookup"><span data-stu-id="50779-128">Consider a table that is partitioned such that each subscription receives customer data only for a single region: North, East, South, and West.</span></span> <span data-ttu-id="50779-129">S'il y a au moins un Abonné pour chaque partition de données, la synchronisation avec un Abonné pour chaque partition doit permettre la mise à jour de la base de données de publication.</span><span class="sxs-lookup"><span data-stu-id="50779-129">If there is at least one Subscriber for each partition of data, synchronizing with a Subscriber for each partition should bring the publication database up-to-date.</span></span> <span data-ttu-id="50779-130">Cependant, si par exemple des données de la partition Ouest n'ont été répliquées vers aucun des Abonnés, ces données ne peuvent pas être mises à jour au niveau du serveur de publication.</span><span class="sxs-lookup"><span data-stu-id="50779-130">However, if data in the West partition, for example, was not replicated to any Subscribers, this data at the Publisher cannot be brought up-to-date.</span></span>  
  
> [!IMPORTANT]  
>  <span data-ttu-id="50779-131">La synchronisation d'une base de données de publication avec une base de données d'abonnement peut aboutir à des tables publiées restaurées à un point dans le temps plus récent que celui d'autres tables non publiées restaurées à partir de la sauvegarde.</span><span class="sxs-lookup"><span data-stu-id="50779-131">Synchronizing a publication database with a subscription database can result in published tables being restored to a point in time that is more recent than the point in time of other non-published tables restored from the backup.</span></span>  
  
 <span data-ttu-id="50779-132">Si la synchronisation se fait avec un Abonné exécutant une version de [!INCLUDE[msCoName](../../../includes/msconame-md.md)] [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] antérieure à [!INCLUDE[msCoName](../../../includes/msconame-md.md)] [!INCLUDE[ssVersion2005](../../../includes/ssversion2005-md.md)], l'abonnement ne peut pas être anonyme. Il doit s'agir d'un abonnement client ou d'un abonnement serveur (appelées abonnement local et abonnement global dans les versions précédentes).</span><span class="sxs-lookup"><span data-stu-id="50779-132">If you synchronize with a Subscriber that is running a version of [!INCLUDE[msCoName](../../../includes/msconame-md.md)] [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] prior to [!INCLUDE[msCoName](../../../includes/msconame-md.md)] [!INCLUDE[ssVersion2005](../../../includes/ssversion2005-md.md)], the subscription cannot be anonymous; it must be a client subscription or server subscription (referred to as local subscriptions and global subscriptions in previous releases).</span></span>  
  
 <span data-ttu-id="50779-133">Pour synchroniser un abonnement, consultez [Synchronize a Push Subscription](../synchronize-a-push-subscription.md) et [Synchronize a Pull Subscription](../synchronize-a-pull-subscription.md).</span><span class="sxs-lookup"><span data-stu-id="50779-133">To synchronize a subscription, see [Synchronize a Push Subscription](../synchronize-a-push-subscription.md) and [Synchronize a Pull Subscription](../synchronize-a-pull-subscription.md).</span></span>  
  
### <a name="reinitializing-all-subscriptions"></a><span data-ttu-id="50779-134">Réinitialisation de tous les abonnements</span><span class="sxs-lookup"><span data-stu-id="50779-134">Reinitializing all Subscriptions</span></span>  
 <span data-ttu-id="50779-135">La réinitialisation de tous les abonnements garantit que tous les Abonnés sont dans un état cohérent avec la base de données de publication restaurée.</span><span class="sxs-lookup"><span data-stu-id="50779-135">Reinitializing all subscriptions ensures all Subscribers are in a state consistent with the restored publication database.</span></span> <span data-ttu-id="50779-136">Cette approche doit être utilisée si vous voulez replacer une topologie entière à l'état précédent représenté par une sauvegarde donnée de la base de données d'abonnement.</span><span class="sxs-lookup"><span data-stu-id="50779-136">This approach should be used if you want to return an entire topology to the previous state represented by a given publication database backup.</span></span> <span data-ttu-id="50779-137">Par exemple, vous pouvez souhaiter réinitialiser tous les abonnements si vous effectuez la restauration d'une base de données de publication à un point antérieur dans le temps, dans le but de récupérer d'une opération de traitement effectuée incorrectement.</span><span class="sxs-lookup"><span data-stu-id="50779-137">For example, you might want to reinitialize all subscriptions if you are restoring a publication database to an earlier point in time as a mechanism to recover from an erroneously performed batch operation.</span></span>  
  
 <span data-ttu-id="50779-138">Si vous choisissez cette option, générez un nouvel instantané en vue de la communiquer aux Abonnés réinitialisés dès la fin de la restauration de la base de données de publication.</span><span class="sxs-lookup"><span data-stu-id="50779-138">If you choose this option, generate a new snapshot for delivery to reinitialized Subscribers immediately after restoring your publication database.</span></span>  
  
 <span data-ttu-id="50779-139">Pour réinitialiser un abonnement, consultez [Reinitialize a Subscription](../reinitialize-a-subscription.md).</span><span class="sxs-lookup"><span data-stu-id="50779-139">To reinitialize a subscription, see [Reinitialize a Subscription](../reinitialize-a-subscription.md).</span></span>  
  
 <span data-ttu-id="50779-140">Pour créer et appliquer un instantané, consultez [Create et Apply the Initial Snapshot](../create-and-apply-the-initial-snapshot.md) et [Créer un instantané d'une publication de fusion avec des filtres paramétrés](../create-a-snapshot-for-a-merge-publication-with-parameterized-filters.md).</span><span class="sxs-lookup"><span data-stu-id="50779-140">To create and apply a snapshot, see [Create and Apply the Initial Snapshot](../create-and-apply-the-initial-snapshot.md) and [Create a Snapshot for a Merge Publication with Parameterized Filters](../create-a-snapshot-for-a-merge-publication-with-parameterized-filters.md).</span></span>  
  
## <a name="backing-up-and-restoring-the-distribution-database"></a><span data-ttu-id="50779-141">Sauvegarde et restauration de la base de données de distribution</span><span class="sxs-lookup"><span data-stu-id="50779-141">Backing Up and Restoring the Distribution Database</span></span>  
 <span data-ttu-id="50779-142">Avec la réplication de fusion, la base de données de distribution doit être sauvegardée régulièrement, et peut être restaurée sans considérations particulières aussi longtemps que la sauvegarde n'est pas plus ancienne que la période de rétention la plus courte de tous les abonnements qui utilisent le serveur de distribution.</span><span class="sxs-lookup"><span data-stu-id="50779-142">With merge replication, the distribution database should be backed up regularly, and can be restored without any special considerations as long as the backup used is no older than the shortest retention period of all publications that use the Distributor.</span></span> <span data-ttu-id="50779-143">Par exemple, s'il y a trois publications avec des périodes de rétention de 10, 20 et 30 jours respectivement, la sauvegarde utilisée pour restaurer la base de données ne doit pas être vieille de plus de 10 jours.</span><span class="sxs-lookup"><span data-stu-id="50779-143">For example, if there are three publications with retention periods of 10, 20, and 30 days, respectively, the backup used to restore the database should not be more than 10 days old.</span></span> <span data-ttu-id="50779-144">La base de données de distribution a un rôle limité dans la réplication de fusion : elle ne stocke aucune donnée utilisée dans le suivi des modifications et ne constitue pas un support de stockage temporaire pour les modifications de réplication de fusion destinées aux bases de données d'abonnement (comme elle le fait dans la réplication transactionnelle).</span><span class="sxs-lookup"><span data-stu-id="50779-144">The distribution database has a limited role in merge replication: it does not store any data used in change tracking and it does not provide temporary storage of merge replication changes to be forwarded to subscription databases (as it does in transactional replication).</span></span>  
  
## <a name="backing-up-and-restoring-a-subscription-database"></a><span data-ttu-id="50779-145">Sauvegarde et restauration d'une base de données d'abonnement</span><span class="sxs-lookup"><span data-stu-id="50779-145">Backing Up and Restoring a Subscription Database</span></span>  
 <span data-ttu-id="50779-146">Pour garantir la récupération réussie d'une base de données d'abonnement, les Abonnés doivent se synchroniser avec le serveur de publication avant que la base de données d'abonnement soit sauvegardée ; ils doivent aussi se synchroniser après la restauration de la base de données d'abonnement :</span><span class="sxs-lookup"><span data-stu-id="50779-146">To ensure successful recovery of a subscription database, Subscribers should synchronize with the Publisher before the subscription database is backed up; they should also synchronize after the subscription database is restored:</span></span>  
  
-   <span data-ttu-id="50779-147">La synchronisation avec le serveur de publication avant une sauvegarde de la base de données d'abonnement aide à garantir que si un Abonné est restauré à partir d'une sauvegarde, l'abonnement se trouve toujours dans la période de rétention d'abonnement.</span><span class="sxs-lookup"><span data-stu-id="50779-147">Synchronizing with the Publisher before a subscription database backup helps ensure that if a Subscriber is restored from backup, the subscription is still within the publication retention period.</span></span> <span data-ttu-id="50779-148">Supposons par exemple qu'une publication ait une période de conservation de 10 jours.</span><span class="sxs-lookup"><span data-stu-id="50779-148">For example, assume a publication with a retention period of 10 days.</span></span> <span data-ttu-id="50779-149">La dernière synchronisation date de 8 jours et la sauvegarde est effectuée maintenant.</span><span class="sxs-lookup"><span data-stu-id="50779-149">The last synchronization was 8 days ago, and now the backup is performed.</span></span> <span data-ttu-id="50779-150">Si elle est restaurée 4 jours plus tard, la dernière synchronisation datera de 12 jours, ce qui est supérieur à la période de rétention.</span><span class="sxs-lookup"><span data-stu-id="50779-150">If the backup is restored 4 days later, the last synchronization will have occurred 12 days ago, which is past the retention period.</span></span> <span data-ttu-id="50779-151">Dans ce cas, vous devez réinitialiser l'Abonné.</span><span class="sxs-lookup"><span data-stu-id="50779-151">In this case, you would have to reinitialize the Subscriber.</span></span> <span data-ttu-id="50779-152">Si l'Abonné avait effectué la synchronisation juste avant la sauvegarde, la base de données d'abonnement se trouverait dans la période de rétention.</span><span class="sxs-lookup"><span data-stu-id="50779-152">If the Subscriber had synchronized before the backup, the subscription database would be within the retention period.</span></span>  
  
     <span data-ttu-id="50779-153">La sauvegarde ne doit pas être plus ancienne que la période de rétention la plus courte pour toutes les publications auxquelles l'Abonné souscrit.</span><span class="sxs-lookup"><span data-stu-id="50779-153">The backup should be no older than the shortest retention period of all publications to which the Subscriber subscribes.</span></span> <span data-ttu-id="50779-154">Par exemple, si un abonné adhère à trois publications avec des périodes de conservation de 10, 20 et 30 jours respectivement, la sauvegarde utilisée pour restaurer la base de données ne doit pas être âgée de plus de 10 jours.</span><span class="sxs-lookup"><span data-stu-id="50779-154">For example, if a Subscriber subscribes to three publications with retention periods of 10, 20, and 30 days, respectively, the backup used to restore the database should not be more than 10 days old.</span></span>  
  
-   <span data-ttu-id="50779-155">La synchronisation de la base de données d'abonnement avec chacun de ses abonnements après une restauration garantit que l'Abonné est à jour avec toutes les modifications au niveau du serveur de publication.</span><span class="sxs-lookup"><span data-stu-id="50779-155">Synchronizing the subscription database with each of its publications following a restore ensures that the Subscriber is up to date with all changes at the Publisher.</span></span>  
  
 <span data-ttu-id="50779-156">Pour définir la période de rétention de publication, consultez [Définir la période d’expiration des abonnements](../publish/set-the-expiration-period-for-subscriptions.md).</span><span class="sxs-lookup"><span data-stu-id="50779-156">To set the publication retention period, see [Set the Expiration Period for Subscriptions](../publish/set-the-expiration-period-for-subscriptions.md).</span></span>  
  
 <span data-ttu-id="50779-157">Pour synchroniser un abonnement, consultez [Synchronize a Push Subscription](../synchronize-a-push-subscription.md) et [Synchronize a Pull Subscription](../synchronize-a-pull-subscription.md).</span><span class="sxs-lookup"><span data-stu-id="50779-157">To synchronize a subscription, see [Synchronize a Push Subscription](../synchronize-a-push-subscription.md) and [Synchronize a Pull Subscription](../synchronize-a-pull-subscription.md).</span></span>  
  
## <a name="backing-up-and-restoring-a-republishing-database"></a><span data-ttu-id="50779-158">Sauvegarde et restauration d'une base de données de réédition</span><span class="sxs-lookup"><span data-stu-id="50779-158">Backing Up and Restoring a Republishing Database</span></span>  
 <span data-ttu-id="50779-159">Une base de données de réédition désigne une base de données qui s'abonne à des données auprès d'un éditeur et qui, à son tour, diffuse ces données à d'autres bases de données d'abonnement.</span><span class="sxs-lookup"><span data-stu-id="50779-159">When a database subscribes to data from a Publisher and in turn publishes that same data to other subscription databases, it is referred to as a republishing database.</span></span> <span data-ttu-id="50779-160">Lorsque vous restaurez une base de données de réédition, suivez les recommandations données dans les sections « Sauvegarde et restauration d'une base de données de publication » et « Sauvegarde et restauration d'une base de données d'abonnement » de cette rubrique.</span><span class="sxs-lookup"><span data-stu-id="50779-160">When restoring a republishing database, follow the guidelines described in "Backing Up and Restoring a Publication Database" and "Backing Up and Restoring a Subscription Database" in this topic.</span></span>  
  
## <a name="see-also"></a><span data-ttu-id="50779-161">Voir aussi</span><span class="sxs-lookup"><span data-stu-id="50779-161">See Also</span></span>  
 <span data-ttu-id="50779-162">[Sauvegarde et restauration des bases de données SQL Server](../../backup-restore/back-up-and-restore-of-sql-server-databases.md) </span><span class="sxs-lookup"><span data-stu-id="50779-162">[Back Up and Restore of SQL Server Databases](../../backup-restore/back-up-and-restore-of-sql-server-databases.md) </span></span>  
 [<span data-ttu-id="50779-163">Sauvegarder et restaurer des bases de données répliquées</span><span class="sxs-lookup"><span data-stu-id="50779-163">Back Up and Restore Replicated Databases</span></span>](back-up-and-restore-replicated-databases.md)  
  
  
