---
title: Améliorer les performances de réplication de fusion | Microsoft Docs
ms.custom: ''
ms.date: 03/08/2017
ms.prod: sql-server-2014
ms.reviewer: ''
ms.technology: replication
ms.topic: conceptual
helpviewer_keywords:
- publications [SQL Server replication], design and performance
- designing databases [SQL Server], replication performance
- Merge Agent, performance
- snapshots [SQL Server replication], performance considerations
- merge replication performance [SQL Server replication]
- subscriptions [SQL Server replication], performance considerations
- performance [SQL Server replication], merge replication
- agents [SQL Server replication], performance
ms.assetid: f929226f-b83d-4900-a07c-a62f64527c7f
author: MashaMSFT
ms.author: mathoma
ms.openlocfilehash: 41dc258e9b45e9839ad142e73cb145999d02986c
ms.sourcegitcommit: ad4d92dce894592a259721a1571b1d8736abacdb
ms.translationtype: MT
ms.contentlocale: fr-FR
ms.lasthandoff: 08/04/2020
ms.locfileid: "87709240"
---
# <a name="enhance-merge-replication-performance"></a><span data-ttu-id="52396-102">Améliorer les performances de réplication de fusion</span><span class="sxs-lookup"><span data-stu-id="52396-102">Enhance Merge Replication Performance</span></span>
  <span data-ttu-id="52396-103">Après avoir considéré les conseils en matière de performances qui sont décrits dans la rubrique [Amélioration des performances générales de la réplication](enhance-general-replication-performance.md), considérez ces autres aspects spécifiques à la réplication de fusion.</span><span class="sxs-lookup"><span data-stu-id="52396-103">After considering the general performance tips described in [Enhancing General Replication Performance](enhance-general-replication-performance.md), consider these additional areas specific to merge replication.</span></span>  
  
## <a name="database-design"></a><span data-ttu-id="52396-104">Création de bases de données</span><span class="sxs-lookup"><span data-stu-id="52396-104">Database Design</span></span>  
  
-   <span data-ttu-id="52396-105">Colonnes d'index utilisées dans des filtres de lignes et des filtres de jointure.</span><span class="sxs-lookup"><span data-stu-id="52396-105">Index columns used in row filters and join filters.</span></span>  
  
     <span data-ttu-id="52396-106">Si vous utilisez un filtre de lignes sur un article publié, créez un index sur chacune des colonnes utilisées dans la clause WHERE du filtre.</span><span class="sxs-lookup"><span data-stu-id="52396-106">When you use a row filter on a published article, create an index on each of the columns that is used in the filter's WHERE clause.</span></span> <span data-ttu-id="52396-107">S’il n’y a pas d’index, [!INCLUDE[msCoName](../../../includes/msconame-md.md)] [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] doit lire chaque ligne de la table pour déterminer si la ligne doit être incluse dans la partition.</span><span class="sxs-lookup"><span data-stu-id="52396-107">Without an index, [!INCLUDE[msCoName](../../../includes/msconame-md.md)] [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] has to read each row in the table to determine whether the row should be included in the partition.</span></span> <span data-ttu-id="52396-108">Avec un index, [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] peut localiser rapidement les lignes à inclure.</span><span class="sxs-lookup"><span data-stu-id="52396-108">With an index, [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] can quickly locate which rows should be included.</span></span> <span data-ttu-id="52396-109">Le traitement le plus rapide s'effectue si la réplication peut résoudre complètement la clause WHERE du filtre à partir de l'index seul.</span><span class="sxs-lookup"><span data-stu-id="52396-109">The fastest processing takes place if replication can fully resolve the WHERE clause of the filter from the index alone.</span></span>  
  
     <span data-ttu-id="52396-110">L'indexation de toutes les colonnes utilisées dans des filtres de jointure est également importante.</span><span class="sxs-lookup"><span data-stu-id="52396-110">Indexing all the columns used in join filters is also important.</span></span> <span data-ttu-id="52396-111">À chaque exécution, l'Agent de fusion recherche dans la table de base quelles lignes de la table parente et quelles lignes des tables associées sont incluses dans une partition.</span><span class="sxs-lookup"><span data-stu-id="52396-111">Each time the Merge Agent runs, it searches the base table to determine which rows in a parent table and which rows in related tables are included in a partition.</span></span> <span data-ttu-id="52396-112">La création d'un index sur les colonnes jointes dispense [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] de devoir lire chaque ligne de la table à chaque exécution de l'Agent de fusion.</span><span class="sxs-lookup"><span data-stu-id="52396-112">Creating an index on the joined columns avoids having [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] read each row in the table every time the Merge Agent runs.</span></span>  
  
     <span data-ttu-id="52396-113">Pour plus d’informations sur le filtrage, consultez [Filtrer des données publiées en vue de la réplication de fusion](../merge/filter-published-data-for-merge-replication.md).</span><span class="sxs-lookup"><span data-stu-id="52396-113">For more information on filtering, see [Filter Published Data for Merge Replication](../merge/filter-published-data-for-merge-replication.md).</span></span>  
  
-   <span data-ttu-id="52396-114">Envisagez de surnormaliser les tables qui incluent des types de données LOB.</span><span class="sxs-lookup"><span data-stu-id="52396-114">Consider overnormalizing tables that include Large Object (LOB) data types.</span></span>  
  
     <span data-ttu-id="52396-115">Lors d'une synchronisation, l'Agent de fusion peut avoir besoin de lire et de transférer la totalité de la ligne de données à partir d'un serveur de publication ou d'un Abonné.</span><span class="sxs-lookup"><span data-stu-id="52396-115">When synchronization occurs, the Merge Agent might need to read and transfer the entire data row from a Publisher or Subscriber.</span></span> <span data-ttu-id="52396-116">Si la ligne contient des colonnes utilisant des données de type LOB, ce processus peut nécessiter un surcroît d'allocation de mémoire et nuire aux performances, même si ces colonnes peuvent ne pas avoir été mises à jour.</span><span class="sxs-lookup"><span data-stu-id="52396-116">If the row contains columns that use LOBs, this process can require additional memory allocation and negatively impact performance even though these columns may not have been updated.</span></span> <span data-ttu-id="52396-117">Pour limiter la probabilité d'une perte de performance, vous pouvez envisager de placer les colonnes LOB dans une table indépendante en les reliant aux autres données de la ligne avec une relation un-à-un.</span><span class="sxs-lookup"><span data-stu-id="52396-117">To reduce the likelihood that this performance impact occurs, consider putting LOB columns in a separate table using a one-to-one relationship to the rest of the row data.</span></span> <span data-ttu-id="52396-118">Les types de données `text`, `ntext` et `image` sont déconseillés.</span><span class="sxs-lookup"><span data-stu-id="52396-118">The data types `text`, `ntext`, and `image` are deprecated.</span></span> <span data-ttu-id="52396-119">Si vous incluez des données de type LOB, il est recommandé d'utiliser respectivement les types de données `varchar(max)`, `nvarchar(max)`, `varbinary(max)`.</span><span class="sxs-lookup"><span data-stu-id="52396-119">If you do include LOBs, we recommend that you use the data types `varchar(max)`, `nvarchar(max)`, `varbinary(max)`, respectively.</span></span>  
  
## <a name="publication-design"></a><span data-ttu-id="52396-120">Conception de la publication</span><span class="sxs-lookup"><span data-stu-id="52396-120">Publication Design</span></span>  
  
-   <span data-ttu-id="52396-121">Utilisez un niveau de compatibilité de la publication de 90RTM ([!INCLUDE[ssVersion2005](../../../includes/ssversion2005-md.md)] ) ou version ultérieure.</span><span class="sxs-lookup"><span data-stu-id="52396-121">Use a publication compatibility level of 90RTM ([!INCLUDE[ssVersion2005](../../../includes/ssversion2005-md.md)] or a later version).</span></span>  
  
     <span data-ttu-id="52396-122">À moins qu'un ou plusieurs Abonnés n'utilisent une version différente de [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)], spécifiez que la publication doit uniquement prendre en charge [!INCLUDE[ssVersion2005](../../../includes/ssversion2005-md.md)] ou version ultérieure.</span><span class="sxs-lookup"><span data-stu-id="52396-122">Unless one or more Subscribers use a different version of [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)], specify that the publication must support only [!INCLUDE[ssVersion2005](../../../includes/ssversion2005-md.md)] or a later version.</span></span> <span data-ttu-id="52396-123">Ceci permet à la publication de bénéficier des nouvelles fonctionnalités et optimisations des performances.</span><span class="sxs-lookup"><span data-stu-id="52396-123">This allows the publication to take advantage of new features and performance optimizations.</span></span>  
  
-   <span data-ttu-id="52396-124">Utilisez les paramètres de rétention de publication appropriés.</span><span class="sxs-lookup"><span data-stu-id="52396-124">Use appropriate publication retention settings.</span></span>  
  
     <span data-ttu-id="52396-125">La période de rétention de publication, qui est la quantité maximale de temps avant qu'un abonnement doive être synchronisé, détermine le temps pendant lequel les métadonnées de suivi sont stockées.</span><span class="sxs-lookup"><span data-stu-id="52396-125">The publication retention period, which is the maximum amount of time before a subscription must be synchronized, determines how long tracking metadata is stored.</span></span> <span data-ttu-id="52396-126">Une valeur élevée peut affecter les performances en matière de stockage et de traitement.</span><span class="sxs-lookup"><span data-stu-id="52396-126">A high value can affect storage and processing performance.</span></span> <span data-ttu-id="52396-127">Pour plus d'informations sur la définition de la période de rétention des publications, consultez [Subscription Expiration and Deactivation](../subscription-expiration-and-deactivation.md).</span><span class="sxs-lookup"><span data-stu-id="52396-127">For more information about setting the publication retention period, see [Subscription Expiration and Deactivation](../subscription-expiration-and-deactivation.md).</span></span>  
  
-   <span data-ttu-id="52396-128">Utilisez des articles en téléchargement seulement sur les tables qui sont modifiées seulement sur le serveur de publication.</span><span class="sxs-lookup"><span data-stu-id="52396-128">Use download-only articles on those tables that are only changed at the Publisher.</span></span> <span data-ttu-id="52396-129">Pour plus d’informations, consultez [Optimiser les performances de la réplication de fusion avec les articles en téléchargement seul](../merge/optimize-merge-replication-performance-with-download-only-articles.md).</span><span class="sxs-lookup"><span data-stu-id="52396-129">For more information, see [Optimize Merge Replication Performance with Download-Only Articles](../merge/optimize-merge-replication-performance-with-download-only-articles.md).</span></span>  
  
### <a name="filter-design-and-use"></a><span data-ttu-id="52396-130">Conception et utilisation des filtres</span><span class="sxs-lookup"><span data-stu-id="52396-130">Filter Design and Use</span></span>  
  
-   <span data-ttu-id="52396-131">Limitez la complexité des clauses des filtres de lignes.</span><span class="sxs-lookup"><span data-stu-id="52396-131">Limit the complexity of row filter clauses.</span></span>  
  
     <span data-ttu-id="52396-132">La limitation de la complexité des critères de filtrage permet un gain de performance lorsque l'Agent de fusion évalue les modifications de lignes à envoyer aux Abonnés.</span><span class="sxs-lookup"><span data-stu-id="52396-132">Limiting the complexity of the filtering criteria helps improve performance when the Merge Agent is evaluating row changes to send to Subscribers.</span></span> <span data-ttu-id="52396-133">Évitez l'utilisation de sous-sélections dans les clauses des filtres de lignes de fusion.</span><span class="sxs-lookup"><span data-stu-id="52396-133">Avoid using sub-selects within merge row filter clauses.</span></span> <span data-ttu-id="52396-134">Envisagez plutôt l'utilisation de filtres de jointure, généralement plus efficaces pour le partitionnement des données d'une table à partir de la clause de filtre de lignes d'une autre table.</span><span class="sxs-lookup"><span data-stu-id="52396-134">Instead, consider using join filters, which are generally more efficient when used to partition data in one table based on the row filter clause in another table.</span></span> <span data-ttu-id="52396-135">Pour plus d’informations sur le filtrage, consultez [Filtrer des données publiées en vue de la réplication de fusion](../merge/filter-published-data-for-merge-replication.md).</span><span class="sxs-lookup"><span data-stu-id="52396-135">For more information about filtering, see [Filter Published Data for Merge Replication](../merge/filter-published-data-for-merge-replication.md).</span></span>  
  
-   <span data-ttu-id="52396-136">Utilisez des partitions précalculées avec des filtres paramétrés (cette fonctionnalité est utilisée par défaut).</span><span class="sxs-lookup"><span data-stu-id="52396-136">Use precomputed partitions with parameterized filters (this feature is used by default).</span></span> <span data-ttu-id="52396-137">Pour plus d’informations, consultez [Optimiser les performances des filtres paramétrés avec des partitions précalculées](../merge/parameterized-filters-optimize-for-precomputed-partitions.md).</span><span class="sxs-lookup"><span data-stu-id="52396-137">For more information, see [Optimize Parameterized Filter Performance with Precomputed Partitions](../merge/parameterized-filters-optimize-for-precomputed-partitions.md).</span></span>  
  
     <span data-ttu-id="52396-138">Les partitions précalculées imposent plusieurs limitations au fonctionnement du filtrage.</span><span class="sxs-lookup"><span data-stu-id="52396-138">Precomputed partitions impose a number of limits on filtering behavior.</span></span> <span data-ttu-id="52396-139">Si votre application ne peut pas s'adapter à ces limitations, définissez l'option **keep_partition_changes** à **True**, ce qui permet d'obtenir un gain de performances.</span><span class="sxs-lookup"><span data-stu-id="52396-139">If your application cannot adhere to these limitations, set the **keep_partition_changes** option to **True**, which provides a performance benefit.</span></span> <span data-ttu-id="52396-140">Pour plus d'informations, voir [Parameterized Row Filters](../merge/parameterized-filters-parameterized-row-filters.md).</span><span class="sxs-lookup"><span data-stu-id="52396-140">For more information, see [Parameterized Row Filters](../merge/parameterized-filters-parameterized-row-filters.md).</span></span>  
  
-   <span data-ttu-id="52396-141">Utilisez des partitions qui ne se chevauchent pas si les données sont filtrées mais pas partagées entre les utilisateurs.</span><span class="sxs-lookup"><span data-stu-id="52396-141">Use nonoverlapping partitions if data is filtered but not shared among users.</span></span>  
  
     <span data-ttu-id="52396-142">La réplication peut optimiser les performances pour les données qui ne sont pas partagées entre des partitions ou des abonnements.</span><span class="sxs-lookup"><span data-stu-id="52396-142">Replication can optimize performance for data that is not shared between partitions or subscriptions.</span></span> <span data-ttu-id="52396-143">Pour plus d'informations, voir [Parameterized Row Filters](../merge/parameterized-filters-parameterized-row-filters.md).</span><span class="sxs-lookup"><span data-stu-id="52396-143">For more information, see [Parameterized Row Filters](../merge/parameterized-filters-parameterized-row-filters.md).</span></span>  
  
-   <span data-ttu-id="52396-144">Ne créez pas de hiérarchies de filtres de jointure complexes.</span><span class="sxs-lookup"><span data-stu-id="52396-144">Do not create complex join filter hierarchies.</span></span>  
  
     <span data-ttu-id="52396-145">Les filtres de jointure avec cinq tables ou plus peuvent avoir un impact significatif sur les performances lors du processus de fusion.</span><span class="sxs-lookup"><span data-stu-id="52396-145">Join filters with five or more tables can significantly impact performance during merge processing.</span></span> <span data-ttu-id="52396-146">Il est recommandé d'envisager d'autres solutions si vous générez des filtres de jointure impliquant cinq tables ou plus :</span><span class="sxs-lookup"><span data-stu-id="52396-146">We recommend that if you are generating join filters of five or more tables that you consider other solutions:</span></span>  
  
    -   <span data-ttu-id="52396-147">Évitez de filtrer les tables qui sont essentiellement des tables de recherche, des tables de taille réduite et des tables qui ne font pas l'objet de modifications.</span><span class="sxs-lookup"><span data-stu-id="52396-147">Avoid filtering tables that are primarily lookup tables, smaller tables, and tables that are not subject to change.</span></span> <span data-ttu-id="52396-148">Intégrez ces tables dans la publication dans leur globalité.</span><span class="sxs-lookup"><span data-stu-id="52396-148">Make those tables part of the publication in their entirety.</span></span> <span data-ttu-id="52396-149">Il est recommandé d'utiliser des filtres de jointure seulement entre des tables qui doivent être partitionnées entre des Abonnés.</span><span class="sxs-lookup"><span data-stu-id="52396-149">We recommend that you use join filters only between tables that must be partitioned among Subscribers.</span></span> <span data-ttu-id="52396-150">Pour plus d’informations, voir [Join Filters](../merge/join-filters.md).</span><span class="sxs-lookup"><span data-stu-id="52396-150">For more information, see [Join Filters](../merge/join-filters.md).</span></span>  
  
    -   <span data-ttu-id="52396-151">Envisagez la dénormalisation du design de la base de données ou l'utilisation d'une table de mappage s'il y a un grand nombre de tables dans une jointure.</span><span class="sxs-lookup"><span data-stu-id="52396-151">Consider denormalizing the database design or using a mapping table if there are a large number of tables in a join.</span></span> <span data-ttu-id="52396-152">Par exemple, si un commercial a seulement besoin des données relatives à ses clients mais que six jointures sont nécessaires pour associer un client avec un commercial, envisagez d'ajouter une colonne à la table des clients pour identifier le commercial.</span><span class="sxs-lookup"><span data-stu-id="52396-152">For example, if a sales person needs only the data for her customers, but it requires six joins to associate a customer with a sales person, consider adding a column to the customer table that identifies the sales person.</span></span> <span data-ttu-id="52396-153">Les données du commercial sont alors redondantes, mais les coûts liés à la dénormalisation des tables peuvent être compensés par les gains de performance pour le partitionnement de la réplication.</span><span class="sxs-lookup"><span data-stu-id="52396-153">The sales person data is redundant, but the costs of denormalizing the tables somewhat might be outweighed by the performance benefits for replication partitioning.</span></span>  
  
    -   <span data-ttu-id="52396-154">Pour améliorer les performances des partitions précalculées lorsque des traitements contiennent un grand nombre de données modifiées, concevez votre application avec soin.</span><span class="sxs-lookup"><span data-stu-id="52396-154">To improve the performance of precomputed partitions when batches contain lots of data changes, design your application with care.</span></span> <span data-ttu-id="52396-155">Assurez-vous que les modifications apportées aux données de la table parente dans un filtre de jointure ont lieu avant les modifications correspondantes dans les tables enfants.</span><span class="sxs-lookup"><span data-stu-id="52396-155">Make sure that changes to data in the parent table in a join filter are made before corresponding changes in the child tables.</span></span>  
  
-   <span data-ttu-id="52396-156">Définissez l'option **join_unique_key** à **1** si la logique le permet.</span><span class="sxs-lookup"><span data-stu-id="52396-156">Set the **join_unique_key** option to **1** if logic allows.</span></span>  
  
     <span data-ttu-id="52396-157">La définition de ce paramètre à **1** indique que la relation entre les tables enfants et parent dans un filtre de jointure est « un à un » ou « un à plusieurs ».</span><span class="sxs-lookup"><span data-stu-id="52396-157">Setting this parameter to **1** indicates that the relationship between the child and parent tables in a join filter is one to one or one to many.</span></span> <span data-ttu-id="52396-158">Définissez ce paramètre à **1** seulement si vous avez une contrainte sur la colonne de jointure dans la table enfant qui garantit l'unicité.</span><span class="sxs-lookup"><span data-stu-id="52396-158">Only set this parameter to **1** if you have a constraint on the joining column in the child table that guarantees uniqueness.</span></span> <span data-ttu-id="52396-159">Si ce paramètre est incorrectement défini à **1** , il peut se produire une non-convergence des données.</span><span class="sxs-lookup"><span data-stu-id="52396-159">If the parameter is set to **1** incorrectly, non-convergence of data can occur.</span></span> <span data-ttu-id="52396-160">Pour plus d’informations, voir [Join Filters](../merge/join-filters.md).</span><span class="sxs-lookup"><span data-stu-id="52396-160">For more information, see [Join Filters](../merge/join-filters.md).</span></span>  
  
-   <span data-ttu-id="52396-161">Évitez d'exécuter des traitements avec un grand nombre de modifications lorsque vous utilisez des partitions précalculées.</span><span class="sxs-lookup"><span data-stu-id="52396-161">Avoid executing batches with lots of changes when you use precomputed partitions.</span></span>  
  
     <span data-ttu-id="52396-162">Lorsque vous exécutez l'Agent de fusion après avoir exécuté un traitement avec un grand nombre de données modifiées, l'agent tente de scinder le traitement en question en traitements plus petits.</span><span class="sxs-lookup"><span data-stu-id="52396-162">When the Merge Agent is run after you run a batch that contains lots of data changes, the agent tries to divide the large batch into smaller batches.</span></span> <span data-ttu-id="52396-163">Au cours de cette opération, d'autres processus de l'Agent de fusion peuvent être bloqués.</span><span class="sxs-lookup"><span data-stu-id="52396-163">During this time, other Merge Agent processes may be blocked.</span></span> <span data-ttu-id="52396-164">Si possible, réduisez le nombre de modifications dans un traitement et exécutez l'Agent de fusion entre les traitements.</span><span class="sxs-lookup"><span data-stu-id="52396-164">Consider reducing the number of changes in a batch and run the Merge Agent between batches.</span></span> <span data-ttu-id="52396-165">Si cela est impossible, augmentez la valeur **generation_leveling_threshold** de la publication.</span><span class="sxs-lookup"><span data-stu-id="52396-165">If this cannot be done, increase the value of **generation_leveling_threshold** for the publication.</span></span>  
  
## <a name="subscription-considerations"></a><span data-ttu-id="52396-166">Considérations sur les abonnements</span><span class="sxs-lookup"><span data-stu-id="52396-166">Subscription Considerations</span></span>  
  
-   <span data-ttu-id="52396-167">Échelonnez les planifications de synchronisation des abonnements.</span><span class="sxs-lookup"><span data-stu-id="52396-167">Stagger subscription synchronization schedules.</span></span>  
  
     <span data-ttu-id="52396-168">Si un grand nombre d'Abonnés se synchronisent avec un serveur de publication, envisagez d'échelonner les planifications de façon à ce que les Agents de fusion s'exécutent à des moments différents.</span><span class="sxs-lookup"><span data-stu-id="52396-168">If a large number of Subscribers synchronize with a Publisher, consider staggering the schedules so that Merge Agents run at different times.</span></span> <span data-ttu-id="52396-169">Pour plus d’informations, consultez [Spécifier des planifications de synchronisation](../specify-synchronization-schedules.md).</span><span class="sxs-lookup"><span data-stu-id="52396-169">For more information, see [Specify Synchronization Schedules](../specify-synchronization-schedules.md).</span></span>  
  
## <a name="merge-agent-parameters"></a><span data-ttu-id="52396-170">Paramètres de l'Agent de fusion</span><span class="sxs-lookup"><span data-stu-id="52396-170">Merge Agent Parameters</span></span>  
 <span data-ttu-id="52396-171">Pour plus d'informations sur l'Agent de fusion et sur ses paramètres, consultez [Replication Merge Agent](../agents/replication-merge-agent.md).</span><span class="sxs-lookup"><span data-stu-id="52396-171">For information about the Merge Agent and its parameters, see [Replication Merge Agent](../agents/replication-merge-agent.md).</span></span>  
  
-   <span data-ttu-id="52396-172">Mettez à niveau tous les Abonnés pour les abonnements par extraction vers [!INCLUDE[ssVersion2005](../../../includes/ssversion2005-md.md)] ou version ultérieure.</span><span class="sxs-lookup"><span data-stu-id="52396-172">Upgrade all Subscribers for pull subscriptions to [!INCLUDE[ssVersion2005](../../../includes/ssversion2005-md.md)] or a later version.</span></span>  
  
     <span data-ttu-id="52396-173">La mise à niveau de l'Abonné vers [!INCLUDE[ssVersion2005](../../../includes/ssversion2005-md.md)] ou version ultérieure met à niveau l'Agent de fusion utilisé par les abonnements sur cet Abonné.</span><span class="sxs-lookup"><span data-stu-id="52396-173">Upgrading the Subscriber to [!INCLUDE[ssVersion2005](../../../includes/ssversion2005-md.md)] or a later version upgrades the Merge Agent used by the subscriptions at that Subscriber.</span></span> <span data-ttu-id="52396-174">Pour tirer parti des nouvelles fonctionnalités et optimisations des performances, l'Agent de fusion [!INCLUDE[ssVersion2005](../../../includes/ssversion2005-md.md)] ou version ultérieure est obligatoire.</span><span class="sxs-lookup"><span data-stu-id="52396-174">To take advantage of many of the new features and performance optimizations, the Merge Agent from [!INCLUDE[ssVersion2005](../../../includes/ssversion2005-md.md)] or a later version is required.</span></span>  
  
-   <span data-ttu-id="52396-175">Si un abonnement est synchronisé par le biais d’une connexion rapide et si des modifications sont envoyées à partir du serveur de publication et à partir de l’Abonné, utilisez le paramètre **-ParallelUploadDownload** pour l’Agent de fusion.</span><span class="sxs-lookup"><span data-stu-id="52396-175">If a subscription is synchronized over a fast connection and changes are sent from the Publisher and Subscriber, use the **-ParallelUploadDownload** parameter for the Merge Agent.</span></span>  
  
     [!INCLUDE[ssVersion2005](../../../includes/ssversion2005-md.md)] <span data-ttu-id="52396-176">a introduit un nouveau paramètre pour l’Agent de fusion : **-ParallelUploadDownload**.</span><span class="sxs-lookup"><span data-stu-id="52396-176">introduced a new Merge Agent parameter: **-ParallelUploadDownload**.</span></span> <span data-ttu-id="52396-177">La définition de ce paramètre permet à l'Agent de fusion de traiter en parallèle les modifications chargées vers le serveur de publication et celles qui sont téléchargées vers l'Abonné.</span><span class="sxs-lookup"><span data-stu-id="52396-177">Setting this parameter allows the Merge Agent to process in parallel the changes uploaded to the Publisher and those downloaded to the Subscriber.</span></span> <span data-ttu-id="52396-178">Ceci est utile dans les environnements où les volumes sont élevés, avec une bande passante réseau élevée.</span><span class="sxs-lookup"><span data-stu-id="52396-178">This is useful in high volume environments with high network bandwidth.</span></span> <span data-ttu-id="52396-179">Les paramètres des agents peuvent être spécifiés dans des profils d'agent et sur la ligne de commande.</span><span class="sxs-lookup"><span data-stu-id="52396-179">Agent parameters can be specified in agent profiles and on the command line.</span></span> <span data-ttu-id="52396-180">Pour plus d'informations, consultez les pages suivantes :</span><span class="sxs-lookup"><span data-stu-id="52396-180">For more information, see:</span></span>  
  
    -   [<span data-ttu-id="52396-181">Utiliser des profils d’agent de réplication</span><span class="sxs-lookup"><span data-stu-id="52396-181">Work with Replication Agent Profiles</span></span>](../agents/replication-agent-profiles.md)  
  
    -   [<span data-ttu-id="52396-182">Afficher et modifier des paramètres d’invite de commandes d’un Agent de réplication &#40;SQL Server Management Studio&#41;</span><span class="sxs-lookup"><span data-stu-id="52396-182">View and Modify Replication Agent Command Prompt Parameters &#40;SQL Server Management Studio&#41;</span></span>](../agents/view-and-modify-replication-agent-command-prompt-parameters.md)  
  
    -   [<span data-ttu-id="52396-183">Concepts des exécutables de l'agent de réplication</span><span class="sxs-lookup"><span data-stu-id="52396-183">Replication Agent Executables Concepts</span></span>](../concepts/replication-agent-executables-concepts.md)  
  
-   <span data-ttu-id="52396-184">Envisagez d’augmenter la valeur du paramètre **-MakeGenerationInterval** , surtout si la synchronisation implique plus de téléchargements en provenance des Abonnés que vers les Abonnés.</span><span class="sxs-lookup"><span data-stu-id="52396-184">Consider increasing the value of the **-MakeGenerationInterval** parameter, especially if synchronization involves more uploads from Subscribers than downloads to Subscribers.</span></span>  
  
-   <span data-ttu-id="52396-185">Lorsque vous synchroniser des lignes de données avec une grande quantité de données (par exemple, des lignes avec des colonnes LOB), la synchronisation Web peur exiger une allocation supplémentaire de mémoire et nuire aux performances.</span><span class="sxs-lookup"><span data-stu-id="52396-185">When you synchronize data rows with a large amount of data, such as rows with LOB columns, Web synchronization can require additional memory allocation and hurt performance.</span></span> <span data-ttu-id="52396-186">Cette situation se produit lorsque l'Agent de fusion génère un message XML qui contient trop de lignes de données avec de gros volumes de données.</span><span class="sxs-lookup"><span data-stu-id="52396-186">This occurs when the Merge Agent generates an XML message that contains too many data rows with large amounts of data.</span></span> <span data-ttu-id="52396-187">Si l'Agent de fusion consomme trop de ressources lors de la synchronisation Web, réduisez le nombre de lignes transmises dans un seul message de l'une des manières suivantes :</span><span class="sxs-lookup"><span data-stu-id="52396-187">If the Merge Agent is consuming too many resources during Web synchronization, reduce the number of rows sent in a single message in one of the following ways:</span></span>  
  
    -   <span data-ttu-id="52396-188">Utilisez le profil de liaison lente de l'Agent de fusion.</span><span class="sxs-lookup"><span data-stu-id="52396-188">Use the slow link agent profile for the Merge Agent.</span></span> <span data-ttu-id="52396-189">Pour plus d'informations, voir [Replication Agent Profiles](../agents/replication-agent-profiles.md).</span><span class="sxs-lookup"><span data-stu-id="52396-189">For more information, see [Replication Agent Profiles](../agents/replication-agent-profiles.md).</span></span>  
  
    -   <span data-ttu-id="52396-190">Réduisez les paramètres **- DownloadGenerationsPerBatch** et **- UploadGenerationsPerBatch** de l’Agent de fusion à une valeur de 10 maximum.</span><span class="sxs-lookup"><span data-stu-id="52396-190">Decrease the **-DownloadGenerationsPerBatch** and **-UploadGenerationsPerBatch** parameters for the Merge Agent to a value of 10 or less.</span></span> <span data-ttu-id="52396-191">La valeur par défaut de ces paramètres est 50.</span><span class="sxs-lookup"><span data-stu-id="52396-191">The default value of these parameters is 50.</span></span>  
  
## <a name="snapshot-considerations"></a><span data-ttu-id="52396-192">Considérations sur les instantanés</span><span class="sxs-lookup"><span data-stu-id="52396-192">Snapshot Considerations</span></span>  
  
-   <span data-ttu-id="52396-193">Créez une colonne ROWGUIDCOL sur les grandes tables avant la génération de l'instantané initial.</span><span class="sxs-lookup"><span data-stu-id="52396-193">Create a ROWGUIDCOL column on large tables prior to generating the initial snapshot.</span></span>  
  
     <span data-ttu-id="52396-194">La réplication de fusion exige que chaque table publiée possède une colonne ROWGUIDCOL.</span><span class="sxs-lookup"><span data-stu-id="52396-194">Merge replication requires that each published table have a ROWGUIDCOL column.</span></span> <span data-ttu-id="52396-195">Si aucune colonne ROWGUIDCOL n'existe dans la table avant que l'Agent d'instantané ne crée les premiers fichiers d'instantané, l'Agent doit tout d'abord ajouter et remplir la colonne ROWGUIDCOL.</span><span class="sxs-lookup"><span data-stu-id="52396-195">If a ROWGUIDCOL column does not exist in the table before the Snapshot Agent creates the initial snapshot files, the agent must first add and populate the ROWGUIDCOL column.</span></span> <span data-ttu-id="52396-196">Pour bénéficier d'une amélioration des performances lors de la génération d'instantanés, créez la colonne ROWGUIDCOL sur chaque table avant de procéder à la publication.</span><span class="sxs-lookup"><span data-stu-id="52396-196">To gain a performance advantage when generating snapshots during merge replication, create the ROWGUIDCOL column on each table before publishing.</span></span> <span data-ttu-id="52396-197">La colonne peut porter n'importe quel nom (le**rowguid** est utilisé par défaut par l'Agent d'instantané), mais elle doit présenter les caractéristiques suivantes du point de vue des types de données :</span><span class="sxs-lookup"><span data-stu-id="52396-197">The column can have any name (**rowguid** is used by the Snapshot Agent by default), but must have the following data type characteristics:</span></span>  
  
    -   <span data-ttu-id="52396-198">Un type de données UNIQUEIDENTIFIER.</span><span class="sxs-lookup"><span data-stu-id="52396-198">A data type of UNIQUEIDENTIFIER.</span></span>  
  
    -   <span data-ttu-id="52396-199">Une valeur par défaut NEWSEQUENTIALID() ou NEWID().</span><span class="sxs-lookup"><span data-stu-id="52396-199">A default of NEWSEQUENTIALID() or NEWID().</span></span> <span data-ttu-id="52396-200">NEWSEQUENTIALID() est recommandée car elle peut améliorer les performances lorsque des modifications sont effectuées et suivies.</span><span class="sxs-lookup"><span data-stu-id="52396-200">NEWSEQUENTIALID() is recommended because it can provide increased performance when making and tracking changes.</span></span>  
  
    -   <span data-ttu-id="52396-201">La propriété ROWGUIDCOL définie.</span><span class="sxs-lookup"><span data-stu-id="52396-201">The ROWGUIDCOL property set.</span></span>  
  
    -   <span data-ttu-id="52396-202">un index unique sur la colonne.</span><span class="sxs-lookup"><span data-stu-id="52396-202">A unique index on the column.</span></span>  
  
-   <span data-ttu-id="52396-203">Prégénérez des instantanés et/ou permettez aux Abonnés de demander la génération et l'application d'un instantané la première fois qu'ils se synchronisent.</span><span class="sxs-lookup"><span data-stu-id="52396-203">Pre-generate snapshots and/or allow Subscribers to request snapshot generation and application the first time they synchronize.</span></span>  
  
     <span data-ttu-id="52396-204">Utilisez l'une ou l'autre de ces options ou les deux pour fournir des instantanés pour les publications qui utilisent des filtres paramétrés.</span><span class="sxs-lookup"><span data-stu-id="52396-204">Use one or both of these options to provide snapshots for publications that use parameterized filters.</span></span> <span data-ttu-id="52396-205">Si vous ne spécifiez pas une de ces options, les abonnements sont initialisés à l'aide d'une série d'instructions SELECT et INSERT au lieu d'utiliser l'utilitaire **bcp** , ce processus étant beaucoup plus lent.</span><span class="sxs-lookup"><span data-stu-id="52396-205">If you do not specify one of these options, subscriptions are initialized using a series of SELECT and INSERT statements, rather than using the **bcp** utility; this process is much slower.</span></span> <span data-ttu-id="52396-206">Pour plus d'informations, voir [Snapshots for Merge Publications with Parameterized Filters](../snapshots-for-merge-publications-with-parameterized-filters.md).</span><span class="sxs-lookup"><span data-stu-id="52396-206">For more information, see [Snapshots for Merge Publications with Parameterized Filters](../snapshots-for-merge-publications-with-parameterized-filters.md).</span></span>  
  
## <a name="maintenance-and-monitoring-considerations"></a><span data-ttu-id="52396-207">Considérations sur la maintenance et sur l'analyse</span><span class="sxs-lookup"><span data-stu-id="52396-207">Maintenance and Monitoring Considerations</span></span>  
  
-   <span data-ttu-id="52396-208">Réindexez occasionnellement les tables système d'une réplication de fusion</span><span class="sxs-lookup"><span data-stu-id="52396-208">Occasionally re-index merge replication system tables.</span></span>  
  
     <span data-ttu-id="52396-209">Dans le cadre de la gestion d'une réplication de fusion, contrôlez de temps en temps le développement des tables système associées à cette réplication : **MSmerge_contents**, **MSmerge_genhistory**, **MSmerge_tombstone**, **MSmerge_current_partition_mappings**et **MSmerge_past_partition_mappings**.</span><span class="sxs-lookup"><span data-stu-id="52396-209">As part of maintenance for merge replication, occasionally check the growth of the system tables associated with merge replication: **MSmerge_contents**, **MSmerge_genhistory**, and **MSmerge_tombstone**, **MSmerge_current_partition_mappings**, and **MSmerge_past_partition_mappings**.</span></span> <span data-ttu-id="52396-210">Réindexez périodiquement ces tables.</span><span class="sxs-lookup"><span data-stu-id="52396-210">Periodically re-index these tables.</span></span> <span data-ttu-id="52396-211">Pour plus d’informations, consultez [Réorganiser et reconstruire des index](../../indexes/reorganize-and-rebuild-indexes.md).</span><span class="sxs-lookup"><span data-stu-id="52396-211">For more information, see [Reorganize and Rebuild Indexes](../../indexes/reorganize-and-rebuild-indexes.md).</span></span>  
  
-   <span data-ttu-id="52396-212">Analysez les performances de la synchronisation à l'aide de l'onglet **Historique de synchronisation** dans le moniteur de réplication.</span><span class="sxs-lookup"><span data-stu-id="52396-212">Monitor synchronization performance using the **Synchronization History** tab in Replication Monitor.</span></span>  
  
     <span data-ttu-id="52396-213">Pour la réplication de fusion, le moniteur de réplication affiche des statistiques détaillées dans l'onglet **Historique de synchronisation** pour chaque article traité lors de la synchronisation, notamment la quantité de temps passé dans chaque phase du traitement (chargement des modifications, téléchargement des modifications, etc.).</span><span class="sxs-lookup"><span data-stu-id="52396-213">For merge replication, Replication Monitor displays detailed statistics in the **Synchronization History** tab for each article processed during synchronization, including the amount of time spent in each processing phase (uploading changes, downloading changes, and so on).</span></span> <span data-ttu-id="52396-214">Il peut être utile d'identifier les tables spécifiques qui provoquent les ralentissements ; il s'agit du meilleur observatoire pour résoudre les problèmes de performance avec les abonnements de fusion.</span><span class="sxs-lookup"><span data-stu-id="52396-214">It can help pinpoint specific tables that are causing slow downs and is the best place to troubleshoot performance issues with merge subscriptions.</span></span> <span data-ttu-id="52396-215">Pour plus d’informations sur l’affichage de statistiques détaillées, consultez [Afficher des informations et effectuer des tâches à l’aide du moniteur de réplication](../monitor/view-information-and-perform-tasks-replication-monitor.md).</span><span class="sxs-lookup"><span data-stu-id="52396-215">For more information on viewing detailed statistics, see [View Information and Perform Tasks using Replication Monitor](../monitor/view-information-and-perform-tasks-replication-monitor.md).</span></span>  
  
  
