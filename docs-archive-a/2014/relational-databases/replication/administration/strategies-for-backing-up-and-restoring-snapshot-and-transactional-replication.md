---
title: Stratégies de sauvegarde et de restauration de la réplication transactionnelle et d’instantané | Microsoft Docs
ms.custom: ''
ms.date: 03/08/2017
ms.prod: sql-server-2014
ms.reviewer: ''
ms.technology: replication
ms.topic: conceptual
helpviewer_keywords:
- backups [SQL Server replication], snapshot replication
- restoring [SQL Server replication], transactional replication
- snapshot replication [SQL Server], backup and restore
- restoring [SQL Server replication], snapshot replication
- recovery [SQL Server replication], transactional replication
- transactional replication, backup and restore
- recovery [SQL Server replication], snapshot replication
- sync with backup [SQL Server replication]
- backups [SQL Server replication], transactional replication
ms.assetid: a8afcdbc-55db-4916-a219-19454f561f9e
author: MashaMSFT
ms.author: mathoma
ms.openlocfilehash: e26f6cf1a61e4df9db79bc5fd90429f86d70a99f
ms.sourcegitcommit: ad4d92dce894592a259721a1571b1d8736abacdb
ms.translationtype: MT
ms.contentlocale: fr-FR
ms.lasthandoff: 08/04/2020
ms.locfileid: "87615134"
---
# <a name="strategies-for-backing-up-and-restoring-snapshot-and-transactional-replication"></a><span data-ttu-id="d4ad5-102">Stratégies de sauvegarde et de restauration de la réplication transactionnelle et d'instantané</span><span class="sxs-lookup"><span data-stu-id="d4ad5-102">Strategies for Backing Up and Restoring Snapshot and Transactional Replication</span></span>
  <span data-ttu-id="d4ad5-103">Lors de la conception d'une stratégie de sauvegarde et de restauration de la réplication transactionnelle et d'instantané, vous devez identifier :</span><span class="sxs-lookup"><span data-stu-id="d4ad5-103">When you design a backup and restore strategy for snapshot and transactional replication, there are three areas to consider:</span></span>  
  
-   <span data-ttu-id="d4ad5-104">les bases de données à sauvegarder ;</span><span class="sxs-lookup"><span data-stu-id="d4ad5-104">Which databases to back up.</span></span>  
  
-   <span data-ttu-id="d4ad5-105">les paramètres de sauvegarde de la réplication transactionnelle ;</span><span class="sxs-lookup"><span data-stu-id="d4ad5-105">Backup settings for transactional replication.</span></span>  
  
-   <span data-ttu-id="d4ad5-106">les étapes requises pour restaurer une base de données.</span><span class="sxs-lookup"><span data-stu-id="d4ad5-106">The steps that are required to restore a database.</span></span> <span data-ttu-id="d4ad5-107">Celles-ci dépendent du type de réplication et des options choisies.</span><span class="sxs-lookup"><span data-stu-id="d4ad5-107">These depend on the type of replication and options chosen.</span></span>  
  
 <span data-ttu-id="d4ad5-108">Cette rubrique aborde chacun de ces points au cours des trois sections suivantes.</span><span class="sxs-lookup"><span data-stu-id="d4ad5-108">This topic covers each of these areas in the next three sections.</span></span> <span data-ttu-id="d4ad5-109">Pour plus d’informations sur la sauvegarde et la restauration de la publication Oracle, consultez [Sauvegarde et restauration des serveurs de publication Oracle](../non-sql/backup-and-restore-for-oracle-publishers.md).</span><span class="sxs-lookup"><span data-stu-id="d4ad5-109">For information about backup and restore for Oracle publishing, see [Backup and Restore for Oracle Publishers](../non-sql/backup-and-restore-for-oracle-publishers.md).</span></span>  
  
## <a name="backing-up-databases"></a><span data-ttu-id="d4ad5-110">Sauvegarde de bases de données</span><span class="sxs-lookup"><span data-stu-id="d4ad5-110">Backing up Databases</span></span>  
 <span data-ttu-id="d4ad5-111">Pour la réplication transactionnelle et d'instantané, vous devez sauvegarder régulièrement les bases de données suivantes :</span><span class="sxs-lookup"><span data-stu-id="d4ad5-111">For snapshot and transactional replication, you should regularly back up the following databases:</span></span>  
  
-   <span data-ttu-id="d4ad5-112">Base de données de publication sur le serveur de publication</span><span class="sxs-lookup"><span data-stu-id="d4ad5-112">The publication database at the Publisher.</span></span>  
  
-   <span data-ttu-id="d4ad5-113">Base de données de distribution sur le serveur de distribution</span><span class="sxs-lookup"><span data-stu-id="d4ad5-113">The distribution database at the Distributor.</span></span>  
  
-   <span data-ttu-id="d4ad5-114">Base de données d'abonnement sur chaque Abonné</span><span class="sxs-lookup"><span data-stu-id="d4ad5-114">The subscription database at each Subscriber.</span></span>  
  
-   <span data-ttu-id="d4ad5-115">Bases de données système **master** et **msdb** sur le serveur de publication, sur le serveur de distribution et sur tous les Abonnés.</span><span class="sxs-lookup"><span data-stu-id="d4ad5-115">The **master** and **msdb** system databases at the Publisher, Distributor and all Subscribers.</span></span> <span data-ttu-id="d4ad5-116">Il est recommandé de sauvegarder ces bases de données en même temps, ainsi que la base de données de réplication appropriée.</span><span class="sxs-lookup"><span data-stu-id="d4ad5-116">These databases should be backed up at the same time as each other and the relevant replication database.</span></span> <span data-ttu-id="d4ad5-117">Par exemple, sauvegardez les bases de données **master** et **msdb** du serveur de publication en même temps que la base de données de publication.</span><span class="sxs-lookup"><span data-stu-id="d4ad5-117">For example, back up the **master** and **msdb** databases at the Publisher at the same time that you back up the publication database.</span></span> <span data-ttu-id="d4ad5-118">Si la base de données de publication est restaurée, assurez-vous que les bases de données **master** et **msdb** sont cohérentes par rapport à la base de données de publication en termes de paramètres de configuration de la réplication.</span><span class="sxs-lookup"><span data-stu-id="d4ad5-118">If the publication database is restored, make sure that the **master** and **msdb** databases are consistent with the publication database with regard to replication configuration and settings.</span></span>  
  
 <span data-ttu-id="d4ad5-119">Si vous effectuez des sauvegardes régulières des journaux, toutes les modifications liées à la réplication doivent être capturées dans les sauvegardes des journaux.</span><span class="sxs-lookup"><span data-stu-id="d4ad5-119">If you perform regular log backups, any replication-related changes should be captured in the log backups.</span></span> <span data-ttu-id="d4ad5-120">Si vous n'effectuez pas de sauvegardes de fichiers journaux, une sauvegarde doit être effectuée chaque fois qu'une modification portant sur un paramètre de réplication a lieu.</span><span class="sxs-lookup"><span data-stu-id="d4ad5-120">If you do not perform log backups, a backup should be performed whenever a setting relevant to replication is changed.</span></span> <span data-ttu-id="d4ad5-121">Pour en savoir plus, voir [Common Actions Requiring an Updated Backup](common-actions-requiring-an-updated-backup.md).</span><span class="sxs-lookup"><span data-stu-id="d4ad5-121">For more information, see [Common Actions Requiring an Updated Backup](common-actions-requiring-an-updated-backup.md).</span></span>  
  
## <a name="backup-settings-for-transactional-replication"></a><span data-ttu-id="d4ad5-122">Paramètres de sauvegarde de la réplication transactionnelle</span><span class="sxs-lookup"><span data-stu-id="d4ad5-122">Backup Settings for Transactional Replication</span></span>  
 <span data-ttu-id="d4ad5-123">La réplication transactionnelle inclut l'utilisation de l'option **sync with backup** , qu'il est possible de définir sur la base de données de distribution et sur celle de publication :</span><span class="sxs-lookup"><span data-stu-id="d4ad5-123">Transactional replication includes using the **sync with backup** option, which can be set on the distribution database and the publication database:</span></span>  
  
-   <span data-ttu-id="d4ad5-124">Il est recommandé de toujours activer cette option sur la base de données de distribution.</span><span class="sxs-lookup"><span data-stu-id="d4ad5-124">We recommend that you always set this option on the distribution database.</span></span>  
  
     <span data-ttu-id="d4ad5-125">De cette façon, vous êtes assuré que les transactions du journal de la base de données de publication ne seront pas tronquées tant qu'elles n'auront pas été sauvegardées dans la base de données de distribution.</span><span class="sxs-lookup"><span data-stu-id="d4ad5-125">Setting this option on the distribution database ensures that transactions in the log of the publication database will not be truncated until they have been backed up at the distribution database.</span></span> <span data-ttu-id="d4ad5-126">La base de données de distribution peut être restaurée à partir de la dernière sauvegarde. Toutes les transactions manquantes sont remises à la base de données de distribution par la base de données de publication.</span><span class="sxs-lookup"><span data-stu-id="d4ad5-126">The distribution database can be restored to the last backup, and any missing transactions are delivered from the publication database to the distribution database.</span></span> <span data-ttu-id="d4ad5-127">La réplication se poursuit normalement.</span><span class="sxs-lookup"><span data-stu-id="d4ad5-127">Replication continues unaffected.</span></span>  
  
     <span data-ttu-id="d4ad5-128">L'activation de cette option sur la base de données de distribution n'a aucune incidence sur la latence de réplication.</span><span class="sxs-lookup"><span data-stu-id="d4ad5-128">Setting this option on the distribution database does not affect replication latency.</span></span> <span data-ttu-id="d4ad5-129">Cependant, l'option diffère la troncation du journal sur la base de données de publication jusqu'à ce que les transactions correspondantes de la base de données de distribution aient été sauvegardées.</span><span class="sxs-lookup"><span data-stu-id="d4ad5-129">However, the option will delay the truncation of the log on the publication database until the corresponding transactions in the distribution database have been backed up.</span></span> <span data-ttu-id="d4ad5-130">Il en résulte un journal des transactions plus volumineux dans la base de données de publication.</span><span class="sxs-lookup"><span data-stu-id="d4ad5-130">(This can create a larger transaction log in the publication database.)</span></span>  
  
-   <span data-ttu-id="d4ad5-131">Il est recommandé de configurer cette option sur la base de données de publication si votre application peut accepter une latence supplémentaire.</span><span class="sxs-lookup"><span data-stu-id="d4ad5-131">We recommend that you set this option on the publication database if your application can tolerate additional latency.</span></span>  
  
     <span data-ttu-id="d4ad5-132">L'activation de cette option garantit que les transactions ne sont pas remises à la base de données de distribution tant qu'elles ne sont pas sauvegardées dans la base de données de publication.</span><span class="sxs-lookup"><span data-stu-id="d4ad5-132">Setting this option on the publication database ensures that transactions are not delivered to the distribution database until they are backed up at the publication database.</span></span> <span data-ttu-id="d4ad5-133">La dernière sauvegarde de la base de données de publication peut ensuite être restaurée sur le serveur de publication en étant assuré que la base de données de distribution ne détient pas des transactions qui n'auraient pas été transmises à la base de données de publication restaurée.</span><span class="sxs-lookup"><span data-stu-id="d4ad5-133">The last publication database backup can then be restored at the Publisher without any chance of the distribution database having transactions that the restored publication database does not have.</span></span>  
  
     <span data-ttu-id="d4ad5-134">La latence et le débit sont affectés car les transactions ne peuvent être transmises à la base de données de distribution avant d'avoir été sauvegardées sur le serveur de publication.</span><span class="sxs-lookup"><span data-stu-id="d4ad5-134">Latency and throughput are affected because transactions cannot be delivered to the distribution database until they have been backed up at the Publisher.</span></span> <span data-ttu-id="d4ad5-135">Si, par exemple, le journal des transactions est sauvegardé toutes les cinq minutes, il existe une latence supplémentaire de cinq minutes entre la validation d'une transaction sur le serveur de publication et la remise de la transaction à la base de données de distribution, puis à l'Abonné.</span><span class="sxs-lookup"><span data-stu-id="d4ad5-135">For example, if the transaction log is backed up every five minutes, there is an additional five minutes of latency between when a transaction is committed at the Publisher and when the transaction is delivered to the distribution database, and subsequently the Subscriber.</span></span>  
  
    > [!NOTE]  
    >  <span data-ttu-id="d4ad5-136">L'option **sync with backup** garantit la cohérence entre les bases de données de publication et de distribution, mais elle ne vous protège pas contre d'éventuelles pertes de données.</span><span class="sxs-lookup"><span data-stu-id="d4ad5-136">The **sync with backup** option ensures consistency between the publication database and the distribution database, but the option does not guarantee against data loss.</span></span> <span data-ttu-id="d4ad5-137">En cas de perte du journal des transactions par exemple, les transactions validées depuis la dernière sauvegarde de fichier journal ne seront disponibles ni dans la base de données de publication ni dans celle de distribution.</span><span class="sxs-lookup"><span data-stu-id="d4ad5-137">For example, if the transaction log is lost, transactions that have been committed since the last transaction log backup will not be available in the publication database or the distribution database.</span></span> <span data-ttu-id="d4ad5-138">Ce comportement est identique à celui d'une base de données non répliquée.</span><span class="sxs-lookup"><span data-stu-id="d4ad5-138">This is the same behavior as a nonreplicated database.</span></span>  
  
 <span data-ttu-id="d4ad5-139">**Pour définir l'option sync with backup**</span><span class="sxs-lookup"><span data-stu-id="d4ad5-139">**To set the sync with backup option**</span></span>  
  
-   <span data-ttu-id="d4ad5-140">Programmation [!INCLUDE[tsql](../../../includes/tsql-md.md)] de la réplication : [Activer les sauvegardes coordonnées pour la réplication transactionnelle &#40;programmation Transact-SQL de la réplication&#41;](enable-coordinated-backups-for-transactional-replication.md)</span><span class="sxs-lookup"><span data-stu-id="d4ad5-140">Replication [!INCLUDE[tsql](../../../includes/tsql-md.md)] programming: [Enable Coordinated Backups for Transactional Replication &#40;Replication Transact-SQL Programming&#41;](enable-coordinated-backups-for-transactional-replication.md)</span></span>  
  
## <a name="restoring-databases-involved-in-replication"></a><span data-ttu-id="d4ad5-141">Restauration des bases de données concernées par la réplication</span><span class="sxs-lookup"><span data-stu-id="d4ad5-141">Restoring Databases Involved in Replication</span></span>  
 <span data-ttu-id="d4ad5-142">Il est possible de restaurer toutes les bases de données d'une topologie de réplication s'il existe des sauvegardes récentes et si vous respectez la procédure indiquée.</span><span class="sxs-lookup"><span data-stu-id="d4ad5-142">You can restore all databases in a replication topology if recent backups are available and the appropriate steps are followed.</span></span> <span data-ttu-id="d4ad5-143">Les étapes de restauration de la base de données de publication dépendent du type de réplication et des options utilisées, ce qui n'est pas le cas pour toutes les autres bases de données.</span><span class="sxs-lookup"><span data-stu-id="d4ad5-143">The restore steps for the publication database depend on the type of replication and options that are used; however, the restore steps for all other databases are independent of the type and options.</span></span>  
  
 <span data-ttu-id="d4ad5-144">La réplication prend en charge la restauration de bases de données répliquées sur le même serveur et dans la même base de données à partir desquels la sauvegarde a été créée.</span><span class="sxs-lookup"><span data-stu-id="d4ad5-144">Replication supports restoring replicated databases to the same server and database from which the backup was created.</span></span> <span data-ttu-id="d4ad5-145">Si vous restaurez une sauvegarde d'une base de données répliquée sur un autre serveur ou dans une autre base de données, les paramètres de réplication ne peuvent pas être conservés.</span><span class="sxs-lookup"><span data-stu-id="d4ad5-145">If you restore a backup of a replicated database to another server or database, replication settings cannot be preserved.</span></span> <span data-ttu-id="d4ad5-146">Dans ce cas, vous devez recréer la totalité des abonnements et des publications une fois les sauvegardes restaurées.</span><span class="sxs-lookup"><span data-stu-id="d4ad5-146">In this case, you must re-create all publications and subscriptions after backups are restored.</span></span>  
  
### <a name="publisher"></a><span data-ttu-id="d4ad5-147">Serveur de publication</span><span class="sxs-lookup"><span data-stu-id="d4ad5-147">Publisher</span></span>  
 <span data-ttu-id="d4ad5-148">Des procédures de restauration sont décrites pour les types de réplication suivants :</span><span class="sxs-lookup"><span data-stu-id="d4ad5-148">There are restore steps provided for the following types of replication:</span></span>  
  
-   <span data-ttu-id="d4ad5-149">Réplication d'instantané</span><span class="sxs-lookup"><span data-stu-id="d4ad5-149">Snapshot replication</span></span>  
  
-   <span data-ttu-id="d4ad5-150">Réplication transactionnelle en lecture seule</span><span class="sxs-lookup"><span data-stu-id="d4ad5-150">Read-only transactional replication</span></span>  
  
-   <span data-ttu-id="d4ad5-151">Réplication transactionnelle avec des abonnements mis à jour</span><span class="sxs-lookup"><span data-stu-id="d4ad5-151">Transactional replication with updating subscriptions</span></span>  
  
-   <span data-ttu-id="d4ad5-152">Réplication transactionnelle d'égal à égal</span><span class="sxs-lookup"><span data-stu-id="d4ad5-152">Peer-to-peer transactional replication</span></span>  
  
 <span data-ttu-id="d4ad5-153">La restauration des bases de données **msdb** et **master** , également décrite dans cette section, est identique pour les quatre types.</span><span class="sxs-lookup"><span data-stu-id="d4ad5-153">The restore of the **msdb** and **master** databases, which are also covered in this section, is the same for all four types.</span></span>  
  
#### <a name="publication-database-snapshot-replication"></a><span data-ttu-id="d4ad5-154">Base de données de publication : Réplication d'instantané</span><span class="sxs-lookup"><span data-stu-id="d4ad5-154">Publication Database: Snapshot Replication</span></span>  
  
1.  <span data-ttu-id="d4ad5-155">Restaurez la dernière sauvegarde de la base de données de publication.</span><span class="sxs-lookup"><span data-stu-id="d4ad5-155">Restore the latest backup of the publication database.</span></span> <span data-ttu-id="d4ad5-156">Passez à l’étape 2.</span><span class="sxs-lookup"><span data-stu-id="d4ad5-156">Go to step 2.</span></span>  
  
2.  <span data-ttu-id="d4ad5-157">Si la sauvegarde de la base de données de publication contient la dernière configuration de tous les abonnements et publications,</span><span class="sxs-lookup"><span data-stu-id="d4ad5-157">Does the publication database backup contain the latest configuration for all publications and subscriptions?</span></span> <span data-ttu-id="d4ad5-158">la restauration est alors terminée.</span><span class="sxs-lookup"><span data-stu-id="d4ad5-158">If yes, the restore is completed.</span></span> <span data-ttu-id="d4ad5-159">Sinon, passez à l'étape 3.</span><span class="sxs-lookup"><span data-stu-id="d4ad5-159">If no, go to step 3.</span></span>  
  
3.  <span data-ttu-id="d4ad5-160">Supprimez la configuration de la réplication sur le serveur de publication, le serveur de distribution et les Abonnés, puis recréez la configuration.</span><span class="sxs-lookup"><span data-stu-id="d4ad5-160">Remove the replication configuration from the Publisher, Distributor and Subscribers, and then re-create the configuration.</span></span> <span data-ttu-id="d4ad5-161">La restauration est terminée.</span><span class="sxs-lookup"><span data-stu-id="d4ad5-161">Restore is completed.</span></span>  
  
     <span data-ttu-id="d4ad5-162">Pour plus d’informations sur la suppression de la réplication, consultez [sp_removedbreplication &#40;Transact-SQL&#41;](/sql/relational-databases/system-stored-procedures/sp-removedbreplication-transact-sql).</span><span class="sxs-lookup"><span data-stu-id="d4ad5-162">For more information about how to remove replication, see [sp_removedbreplication &#40;Transact-SQL&#41;](/sql/relational-databases/system-stored-procedures/sp-removedbreplication-transact-sql).</span></span>  
  
#### <a name="publication-database-read-only-transactional-replication"></a><span data-ttu-id="d4ad5-163">Base de données de publication : réplication transactionnelle en lecture seule</span><span class="sxs-lookup"><span data-stu-id="d4ad5-163">Publication Database: Read-Only Transactional Replication</span></span>  
  
1.  <span data-ttu-id="d4ad5-164">Restaurez la dernière sauvegarde de la base de données de publication.</span><span class="sxs-lookup"><span data-stu-id="d4ad5-164">Restore the latest backup of the publication database.</span></span> <span data-ttu-id="d4ad5-165">Passez à l’étape 2.</span><span class="sxs-lookup"><span data-stu-id="d4ad5-165">Go to step 2.</span></span>  
  
2.  <span data-ttu-id="d4ad5-166">Si l'option **sync with backup** a été activée sur la base de données de publication avant la défaillance,</span><span class="sxs-lookup"><span data-stu-id="d4ad5-166">Was the **sync with backup** setting enabled on the publication database before the failure?</span></span> <span data-ttu-id="d4ad5-167">passez à l’étape 3 ; sinon, passez à l’étape 5.</span><span class="sxs-lookup"><span data-stu-id="d4ad5-167">If yes, go to step 3; if no, go to step 5.</span></span>  
  
     <span data-ttu-id="d4ad5-168">Si l'option est activée, la requête `SELECT DATABASEPROPERTYEX('<PublicationDatabaseName>', 'IsSyncWithBackup')` retourne la valeur 1.</span><span class="sxs-lookup"><span data-stu-id="d4ad5-168">If the setting is enabled, the query `SELECT DATABASEPROPERTYEX('<PublicationDatabaseName>', 'IsSyncWithBackup')` returns '1'.</span></span>  
  
3.  <span data-ttu-id="d4ad5-169">La sauvegarde restaurée est-elle complète et à jour ?</span><span class="sxs-lookup"><span data-stu-id="d4ad5-169">Is the restored backup complete and up-to-date?</span></span> <span data-ttu-id="d4ad5-170">Si elle contient la configuration la plus récente de tous les abonnements et publications,</span><span class="sxs-lookup"><span data-stu-id="d4ad5-170">Does it contain the latest configuration for all publications and subscriptions?</span></span> <span data-ttu-id="d4ad5-171">la restauration est alors terminée.</span><span class="sxs-lookup"><span data-stu-id="d4ad5-171">If yes, the restore is completed.</span></span> <span data-ttu-id="d4ad5-172">Sinon, passez à l’étape 4.</span><span class="sxs-lookup"><span data-stu-id="d4ad5-172">If no, go to step 4.</span></span>  
  
4.  <span data-ttu-id="d4ad5-173">Les informations de configuration dans la base de données de publication restaurée ne sont pas à jour.</span><span class="sxs-lookup"><span data-stu-id="d4ad5-173">The configuration information in the restored publication database is not up-to-date.</span></span> <span data-ttu-id="d4ad5-174">Par conséquent, vous devez vous assurer que les Abonnés ont toutes les commandes en attente dans la base de données de distribution, puis supprimer et recréer la configuration de la réplication.</span><span class="sxs-lookup"><span data-stu-id="d4ad5-174">Therefore, you must make sure that the Subscribers have all outstanding commands in the distribution database, and then drop and re-create the replication configuration.</span></span>  
  
    1.  <span data-ttu-id="d4ad5-175">Exécutez l'Agent de distribution jusqu'à ce que tous les Abonnés soient synchronisés avec les commandes non traitées dans la base de données de distribution.</span><span class="sxs-lookup"><span data-stu-id="d4ad5-175">Run the Distribution Agent until all Subscribers are synchronized with the outstanding commands in the distribution database.</span></span> <span data-ttu-id="d4ad5-176">Vérifiez que toutes les commandes sont remises aux Abonnés via l'onglet **Commandes non distribuées** du moniteur de réplication ou en interrogeant la vue [MSdistribution_status](/sql/relational-databases/system-views/msdistribution-status-transact-sql) de la base de données de distribution.</span><span class="sxs-lookup"><span data-stu-id="d4ad5-176">Verify that all commands are delivered to Subscribers by using the **Undistributed Commands** tab in Replication Monitor or by querying the [MSdistribution_status](/sql/relational-databases/system-views/msdistribution-status-transact-sql) view in the distribution database.</span></span> <span data-ttu-id="d4ad5-177">Passez à l'étape b.</span><span class="sxs-lookup"><span data-stu-id="d4ad5-177">Go to step b.</span></span>  
  
         <span data-ttu-id="d4ad5-178">Pour plus d’informations sur l’exécution de l’Agent de distribution, consultez [Démarrer et arrêter un Agent de réplication &#40;SQL Server Management Studio&#41;](../agents/start-and-stop-a-replication-agent-sql-server-management-studio.md) ou [Concepts des exécutables de l’Agent de réplication](../concepts/replication-agent-executables-concepts.md).</span><span class="sxs-lookup"><span data-stu-id="d4ad5-178">For more information about how to run the Distribution Agent, see [Start and Stop a Replication Agent &#40;SQL Server Management Studio&#41;](../agents/start-and-stop-a-replication-agent-sql-server-management-studio.md) and [Replication Agent Executables Concepts](../concepts/replication-agent-executables-concepts.md).</span></span>  
  
         <span data-ttu-id="d4ad5-179">Pour plus d’informations sur la vérification des commandes, consultez [afficher les commandes répliquées et d’autres informations dans la base de données de Distribution &#40;la programmation Transact-SQL de la réplication&#41;](../monitor/view-replicated-commands-and-information-in-distribution-database.md) et [afficher des informations et effectuer des tâches à l’aide du moniteur de réplication](../monitor/view-information-and-perform-tasks-replication-monitor.md).</span><span class="sxs-lookup"><span data-stu-id="d4ad5-179">For more information about how to verify commands, see [View Replicated Commands and Other Information in the Distribution Database &#40;Replication Transact-SQL Programming&#41;](../monitor/view-replicated-commands-and-information-in-distribution-database.md) and [View Information and Perform Tasks using Replication Monitor](../monitor/view-information-and-perform-tasks-replication-monitor.md).</span></span>  
  
    2.  <span data-ttu-id="d4ad5-180">Supprimez la configuration de la réplication sur le serveur de publication, le serveur de distribution et les Abonnés, puis recréez la configuration.</span><span class="sxs-lookup"><span data-stu-id="d4ad5-180">Remove the replication configuration from the Publisher, Distributor and Subscribers, and then re-create the configuration.</span></span> <span data-ttu-id="d4ad5-181">Lorsque vous recréez les abonnements, spécifiez que l'Abonné possède déjà les données.</span><span class="sxs-lookup"><span data-stu-id="d4ad5-181">When you re-create subscriptions, specify that the Subscriber already has the data.</span></span> <span data-ttu-id="d4ad5-182">La restauration est terminée.</span><span class="sxs-lookup"><span data-stu-id="d4ad5-182">The restore is completed.</span></span>  
  
         <span data-ttu-id="d4ad5-183">Pour plus d’informations sur la suppression de la réplication, consultez [sp_removedbreplication &#40;Transact-SQL&#41;](/sql/relational-databases/system-stored-procedures/sp-removedbreplication-transact-sql).</span><span class="sxs-lookup"><span data-stu-id="d4ad5-183">For more information about how to remove replication, see [sp_removedbreplication &#40;Transact-SQL&#41;](/sql/relational-databases/system-stored-procedures/sp-removedbreplication-transact-sql).</span></span>  
  
         <span data-ttu-id="d4ad5-184">Pour plus d'informations sur la manière de spécifier que l'Abonné possède déjà les données, consultez [Initialize a Subscription Manually](../initialize-a-subscription-manually.md).</span><span class="sxs-lookup"><span data-stu-id="d4ad5-184">For more information about how to specify that the Subscriber already has the data, see [Initialize a Subscription Manually](../initialize-a-subscription-manually.md).</span></span>  
  
5.  <span data-ttu-id="d4ad5-185">L'option **sync with backup** n'a pas été définie sur la base de données de publication.</span><span class="sxs-lookup"><span data-stu-id="d4ad5-185">The **sync with backup** option was not set on the publication database.</span></span> <span data-ttu-id="d4ad5-186">Par conséquent, les transactions qui n'ont pas été incluses dans la sauvegarde restaurée ont pu être remises au serveur de distribution et aux Abonnés.</span><span class="sxs-lookup"><span data-stu-id="d4ad5-186">Therefore, transactions that were not included in the restored backup might have been delivered to the Distributor and Subscribers.</span></span> <span data-ttu-id="d4ad5-187">Vous devez maintenant vous assurer que les Abonnés possèdent toutes les commandes non traitées de la base de données de distribution, puis appliquer manuellement à la base de données de publication les transactions qui ne sont pas incluses dans la sauvegarde restaurée.</span><span class="sxs-lookup"><span data-stu-id="d4ad5-187">You must now make sure that Subscribers have all outstanding commands in the distribution database, and then manually apply to the publication database any transactions that are not included in the restored backup.</span></span>  
  
    > [!IMPORTANT]  
    >  <span data-ttu-id="d4ad5-188">L'exécution de cette procédure peut se traduire par une restauration des tables publiées à un point dans le temps plus récent que celui des autres tables non publiées restaurées à partir de la sauvegarde.</span><span class="sxs-lookup"><span data-stu-id="d4ad5-188">Performing this process can cause published tables to be restored to a point in time that is more recent than the point in time of other nonpublished tables that are restored from the backup.</span></span>  
  
    1.  <span data-ttu-id="d4ad5-189">Exécutez l'Agent de distribution jusqu'à ce que tous les Abonnés soient synchronisés avec les commandes non traitées dans la base de données de distribution.</span><span class="sxs-lookup"><span data-stu-id="d4ad5-189">Run the Distribution Agent until all Subscribers are synchronized with the outstanding commands in the distribution database.</span></span> <span data-ttu-id="d4ad5-190">Vérifiez que toutes les commandes sont remises aux Abonnés via l'onglet **Commandes non distribuées** du moniteur de réplication ou en interrogeant la vue [MSdistribution_status](/sql/relational-databases/system-views/msdistribution-status-transact-sql) de la base de données de distribution.</span><span class="sxs-lookup"><span data-stu-id="d4ad5-190">Verify that all commands are delivered to Subscribers by using the **Undistributed Commands** tab in Replication Monitor or by querying the [MSdistribution_status](/sql/relational-databases/system-views/msdistribution-status-transact-sql) view in the distribution database.</span></span> <span data-ttu-id="d4ad5-191">Passez à l'étape b.</span><span class="sxs-lookup"><span data-stu-id="d4ad5-191">Go to step b.</span></span>  
  
         <span data-ttu-id="d4ad5-192">Pour plus d’informations sur l’exécution de l’Agent de distribution, consultez [Démarrer et arrêter un Agent de réplication &#40;SQL Server Management Studio&#41;](../agents/start-and-stop-a-replication-agent-sql-server-management-studio.md) ou [Concepts des exécutables de l’Agent de réplication](../concepts/replication-agent-executables-concepts.md).</span><span class="sxs-lookup"><span data-stu-id="d4ad5-192">For more information about how to run the Distribution Agent, see [Start and Stop a Replication Agent &#40;SQL Server Management Studio&#41;](../agents/start-and-stop-a-replication-agent-sql-server-management-studio.md) and [Replication Agent Executables Concepts](../concepts/replication-agent-executables-concepts.md).</span></span>  
  
         <span data-ttu-id="d4ad5-193">Pour plus d’informations sur la vérification des commandes, consultez [afficher les commandes répliquées et d’autres informations dans la base de données de Distribution &#40;la programmation Transact-SQL de la réplication&#41;](../monitor/view-replicated-commands-and-information-in-distribution-database.md) et [afficher des informations et effectuer des tâches à l’aide du moniteur de réplication](../monitor/view-information-and-perform-tasks-replication-monitor.md).</span><span class="sxs-lookup"><span data-stu-id="d4ad5-193">For more information about how to verify commands, see [View Replicated Commands and Other Information in the Distribution Database &#40;Replication Transact-SQL Programming&#41;](../monitor/view-replicated-commands-and-information-in-distribution-database.md) and [View Information and Perform Tasks using Replication Monitor](../monitor/view-information-and-perform-tasks-replication-monitor.md).</span></span>  
  
    2.  <span data-ttu-id="d4ad5-194">Utilisez l' [utilitaire tablediff](../../../tools/tablediff-utility.md) ou un autre outil pour synchroniser manuellement le serveur de publication avec l'Abonné.</span><span class="sxs-lookup"><span data-stu-id="d4ad5-194">Use the [tablediff utility](../../../tools/tablediff-utility.md) or another tool to manually synchronize the Publisher with the Subscriber.</span></span> <span data-ttu-id="d4ad5-195">Cela vous permet de récupérer les données de la base de données d'abonnement qui ne se trouvaient pas dans la sauvegarde de la base de données de publication.</span><span class="sxs-lookup"><span data-stu-id="d4ad5-195">This enables you to recover data from the subscription database that was not contained in the publication database backup.</span></span> <span data-ttu-id="d4ad5-196">Passez à l'étape c.</span><span class="sxs-lookup"><span data-stu-id="d4ad5-196">Go to step c.</span></span>  
  
         <span data-ttu-id="d4ad5-197">Pour plus d’informations sur l’utilitaire **tablediff**, consultez [Comparer des tables répliquées pour identifier les différences &#40;programmation de réplication&#41;](compare-replicated-tables-for-differences-replication-programming.md).</span><span class="sxs-lookup"><span data-stu-id="d4ad5-197">For more information about the **tablediff** utility, see [Compare Replicated Tables for Differences &#40;Replication Programming&#41;](compare-replicated-tables-for-differences-replication-programming.md).</span></span>  
  
    3.  <span data-ttu-id="d4ad5-198">La sauvegarde restaurée est-elle complète et à jour ?</span><span class="sxs-lookup"><span data-stu-id="d4ad5-198">Is the restored backup complete and up-to-date?</span></span> <span data-ttu-id="d4ad5-199">Si elle contient la configuration la plus récente de tous les abonnements et publications,</span><span class="sxs-lookup"><span data-stu-id="d4ad5-199">Does it contain the latest configuration for all publications and subscriptions?</span></span> <span data-ttu-id="d4ad5-200">exécutez la procédure stockée [sp_replrestart](/sql/relational-databases/system-stored-procedures/sp-replrestart-transact-sql) pour resynchroniser les métadonnées du serveur de publication avec celles du serveur de distribution.</span><span class="sxs-lookup"><span data-stu-id="d4ad5-200">If yes, execute the [sp_replrestart](/sql/relational-databases/system-stored-procedures/sp-replrestart-transact-sql) stored procedure to resynchronize the Publisher metadata with the Distributor metadata.</span></span> <span data-ttu-id="d4ad5-201">La restauration est terminée.</span><span class="sxs-lookup"><span data-stu-id="d4ad5-201">The restore is completed.</span></span> <span data-ttu-id="d4ad5-202">Sinon, passez à l'étape d.</span><span class="sxs-lookup"><span data-stu-id="d4ad5-202">If no, go to step d.</span></span>  
  
    4.  <span data-ttu-id="d4ad5-203">Supprimez la configuration de la réplication sur le serveur de publication, le serveur de distribution et les Abonnés, puis recréez la configuration.</span><span class="sxs-lookup"><span data-stu-id="d4ad5-203">Remove the replication configuration from the Publisher, Distributor and Subscribers, and then re-create the configuration.</span></span> <span data-ttu-id="d4ad5-204">Lorsque vous recréez les abonnements, spécifiez que l'Abonné possède déjà les données.</span><span class="sxs-lookup"><span data-stu-id="d4ad5-204">When you re-create subscriptions, specify that the Subscriber already has the data.</span></span> <span data-ttu-id="d4ad5-205">La restauration est terminée.</span><span class="sxs-lookup"><span data-stu-id="d4ad5-205">The restore is completed.</span></span>  
  
         <span data-ttu-id="d4ad5-206">Pour plus d’informations sur la suppression de la réplication, consultez [sp_removedbreplication &#40;Transact-SQL&#41;](/sql/relational-databases/system-stored-procedures/sp-removedbreplication-transact-sql).</span><span class="sxs-lookup"><span data-stu-id="d4ad5-206">For more information about how to remove replication, see [sp_removedbreplication &#40;Transact-SQL&#41;](/sql/relational-databases/system-stored-procedures/sp-removedbreplication-transact-sql).</span></span>  
  
         <span data-ttu-id="d4ad5-207">Pour plus d'informations sur la manière de spécifier que l'Abonné possède déjà les données, consultez [Initialize a Subscription Manually](../initialize-a-subscription-manually.md).</span><span class="sxs-lookup"><span data-stu-id="d4ad5-207">For more information about how to specify that the Subscriber already has the data, see [Initialize a Subscription Manually](../initialize-a-subscription-manually.md).</span></span>  
  
#### <a name="publication-database-transactional-replication-with-updating-subscriptions"></a><span data-ttu-id="d4ad5-208">Base de données de publication : réplication transactionnelle avec des abonnements mis à jour</span><span class="sxs-lookup"><span data-stu-id="d4ad5-208">Publication Database: Transactional Replication with Updating Subscriptions</span></span>  
  
1.  <span data-ttu-id="d4ad5-209">Restaurez la dernière sauvegarde de la base de données de publication.</span><span class="sxs-lookup"><span data-stu-id="d4ad5-209">Restore the latest backup of the publication database.</span></span> <span data-ttu-id="d4ad5-210">Passez à l’étape 2.</span><span class="sxs-lookup"><span data-stu-id="d4ad5-210">Go to step 2.</span></span>  
  
2.  <span data-ttu-id="d4ad5-211">Exécutez l'Agent de distribution jusqu'à ce que tous les Abonnés soient synchronisés avec les commandes non traitées dans la base de données de distribution.</span><span class="sxs-lookup"><span data-stu-id="d4ad5-211">Run the Distribution Agent until all Subscribers are synchronized with the outstanding commands in the distribution database.</span></span> <span data-ttu-id="d4ad5-212">Vérifiez que toutes les commandes sont remises aux Abonnés via l'onglet **Commandes non distribuées** du moniteur de réplication ou en interrogeant la vue [MSdistribution_status](/sql/relational-databases/system-views/msdistribution-status-transact-sql) de la base de données de distribution.</span><span class="sxs-lookup"><span data-stu-id="d4ad5-212">Verify that all commands are delivered to Subscribers by using the **Undistributed Commands** tab in Replication Monitor, or by querying the [MSdistribution_status](/sql/relational-databases/system-views/msdistribution-status-transact-sql) view in the distribution database.</span></span> <span data-ttu-id="d4ad5-213">Passez à l’étape 3.</span><span class="sxs-lookup"><span data-stu-id="d4ad5-213">Go to step 3.</span></span>  
  
     <span data-ttu-id="d4ad5-214">Pour plus d’informations sur l’exécution de l’Agent de distribution, consultez [Démarrer et arrêter un Agent de réplication &#40;SQL Server Management Studio&#41;](../agents/start-and-stop-a-replication-agent-sql-server-management-studio.md) ou [Concepts des exécutables de l’Agent de réplication](../concepts/replication-agent-executables-concepts.md).</span><span class="sxs-lookup"><span data-stu-id="d4ad5-214">For more information about how to run the Distribution Agent, see [Start and Stop a Replication Agent &#40;SQL Server Management Studio&#41;](../agents/start-and-stop-a-replication-agent-sql-server-management-studio.md) and [Replication Agent Executables Concepts](../concepts/replication-agent-executables-concepts.md).</span></span>  
  
     <span data-ttu-id="d4ad5-215">Pour plus d’informations sur la vérification des commandes, consultez [afficher les commandes répliquées et d’autres informations dans la base de données de Distribution &#40;la programmation Transact-SQL de la réplication&#41;](../monitor/view-replicated-commands-and-information-in-distribution-database.md) et [afficher des informations et effectuer des tâches à l’aide du moniteur de réplication](../monitor/view-information-and-perform-tasks-replication-monitor.md).</span><span class="sxs-lookup"><span data-stu-id="d4ad5-215">For more information about how to verify commands, see [View Replicated Commands and Other Information in the Distribution Database &#40;Replication Transact-SQL Programming&#41;](../monitor/view-replicated-commands-and-information-in-distribution-database.md) and [View Information and Perform Tasks using Replication Monitor](../monitor/view-information-and-perform-tasks-replication-monitor.md).</span></span>  
  
3.  <span data-ttu-id="d4ad5-216">Si vous utilisez les abonnements mis à jour en attente, connectez-vous à chaque Abonné et supprimez toutes les lignes de la table [MSreplication_queue &#40;Transact-SQL&#41;](/sql/relational-databases/system-tables/msreplication-queue-transact-sql) dans la base de données d’abonnement.</span><span class="sxs-lookup"><span data-stu-id="d4ad5-216">If you are using queued updating subscriptions, connect to each Subscriber and delete all rows from the [MSreplication_queue &#40;Transact-SQL&#41;](/sql/relational-databases/system-tables/msreplication-queue-transact-sql) table in the subscription database.</span></span> <span data-ttu-id="d4ad5-217">Passez à l’étape 4.</span><span class="sxs-lookup"><span data-stu-id="d4ad5-217">Go to step 4.</span></span>  
  
    > [!NOTE]  
    >  <span data-ttu-id="d4ad5-218">Si vous utilisez des abonnements mis à jour en attente et qu'une table quelconque contient des colonnes d'identité, vous devez vérifier que les plages d'identité correctes sont affectées après une restauration.</span><span class="sxs-lookup"><span data-stu-id="d4ad5-218">If you are using queued updating subscriptions and any tables contain identity columns, you must make sure that the correct identity ranges are assigned after a restore.</span></span> <span data-ttu-id="d4ad5-219">Pour plus d’informations, consultez [ Répliquer des colonnes d’identité](../publish/replicate-identity-columns.md).</span><span class="sxs-lookup"><span data-stu-id="d4ad5-219">For more information, see [Replicate Identity Columns](../publish/replicate-identity-columns.md).</span></span>  
  
4.  <span data-ttu-id="d4ad5-220">Vous devez maintenant vous assurer que les Abonnés possèdent toutes les commandes non traitées de la base de données de distribution, puis appliquer manuellement à la base de données de publication les transactions qui ne sont pas incluses dans la sauvegarde restaurée.</span><span class="sxs-lookup"><span data-stu-id="d4ad5-220">You must now make sure that Subscribers have all outstanding commands in the distribution database, and then manually apply to the publication database any transactions that are not included in the restored backup.</span></span>  
  
    > [!IMPORTANT]  
    >  <span data-ttu-id="d4ad5-221">L'exécution de cette procédure peut se traduire par une restauration des tables publiées à un point dans le temps plus récent que celui des autres tables non publiées restaurées à partir de la sauvegarde.</span><span class="sxs-lookup"><span data-stu-id="d4ad5-221">Performing this process can cause published tables to be restored to a point in time that is more recent than the point in time of other nonpublished tables that are restored from the backup.</span></span>  
  
    1.  <span data-ttu-id="d4ad5-222">Exécutez l'Agent de distribution jusqu'à ce que tous les Abonnés soient synchronisés avec les commandes non traitées dans la base de données de distribution.</span><span class="sxs-lookup"><span data-stu-id="d4ad5-222">Run the Distribution Agent until all Subscribers are synchronized with the outstanding commands in the distribution database.</span></span> <span data-ttu-id="d4ad5-223">Vérifiez que toutes les commandes sont remises aux Abonnés à l'aide du moniteur de réplication ou en interrogeant la vue [MSdistribution_status](/sql/relational-databases/system-views/msdistribution-status-transact-sql) dans la base de données de distribution.</span><span class="sxs-lookup"><span data-stu-id="d4ad5-223">Verify that all commands are delivered to Subscribers by using Replication Monitor or by querying the [MSdistribution_status](/sql/relational-databases/system-views/msdistribution-status-transact-sql) view in the distribution database.</span></span> <span data-ttu-id="d4ad5-224">Passez à l'étape b.</span><span class="sxs-lookup"><span data-stu-id="d4ad5-224">Go to step b.</span></span>  
  
    2.  <span data-ttu-id="d4ad5-225">Utilisez l' [tablediff Utility](../../../tools/tablediff-utility.md) ou un autre outil pour synchroniser manuellement le serveur de publication avec l'Abonné.</span><span class="sxs-lookup"><span data-stu-id="d4ad5-225">Use the [tablediff Utility](../../../tools/tablediff-utility.md) or another tool to manually synchronize the Publisher with the Subscriber.</span></span> <span data-ttu-id="d4ad5-226">Cela vous permet de récupérer les données de la base de données d'abonnement qui ne se trouvaient pas dans la sauvegarde de la base de données de publication.</span><span class="sxs-lookup"><span data-stu-id="d4ad5-226">This enables you to recover data from the subscription database that was not contained in the publication database backup.</span></span> <span data-ttu-id="d4ad5-227">Passez à l'étape c.</span><span class="sxs-lookup"><span data-stu-id="d4ad5-227">Go to step c.</span></span>  
  
         <span data-ttu-id="d4ad5-228">Pour plus d’informations sur l’utilitaire **tablediff**, consultez [Comparer des tables répliquées pour identifier les différences &#40;programmation de réplication&#41;](compare-replicated-tables-for-differences-replication-programming.md).</span><span class="sxs-lookup"><span data-stu-id="d4ad5-228">For more information about the **tablediff** utility, see [Compare Replicated Tables for Differences &#40;Replication Programming&#41;](compare-replicated-tables-for-differences-replication-programming.md).</span></span>  
  
    3.  <span data-ttu-id="d4ad5-229">La sauvegarde restaurée est-elle complète et à jour ?</span><span class="sxs-lookup"><span data-stu-id="d4ad5-229">Is the restored backup complete and up-to-date?</span></span> <span data-ttu-id="d4ad5-230">Si elle contient la configuration la plus récente de tous les abonnements et publications,</span><span class="sxs-lookup"><span data-stu-id="d4ad5-230">Does it contain the latest configuration for all publications and subscriptions?</span></span> <span data-ttu-id="d4ad5-231">exécutez la procédure stockée [sp_replrestart](/sql/relational-databases/system-stored-procedures/sp-replrestart-transact-sql) pour resynchroniser les métadonnées du serveur de publication avec celles du serveur de distribution.</span><span class="sxs-lookup"><span data-stu-id="d4ad5-231">If yes, execute the [sp_replrestart](/sql/relational-databases/system-stored-procedures/sp-replrestart-transact-sql) stored procedure to resynchronize the Publisher metadata with the Distributor metadata.</span></span> <span data-ttu-id="d4ad5-232">La restauration est terminée.</span><span class="sxs-lookup"><span data-stu-id="d4ad5-232">The restore is completed.</span></span> <span data-ttu-id="d4ad5-233">Sinon, passez à l'étape d.</span><span class="sxs-lookup"><span data-stu-id="d4ad5-233">If no, go to step d.</span></span>  
  
    4.  <span data-ttu-id="d4ad5-234">Supprimez la configuration de la réplication sur le serveur de publication, le serveur de distribution et les Abonnés, puis recréez la configuration.</span><span class="sxs-lookup"><span data-stu-id="d4ad5-234">Remove the replication configuration from the Publisher, Distributor and Subscribers, and then re-create the configuration.</span></span> <span data-ttu-id="d4ad5-235">Lorsque vous recréez les abonnements, spécifiez que l'Abonné possède déjà les données.</span><span class="sxs-lookup"><span data-stu-id="d4ad5-235">When you re-create subscriptions, specify that the Subscriber already has the data.</span></span> <span data-ttu-id="d4ad5-236">La restauration est terminée.</span><span class="sxs-lookup"><span data-stu-id="d4ad5-236">The restore is completed.</span></span>  
  
         <span data-ttu-id="d4ad5-237">Pour plus d’informations sur la suppression de la réplication, consultez [sp_removedbreplication &#40;Transact-SQL&#41;](/sql/relational-databases/system-stored-procedures/sp-removedbreplication-transact-sql).</span><span class="sxs-lookup"><span data-stu-id="d4ad5-237">For more information about how to remove replication, see and [sp_removedbreplication &#40;Transact-SQL&#41;](/sql/relational-databases/system-stored-procedures/sp-removedbreplication-transact-sql).</span></span>  
  
         <span data-ttu-id="d4ad5-238">Pour plus d'informations sur la manière de spécifier que l'Abonné possède déjà les données, consultez [Initialize a Subscription Manually](../initialize-a-subscription-manually.md).</span><span class="sxs-lookup"><span data-stu-id="d4ad5-238">For more information about how to specify that the Subscriber already has the data, see [Initialize a Subscription Manually](../initialize-a-subscription-manually.md).</span></span>  
  
#### <a name="publication-database-peer-to-peer-transactional-replication"></a><span data-ttu-id="d4ad5-239">Base de données de publication : Peer-to-Peer Transactional Replication</span><span class="sxs-lookup"><span data-stu-id="d4ad5-239">Publication Database: Peer-to-Peer Transactional Replication</span></span>  
 <span data-ttu-id="d4ad5-240">Dans les étapes suivantes, les bases de données de publication **A**, **B**et **C** font partie d'une topologie de réplication transactionnelle d'égal à égal.</span><span class="sxs-lookup"><span data-stu-id="d4ad5-240">In the following steps, publication databases **A**, **B**, and **C** are in a peer-to-peer transactional replication topology.</span></span> <span data-ttu-id="d4ad5-241">Les bases de données **A** et **C** sont en ligne et fonctionnent correctement tandis que la base de données **B** doit être restaurée.</span><span class="sxs-lookup"><span data-stu-id="d4ad5-241">Databases **A** and **C** are online and functioning properly; database **B** is the database to be restored.</span></span> <span data-ttu-id="d4ad5-242">Le processus décrit ici, surtout les étapes 7, 10 et 11, est très similaire à celui requis pour ajouter un nœud à une topologie d'égal à égal.</span><span class="sxs-lookup"><span data-stu-id="d4ad5-242">The process described here, especially steps 7, 10, and 11, is very similar to the process required to add a node to a peer-to-peer topology.</span></span> <span data-ttu-id="d4ad5-243">Le moyen le plus simple pour effectuer ces étapes consiste à utiliser l'Assistant Configurer la topologie d'égal à égal. Toutefois, vous pouvez également utiliser des procédures stockées.</span><span class="sxs-lookup"><span data-stu-id="d4ad5-243">The most straightforward way to perform these steps is to use the Configure Peer-to-Peer Topology Wizard, but you can also use stored procedures.</span></span>  
  
1.  <span data-ttu-id="d4ad5-244">Exécutez les Agents de distribution pour synchroniser les abonnements sur les bases de données **A** et **C**. Passez à l’étape 2.</span><span class="sxs-lookup"><span data-stu-id="d4ad5-244">Run the Distribution Agents to synchronize the subscriptions at databases **A** and **C**. Go to step 2.</span></span>  
  
     <span data-ttu-id="d4ad5-245">Pour plus d’informations sur l’exécution de l’Agent de distribution, consultez [Démarrer et arrêter un Agent de réplication &#40;SQL Server Management Studio&#41;](../agents/start-and-stop-a-replication-agent-sql-server-management-studio.md) ou [Concepts des exécutables de l’Agent de réplication](../concepts/replication-agent-executables-concepts.md).</span><span class="sxs-lookup"><span data-stu-id="d4ad5-245">For more information about how to run the Distribution Agent, see [Start and Stop a Replication Agent &#40;SQL Server Management Studio&#41;](../agents/start-and-stop-a-replication-agent-sql-server-management-studio.md) and [Replication Agent Executables Concepts](../concepts/replication-agent-executables-concepts.md).</span></span>  
  
2.  <span data-ttu-id="d4ad5-246">Si la base de données de distribution utilisée par **B** est toujours accessible, exécutez les Agents de distribution pour synchroniser les abonnements entre les bases de données **B** et **A** et les bases de données B et **C**. Passez à l’étape 3.</span><span class="sxs-lookup"><span data-stu-id="d4ad5-246">If the distribution database that **B** uses is still available, run Distribution Agents to synchronize subscriptions between databases **B** and **A** and databases and B and **C**. Go to step 3.</span></span>  
  
3.  <span data-ttu-id="d4ad5-247">Supprimez les métadonnées de la base de données de distribution utilisée par **B** en exécutant [sp_removedistpublisherdbreplication](/sql/relational-databases/system-stored-procedures/sp-removedistpublisherdbreplication-transact-sql) sur la base de données de distribution de **B**. Passez à l’étape 4.</span><span class="sxs-lookup"><span data-stu-id="d4ad5-247">Remove metadata from the distribution database that **B** uses by executing [sp_removedistpublisherdbreplication](/sql/relational-databases/system-stored-procedures/sp-removedistpublisherdbreplication-transact-sql) at the distribution database for **B**. Go to step 4.</span></span>  
  
4.  <span data-ttu-id="d4ad5-248">Dans les bases de données **A** et **C**, supprimez les abonnements à la publication hébergée dans la base de données **B**. Passez à l’étape 5.</span><span class="sxs-lookup"><span data-stu-id="d4ad5-248">At databases **A** and **C**, drop the subscriptions to the publication at database **B**. Go to step 5.</span></span>  
  
     <span data-ttu-id="d4ad5-249">Pour plus d'informations sur la suppression des abonnements, consultez [Subscribe to Publications](../subscribe-to-publications.md).</span><span class="sxs-lookup"><span data-stu-id="d4ad5-249">For more information about how to drop subscriptions, see [Subscribe to Publications](../subscribe-to-publications.md).</span></span>  
  
5.  <span data-ttu-id="d4ad5-250">Effectuez une sauvegarde de fichier journal ou une sauvegarde complète de la base de données **A**. Passez à l’étape 6.</span><span class="sxs-lookup"><span data-stu-id="d4ad5-250">Perform a log backup or full backup of database **A**. Go to step 6.</span></span>  
  
6.  <span data-ttu-id="d4ad5-251">Restaurez la sauvegarde de la base de données **A** sur la base de données **B**. La base de données **B** possède maintenant les données de la base de données **A**, mais pas la configuration de la réplication.</span><span class="sxs-lookup"><span data-stu-id="d4ad5-251">Restore the backup of database **A** at database **B**. Database **B** now has the data from database **A**, but not the replication configuration.</span></span> <span data-ttu-id="d4ad5-252">Lorsque vous restaurez une sauvegarde sur un autre serveur, la réplication est supprimée. La réplication a donc été supprimée de la base de données **B**. Passez à l’étape 7.</span><span class="sxs-lookup"><span data-stu-id="d4ad5-252">When you restore a backup to another server, replication is removed; therefore, replication has been removed from database **B**. Go to step 7.</span></span>  
  
7.  <span data-ttu-id="d4ad5-253">Recréez la publication sur la base de données **B**, puis recréez les abonnements entre les bases de données **A** et **B**. (Les abonnements qui impliquent la base de données **C** sont gérés à une étape ultérieure.)</span><span class="sxs-lookup"><span data-stu-id="d4ad5-253">Re-create the publication at database **B**, and then re-create subscriptions between databases **A** and **B**. (Subscriptions that involve database **C** are handled at a later stage.).</span></span>  
  
    1.  <span data-ttu-id="d4ad5-254">Recréez la publication sur la base de données **B**. Passez à l'étape b.</span><span class="sxs-lookup"><span data-stu-id="d4ad5-254">Re-create the publication at database **B**. Go to step b.</span></span>  
  
    2.  <span data-ttu-id="d4ad5-255">Recréez l’abonnement de la base de données **B** à la publication de la base de données **a**, en spécifiant que l’abonnement doit être initialisé avec une sauvegarde (valeur **Initialize with backup** pour le **@sync_type** paramètre de [sp_addsubscription](/sql/relational-databases/system-stored-procedures/sp-addsubscription-transact-sql)).</span><span class="sxs-lookup"><span data-stu-id="d4ad5-255">Re-create the subscription at database **B** to the publication at database **A**, specifying that the subscription should be initialized with a backup (a value of **initialize with backup** for the **@sync_type** parameter of [sp_addsubscription](/sql/relational-databases/system-stored-procedures/sp-addsubscription-transact-sql)).</span></span> <span data-ttu-id="d4ad5-256">Passez à l'étape c.</span><span class="sxs-lookup"><span data-stu-id="d4ad5-256">Go to step c.</span></span>  
  
    3.  <span data-ttu-id="d4ad5-257">Recréez l’abonnement de la base de données **a** à la publication de la base de données **B**, en spécifiant que l’abonné possède déjà les données (valeur de la **prise en charge de la réplication uniquement** pour le **@sync_type** paramètre de [sp_addsubscription](/sql/relational-databases/system-stored-procedures/sp-addsubscription-transact-sql)).</span><span class="sxs-lookup"><span data-stu-id="d4ad5-257">Re-create the subscription at database **A** to the publication at database **B**, specifying that the Subscriber already has the data (a value of **replication support only** for the **@sync_type** parameter of [sp_addsubscription](/sql/relational-databases/system-stored-procedures/sp-addsubscription-transact-sql)).</span></span> <span data-ttu-id="d4ad5-258">Passez à l’étape 8.</span><span class="sxs-lookup"><span data-stu-id="d4ad5-258">Go to step 8.</span></span>  
  
8.  <span data-ttu-id="d4ad5-259">Exécutez les Agents de distribution pour synchroniser les abonnements sur les bases de données **A** et **B**. Si les tables publiées comportent des colonnes d'identité, passez à l'étape 9.</span><span class="sxs-lookup"><span data-stu-id="d4ad5-259">Run the Distribution Agents to synchronize the subscriptions at databases **A** and **B**. If there are any identity columns in published tables, go to step 9.</span></span> <span data-ttu-id="d4ad5-260">Sinon, passez à l’étape 10.</span><span class="sxs-lookup"><span data-stu-id="d4ad5-260">If not, go to step 10.</span></span>  
  
9. <span data-ttu-id="d4ad5-261">Après la restauration, la plage d’identité assignée à chaque table de la base de données **A** est également utilisée dans la base de données **B**. Vérifiez que la base de données **B** restaurée a reçu toutes les modifications de la base de données **B** défaillante qui ont été propagées aux bases de données **A** et **C**, puis réattribuez une valeur de départ à la plage d’identité de chaque table.</span><span class="sxs-lookup"><span data-stu-id="d4ad5-261">After the restore, the identity range that you assigned for each table in database **A** would also be used in database **B**. Make sure that the restored database **B** has received all changes from the failed database **B** that were propagated to database **A** and database **C**; and then reseed the identity range for each table.</span></span>  
  
    1.  <span data-ttu-id="d4ad5-262">Exécutez [sp_requestpeerresponse](/sql/relational-databases/system-stored-procedures/sp-requestpeerresponse-transact-sql) à la base de données **B** et récupérez le paramètre de sortie **@request_id** .</span><span class="sxs-lookup"><span data-stu-id="d4ad5-262">Execute [sp_requestpeerresponse](/sql/relational-databases/system-stored-procedures/sp-requestpeerresponse-transact-sql) at database **B** and retrieve the output parameter **@request_id**.</span></span> <span data-ttu-id="d4ad5-263">Passez à l'étape b.</span><span class="sxs-lookup"><span data-stu-id="d4ad5-263">Go to step b.</span></span>  
  
    2.  <span data-ttu-id="d4ad5-264">Par défaut, l'Agent de distribution est configuré pour s'exécuter en continu ; par conséquent, les jetons doivent être envoyés automatiquement à tous les nœuds.</span><span class="sxs-lookup"><span data-stu-id="d4ad5-264">By default, the Distribution Agent is set to run continuously; therefore, tokens should be sent to all nodes automatically.</span></span> <span data-ttu-id="d4ad5-265">Si l'Agent de distribution ne s'exécute pas en mode continu, exécutez l'Agent.</span><span class="sxs-lookup"><span data-stu-id="d4ad5-265">If the Distribution Agent is not running in continuous mode, run the agent.</span></span> <span data-ttu-id="d4ad5-266">Pour plus d’informations, consultez [Concepts des exécutables de l’agent de réplication](../concepts/replication-agent-executables-concepts.md) ou [Démarrer et arrêter un Agent de réplication &#40;SQL Server Management Studio&#41;](../agents/start-and-stop-a-replication-agent-sql-server-management-studio.md).</span><span class="sxs-lookup"><span data-stu-id="d4ad5-266">For more information, see [Replication Agent Executables Concepts](../concepts/replication-agent-executables-concepts.md) or [Start and Stop a Replication Agent &#40;SQL Server Management Studio&#41;](../agents/start-and-stop-a-replication-agent-sql-server-management-studio.md).</span></span> <span data-ttu-id="d4ad5-267">Passez à l'étape c.</span><span class="sxs-lookup"><span data-stu-id="d4ad5-267">Go to step c.</span></span>  
  
    3.  <span data-ttu-id="d4ad5-268">Exécutez [sp_helppeerresponses](/sql/relational-databases/system-stored-procedures/sp-helppeerresponses-transact-sql), en fournissant la **@request_id** valeur récupérée à l’étape b.</span><span class="sxs-lookup"><span data-stu-id="d4ad5-268">Execute [sp_helppeerresponses](/sql/relational-databases/system-stored-procedures/sp-helppeerresponses-transact-sql), providing the **@request_id** value retrieved in step b.</span></span> <span data-ttu-id="d4ad5-269">Attendez que tous les nœuds indiquent qu'ils ont reçu la demande de l'homologue.</span><span class="sxs-lookup"><span data-stu-id="d4ad5-269">Wait until all nodes indicate they have received the peer request.</span></span> <span data-ttu-id="d4ad5-270">Passez à l'étape d.</span><span class="sxs-lookup"><span data-stu-id="d4ad5-270">Go to step d.</span></span>  
  
    4.  <span data-ttu-id="d4ad5-271">Utilisez [DBCC CHECKIDENT](/sql/t-sql/database-console-commands/dbcc-checkident-transact-sql) pour réattribuer une valeur de départ à chaque table de la base de données **B** et vérifier qu'une plage appropriée est utilisée.</span><span class="sxs-lookup"><span data-stu-id="d4ad5-271">Use [DBCC CHECKIDENT](/sql/t-sql/database-console-commands/dbcc-checkident-transact-sql) to reseed each table in database **B** to make sure that an appropriate range is used.</span></span> <span data-ttu-id="d4ad5-272">Passez à l'étape 10.</span><span class="sxs-lookup"><span data-stu-id="d4ad5-272">Go to step 10.</span></span>  
  
     <span data-ttu-id="d4ad5-273">Pour plus d’informations sur la gestion des plages d’identité, consultez la section « Attribution de plages pour la gestion manuelle des plages d’identité » dans [Réplication de colonnes d’identité](../publish/replicate-identity-columns.md).</span><span class="sxs-lookup"><span data-stu-id="d4ad5-273">For more information about how to manage identity ranges, see the "Assigning ranges for manual identity range management" section of [Replicate Identity Columns](../publish/replicate-identity-columns.md).</span></span>  
  
10. <span data-ttu-id="d4ad5-274">À ce stade, les bases de données **B** et **C** ne sont pas directement connectées, mais elles reçoivent les modifications via la base de données **A**. Si la topologie contient des nœuds qui exécutent [!INCLUDE[ssVersion2005](../../../includes/ssversion2005-md.md)], passez à l'étape 11 ; sinon, passez à l'étape 12.</span><span class="sxs-lookup"><span data-stu-id="d4ad5-274">At this point, database **B** and database **C** are not directly connected, but they will receive changes through database **A**. If the topology contains any nodes that are running [!INCLUDE[ssVersion2005](../../../includes/ssversion2005-md.md)], go to step 11; otherwise, go to step 12.</span></span>  
  
11. <span data-ttu-id="d4ad5-275">Suspendez le système, puis recréez l’abonnement entre les bases de données **B** et **C**. Suspendre un système implique d’interrompre toute activité sur les tables publiées de tous les nœuds et de vérifier que chaque nœud a reçu toutes les modifications des autres nœuds.</span><span class="sxs-lookup"><span data-stu-id="d4ad5-275">Quiesce the system, and then re-create the subscription between databases **B** and **C**. Quiescing a system involves stopping activity on published tables at all nodes and making sure of that each node has received all changes from all other nodes.</span></span>  
  
    1.  <span data-ttu-id="d4ad5-276">Arrêtez toute activité sur les tables publiées dans la topologie d'égal à égal.</span><span class="sxs-lookup"><span data-stu-id="d4ad5-276">Stop all activity on published tables in the peer-to-peer topology.</span></span> <span data-ttu-id="d4ad5-277">Passez à l'étape b.</span><span class="sxs-lookup"><span data-stu-id="d4ad5-277">Go to step b.</span></span>  
  
    2.  <span data-ttu-id="d4ad5-278">Exécutez [sp_requestpeerresponse](/sql/relational-databases/system-stored-procedures/sp-requestpeerresponse-transact-sql) à la base de données **B** et récupérez le paramètre de sortie **@request_id** .</span><span class="sxs-lookup"><span data-stu-id="d4ad5-278">Execute [sp_requestpeerresponse](/sql/relational-databases/system-stored-procedures/sp-requestpeerresponse-transact-sql) at database **B** and retrieve the output parameter **@request_id**.</span></span> <span data-ttu-id="d4ad5-279">Passez à l'étape c.</span><span class="sxs-lookup"><span data-stu-id="d4ad5-279">Go to step c.</span></span>  
  
    3.  <span data-ttu-id="d4ad5-280">Par défaut, l'Agent de distribution est configuré pour s'exécuter en continu ; par conséquent, les jetons doivent être envoyés automatiquement à tous les nœuds.</span><span class="sxs-lookup"><span data-stu-id="d4ad5-280">By default, the Distribution Agent is set to run continuously; therefore, tokens should be sent to all nodes automatically.</span></span> <span data-ttu-id="d4ad5-281">Si l'Agent de distribution ne s'exécute pas en mode continu, exécutez l'Agent.</span><span class="sxs-lookup"><span data-stu-id="d4ad5-281">If the Distribution Agent is not running in continuous mode, run the agent.</span></span> <span data-ttu-id="d4ad5-282">Passez à l'étape d.</span><span class="sxs-lookup"><span data-stu-id="d4ad5-282">Go to step d.</span></span>  
  
    4.  <span data-ttu-id="d4ad5-283">Exécutez [sp_helppeerresponses](/sql/relational-databases/system-stored-procedures/sp-helppeerresponses-transact-sql), en fournissant la **@request_id** valeur récupérée à l’étape b.</span><span class="sxs-lookup"><span data-stu-id="d4ad5-283">Execute [sp_helppeerresponses](/sql/relational-databases/system-stored-procedures/sp-helppeerresponses-transact-sql), providing the **@request_id** value retrieved in step b.</span></span> <span data-ttu-id="d4ad5-284">Attendez que tous les nœuds indiquent qu'ils ont reçu la demande de l'homologue.</span><span class="sxs-lookup"><span data-stu-id="d4ad5-284">Wait until all nodes indicate they have received the peer request.</span></span> <span data-ttu-id="d4ad5-285">Passez à l'étape e.</span><span class="sxs-lookup"><span data-stu-id="d4ad5-285">Go to step e.</span></span>  
  
    5.  <span data-ttu-id="d4ad5-286">Recréez l'abonnement de la base de données **B** à la publication de la base de données **C**, en spécifiant que l'Abonné possède déjà les données.</span><span class="sxs-lookup"><span data-stu-id="d4ad5-286">Re-create the subscription at database **B** to the publication at database **C**, specifying that the Subscriber already has the data.</span></span> <span data-ttu-id="d4ad5-287">Passez à l'étape b.</span><span class="sxs-lookup"><span data-stu-id="d4ad5-287">Go to step b.</span></span>  
  
    6.  <span data-ttu-id="d4ad5-288">Recréez l'abonnement de la base de données **C** à la publication de la base de données **B**, en spécifiant que l'Abonné possède déjà les données.</span><span class="sxs-lookup"><span data-stu-id="d4ad5-288">Re-create the subscription at database **C** to the publication at database **B**, specifying that the Subscriber already has the data.</span></span> <span data-ttu-id="d4ad5-289">Passez à l’étape 13.</span><span class="sxs-lookup"><span data-stu-id="d4ad5-289">Go to step 13.</span></span>  
  
12. <span data-ttu-id="d4ad5-290">Recréez l'abonnement entre les bases de données **B** et **C**:</span><span class="sxs-lookup"><span data-stu-id="d4ad5-290">Re-create the subscription between databases **B** and **C**:</span></span>  
  
    1.  <span data-ttu-id="d4ad5-291">Sur la base de données **B**, interrogez la table [MSpeer_lsns](/sql/relational-databases/system-tables/mspeer-lsns-transact-sql) pour récupérer le numéro séquentiel dans le journal de la transaction la plus récente que la base de données **B** a reçue de la base de données **C**.</span><span class="sxs-lookup"><span data-stu-id="d4ad5-291">At database **B**, query the [MSpeer_lsns](/sql/relational-databases/system-tables/mspeer-lsns-transact-sql) table to retrieve the log sequence number (LSN) of the most recent transaction that database **B** has received from database **C**.</span></span>  
  
    2.  <span data-ttu-id="d4ad5-292">Recréez l’abonnement de la base de données **B** à la publication de la base de données **C**, en spécifiant que l’abonnement doit être initialisé en fonction du LSN (valeur **Initialize from lsn** pour le **@sync_type** paramètre de [sp_addsubscription](/sql/relational-databases/system-stored-procedures/sp-addsubscription-transact-sql)).</span><span class="sxs-lookup"><span data-stu-id="d4ad5-292">Re-create the subscription at database **B** to the publication at database **C**, specifying that the subscription should be initialized based on LSN (a value of **initialize from lsn** for the **@sync_type** parameter of [sp_addsubscription](/sql/relational-databases/system-stored-procedures/sp-addsubscription-transact-sql)).</span></span> <span data-ttu-id="d4ad5-293">Passez à l'étape b.</span><span class="sxs-lookup"><span data-stu-id="d4ad5-293">Go to step b.</span></span>  
  
    3.  <span data-ttu-id="d4ad5-294">Recréez l'abonnement de la base de données **C** à la publication de la base de données **B**, en spécifiant que l'Abonné possède déjà les données.</span><span class="sxs-lookup"><span data-stu-id="d4ad5-294">Re-create the subscription at database **C** to the publication at database **B**, specifying that the Subscriber already has the data.</span></span> <span data-ttu-id="d4ad5-295">Passez à l’étape 13.</span><span class="sxs-lookup"><span data-stu-id="d4ad5-295">Go to step 13.</span></span>  
  
13. <span data-ttu-id="d4ad5-296">Exécutez les Agents de distribution pour synchroniser les abonnements sur les bases de données **B** et **C**. La restauration est terminée.</span><span class="sxs-lookup"><span data-stu-id="d4ad5-296">Run the Distribution Agents to synchronize the subscriptions at databases **B** and **C**. The restore is completed.</span></span>  
  
#### <a name="msdb-database-publisher"></a><span data-ttu-id="d4ad5-297">Base de données msdb (serveur de publication)</span><span class="sxs-lookup"><span data-stu-id="d4ad5-297">msdb Database (Publisher)</span></span>  
  
1.  <span data-ttu-id="d4ad5-298">Restaurez la dernière sauvegarde de la base de données **msdb** .</span><span class="sxs-lookup"><span data-stu-id="d4ad5-298">Restore the latest backup of the **msdb** database.</span></span>  
  
2.  <span data-ttu-id="d4ad5-299">La sauvegarde restaurée est-elle complète et à jour ?</span><span class="sxs-lookup"><span data-stu-id="d4ad5-299">Is the restored backup complete and up-to-date?</span></span> <span data-ttu-id="d4ad5-300">Si elle contient la configuration la plus récente de tous les abonnements et publications,</span><span class="sxs-lookup"><span data-stu-id="d4ad5-300">Does it contain the latest configuration for all publications and subscriptions?</span></span> <span data-ttu-id="d4ad5-301">la récupération est terminée.</span><span class="sxs-lookup"><span data-stu-id="d4ad5-301">If yes, recovery is completed.</span></span> <span data-ttu-id="d4ad5-302">Sinon, passez à l'étape 3.</span><span class="sxs-lookup"><span data-stu-id="d4ad5-302">If no, go to step 3.</span></span>  
  
3.  <span data-ttu-id="d4ad5-303">Recréez le travail de nettoyage de l'abonnement à partir de vos scripts de réplication.</span><span class="sxs-lookup"><span data-stu-id="d4ad5-303">Re-create the subscription cleanup job from your replication scripts.</span></span> <span data-ttu-id="d4ad5-304">La récupération est terminée.</span><span class="sxs-lookup"><span data-stu-id="d4ad5-304">Recovery is completed.</span></span>  
  
#### <a name="master-database-publisher"></a><span data-ttu-id="d4ad5-305">Base de données master (serveur de publication)</span><span class="sxs-lookup"><span data-stu-id="d4ad5-305">master Database (Publisher)</span></span>  
  
1.  <span data-ttu-id="d4ad5-306">Restaurez la dernière sauvegarde de la base de données **master** .</span><span class="sxs-lookup"><span data-stu-id="d4ad5-306">Restore the latest backup of the **master** database.</span></span>  
  
2.  <span data-ttu-id="d4ad5-307">Vérifiez que les paramètres et la configuration de réplication de la base de données et ceux de la base de données de publication sont cohérents.</span><span class="sxs-lookup"><span data-stu-id="d4ad5-307">Make sure that the database is consistent with the publication database with regard to replication configuration and settings.</span></span>  
  
### <a name="databases-at-the-distributor"></a><span data-ttu-id="d4ad5-308">Bases de données du serveur de distribution</span><span class="sxs-lookup"><span data-stu-id="d4ad5-308">Databases at the Distributor</span></span>  
  
#### <a name="distribution-database"></a><span data-ttu-id="d4ad5-309">Base de données de distribution</span><span class="sxs-lookup"><span data-stu-id="d4ad5-309">Distribution Database</span></span>  
  
1.  <span data-ttu-id="d4ad5-310">Restaurez la dernière sauvegarde de la base de données de distribution.</span><span class="sxs-lookup"><span data-stu-id="d4ad5-310">Restore the latest backup of the distribution database.</span></span>  
  
2.  <span data-ttu-id="d4ad5-311">Si l'option **sync with backup** a été activée sur la base de données de distribution avant la défaillance,</span><span class="sxs-lookup"><span data-stu-id="d4ad5-311">Was the **sync with backup** setting enabled on the distribution database before the failure?</span></span> <span data-ttu-id="d4ad5-312">passez à l'étape 3 ; sinon passez à l'étape 4.</span><span class="sxs-lookup"><span data-stu-id="d4ad5-312">If yes, go to step 3; if no, go to step 4.</span></span>  
  
     <span data-ttu-id="d4ad5-313">Si l'option est activée, la requête `SELECT DATABASEPROPERTYEX('<DistributionDatabaseName>', 'IsSyncWithBackup')` retourne la valeur 1.</span><span class="sxs-lookup"><span data-stu-id="d4ad5-313">If the setting is enabled, the query `SELECT DATABASEPROPERTYEX('<DistributionDatabaseName>', 'IsSyncWithBackup')` returns '1'.</span></span>  
  
3.  <span data-ttu-id="d4ad5-314">La sauvegarde restaurée est-elle complète et à jour ?</span><span class="sxs-lookup"><span data-stu-id="d4ad5-314">Is the restored backup complete and up-to-date?</span></span> <span data-ttu-id="d4ad5-315">Si elle contient la configuration la plus récente de tous les abonnements et publications,</span><span class="sxs-lookup"><span data-stu-id="d4ad5-315">Does it contain the latest configuration for all publications and subscriptions?</span></span> <span data-ttu-id="d4ad5-316">la récupération est terminée.</span><span class="sxs-lookup"><span data-stu-id="d4ad5-316">If yes, recovery is completed.</span></span> <span data-ttu-id="d4ad5-317">Sinon, passez à l’étape 4.</span><span class="sxs-lookup"><span data-stu-id="d4ad5-317">If no, go to step 4.</span></span>  
  
4.  <span data-ttu-id="d4ad5-318">Les informations de configuration dans la base de données de distribution restaurée ne sont pas à jour ou l'option **sync with backup** n'a pas été définie sur la base de données de distribution.</span><span class="sxs-lookup"><span data-stu-id="d4ad5-318">Either the configuration information in the restored distribution database is not up-to-date, or the **sync with backup** option was not set on the distribution database.</span></span> <span data-ttu-id="d4ad5-319">(Après la restauration, la base de données de distribution peut ignorer des transactions qui ont été validées sur le serveur de publication, mais qui n'ont pas encore été remises aux Abonnés.) Supprimez et recréez la réplication, puis exécutez la validation.</span><span class="sxs-lookup"><span data-stu-id="d4ad5-319">(After the restore, the distribution database might be missing transactions that were committed at the Publisher but have not yet been delivered to Subscribers.) Drop and re-create replication, and then run validation.</span></span>  
  
    1.  <span data-ttu-id="d4ad5-320">Supprimez la configuration de la réplication sur le serveur de publication, le serveur de distribution et les Abonnés, puis recréez la configuration.</span><span class="sxs-lookup"><span data-stu-id="d4ad5-320">Remove the replication configuration from the Publisher, Distributor and Subscribers, and then re-create the configuration.</span></span> <span data-ttu-id="d4ad5-321">Lorsque vous recréez les abonnements, spécifiez que l'Abonné possède déjà les données.</span><span class="sxs-lookup"><span data-stu-id="d4ad5-321">When you re-create subscriptions, specify that the Subscriber already has the data.</span></span> <span data-ttu-id="d4ad5-322">Passez à l'étape b.</span><span class="sxs-lookup"><span data-stu-id="d4ad5-322">Go to step b.</span></span>  
  
         <span data-ttu-id="d4ad5-323">Pour plus d’informations sur la suppression de la réplication, consultez [sp_removedbreplication &#40;Transact-SQL&#41;](/sql/relational-databases/system-stored-procedures/sp-removedbreplication-transact-sql).</span><span class="sxs-lookup"><span data-stu-id="d4ad5-323">For more information about how to remove replication, see [sp_removedbreplication &#40;Transact-SQL&#41;](/sql/relational-databases/system-stored-procedures/sp-removedbreplication-transact-sql).</span></span>  
  
         <span data-ttu-id="d4ad5-324">Pour plus d'informations sur la manière de spécifier que l'Abonné possède déjà les données, consultez [Initialize a Subscription Manually](../initialize-a-subscription-manually.md).</span><span class="sxs-lookup"><span data-stu-id="d4ad5-324">For more information about how to specify that the Subscriber already has the data, see [Initialize a Subscription Manually](../initialize-a-subscription-manually.md).</span></span>  
  
    2.  <span data-ttu-id="d4ad5-325">Marquez toutes les publications pour validation.</span><span class="sxs-lookup"><span data-stu-id="d4ad5-325">Mark all publications for validation.</span></span> <span data-ttu-id="d4ad5-326">Réinitialisez tous les abonnements qui n'ont pas pu être validés.</span><span class="sxs-lookup"><span data-stu-id="d4ad5-326">Reinitialize any subscriptions that fail validation.</span></span> <span data-ttu-id="d4ad5-327">La récupération est terminée.</span><span class="sxs-lookup"><span data-stu-id="d4ad5-327">Recovery is completed.</span></span>  
  
         <span data-ttu-id="d4ad5-328">Pour plus d'informations sur la validation, consultez [Validate Replicated Data](../validate-data-at-the-subscriber.md).</span><span class="sxs-lookup"><span data-stu-id="d4ad5-328">For more information about validation, see [Validate Replicated Data](../validate-data-at-the-subscriber.md).</span></span> <span data-ttu-id="d4ad5-329">Pour plus d’informations sur la réinitialisation, consultez [Réinitialiser des abonnements](../reinitialize-subscriptions.md).</span><span class="sxs-lookup"><span data-stu-id="d4ad5-329">For more information about reinitialization, see [Reinitialize Subscriptions](../reinitialize-subscriptions.md).</span></span>  
  
#### <a name="msdb-database-distributor"></a><span data-ttu-id="d4ad5-330">Base de données msdb (serveur de distribution)</span><span class="sxs-lookup"><span data-stu-id="d4ad5-330">msdb Database (Distributor)</span></span>  
  
1.  <span data-ttu-id="d4ad5-331">Restaurez la dernière sauvegarde de la base de données **msdb** .</span><span class="sxs-lookup"><span data-stu-id="d4ad5-331">Restore the latest backup of the **msdb** database.</span></span>  
  
2.  <span data-ttu-id="d4ad5-332">La sauvegarde restaurée est-elle complète et à jour ?</span><span class="sxs-lookup"><span data-stu-id="d4ad5-332">Is the restored backup complete and up-to-date?</span></span> <span data-ttu-id="d4ad5-333">Si elle contient la configuration la plus récente de tous les abonnements et publications,</span><span class="sxs-lookup"><span data-stu-id="d4ad5-333">Does it contain the latest configuration for all publications and subscriptions?</span></span> <span data-ttu-id="d4ad5-334">la récupération est terminée.</span><span class="sxs-lookup"><span data-stu-id="d4ad5-334">If yes, recovery is completed.</span></span> <span data-ttu-id="d4ad5-335">Sinon, passez à l'étape 3.</span><span class="sxs-lookup"><span data-stu-id="d4ad5-335">If no, go to step 3.</span></span>  
  
3.  <span data-ttu-id="d4ad5-336">Supprimez la configuration de la réplication sur le serveur de publication, le serveur de distribution et les Abonnés, puis recréez la configuration.</span><span class="sxs-lookup"><span data-stu-id="d4ad5-336">Remove the replication configuration from the Publisher, Distributor and Subscribers, and then re-create the configuration.</span></span> <span data-ttu-id="d4ad5-337">Lorsque vous recréez les abonnements, spécifiez que l'Abonné possède déjà les données.</span><span class="sxs-lookup"><span data-stu-id="d4ad5-337">When you re-create subscriptions, specify that the Subscriber already has the data.</span></span> <span data-ttu-id="d4ad5-338">Passez à l’étape 4.</span><span class="sxs-lookup"><span data-stu-id="d4ad5-338">Go to step 4.</span></span>  
  
     <span data-ttu-id="d4ad5-339">Pour plus d’informations sur la suppression de la réplication, consultez [sp_removedbreplication &#40;Transact-SQL&#41;](/sql/relational-databases/system-stored-procedures/sp-removedbreplication-transact-sql).</span><span class="sxs-lookup"><span data-stu-id="d4ad5-339">For more information about how to remove replication, see [sp_removedbreplication &#40;Transact-SQL&#41;](/sql/relational-databases/system-stored-procedures/sp-removedbreplication-transact-sql).</span></span>  
  
     <span data-ttu-id="d4ad5-340">Pour plus d'informations sur la manière de spécifier que l'Abonné possède déjà les données, consultez [Initialize a Subscription Manually](../initialize-a-subscription-manually.md).</span><span class="sxs-lookup"><span data-stu-id="d4ad5-340">For more information about how to specify that the Subscriber already has the data, see [Initialize a Subscription Manually](../initialize-a-subscription-manually.md).</span></span>  
  
4.  <span data-ttu-id="d4ad5-341">Marquez toutes les publications pour validation.</span><span class="sxs-lookup"><span data-stu-id="d4ad5-341">Mark all publications for validation.</span></span> <span data-ttu-id="d4ad5-342">Réinitialisez tous les abonnements qui n'ont pas pu être validés.</span><span class="sxs-lookup"><span data-stu-id="d4ad5-342">Reinitialize any subscriptions that fail validation.</span></span> <span data-ttu-id="d4ad5-343">La récupération est terminée.</span><span class="sxs-lookup"><span data-stu-id="d4ad5-343">Recovery is completed.</span></span>  
  
     <span data-ttu-id="d4ad5-344">Pour plus d'informations sur la validation, consultez [Validate Replicated Data](../validate-data-at-the-subscriber.md).</span><span class="sxs-lookup"><span data-stu-id="d4ad5-344">For more information about validation, see [Validate Replicated Data](../validate-data-at-the-subscriber.md).</span></span> <span data-ttu-id="d4ad5-345">Pour plus d’informations sur la réinitialisation, consultez [Réinitialiser des abonnements](../reinitialize-subscriptions.md).</span><span class="sxs-lookup"><span data-stu-id="d4ad5-345">For more information about reinitialization, see [Reinitialize Subscriptions](../reinitialize-subscriptions.md).</span></span>  
  
#### <a name="master-database-distributor"></a><span data-ttu-id="d4ad5-346">Base de données master (serveur de distribution)</span><span class="sxs-lookup"><span data-stu-id="d4ad5-346">master Database (Distributor)</span></span>  
  
1.  <span data-ttu-id="d4ad5-347">Restaurez la dernière sauvegarde de la base de données **master** .</span><span class="sxs-lookup"><span data-stu-id="d4ad5-347">Restore the latest backup of the **master** database.</span></span>  
  
2.  <span data-ttu-id="d4ad5-348">Vérifiez que les paramètres et la configuration de réplication de la base de données et ceux de la base de données de publication sont cohérents.</span><span class="sxs-lookup"><span data-stu-id="d4ad5-348">Make sure that the database is consistent with the publication database with regard to replication configuration and settings.</span></span>  
  
### <a name="databases-at-the-subscriber"></a><span data-ttu-id="d4ad5-349">Bases de données de l'Abonné</span><span class="sxs-lookup"><span data-stu-id="d4ad5-349">Databases at the Subscriber</span></span>  
  
#### <a name="subscription-database"></a><span data-ttu-id="d4ad5-350">Base de données d'abonnement</span><span class="sxs-lookup"><span data-stu-id="d4ad5-350">Subscription Database</span></span>  
  
1.  <span data-ttu-id="d4ad5-351">Est-ce que la dernière sauvegarde de base de données d'abonnement est plus récente que le paramètre de rétention minimal de la distribution sur la base de données de distribution ?</span><span class="sxs-lookup"><span data-stu-id="d4ad5-351">Is the latest subscription database backup more recent than the minimum distribution retention setting on the distribution database?</span></span> <span data-ttu-id="d4ad5-352">(Cela détermine si le serveur de distribution possède encore toutes les commandes requises pour mettre l'Abonné à jour.) S'il en contient, passez à l'étape 2.</span><span class="sxs-lookup"><span data-stu-id="d4ad5-352">(This determines whether the Distributor still has all the commands that are required to bring the Subscriber up-to-date.) If yes, go to step 2.</span></span> <span data-ttu-id="d4ad5-353">Si non, réinitialisez l'abonnement.</span><span class="sxs-lookup"><span data-stu-id="d4ad5-353">If no, reinitialize the subscription.</span></span> <span data-ttu-id="d4ad5-354">La récupération est terminée.</span><span class="sxs-lookup"><span data-stu-id="d4ad5-354">Recovery is completed.</span></span>  
  
     <span data-ttu-id="d4ad5-355">Pour déterminer le paramètre de rétention maximale de la distribution, exécutez [sp_helpdistributiondb](/sql/relational-databases/system-stored-procedures/sp-helpdistributiondb-transact-sql) et récupérez la valeur de la colonne **max_distretention** (exprimée en heures).</span><span class="sxs-lookup"><span data-stu-id="d4ad5-355">To determine the maximum distribution retention setting, execute [sp_helpdistributiondb](/sql/relational-databases/system-stored-procedures/sp-helpdistributiondb-transact-sql) and retrieve the value from the **max_distretention** column (this value is in hours).</span></span>  
  
     <span data-ttu-id="d4ad5-356">Pour plus d'informations sur la réinitialisation d'un abonnement, consultez [Reinitialize a Subscription](../reinitialize-a-subscription.md).</span><span class="sxs-lookup"><span data-stu-id="d4ad5-356">For more information about how to reinitialize a subscription, see [Reinitialize a Subscription](../reinitialize-a-subscription.md).</span></span>  
  
2.  <span data-ttu-id="d4ad5-357">Restaurez la dernière sauvegarde de la base de données d'abonnement.</span><span class="sxs-lookup"><span data-stu-id="d4ad5-357">Restore the latest subscription database backup.</span></span> <span data-ttu-id="d4ad5-358">Passez à l’étape 3.</span><span class="sxs-lookup"><span data-stu-id="d4ad5-358">Go to step 3.</span></span>  
  
3.  <span data-ttu-id="d4ad5-359">Si la base de données d'abonnement contient uniquement des abonnements par émission de données, allez à étape 4.</span><span class="sxs-lookup"><span data-stu-id="d4ad5-359">If the subscription database contains only push subscriptions, go to step 4.</span></span> <span data-ttu-id="d4ad5-360">Si la base de données d’abonnement contient des abonnements par extraction, posez-vous les questions suivantes : les informations d’abonnement sont-elles à jour ?</span><span class="sxs-lookup"><span data-stu-id="d4ad5-360">If the subscription database contains any pull subscriptions, ask the following questions: Is the subscription information current?</span></span> <span data-ttu-id="d4ad5-361">La base de données inclut-elle toutes les tables et options définies au moment de la défaillance ?</span><span class="sxs-lookup"><span data-stu-id="d4ad5-361">Does the database include all tables and options that were set at the time of failure.</span></span> <span data-ttu-id="d4ad5-362">Si tel est le cas, passez à l’étape 4.</span><span class="sxs-lookup"><span data-stu-id="d4ad5-362">If yes, go to step 4.</span></span> <span data-ttu-id="d4ad5-363">Si non, réinitialisez l'abonnement.</span><span class="sxs-lookup"><span data-stu-id="d4ad5-363">If no, reinitialize the subscription.</span></span> <span data-ttu-id="d4ad5-364">La récupération est terminée.</span><span class="sxs-lookup"><span data-stu-id="d4ad5-364">Recovery is completed.</span></span>  
  
4.  <span data-ttu-id="d4ad5-365">Pour synchroniser l'Abonné, exécutez l'Agent de distribution.</span><span class="sxs-lookup"><span data-stu-id="d4ad5-365">To synchronize the Subscriber, run the Distribution Agent.</span></span> <span data-ttu-id="d4ad5-366">La récupération est terminée.</span><span class="sxs-lookup"><span data-stu-id="d4ad5-366">Recovery is completed.</span></span>  
  
     <span data-ttu-id="d4ad5-367">Pour plus d’informations sur l’exécution de l’Agent de distribution, consultez [Démarrer et arrêter un Agent de réplication &#40;SQL Server Management Studio&#41;](../agents/start-and-stop-a-replication-agent-sql-server-management-studio.md) ou [Concepts des exécutables de l’Agent de réplication](../concepts/replication-agent-executables-concepts.md).</span><span class="sxs-lookup"><span data-stu-id="d4ad5-367">For more information about how to run the Distribution Agent, see [Start and Stop a Replication Agent &#40;SQL Server Management Studio&#41;](../agents/start-and-stop-a-replication-agent-sql-server-management-studio.md) and [Replication Agent Executables Concepts](../concepts/replication-agent-executables-concepts.md).</span></span>  
  
#### <a name="msdb-database-subscriber"></a><span data-ttu-id="d4ad5-368">Base de données msdb (Abonné)</span><span class="sxs-lookup"><span data-stu-id="d4ad5-368">msdb Database (Subscriber)</span></span>  
  
1.  <span data-ttu-id="d4ad5-369">Restaurez la dernière sauvegarde de la base de données **msdb** .</span><span class="sxs-lookup"><span data-stu-id="d4ad5-369">Restore the latest backup of the **msdb** database.</span></span> <span data-ttu-id="d4ad5-370">L'Abonné utilise-t-il les abonnements par extraction ?</span><span class="sxs-lookup"><span data-stu-id="d4ad5-370">Are pull subscriptions used at this Subscriber?</span></span> <span data-ttu-id="d4ad5-371">Si non, la restauration est terminée.</span><span class="sxs-lookup"><span data-stu-id="d4ad5-371">If no, the restore is completed.</span></span> <span data-ttu-id="d4ad5-372">S'il en contient, passez à l'étape 2.</span><span class="sxs-lookup"><span data-stu-id="d4ad5-372">If yes, go to step 2.</span></span>  
  
2.  <span data-ttu-id="d4ad5-373">La sauvegarde restaurée est-elle complète et à jour ?</span><span class="sxs-lookup"><span data-stu-id="d4ad5-373">Is the restored backup complete and up-to-date?</span></span> <span data-ttu-id="d4ad5-374">Si elle contient la configuration la plus récente de tous les abonnements par extraction,</span><span class="sxs-lookup"><span data-stu-id="d4ad5-374">Does it contain the latest configuration for all pull subscriptions?</span></span> <span data-ttu-id="d4ad5-375">la récupération est terminée.</span><span class="sxs-lookup"><span data-stu-id="d4ad5-375">If yes, recovery is completed.</span></span> <span data-ttu-id="d4ad5-376">Sinon, passez à l'étape 3.</span><span class="sxs-lookup"><span data-stu-id="d4ad5-376">If no, go to step 3.</span></span>  
  
3.  <span data-ttu-id="d4ad5-377">Supprimez et recréez les abonnements par extraction.</span><span class="sxs-lookup"><span data-stu-id="d4ad5-377">Drop and re-create the pull subscriptions.</span></span> <span data-ttu-id="d4ad5-378">Lorsque vous recréez les abonnements, spécifiez que l'Abonné possède déjà les données.</span><span class="sxs-lookup"><span data-stu-id="d4ad5-378">When you re-create the subscriptions, specify that the Subscriber already has the data.</span></span> <span data-ttu-id="d4ad5-379">La restauration est terminée.</span><span class="sxs-lookup"><span data-stu-id="d4ad5-379">The restore is completed.</span></span>  
  
     <span data-ttu-id="d4ad5-380">Pour plus d'informations sur la suppression des abonnements, consultez [Subscribe to Publications](../subscribe-to-publications.md).</span><span class="sxs-lookup"><span data-stu-id="d4ad5-380">For more information about how to drop subscriptions, see [Subscribe to Publications](../subscribe-to-publications.md).</span></span>  
  
     <span data-ttu-id="d4ad5-381">Pour plus d'informations sur la manière de spécifier que l'Abonné possède déjà les données, consultez [Initialize a Subscription Manually](../initialize-a-subscription-manually.md).</span><span class="sxs-lookup"><span data-stu-id="d4ad5-381">For more information about how to specify that the Subscriber already has the data, see [Initialize a Subscription Manually](../initialize-a-subscription-manually.md).</span></span>  
  
#### <a name="master-database-subscriber"></a><span data-ttu-id="d4ad5-382">Base de données master (Abonné)</span><span class="sxs-lookup"><span data-stu-id="d4ad5-382">master Database (Subscriber)</span></span>  
  
1.  <span data-ttu-id="d4ad5-383">Restaurez la dernière sauvegarde de la base de données **master** .</span><span class="sxs-lookup"><span data-stu-id="d4ad5-383">Restore the latest backup of the **master** database.</span></span>  
  
2.  <span data-ttu-id="d4ad5-384">Vérifiez que les paramètres et la configuration de réplication de la base de données et ceux de la base de données de publication sont cohérents.</span><span class="sxs-lookup"><span data-stu-id="d4ad5-384">Make sure that the database is consistent with the publication database with regard to replication configuration and settings.</span></span>  
  
## <a name="see-also"></a><span data-ttu-id="d4ad5-385">Voir aussi</span><span class="sxs-lookup"><span data-stu-id="d4ad5-385">See Also</span></span>  
 <span data-ttu-id="d4ad5-386">[Sauvegarde et restauration des bases de données SQL Server](../../backup-restore/back-up-and-restore-of-sql-server-databases.md) </span><span class="sxs-lookup"><span data-stu-id="d4ad5-386">[Back Up and Restore of SQL Server Databases](../../backup-restore/back-up-and-restore-of-sql-server-databases.md) </span></span>  
 <span data-ttu-id="d4ad5-387">[Sauvegarder et restaurer des bases de données répliquées](back-up-and-restore-replicated-databases.md) </span><span class="sxs-lookup"><span data-stu-id="d4ad5-387">[Back Up and Restore Replicated Databases](back-up-and-restore-replicated-databases.md) </span></span>  
 <span data-ttu-id="d4ad5-388">[Configurer la distribution](../configure-distribution.md) </span><span class="sxs-lookup"><span data-stu-id="d4ad5-388">[Configure Distribution](../configure-distribution.md) </span></span>  
 <span data-ttu-id="d4ad5-389">[Publier des données et des objets de base de données](../publish/publish-data-and-database-objects.md) </span><span class="sxs-lookup"><span data-stu-id="d4ad5-389">[Publish Data and Database Objects](../publish/publish-data-and-database-objects.md) </span></span>  
 <span data-ttu-id="d4ad5-390">[S’abonner aux Publications](../subscribe-to-publications.md) </span><span class="sxs-lookup"><span data-stu-id="d4ad5-390">[Subscribe to Publications](../subscribe-to-publications.md) </span></span>  
 <span data-ttu-id="d4ad5-391">[Initialiser un abonnement](../initialize-a-subscription.md) </span><span class="sxs-lookup"><span data-stu-id="d4ad5-391">[Initialize a Subscription](../initialize-a-subscription.md) </span></span>  
 [<span data-ttu-id="d4ad5-392">Synchroniser les données</span><span class="sxs-lookup"><span data-stu-id="d4ad5-392">Synchronize Data</span></span>](../synchronize-data.md)  
  
  
