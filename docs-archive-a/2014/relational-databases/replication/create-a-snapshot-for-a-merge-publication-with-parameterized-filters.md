---
title: Créer un instantané d’une publication de fusion avec des filtres paramétrés | Microsoft Docs
ms.custom: ''
ms.date: 06/30/2017
ms.prod: sql-server-2014
ms.reviewer: ''
ms.technology: replication
ms.topic: conceptual
helpviewer_keywords:
- parameterized filters [SQL Server replication], snapshots
- snapshots [SQL Server replication], parameterized filters and
- filters [SQL Server replication], parameterized
ms.assetid: 00dfb229-f1de-4d33-90b0-d7c99ab52dcb
author: MashaMSFT
ms.author: mathoma
ms.openlocfilehash: dad6f1648cba44b38e37720f7e395687f769d91e
ms.sourcegitcommit: ad4d92dce894592a259721a1571b1d8736abacdb
ms.translationtype: MT
ms.contentlocale: fr-FR
ms.lasthandoff: 08/04/2020
ms.locfileid: "87697979"
---
# <a name="create-a-snapshot-for-a-merge-publication-with-parameterized-filters"></a><span data-ttu-id="6289c-102">Créer un instantané d'une publication de fusion avec des filtres paramétrés</span><span class="sxs-lookup"><span data-stu-id="6289c-102">Create a Snapshot for a Merge Publication with Parameterized Filters</span></span>
  <span data-ttu-id="6289c-103">Cette rubrique explique comment créer un instantané pour une publication de fusion avec des filtres paramétrables dans [!INCLUDE[ssCurrent](../../includes/sscurrent-md.md)] à l'aide de [!INCLUDE[ssManStudioFull](../../includes/ssmanstudiofull-md.md)], de [!INCLUDE[tsql](../../includes/tsql-md.md)]ou d'objets RMO (Replication Management Objects).</span><span class="sxs-lookup"><span data-stu-id="6289c-103">This topic describes how to create a snapshot for a merge publication with parameterized filters in [!INCLUDE[ssCurrent](../../includes/sscurrent-md.md)] by using [!INCLUDE[ssManStudioFull](../../includes/ssmanstudiofull-md.md)], [!INCLUDE[tsql](../../includes/tsql-md.md)], or Replication Management Objects (RMO).</span></span>  
  
  
##  <a name="before-you-begin"></a><a name="BeforeYouBegin"></a> <span data-ttu-id="6289c-104">Avant de commencer</span><span class="sxs-lookup"><span data-stu-id="6289c-104">Before You Begin</span></span>  
  
###  <a name="recommendations"></a><a name="Recommendations"></a> <span data-ttu-id="6289c-105">Recommandations</span><span class="sxs-lookup"><span data-stu-id="6289c-105">Recommendations</span></span>  
  
-   <span data-ttu-id="6289c-106">Lors de la génération d'un instantané pour une publication de fusion à l'aide de filtres paramétrables, vous devez commencer par générer un instantané standard (schéma) qui contient l'ensemble des données publiées, ainsi que les métadonnées de l'Abonné pour l'abonnement.</span><span class="sxs-lookup"><span data-stu-id="6289c-106">When generating a snapshot for a merge publication using parameterized filters, you must first generate a standard (schema) snapshot that contains all of the published data and Subscriber metadata for the subscription.</span></span> <span data-ttu-id="6289c-107">Pour plus d’informations, voir [Create and Apply the Initial Snapshot](create-and-apply-the-initial-snapshot.md).</span><span class="sxs-lookup"><span data-stu-id="6289c-107">For more information, see [Create and Apply the Initial Snapshot](create-and-apply-the-initial-snapshot.md).</span></span> <span data-ttu-id="6289c-108">Après avoir créé l'instantané de schéma, vous pouvez générer l'instantané qui contient la partition des données publiées spécifique à l'Abonné.</span><span class="sxs-lookup"><span data-stu-id="6289c-108">After you have created the schema snapshot, you can generate the snapshot that contains the Subscriber-specific partition of the published data.</span></span>  
  
-   <span data-ttu-id="6289c-109">Si le filtrage d'un ou plusieurs articles de la publication donne des partitions qui ne se chevauchent pas et sont uniques pour chaque abonnement, les métadonnées sont nettoyées à chaque exécution de l'Agent de fusion.</span><span class="sxs-lookup"><span data-stu-id="6289c-109">If the filtering for one or more articles in the publication yields non-overlapping partitions that are unique for each subscription, metadata is cleaned up whenever the Merge Agent runs.</span></span> <span data-ttu-id="6289c-110">Cela signifie que l'instantané partitionné expire plus rapidement.</span><span class="sxs-lookup"><span data-stu-id="6289c-110">This means that the partitioned snapshot expires more quickly.</span></span> <span data-ttu-id="6289c-111">Lorsque vous optez pour cette méthode, envisagez d'autoriser les Abonnées à initialiser la génération et la remise d'instantané.</span><span class="sxs-lookup"><span data-stu-id="6289c-111">When using this option, you should consider allowing Subscribers to initiate snapshot generation and delivery.</span></span> <span data-ttu-id="6289c-112">Pour plus d’informations sur les options de filtrage, consultez la section « Définition des options de partition » dans [Instantanés des publications de fusion avec des filtres paramétrés](snapshots-for-merge-publications-with-parameterized-filters.md).</span><span class="sxs-lookup"><span data-stu-id="6289c-112">For more information about filtering options, see the "Setting 'partition options'" section of [Snapshots for Merge Publications with Parameterized Filters](snapshots-for-merge-publications-with-parameterized-filters.md).</span></span>  
  
##  <a name="using-sql-server-management-studio"></a><a name="SSMSProcedure"></a> <span data-ttu-id="6289c-113">Utilisation de SQL Server Management Studio</span><span class="sxs-lookup"><span data-stu-id="6289c-113">Using SQL Server Management Studio</span></span>  
 <span data-ttu-id="6289c-114">Générez des instantanés pour des partitions dans la page **Partitions de données** de la boîte de dialogue **Propriétés de la publication\<Publication>** .</span><span class="sxs-lookup"><span data-stu-id="6289c-114">Generate snapshots for partitions on the **Data Partitions** page of the **Publication Properties - \<Publication>** dialog box.</span></span> <span data-ttu-id="6289c-115">Pour plus d'informations sur l'accès à cette boîte de dialogue, consultez [Afficher et modifier les propriétés d’un serveur de publication](publish/view-and-modify-publication-properties.md).</span><span class="sxs-lookup"><span data-stu-id="6289c-115">For more information about accessing this dialog box, see [View and Modify Publication Properties](publish/view-and-modify-publication-properties.md).</span></span> <span data-ttu-id="6289c-116">Vous pouvez permettre à des Abonnés de lancer la génération et la livraison d'instantanés et/ou de générer des instantanés.</span><span class="sxs-lookup"><span data-stu-id="6289c-116">You can allow Subscribers to initiate snapshot generation and delivery and/or generate snapshots.</span></span>  
  
 <span data-ttu-id="6289c-117">Pour générer des instantanés pour une ou plusieurs partitions, vous devez préalablement :</span><span class="sxs-lookup"><span data-stu-id="6289c-117">Before generating snapshots for one or more partitions, you must:</span></span>  
  
1.  <span data-ttu-id="6289c-118">créer une publication de fusion à l'aide de l'Assistant Nouvelle publication et spécifier un ou plusieurs filtres de lignes paramétrables dans la page **Ajouter un filtre** de l'Assistant.</span><span class="sxs-lookup"><span data-stu-id="6289c-118">Create a merge publication with the New Publication Wizard, and specify one or more parameterized row filters on the **Add Filter** page of the wizard.</span></span> <span data-ttu-id="6289c-119">Pour plus d'informations, voir [Définir et modifier un filtre de lignes paramétrable pour un article de fusion](publish/define-and-modify-a-parameterized-row-filter-for-a-merge-article.md).</span><span class="sxs-lookup"><span data-stu-id="6289c-119">For more information, see [Define and Modify a Parameterized Row Filter for a Merge Article](publish/define-and-modify-a-parameterized-row-filter-for-a-merge-article.md).</span></span>  
  
2.  <span data-ttu-id="6289c-120">Générez un instantané du schéma pour la publication.</span><span class="sxs-lookup"><span data-stu-id="6289c-120">Generate a schema snapshot for the publication.</span></span> <span data-ttu-id="6289c-121">Par défaut, un instantané du schéma est généré lorsque vous terminez l'Assistant Nouvelle publication ; vous pouvez également générer un instantané du schéma à partir de [!INCLUDE[ssManStudioFull](../../includes/ssmanstudiofull-md.md)].</span><span class="sxs-lookup"><span data-stu-id="6289c-121">By default, a schema snapshot is generated when you complete the New Publication Wizard; you can also generate a schema snapshot from [!INCLUDE[ssManStudioFull](../../includes/ssmanstudiofull-md.md)].</span></span>  
  
#### <a name="to-generate-a-schema-snapshot"></a><span data-ttu-id="6289c-122">Pour générer un instantané du schéma</span><span class="sxs-lookup"><span data-stu-id="6289c-122">To generate a schema snapshot</span></span>  
  
1.  <span data-ttu-id="6289c-123">Connectez-vous au serveur de publication dans [!INCLUDE[ssManStudio](../../includes/ssmanstudio-md.md)], puis développez le nœud du serveur.</span><span class="sxs-lookup"><span data-stu-id="6289c-123">Connect to the Publisher in [!INCLUDE[ssManStudio](../../includes/ssmanstudio-md.md)], and then expand the server node.</span></span>  
  
2.  <span data-ttu-id="6289c-124">Développez le dossier **Réplication** , puis le dossier **Publications** .</span><span class="sxs-lookup"><span data-stu-id="6289c-124">Expand the **Replication** folder, and then expand the **Publications** folder.</span></span>  
  
3.  <span data-ttu-id="6289c-125">Cliquez avec le bouton droit sur la réplication pour laquelle vous souhaitez créer un instantané, puis cliquez sur **Afficher l'état de l'Agent d'instantané**.</span><span class="sxs-lookup"><span data-stu-id="6289c-125">Right-click the publication for which you want to create a snapshot, and then click **View Snapshot Agent Status**.</span></span>  
  
4.  <span data-ttu-id="6289c-126">Dans la boîte de dialogue **Afficher l’état de l’Agent d’instantané - \<Publication>** , cliquez sur **Démarrer**.</span><span class="sxs-lookup"><span data-stu-id="6289c-126">In the **View Snapshot Agent Status - \<Publication>** dialog box, click **Start**.</span></span>  
  
     <span data-ttu-id="6289c-127">Lorsque l'Agent d'instantané termine la génération de l'instantané, un message comme celui-ci s'affiche : « [100 %] Un instantané de 17 article(s) a été généré ».</span><span class="sxs-lookup"><span data-stu-id="6289c-127">When the Snapshot Agent finishes generating the snapshot, a message will be displayed, such as "[100%] A snapshot of 17 article(s) was generated."</span></span>  
  
#### <a name="to-allow-subscribers-to-initiate-snapshot-generation-and-delivery"></a><span data-ttu-id="6289c-128">Pour permettre aux Abonnés d'initier la génération et la remise d'instantanés</span><span class="sxs-lookup"><span data-stu-id="6289c-128">To allow Subscribers to initiate snapshot generation and delivery</span></span>  
  
1.  <span data-ttu-id="6289c-129">Dans la page **Partitions de données** de la boîte de dialogue **Propriétés de la publication - \<Publication>** , sélectionnez **Définir automatiquement une partition et générer un instantané si nécessaire lorsqu’un nouvel Abonné essaie de se synchroniser**.</span><span class="sxs-lookup"><span data-stu-id="6289c-129">On the **Data Partitions** page of the **Publication Properties - \<Publication>** dialog box, select **Automatically define a partition and generate a snapshot if needed when a new Subscriber tries to synchronize**.</span></span>  
  
2.  [!INCLUDE[clickOK](../../includes/clickok-md.md)]  
  
#### <a name="to-generate-and-refresh-snapshots"></a><span data-ttu-id="6289c-130">Pour générer et actualiser des instantanés</span><span class="sxs-lookup"><span data-stu-id="6289c-130">To generate and refresh snapshots</span></span>  
  
1.  <span data-ttu-id="6289c-131">Dans la page **Partitions de données** de la boîte de dialogue **Propriétés de la publication - \<Publication>** , cliquez sur **Ajouter**.</span><span class="sxs-lookup"><span data-stu-id="6289c-131">On the **Data Partitions** page of the **Publication Properties - \<Publication>** dialog box, click **Add**.</span></span>  
  
2.  <span data-ttu-id="6289c-132">Entrez une valeur pour la valeur **HOST_NAME()** et/ou **SUSER_SNAME()** associée à la partition pour laquelle vous voulez créer un instantané.</span><span class="sxs-lookup"><span data-stu-id="6289c-132">Enter a value for the **HOST_NAME()** and/or **SUSER_SNAME()** value associated with the partition for which you want to create a snapshot.</span></span>  
  
3.  <span data-ttu-id="6289c-133">En option, spécifiez une planification pour l'actualisation des instantanés :</span><span class="sxs-lookup"><span data-stu-id="6289c-133">Optionally specify a schedule for refreshing snapshots:</span></span>  
  
    1.  <span data-ttu-id="6289c-134">Sélectionnez **Planifier l'Agent d'instantané pour l'exécution de cette partition à l'heure ou aux heures suivantes**.</span><span class="sxs-lookup"><span data-stu-id="6289c-134">Select **Schedule the Snapshot Agent for this partition to run at the following time(s)**</span></span>  
  
    2.  <span data-ttu-id="6289c-135">Acceptez la planification par défaut pour l'actualisation des instantanés, ou cliquez sur **Modifier** pour spécifier une autre planification.</span><span class="sxs-lookup"><span data-stu-id="6289c-135">Accept the default schedule for refreshing snapshots, or click **Change** to specify a different schedule.</span></span>  
  
4.  <span data-ttu-id="6289c-136">Cliquez sur **OK** pour revenir à la boîte de dialogue **Propriétés de la publication - \<Publication>** .</span><span class="sxs-lookup"><span data-stu-id="6289c-136">Click **OK**, which returns you to the **Publication Properties - \<Publication>** dialog box.</span></span>  
  
5.  <span data-ttu-id="6289c-137">Sélectionnez la partition dans la grille de propriétés, puis cliquez sur **Générer les instantanés sélectionnés maintenant**.</span><span class="sxs-lookup"><span data-stu-id="6289c-137">Select the partition in the property grid, and then click **Generate the selected snapshots now**.</span></span>  
  
6.  [!INCLUDE[clickOK](../../includes/clickok-md.md)]  
  
##  <a name="using-transact-sql"></a><a name="TsqlProcedure"></a> <span data-ttu-id="6289c-138">Utilisation de Transact-SQL</span><span class="sxs-lookup"><span data-stu-id="6289c-138">Using Transact-SQL</span></span>  
 <span data-ttu-id="6289c-139">Les procédures stockées et l'Agent d'instantané permettent d'effectuer les tâches suivantes :</span><span class="sxs-lookup"><span data-stu-id="6289c-139">Using stored procedures and the Snapshot Agent, you can perform the following:</span></span>  
  
-   <span data-ttu-id="6289c-140">Vous pouvez autoriser les Abonnés à demander la génération et l'application d'un instantané lors de leur première synchronisation.</span><span class="sxs-lookup"><span data-stu-id="6289c-140">Allow Subscribers to request snapshot generation and application the first time they synchronize.</span></span>  
  
-   <span data-ttu-id="6289c-141">Vous pouvez prégénérer des instantanés pour chaque partition.</span><span class="sxs-lookup"><span data-stu-id="6289c-141">Pre-generate snapshots for each partition.</span></span>  
  
-   <span data-ttu-id="6289c-142">générer manuellement un instantané pour chaque Abonné.</span><span class="sxs-lookup"><span data-stu-id="6289c-142">Manually generate a snapshot for each Subscriber.</span></span>  
  
    > [!IMPORTANT]  
    >  <span data-ttu-id="6289c-143">Lorsque c'est possible, demande aux utilisateurs de fournir les informations d'identification au moment de l'exécution.</span><span class="sxs-lookup"><span data-stu-id="6289c-143">When possible, prompt users to enter security credentials at runtime.</span></span> <span data-ttu-id="6289c-144">Si vous devez enregistrer les informations d'identification dans un fichier de script, vous devez sécuriser le fichier pour empêcher un accès non autorisé.</span><span class="sxs-lookup"><span data-stu-id="6289c-144">If you must store credentials in a script file, you must secure the file to prevent unauthorized access.</span></span>  
  
#### <a name="to-create-a-publication-that-allows-subscribers-to-initiate-snapshot-generation-and-delivery"></a><span data-ttu-id="6289c-145">Pour créer une publication qui permet aux Abonnés d'initialiser la génération et la remise d'instantanés</span><span class="sxs-lookup"><span data-stu-id="6289c-145">To create a publication that allows Subscribers to initiate snapshot generation and delivery</span></span>  
  
1.  <span data-ttu-id="6289c-146">Dans la base de données de publication sur le serveur de publication, exécutez [sp_addmergepublication &#40;Transact-SQL&#41;](/sql/relational-databases/system-stored-procedures/sp-addmergepublication-transact-sql).</span><span class="sxs-lookup"><span data-stu-id="6289c-146">At the Publisher on the publication database, execute [sp_addmergepublication &#40;Transact-SQL&#41;](/sql/relational-databases/system-stored-procedures/sp-addmergepublication-transact-sql).</span></span> <span data-ttu-id="6289c-147">Spécifiez les paramètres suivants :</span><span class="sxs-lookup"><span data-stu-id="6289c-147">Specify the following parameters:</span></span>  
  
    -   <span data-ttu-id="6289c-148">Le nom de la publication pour **\@publication**.</span><span class="sxs-lookup"><span data-stu-id="6289c-148">The name of the publication for **\@publication**.</span></span>  
  
    -   <span data-ttu-id="6289c-149">La valeur `true` pour \*\* \@ allow_subscriber_initiated_snapshot\*\*, qui permet aux abonnés d’initialiser le processus d’instantané.</span><span class="sxs-lookup"><span data-stu-id="6289c-149">A value of `true` for **\@allow_subscriber_initiated_snapshot**, which enables Subscribers to initiate the snapshot process.</span></span>  
  
    -   <span data-ttu-id="6289c-150">(Facultatif) Le nombre de processus d’instantané dynamique qui peuvent s’exécuter simultanément pour **\@max_concurrent_dynamic_snapshots**.</span><span class="sxs-lookup"><span data-stu-id="6289c-150">(Optional) The number of dynamic snapshot processes that can run concurrently for **\@max_concurrent_dynamic_snapshots**.</span></span> <span data-ttu-id="6289c-151">Si le nombre maximal de processus en cours d'exécution est atteint et si un Abonné essaie de générer un instantané, le processus est placé en file d'attente.</span><span class="sxs-lookup"><span data-stu-id="6289c-151">If the maximum number of processes is running and a Subscriber attempts to generate a snapshot, the process is placed in a queue.</span></span> <span data-ttu-id="6289c-152">Par défaut, le nombre de processus simultanés est illimité.</span><span class="sxs-lookup"><span data-stu-id="6289c-152">By default there is no limit to the number of concurrent processes.</span></span>  
  
2.  <span data-ttu-id="6289c-153">Sur le serveur de publication, exécutez [sp_addpublication_snapshot &#40;Transact-SQL&#41;](/sql/relational-databases/system-stored-procedures/sp-addpublication-snapshot-transact-sql).</span><span class="sxs-lookup"><span data-stu-id="6289c-153">At the Publisher, execute [sp_addpublication_snapshot &#40;Transact-SQL&#41;](/sql/relational-databases/system-stored-procedures/sp-addpublication-snapshot-transact-sql).</span></span> <span data-ttu-id="6289c-154">Spécifiez le nom de la publication utilisé à l’étape 1 pour la \*\* \@ publication\*\* et les [!INCLUDE[msCoName](../../includes/msconame-md.md)] informations d’identification Windows sous lesquelles la [réplication agent d’instantané](agents/replication-snapshot-agent.md) l’authentification lors de la connexion au serveur de publication, vous devez également spécifier la valeur **0** pour \*\* \@ publisher_security_mode\*\* et les [!INCLUDE[msCoName](../../includes/msconame-md.md)] [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] informations de connexion pour \*\* \@ publisher_login\*\* et \*\* \@ publisher_password\*\*.</span><span class="sxs-lookup"><span data-stu-id="6289c-154">Specify the publication name used in step 1 for **\@publication** and the [!INCLUDE[msCoName](../../includes/msconame-md.md)] Windows credentials under which the [Replication Snapshot Agent](agents/replication-snapshot-agent.md) Authentication when connecting to the Publisher, you must also specify a value of **0** for **\@publisher_security_mode** and the [!INCLUDE[msCoName](../../includes/msconame-md.md)] [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] login information for **\@publisher_login** and **\@publisher_password**.</span></span> <span data-ttu-id="6289c-155">Il s'ensuit la création d'un travail de l'Agent d'instantané pour la publication.</span><span class="sxs-lookup"><span data-stu-id="6289c-155">This creates a Snapshot Agent job for the publication.</span></span> <span data-ttu-id="6289c-156">Pour plus d'informations sur la génération d'un instantané initial et la définition d'une planification personnalisée pour l'Agent d'instantané, consultez [Create and Apply the Initial Snapshot](create-and-apply-the-initial-snapshot.md).</span><span class="sxs-lookup"><span data-stu-id="6289c-156">For more information about generating an initial snapshot and defining a custom schedule for the Snapshot Agent, see [Create and Apply the Initial Snapshot](create-and-apply-the-initial-snapshot.md).</span></span>  
  
    > [!IMPORTANT]  
    >  <span data-ttu-id="6289c-157">Lors de la configuration d'un serveur de publication avec un serveur de distribution distant, les valeurs fournies pour tous les paramètres, y compris *job_login* et *job_password*, sont envoyées en texte brut au serveur de distribution.</span><span class="sxs-lookup"><span data-stu-id="6289c-157">When configuring a Publisher with a remote Distributor, the values supplied for all parameters, including *job_login* and *job_password*, are sent to the Distributor as plain text.</span></span> <span data-ttu-id="6289c-158">Vous devez chiffrer la connexion entre le serveur de publication et son serveur de distribution distant avant d'exécuter cette procédure stockée.</span><span class="sxs-lookup"><span data-stu-id="6289c-158">You should encrypt the connection between the Publisher and its remote Distributor before executing this stored procedure.</span></span> <span data-ttu-id="6289c-159">Pour plus d’informations, consultez [Activer des connexions chiffrées dans le moteur de base de données &#40;Gestionnaire de configuration SQL Server&#41;](../../database-engine/configure-windows/enable-encrypted-connections-to-the-database-engine.md).</span><span class="sxs-lookup"><span data-stu-id="6289c-159">For more information, see [Enable Encrypted Connections to the Database Engine &#40;SQL Server Configuration Manager&#41;](../../database-engine/configure-windows/enable-encrypted-connections-to-the-database-engine.md).</span></span>  
  
3.  <span data-ttu-id="6289c-160">Exécutez [sp_addmergearticle &#40;Transact-SQL&#41;](/sql/relational-databases/system-stored-procedures/sp-addmergearticle-transact-sql) pour ajouter des articles à la publication.</span><span class="sxs-lookup"><span data-stu-id="6289c-160">Execute [sp_addmergearticle &#40;Transact-SQL&#41;](/sql/relational-databases/system-stored-procedures/sp-addmergearticle-transact-sql) to add articles to the publication.</span></span> <span data-ttu-id="6289c-161">Cette procédure stockée doit être exécutée une fois pour chaque article de la publication.</span><span class="sxs-lookup"><span data-stu-id="6289c-161">This stored procedure must be executed once for each article in the publication.</span></span> <span data-ttu-id="6289c-162">Lorsque vous utilisez des filtres paramétrables, vous devez spécifier un filtre de lignes paramétrable pour un ou plusieurs articles à l’aide du paramètre **\@subset_filterclause**.</span><span class="sxs-lookup"><span data-stu-id="6289c-162">When using parameterized filters, you must specify a parameterized row filter for one or more articles using the **\@subset_filterclause** parameter.</span></span> <span data-ttu-id="6289c-163">Pour plus d'informations, voir [Définir et modifier un filtre de lignes paramétrable pour un article de fusion](publish/define-and-modify-a-parameterized-row-filter-for-a-merge-article.md).</span><span class="sxs-lookup"><span data-stu-id="6289c-163">For more information, see [Define and Modify a Parameterized Row Filter for a Merge Article](publish/define-and-modify-a-parameterized-row-filter-for-a-merge-article.md).</span></span>  
  
4.  <span data-ttu-id="6289c-164">Si d’autres articles doivent être filtrés sur la base du filtre de lignes paramétrable, exécutez [sp_addmergefilter &#40;Transact-SQL&#41;](/sql/relational-databases/system-stored-procedures/sp-addmergefilter-transact-sql) pour définir la relation de jointure ou d’enregistrements logiques entre les articles.</span><span class="sxs-lookup"><span data-stu-id="6289c-164">If other articles will be filtered based on the parameterized row filter, execute [sp_addmergefilter &#40;Transact-SQL&#41;](/sql/relational-databases/system-stored-procedures/sp-addmergefilter-transact-sql) to define the join or logical record relationships between articles.</span></span> <span data-ttu-id="6289c-165">Cette procédure stockée doit être exécutée une fois pour chaque relation en cours de définition.</span><span class="sxs-lookup"><span data-stu-id="6289c-165">This stored procedure must be executed once for each relationship being defined.</span></span> <span data-ttu-id="6289c-166">Pour plus d'informations, voir [Définir et modifier un filtre de jointure entre des articles de fusion](publish/define-and-modify-a-join-filter-between-merge-articles.md).</span><span class="sxs-lookup"><span data-stu-id="6289c-166">For more information, see [Define and Modify a Join Filter Between Merge Articles](publish/define-and-modify-a-join-filter-between-merge-articles.md).</span></span>  
  
5.  <span data-ttu-id="6289c-167">Lorsque l'Agent de fusion demande à l'instantané d'initialiser l'Abonné, l'instantané de la partition de l'abonnement demandeur est généré automatiquement.</span><span class="sxs-lookup"><span data-stu-id="6289c-167">When the Merge Agent requests the snapshot to initialize the Subscriber, the snapshot for the requesting subscription's partition is automatically generated.</span></span>  
  
#### <a name="to-create-a-publication-and-pre-generate-or-automatically-refresh-snapshots"></a><span data-ttu-id="6289c-168">Pour créer une publication et prégénérer ou actualiser automatiquement des instantanés</span><span class="sxs-lookup"><span data-stu-id="6289c-168">To create a publication and pre-generate or automatically refresh snapshots</span></span>  
  
1.  <span data-ttu-id="6289c-169">Exécutez [sp_addmergepublication &#40;Transact-SQL&#41;](/sql/relational-databases/system-stored-procedures/sp-addmergepublication-transact-sql) pour créer la publication.</span><span class="sxs-lookup"><span data-stu-id="6289c-169">Execute [sp_addmergepublication &#40;Transact-SQL&#41;](/sql/relational-databases/system-stored-procedures/sp-addmergepublication-transact-sql) to create the publication.</span></span> <span data-ttu-id="6289c-170">Pour plus d’informations, voir [Create a Publication](publish/create-a-publication.md).</span><span class="sxs-lookup"><span data-stu-id="6289c-170">For more information, see [Create a Publication](publish/create-a-publication.md).</span></span>  
  
2.  <span data-ttu-id="6289c-171">Sur le serveur de publication, exécutez [sp_addpublication_snapshot &#40;Transact-SQL&#41;](/sql/relational-databases/system-stored-procedures/sp-addpublication-snapshot-transact-sql).</span><span class="sxs-lookup"><span data-stu-id="6289c-171">At the Publisher, execute [sp_addpublication_snapshot &#40;Transact-SQL&#41;](/sql/relational-databases/system-stored-procedures/sp-addpublication-snapshot-transact-sql).</span></span> <span data-ttu-id="6289c-172">Spécifiez le nom de publication utilisé à l’étape 1 pour **\@publication** et les informations d’identification Windows sous lesquelles l’Agent d’instantané s’exécute pour **\@job_login** et **\@password**.</span><span class="sxs-lookup"><span data-stu-id="6289c-172">Specify the publication name used in step 1 for **\@publication** and the Windows credentials under which the Snapshot Agent runs for **\@job_login** and **\@password**.</span></span> <span data-ttu-id="6289c-173">Si l’agent doit utiliser l’authentification [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] lors de la connexion au serveur de publication, vous devez aussi spécifier la valeur **0** pour **\@publisher_security_mode** et les informations de connexion [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] pour **\@publisher_login** et **\@publisher_password**.</span><span class="sxs-lookup"><span data-stu-id="6289c-173">If the agent will use [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] Authentication when connecting to the Publisher, you must also specify a value of **0** for **\@publisher_security_mode** and the [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] login information for **\@publisher_login** and **\@publisher_password**.</span></span> <span data-ttu-id="6289c-174">Il s'ensuit la création d'un travail de l'Agent d'instantané pour la publication.</span><span class="sxs-lookup"><span data-stu-id="6289c-174">This creates a Snapshot Agent job for the publication.</span></span> <span data-ttu-id="6289c-175">Pour plus d'informations sur la génération d'un instantané initial et la définition d'une planification personnalisée pour l'Agent d'instantané, consultez [Create and Apply the Initial Snapshot](create-and-apply-the-initial-snapshot.md).</span><span class="sxs-lookup"><span data-stu-id="6289c-175">For more information about generating an initial snapshot and defining a custom schedule for the Snapshot Agent, see [Create and Apply the Initial Snapshot](create-and-apply-the-initial-snapshot.md).</span></span>  
  
    > [!IMPORTANT]  
    >  <span data-ttu-id="6289c-176">Lors de la configuration d'un serveur de publication avec un serveur de distribution distant, les valeurs fournies pour tous les paramètres, y compris *job_login* et *job_password*, sont envoyées en texte brut au serveur de distribution.</span><span class="sxs-lookup"><span data-stu-id="6289c-176">When configuring a Publisher with a remote Distributor, the values supplied for all parameters, including *job_login* and *job_password*, are sent to the Distributor as plain text.</span></span> <span data-ttu-id="6289c-177">Vous devez chiffrer la connexion entre le serveur de publication et son serveur de distribution distant avant d'exécuter cette procédure stockée.</span><span class="sxs-lookup"><span data-stu-id="6289c-177">You should encrypt the connection between the Publisher and its remote Distributor before executing this stored procedure.</span></span> <span data-ttu-id="6289c-178">Pour plus d’informations, consultez [Activer des connexions chiffrées dans le moteur de base de données &#40;Gestionnaire de configuration SQL Server&#41;](../../database-engine/configure-windows/enable-encrypted-connections-to-the-database-engine.md).</span><span class="sxs-lookup"><span data-stu-id="6289c-178">For more information, see [Enable Encrypted Connections to the Database Engine &#40;SQL Server Configuration Manager&#41;](../../database-engine/configure-windows/enable-encrypted-connections-to-the-database-engine.md).</span></span>  
  
3.  <span data-ttu-id="6289c-179">Exécutez [sp_addmergearticle &#40;Transact-SQL&#41;](/sql/relational-databases/system-stored-procedures/sp-addmergearticle-transact-sql) pour ajouter des articles à la publication.</span><span class="sxs-lookup"><span data-stu-id="6289c-179">Execute [sp_addmergearticle &#40;Transact-SQL&#41;](/sql/relational-databases/system-stored-procedures/sp-addmergearticle-transact-sql) to add articles to the publication.</span></span> <span data-ttu-id="6289c-180">Cette procédure stockée doit être exécutée une fois pour chaque article de la publication.</span><span class="sxs-lookup"><span data-stu-id="6289c-180">This stored procedure must be executed once for each article in the publication.</span></span> <span data-ttu-id="6289c-181">Lorsque vous utilisez des filtres paramétrables, vous devez spécifier un filtre de lignes paramétrable pour un seul article à l’aide du paramètre **\@subset_filterclause**.</span><span class="sxs-lookup"><span data-stu-id="6289c-181">When using parameterized filters, you must specify a parameterized row filter for one article using the **\@subset_filterclause** parameter.</span></span> <span data-ttu-id="6289c-182">Pour plus d'informations, voir [Définir et modifier un filtre de lignes paramétrable pour un article de fusion](publish/define-and-modify-a-parameterized-row-filter-for-a-merge-article.md).</span><span class="sxs-lookup"><span data-stu-id="6289c-182">For more information, see [Define and Modify a Parameterized Row Filter for a Merge Article](publish/define-and-modify-a-parameterized-row-filter-for-a-merge-article.md).</span></span>  
  
4.  <span data-ttu-id="6289c-183">Si d’autres articles doivent être filtrés sur la base du filtre de lignes paramétrable, exécutez [sp_addmergefilter &#40;Transact-SQL&#41;](/sql/relational-databases/system-stored-procedures/sp-addmergefilter-transact-sql) pour définir la relation de jointure ou d’enregistrements logiques entre les articles.</span><span class="sxs-lookup"><span data-stu-id="6289c-183">If other articles will be filtered based on the parameterized row filter, execute [sp_addmergefilter &#40;Transact-SQL&#41;](/sql/relational-databases/system-stored-procedures/sp-addmergefilter-transact-sql) to define the join or logical record relationships between articles.</span></span> <span data-ttu-id="6289c-184">Cette procédure stockée doit être exécutée une fois pour chaque relation en cours de définition.</span><span class="sxs-lookup"><span data-stu-id="6289c-184">This stored procedure must be executed once for each relationship being defined.</span></span> <span data-ttu-id="6289c-185">Pour plus d'informations, voir [Définir et modifier un filtre de jointure entre des articles de fusion](publish/define-and-modify-a-join-filter-between-merge-articles.md).</span><span class="sxs-lookup"><span data-stu-id="6289c-185">For more information, see [Define and Modify a Join Filter Between Merge Articles](publish/define-and-modify-a-join-filter-between-merge-articles.md).</span></span>  
  
5.  <span data-ttu-id="6289c-186">Dans la base de données de publication sur le serveur de publication, exécutez [sp_helpmergepublication &#40;Transact-SQL&#41;](/sql/relational-databases/system-stored-procedures/sp-helpmergepublication-transact-sql), en spécifiant la valeur de **\@publication** créée à l’étape 1.</span><span class="sxs-lookup"><span data-stu-id="6289c-186">At the Publisher on the publication database, execute [sp_helpmergepublication &#40;Transact-SQL&#41;](/sql/relational-databases/system-stored-procedures/sp-helpmergepublication-transact-sql), specifying the value of **\@publication** from step 1.</span></span> <span data-ttu-id="6289c-187">Notez la valeur du **snapshot_jobid** dans le jeu de résultats.</span><span class="sxs-lookup"><span data-stu-id="6289c-187">Note the value of the **snapshot_jobid** in the result set.</span></span>  
  
6.  <span data-ttu-id="6289c-188">Convertissez la valeur du **snapshot_jobid** obtenue à l'étape 5 en **uniqueidentifier**.</span><span class="sxs-lookup"><span data-stu-id="6289c-188">Convert the value of the **snapshot_jobid** obtained in step 5 to **uniqueidentifier**.</span></span>  
  
7.  <span data-ttu-id="6289c-189">Dans la base de données **msdb** sur le serveur de publication, exécutez [sp_start_job &#40;Transact-SQL&#41;](/sql/relational-databases/system-stored-procedures/sp-start-job-transact-sql), en spécifiant la valeur convertie obtenue à l’étape 6 pour **\@job_id**.</span><span class="sxs-lookup"><span data-stu-id="6289c-189">At the Publisher on the **msdb** database, execute [sp_start_job &#40;Transact-SQL&#41;](/sql/relational-databases/system-stored-procedures/sp-start-job-transact-sql), specifying the converted value obtained in step 6 for **\@job_id**.</span></span>  
  
8.  <span data-ttu-id="6289c-190">Dans la base de données de publication sur le serveur de publication, exécutez [sp_addmergepartition &#40;Transact-SQL&#41;](/sql/relational-databases/system-stored-procedures/sp-addmergepartition-transact-sql).</span><span class="sxs-lookup"><span data-stu-id="6289c-190">At the Publisher on the publication database, execute [sp_addmergepartition &#40;Transact-SQL&#41;](/sql/relational-databases/system-stored-procedures/sp-addmergepartition-transact-sql).</span></span> <span data-ttu-id="6289c-191">Spécifiez le nom de la publication créée à l’étape 1 pour **\@publication** et la valeur utilisée afin de définir la partition pour **\@suser_sname** si [SUSER_SNAME &#40;Transact-SQL&#41;](/sql/t-sql/functions/suser-sname-transact-sql) est utilisé dans la clause de filtre ou pour **\@host_name** si [HOST_NAME &#40;Transact-SQL&#41;](/sql/t-sql/functions/host-name-transact-sql) est utilisé dans la clause de filtre.</span><span class="sxs-lookup"><span data-stu-id="6289c-191">Specify the name of the publication from step 1 for **\@publication** and the value used to define the partition for **\@suser_sname** if [SUSER_SNAME &#40;Transact-SQL&#41;](/sql/t-sql/functions/suser-sname-transact-sql) is used in the filter clause or for **\@host_name** if [HOST_NAME &#40;Transact-SQL&#41;](/sql/t-sql/functions/host-name-transact-sql) is used in the filter clause.</span></span>  
  
9. <span data-ttu-id="6289c-192">Dans la base de données de publication sur le serveur de publication, exécutez [sp_adddynamicsnapshot_job &#40;Transact-SQL&#41;](/sql/relational-databases/system-stored-procedures/sp-adddynamicsnapshot-job-transact-sql).</span><span class="sxs-lookup"><span data-stu-id="6289c-192">At the publisher on the publication database, execute [sp_adddynamicsnapshot_job &#40;Transact-SQL&#41;](/sql/relational-databases/system-stored-procedures/sp-adddynamicsnapshot-job-transact-sql).</span></span> <span data-ttu-id="6289c-193">Spécifiez le nom de la publication définie à l’étape 1 pour **\@publication**, la valeur de **\@suser_sname** ou **\@host_name** définie à l’étape 8 et une planification pour le travail.</span><span class="sxs-lookup"><span data-stu-id="6289c-193">Specify the name of the publication from step 1 for **\@publication**, the value of **\@suser_sname** or **\@host_name** from step 8, and a schedule for the job.</span></span> <span data-ttu-id="6289c-194">Le travail qui génère l'instantané paramétrable pour la partition spécifiée est ainsi créé.</span><span class="sxs-lookup"><span data-stu-id="6289c-194">This creates the job that generates the parameterized snapshot for the specified partition.</span></span> <span data-ttu-id="6289c-195">Pour plus d’informations, consultez [Spécifier des planifications de synchronisation](specify-synchronization-schedules.md).</span><span class="sxs-lookup"><span data-stu-id="6289c-195">For more information, see [Specify Synchronization Schedules](specify-synchronization-schedules.md).</span></span>  
  
    > [!NOTE]  
    >  <span data-ttu-id="6289c-196">Ce travail s'exécute à l'aide du même compte Windows que le travail d'instantané initial défini à l'étape 2.</span><span class="sxs-lookup"><span data-stu-id="6289c-196">This job runs using the same Windows account as the initial snapshot job defined in step 2.</span></span> <span data-ttu-id="6289c-197">Pour supprimer le travail d’instantané paramétrable et sa partition de données associée, exécutez [sp_dropdynamicsnapshot_job &#40;Transact-SQL&#41;](/sql/relational-databases/system-stored-procedures/sp-dropdynamicsnapshot-job-transact-sql).</span><span class="sxs-lookup"><span data-stu-id="6289c-197">To remove the parameterized snapshot job and its related data partition, execute [sp_dropdynamicsnapshot_job &#40;Transact-SQL&#41;](/sql/relational-databases/system-stored-procedures/sp-dropdynamicsnapshot-job-transact-sql).</span></span>  
  
10. <span data-ttu-id="6289c-198">Dans la base de données de publication sur le serveur de publication, exécutez [sp_helpmergepartition &#40;Transact-SQL&#41;](/sql/relational-databases/system-stored-procedures/sp-helpmergepartition-transact-sql) en spécifiant la valeur de **\@publication** définie à l’étape 1 et la valeur de **\@suser_sname** ou **\@host_name** définie à l’étape 8.</span><span class="sxs-lookup"><span data-stu-id="6289c-198">At the Publisher on the publication database, execute [sp_helpmergepartition &#40;Transact-SQL&#41;](/sql/relational-databases/system-stored-procedures/sp-helpmergepartition-transact-sql), specifying the value of **\@publication** from step 1 and the value of **\@suser_sname** or **\@host_name** from step 8.</span></span> <span data-ttu-id="6289c-199">Notez la valeur du **dynamic_snapshot_jobid** dans le jeu de résultats.</span><span class="sxs-lookup"><span data-stu-id="6289c-199">Note the value of the **dynamic_snapshot_jobid** in the result set.</span></span>  
  
11. <span data-ttu-id="6289c-200">Dans la base de données **msdb** sur le serveur de distribution, exécutez [sp_start_job &#40;Transact-SQL&#41;](/sql/relational-databases/system-stored-procedures/sp-start-job-transact-sql), en spécifiant la valeur obtenue à l’étape 9 pour **\@job_id**.</span><span class="sxs-lookup"><span data-stu-id="6289c-200">At the Distributor on the **msdb** database, execute [sp_start_job &#40;Transact-SQL&#41;](/sql/relational-databases/system-stored-procedures/sp-start-job-transact-sql), specifying the value obtained in step 9 for **\@job_id**.</span></span> <span data-ttu-id="6289c-201">Le travail d'instantané paramétrable de la partition est alors démarré.</span><span class="sxs-lookup"><span data-stu-id="6289c-201">This starts the parameterized snapshot job for the partition.</span></span>  
  
12. <span data-ttu-id="6289c-202">Répétez les étapes 8 à 11 pour générer un instantané partitionné pour chaque abonnement.</span><span class="sxs-lookup"><span data-stu-id="6289c-202">Repeat steps 8-11 to generate a partitioned snapshot for each subscription.</span></span>  
  
#### <a name="to-create-a-publication-and-manually-create-snapshots-for-each-partition"></a><span data-ttu-id="6289c-203">Pour créer une publication et créer manuellement des instantanés pour chaque partition</span><span class="sxs-lookup"><span data-stu-id="6289c-203">To create a publication and manually create snapshots for each partition</span></span>  
  
1.  <span data-ttu-id="6289c-204">Exécutez [sp_addmergepublication &#40;Transact-SQL&#41;](/sql/relational-databases/system-stored-procedures/sp-addmergepublication-transact-sql) pour créer la publication.</span><span class="sxs-lookup"><span data-stu-id="6289c-204">Execute [sp_addmergepublication &#40;Transact-SQL&#41;](/sql/relational-databases/system-stored-procedures/sp-addmergepublication-transact-sql) to create the publication.</span></span> <span data-ttu-id="6289c-205">Pour plus d’informations, voir [Create a Publication](publish/create-a-publication.md).</span><span class="sxs-lookup"><span data-stu-id="6289c-205">For more information, see [Create a Publication](publish/create-a-publication.md).</span></span>  
  
2.  <span data-ttu-id="6289c-206">Sur le serveur de publication, exécutez [sp_addpublication_snapshot &#40;Transact-SQL&#41;](/sql/relational-databases/system-stored-procedures/sp-addpublication-snapshot-transact-sql).</span><span class="sxs-lookup"><span data-stu-id="6289c-206">At the Publisher, execute [sp_addpublication_snapshot &#40;Transact-SQL&#41;](/sql/relational-databases/system-stored-procedures/sp-addpublication-snapshot-transact-sql).</span></span> <span data-ttu-id="6289c-207">Spécifiez le nom de publication utilisé à l’étape 1 pour **\@publication** et les informations d’identification Windows sous lesquelles l’Agent d’instantané s’exécute pour **\@job_login** et **\@password**.</span><span class="sxs-lookup"><span data-stu-id="6289c-207">Specify the publication name used in step 1 for **\@publication** and the Windows credentials under which the Snapshot Agent runs for **\@job_login** and **\@password**.</span></span> <span data-ttu-id="6289c-208">Si l’agent doit utiliser l’authentification [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] lors de la connexion au serveur de publication, vous devez aussi spécifier la valeur **0** pour **\@publisher_security_mode** et les informations de connexion [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] pour **\@publisher_login** et **\@publisher_password**.</span><span class="sxs-lookup"><span data-stu-id="6289c-208">If the agent will use [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] Authentication when connecting to the Publisher, you must also specify a value of **0** for **\@publisher_security_mode** and the [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] login information for **\@publisher_login** and **\@publisher_password**.</span></span> <span data-ttu-id="6289c-209">Il s'ensuit la création d'un travail de l'Agent d'instantané pour la publication.</span><span class="sxs-lookup"><span data-stu-id="6289c-209">This creates a Snapshot Agent job for the publication.</span></span> <span data-ttu-id="6289c-210">Pour plus d'informations sur la génération d'un instantané initial et la définition d'une planification personnalisée pour l'Agent d'instantané, consultez [Create and Apply the Initial Snapshot](create-and-apply-the-initial-snapshot.md).</span><span class="sxs-lookup"><span data-stu-id="6289c-210">For more information about generating an initial snapshot and defining a custom schedule for the Snapshot Agent, see [Create and Apply the Initial Snapshot](create-and-apply-the-initial-snapshot.md).</span></span>  
  
    > [!IMPORTANT]  
    >  <span data-ttu-id="6289c-211">Lors de la configuration d'un serveur de publication avec un serveur de distribution distant, les valeurs fournies pour tous les paramètres, y compris *job_login* et *job_password*, sont envoyées en texte brut au serveur de distribution.</span><span class="sxs-lookup"><span data-stu-id="6289c-211">When configuring a Publisher with a remote Distributor, the values supplied for all parameters, including *job_login* and *job_password*, are sent to the Distributor as plain text.</span></span> <span data-ttu-id="6289c-212">Vous devez chiffrer la connexion entre le serveur de publication et son serveur de distribution distant avant d'exécuter cette procédure stockée.</span><span class="sxs-lookup"><span data-stu-id="6289c-212">You should encrypt the connection between the Publisher and its remote Distributor before executing this stored procedure.</span></span> <span data-ttu-id="6289c-213">Pour plus d’informations, consultez [Activer des connexions chiffrées dans le moteur de base de données &#40;Gestionnaire de configuration SQL Server&#41;](../../database-engine/configure-windows/enable-encrypted-connections-to-the-database-engine.md).</span><span class="sxs-lookup"><span data-stu-id="6289c-213">For more information, see [Enable Encrypted Connections to the Database Engine &#40;SQL Server Configuration Manager&#41;](../../database-engine/configure-windows/enable-encrypted-connections-to-the-database-engine.md).</span></span>  
  
3.  <span data-ttu-id="6289c-214">Exécutez [sp_addmergearticle &#40;Transact-SQL&#41;](/sql/relational-databases/system-stored-procedures/sp-addmergearticle-transact-sql) pour ajouter des articles à la publication.</span><span class="sxs-lookup"><span data-stu-id="6289c-214">Execute [sp_addmergearticle &#40;Transact-SQL&#41;](/sql/relational-databases/system-stored-procedures/sp-addmergearticle-transact-sql) to add articles to the publication.</span></span> <span data-ttu-id="6289c-215">Cette procédure stockée doit être exécutée une fois pour chaque article de la publication.</span><span class="sxs-lookup"><span data-stu-id="6289c-215">This stored procedure must be executed once for each article in the publication.</span></span> <span data-ttu-id="6289c-216">Lorsque vous utilisez des filtres paramétrables, vous devez spécifier un filtre de lignes paramétrable pour au moins un article à l’aide du paramètre **\@subset_filterclause**.</span><span class="sxs-lookup"><span data-stu-id="6289c-216">When using parameterized filters, you must specify a parameterized row filter for at least one article using the **\@subset_filterclause** parameter.</span></span> <span data-ttu-id="6289c-217">Pour plus d'informations, voir [Définir et modifier un filtre de lignes paramétrable pour un article de fusion](publish/define-and-modify-a-parameterized-row-filter-for-a-merge-article.md).</span><span class="sxs-lookup"><span data-stu-id="6289c-217">For more information, see [Define and Modify a Parameterized Row Filter for a Merge Article](publish/define-and-modify-a-parameterized-row-filter-for-a-merge-article.md).</span></span>  
  
4.  <span data-ttu-id="6289c-218">Si d’autres articles doivent être filtrés sur la base du filtre de lignes paramétrable, exécutez [sp_addmergefilter &#40;Transact-SQL&#41;](/sql/relational-databases/system-stored-procedures/sp-addmergefilter-transact-sql) pour définir la relation de jointure ou d’enregistrements logiques entre les articles.</span><span class="sxs-lookup"><span data-stu-id="6289c-218">If other articles will be filtered based on the parameterized row filter, execute [sp_addmergefilter &#40;Transact-SQL&#41;](/sql/relational-databases/system-stored-procedures/sp-addmergefilter-transact-sql) to define the join or logical record relationships between articles.</span></span> <span data-ttu-id="6289c-219">Cette procédure stockée doit être exécutée une fois pour chaque relation en cours de définition.</span><span class="sxs-lookup"><span data-stu-id="6289c-219">This stored procedure must be executed once for each relationship being defined.</span></span> <span data-ttu-id="6289c-220">Pour plus d'informations, voir [Définir et modifier un filtre de jointure entre des articles de fusion](publish/define-and-modify-a-join-filter-between-merge-articles.md).</span><span class="sxs-lookup"><span data-stu-id="6289c-220">For more information, see [Define and Modify a Join Filter Between Merge Articles](publish/define-and-modify-a-join-filter-between-merge-articles.md).</span></span>  
  
5.  <span data-ttu-id="6289c-221">Démarrez le travail d'instantané ou exécutez l'Agent d'instantané des réplications à partir de l'invite de commandes pour générer le schéma d'instantané standard et d'autres fichiers.</span><span class="sxs-lookup"><span data-stu-id="6289c-221">Start the snapshot job or run the Replication Snapshot Agent from the command prompt to generate the standard snapshot schema and other files.</span></span> <span data-ttu-id="6289c-222">Pour plus d’informations, voir [Create and Apply the Initial Snapshot](create-and-apply-the-initial-snapshot.md).</span><span class="sxs-lookup"><span data-stu-id="6289c-222">For more information, see [Create and Apply the Initial Snapshot](create-and-apply-the-initial-snapshot.md).</span></span>  
  
6.  <span data-ttu-id="6289c-223">Exécutez de nouveau l'Agent d'instantané des réplications à partir de l'invite de commandes pour générer des fichiers de copie en bloc (.bcp), en spécifiant l'emplacement de l'instantané partitionné pour **- DynamicSnapshotLocation** et une des propriétés suivantes ou les deux qui définissent la partition :</span><span class="sxs-lookup"><span data-stu-id="6289c-223">Run the Replication Snapshot Agent again from the command prompt to generate bulk copy (.bcp) files, specifying the location of the partitioned snapshot for **-DynamicSnapshotLocation** and one or both of the following properties that defines the partition:</span></span>  
  
    -   <span data-ttu-id="6289c-224">**-DynamicFilterHostName** - valeur si [HOST_NAME &#40;Transact-SQL&#41;](/sql/t-sql/functions/host-name-transact-sql) est utilisé.</span><span class="sxs-lookup"><span data-stu-id="6289c-224">**-DynamicFilterHostName** - the value if [HOST_NAME &#40;Transact-SQL&#41;](/sql/t-sql/functions/host-name-transact-sql) is used.</span></span>  
  
    -   <span data-ttu-id="6289c-225">**-DynamicFilterLogin** - valeur si [HOST_SNAME &#40;Transact-SQL&#41;](/sql/t-sql/functions/suser-sname-transact-sql) est utilisé.</span><span class="sxs-lookup"><span data-stu-id="6289c-225">**-DynamicFilterLogin** - the value if [SUSER_SNAME &#40;Transact-SQL&#41;](/sql/t-sql/functions/suser-sname-transact-sql) is used.</span></span>  
  
7.  <span data-ttu-id="6289c-226">Répétez l'étape 6 pour générer un instantané partitionné pour chaque abonnement.</span><span class="sxs-lookup"><span data-stu-id="6289c-226">Repeat step 6 to generate a partitioned snapshot for each subscription.</span></span>  
  
8.  <span data-ttu-id="6289c-227">Exécutez l'Agent de fusion pour chaque abonnement afin d'appliquer l'instantané partitionné initial aux Abonnés, en spécifiant les propriétés suivantes :</span><span class="sxs-lookup"><span data-stu-id="6289c-227">Run the Merge Agent for each subscription to apply the initial partitioned snapshot at the Subscribers, specifying the following properties:</span></span>  
  
    -   <span data-ttu-id="6289c-228">**-Hostname** - la valeur utilisée pour définir la partition si la valeur réelle de HOST_NAME est remplacée.</span><span class="sxs-lookup"><span data-stu-id="6289c-228">**-Hostname** - the value used to define the partition if the actual value of HOST_NAME is being overridden.</span></span>  
  
    -   <span data-ttu-id="6289c-229">**- DynamicSnapshotLocation** - l'emplacement de l'instantané dynamique pour cette partition.</span><span class="sxs-lookup"><span data-stu-id="6289c-229">**-DynamicSnapshotLocation** - the location of the dynamic snapshot for this partition.</span></span>  
  
> [!NOTE]  
>  <span data-ttu-id="6289c-230">Pour plus d’informations sur la programmation des agents de réplication, consultez [Concepts des exécutables de l’Agent de réplication](concepts/replication-agent-executables-concepts.md).</span><span class="sxs-lookup"><span data-stu-id="6289c-230">For more information about programming replication agents, see [Replication Agent Executables Concepts](concepts/replication-agent-executables-concepts.md).</span></span>  
  
###  <a name="examples-transact-sql"></a><a name="TsqlExample"></a> <span data-ttu-id="6289c-231">Exemples (Transact-SQL)</span><span class="sxs-lookup"><span data-stu-id="6289c-231">Examples (Transact-SQL)</span></span>  
 <span data-ttu-id="6289c-232">Cet exemple crée une publication de fusion avec des filtres paramétrables dans laquelle les Abonnés initialisent le processus de génération d'instantané.</span><span class="sxs-lookup"><span data-stu-id="6289c-232">This example creates a merge publication with parameterized filters where Subscribers initiate the snapshot generation process.</span></span> <span data-ttu-id="6289c-233">Les valeurs de **\@job_login** et **\@job_password** sont passées à l’aide de variables de script.</span><span class="sxs-lookup"><span data-stu-id="6289c-233">Values for **\@job_login** and **\@job_password** are passed in using scripting variables.</span></span>  
  
 [!code-sql[HowTo#sp_MergeDynamicPub1](../../snippets/tsql/SQL15/replication/howto/tsql/createmergepubdynamic1.sql#sp_mergedynamicpub1)]  
  
 <span data-ttu-id="6289c-234">Cet exemple crée une publication à l'aide d'un filtre paramétrable dans laquelle la partition de chaque Abonné est définie en exécutant [sp_addmergepartition](/sql/relational-databases/system-stored-procedures/sp-addmergepartition-transact-sql) et le travail d'instantané filtré est créé en exécutant [sp_adddynamicsnapshot_job](/sql/relational-databases/system-stored-procedures/sp-adddynamicsnapshot-job-transact-sql) et en passant les informations de partitionnement.</span><span class="sxs-lookup"><span data-stu-id="6289c-234">This example creates a publication using a parameterized filter where each Subscriber has its partition defined by executing [sp_addmergepartition](/sql/relational-databases/system-stored-procedures/sp-addmergepartition-transact-sql) and the filtered snapshot job created by executing [sp_adddynamicsnapshot_job](/sql/relational-databases/system-stored-procedures/sp-adddynamicsnapshot-job-transact-sql) passing the partitioning information.</span></span> <span data-ttu-id="6289c-235">Les valeurs de **\@job_login** et **\@job_password** sont passées à l’aide de variables de script.</span><span class="sxs-lookup"><span data-stu-id="6289c-235">Values for **\@job_login** and **\@job_password** are passed in using scripting variables.</span></span>  
  
 [!code-sql[HowTo#sp_MergeDynamicPubPlusPartition](../../snippets/tsql/SQL15/replication/howto/tsql/createmergepubdynamic2.sql#sp_mergedynamicpubpluspartition)]  
  
 <span data-ttu-id="6289c-236">Cet exemple crée une publication à l'aide d'un filtre paramétrable dans laquelle la partition de données et le travail d'instantané filtré de chaque Abonné doivent être créés en fournissant les informations de partitionnement.</span><span class="sxs-lookup"><span data-stu-id="6289c-236">This example creates a publication using a parameterized filter where each Subscriber must have its data partition and filtered snapshot job created by supplying the partitioning information.</span></span> <span data-ttu-id="6289c-237">Un Abonné fournit des informations de partitionnement à l'aide de paramètres de ligne de commande lors de l'exécution manuelle des agents de réplication.</span><span class="sxs-lookup"><span data-stu-id="6289c-237">A Subscriber supplies partitioning information using command-line parameters when manually running the replication agents.</span></span> <span data-ttu-id="6289c-238">Cet exemple suppose qu'un abonnement à la publication a également été créé.</span><span class="sxs-lookup"><span data-stu-id="6289c-238">This example assumes that a subscription to the publication has also been created.</span></span>  
  
 [!code-sql[HowTo#sp_MergeDynamicPubPartitionManual](../../snippets/tsql/SQL15/replication/howto/tsql/createmergepubdynamic3.sql#sp_mergedynamicpubpartitionmanual)]  
  
 
```
REM Line breaks are added to improve readability.   
REM In a batch file, commands must be made in a single line.  
REM Run the Snapshot agent from the command line to generate the standard snapshot   
REM schema and other files.   
SET DistPub=%computername%  
SET PubDB=AdventureWorks2012   
SET PubName=AdvWorksSalesPersonMerge  
  
"C:\Program Files\Microsoft SQL Server\120\COM\SNAPSHOT.EXE" -Publication %PubName%    
-Publisher %DistPub% -Distributor  %DistPub%  -PublisherDB %PubDB%  -ReplicationType 2    
-OutputVerboseLevel 1  -DistributorSecurityMode 1  
  
PAUSE  
```

```
REM Run the Snapshot agent from the command line, this time to generate   
REM the bulk copy (.bcp) data for each Subscriber partition.    
SET DistPub=%computername%  
SET PubDB=AdventureWorks2012   
SET PubName=AdvWorksSalesPersonMerge  
SET SnapshotDir=\\%DistPub%\repldata\unc\fernando  
  
MD %SnapshotDir%  
  
"C:\Program Files\Microsoft SQL Server\120\COM\SNAPSHOT.EXE" -Publication %PubName%    
-Publisher %DistPub%  -Distributor  %DistPub%  -PublisherDB %PubDB%  -ReplicationType 2    
-OutputVerboseLevel 1  -DistributorSecurityMode 1  -DynamicFilterHostName "adventure-works\Fernando"    
-DynamicSnapshotLocation %SnapshotDir%  
  
PAUSE  
```

```
REM Run the Merge Agent for each subscription to apply the partitioned   
REM snapshot for each Subscriber.    
SET Publisher = %computername%  
SET Subscriber = %computername%  
SET PubDB = AdventureWorks2012   
SET SubDB = AdventureWorks2012Replica   
SET PubName = AdvWorksSalesPersonMerge   
SET SnapshotDir=\\%DistPub%\repldata\unc\fernando  
  
"C:\Program Files\Microsoft SQL Server\120\COM\REPLMERG.EXE" -Publisher  %Publisher%    
-Subscriber  %Subscriber%  -Distributor %Publisher%  -PublisherDB %PubDB%    
-SubscriberDB %SubDB% -Publication %PubName%  -PublisherSecurityMode 1  -OutputVerboseLevel 3    
-Output -SubscriberSecurityMode 1  -SubscriptionType 3 -DistributorSecurityMode 1    
-Hostname "adventure-works\Fernando"  -DynamicSnapshotLocation %SnapshotDir%  
  
PAUSE
```
  
  
##  <a name="using-replication-management-objects-rmo"></a><a name="RMOProcedure"></a> <span data-ttu-id="6289c-239">Utilisation d'objets RMO (Replication Management Objects)</span><span class="sxs-lookup"><span data-stu-id="6289c-239">Using Replication Management Objects (RMO)</span></span>  
 <span data-ttu-id="6289c-240">Vous pouvez utiliser les Replication Management Objects pour générer par programme des instantanés partitionnés des manières suivantes :</span><span class="sxs-lookup"><span data-stu-id="6289c-240">You can use Replication Management Objects (RMO) to generate partitioned snapshots programmatically in the following ways:</span></span>  
  
-   <span data-ttu-id="6289c-241">Vous pouvez autoriser les Abonnés à demander la génération et l'application d'un instantané lors de leur première synchronisation.</span><span class="sxs-lookup"><span data-stu-id="6289c-241">Allow Subscribers to request snapshot generation and application the first time they synchronize.</span></span>  
  
-   <span data-ttu-id="6289c-242">Vous pouvez prégénérer des instantanés pour chaque partition.</span><span class="sxs-lookup"><span data-stu-id="6289c-242">Pre-generate snapshots for each partition.</span></span>  
  
-   <span data-ttu-id="6289c-243">Vous pouvez générer manuellement un instantané pour chaque Abonné en exécutant l'Agent d'instantané.</span><span class="sxs-lookup"><span data-stu-id="6289c-243">Manually generate a snapshot for each Subscriber by running the Snapshot Agent.</span></span>  
  
> [!NOTE]  
>  <span data-ttu-id="6289c-244">Lorsque le filtrage d'un article génère des partitions qui ne se chevauchent pas et qui sont uniques pour chaque abonnement (en spécifiant une valeur de <xref:Microsoft.SqlServer.Replication.PartitionOptions.NonOverlappingSingleSubscription> pour <xref:Microsoft.SqlServer.Replication.MergeArticle.PartitionOption%2A> lors de la création d'un article de fusion), les métadonnées sont nettoyées à chaque exécution de l'Agent de fusion.</span><span class="sxs-lookup"><span data-stu-id="6289c-244">When filtering for an article yields non-overlapping partitions that are unique for each subscription (by specifying a value of <xref:Microsoft.SqlServer.Replication.PartitionOptions.NonOverlappingSingleSubscription> for <xref:Microsoft.SqlServer.Replication.MergeArticle.PartitionOption%2A> when creating a merge article), metadata is cleaned up whenever the Merge Agent runs.</span></span> <span data-ttu-id="6289c-245">Cela signifie que l'instantané partitionné expire plus rapidement.</span><span class="sxs-lookup"><span data-stu-id="6289c-245">This means that the partitioned snapshot expires more quickly.</span></span> <span data-ttu-id="6289c-246">Lorsque vous optez pour cette méthode, envisagez d'autoriser les Abonnées à demander la génération d'instantanés.</span><span class="sxs-lookup"><span data-stu-id="6289c-246">When you use this option, you should consider allowing Subscribers to request snapshot generation.</span></span> <span data-ttu-id="6289c-247">Pour plus d'informations, consultez la section Utilisation des options de filtrage appropriées, dans la rubrique [Parameterized Row Filters](merge/parameterized-filters-parameterized-row-filters.md).</span><span class="sxs-lookup"><span data-stu-id="6289c-247">For more information, see the section Using the Appropriate Filtering Options in the topic [Parameterized Row Filters](merge/parameterized-filters-parameterized-row-filters.md).</span></span>  
  
> [!IMPORTANT]  
>  <span data-ttu-id="6289c-248">Lorsque c'est possible, demande aux utilisateurs de fournir les informations d'identification au moment de l'exécution.</span><span class="sxs-lookup"><span data-stu-id="6289c-248">When possible, prompt users to enter security credentials at runtime.</span></span> <span data-ttu-id="6289c-249">Si vous devez stocker des informations d'identification, utilisez les [Services de chiffrement](https://go.microsoft.com/fwlink/?LinkId=34733) fournis par [!INCLUDE[msCoName](../../includes/msconame-md.md)] Windows .NET Framework.</span><span class="sxs-lookup"><span data-stu-id="6289c-249">If you must store credentials, use the [cryptographic services](https://go.microsoft.com/fwlink/?LinkId=34733) provided by the [!INCLUDE[msCoName](../../includes/msconame-md.md)] Windows .NET Framework.</span></span>  
  
#### <a name="to-create-a-publication-that-allows-subscribers-to-initiate-snapshot-generation-and-delivery"></a><span data-ttu-id="6289c-250">Pour créer une publication qui permet aux Abonnés d'initialiser la génération et la remise d'instantanés</span><span class="sxs-lookup"><span data-stu-id="6289c-250">To create a publication that allows Subscribers to initiate snapshot generation and delivery</span></span>  
  
1.  <span data-ttu-id="6289c-251">Créez une connexion au serveur de publication en utilisant la classe <xref:Microsoft.SqlServer.Management.Common.ServerConnection> .</span><span class="sxs-lookup"><span data-stu-id="6289c-251">Create a connection to the Publisher by using the <xref:Microsoft.SqlServer.Management.Common.ServerConnection> class.</span></span>  
  
2.  <span data-ttu-id="6289c-252">Créez une instance de la classe <xref:Microsoft.SqlServer.Replication.ReplicationDatabase> pour la base de données de publication, affectez à la propriété <xref:Microsoft.SqlServer.Replication.ReplicationObject.ConnectionContext%2A> l'instance de <xref:Microsoft.SqlServer.Management.Common.ServerConnection> créée à l'étape 1, puis appelez la méthode <xref:Microsoft.SqlServer.Replication.ReplicationObject.LoadProperties%2A> .</span><span class="sxs-lookup"><span data-stu-id="6289c-252">Create an instance of the <xref:Microsoft.SqlServer.Replication.ReplicationDatabase> class for the publication database, set the <xref:Microsoft.SqlServer.Replication.ReplicationObject.ConnectionContext%2A> property to the instance of <xref:Microsoft.SqlServer.Management.Common.ServerConnection> from step 1, and call the <xref:Microsoft.SqlServer.Replication.ReplicationObject.LoadProperties%2A> method.</span></span> <span data-ttu-id="6289c-253">Si <xref:Microsoft.SqlServer.Replication.ReplicationObject.LoadProperties%2A> retourne `false`, confirmez que la base de données existe.</span><span class="sxs-lookup"><span data-stu-id="6289c-253">If <xref:Microsoft.SqlServer.Replication.ReplicationObject.LoadProperties%2A> returns `false`, confirm that the database exists.</span></span>  
  
3.  <span data-ttu-id="6289c-254">Si la propriété <xref:Microsoft.SqlServer.Replication.ReplicationDatabase.EnabledMergePublishing%2A> a la valeur `false`, affectez-lui la valeur `true` et appelez <xref:Microsoft.SqlServer.Replication.ReplicationObject.CommitPropertyChanges%2A>.</span><span class="sxs-lookup"><span data-stu-id="6289c-254">If <xref:Microsoft.SqlServer.Replication.ReplicationDatabase.EnabledMergePublishing%2A> property is `false`, set it to `true` and call <xref:Microsoft.SqlServer.Replication.ReplicationObject.CommitPropertyChanges%2A>.</span></span>  
  
4.  <span data-ttu-id="6289c-255">Créez une instance de la classe <xref:Microsoft.SqlServer.Replication.MergePublication> et définissez les propriétés suivantes pour cet objet :</span><span class="sxs-lookup"><span data-stu-id="6289c-255">Create an instance of the <xref:Microsoft.SqlServer.Replication.MergePublication> class, and set the following properties for this object:</span></span>  
  
    -   <span data-ttu-id="6289c-256">La classe <xref:Microsoft.SqlServer.Management.Common.ServerConnection> créée à l'étape 1 pour la propriété <xref:Microsoft.SqlServer.Replication.ReplicationObject.ConnectionContext%2A>.</span><span class="sxs-lookup"><span data-stu-id="6289c-256">The <xref:Microsoft.SqlServer.Management.Common.ServerConnection> from step 1 for <xref:Microsoft.SqlServer.Replication.ReplicationObject.ConnectionContext%2A>.</span></span>  
  
    -   <span data-ttu-id="6289c-257">Le nom de la base de données publiée pour <xref:Microsoft.SqlServer.Replication.Publication.DatabaseName%2A>.</span><span class="sxs-lookup"><span data-stu-id="6289c-257">The name of the published database for <xref:Microsoft.SqlServer.Replication.Publication.DatabaseName%2A>.</span></span>  
  
    -   <span data-ttu-id="6289c-258">Le nom de la publication pour <xref:Microsoft.SqlServer.Replication.Publication.Name%2A>.</span><span class="sxs-lookup"><span data-stu-id="6289c-258">A name for the publication for <xref:Microsoft.SqlServer.Replication.Publication.Name%2A>.</span></span>  
  
    -   <span data-ttu-id="6289c-259">Le nombre maximal de travaux d'instantané dynamique à exécuter pour <xref:Microsoft.SqlServer.Replication.MergePublication.MaxConcurrentDynamicSnapshots%2A>.</span><span class="sxs-lookup"><span data-stu-id="6289c-259">The maximum number of dynamic snapshot jobs to run for <xref:Microsoft.SqlServer.Replication.MergePublication.MaxConcurrentDynamicSnapshots%2A>.</span></span> <span data-ttu-id="6289c-260">Comme des demandes d'instantané initialisées par l'Abonné peuvent se produire à tout moment, cette propriété limite le nombre des travaux de l'Agent d'instantané qui peuvent s'exécuter simultanément lorsque plusieurs Abonnés demandent leur instantané partitionné au même moment.</span><span class="sxs-lookup"><span data-stu-id="6289c-260">Because Subscriber initiated snapshot requests can occur at any time, this property limits the number of Snapshot Agent jobs that can run simultaneously when multiple Subscribers request their partitioned snapshot at the same time.</span></span> <span data-ttu-id="6289c-261">Lorsque le nombre maximal de travaux s'exécute, des demandes d'instantanés partitionnés supplémentaires sont mises en file d'attente jusqu'à ce que l'un des travaux en cours d'exécution se termine.</span><span class="sxs-lookup"><span data-stu-id="6289c-261">When the maximum number of jobs are running, additional partitioned snapshot requests are queued until one of the running jobs is completed.</span></span>  
  
    -   <span data-ttu-id="6289c-262">Utilisez l'opérateur OR logique de bits (`|` dans Visual C# et `Or` dans Visual Basic) pour ajouter la valeur <xref:Microsoft.SqlServer.Replication.PublicationAttributes.AllowSubscriberInitiatedSnapshot> à <xref:Microsoft.SqlServer.Replication.Publication.Attributes%2A>.</span><span class="sxs-lookup"><span data-stu-id="6289c-262">Use the bitwise logical OR (`|` in Visual C# and `Or` in Visual Basic) operator to add the value <xref:Microsoft.SqlServer.Replication.PublicationAttributes.AllowSubscriberInitiatedSnapshot> to <xref:Microsoft.SqlServer.Replication.Publication.Attributes%2A>.</span></span>  
  
    -   <span data-ttu-id="6289c-263">Les champs <xref:Microsoft.SqlServer.Replication.IProcessSecurityContext.Login%2A> et <xref:Microsoft.SqlServer.Replication.IProcessSecurityContext.Password%2A> de <xref:Microsoft.SqlServer.Replication.Publication.SnapshotGenerationAgentProcessSecurity%2A> pour fournir les informations d'identification pour le compte [!INCLUDE[msCoName](../../includes/msconame-md.md)] Windows sous lequel le travail de l'Agent d'instantané s'exécute.</span><span class="sxs-lookup"><span data-stu-id="6289c-263">The <xref:Microsoft.SqlServer.Replication.IProcessSecurityContext.Login%2A> and <xref:Microsoft.SqlServer.Replication.IProcessSecurityContext.Password%2A> fields of <xref:Microsoft.SqlServer.Replication.Publication.SnapshotGenerationAgentProcessSecurity%2A> to provide the credentials for the [!INCLUDE[msCoName](../../includes/msconame-md.md)] Windows account under which the Snapshot Agent job runs.</span></span>  
  
        > [!NOTE]  
        >  <span data-ttu-id="6289c-264">La définition de <xref:Microsoft.SqlServer.Replication.Publication.SnapshotGenerationAgentProcessSecurity%2A> est recommandée lorsque la publication est créée par un membre du rôle serveur fixe `sysadmin`.</span><span class="sxs-lookup"><span data-stu-id="6289c-264">Setting <xref:Microsoft.SqlServer.Replication.Publication.SnapshotGenerationAgentProcessSecurity%2A> is recommended when the publication is created by a member of the `sysadmin` fixed server role.</span></span> <span data-ttu-id="6289c-265">Pour plus d’informations, voir [Replication Agent Security Model](security/replication-agent-security-model.md).</span><span class="sxs-lookup"><span data-stu-id="6289c-265">For more information, see [Replication Agent Security Model](security/replication-agent-security-model.md).</span></span>  
  
5.  <span data-ttu-id="6289c-266">Appelez la méthode <xref:Microsoft.SqlServer.Replication.Publication.Create%2A> pour créer la publication.</span><span class="sxs-lookup"><span data-stu-id="6289c-266">Call the <xref:Microsoft.SqlServer.Replication.Publication.Create%2A> method to create the publication.</span></span>  
  
    > [!IMPORTANT]  
    >  <span data-ttu-id="6289c-267">Lors de la configuration d'un serveur de publication avec un serveur de distribution distant, les valeurs fournies pour toutes les propriétés, y compris <xref:Microsoft.SqlServer.Replication.Publication.SnapshotGenerationAgentProcessSecurity%2A>, sont envoyées sous forme de texte brut au serveur de distribution.</span><span class="sxs-lookup"><span data-stu-id="6289c-267">When configuring a Publisher with a remote Distributor, the values supplied for all properties, including <xref:Microsoft.SqlServer.Replication.Publication.SnapshotGenerationAgentProcessSecurity%2A>, are sent to the Distributor as plain text.</span></span> <span data-ttu-id="6289c-268">Vous devez chiffrer la connexion entre le serveur de publication et son serveur de distribution distant avant d'appeler la méthode <xref:Microsoft.SqlServer.Replication.Publication.Create%2A> .</span><span class="sxs-lookup"><span data-stu-id="6289c-268">You should encrypt the connection between the Publisher and its remote Distributor before calling the <xref:Microsoft.SqlServer.Replication.Publication.Create%2A> method.</span></span> <span data-ttu-id="6289c-269">Pour plus d’informations, consultez [Activer des connexions chiffrées dans le moteur de base de données &#40;Gestionnaire de configuration SQL Server&#41;](../../database-engine/configure-windows/enable-encrypted-connections-to-the-database-engine.md).</span><span class="sxs-lookup"><span data-stu-id="6289c-269">For more information, see [Enable Encrypted Connections to the Database Engine &#40;SQL Server Configuration Manager&#41;](../../database-engine/configure-windows/enable-encrypted-connections-to-the-database-engine.md).</span></span>  
  
6.  <span data-ttu-id="6289c-270">Utilisez la propriété <xref:Microsoft.SqlServer.Replication.MergeArticle> pour ajouter des articles à la publication.</span><span class="sxs-lookup"><span data-stu-id="6289c-270">Use the <xref:Microsoft.SqlServer.Replication.MergeArticle> property to add articles to the publication.</span></span> <span data-ttu-id="6289c-271">Spécifiez la propriété <xref:Microsoft.SqlServer.Replication.MergeArticle.FilterClause%2A> pour au moins un article qui définit le filtre paramétrable.</span><span class="sxs-lookup"><span data-stu-id="6289c-271">Specify the <xref:Microsoft.SqlServer.Replication.MergeArticle.FilterClause%2A> property for at least one article that defines the parameterized filter.</span></span> <span data-ttu-id="6289c-272">(Facultatif) Créez des objets <xref:Microsoft.SqlServer.Replication.MergeJoinFilter> qui définissent des filtres de jointure entre les articles.</span><span class="sxs-lookup"><span data-stu-id="6289c-272">(Optional) Create <xref:Microsoft.SqlServer.Replication.MergeJoinFilter> objects that define join filters between articles.</span></span> <span data-ttu-id="6289c-273">Pour plus d’informations, consultez [définir un Article](publish/define-an-article.md).</span><span class="sxs-lookup"><span data-stu-id="6289c-273">For more information, see [Define an Article](publish/define-an-article.md).</span></span>  
  
7.  <span data-ttu-id="6289c-274">Si <xref:Microsoft.SqlServer.Replication.Publication.SnapshotAgentExists%2A> a la valeur `false`, appelez <xref:Microsoft.SqlServer.Replication.Publication.CreateSnapshotAgent%2A> pour créer le travail de l'Agent d'instantané initial pour cette publication.</span><span class="sxs-lookup"><span data-stu-id="6289c-274">If the value of <xref:Microsoft.SqlServer.Replication.Publication.SnapshotAgentExists%2A> is `false`, call <xref:Microsoft.SqlServer.Replication.Publication.CreateSnapshotAgent%2A> to create the initial Snapshot Agent job for this publication.</span></span>  
  
8.  <span data-ttu-id="6289c-275">Appelez la méthode <xref:Microsoft.SqlServer.Replication.Publication.StartSnapshotGenerationAgentJob%2A> de l'objet <xref:Microsoft.SqlServer.Replication.MergePublication> créé à l'étape 4.</span><span class="sxs-lookup"><span data-stu-id="6289c-275">Call the <xref:Microsoft.SqlServer.Replication.Publication.StartSnapshotGenerationAgentJob%2A> method of the <xref:Microsoft.SqlServer.Replication.MergePublication> object created in step 4.</span></span> <span data-ttu-id="6289c-276">Cela démarre le travail de l'agent qui génère l'instantané initial.</span><span class="sxs-lookup"><span data-stu-id="6289c-276">This starts the agent job that generates the initial snapshot.</span></span> <span data-ttu-id="6289c-277">Pour plus d'informations sur la génération d'un instantané initial et la définition d'une planification personnalisée pour l'Agent d'instantané, consultez [Create and Apply the Initial Snapshot](create-and-apply-the-initial-snapshot.md).</span><span class="sxs-lookup"><span data-stu-id="6289c-277">For more information about generating an initial snapshot and defining a custom schedule for the Snapshot Agent, see [Create and Apply the Initial Snapshot](create-and-apply-the-initial-snapshot.md).</span></span>  
  
9. <span data-ttu-id="6289c-278">(Facultatif) Cherchez une valeur `true` pour la propriété <xref:Microsoft.SqlServer.Replication.MergePublication.SnapshotAvailable%2A> afin de déterminer quand l'instantané initial est prêt à être utilisé.</span><span class="sxs-lookup"><span data-stu-id="6289c-278">(Optional) Check for a value of `true` for the <xref:Microsoft.SqlServer.Replication.MergePublication.SnapshotAvailable%2A> property to determine when the initial snapshot is ready for use.</span></span>  
  
10. <span data-ttu-id="6289c-279">Lorsque l'Agent de fusion pour un Abonné se connecte pour la première fois, un instantané partitionné est généré automatiquement.</span><span class="sxs-lookup"><span data-stu-id="6289c-279">When the Merge Agent for a Subscriber connects for the first time, a partitioned snapshot is generated automatically.</span></span>  
  
#### <a name="to-create-a-publication-and-pregenerate-or-automatically-refresh-snapshots"></a><span data-ttu-id="6289c-280">Pour créer une publication et prégénérer ou actualiser automatiquement des instantanés</span><span class="sxs-lookup"><span data-stu-id="6289c-280">To create a publication and pregenerate or automatically refresh snapshots</span></span>  
  
1.  <span data-ttu-id="6289c-281">Utilisez une instance de la classe <xref:Microsoft.SqlServer.Replication.MergePublication> pour définir une publication de fusion.</span><span class="sxs-lookup"><span data-stu-id="6289c-281">Use an instance of the <xref:Microsoft.SqlServer.Replication.MergePublication> class to define a merge publication.</span></span> <span data-ttu-id="6289c-282">Pour plus d’informations, voir [Create a Publication](publish/create-a-publication.md).</span><span class="sxs-lookup"><span data-stu-id="6289c-282">For more information, see [Create a Publication](publish/create-a-publication.md).</span></span>  
  
2.  <span data-ttu-id="6289c-283">Utilisez la propriété <xref:Microsoft.SqlServer.Replication.MergeArticle> pour ajouter des articles à la publication.</span><span class="sxs-lookup"><span data-stu-id="6289c-283">Use the <xref:Microsoft.SqlServer.Replication.MergeArticle> property to add articles to the publication.</span></span> <span data-ttu-id="6289c-284">Spécifiez la propriété <xref:Microsoft.SqlServer.Replication.MergeArticle.FilterClause%2A> pour au moins un article qui définit le filtre paramétrable et créez tous les objets <xref:Microsoft.SqlServer.Replication.MergeJoinFilter> qui définissent les filtres de jointure entre les articles.</span><span class="sxs-lookup"><span data-stu-id="6289c-284">Specify the <xref:Microsoft.SqlServer.Replication.MergeArticle.FilterClause%2A> property for at least one article that defines the parameterized filter, and create any <xref:Microsoft.SqlServer.Replication.MergeJoinFilter> objects that define join filters between articles.</span></span> <span data-ttu-id="6289c-285">Pour plus d’informations, consultez [définir un Article](publish/define-an-article.md).</span><span class="sxs-lookup"><span data-stu-id="6289c-285">For more information, see [Define an Article](publish/define-an-article.md).</span></span>  
  
3.  <span data-ttu-id="6289c-286">Si <xref:Microsoft.SqlServer.Replication.Publication.SnapshotAgentExists%2A> a la valeur `false`, appelez <xref:Microsoft.SqlServer.Replication.Publication.CreateSnapshotAgent%2A> pour créer le travail de l'Agent d'instantané pour cette publication.</span><span class="sxs-lookup"><span data-stu-id="6289c-286">If the value of <xref:Microsoft.SqlServer.Replication.Publication.SnapshotAgentExists%2A> is `false`, call <xref:Microsoft.SqlServer.Replication.Publication.CreateSnapshotAgent%2A> to create the snapshot agent job for this publication.</span></span>  
  
4.  <span data-ttu-id="6289c-287">Appelez la méthode <xref:Microsoft.SqlServer.Replication.Publication.StartSnapshotGenerationAgentJob%2A> de l'objet <xref:Microsoft.SqlServer.Replication.MergePublication> créé à l'étape 1.</span><span class="sxs-lookup"><span data-stu-id="6289c-287">Call the <xref:Microsoft.SqlServer.Replication.Publication.StartSnapshotGenerationAgentJob%2A> method of the <xref:Microsoft.SqlServer.Replication.MergePublication> object created in step 1.</span></span> <span data-ttu-id="6289c-288">Cette méthode démarre le travail de l'agent qui génère l'instantané initial.</span><span class="sxs-lookup"><span data-stu-id="6289c-288">This method starts the agent job that generates the initial snapshot.</span></span> <span data-ttu-id="6289c-289">Pour plus d'informations sur la génération d'un instantané initial et la définition d'une planification personnalisée pour l'Agent d'instantané, consultez [Créer et appliquer l'instantané initial](create-and-apply-the-initial-snapshot.md).</span><span class="sxs-lookup"><span data-stu-id="6289c-289">For more information on generating an initial snapshot and defining a custom schedule for the Snapshot Agent, see [Create and Apply the Initial Snapshot](create-and-apply-the-initial-snapshot.md).</span></span>  
  
5.  <span data-ttu-id="6289c-290">Cherchez une valeur `true` pour la propriété <xref:Microsoft.SqlServer.Replication.MergePublication.SnapshotAvailable%2A> afin de déterminer quand l'instantané initial est prêt à être utilisé.</span><span class="sxs-lookup"><span data-stu-id="6289c-290">Check for a value of `true` for the <xref:Microsoft.SqlServer.Replication.MergePublication.SnapshotAvailable%2A> property to determine when the initial snapshot is ready for use.</span></span>  
  
6.  <span data-ttu-id="6289c-291">Créez une instance de la classe <xref:Microsoft.SqlServer.Replication.MergePartition> et définissez les critères de filtrage paramétrable pour l'Abonné en utilisant une des propriétés suivantes, ou les deux :</span><span class="sxs-lookup"><span data-stu-id="6289c-291">Create an instance of the <xref:Microsoft.SqlServer.Replication.MergePartition> class, and set the parameterized filtering criteria for the Subscriber by using one or both of the following properties:</span></span>  
  
    -   <span data-ttu-id="6289c-292">Si la partition de l’Abonné est définie par le résultat de [SUSER_SNAME &#40;Transact-SQL&#41;](/sql/t-sql/functions/suser-sname-transact-sql), utilisez <xref:Microsoft.SqlServer.Replication.MergePartition.DynamicFilterLogin%2A>.</span><span class="sxs-lookup"><span data-stu-id="6289c-292">If the Subscriber's partition is defined by the result of [SUSER_SNAME &#40;Transact-SQL&#41;](/sql/t-sql/functions/suser-sname-transact-sql), use <xref:Microsoft.SqlServer.Replication.MergePartition.DynamicFilterLogin%2A>.</span></span>  
  
    -   <span data-ttu-id="6289c-293">Si la partition de l’Abonné est définie par le résultat de [HOST_NAME &#40;Transact-SQL&#41;](/sql/t-sql/functions/host-name-transact-sql) ou une surcharge de cette fonction, utilisez <xref:Microsoft.SqlServer.Replication.MergePartition.DynamicFilterHostName%2A>.</span><span class="sxs-lookup"><span data-stu-id="6289c-293">If the Subscriber's partition is defined by the result of [HOST_NAME &#40;Transact-SQL&#41;](/sql/t-sql/functions/host-name-transact-sql) or an overload of this function, use <xref:Microsoft.SqlServer.Replication.MergePartition.DynamicFilterHostName%2A>.</span></span>  
  
7.  <span data-ttu-id="6289c-294">Créez une instance de la classe <xref:Microsoft.SqlServer.Replication.MergeDynamicSnapshotJob> et définissez la même propriété qu'à l'étape 6.</span><span class="sxs-lookup"><span data-stu-id="6289c-294">Create an instance of the <xref:Microsoft.SqlServer.Replication.MergeDynamicSnapshotJob> class, and set the same property as in step 6.</span></span>  
  
8.  <span data-ttu-id="6289c-295">Utilisez la classe <xref:Microsoft.SqlServer.Replication.ReplicationAgentSchedule> pour définir une planification pour générer l'instantané filtré pour la partition de l'Abonné.</span><span class="sxs-lookup"><span data-stu-id="6289c-295">Use the <xref:Microsoft.SqlServer.Replication.ReplicationAgentSchedule> class to define a schedule for generating the filtered snapshot for the Subscriber partition.</span></span>  
  
9. <span data-ttu-id="6289c-296">Utilisez l'instance de <xref:Microsoft.SqlServer.Replication.MergePublication> de l'étape 1 pour appeler <xref:Microsoft.SqlServer.Replication.MergePublication.AddMergePartition%2A>.</span><span class="sxs-lookup"><span data-stu-id="6289c-296">Using the instance of <xref:Microsoft.SqlServer.Replication.MergePublication> from step 1, call <xref:Microsoft.SqlServer.Replication.MergePublication.AddMergePartition%2A>.</span></span> <span data-ttu-id="6289c-297">Passez l'objet <xref:Microsoft.SqlServer.Replication.MergePartition> créé à l'étape 6.</span><span class="sxs-lookup"><span data-stu-id="6289c-297">Pass the <xref:Microsoft.SqlServer.Replication.MergePartition> object from step 6.</span></span>  
  
10. <span data-ttu-id="6289c-298">Utilisez l'instance de <xref:Microsoft.SqlServer.Replication.MergePublication> de l'étape 1 pour appeler la méthode <xref:Microsoft.SqlServer.Replication.MergePublication.AddMergeDynamicSnapshotJob%2A> .</span><span class="sxs-lookup"><span data-stu-id="6289c-298">Using the instance of <xref:Microsoft.SqlServer.Replication.MergePublication> from step 1, call the <xref:Microsoft.SqlServer.Replication.MergePublication.AddMergeDynamicSnapshotJob%2A> method.</span></span> <span data-ttu-id="6289c-299">Passez l'objet <xref:Microsoft.SqlServer.Replication.MergeDynamicSnapshotJob> créé à l'étape 7 et l'objet <xref:Microsoft.SqlServer.Replication.ReplicationAgentSchedule> créé à l'étape 8.</span><span class="sxs-lookup"><span data-stu-id="6289c-299">Pass the <xref:Microsoft.SqlServer.Replication.MergeDynamicSnapshotJob> object from step 7 and the <xref:Microsoft.SqlServer.Replication.ReplicationAgentSchedule> object from step 8.</span></span>  
  
11. <span data-ttu-id="6289c-300">Appelez <xref:Microsoft.SqlServer.Replication.MergePublication.EnumMergeDynamicSnapshotJobs%2A>et localisez l'objet <xref:Microsoft.SqlServer.Replication.MergeDynamicSnapshotJob> correspondant au travail d'instantané partitionné nouvellement ajouté dans le tableau retourné.</span><span class="sxs-lookup"><span data-stu-id="6289c-300">Call <xref:Microsoft.SqlServer.Replication.MergePublication.EnumMergeDynamicSnapshotJobs%2A>, and locate the <xref:Microsoft.SqlServer.Replication.MergeDynamicSnapshotJob> object for the newly added partitioned snapshot job in the returned array.</span></span>  
  
12. <span data-ttu-id="6289c-301">Obtenez la propriété <xref:Microsoft.SqlServer.Replication.MergeDynamicSnapshotJob.Name%2A> pour le travail.</span><span class="sxs-lookup"><span data-stu-id="6289c-301">Get the <xref:Microsoft.SqlServer.Replication.MergeDynamicSnapshotJob.Name%2A> property for the job.</span></span>  
  
13. <span data-ttu-id="6289c-302">Créez une connexion au serveur de distribution en utilisant la classe <xref:Microsoft.SqlServer.Management.Common.ServerConnection> .</span><span class="sxs-lookup"><span data-stu-id="6289c-302">Create a connection to the Distributor by using the <xref:Microsoft.SqlServer.Management.Common.ServerConnection> class.</span></span>  
  
14. <span data-ttu-id="6289c-303">Créez une instance de la classe <xref:Microsoft.SqlServer.Management.Smo.Server> SMO (SQL Server Management Objects), en passant l'objet <xref:Microsoft.SqlServer.Management.Common.ServerConnection> créé à l'étape 13.</span><span class="sxs-lookup"><span data-stu-id="6289c-303">Create an instance of the SQL Server Management Objects (SMO) <xref:Microsoft.SqlServer.Management.Smo.Server> class, passing the <xref:Microsoft.SqlServer.Management.Common.ServerConnection> object from step 13.</span></span>  
  
15. <span data-ttu-id="6289c-304">Créez une instance de la classe <xref:Microsoft.SqlServer.Management.Smo.Agent.Job> , en passant la propriété <xref:Microsoft.SqlServer.Management.Smo.Server.JobServer%2A> de l'objet <xref:Microsoft.SqlServer.Management.Smo.Server> créé à l'étape 14 et le nom du travail obtenu à l'étape 12.</span><span class="sxs-lookup"><span data-stu-id="6289c-304">Create an instance of the <xref:Microsoft.SqlServer.Management.Smo.Agent.Job> class, passing the <xref:Microsoft.SqlServer.Management.Smo.Server.JobServer%2A> property of the <xref:Microsoft.SqlServer.Management.Smo.Server> object from step 14 and the job name from step 12.</span></span>  
  
16. <span data-ttu-id="6289c-305">Appelez la méthode <xref:Microsoft.SqlServer.Management.Smo.Agent.Job.Start%2A> pour démarrer le travail d'instantané partitionné.</span><span class="sxs-lookup"><span data-stu-id="6289c-305">Call the <xref:Microsoft.SqlServer.Management.Smo.Agent.Job.Start%2A> method to start the partitioned snapshot job.</span></span>  
  
17. <span data-ttu-id="6289c-306">Répétez les étapes 6 à 16 pour chaque Abonné.</span><span class="sxs-lookup"><span data-stu-id="6289c-306">Repeat steps 6-16 for each Subscriber.</span></span>  
  
#### <a name="to-create-a-publication-and-manually-create-snapshots-for-each-partition"></a><span data-ttu-id="6289c-307">Pour créer une publication et créer manuellement des instantanés pour chaque partition</span><span class="sxs-lookup"><span data-stu-id="6289c-307">To create a publication and manually create snapshots for each partition</span></span>  
  
1.  <span data-ttu-id="6289c-308">Utilisez une instance de la classe <xref:Microsoft.SqlServer.Replication.MergePublication> pour définir une publication de fusion.</span><span class="sxs-lookup"><span data-stu-id="6289c-308">Use an instance of the <xref:Microsoft.SqlServer.Replication.MergePublication> class to define a merge publication.</span></span> <span data-ttu-id="6289c-309">Pour plus d’informations, voir [Create a Publication](publish/create-a-publication.md).</span><span class="sxs-lookup"><span data-stu-id="6289c-309">For more information, see [Create a Publication](publish/create-a-publication.md).</span></span>  
  
2.  <span data-ttu-id="6289c-310">Utilisez la propriété <xref:Microsoft.SqlServer.Replication.MergeArticle> pour ajouter des articles à la publication. Spécifiez la propriété <xref:Microsoft.SqlServer.Replication.MergeArticle.FilterClause%2A> pour au moins un article qui définit le filtre paramétrable et créez tous les objets <xref:Microsoft.SqlServer.Replication.MergeJoinFilter> qui définissent les filtres de jointure entre les articles.</span><span class="sxs-lookup"><span data-stu-id="6289c-310">Use the <xref:Microsoft.SqlServer.Replication.MergeArticle> property to add articles to the publication Specify the <xref:Microsoft.SqlServer.Replication.MergeArticle.FilterClause%2A> property for at least one article that defines the parameterized filter, and create any <xref:Microsoft.SqlServer.Replication.MergeJoinFilter> objects that define join filters between articles.</span></span> <span data-ttu-id="6289c-311">Pour plus d’informations, consultez [définir un Article](publish/define-an-article.md).</span><span class="sxs-lookup"><span data-stu-id="6289c-311">For more information, see [Define an Article](publish/define-an-article.md).</span></span>  
  
3.  <span data-ttu-id="6289c-312">Générez l'instantané initial.</span><span class="sxs-lookup"><span data-stu-id="6289c-312">Generate the initial snapshot.</span></span> <span data-ttu-id="6289c-313">Pour plus d’informations, voir [Create and Apply the Initial Snapshot](create-and-apply-the-initial-snapshot.md).</span><span class="sxs-lookup"><span data-stu-id="6289c-313">For more information, see [Create and Apply the Initial Snapshot](create-and-apply-the-initial-snapshot.md).</span></span>  
  
4.  <span data-ttu-id="6289c-314">Créez une instance de la classe <xref:Microsoft.SqlServer.Replication.SnapshotGenerationAgent> et définissez les propriétés requises suivantes :</span><span class="sxs-lookup"><span data-stu-id="6289c-314">Create an instance of the <xref:Microsoft.SqlServer.Replication.SnapshotGenerationAgent> class, and set the following required properties:</span></span>  
  
    -   <span data-ttu-id="6289c-315"><xref:Microsoft.SqlServer.Replication.SnapshotGenerationAgent.Publisher%2A> – nom du serveur de publication</span><span class="sxs-lookup"><span data-stu-id="6289c-315"><xref:Microsoft.SqlServer.Replication.SnapshotGenerationAgent.Publisher%2A> - name of the Publisher</span></span>  
  
    -   <span data-ttu-id="6289c-316"><xref:Microsoft.SqlServer.Replication.SnapshotGenerationAgent.PublisherDatabase%2A> – nom de la base de données de publication</span><span class="sxs-lookup"><span data-stu-id="6289c-316"><xref:Microsoft.SqlServer.Replication.SnapshotGenerationAgent.PublisherDatabase%2A> - name of the publication database</span></span>  
  
    -   <span data-ttu-id="6289c-317"><xref:Microsoft.SqlServer.Replication.SnapshotGenerationAgent.Publication%2A> – nom de la publication</span><span class="sxs-lookup"><span data-stu-id="6289c-317"><xref:Microsoft.SqlServer.Replication.SnapshotGenerationAgent.Publication%2A> - name of the publication</span></span>  
  
    -   <span data-ttu-id="6289c-318"><xref:Microsoft.SqlServer.Replication.SnapshotGenerationAgent.Distributor%2A> – nom du serveur de distribution</span><span class="sxs-lookup"><span data-stu-id="6289c-318"><xref:Microsoft.SqlServer.Replication.SnapshotGenerationAgent.Distributor%2A> - name of the Distributor</span></span>  
  
    -   <span data-ttu-id="6289c-319"><xref:Microsoft.SqlServer.Replication.SnapshotGenerationAgent.PublisherSecurityMode%2A> – valeur <xref:Microsoft.SqlServer.Replication.SecurityMode.Integrated> pour utiliser l'authentification intégrée de Windows ou valeur <xref:Microsoft.SqlServer.Replication.SecurityMode.Standard> pour utiliser l'authentification SQL Server.</span><span class="sxs-lookup"><span data-stu-id="6289c-319"><xref:Microsoft.SqlServer.Replication.SnapshotGenerationAgent.PublisherSecurityMode%2A> - a value of <xref:Microsoft.SqlServer.Replication.SecurityMode.Integrated> to used Windows Integrated Authentication or a value of <xref:Microsoft.SqlServer.Replication.SecurityMode.Standard> to use SQL Server Authentication.</span></span>  
  
    -   <span data-ttu-id="6289c-320"><xref:Microsoft.SqlServer.Replication.SnapshotGenerationAgent.DistributorSecurityMode%2A> – valeur <xref:Microsoft.SqlServer.Replication.SecurityMode.Integrated> pour utiliser l'authentification intégrée de Windows ou valeur <xref:Microsoft.SqlServer.Replication.SecurityMode.Standard> pour utiliser l'authentification SQL Server.</span><span class="sxs-lookup"><span data-stu-id="6289c-320"><xref:Microsoft.SqlServer.Replication.SnapshotGenerationAgent.DistributorSecurityMode%2A> - a value of <xref:Microsoft.SqlServer.Replication.SecurityMode.Integrated> to used Windows Integrated Authentication or a value of <xref:Microsoft.SqlServer.Replication.SecurityMode.Standard> to use SQL Server Authentication.</span></span>  
  
5.  <span data-ttu-id="6289c-321">Spécifiez la valeur <xref:Microsoft.SqlServer.Replication.ReplicationType.Merge> pour <xref:Microsoft.SqlServer.Replication.SnapshotGenerationAgent.ReplicationType%2A>.</span><span class="sxs-lookup"><span data-stu-id="6289c-321">Set a value of <xref:Microsoft.SqlServer.Replication.ReplicationType.Merge> for <xref:Microsoft.SqlServer.Replication.SnapshotGenerationAgent.ReplicationType%2A>.</span></span>  
  
6.  <span data-ttu-id="6289c-322">Définissez une ou plusieurs des propriétés suivantes pour définir les paramètres de partitionnement :</span><span class="sxs-lookup"><span data-stu-id="6289c-322">Set one or more of the following properties to define the partitioning parameters:</span></span>  
  
    -   <span data-ttu-id="6289c-323">Si la partition de l’Abonné est définie par le résultat de [SUSER_SNAME &#40;Transact-SQL&#41;](/sql/t-sql/functions/suser-sname-transact-sql), utilisez <xref:Microsoft.SqlServer.Replication.SnapshotGenerationAgent.DynamicFilterLogin%2A>.</span><span class="sxs-lookup"><span data-stu-id="6289c-323">If the Subscriber's partition is defined by the result of [SUSER_SNAME &#40;Transact-SQL&#41;](/sql/t-sql/functions/suser-sname-transact-sql), use <xref:Microsoft.SqlServer.Replication.SnapshotGenerationAgent.DynamicFilterLogin%2A>.</span></span>  
  
    -   <span data-ttu-id="6289c-324">Si la partition de l’Abonné est définie par le résultat de [HOST_NAME &#40;Transact-SQL&#41;](/sql/t-sql/functions/host-name-transact-sql) ou une surcharge de cette fonction, utilisez <xref:Microsoft.SqlServer.Replication.SnapshotGenerationAgent.DynamicFilterHostName%2A>.</span><span class="sxs-lookup"><span data-stu-id="6289c-324">If the Subscriber's partition is defined by the result of [HOST_NAME &#40;Transact-SQL&#41;](/sql/t-sql/functions/host-name-transact-sql) or an overload of this function, use <xref:Microsoft.SqlServer.Replication.SnapshotGenerationAgent.DynamicFilterHostName%2A>.</span></span>  
  
7.  <span data-ttu-id="6289c-325">Appelez la méthode <xref:Microsoft.SqlServer.Replication.SnapshotGenerationAgent.GenerateSnapshot%2A> .</span><span class="sxs-lookup"><span data-stu-id="6289c-325">Call the <xref:Microsoft.SqlServer.Replication.SnapshotGenerationAgent.GenerateSnapshot%2A> method.</span></span>  
  
8.  <span data-ttu-id="6289c-326">Répétez les étapes 4 à 7 pour chaque Abonné.</span><span class="sxs-lookup"><span data-stu-id="6289c-326">Repeat steps 4-7 for each Subscriber.</span></span>  
  
###  <a name="examples-rmo"></a><a name="PShellExample"></a> <span data-ttu-id="6289c-327">Exemples (RMO)</span><span class="sxs-lookup"><span data-stu-id="6289c-327">Examples (RMO)</span></span>  
 <span data-ttu-id="6289c-328">Cet exemple crée une publication de fusion qui permet aux Abonnés de demander la génération d'instantanés.</span><span class="sxs-lookup"><span data-stu-id="6289c-328">This example creates a merge publication that allows Subscribers to requested snapshot generation.</span></span>  
  
 [!code-csharp[HowTo#rmo_CreateMergePub](../../snippets/csharp/SQL15/replication/howto/cs/rmotestevelope.cs#rmo_createmergepub)]  
  
 [!code-vb[HowTo#rmo_vb_CreateMergePub](../../snippets/visualbasic/SQL15/replication/howto/vb/rmotestenv.vb#rmo_vb_createmergepub)]  
  
 <span data-ttu-id="6289c-329">Cet exemple crée manuellement la partition de l'Abonné et l'instantané filtré pour une publication de fusion avec des filtres de lignes paramétrables.</span><span class="sxs-lookup"><span data-stu-id="6289c-329">This example manually creates the Subscriber partition and the filtered snapshot for a merge publication with parameterized row filters.</span></span>  
  
 [!code-csharp[HowTo#rmo_CreateMergePartition](../../snippets/csharp/SQL15/replication/howto/cs/rmotestevelope.cs#rmo_createmergepartition)]  
  
 [!code-vb[HowTo#rmo_vb_CreateMergePartition](../../snippets/visualbasic/SQL15/replication/howto/vb/rmotestenv.vb#rmo_vb_createmergepartition)]  
  
 <span data-ttu-id="6289c-330">Cet exemple lance manuellement l'Agent d'instantané pour qu'il génère l'instantané des données filtrées pour un Abonné à une publication de fusion avec des filtres de lignes paramétrables.</span><span class="sxs-lookup"><span data-stu-id="6289c-330">This example manually starts the Snapshot Agent to generate the filtered data snapshot for a Subscriber to a merge publication with parameterized row filters.</span></span>  
  
 [!code-csharp[HowTo#rmo_GenerateFilteredSnapshot](../../snippets/csharp/SQL15/replication/howto/cs/rmotestevelope.cs#rmo_generatefilteredsnapshot)]  
  
 [!code-vb[HowTo#rmo_vb_GenerateFilteredSnapshot](../../snippets/visualbasic/SQL15/replication/howto/vb/rmotestenv.vb#rmo_vb_generatefilteredsnapshot)]  
  
## <a name="see-also"></a><span data-ttu-id="6289c-331">Voir aussi</span><span class="sxs-lookup"><span data-stu-id="6289c-331">See Also</span></span>  
 <span data-ttu-id="6289c-332">[Filtres de lignes paramétrés](merge/parameterized-filters-parameterized-row-filters.md) </span><span class="sxs-lookup"><span data-stu-id="6289c-332">[Parameterized Row Filters](merge/parameterized-filters-parameterized-row-filters.md) </span></span>  
 <span data-ttu-id="6289c-333">[Concepts liés aux procédures stockées système de réplication](concepts/replication-system-stored-procedures-concepts.md) </span><span class="sxs-lookup"><span data-stu-id="6289c-333">[Replication System Stored Procedures Concepts](concepts/replication-system-stored-procedures-concepts.md) </span></span>  
 <span data-ttu-id="6289c-334">[Instantanés pour les publications de fusion avec des filtres paramétrés](snapshots-for-merge-publications-with-parameterized-filters.md) </span><span class="sxs-lookup"><span data-stu-id="6289c-334">[Snapshots for Merge Publications with Parameterized Filters](snapshots-for-merge-publications-with-parameterized-filters.md) </span></span>  
 [<span data-ttu-id="6289c-335">Bonnes pratiques en matière de sécurité de la réplication</span><span class="sxs-lookup"><span data-stu-id="6289c-335">Replication Security Best Practices</span></span>](security/replication-security-best-practices.md)  
  
  
