---
title: Mesurer la latence et valider les connexions pour la réplication transactionnelle | Microsoft Docs
ms.custom: ''
ms.date: 06/13/2017
ms.prod: sql-server-2014
ms.reviewer: ''
ms.technology: replication
ms.topic: conceptual
helpviewer_keywords:
- Replication Monitor, performance
- tracer tokens [SQL Server replication]
- latency [SQL Server replication]
- transactional replication, tracer tokens
- monitoring performance [SQL Server replication], tracer tokens
ms.assetid: 4addd426-7523-4067-8d7d-ca6bae4c9e34
author: MashaMSFT
ms.author: mathoma
ms.openlocfilehash: 3ba1e5eddfdcffa5fbefdea323f110ba9d15ca8c
ms.sourcegitcommit: ad4d92dce894592a259721a1571b1d8736abacdb
ms.translationtype: MT
ms.contentlocale: fr-FR
ms.lasthandoff: 08/04/2020
ms.locfileid: "87603389"
---
# <a name="measure-latency-and-validate-connections-for-transactional-replication"></a><span data-ttu-id="53314-102">Mesurer la latence et valider les connexions pour la réplication transactionnelle</span><span class="sxs-lookup"><span data-stu-id="53314-102">Measure Latency and Validate Connections for Transactional Replication</span></span>
  <span data-ttu-id="53314-103">Cette rubrique explique comment mesurer la latence et valider les connexions pour la réplication transactionnelle dans [!INCLUDE[ssCurrent](../../../includes/sscurrent-md.md)] à l'aide du Moniteur de réplication, de [!INCLUDE[tsql](../../../includes/tsql-md.md)]ou d'objets RMO (Replication Management Objects).</span><span class="sxs-lookup"><span data-stu-id="53314-103">This topic describes how to measure latency and validate connections for transactional replication in [!INCLUDE[ssCurrent](../../../includes/sscurrent-md.md)] by using Replication Monitor, [!INCLUDE[tsql](../../../includes/tsql-md.md)], or Replication Management Objects (RMO).</span></span> <span data-ttu-id="53314-104">La réplication transactionnelle offre la fonctionnalité de jeton de suivi, moyen facile de mesurer la latence dans les topologies de réplication transactionnelle et de valider les connexions entre le serveur de publication, le serveur de distribution et les Abonnés.</span><span class="sxs-lookup"><span data-stu-id="53314-104">Transactional replication provides the tracer token feature, which provides a convenient way to measure latency in transactional replication topologies and to validate the connections between the Publisher, Distributor and Subscribers.</span></span> <span data-ttu-id="53314-105">Un jeton (une petite quantité de données) est écrit dans le journal des transactions de la base de données de publication et est marqué comme s'il s'agissait d'une transaction standard répliquée, puis est envoyé dans le système, permettant ainsi le calcul :</span><span class="sxs-lookup"><span data-stu-id="53314-105">A token (a small amount of data) is written to the transaction log of the publication database, marked as though it were a typical replicated transaction, and sent through the system, allowing a calculation of:</span></span>  
  
-   <span data-ttu-id="53314-106">du temps écoulé entre la validation d'une transaction par le serveur de publication et l'insertion de la commande qui en découle dans la base de données de distribution sur le serveur de distribution ;</span><span class="sxs-lookup"><span data-stu-id="53314-106">How much time elapses between a transaction being committed at the Publisher and the corresponding command being inserted in the distribution database at the Distributor.</span></span>  
  
-   <span data-ttu-id="53314-107">du temps écoulé entre l'insertion d'une commande dans la base de données de distribution et la validation de la transaction qui en découle au niveau d'un Abonné.</span><span class="sxs-lookup"><span data-stu-id="53314-107">How much time elapses between a command being inserted in the distribution database and the corresponding transaction being committed at a Subscriber.</span></span>  
  
 <span data-ttu-id="53314-108">De par ces calculs, vous pouvez ainsi répondre à diverses questions, notamment :</span><span class="sxs-lookup"><span data-stu-id="53314-108">From these calculations, you can answer a number of questions, including:</span></span>  
  
-   <span data-ttu-id="53314-109">Quels Abonnés mettent le plus longtemps à recevoir une modification du serveur de publication ?</span><span class="sxs-lookup"><span data-stu-id="53314-109">Which Subscribers take the longest to receive a change from the Publisher?</span></span>  
  
-   <span data-ttu-id="53314-110">De l'ensemble des Abonnés prévus pour recevoir le jeton de suivi, lesquels, le cas échéant, ne l'ont pas reçu ?</span><span class="sxs-lookup"><span data-stu-id="53314-110">Of the Subscribers expected to receive the tracer token, which, if any, have not received it?</span></span>  
  
 <span data-ttu-id="53314-111">**Dans cette rubrique**</span><span class="sxs-lookup"><span data-stu-id="53314-111">**In This Topic**</span></span>  
  
-   <span data-ttu-id="53314-112">**Avant de commencer :**</span><span class="sxs-lookup"><span data-stu-id="53314-112">**Before you begin:**</span></span>  
  
     [<span data-ttu-id="53314-113">Limitations et restrictions</span><span class="sxs-lookup"><span data-stu-id="53314-113">Limitations and Restrictions</span></span>](#Restrictions)  
  
-   <span data-ttu-id="53314-114">**Pour mesurer la latence et valider les connexions à l'aide de :**</span><span class="sxs-lookup"><span data-stu-id="53314-114">**To measure latency and validate connections, using:**</span></span>  
  
     [<span data-ttu-id="53314-115">Moniteur de réplication de SQL Server</span><span class="sxs-lookup"><span data-stu-id="53314-115">SQL Server Replication Monitor</span></span>](#SSMSProcedure)  
  
     [<span data-ttu-id="53314-116">Transact-SQL</span><span class="sxs-lookup"><span data-stu-id="53314-116">Transact-SQL</span></span>](#TsqlProcedure)  
  
     [<span data-ttu-id="53314-117">Replication Management Objects</span><span class="sxs-lookup"><span data-stu-id="53314-117">Replication Management Objects</span></span>](#RMOProcedure)  
  
##  <a name="before-you-begin"></a><a name="BeforeYouBegin"></a> <span data-ttu-id="53314-118">Avant de commencer</span><span class="sxs-lookup"><span data-stu-id="53314-118">Before You Begin</span></span>  
  
###  <a name="limitations-and-restrictions"></a><a name="Restrictions"></a> <span data-ttu-id="53314-119">Limitations et restrictions</span><span class="sxs-lookup"><span data-stu-id="53314-119">Limitations and Restrictions</span></span>  
 <span data-ttu-id="53314-120">Les jetons de suivi peuvent également être utiles lors de la suspension d'un système, qui consiste à arrêter toute l'activité pour vérifier que tous les nœuds ont reçu les changements en cours.</span><span class="sxs-lookup"><span data-stu-id="53314-120">Tracer tokens can also be useful when quiescing a system, which involves stopping all activity and verifying that all nodes have received all outstanding changes.</span></span> <span data-ttu-id="53314-121">Pour plus d’informations, consultez [Suspendre une topologie de réplication &#40;programmation Transact-SQL de la réplication&#41;](../administration/quiesce-a-replication-topology-replication-transact-sql-programming.md).</span><span class="sxs-lookup"><span data-stu-id="53314-121">For more information, see [Quiesce a Replication Topology &#40;Replication Transact-SQL Programming&#41;](../administration/quiesce-a-replication-topology-replication-transact-sql-programming.md).</span></span>  
  
 <span data-ttu-id="53314-122">Pour utiliser des jetons de suivi, vous devez utiliser certaines versions de [!INCLUDE[msCoName](../../../includes/msconame-md.md)] [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] :</span><span class="sxs-lookup"><span data-stu-id="53314-122">To use tracer tokens, you must use certain versions of [!INCLUDE[msCoName](../../../includes/msconame-md.md)] [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)]:</span></span>  
  
-   <span data-ttu-id="53314-123">Le serveur de distribution doit être [!INCLUDE[msCoName](../../../includes/msconame-md.md)] [!INCLUDE[ssVersion2005](../../../includes/ssversion2005-md.md)] ou version ultérieure.</span><span class="sxs-lookup"><span data-stu-id="53314-123">The Distributor must be [!INCLUDE[msCoName](../../../includes/msconame-md.md)] [!INCLUDE[ssVersion2005](../../../includes/ssversion2005-md.md)] or later.</span></span>  
  
-   <span data-ttu-id="53314-124">Le serveur de publication doit être [!INCLUDE[ssVersion2005](../../../includes/ssversion2005-md.md)] ou version ultérieure, ou un serveur de publication Oracle.</span><span class="sxs-lookup"><span data-stu-id="53314-124">The Publisher must be [!INCLUDE[ssVersion2005](../../../includes/ssversion2005-md.md)] or later or be an Oracle Publisher.</span></span>  
  
-   <span data-ttu-id="53314-125">Pour les abonnements par envoi de données, les statistiques de jeton de suivi sont collectées à partir du serveur de publication, du serveur de distribution et des abonnés si l’abonné est [!INCLUDE[msCoName](../../../includes/msconame-md.md)] [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] 7,0 ou version ultérieure.</span><span class="sxs-lookup"><span data-stu-id="53314-125">For push subscriptions, tracer token statistics are gathered from the Publisher, Distributor, and Subscribers if the Subscriber is [!INCLUDE[msCoName](../../../includes/msconame-md.md)] [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] 7.0 or later.</span></span>  
  
-   <span data-ttu-id="53314-126">Pour les abonnements par extraction de données, les statistiques de jetons de suivi sont rassemblées uniquement à partir des Abonnés si l'Abonné exécute [!INCLUDE[ssVersion2005](../../../includes/ssversion2005-md.md)] 7.0 ou version ultérieure.</span><span class="sxs-lookup"><span data-stu-id="53314-126">For pull subscriptions, tracer token statistics are gathered from Subscribers only if the Subscriber is [!INCLUDE[ssVersion2005](../../../includes/ssversion2005-md.md)] or later.</span></span> <span data-ttu-id="53314-127">Si l’abonné est [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] 7,0 ou [!INCLUDE[msCoName](../../../includes/msconame-md.md)] [!INCLUDE[ssVersion2000](../../../includes/ssversion2000-md.md)] , les statistiques sont rassemblées uniquement à partir du serveur de publication et du serveur de distribution.</span><span class="sxs-lookup"><span data-stu-id="53314-127">If the Subscriber is [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] 7.0 or [!INCLUDE[msCoName](../../../includes/msconame-md.md)] [!INCLUDE[ssVersion2000](../../../includes/ssversion2000-md.md)], statistics are gathered only from the Publisher and Distributor.</span></span>  
  
 <span data-ttu-id="53314-128">Il existe aussi d'autres problèmes et restrictions à connaître :</span><span class="sxs-lookup"><span data-stu-id="53314-128">There are also a number of other issues and restrictions to be aware of:</span></span>  
  
-   <span data-ttu-id="53314-129">Les abonnements doivent être actifs pour recevoir un jeton de suivi.</span><span class="sxs-lookup"><span data-stu-id="53314-129">Subscriptions must be active to receive a tracer token.</span></span> <span data-ttu-id="53314-130">Un abonnement est actif s'il a été initialisé.</span><span class="sxs-lookup"><span data-stu-id="53314-130">A subscription is active if it has been initialized.</span></span>  
  
-   <span data-ttu-id="53314-131">La réinitialisation supprime tout jeton de suivi en suspens pour les abonnements concernés.</span><span class="sxs-lookup"><span data-stu-id="53314-131">Reinitialization removes any pending tracer tokens for the relevant subscriptions.</span></span>  
  
-   <span data-ttu-id="53314-132">Les Abonnés ne reçoivent que les jetons de suivi créés après leur première synchronisation.</span><span class="sxs-lookup"><span data-stu-id="53314-132">Subscribers only receive tracer tokens that were created after their initial synchronization.</span></span>  
  
-   <span data-ttu-id="53314-133">Les jetons de suivi ne sont pas retransmis par les Abonnés qui republient.</span><span class="sxs-lookup"><span data-stu-id="53314-133">Tracer tokens are not forwarded by republishing Subscribers.</span></span>  
  
-   <span data-ttu-id="53314-134">Après un basculement vers un réplica secondaire, le Moniteur de réplication ne peut pas ajuster le nom de l'instance de publication de [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] et continue à afficher les informations de réplication sous le nom de l'instance principale [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)]d'origine.</span><span class="sxs-lookup"><span data-stu-id="53314-134">After failover to a secondary, Replication Monitor is unable to adjust the name of the publishing instance of [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] and will continue to display replication information under the name of the original primary instance of [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)].</span></span> <span data-ttu-id="53314-135">Après le basculement, un jeton de suivi ne peut pas être écrit à l'aide du Moniteur de réplication, toutefois un jeton de suivi écrit sur le nouveau serveur de publication à l'aide de [!INCLUDE[tsql](../../../includes/tsql-md.md)]est visible dans le Moniteur de réplication.</span><span class="sxs-lookup"><span data-stu-id="53314-135">After failover, a tracer token cannot be entered by using the Replication Monitor, however a tracer token entered on the new publisher by using [!INCLUDE[tsql](../../../includes/tsql-md.md)], is visible in Replication Monitor.</span></span>  
  
##  <a name="using-sql-server-replication-monitor"></a><a name="SSMSProcedure"></a><span data-ttu-id="53314-136">Utilisation de Réplication SQL Server Monitor</span><span class="sxs-lookup"><span data-stu-id="53314-136">Using SQL Server Replication Monitor</span></span>  
 <span data-ttu-id="53314-137">Pour plus d’informations sur le démarrage du Moniteur de réplication, consultez [Démarrer le Moniteur de réplication](start-the-replication-monitor.md).</span><span class="sxs-lookup"><span data-stu-id="53314-137">For information about starting Replication Monitor, see [Start the Replication Monitor](start-the-replication-monitor.md).</span></span>  
  
#### <a name="to-insert-a-tracer-token-and-view-information-on-the-token"></a><span data-ttu-id="53314-138">Pour insérer un jeton de suivi et afficher des informations sur le jeton</span><span class="sxs-lookup"><span data-stu-id="53314-138">To insert a tracer token and view information on the token</span></span>  
  
1.  <span data-ttu-id="53314-139">Développez un groupe de serveurs de publication dans le volet gauche, développez un serveur de publication, puis cliquez sur une publication.</span><span class="sxs-lookup"><span data-stu-id="53314-139">Expand a Publisher group in the left pane, expand a Publisher, and then click a publication.</span></span>  
  
2.  <span data-ttu-id="53314-140">Cliquez sur l'onglet **Jetons de suivi** .</span><span class="sxs-lookup"><span data-stu-id="53314-140">Click the **Tracer Tokens** tab.</span></span>  
  
3.  <span data-ttu-id="53314-141">Cliquez sur **Insérer un suivi**.</span><span class="sxs-lookup"><span data-stu-id="53314-141">Click **Insert Tracer**.</span></span>  
  
4.  <span data-ttu-id="53314-142">Affichez le temps écoulé pour le jeton de suivi dans les colonnes suivantes : **Du serveur de publication vers le serveur de distribution**, **Du serveur de distribution vers l'Abonné**et **Latence totale**.</span><span class="sxs-lookup"><span data-stu-id="53314-142">View elapsed time for the tracer token in the following columns: **Publisher to Distributor**, **Distributor to Subscriber**, **Total Latency**.</span></span> <span data-ttu-id="53314-143">La valeur **en attente** indique que le jeton n’a pas atteint un point donné.</span><span class="sxs-lookup"><span data-stu-id="53314-143">A value of **Pending** indicates that the token has not reached a given point.</span></span>  
  
#### <a name="to-view-information-on-a-tracer-token-inserted-previously"></a><span data-ttu-id="53314-144">Pour afficher les informations d'un jeton de suivi inséré précédemment</span><span class="sxs-lookup"><span data-stu-id="53314-144">To view information on a tracer token inserted previously</span></span>  
  
1.  <span data-ttu-id="53314-145">Développez un groupe de serveurs de publication dans le volet gauche, développez un serveur de publication, puis cliquez sur une publication.</span><span class="sxs-lookup"><span data-stu-id="53314-145">Expand a Publisher group in the left pane, expand a Publisher, and then click a publication.</span></span>  
  
2.  <span data-ttu-id="53314-146">Cliquez sur l'onglet **Jetons de suivi** .</span><span class="sxs-lookup"><span data-stu-id="53314-146">Click the **Tracer Tokens** tab.</span></span>  
  
3.  <span data-ttu-id="53314-147">Sélectionnez une heure dans la liste déroulante **Heure de l'insertion** .</span><span class="sxs-lookup"><span data-stu-id="53314-147">Select a time from the **Time inserted** drop-down list.</span></span>  
  
4.  <span data-ttu-id="53314-148">Affichez le temps écoulé pour le jeton de suivi dans les colonnes suivantes : **Du serveur de publication vers le serveur de distribution**, **Du serveur de distribution vers l'Abonné**et **Latence totale**.</span><span class="sxs-lookup"><span data-stu-id="53314-148">View elapsed time for the tracer token in the following columns: **Publisher to Distributor**, **Distributor to Subscriber**, **Total Latency**.</span></span> <span data-ttu-id="53314-149">La valeur **en attente** indique que le jeton n’a pas atteint un point donné.</span><span class="sxs-lookup"><span data-stu-id="53314-149">A value of **Pending** indicates that the token has not reached a given point.</span></span>  
  
    > [!NOTE]  
    >  <span data-ttu-id="53314-150">Les informations de jeton de suivi sont conservées pour la même durée que toute autre donnée d'historique, elles-mêmes étant régies par la période de rétention des historiques définie dans la base de données de distribution.</span><span class="sxs-lookup"><span data-stu-id="53314-150">Tracer token information is retained for the same time period as other historical data, which is governed by the history retention period of the distribution database.</span></span> <span data-ttu-id="53314-151">Pour plus d’informations sur la modification des propriétés de base de données de distribution, consultez [Afficher et modifier les propriétés d’un serveur de distribution ou d’un serveur de publication](../view-and-modify-distributor-and-publisher-properties.md).</span><span class="sxs-lookup"><span data-stu-id="53314-151">For information about changing distribution database properties, see [View and Modify Distributor and Publisher Properties](../view-and-modify-distributor-and-publisher-properties.md).</span></span>  
  
##  <a name="using-transact-sql"></a><a name="TsqlProcedure"></a> <span data-ttu-id="53314-152">Utilisation de Transact-SQL</span><span class="sxs-lookup"><span data-stu-id="53314-152">Using Transact-SQL</span></span>  
  
#### <a name="to-post-a-tracer-token-to-a-transactional-publication"></a><span data-ttu-id="53314-153">Pour publier un jeton de suivi sur une publication transactionnelle</span><span class="sxs-lookup"><span data-stu-id="53314-153">To post a tracer token to a transactional publication</span></span>  
  
1.  <span data-ttu-id="53314-154">(Facultatif) Dans la base de données de publication sur le serveur de publication, exécutez [sp_helppublication &#40;Transact-SQL&#41;](/sql/relational-databases/system-stored-procedures/sp-helppublication-transact-sql).</span><span class="sxs-lookup"><span data-stu-id="53314-154">(Optional) At the Publisher on the publication database, execute [sp_helppublication &#40;Transact-SQL&#41;](/sql/relational-databases/system-stored-procedures/sp-helppublication-transact-sql).</span></span> <span data-ttu-id="53314-155">Vérifiez que la publication existe et que l'état est actif.</span><span class="sxs-lookup"><span data-stu-id="53314-155">Verify that the publication exists and that the status is active.</span></span>  
  
2.  <span data-ttu-id="53314-156">(Facultatif) Dans la base de données de publication sur le serveur de publication, exécutez [sp_helpsubscription &#40;Transact-SQL&#41;](/sql/relational-databases/system-stored-procedures/sp-helpsubscription-transact-sql).</span><span class="sxs-lookup"><span data-stu-id="53314-156">(Optional) At the Publisher on the publication database, execute [sp_helpsubscription &#40;Transact-SQL&#41;](/sql/relational-databases/system-stored-procedures/sp-helpsubscription-transact-sql).</span></span> <span data-ttu-id="53314-157">Vérifiez que l'abonnement existe et que l'état est actif.</span><span class="sxs-lookup"><span data-stu-id="53314-157">Verify that the subscription exists and that the status is active.</span></span>  
  
3.  <span data-ttu-id="53314-158">Dans la base de données de publication sur le serveur de publication, exécutez [sp_posttracertoken &#40;Transact-SQL&#41;](/sql/relational-databases/system-stored-procedures/sp-posttracertoken-transact-sql), en spécifiant **@publication**.</span><span class="sxs-lookup"><span data-stu-id="53314-158">At the Publisher on the publication database, execute [sp_posttracertoken &#40;Transact-SQL&#41;](/sql/relational-databases/system-stored-procedures/sp-posttracertoken-transact-sql), specifying **@publication**.</span></span> <span data-ttu-id="53314-159">Notez la valeur du **@tracer_token_id** paramètre de sortie.</span><span class="sxs-lookup"><span data-stu-id="53314-159">Note the value of the **@tracer_token_id** output parameter.</span></span>  
  
#### <a name="to-determine-latency-and-validate-connections-for-a-transactional-publication"></a><span data-ttu-id="53314-160">Pour déterminer la latence et valider les connexions d'une publication transactionnelle</span><span class="sxs-lookup"><span data-stu-id="53314-160">To determine latency and validate connections for a transactional publication</span></span>  
  
1.  <span data-ttu-id="53314-161">Publiez un jeton de suivi sur la publication à l'aide de la procédure précédente.</span><span class="sxs-lookup"><span data-stu-id="53314-161">Post a tracer token to the publication using the previous procedure.</span></span>  
  
2.  <span data-ttu-id="53314-162">Dans la base de données de publication sur le serveur de publication, exécutez [sp_helptracertokens &#40;Transact-SQL&#41;](/sql/relational-databases/system-stored-procedures/sp-helptracertokens-transact-sql), en spécifiant **@publication**.</span><span class="sxs-lookup"><span data-stu-id="53314-162">At the Publisher on the publication database, execute [sp_helptracertokens &#40;Transact-SQL&#41;](/sql/relational-databases/system-stored-procedures/sp-helptracertokens-transact-sql), specifying **@publication**.</span></span> <span data-ttu-id="53314-163">La liste de tous les jetons de suivi publiés sur la publication est ainsi retournée.</span><span class="sxs-lookup"><span data-stu-id="53314-163">This returns a list of all tracer tokens posted to the publication.</span></span> <span data-ttu-id="53314-164">Notez le **tracer_id** désiré dans le jeu de résultats.</span><span class="sxs-lookup"><span data-stu-id="53314-164">Note the desired **tracer_id** in the result set.</span></span>  
  
3.  <span data-ttu-id="53314-165">Dans la base de données de publication sur le serveur de publication, exécutez [sp_helptracertokenhistory &#40;Transact-SQL&#41;](/sql/relational-databases/system-stored-procedures/sp-helptracertokenhistory-transact-sql), en spécifiant **@publication** et l’ID du jeton de suivi obtenu à l’étape 2 pour **@tracer_id**.</span><span class="sxs-lookup"><span data-stu-id="53314-165">At the Publisher on the publication database, execute [sp_helptracertokenhistory &#40;Transact-SQL&#41;](/sql/relational-databases/system-stored-procedures/sp-helptracertokenhistory-transact-sql), specifying **@publication** and the tracer token ID from step 2 for **@tracer_id**.</span></span> <span data-ttu-id="53314-166">Les informations de latence pour le jeton de suivi sélectionné sont ainsi retournées.</span><span class="sxs-lookup"><span data-stu-id="53314-166">This returns latency information for the selected tracer token.</span></span>  
  
#### <a name="to-remove-tracer-tokens"></a><span data-ttu-id="53314-167">Pour supprimer les jetons de suivi</span><span class="sxs-lookup"><span data-stu-id="53314-167">To remove tracer tokens</span></span>  
  
1.  <span data-ttu-id="53314-168">Dans la base de données de publication sur le serveur de publication, exécutez [sp_helptracertokens &#40;Transact-SQL&#41;](/sql/relational-databases/system-stored-procedures/sp-helptracertokens-transact-sql), en spécifiant **@publication**.</span><span class="sxs-lookup"><span data-stu-id="53314-168">At the Publisher on the publication database, execute [sp_helptracertokens &#40;Transact-SQL&#41;](/sql/relational-databases/system-stored-procedures/sp-helptracertokens-transact-sql), specifying **@publication**.</span></span> <span data-ttu-id="53314-169">La liste de tous les jetons de suivi publiés sur la publication est ainsi retournée.</span><span class="sxs-lookup"><span data-stu-id="53314-169">This returns a list of all tracer tokens posted to the publication.</span></span> <span data-ttu-id="53314-170">Notez **tracer_id** pour le jeton de suivi à supprimer dans le jeu de résultats.</span><span class="sxs-lookup"><span data-stu-id="53314-170">Note the **tracer_id** for the tracer token to delete in the result set.</span></span>  
  
2.  <span data-ttu-id="53314-171">Dans la base de données de publication sur le serveur de publication, exécutez [sp_deletetracertokenhistory &#40;Transact-SQL&#41;](/sql/relational-databases/system-stored-procedures/sp-deletetracertokenhistory-transact-sql), en spécifiant **@publication** et l’ID du jeton de suivi à supprimer obtenu à l’étape 2 pour **@tracer_id**.</span><span class="sxs-lookup"><span data-stu-id="53314-171">At the Publisher on the publication database, execute [sp_deletetracertokenhistory &#40;Transact-SQL&#41;](/sql/relational-databases/system-stored-procedures/sp-deletetracertokenhistory-transact-sql), specifying **@publication** and the ID of the tracer to delete from step 2 for **@tracer_id**.</span></span>  
  
###  <a name="example-transact-sql"></a><a name="TsqlExample"></a> <span data-ttu-id="53314-172">Exemple (Transact-SQL)</span><span class="sxs-lookup"><span data-stu-id="53314-172">Example (Transact-SQL)</span></span>  
 <span data-ttu-id="53314-173">Cet exemple publie un enregistrement de jeton de suivi et utilise l'ID retourné du jeton de suivi publié pour consulter les informations de latence.</span><span class="sxs-lookup"><span data-stu-id="53314-173">This example posts a tracer token record and uses the returned ID of the posted tracer token to view latency information.</span></span>  
  
 [!code-sql[HowTo#sp_tracertokens](../../../snippets/tsql/SQL15/replication/howto/tsql/createtracertokens.sql#sp_tracertokens)]  
  
##  <a name="using-replication-management-objects-rmo"></a><a name="RMOProcedure"></a> <span data-ttu-id="53314-174">Utilisation d'objets RMO (Replication Management Objects)</span><span class="sxs-lookup"><span data-stu-id="53314-174">Using Replication Management Objects (RMO)</span></span>  
  
#### <a name="to-post-a-tracer-token-to-a-transactional-publication"></a><span data-ttu-id="53314-175">Pour publier un jeton de suivi sur une publication transactionnelle</span><span class="sxs-lookup"><span data-stu-id="53314-175">To post a tracer token to a transactional publication</span></span>  
  
1.  <span data-ttu-id="53314-176">Créez une connexion au serveur de publication en utilisant la classe <xref:Microsoft.SqlServer.Management.Common.ServerConnection> .</span><span class="sxs-lookup"><span data-stu-id="53314-176">Create a connection to the Publisher by using the <xref:Microsoft.SqlServer.Management.Common.ServerConnection> class.</span></span>  
  
2.  <span data-ttu-id="53314-177">Créez une instance de la classe <xref:Microsoft.SqlServer.Replication.TransPublication>.</span><span class="sxs-lookup"><span data-stu-id="53314-177">Create an instance of the <xref:Microsoft.SqlServer.Replication.TransPublication> class.</span></span>  
  
3.  <span data-ttu-id="53314-178">Définissez les propriétés <xref:Microsoft.SqlServer.Replication.Publication.Name%2A> et <xref:Microsoft.SqlServer.Replication.Publication.DatabaseName%2A> de la publication, et définissez la propriété <xref:Microsoft.SqlServer.Replication.ReplicationObject.ConnectionContext%2A> avec la connexion créée à l'étape 1.</span><span class="sxs-lookup"><span data-stu-id="53314-178">Set the <xref:Microsoft.SqlServer.Replication.Publication.Name%2A> and <xref:Microsoft.SqlServer.Replication.Publication.DatabaseName%2A> properties for the publication, and set the <xref:Microsoft.SqlServer.Replication.ReplicationObject.ConnectionContext%2A> property to the connection created in step 1.</span></span>  
  
4.  <span data-ttu-id="53314-179">Appelez la méthode <xref:Microsoft.SqlServer.Replication.ReplicationObject.LoadProperties%2A> pour obtenir les propriétés de l'objet.</span><span class="sxs-lookup"><span data-stu-id="53314-179">Call the <xref:Microsoft.SqlServer.Replication.ReplicationObject.LoadProperties%2A> method to get the properties of the object.</span></span> <span data-ttu-id="53314-180">Si cette méthode retourne `false`, soit les propriétés de la publication ont été définies de manière incorrecte à l’étape 3, soit la publication n’existe pas.</span><span class="sxs-lookup"><span data-stu-id="53314-180">If this method returns `false`, either the publication properties in step 3 were defined incorrectly or the publication does not exist.</span></span>  
  
5.  <span data-ttu-id="53314-181">Appelez la méthode <xref:Microsoft.SqlServer.Replication.TransPublication.PostTracerToken%2A> .</span><span class="sxs-lookup"><span data-stu-id="53314-181">Call the <xref:Microsoft.SqlServer.Replication.TransPublication.PostTracerToken%2A> method.</span></span> <span data-ttu-id="53314-182">Cette méthode insère un jeton de suivi dans le journal des transactions de la publication.</span><span class="sxs-lookup"><span data-stu-id="53314-182">This method inserts a tracer token into the publication's transaction log.</span></span>  
  
#### <a name="to-determine-latency-and-validate-connections-for-a-transactional-publication"></a><span data-ttu-id="53314-183">Pour déterminer la latence et valider les connexions d'une publication transactionnelle</span><span class="sxs-lookup"><span data-stu-id="53314-183">To determine latency and validate connections for a transactional publication</span></span>  
  
1.  <span data-ttu-id="53314-184">Créez une connexion au serveur de distribution en utilisant la classe <xref:Microsoft.SqlServer.Management.Common.ServerConnection> .</span><span class="sxs-lookup"><span data-stu-id="53314-184">Create a connection to the Distributor by using the <xref:Microsoft.SqlServer.Management.Common.ServerConnection> class.</span></span>  
  
2.  <span data-ttu-id="53314-185">Créez une instance de la classe <xref:Microsoft.SqlServer.Replication.PublicationMonitor>.</span><span class="sxs-lookup"><span data-stu-id="53314-185">Create an instance of the <xref:Microsoft.SqlServer.Replication.PublicationMonitor> class.</span></span>  
  
3.  <span data-ttu-id="53314-186">Définissez les propriétés <xref:Microsoft.SqlServer.Replication.PublicationMonitor.Name%2A>, <xref:Microsoft.SqlServer.Replication.PublicationMonitor.DistributionDBName%2A>, <xref:Microsoft.SqlServer.Replication.PublicationMonitor.PublisherName%2A>, et <xref:Microsoft.SqlServer.Replication.PublicationMonitor.PublicationDBName%2A> , et définissez la propriété <xref:Microsoft.SqlServer.Replication.ReplicationObject.ConnectionContext%2A> avec la connexion créée à l'étape 1.</span><span class="sxs-lookup"><span data-stu-id="53314-186">Set the <xref:Microsoft.SqlServer.Replication.PublicationMonitor.Name%2A>, <xref:Microsoft.SqlServer.Replication.PublicationMonitor.DistributionDBName%2A>, <xref:Microsoft.SqlServer.Replication.PublicationMonitor.PublisherName%2A>, and <xref:Microsoft.SqlServer.Replication.PublicationMonitor.PublicationDBName%2A> properties, and set the <xref:Microsoft.SqlServer.Replication.ReplicationObject.ConnectionContext%2A> property to the connection created in step 1.</span></span>  
  
4.  <span data-ttu-id="53314-187">Appelez la méthode <xref:Microsoft.SqlServer.Replication.ReplicationObject.LoadProperties%2A> pour obtenir les propriétés de l'objet.</span><span class="sxs-lookup"><span data-stu-id="53314-187">Call the <xref:Microsoft.SqlServer.Replication.ReplicationObject.LoadProperties%2A> method to get the properties of the object.</span></span> <span data-ttu-id="53314-188">Si cette méthode retourne `false`, soit les propriétés de surveillance de la publication ont été définies de manière incorrecte à l'étape 3, soit la publication n'existe pas.</span><span class="sxs-lookup"><span data-stu-id="53314-188">If this method returns `false`, either the publication monitor properties in step 3 were defined incorrectly or the publication does not exist.</span></span>  
  
5.  <span data-ttu-id="53314-189">Appelez la méthode <xref:Microsoft.SqlServer.Replication.PublicationMonitor.EnumTracerTokens%2A> .</span><span class="sxs-lookup"><span data-stu-id="53314-189">Call the <xref:Microsoft.SqlServer.Replication.PublicationMonitor.EnumTracerTokens%2A> method.</span></span> <span data-ttu-id="53314-190">Effectuez un cast de l'objet <xref:System.Collections.ArrayList> retourné en un tableau d'objets <xref:Microsoft.SqlServer.Replication.TracerToken> .</span><span class="sxs-lookup"><span data-stu-id="53314-190">Cast the returned <xref:System.Collections.ArrayList> object to an array of <xref:Microsoft.SqlServer.Replication.TracerToken> objects.</span></span>  
  
6.  <span data-ttu-id="53314-191">Appelez la méthode <xref:Microsoft.SqlServer.Replication.PublicationMonitor.EnumTracerTokenHistory%2A> .</span><span class="sxs-lookup"><span data-stu-id="53314-191">Call the <xref:Microsoft.SqlServer.Replication.PublicationMonitor.EnumTracerTokenHistory%2A> method.</span></span> <span data-ttu-id="53314-192">Passez une valeur de <xref:Microsoft.SqlServer.Replication.TracerToken.TracerTokenId%2A> pour un jeton de suivi de l'étape 5.</span><span class="sxs-lookup"><span data-stu-id="53314-192">Pass a value of <xref:Microsoft.SqlServer.Replication.TracerToken.TracerTokenId%2A> for a tracer token from step 5.</span></span> <span data-ttu-id="53314-193">Les informations de latence pour le jeton de suivi sélectionné sont ainsi retournées comme objet <xref:System.Data.DataSet> .</span><span class="sxs-lookup"><span data-stu-id="53314-193">This returns latency information for the selected tracer token as a <xref:System.Data.DataSet> object.</span></span> <span data-ttu-id="53314-194">Si toutes les informations de jeton de suivi sont retournées, la connexion entre le serveur de publication et le serveur de distribution et la connexion entre le serveur de distribution et l'Abonné existent et la topologie de réplication fonctionne.</span><span class="sxs-lookup"><span data-stu-id="53314-194">If all tracer token information is returned, the connection between the Publisher and Distributor and the connection between the Distributor and the Subscriber both exist and the replication topology is functioning.</span></span>  
  
#### <a name="to-remove-tracer-tokens"></a><span data-ttu-id="53314-195">Pour supprimer les jetons de suivi</span><span class="sxs-lookup"><span data-stu-id="53314-195">To remove tracer tokens</span></span>  
  
1.  <span data-ttu-id="53314-196">Créez une connexion au serveur de distribution en utilisant la classe <xref:Microsoft.SqlServer.Management.Common.ServerConnection> .</span><span class="sxs-lookup"><span data-stu-id="53314-196">Create a connection to the Distributor by using the <xref:Microsoft.SqlServer.Management.Common.ServerConnection> class.</span></span>  
  
2.  <span data-ttu-id="53314-197">Créez une instance de la classe <xref:Microsoft.SqlServer.Replication.PublicationMonitor>.</span><span class="sxs-lookup"><span data-stu-id="53314-197">Create an instance of the <xref:Microsoft.SqlServer.Replication.PublicationMonitor> class.</span></span>  
  
3.  <span data-ttu-id="53314-198">Définissez les propriétés <xref:Microsoft.SqlServer.Replication.PublicationMonitor.Name%2A>, <xref:Microsoft.SqlServer.Replication.PublicationMonitor.DistributionDBName%2A>, <xref:Microsoft.SqlServer.Replication.PublicationMonitor.PublisherName%2A>, et <xref:Microsoft.SqlServer.Replication.PublicationMonitor.PublicationDBName%2A> , et définissez la propriété <xref:Microsoft.SqlServer.Replication.ReplicationObject.ConnectionContext%2A> avec la connexion créée à l'étape 1.</span><span class="sxs-lookup"><span data-stu-id="53314-198">Set the <xref:Microsoft.SqlServer.Replication.PublicationMonitor.Name%2A>, <xref:Microsoft.SqlServer.Replication.PublicationMonitor.DistributionDBName%2A>, <xref:Microsoft.SqlServer.Replication.PublicationMonitor.PublisherName%2A>, and <xref:Microsoft.SqlServer.Replication.PublicationMonitor.PublicationDBName%2A> properties, and set the <xref:Microsoft.SqlServer.Replication.ReplicationObject.ConnectionContext%2A> property to the connection created in step 1.</span></span>  
  
4.  <span data-ttu-id="53314-199">Appelez la méthode <xref:Microsoft.SqlServer.Replication.ReplicationObject.LoadProperties%2A> pour obtenir les propriétés de l'objet.</span><span class="sxs-lookup"><span data-stu-id="53314-199">Call the <xref:Microsoft.SqlServer.Replication.ReplicationObject.LoadProperties%2A> method to get the properties of the object.</span></span> <span data-ttu-id="53314-200">Si cette méthode retourne `false`, soit les propriétés de surveillance de la publication ont été définies de manière incorrecte à l'étape 3, soit la publication n'existe pas.</span><span class="sxs-lookup"><span data-stu-id="53314-200">If this method returns `false`, either the publication monitor properties in step 3 were defined incorrectly or the publication does not exist.</span></span>  
  
5.  <span data-ttu-id="53314-201">Appelez la méthode <xref:Microsoft.SqlServer.Replication.PublicationMonitor.EnumTracerTokens%2A> .</span><span class="sxs-lookup"><span data-stu-id="53314-201">Call the <xref:Microsoft.SqlServer.Replication.PublicationMonitor.EnumTracerTokens%2A> method.</span></span> <span data-ttu-id="53314-202">Effectuez un cast de l'objet <xref:System.Collections.ArrayList> retourné en un tableau d'objets <xref:Microsoft.SqlServer.Replication.TracerToken> .</span><span class="sxs-lookup"><span data-stu-id="53314-202">Cast the returned <xref:System.Collections.ArrayList> object to an array of <xref:Microsoft.SqlServer.Replication.TracerToken> objects.</span></span>  
  
6.  <span data-ttu-id="53314-203">Appelez la méthode <xref:Microsoft.SqlServer.Replication.PublicationMonitor.CleanUpTracerTokenHistory%2A> .</span><span class="sxs-lookup"><span data-stu-id="53314-203">Call the <xref:Microsoft.SqlServer.Replication.PublicationMonitor.CleanUpTracerTokenHistory%2A> method.</span></span> <span data-ttu-id="53314-204">Passez l'une des valeurs suivantes :</span><span class="sxs-lookup"><span data-stu-id="53314-204">Pass one of the following values:</span></span>  
  
    -   <span data-ttu-id="53314-205"><xref:Microsoft.SqlServer.Replication.TracerToken.TracerTokenId%2A> pour un jeton de suivi de l'étape 5.</span><span class="sxs-lookup"><span data-stu-id="53314-205">The <xref:Microsoft.SqlServer.Replication.TracerToken.TracerTokenId%2A> for a tracer token from step 5.</span></span> <span data-ttu-id="53314-206">Les informations d'un jeton sélectionné sont alors supprimées.</span><span class="sxs-lookup"><span data-stu-id="53314-206">This deletes information for a selected token.</span></span>  
  
    -   <span data-ttu-id="53314-207">Objet <xref:System.DateTime>.</span><span class="sxs-lookup"><span data-stu-id="53314-207">A <xref:System.DateTime> object.</span></span> <span data-ttu-id="53314-208">Les informations pour tous les jetons plus anciens que les date et heure spécifiées sont alors supprimées.</span><span class="sxs-lookup"><span data-stu-id="53314-208">This deletes information for all tokens older than the specified date and time.</span></span>  
  
###  <a name="PShellExample"></a>  
