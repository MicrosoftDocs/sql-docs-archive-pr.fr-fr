---
title: Sauvegardes de la fin du journal (SQL Server) | Microsoft Docs
ms.custom: ''
ms.date: 03/08/2017
ms.prod: sql-server-2014
ms.reviewer: ''
ms.technology: backup-restore
ms.topic: conceptual
helpviewer_keywords:
- backing up [SQL Server], tail of log
- transaction log backups [SQL Server], tail-log backups
- NO_TRUNCATE clause
- backups [SQL Server], log backups
- tail-log backups
- backups [SQL Server], tail-log backups
ms.assetid: 313ddaf6-ec54-4a81-a104-7ffa9533ca58
author: MikeRayMSFT
ms.author: mikeray
ms.openlocfilehash: cd7c505701a4edb1f66ca516d06179b2eb1a222d
ms.sourcegitcommit: ad4d92dce894592a259721a1571b1d8736abacdb
ms.translationtype: MT
ms.contentlocale: fr-FR
ms.lasthandoff: 08/04/2020
ms.locfileid: "87601519"
---
# <a name="tail-log-backups-sql-server"></a><span data-ttu-id="44f7f-102">Sauvegardes de la fin du journal (SQL Server)</span><span class="sxs-lookup"><span data-stu-id="44f7f-102">Tail-Log Backups (SQL Server)</span></span>
  <span data-ttu-id="44f7f-103">Cette rubrique s'applique uniquement à la sauvegarde et la restauration des bases de données [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] employant le mode de récupération complète ou le mode de récupération utilisant les journaux de transactions.</span><span class="sxs-lookup"><span data-stu-id="44f7f-103">This topic is relevant only for backup and restore of [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] databases that are using the full or bulk-logged recovery models.</span></span>  
  
 <span data-ttu-id="44f7f-104">Une *sauvegarde de la fin du journal* capture tous les enregistrements de journal qui n’ont pas encore été sauvegardés (la *fin du journal*) pour empêcher toute perte de travail et préserver la continuité de la séquence de journaux de transactions consécutifs.</span><span class="sxs-lookup"><span data-stu-id="44f7f-104">A *tail-log backup* captures any log records that have not yet been backed up (the *tail of the log*) to prevent work loss and to keep the log chain intact.</span></span> <span data-ttu-id="44f7f-105">Avant de pouvoir récupérer une base de données [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] aux date et heure les plus récentes, vous devez sauvegarder la fin de son journal des transactions.</span><span class="sxs-lookup"><span data-stu-id="44f7f-105">Before you can recover a [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] database to its latest point in time, you must back up the tail of its transaction log.</span></span> <span data-ttu-id="44f7f-106">La sauvegarde de la fin du journal est la dernière sauvegarde intéressante dans le plan de récupération de la base de données.</span><span class="sxs-lookup"><span data-stu-id="44f7f-106">The tail-log backup will be the last backup of interest in the recovery plan for the database.</span></span>  
  
> [!NOTE]  
>  <span data-ttu-id="44f7f-107">Les scénarios de restauration ne nécessitent pas tous une sauvegarde de la fin du journal.</span><span class="sxs-lookup"><span data-stu-id="44f7f-107">Not all restore scenarios require a tail-log backup.</span></span> <span data-ttu-id="44f7f-108">Vous n'avez pas besoin d'une sauvegarde de la fin du journal si le point de récupération est contenu dans une sauvegarde de journal antérieure.</span><span class="sxs-lookup"><span data-stu-id="44f7f-108">You do not need a tail-log backup if the recovery point is contained in an earlier log backup.</span></span> <span data-ttu-id="44f7f-109">En outre, une sauvegarde de la fin du journal est inutile si vous déplacez ou remplacez (par écrasement) la base de données et ne souhaitez pas la restaurer à un point donné après la sauvegarde la plus récente.</span><span class="sxs-lookup"><span data-stu-id="44f7f-109">Also, a tail-log backup is unnecessary if you are moving or replacing (overwriting) a database and do not need to restore it to a point of time after its most recent backup.</span></span>  
  
 
  
##  <a name="scenarios-that-require-a-tail-log-backup"></a><a name="TailLogScenarios"></a> <span data-ttu-id="44f7f-110">Scénarios qui nécessitent une sauvegarde de la fin du journal</span><span class="sxs-lookup"><span data-stu-id="44f7f-110">Scenarios That Require a Tail-Log Backup</span></span>  
 <span data-ttu-id="44f7f-111">Nous vous recommandons d'effectuer une sauvegarde de la fin du journal dans les scénarios suivants :</span><span class="sxs-lookup"><span data-stu-id="44f7f-111">We recommend that you take a tail-log backup in the following scenarios:</span></span>  
  
-   <span data-ttu-id="44f7f-112">Si la base de données est en ligne et que vous envisagez d'effectuer une opération de restauration de la base de données, commencez par sauvegarder la fin du journal.</span><span class="sxs-lookup"><span data-stu-id="44f7f-112">If the database is online and you plan to perform a restore operation on the database, begin by backing up the tail of the log.</span></span> <span data-ttu-id="44f7f-113">Pour éviter une erreur pour une base de données en ligne, vous devez utiliser... Option WITH NORECOVERY de l’instruction [Backup](/sql/t-sql/statements/backup-transact-sql) [!INCLUDE[tsql](../../includes/tsql-md.md)] .</span><span class="sxs-lookup"><span data-stu-id="44f7f-113">To avoid an error for an online database, you must use the ... WITH NORECOVERY option of the [BACKUP](/sql/t-sql/statements/backup-transact-sql)[!INCLUDE[tsql](../../includes/tsql-md.md)] statement.</span></span>  
  
-   <span data-ttu-id="44f7f-114">Si une base de données est hors connexion, ne démarre pas et que vous devez restaurer la base de données, sauvegardez d'abord la fin du journal.</span><span class="sxs-lookup"><span data-stu-id="44f7f-114">If a database is offline and fails to start and you need to restore the database, first back up the tail of the log.</span></span> <span data-ttu-id="44f7f-115">Comme il est exclu d'effectuer une transaction à ce stade, l'utilisation de WITH NORECOVERY est facultative.</span><span class="sxs-lookup"><span data-stu-id="44f7f-115">Because no transactions can occur at this time, using the WITH NORECOVERY is optional.</span></span>  
  
-   <span data-ttu-id="44f7f-116">Si une base de données est endommagée, essayez d'effectuer une sauvegarde de la fin du journal à l'aide de l'option WITH CONTINUE_AFTER_ERROR de l'instruction BACKUP.</span><span class="sxs-lookup"><span data-stu-id="44f7f-116">If a database is damaged, try to take a tail-log backup by using the WITH CONTINUE_AFTER_ERROR option of the BACKUP statement.</span></span>  
  
     <span data-ttu-id="44f7f-117">Sur une base de données endommagée, la sauvegarde de la fin du journal n'aboutit que si les fichiers journaux ne sont pas endommagés, la base de données est en mesure de prendre en charge cette sauvegarde de la fin du journal, et la base de données ne contient pas de modifications journalisées en bloc.</span><span class="sxs-lookup"><span data-stu-id="44f7f-117">On a damaged database backing up the tail of the log can succeed only if the log files are undamaged, the database is in a state that supports tail-log backups, and the database does not contain any bulk-logged changes.</span></span> <span data-ttu-id="44f7f-118">Si une sauvegarde de la fin du journal ne peut pas être créée, toutes les transactions validées après la dernière sauvegarde de fichier journal sont perdues.</span><span class="sxs-lookup"><span data-stu-id="44f7f-118">If a tail-log backup cannot be created, any transactions committed after the latest log backup are lost.</span></span>  
  
 <span data-ttu-id="44f7f-119">Le tableau suivant résume les options BACKUP NORECOVERY et CONTINUE_AFTER_ERROR.</span><span class="sxs-lookup"><span data-stu-id="44f7f-119">The following table summarizes the BACKUP NORECOVERY and CONTINUE_AFTER_ERROR options.</span></span>  
  
|<span data-ttu-id="44f7f-120">Option BACKUP LOG</span><span class="sxs-lookup"><span data-stu-id="44f7f-120">BACKUP LOG option</span></span>|<span data-ttu-id="44f7f-121">Commentaires</span><span class="sxs-lookup"><span data-stu-id="44f7f-121">Comments</span></span>|  
|-----------------------|--------------|  
|<span data-ttu-id="44f7f-122">NORECOVERY</span><span class="sxs-lookup"><span data-stu-id="44f7f-122">NORECOVERY</span></span>|<span data-ttu-id="44f7f-123">Utilisez NORECOVERY chaque fois que vous envisagez de poursuivre une opération de restauration sur la base de données.</span><span class="sxs-lookup"><span data-stu-id="44f7f-123">Use NORECOVERY whenever you intend to continue with a restore operation on the database.</span></span> <span data-ttu-id="44f7f-124">NORECOVERY fait passer la base de données en état de restauration.</span><span class="sxs-lookup"><span data-stu-id="44f7f-124">NORECOVERY takes the database into the restoring state.</span></span> <span data-ttu-id="44f7f-125">Ceci permet d'éviter des modifications dans la base de données après la sauvegarde de la fin du journal.</span><span class="sxs-lookup"><span data-stu-id="44f7f-125">This guarantees that the database does not change after the tail-log backup.</span></span>  <span data-ttu-id="44f7f-126">Le journal est tronqué sauf si l'option NO_TRUNCATE ou COPY_ONLY est aussi spécifiée.</span><span class="sxs-lookup"><span data-stu-id="44f7f-126">The log is truncated unless the NO_TRUNCATE option or COPY_ONLY option is also specified.</span></span><br /><br /> <span data-ttu-id="44f7f-127">Important : nous vous recommandons d’éviter d’utiliser des NO_TRUNCATE, sauf lorsque la base de données est endommagée. \*\* \* \* \* \* \*\*</span><span class="sxs-lookup"><span data-stu-id="44f7f-127">**\*\* Important \*\*** We recommend that you avoid using NO_TRUNCATE, except when the database is damaged.</span></span>|  
|<span data-ttu-id="44f7f-128">CONTINUE_AFTER_ERROR</span><span class="sxs-lookup"><span data-stu-id="44f7f-128">CONTINUE_AFTER_ERROR</span></span>|<span data-ttu-id="44f7f-129">Utilisez CONTINUE_AFTER_ERROR uniquement si vous sauvegardez la fin d'une base de données endommagée.</span><span class="sxs-lookup"><span data-stu-id="44f7f-129">Use CONTINUE_AFTER_ERROR only if you are backing up the tail of a damaged database.</span></span><br /><br /> <span data-ttu-id="44f7f-130">Remarque : lorsque vous utilisez la sauvegarde de la fin du journal sur une base de données endommagée, certaines métadonnées habituellement capturées dans les sauvegardes de journaux peuvent ne pas être disponibles.</span><span class="sxs-lookup"><span data-stu-id="44f7f-130">Note: When you use back up the tail of the log on a damaged database, some of the metadata ordinarily captured in log backups might be unavailable.</span></span> <span data-ttu-id="44f7f-131">Pour plus d’informations, consultez [Sauvegardes de la fin du journal avec des métadonnées de sauvegarde incomplètes](#IncompleteMetadata), plus loin dans cette rubrique.</span><span class="sxs-lookup"><span data-stu-id="44f7f-131">For more information, see [Tail-Log Backups That Have Incomplete Backup Metadata](#IncompleteMetadata), later in this topic.</span></span>|  
  
##  <a name="tail-log-backups-that-have-incomplete-backup-metadata"></a><a name="IncompleteMetadata"></a><span data-ttu-id="44f7f-132">Sauvegardes de la fin du journal avec des métadonnées de sauvegarde incomplètes</span><span class="sxs-lookup"><span data-stu-id="44f7f-132">Tail-Log Backups That Have Incomplete Backup Metadata</span></span>  
 <span data-ttu-id="44f7f-133">Les sauvegardes de la fin du journal capturent la fin du journal même si la base de données est hors connexion ou endommagée, ou s'il y manque des fichiers de données.</span><span class="sxs-lookup"><span data-stu-id="44f7f-133">Tail log backups capture the tail of the log even if the database is offline, damaged, or missing data files.</span></span> <span data-ttu-id="44f7f-134">Cela peut aboutir à des métadonnées incomplètes à partir des commandes d'informations de restauration et de **msdb**.</span><span class="sxs-lookup"><span data-stu-id="44f7f-134">This might cause incomplete metadata from the restore information commands and **msdb**.</span></span> <span data-ttu-id="44f7f-135">Mais seules les métadonnées sont incomplètes ; le journal capturé est complet et exploitable.</span><span class="sxs-lookup"><span data-stu-id="44f7f-135">However, only the metadata is incomplete; the captured log is complete and usable.</span></span>  
  
 <span data-ttu-id="44f7f-136">Si une sauvegarde de la fin du journal contient des métadonnées incomplètes, dans la table [backupset](/sql/relational-databases/system-tables/backupset-transact-sql) , **has_incomplete_metadata** a la valeur **1**.</span><span class="sxs-lookup"><span data-stu-id="44f7f-136">If a tail-log backup has incomplete metadata, in the [backupset](/sql/relational-databases/system-tables/backupset-transact-sql) table, **has_incomplete_metadata** is set to **1**.</span></span> <span data-ttu-id="44f7f-137">De plus, dans le résultat de [RESTORE HEADERONLY](/sql/t-sql/statements/restore-statements-headeronly-transact-sql), **HasIncompleteMetadata** a la valeur **1**.</span><span class="sxs-lookup"><span data-stu-id="44f7f-137">Also, in the output of [RESTORE HEADERONLY](/sql/t-sql/statements/restore-statements-headeronly-transact-sql), **HasIncompleteMetadata** is set to **1**.</span></span>  
  
 <span data-ttu-id="44f7f-138">Si les métadonnées d’une sauvegarde de la fin du journal sont incomplètes, la plupart des informations relatives aux groupes de fichiers sont absentes de la table [backupfilegroup](/sql/relational-databases/system-tables/backupfilegroup-transact-sql) au moment de la sauvegarde de la fin du journal.</span><span class="sxs-lookup"><span data-stu-id="44f7f-138">If the metadata in a tail-log backup is incomplete, the [backupfilegroup](/sql/relational-databases/system-tables/backupfilegroup-transact-sql) table will be missing most of the information about filegroups at the time of the tail-log backup.</span></span> <span data-ttu-id="44f7f-139">La plupart des colonnes de la table **backupfilegroup** ont la valeur NULL ; seules les colonnes suivantes ont une signification :</span><span class="sxs-lookup"><span data-stu-id="44f7f-139">Most of the **backupfilegroup** table columns are NULL; the only meaningful columns are as follows:</span></span>  
  
-   <span data-ttu-id="44f7f-140">**backup_set_id**</span><span class="sxs-lookup"><span data-stu-id="44f7f-140">**backup_set_id**</span></span>  
  
-   <span data-ttu-id="44f7f-141">**filegroup_id**</span><span class="sxs-lookup"><span data-stu-id="44f7f-141">**filegroup_id**</span></span>  
  
-   <span data-ttu-id="44f7f-142">**type**</span><span class="sxs-lookup"><span data-stu-id="44f7f-142">**type**</span></span>  
  
-   <span data-ttu-id="44f7f-143">**type_desc**</span><span class="sxs-lookup"><span data-stu-id="44f7f-143">**type_desc**</span></span>  
  
-   <span data-ttu-id="44f7f-144">**is_readonly**</span><span class="sxs-lookup"><span data-stu-id="44f7f-144">**is_readonly**</span></span>  
  
##  <a name="related-tasks"></a><a name="RelatedTasks"></a> <span data-ttu-id="44f7f-145">Tâches associées</span><span class="sxs-lookup"><span data-stu-id="44f7f-145">Related Tasks</span></span>  
 <span data-ttu-id="44f7f-146">Pour créer une sauvegarde de la fin du journal, consultez [Sauvegarder le journal des transactions lorsque la base de données est endommagée &#40;SQL Server&#41;](back-up-the-transaction-log-when-the-database-is-damaged-sql-server.md).</span><span class="sxs-lookup"><span data-stu-id="44f7f-146">To create a tail-log backup, see [Back Up the Transaction Log When the Database Is Damaged &#40;SQL Server&#41;](back-up-the-transaction-log-when-the-database-is-damaged-sql-server.md).</span></span>  
  
 <span data-ttu-id="44f7f-147">Pour restaurer une sauvegarde du journal des transactions, consultez [Restaurer une sauvegarde du journal des transactions &#40;SQL Server&#41;](restore-a-transaction-log-backup-sql-server.md).</span><span class="sxs-lookup"><span data-stu-id="44f7f-147">To restore a transaction log backup, see [Restore a Transaction Log Backup &#40;SQL Server&#41;](restore-a-transaction-log-backup-sql-server.md).</span></span>  
  
## <a name="see-also"></a><span data-ttu-id="44f7f-148">Voir aussi</span><span class="sxs-lookup"><span data-stu-id="44f7f-148">See Also</span></span>  
 <span data-ttu-id="44f7f-149">[BACKUP &#40;Transact-SQL&#41;](/sql/t-sql/statements/backup-transact-sql) </span><span class="sxs-lookup"><span data-stu-id="44f7f-149">[BACKUP &#40;Transact-SQL&#41;](/sql/t-sql/statements/backup-transact-sql) </span></span>  
 <span data-ttu-id="44f7f-150">[RESTORE &#40;Transact-SQL&#41;](/sql/t-sql/statements/restore-statements-transact-sql) </span><span class="sxs-lookup"><span data-stu-id="44f7f-150">[RESTORE &#40;Transact-SQL&#41;](/sql/t-sql/statements/restore-statements-transact-sql) </span></span>  
 <span data-ttu-id="44f7f-151">[Sauvegarde et restauration des bases de données SQL Server](back-up-and-restore-of-sql-server-databases.md) </span><span class="sxs-lookup"><span data-stu-id="44f7f-151">[Back Up and Restore of SQL Server Databases](back-up-and-restore-of-sql-server-databases.md) </span></span>  
 <span data-ttu-id="44f7f-152">[Sauvegardes de type copie seule &#40;SQL Server&#41;](copy-only-backups-sql-server.md) </span><span class="sxs-lookup"><span data-stu-id="44f7f-152">[Copy-Only Backups &#40;SQL Server&#41;](copy-only-backups-sql-server.md) </span></span>  
 <span data-ttu-id="44f7f-153">[Sauvegardes des journaux de transactions &#40;SQL Server&#41;](transaction-log-backups-sql-server.md) </span><span class="sxs-lookup"><span data-stu-id="44f7f-153">[Transaction Log Backups &#40;SQL Server&#41;](transaction-log-backups-sql-server.md) </span></span>  
 [<span data-ttu-id="44f7f-154">Appliquer les sauvegardes du journal de transactions &#40;SQL Server&#41;</span><span class="sxs-lookup"><span data-stu-id="44f7f-154">Apply Transaction Log Backups &#40;SQL Server&#41;</span></span>](apply-transaction-log-backups-sql-server.md)  
  
  
