---
title: Restaurer une base de données SQL Server jusqu’à une limite dans le temps (mode de récupération complète) | Microsoft Docs
ms.custom: ''
ms.date: 06/13/2017
ms.prod: sql-server-2014
ms.reviewer: ''
ms.technology: backup-restore
ms.topic: conceptual
helpviewer_keywords:
- STOPAT clause [RESTORE LOG statement]
- point in time recovery [SQL Server]
- restoring databases [SQL Server], point in time
ms.assetid: 3a5daefd-08a8-4565-b54f-28ad01a47d32
author: MikeRayMSFT
ms.author: mikeray
ms.openlocfilehash: 0c71ff6e75cbbf27042c1eac70b1f97076290865
ms.sourcegitcommit: ad4d92dce894592a259721a1571b1d8736abacdb
ms.translationtype: MT
ms.contentlocale: fr-FR
ms.lasthandoff: 08/04/2020
ms.locfileid: "87612418"
---
# <a name="restore-a-sql-server-database-to-a-point-in-time-full-recovery-model"></a><span data-ttu-id="d449f-102">Restaurer une base de données SQL Server jusqu'à une limite dans le temps (mode de récupération complète)</span><span class="sxs-lookup"><span data-stu-id="d449f-102">Restore a SQL Server Database to a Point in Time (Full Recovery Model)</span></span>
  <span data-ttu-id="d449f-103">Cette rubrique explique comment restaurer une base de données à un point précis dans le temps dans [!INCLUDE[ssCurrent](../../includes/sscurrent-md.md)] à l'aide de [!INCLUDE[ssManStudioFull](../../includes/ssmanstudiofull-md.md)] ou de [!INCLUDE[tsql](../../includes/tsql-md.md)].</span><span class="sxs-lookup"><span data-stu-id="d449f-103">This topic describes how to restore a database to a point in time in [!INCLUDE[ssCurrent](../../includes/sscurrent-md.md)] by using [!INCLUDE[ssManStudioFull](../../includes/ssmanstudiofull-md.md)] or [!INCLUDE[tsql](../../includes/tsql-md.md)].</span></span> <span data-ttu-id="d449f-104">Cette rubrique s'applique uniquement aux bases de données [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] utilisant le mode de restauration complète ou de récupération utilisant les journaux de transactions.</span><span class="sxs-lookup"><span data-stu-id="d449f-104">This topic is relevant only for [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] databases that use the full or bulk-logged recovery models.</span></span>  
  
> [!IMPORTANT]  
>  <span data-ttu-id="d449f-105">Dans le mode de récupération utilisant les journaux de transactions, si la sauvegarde du journal contient des modifications journalisées en bloc, la récupération jusqu'à une date et heure à un point de cette sauvegarde est impossible.</span><span class="sxs-lookup"><span data-stu-id="d449f-105">Under the bulk-logged recovery model, if a log backup contains bulk-logged changes, point-in-time recovery is not possible to a point within that backup.</span></span> <span data-ttu-id="d449f-106">La base de données doit être récupérée à la fin de la sauvegarde du journal des transactions.</span><span class="sxs-lookup"><span data-stu-id="d449f-106">The database must be recovered to the end of the transaction log backup.</span></span>  
  
-   <span data-ttu-id="d449f-107">**Avant de commencer :**</span><span class="sxs-lookup"><span data-stu-id="d449f-107">**Before you begin:**</span></span>  
  
     [<span data-ttu-id="d449f-108">Recommandations</span><span class="sxs-lookup"><span data-stu-id="d449f-108">Recommendations</span></span>](#Recommendations)  
  
     [<span data-ttu-id="d449f-109">Sécurité</span><span class="sxs-lookup"><span data-stu-id="d449f-109">Security</span></span>](#Security)  
  
-   <span data-ttu-id="d449f-110">**Pour restaurer une base de données SQL Server à un point précis dans le temps, utilisez :**</span><span class="sxs-lookup"><span data-stu-id="d449f-110">**To restore a SQL Server database to a point in time, using:**</span></span>  
  
     [<span data-ttu-id="d449f-111">SQL Server Management Studio</span><span class="sxs-lookup"><span data-stu-id="d449f-111">SQL Server Management Studio</span></span>](#SSMSProcedure)  
  
     [<span data-ttu-id="d449f-112">Transact-SQL</span><span class="sxs-lookup"><span data-stu-id="d449f-112">Transact-SQL</span></span>](#TsqlProcedure)  
  
##  <a name="before-you-begin"></a><a name="BeforeYouBegin"></a> <span data-ttu-id="d449f-113">Avant de commencer</span><span class="sxs-lookup"><span data-stu-id="d449f-113">Before You Begin</span></span>  
  
###  <a name="recommendations"></a><a name="Recommendations"></a> <span data-ttu-id="d449f-114">Recommandations</span><span class="sxs-lookup"><span data-stu-id="d449f-114">Recommendations</span></span>  
  
-   <span data-ttu-id="d449f-115">Utilisation de STANDBY pour retrouver un moment inconnu dans le temps.</span><span class="sxs-lookup"><span data-stu-id="d449f-115">Use STANDBY to find unknown point in time.</span></span>  
  
-   <span data-ttu-id="d449f-116">Spécification du point d'arrêt suffisamment tôt dans la séquence de restauration</span><span class="sxs-lookup"><span data-stu-id="d449f-116">Specify the point in time early in a restore sequence</span></span>  
  
###  <a name="security"></a><a name="Security"></a> <span data-ttu-id="d449f-117">Sécurité</span><span class="sxs-lookup"><span data-stu-id="d449f-117">Security</span></span>  
  
####  <a name="permissions"></a><a name="Permissions"></a> <span data-ttu-id="d449f-118">Autorisations</span><span class="sxs-lookup"><span data-stu-id="d449f-118">Permissions</span></span>  
 <span data-ttu-id="d449f-119">Si la base de données restaurée n'existe pas, l'utilisateur doit posséder les autorisations CREATE DATABASE afin de pouvoir exécuter RESTORE.</span><span class="sxs-lookup"><span data-stu-id="d449f-119">If the database being restored does not exist, the user must have CREATE DATABASE permissions to be able to execute RESTORE.</span></span> <span data-ttu-id="d449f-120">Si la base de données existe, les autorisations RESTORE reviennent par défaut aux membres des rôles serveur fixe **sysadmin** et **dbcreator** et au propriétaire (**dbo**) de la base de données (pour l’option FROM DATABASE_SNAPSHOT, la base de données existe toujours).</span><span class="sxs-lookup"><span data-stu-id="d449f-120">If the database exists, RESTORE permissions default to members of the **sysadmin** and **dbcreator** fixed server roles and the owner (**dbo**) of the database (for the FROM DATABASE_SNAPSHOT option, the database always exists).</span></span>  
  
 <span data-ttu-id="d449f-121">Les autorisations RESTORE sont attribuées aux rôles dont les informations d'appartenance sont toujours immédiatement accessibles à partir du serveur.</span><span class="sxs-lookup"><span data-stu-id="d449f-121">RESTORE permissions are given to roles in which membership information is always readily available to the server.</span></span> <span data-ttu-id="d449f-122">Étant donné que l’appartenance au rôle de base de données fixe ne peut être contrôlée que quand la base de données est accessible et non endommagée, ce qui n’est pas toujours le cas lorsque RESTORE est exécuté, les membres du rôle de base de données fixe **db_owner** ne détiennent pas d’autorisations RESTORE.</span><span class="sxs-lookup"><span data-stu-id="d449f-122">Because fixed database role membership can be checked only when the database is accessible and undamaged, which is not always the case when RESTORE is executed, members of the **db_owner** fixed database role do not have RESTORE permissions.</span></span>  
  
##  <a name="using-sql-server-management-studio"></a><a name="SSMSProcedure"></a> <span data-ttu-id="d449f-123">Utilisation de SQL Server Management Studio</span><span class="sxs-lookup"><span data-stu-id="d449f-123">Using SQL Server Management Studio</span></span>  
 <span data-ttu-id="d449f-124">**Pour restaurer une base de données à un point dans le temps**</span><span class="sxs-lookup"><span data-stu-id="d449f-124">**To restore a database to a point in time**</span></span>  
  
1.  <span data-ttu-id="d449f-125">Dans l'Explorateur d'objets, connectez-vous à l'instance appropriée du [!INCLUDE[ssDEnoversion](../../includes/ssdenoversion-md.md)], puis développez l'arborescence du serveur.</span><span class="sxs-lookup"><span data-stu-id="d449f-125">In Object Explorer, connect to the appropriate instance of the [!INCLUDE[ssDEnoversion](../../includes/ssdenoversion-md.md)], and expand the server tree.</span></span>  
  
2.  <span data-ttu-id="d449f-126">Développez **Bases de données**.</span><span class="sxs-lookup"><span data-stu-id="d449f-126">Expand **Databases**.</span></span> <span data-ttu-id="d449f-127">Selon la base de données, sélectionnez une base de données utilisateur ou développez **Bases de données système**et sélectionnez une base de données système.</span><span class="sxs-lookup"><span data-stu-id="d449f-127">Depending on the database, either select a user database or expand **System Databases**, and then select a system database.</span></span>  
  
3.  <span data-ttu-id="d449f-128">Cliquez avec le bouton droit sur la base de données, pointez sur **Tâches**, sur **Restaurer**, puis cliquez sur **Base de données**.</span><span class="sxs-lookup"><span data-stu-id="d449f-128">Right-click the database, point to **Tasks**, point to **Restore**, and then click **Database**.</span></span>  
  
4.  <span data-ttu-id="d449f-129">Dans la page **Général** , utilisez la section **Source** pour préciser la source et l'emplacement des jeux de sauvegarde à restaurer.</span><span class="sxs-lookup"><span data-stu-id="d449f-129">On the **General** page, use the **Source** section to specify the source and location of the backup sets to restore.</span></span> <span data-ttu-id="d449f-130">Sélectionnez l’une des options suivantes :</span><span class="sxs-lookup"><span data-stu-id="d449f-130">Select one of the following options:</span></span>  
  
    -   <span data-ttu-id="d449f-131">**Sauvegarde de la base de données**</span><span class="sxs-lookup"><span data-stu-id="d449f-131">**Database**</span></span>  
  
         <span data-ttu-id="d449f-132">Sélectionnez la base de données à restaurer dans la liste déroulante.</span><span class="sxs-lookup"><span data-stu-id="d449f-132">Select the database to restore from the drop-down list.</span></span> <span data-ttu-id="d449f-133">La liste contient uniquement les bases de données qui ont été sauvegardées selon l'historique de sauvegarde **msdb** .</span><span class="sxs-lookup"><span data-stu-id="d449f-133">The list contains only databases that have been backed up according to the **msdb** backup history.</span></span>  
  
    > [!NOTE]  
    >  <span data-ttu-id="d449f-134">Si la sauvegarde est prise à partir d'un serveur différent, le serveur de destination ne disposera pas des informations d'historique de sauvegarde pour la base de données spécifiée.</span><span class="sxs-lookup"><span data-stu-id="d449f-134">If the backup is taken from a different server, the destination server will not have the backup history information for the specified database.</span></span> <span data-ttu-id="d449f-135">Dans ce cas, sélectionnez **Unité** pour spécifier manuellement le fichier ou l'unité à restaurer.</span><span class="sxs-lookup"><span data-stu-id="d449f-135">In this case, select **Device** to manually specify the file or device to restore.</span></span>  
  
    -   <span data-ttu-id="d449f-136">**Appareil**</span><span class="sxs-lookup"><span data-stu-id="d449f-136">**Device**</span></span>  
  
         <span data-ttu-id="d449f-137">Cliquez sur le bouton Parcourir ( **...** ) pour ouvrir la boîte de dialogue **Sélectionner les unités de sauvegarde** .</span><span class="sxs-lookup"><span data-stu-id="d449f-137">Click the browse (**...**) button to open the **Select backup devices** dialog box.</span></span> <span data-ttu-id="d449f-138">Dans la zone **Type du média de sauvegarde** , sélectionnez l'un des types d'unités proposés.</span><span class="sxs-lookup"><span data-stu-id="d449f-138">In the **Backup media type** box, select one of the listed device types.</span></span> <span data-ttu-id="d449f-139">Pour sélectionner une ou plusieurs unités pour la zone **Support de sauvegarde** , cliquez sur **Ajouter**.</span><span class="sxs-lookup"><span data-stu-id="d449f-139">To select one or more devices for the **Backup media** box, click **Add**.</span></span>  
  
         <span data-ttu-id="d449f-140">Après avoir ajouté les unités souhaitées à la zone de liste **Support de sauvegarde** , cliquez sur **OK** pour revenir à la page **Général** .</span><span class="sxs-lookup"><span data-stu-id="d449f-140">After you add the devices you want to the **Backup media** list box, click **OK** to return to the **General** page.</span></span>  
  
         <span data-ttu-id="d449f-141">Dans la zone de liste **Source : Unité : Base de données** , sélectionnez le nom de la base de données à restaurer.</span><span class="sxs-lookup"><span data-stu-id="d449f-141">In the **Source: Device: Database** list box, select the name of the database which should be restored.</span></span>  
  
         <span data-ttu-id="d449f-142">**Remarque** Cette liste n'est disponible que lorsque **Unité** est sélectionné.</span><span class="sxs-lookup"><span data-stu-id="d449f-142">**Note** This list is only available when **Device** is selected.</span></span> <span data-ttu-id="d449f-143">Seules les bases de données qui ont des copies de sauvegarde sur l'unité sélectionnée seront disponibles.</span><span class="sxs-lookup"><span data-stu-id="d449f-143">Only databases that have backups on the selected device will be available.</span></span>  
  
5.  <span data-ttu-id="d449f-144">Dans la section **Destination** , la zone **Base de données** est automatiquement renseignée avec le nom de la base de données à restaurer.</span><span class="sxs-lookup"><span data-stu-id="d449f-144">In the **Destination** section, the **Database** box is automatically populated with the name of the database to be restored.</span></span> <span data-ttu-id="d449f-145">Pour changer le nom de la base de données, entrez le nouveau nom dans la zone **Base de données** .</span><span class="sxs-lookup"><span data-stu-id="d449f-145">To change the name of the database, enter the new name in the **Database** box.</span></span>  
  
6.  <span data-ttu-id="d449f-146">Cliquez sur **Chronologie** pour accéder à la boîte de dialogue **Chronologie de sauvegarde** .</span><span class="sxs-lookup"><span data-stu-id="d449f-146">Click **Timeline** to access the **Backup Timeline** dialog box.</span></span>  
  
7.  <span data-ttu-id="d449f-147">Dans la section **Restaurer sur** , cliquez sur **Date et heure spécifiques**.</span><span class="sxs-lookup"><span data-stu-id="d449f-147">In the **Restore to** section, click **Specific date and time**.</span></span>  
  
8.  <span data-ttu-id="d449f-148">Utilisez les zones **Date** et **Heure** ou la barre du curseur pour spécifier une date et une heure spécifiques auxquelles la restauration doit s'arrêter.</span><span class="sxs-lookup"><span data-stu-id="d449f-148">Use either the **Date** and **Time** boxes or the slider bar to specify a specific date and time to where the restore should stop.</span></span> [!INCLUDE[clickOK](../../includes/clickok-md.md)]  
  
    > [!NOTE]  
    >  <span data-ttu-id="d449f-149">Utilisez la zone **Chronologie - Intervalle** pour modifier la durée affichée dans la chronologie.</span><span class="sxs-lookup"><span data-stu-id="d449f-149">Use the **Timeline Interval** box to change the amount of time displayed on the timeline.</span></span>  
  
9. <span data-ttu-id="d449f-150">Après avoir défini un point spécifique dans le temps, l'assistant de récupération de base de données garantit que seules les sauvegardes nécessaires à la restauration à un point précis dans le temps sont sélectionnées dans la colonne **Restaurer** de la grille **Jeux de sauvegarde à restaurer** .</span><span class="sxs-lookup"><span data-stu-id="d449f-150">After you have specified a specific point in time, the Database Recovery Advisor ensures that only backups that are required for restoring to that point in time are selected in the **Restore** column of the **Backup sets to restore** grid.</span></span> <span data-ttu-id="d449f-151">Ces sauvegardes sélectionnées constituent le plan de restauration recommandé pour votre limite de restauration dans le temps.</span><span class="sxs-lookup"><span data-stu-id="d449f-151">These selected backups make up the recommended restore plan for your point-in-time restore.</span></span> <span data-ttu-id="d449f-152">Utilisez uniquement les sauvegardes sélectionnées pour votre opération de restauration jusqu'à une date et heure.</span><span class="sxs-lookup"><span data-stu-id="d449f-152">You should use only the selected backups for your point-in-time restore operation.</span></span>  
  
     <span data-ttu-id="d449f-153">Pour plus d’informations sur les colonnes de la grille **Jeux de sauvegarde à restaurer** , consultez [Restaurer la base de données &#40;page Général&#41;](../../integration-services/general-page-of-integration-services-designers-options.md).</span><span class="sxs-lookup"><span data-stu-id="d449f-153">For information about the columns in the **Backup sets to restore** grid, see [Restore Database &#40;General Page&#41;](../../integration-services/general-page-of-integration-services-designers-options.md).</span></span> <span data-ttu-id="d449f-154">Pour plus d’informations sur l’Assistant de récupération de base de données, consultez [Vue d’ensemble de la restauration et de la récupération &#40;SQL Server&#41;](restore-and-recovery-overview-sql-server.md).</span><span class="sxs-lookup"><span data-stu-id="d449f-154">For information about the Database Recovery Advisor, see [Restore and Recovery Overview &#40;SQL Server&#41;](restore-and-recovery-overview-sql-server.md).</span></span>  
  
10. <span data-ttu-id="d449f-155">Dans la page **Options** , dans le volet **Options de restauration** , vous pouvez choisir les options suivantes si elles s'appliquent à votre situation :</span><span class="sxs-lookup"><span data-stu-id="d449f-155">On the **Options** page, in the **Restore options** panel, you can select any of the following options, if appropriate for your situation:</span></span>  
  
    -   <span data-ttu-id="d449f-156">**Remplacer la base de données existante (WITH REPLACE)**</span><span class="sxs-lookup"><span data-stu-id="d449f-156">**Overwrite the existing database (WITH REPLACE)**</span></span>  
  
    -   <span data-ttu-id="d449f-157">**Conserver les paramètres de la réplication (WITH KEEP_REPLICATION)**</span><span class="sxs-lookup"><span data-stu-id="d449f-157">**Preserve the replication settings (WITH KEEP_REPLICATION)**</span></span>  
  
    -   <span data-ttu-id="d449f-158">**Restreindre l'accès à la base de données restaurée (WITH RESTRICTED_USER)**</span><span class="sxs-lookup"><span data-stu-id="d449f-158">**Restrict access to the restored database (WITH RESTRICTED_USER)**</span></span>  
  
     <span data-ttu-id="d449f-159">Pour plus d’informations sur ces options, consultez [Restaurer la base de données &#40;page Options&#41;](restore-database-options-page.md).</span><span class="sxs-lookup"><span data-stu-id="d449f-159">For more information about these options, see [Restore Database &#40;Options Page&#41;](restore-database-options-page.md).</span></span>  
  
11. <span data-ttu-id="d449f-160">Sélectionnez une option pour la zone **État de récupération** .</span><span class="sxs-lookup"><span data-stu-id="d449f-160">Select an option for the **Recovery state** box.</span></span> <span data-ttu-id="d449f-161">Cette zone détermine l'état de la base de données à l'issue de l'opération de restauration.</span><span class="sxs-lookup"><span data-stu-id="d449f-161">This box determines the state of the database after the restore operation.</span></span>  
  
    -   <span data-ttu-id="d449f-162">**RESTORE WITH RECOVERY** est le comportement par défaut qui laisse la base de données opérationnelle en annulant les transactions non validées.</span><span class="sxs-lookup"><span data-stu-id="d449f-162">**RESTORE WITH RECOVERY** is the default behavior which leaves the database ready for use by rolling back the uncommitted transactions.</span></span> <span data-ttu-id="d449f-163">Les journaux des transactions supplémentaires ne peuvent pas être restaurés.</span><span class="sxs-lookup"><span data-stu-id="d449f-163">Additional transaction logs cannot be restored.</span></span> <span data-ttu-id="d449f-164">Choisissez cette option si vous restaurez toutes les sauvegardes nécessaires maintenant.</span><span class="sxs-lookup"><span data-stu-id="d449f-164">Select this option if you are restoring all of the necessary backups now.</span></span>  
  
    -   <span data-ttu-id="d449f-165">**RESTORE WITH NORECOVERY** qui laisse la base de données non opérationnelle et n’annule pas les transactions non validées.</span><span class="sxs-lookup"><span data-stu-id="d449f-165">**RESTORE WITH NORECOVERY** which leaves the database non-operational, and does not roll back the uncommitted transactions.</span></span> <span data-ttu-id="d449f-166">Les journaux des transactions supplémentaires peuvent être restaurés.</span><span class="sxs-lookup"><span data-stu-id="d449f-166">Additional transaction logs can be restored.</span></span> <span data-ttu-id="d449f-167">La base de données ne peut pas être utilisée tant qu'elle n'est pas récupérée.</span><span class="sxs-lookup"><span data-stu-id="d449f-167">The database cannot be used until it is recovered.</span></span>  
  
    -   <span data-ttu-id="d449f-168">**RESTORE WITH STANDBY** qui laisse la base de données en lecture seule.</span><span class="sxs-lookup"><span data-stu-id="d449f-168">**RESTORE WITH STANDBY** which leaves the database in read-only mode.</span></span> <span data-ttu-id="d449f-169">Elle annule les transactions non validées, mais enregistre les actions d'annulation dans un fichier afin de rendre réversibles les effets de la récupération.</span><span class="sxs-lookup"><span data-stu-id="d449f-169">It undoes uncommitted transactions, but saves the undo actions in a standby file so that recovery effects can be reverted.</span></span>  
  
     <span data-ttu-id="d449f-170">Pour obtenir des descriptions des options, consultez [Restaurer la base de données &#40;page Options&#41;](restore-database-options-page.md).</span><span class="sxs-lookup"><span data-stu-id="d449f-170">For descriptions of the options, see [Restore Database &#40;Options Page&#41;](restore-database-options-page.md).</span></span>  
  
12. <span data-ttu-id="d449f-171">L’option**Effectuer la sauvegarde de la fin du journal avant la restauration** est sélectionnée si elle s’avère nécessaire pour le moment sélectionné.</span><span class="sxs-lookup"><span data-stu-id="d449f-171">**Take tail-log backup before restore** will be selected if it is necessary for the point in time that you have selected.</span></span> <span data-ttu-id="d449f-172">Vous n'avez pas besoin de modifier ce paramètre, mais vous pouvez choisir de sauvegarder la fin du journal même si ce n'est pas obligatoire.</span><span class="sxs-lookup"><span data-stu-id="d449f-172">You do not need to modify this setting, but you can choose to backup the tail of the log even if it is not required.</span></span>  
  
13. <span data-ttu-id="d449f-173">Les opérations de restauration peuvent échouer s'il existe des connexions actives à la base de données.</span><span class="sxs-lookup"><span data-stu-id="d449f-173">Restore operations may fail if there are active connections to the database.</span></span> <span data-ttu-id="d449f-174">Activez l'option **Fermer les connexions existantes** pour garantir que toutes les connexions actives entre [!INCLUDE[ssManStudio](../../includes/ssmanstudio-md.md)] et la base de données sont fermées.</span><span class="sxs-lookup"><span data-stu-id="d449f-174">Check the **Close existing connections option** to ensure that all active connections between [!INCLUDE[ssManStudio](../../includes/ssmanstudio-md.md)] and the database are closed.</span></span> <span data-ttu-id="d449f-175">Cette case à cocher définit la base de données en mode mono-utilisateur avant d'effectuer les opérations de restauration, et définit la base de données en mode multi-utilisateur une fois l'opération terminée.</span><span class="sxs-lookup"><span data-stu-id="d449f-175">This check box sets the database to single user mode before performing the restore operations, and sets the database to multi-user mode when complete.</span></span>  
  
14. <span data-ttu-id="d449f-176">Sélectionnez **Demander confirmation avant chaque restauration de sauvegarde** si vous souhaitez être invité entre chaque opération de restauration.</span><span class="sxs-lookup"><span data-stu-id="d449f-176">Select **Prompt before restoring each backup** if you wish to be prompted between each restore operation.</span></span> <span data-ttu-id="d449f-177">Cela n'est généralement pas nécessaire à moins que la base de données ne soit volumineuse et que vous ne souhaitiez surveiller l'état de l'opération de restauration.</span><span class="sxs-lookup"><span data-stu-id="d449f-177">This is not usually necessary unless the database is large and you wish to monitor the status of the restore operation.</span></span>  
  
##  <a name="using-transact-sql"></a><a name="TsqlProcedure"></a> <span data-ttu-id="d449f-178">Utilisation de Transact-SQL</span><span class="sxs-lookup"><span data-stu-id="d449f-178">Using Transact-SQL</span></span>  
 <span data-ttu-id="d449f-179">**Avant de commencer**</span><span class="sxs-lookup"><span data-stu-id="d449f-179">**Before you begin**</span></span>  
  
 <span data-ttu-id="d449f-180">La restauration d'une heure spécifiée est toujours effectuée à partir d'une sauvegarde de fichier journal.</span><span class="sxs-lookup"><span data-stu-id="d449f-180">A specified time is always restored from a log backup.</span></span> <span data-ttu-id="d449f-181">Dans chaque instruction RESTORE LOG de la séquence de restauration, vous devez spécifier votre heure cible ou votre transaction dans une clause STOPAT identique.</span><span class="sxs-lookup"><span data-stu-id="d449f-181">In every RESTORE LOG statement of the restore sequence, you must specify your target time or transaction in an identical STOPAT clause.</span></span> <span data-ttu-id="d449f-182">Comme condition préalable dans une restauration limitée dans le temps, vous devez restaurer une sauvegarde complète de base de données dont le point d'arrêt est antérieur à votre heure de restauration cible.</span><span class="sxs-lookup"><span data-stu-id="d449f-182">As a prerequisite to a point-in-time restore, you must first restore a full database backup whose end point is earlier than your target restore time.</span></span> <span data-ttu-id="d449f-183">Cette sauvegarde complète de base de données peut être plus ancienne que la sauvegarde complète de base de données la plus récente dans la mesure où vous restaurez ensuite chaque sauvegarde de fichier journal suivante jusqu'à la sauvegarde de fichier journal (comprise) contenant votre limite dans le temps cible.</span><span class="sxs-lookup"><span data-stu-id="d449f-183">That full database backup can be older than the most recent full database backup as long as you then restore every subsequent log backup, up to and including the log backup that contains your target point in time.</span></span>  
  
 <span data-ttu-id="d449f-184">Pour vous aider à identifier la sauvegarde de base à restaurer, vous pouvez éventuellement spécifier votre clause WITH STOPAT dans l'instruction RESTORE DATABASE afin de générer une erreur lorsqu'une sauvegarde de données est trop récente pour l'heure cible spécifiée.</span><span class="sxs-lookup"><span data-stu-id="d449f-184">To help you identify which database backup to restore, you can optionally specify your WITH STOPAT clause in your RESTORE DATABASE statement to raise an error if a data backup is too recent for the specified target time.</span></span> <span data-ttu-id="d449f-185">La sauvegarde de données complète est toujours restaurée, même si elle contient l'heure cible.</span><span class="sxs-lookup"><span data-stu-id="d449f-185">The complete data backup is always restored, even if it contains the target time.</span></span>  
  
 <span data-ttu-id="d449f-186">**Syntaxe [!INCLUDE[tsql](../../includes/tsql-md.md)] de base**</span><span class="sxs-lookup"><span data-stu-id="d449f-186">**Basic [!INCLUDE[tsql](../../includes/tsql-md.md)] syntax**</span></span>  
  
 <span data-ttu-id="d449f-187">Restaurer les *database_name* de journal à partir de <backup_device> avec STOPAT \*\* = *`time`* ,\*\* Recovery...</span><span class="sxs-lookup"><span data-stu-id="d449f-187">RESTORE LOG *database_name* FROM <backup_device> WITH STOPAT **=*`time`*,** RECOVERY...</span></span>  
  
 <span data-ttu-id="d449f-188">Le point de récupération est la dernière validation de transaction qui s’est produite à ou avant la `datetime` valeur spécifiée par *heure*.</span><span class="sxs-lookup"><span data-stu-id="d449f-188">The recovery point is the latest transaction commit that occurred at or before the `datetime` value that is specified by *time*.</span></span>  
  
 <span data-ttu-id="d449f-189">Pour restaurer uniquement les modifications apportées avant un moment spécifique dans le temps, spécifiez WITH STOPAT **=** *time* pour chaque sauvegarde que vous restaurez.</span><span class="sxs-lookup"><span data-stu-id="d449f-189">To restore only the modifications that were made before a specific point in time, specify WITH STOPAT **=** *time* for each backup you restore.</span></span> <span data-ttu-id="d449f-190">De cette manière, vous êtes certain de ne pas dépasser le moment cible.</span><span class="sxs-lookup"><span data-stu-id="d449f-190">This makes sure that you do not go past the target time.</span></span>  
  
 <span data-ttu-id="d449f-191">**Pour restaurer une base de données à un point dans le temps**</span><span class="sxs-lookup"><span data-stu-id="d449f-191">**To restore a database to a point in time**</span></span>  
  
> [!NOTE]  
>  <span data-ttu-id="d449f-192">Pour obtenir un exemple de cette procédure, consultez [Exemple (Transact-SQL)](#TsqlExample)plus loin dans cette section.</span><span class="sxs-lookup"><span data-stu-id="d449f-192">For an example of this procedure, see [Example (Transact-SQL)](#TsqlExample), later in this section.</span></span>  
  
1.  <span data-ttu-id="d449f-193">Connectez -vous à l'instance de serveur sur laquelle vous souhaitez restaurer la base de données.</span><span class="sxs-lookup"><span data-stu-id="d449f-193">Connect to server instance on which you want to restore the database.</span></span>  
  
2.  <span data-ttu-id="d449f-194">Exécutez l'instruction RESTORE DATABASE à l'aide de l'option NORECOVERY.</span><span class="sxs-lookup"><span data-stu-id="d449f-194">Execute the RESTORE DATABASE statement using the NORECOVERY option.</span></span>  
  
    > [!NOTE]  
    >  <span data-ttu-id="d449f-195">Si une séquence de restauration partielle exclut tout groupe de fichiers [FILESTREAM](../blob/filestream-sql-server.md) , la limite de restauration dans le temps n’est pas prise en charge.</span><span class="sxs-lookup"><span data-stu-id="d449f-195">If a partial restore sequence excludes any [FILESTREAM](../blob/filestream-sql-server.md) filegroup, point-in-time restore is not supported.</span></span> <span data-ttu-id="d449f-196">Vous pouvez forcer la séquence de restauration à continuer.</span><span class="sxs-lookup"><span data-stu-id="d449f-196">You can force the restore sequence to continue.</span></span> <span data-ttu-id="d449f-197">Cependant, les groupes de fichiers FILESTREAM omis de l'instruction RESTORE ne peuvent jamais être restaurés.</span><span class="sxs-lookup"><span data-stu-id="d449f-197">However the FILESTREAM filegroups that are omitted from your RESTORE statement can never be restored.</span></span> <span data-ttu-id="d449f-198">Pour forcer une limite de restauration dans le temps, spécifiez l'option CONTINUE_AFTER_ERROR avec l'option STOPAT, STOPATMARK ou STOPBEFOREMARKx, que vous devez également spécifier dans vos instructions RESTORE LOG suivantes.</span><span class="sxs-lookup"><span data-stu-id="d449f-198">To force a point-in-time restore, specify the CONTINUE_AFTER_ERROR option together with the STOPAT, STOPATMARK, or STOPBEFOREMARK option, which you must also specify in your subsequent RESTORE LOG statements.</span></span> <span data-ttu-id="d449f-199">Si vous spécifiez l'option CONTINUE_AFTER_ERROR, la séquence de restauration partielle réussit et le groupe de fichiers FILESTREAM devient irrécupérable.</span><span class="sxs-lookup"><span data-stu-id="d449f-199">If you specify CONTINUE_AFTER_ERROR, the partial restore sequence succeeds and the FILESTREAM filegroup becomes unrecoverable.</span></span>  
  
3.  <span data-ttu-id="d449f-200">Restaurez la dernière sauvegarde différentielle de base de données, si elle existe, sans récupérer la base de données (RESTORE DATABASE *database_name* FROM *backup_device* WITH NORECOVERY).</span><span class="sxs-lookup"><span data-stu-id="d449f-200">Restore the last differential database backup, if any,  without recovering the database (RESTORE DATABASE *database_name* FROM *backup_device* WITH NORECOVERY).</span></span>  
  
4.  <span data-ttu-id="d449f-201">Appliquez chaque sauvegarde du journal des transactions dans l’ordre dans lequel elles ont été créées, en spécifiant l’heure à laquelle vous avez l’intention d’arrêter la restauration du journal (RESTORE DATABASE *database_name* de <backup_device> avec STOPAT\*\* = *`time`* ,\*\* Recovery).</span><span class="sxs-lookup"><span data-stu-id="d449f-201">Apply each transaction log backup in the same sequence in which they were created, specifying the time at which you intend to stop restoring log (RESTORE DATABASE *database_name* FROM <backup_device> WITH STOPAT**=*`time`*,** RECOVERY).</span></span>  
  
    > [!NOTE]  
    >  <span data-ttu-id="d449f-202">Options RECOVERY et STOPAT.</span><span class="sxs-lookup"><span data-stu-id="d449f-202">The RECOVERY and STOPAT options.</span></span> <span data-ttu-id="d449f-203">Si la sauvegarde du journal des transactions ne contient pas l'heure demandée (par exemple, si l'heure spécifiée dépasse la dernière heure figurant dans le journal des transactions), un avertissement est émis et la base de données n'est pas récupérée.</span><span class="sxs-lookup"><span data-stu-id="d449f-203">If the transaction log backup does not contain the requested time (for example, if the time specified is beyond the end of the time covered by the transaction log), a warning is generated and the database remains unrecovered.</span></span>  
  
###  <a name="example-transact-sql"></a><a name="TsqlExample"></a> <span data-ttu-id="d449f-204">Exemple (Transact-SQL)</span><span class="sxs-lookup"><span data-stu-id="d449f-204">Example (Transact-SQL)</span></span>  
 <span data-ttu-id="d449f-205">L'exemple suivant restaure une base de données dans l'état où elle se trouvait le `12:00 AM` à `April 15, 2020` et décrit une opération de restauration impliquant plusieurs sauvegardes de fichiers journaux.</span><span class="sxs-lookup"><span data-stu-id="d449f-205">The following example restores a database to its state as of `12:00 AM` on `April 15, 2020` and shows a restore operation that involves multiple log backups.</span></span> <span data-ttu-id="d449f-206">Sur l'unité de sauvegarde `AdventureWorksBackups`, la sauvegarde de base de données complète à restaurer correspond au troisième jeu de sauvegarde (`FILE = 3`), la première sauvegarde de fichier journal correspond au quatrième jeu de sauvegarde (`FILE = 4`) et la seconde sauvegarde de fichier journal correspond au cinquième jeu de sauvegarde (`FILE = 5`).</span><span class="sxs-lookup"><span data-stu-id="d449f-206">On the backup device, `AdventureWorksBackups`, the full database backup to be restored is the third backup set on the device (`FILE = 3`), the first log backup is the fourth backup set (`FILE = 4`), and the second log backup is the fifth backup set (`FILE = 5`).</span></span>  
  
> [!IMPORTANT]  
>  <span data-ttu-id="d449f-207">La base de données [!INCLUDE[ssSampleDBobject](../../includes/sssampledbobject-md.md)] utilise le mode de récupération simple.</span><span class="sxs-lookup"><span data-stu-id="d449f-207">The [!INCLUDE[ssSampleDBobject](../../includes/sssampledbobject-md.md)] database uses the simple recovery model.</span></span> <span data-ttu-id="d449f-208">Pour autoriser les sauvegardes de fichier journal, avant d'effectuer une sauvegarde complète de base de données, la base de données a été configurée pour utiliser le mode de récupération complète par le biais de `ALTER DATABASE AdventureWorks SET RECOVERY FULL`.</span><span class="sxs-lookup"><span data-stu-id="d449f-208">To permit log backups, before taking a full database backup, the database was set to use the full recovery model, using `ALTER DATABASE AdventureWorks SET RECOVERY FULL`.</span></span>  
  
```  
RESTORE DATABASE AdventureWorks  
   FROM AdventureWorksBackups  
   WITH FILE=3, NORECOVERY;  
  
RESTORE LOG AdventureWorks  
   FROM AdventureWorksBackups  
   WITH FILE=4, NORECOVERY, STOPAT = 'Apr 15, 2020 12:00 AM';  
  
RESTORE LOG AdventureWorks  
   FROM AdventureWorksBackups  
   WITH FILE=5, NORECOVERY, STOPAT = 'Apr 15, 2020 12:00 AM';  
RESTORE DATABASE AdventureWorks WITH RECOVERY;   
GO  
  
```  
  
##  <a name="related-tasks"></a><a name="RelatedTasks"></a> <span data-ttu-id="d449f-209">Tâches associées</span><span class="sxs-lookup"><span data-stu-id="d449f-209">Related Tasks</span></span>  
  
-   [<span data-ttu-id="d449f-210">Restaurer une sauvegarde de base de données &#40;SQL Server Management Studio&#41;</span><span class="sxs-lookup"><span data-stu-id="d449f-210">Restore a Database Backup &#40;SQL Server Management Studio&#41;</span></span>](restore-a-database-backup-using-ssms.md)  
  
-   [<span data-ttu-id="d449f-211">Sauvegarder un journal des transactions &#40;SQL Server&#41;</span><span class="sxs-lookup"><span data-stu-id="d449f-211">Back Up a Transaction Log &#40;SQL Server&#41;</span></span>](back-up-a-transaction-log-sql-server.md)  
  
-   [<span data-ttu-id="d449f-212">Restaurer une base de données jusqu’au point d’échec en mode de récupération complète &#40;Transact-SQL&#41;</span><span class="sxs-lookup"><span data-stu-id="d449f-212">Restore a Database to the Point of Failure Under the Full Recovery Model &#40;Transact-SQL&#41;</span></span>](restore-database-to-point-of-failure-full-recovery.md)  
  
-   [<span data-ttu-id="d449f-213">Restaurer une base de données jusqu’à une transaction marquée &#40;SQL Server Management Studio&#41;</span><span class="sxs-lookup"><span data-stu-id="d449f-213">Restore a Database to a Marked Transaction &#40;SQL Server Management Studio&#41;</span></span>](restore-a-database-to-a-marked-transaction-sql-server-management-studio.md)  
  
-   [<span data-ttu-id="d449f-214">Récupérer un numéro séquentiel dans le journal &#40;SQL Server&#41;</span><span class="sxs-lookup"><span data-stu-id="d449f-214">Recover to a Log Sequence Number &#40;SQL Server&#41;</span></span>](recover-to-a-log-sequence-number-sql-server.md)  
  
## <a name="see-also"></a><span data-ttu-id="d449f-215">Voir aussi</span><span class="sxs-lookup"><span data-stu-id="d449f-215">See Also</span></span>  
 <span data-ttu-id="d449f-216">[backupset &#40;Transact-SQL&#41;](/sql/relational-databases/system-tables/backupset-transact-sql) </span><span class="sxs-lookup"><span data-stu-id="d449f-216">[backupset &#40;Transact-SQL&#41;](/sql/relational-databases/system-tables/backupset-transact-sql) </span></span>  
 <span data-ttu-id="d449f-217">[RESTORE &#40;Transact-SQL&#41;](/sql/t-sql/statements/restore-statements-transact-sql) </span><span class="sxs-lookup"><span data-stu-id="d449f-217">[RESTORE &#40;Transact-SQL&#41;](/sql/t-sql/statements/restore-statements-transact-sql) </span></span>  
 [<span data-ttu-id="d449f-218">RESTORE HEADERONLY &#40;Transact-SQL&#41;</span><span class="sxs-lookup"><span data-stu-id="d449f-218">RESTORE HEADERONLY &#40;Transact-SQL&#41;</span></span>](/sql/t-sql/statements/restore-statements-headeronly-transact-sql)  
  
  
