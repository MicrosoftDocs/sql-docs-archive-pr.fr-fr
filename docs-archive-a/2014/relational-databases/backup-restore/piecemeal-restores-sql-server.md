---
title: Restaurations fragmentaires (SQL Server) | Microsoft Docs
ms.custom: ''
ms.date: 06/13/2017
ms.prod: sql-server-2014
ms.reviewer: ''
ms.technology: backup-restore
ms.topic: conceptual
helpviewer_keywords:
- partial updates [SQL Server]
- staged restores [SQL Server]
- piecemeal restores [SQL Server]
- restoring [SQL Server], piecemeal restore scenario
ms.assetid: 208f55e0-0762-4cfb-85c4-d36a76ea0f5b
author: MikeRayMSFT
ms.author: mikeray
ms.openlocfilehash: ebc4ea11780908f847946a01338571211b57678a
ms.sourcegitcommit: ad4d92dce894592a259721a1571b1d8736abacdb
ms.translationtype: MT
ms.contentlocale: fr-FR
ms.lasthandoff: 08/04/2020
ms.locfileid: "87699815"
---
# <a name="piecemeal-restores-sql-server"></a><span data-ttu-id="026ee-102">Restaurations fragmentaires (SQL Server)</span><span class="sxs-lookup"><span data-stu-id="026ee-102">Piecemeal Restores (SQL Server)</span></span>
  <span data-ttu-id="026ee-103">Cette rubrique concerne uniquement les bases de données de l'édition Enterprise de [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] qui contiennent plusieurs fichiers ou groupes de fichiers et, dans le mode simple, seulement des groupes de fichiers en lecture seule.</span><span class="sxs-lookup"><span data-stu-id="026ee-103">This topic is relevant only for databases in the Enterprise edition of [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] that contain multiple files or filegroups; and, under the simple model, only for read-only filegroups.</span></span>  
  
 <span data-ttu-id="026ee-104">Pour plus d’informations sur les restaurations fragmentaires et les tables optimisées en mémoire, consultez [Restauration fragmentaire de bases de données avec des tables optimisées en mémoire](../in-memory-oltp/memory-optimized-tables.md).</span><span class="sxs-lookup"><span data-stu-id="026ee-104">For information about piecemeal restore and memory-optimized tables, see [Piecemeal Restore of Databases With Memory-Optimized Tables](../in-memory-oltp/memory-optimized-tables.md).</span></span>  
  
 <span data-ttu-id="026ee-105">Une*restauration fragmentaire* autorise la restauration et la récupération par étapes des bases de données contenant plusieurs groupes de fichiers.</span><span class="sxs-lookup"><span data-stu-id="026ee-105">*Piecemeal restore* allows databases that contain multiple filegroups to be restored and recovered in stages.</span></span> <span data-ttu-id="026ee-106">La restauration fragmentaire implique une suite de séquences de restauration, en commençant par le groupe de fichiers primaire et, dans certains cas, un ou plusieurs groupes de fichiers secondaires.</span><span class="sxs-lookup"><span data-stu-id="026ee-106">Piecemeal restore involves a series of restore sequences, starting with the primary filegroup and, in some cases, one or more secondary filegroups.</span></span> <span data-ttu-id="026ee-107">La restauration fragmentaire maintient des contrôles pour garantir la cohérence de la base de données au final.</span><span class="sxs-lookup"><span data-stu-id="026ee-107">Piecemeal restore maintains checks to ensure that the database will be consistent in the end.</span></span> <span data-ttu-id="026ee-108">À l'issue de la séquence de restauration, les fichiers récupérés (s'ils sont valides et cohérents avec la base de données) peuvent être mis en ligne directement.</span><span class="sxs-lookup"><span data-stu-id="026ee-108">After the restore sequence is completed, recovered files, if they are valid and consistent with the database, can be brought online directly.</span></span>  
  
 <span data-ttu-id="026ee-109">La restauration fragmentaire fonctionne dans tous les modes de récupération, mais elle offre davantage de souplesse dans le mode de restauration complète et dans le mode de récupération utilisant les journaux de transactions que dans le mode de récupération simple.</span><span class="sxs-lookup"><span data-stu-id="026ee-109">Piecemeal restore works with all recovery models, but is more flexible for the full and bulk-logged models than for the simple model.</span></span>  
  
 <span data-ttu-id="026ee-110">Chaque restauration fragmentaire commence par une séquence de restauration initiale appelée *séquence de restauration partielle*.</span><span class="sxs-lookup"><span data-stu-id="026ee-110">Every piecemeal restore starts with an initial restore sequence called the *partial-restore sequence*.</span></span> <span data-ttu-id="026ee-111">Au minimum, la séquence de restauration partielle restaure et récupère le groupe de fichiers primaire et, en mode de récupération simple, tous les groupes de fichiers qui sont en lecture/écriture.</span><span class="sxs-lookup"><span data-stu-id="026ee-111">Minimally, the partial-restore sequence restores and recovers the primary filegroup and, under the simple recovery model, all read/write filegroups.</span></span> <span data-ttu-id="026ee-112">Pendant la séquence de restauration fragmentaire, la totalité de la base de données doit se trouver hors connexion.</span><span class="sxs-lookup"><span data-stu-id="026ee-112">During the piecemeal-restore sequence, the whole database must go offline.</span></span> <span data-ttu-id="026ee-113">Après l'étape initiale, la base de données est en ligne et les groupes de fichiers restaurés sont disponibles.</span><span class="sxs-lookup"><span data-stu-id="026ee-113">Thereafter, the database is online and restored filegroups are available.</span></span> <span data-ttu-id="026ee-114">Toutefois, les groupes de fichiers non restaurés restent hors connexion et inaccessibles.</span><span class="sxs-lookup"><span data-stu-id="026ee-114">However, any unrestored filegroups remain offline and are not accessible.</span></span> <span data-ttu-id="026ee-115">Les groupes de fichiers hors connexion peuvent cependant être restaurés et mis en ligne ultérieurement via une restauration de fichiers.</span><span class="sxs-lookup"><span data-stu-id="026ee-115">Any offline filegroups, however, can be restored and brought online later by a file restore.</span></span>  
  
 <span data-ttu-id="026ee-116">Sans tenir compte du mode de récupération utilisé par la base de données, la séquence de restauration partielle commence par une instruction RESTORE DATABASE qui restaure une sauvegarde complète et spécifie l'option PARTIAL.</span><span class="sxs-lookup"><span data-stu-id="026ee-116">Regardless of the recovery model that is used by the database, the partial-restore sequence starts with a RESTORE DATABASE statement that restores a full backup and specifies the PARTIAL option.</span></span> <span data-ttu-id="026ee-117">Une nouvelle restauration fragmentaire commence toujours par cette option ; par conséquent, il vous suffit de spécifier PARTIAL une seule fois dans l'instruction initiale de la séquence de restauration partielle.</span><span class="sxs-lookup"><span data-stu-id="026ee-117">The PARTIAL option always starts a new piecemeal restore; therefore, you must specify PARTIAL only one time in the initial statement of the partial-restore sequence.</span></span> <span data-ttu-id="026ee-118">Lorsque la séquence de restauration partielle est terminée et que la base de données est mise en ligne, les fichiers restants sont dans l'état « récupération en attente » du fait que la récupération des fichiers est reportée.</span><span class="sxs-lookup"><span data-stu-id="026ee-118">When the partial restore sequence finishes and the database is brought online, the state of the remaining files becomes "recovery pending" because their recovery has been postponed.</span></span>  
  
 <span data-ttu-id="026ee-119">Par la suite, une restauration fragmentaire comprend généralement une ou plusieurs séquences de restauration appelées *séquences de restauration de groupe de fichiers*.</span><span class="sxs-lookup"><span data-stu-id="026ee-119">Subsequently, a piecemeal restore typically includes one or more restore sequences, which are called *filegroup-restore sequences*.</span></span> <span data-ttu-id="026ee-120">Vous pouvez retarder l'exécution d'une séquence de restauration de groupe de fichiers aussi longtemps que vous le souhaitez.</span><span class="sxs-lookup"><span data-stu-id="026ee-120">You can wait to perform a specific filegroup-restore sequence for as long as you want.</span></span> <span data-ttu-id="026ee-121">Chaque séquence de restauration de groupe de fichiers restaure et récupère un ou plusieurs groupes de fichiers hors connexion jusqu'à un point cohérent avec la base de données.</span><span class="sxs-lookup"><span data-stu-id="026ee-121">Each filegroup-restore sequence restores and recovers one or more offline filegroups to a point consistent with the database.</span></span> <span data-ttu-id="026ee-122">La fréquence et le nombre de séquences de restauration de groupe de fichiers dépendent de votre objectif de récupération, du nombre de groupes de fichiers hors connexion que vous souhaitez restaurer et du nombre d'entre eux que vous restaurez par séquence de restauration de groupe de fichiers.</span><span class="sxs-lookup"><span data-stu-id="026ee-122">The timing and number of filegroup-restore sequences depends on your recovery goal, the number of offline filegroups you want to restore, and on how many of them you restore per filegroup-restore sequence.</span></span>  
  
 <span data-ttu-id="026ee-123">Les conditions requises qui correspondent précisément à l'exécution d'une restauration fragmentaire dépendent du mode de récupération de la base de données.</span><span class="sxs-lookup"><span data-stu-id="026ee-123">The exact requirements for performing a piecemeal restore depend on the recovery model of the database.</span></span> <span data-ttu-id="026ee-124">Pour plus d'informations, consultez les sections « Restauration fragmentaire en mode de récupération simple » et « Restauration fragmentaire en mode de récupération complète » plus loin dans cette rubrique.</span><span class="sxs-lookup"><span data-stu-id="026ee-124">For more information, see "Piecemeal Restore Under the Simple Recovery Model" and "Piecemeal Restore Under the Full Recovery Model," later in this topic.</span></span>  
  
## <a name="piecemeal-restore-scenarios"></a><span data-ttu-id="026ee-125">Scénarios de restauration fragmentaire</span><span class="sxs-lookup"><span data-stu-id="026ee-125">Piecemeal Restore Scenarios</span></span>  
 <span data-ttu-id="026ee-126">Toutes les éditions de [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] prennent en charge les restaurations fragmentaires hors connexion.</span><span class="sxs-lookup"><span data-stu-id="026ee-126">All editions of [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] support offline piecemeal restores.</span></span> <span data-ttu-id="026ee-127">Dans l'édition Enterprise, les restaurations fragmentaires peuvent être en ligne ou hors connexion.</span><span class="sxs-lookup"><span data-stu-id="026ee-127">In the Enterprise edition, a piecemeal restore can be either online or offline.</span></span> <span data-ttu-id="026ee-128">L'impact des restaurations en ligne et hors connexion est le suivant :</span><span class="sxs-lookup"><span data-stu-id="026ee-128">The implications of offline and online piecemeal restores are as follows:</span></span>  
  
-   <span data-ttu-id="026ee-129">Scénario de restauration fragmentaire hors connexion</span><span class="sxs-lookup"><span data-stu-id="026ee-129">Offline piecemeal restore scenario</span></span>  
  
     <span data-ttu-id="026ee-130">Dans une restauration fragmentaire hors ligne, la base de données est en ligne après la séquence de restauration partielle.</span><span class="sxs-lookup"><span data-stu-id="026ee-130">In an offline piecemeal restore, the database is online after the partial-restore sequence.</span></span> <span data-ttu-id="026ee-131">Les groupes de fichiers qui n'ont pas encore été restaurés demeurent hors connexion mais si cela est nécessaire, ils peuvent être restaurés une fois la base de données mise hors connexion.</span><span class="sxs-lookup"><span data-stu-id="026ee-131">Filegroups that have not yet been restored remain offline, but they can be restored as you need them after taking the database offline.</span></span>  
  
-   <span data-ttu-id="026ee-132">Scénario de restauration fragmentaire en ligne</span><span class="sxs-lookup"><span data-stu-id="026ee-132">Online piecemeal restore scenario</span></span>  
  
     <span data-ttu-id="026ee-133">En cas de restauration fragmentaire en ligne, au terme de la séquence de restauration partielle, la base de données est en ligne et le groupe de fichiers primaire ainsi que tout groupe de fichiers secondaire récupéré sont mis à votre disposition.</span><span class="sxs-lookup"><span data-stu-id="026ee-133">In an online piecemeal restore, after the partial-restore sequence, the database is online, and the primary filegroup and any recovered secondary filegroups are available.</span></span> <span data-ttu-id="026ee-134">Les groupes de fichiers qui ne sont pas encore restaurés restent hors ligne, mais ils peuvent être restaurés le cas échéant alors que la base de données reste en ligne.</span><span class="sxs-lookup"><span data-stu-id="026ee-134">Filegroups that have not yet been restored remain offline, but they can be restored as needed while the database remains online.</span></span>  
  
     <span data-ttu-id="026ee-135">Les restaurations fragmentaires en ligne peuvent contenir des transactions différées.</span><span class="sxs-lookup"><span data-stu-id="026ee-135">Online piecemeal restores can involve deferred transactions.</span></span> <span data-ttu-id="026ee-136">Lorsque la restauration ne concerne qu'un sous-ensemble de groupes de fichiers, les transactions de la base de données qui dépendent des groupes de fichiers en ligne peuvent être différées.</span><span class="sxs-lookup"><span data-stu-id="026ee-136">When only a subset of filegroups has been restored, transactions in the database that depend on online filegroups might become deferred.</span></span> <span data-ttu-id="026ee-137">Ceci est normal car l'ensemble de la base de données doit être cohérent.</span><span class="sxs-lookup"><span data-stu-id="026ee-137">This is typical, because the whole database must be consistent.</span></span> <span data-ttu-id="026ee-138">Pour plus d’informations, consultez [Transactions différées &#40;SQL Server&#41;](deferred-transactions-sql-server.md).</span><span class="sxs-lookup"><span data-stu-id="026ee-138">For more information, see [Deferred Transactions &#40;SQL Server&#41;](deferred-transactions-sql-server.md).</span></span>  
  
-   [!INCLUDE[hek_1](../../includes/hek-1-md.md)] <span data-ttu-id="026ee-139">scénario de restauration fragmentaire</span><span class="sxs-lookup"><span data-stu-id="026ee-139">piecemeal restore scenario</span></span>  
  
     <span data-ttu-id="026ee-140">Pour plus d’informations sur les restaurations fragmentaires des bases de données de l’OLTP en mémoire, consultez [Sauvegarde et restauration fragmentaire de bases de données avec des tables optimisées en mémoire](../in-memory-oltp/memory-optimized-tables.md).</span><span class="sxs-lookup"><span data-stu-id="026ee-140">For information on Piecemeal Restores of In-Memory OLTP databases see [Piecemeal Backup and Restore of Databases With Memory-Optimized Tables](../in-memory-oltp/memory-optimized-tables.md).</span></span>  
  
## <a name="restrictions"></a><span data-ttu-id="026ee-141">Restrictions</span><span class="sxs-lookup"><span data-stu-id="026ee-141">Restrictions</span></span>  
 <span data-ttu-id="026ee-142">Si une séquence de restauration partielle exclut tout groupe de fichiers [FILESTREAM](../blob/filestream-sql-server.md) , la limite de restauration dans le temps n’est pas prise en charge.</span><span class="sxs-lookup"><span data-stu-id="026ee-142">If a partial restore sequence excludes any [FILESTREAM](../blob/filestream-sql-server.md) filegroup, point-in-time restore is not supported.</span></span> <span data-ttu-id="026ee-143">Vous pouvez forcer la séquence de restauration à continuer.</span><span class="sxs-lookup"><span data-stu-id="026ee-143">You can force the restore sequence to continue.</span></span> <span data-ttu-id="026ee-144">Cependant, les groupes de fichiers FILESTREAM omis de l'instruction RESTORE ne peuvent jamais être restaurés.</span><span class="sxs-lookup"><span data-stu-id="026ee-144">However the FILESTREAM filegroups that are omitted from your RESTORE statement can never be restored.</span></span> <span data-ttu-id="026ee-145">Pour forcer une limite de restauration dans le temps, spécifiez l'option CONTINUE_AFTER_ERROR avec l'option STOPAT, STOPATMARK ou STOPBEFOREMARKx, que vous devez également spécifier dans vos instructions RESTORE LOG suivantes.</span><span class="sxs-lookup"><span data-stu-id="026ee-145">To force a point-in-time restore, specify the CONTINUE_AFTER_ERROR option together with the STOPAT, STOPATMARK, or STOPBEFOREMARK option, which you must also specify in your subsequent RESTORE LOG statements.</span></span> <span data-ttu-id="026ee-146">Si vous spécifiez l'option CONTINUE_AFTER_ERROR, la séquence de restauration partielle réussit et le groupe de fichiers FILESTREAM devient irrécupérable.</span><span class="sxs-lookup"><span data-stu-id="026ee-146">If you specify CONTINUE_AFTER_ERROR, the partial restore sequence succeeds and the FILESTREAM filegroup becomes unrecoverable.</span></span>  
  
## <a name="piecemeal-restore-under-the-simple-recovery-model"></a><span data-ttu-id="026ee-147">Restauration fragmentaire en mode de récupération simple</span><span class="sxs-lookup"><span data-stu-id="026ee-147">Piecemeal Restore Under the Simple Recovery Model</span></span>  
 <span data-ttu-id="026ee-148">En mode de récupération simple, la séquence de restauration fragmentaire doit commencer par une sauvegarde de base de données complète ou partielle.</span><span class="sxs-lookup"><span data-stu-id="026ee-148">Under the simple recovery model, the piecemeal restore sequence must start with a full database or partial backup.</span></span> <span data-ttu-id="026ee-149">Puis, si la sauvegarde restaurée est une base différentielle, restaurez ensuite la dernière sauvegarde différentielle.</span><span class="sxs-lookup"><span data-stu-id="026ee-149">Then, if the restored backup is a differential base, restore the latest differential backup next.</span></span>  
  
 <span data-ttu-id="026ee-150">Au cours de la première séquence de restauration partielle, si vous restaurez uniquement un sous-ensemble de groupes de fichiers en lecture/écriture, les groupes de fichiers non restaurés deviennent obsolètes lorsque vous récupérez la base de données restaurée partiellement.</span><span class="sxs-lookup"><span data-stu-id="026ee-150">During the first partial restore sequence, if you restore only a subset of read/write filegroups, any unrestored filegroups become defunct when you recover the partially restored database.</span></span> <span data-ttu-id="026ee-151">L'omission d'un groupe de fichiers en lecture/écriture dans une séquence de restauration partielle convient uniquement dans les cas suivants :</span><span class="sxs-lookup"><span data-stu-id="026ee-151">Omitting a read/write filegroup from the partial-restore sequence is appropriate only in the following cases:</span></span>  
  
-   <span data-ttu-id="026ee-152">Vous prévoyez que les groupes de fichiers non restaurés soient obsolètes.</span><span class="sxs-lookup"><span data-stu-id="026ee-152">You intend for the unrestored filegroups to become defunct.</span></span>  
  
-   <span data-ttu-id="026ee-153">La séquence de restauration parviendra au point de récupération auquel chaque groupe de fichiers non restauré est passé en lecture seule, supprimé ou obsolète (lors d'une restauration antérieure dans la séquence de restauration partielle).</span><span class="sxs-lookup"><span data-stu-id="026ee-153">The restore sequence will arrive at a recovery point at which each unrestored filegroup has become read-only, dropped, or defunct (during a previous restore in the partial-restore sequence).</span></span>  
  
-   <span data-ttu-id="026ee-154">La sauvegarde complète a eu lieu lorsque la base de données utilisait le mode de récupération simple, mais le point de récupération utilisait le mode de récupération complète.</span><span class="sxs-lookup"><span data-stu-id="026ee-154">The full backup was taken while the database was using the simple recovery model, but the recovery point is at a time when the database is using the full recovery model.</span></span> <span data-ttu-id="026ee-155">Pour plus d'informations, consultez « Exécution d'une restauration fragmentaire d'une base de données dont le mode de récupération est passé du mode de récupération complète au mode de récupération simple », plus loin dans cette rubrique.</span><span class="sxs-lookup"><span data-stu-id="026ee-155">For more information, see "Performing a Piecemeal Restore of a Database Whose Recovery Model Has Been Switched from Simple to Full," later in this topic.</span></span>  
  
### <a name="requirements-for-piecemeal-restore-under-the-simple-recovery-model"></a><span data-ttu-id="026ee-156">Conditions requises pour la restauration fragmentaire en mode de récupération simple</span><span class="sxs-lookup"><span data-stu-id="026ee-156">Requirements for Piecemeal Restore Under the Simple Recovery Model</span></span>  
 <span data-ttu-id="026ee-157">En mode de récupération simple, l'étape initiale restaure et récupère le groupe de fichiers primaire et tous les groupes de fichiers secondaires en lecture/écriture.</span><span class="sxs-lookup"><span data-stu-id="026ee-157">Under the simple recovery model, the initial stage restores and recovers the primary filegroup and all read/write secondary filegroups.</span></span> <span data-ttu-id="026ee-158">Au terme de l'étape initiale, les fichiers récupérés (s'ils sont valides et cohérents avec la base de données) peuvent être mis en ligne directement.</span><span class="sxs-lookup"><span data-stu-id="026ee-158">After the initial stage is completed, recovered files, if they are valid and consistent with the database, can be brought online directly.</span></span>  
  
 <span data-ttu-id="026ee-159">Ensuite, les groupes de fichiers en lecture seule peuvent être restaurés en une ou plusieurs étapes supplémentaires.</span><span class="sxs-lookup"><span data-stu-id="026ee-159">Thereafter, read-only filegroups can be restored in one or more additional stages.</span></span>  
  
 <span data-ttu-id="026ee-160">La restauration fragmentaire est disponible pour un groupe de fichiers secondaires en lecture seule uniquement si les conditions suivantes sont vérifiées :</span><span class="sxs-lookup"><span data-stu-id="026ee-160">Piecemeal restore is available for a read-only secondary filegroup only if the following are true:</span></span>  
  
-   <span data-ttu-id="026ee-161">était en lecture seule lors de sa sauvegarde ;</span><span class="sxs-lookup"><span data-stu-id="026ee-161">Was read-only when backed up.</span></span>  
  
-   <span data-ttu-id="026ee-162">est resté en lecture seule (et logiquement cohérent avec le groupe de fichiers primaire).</span><span class="sxs-lookup"><span data-stu-id="026ee-162">Has remained read-only (keeping it logically consistent with the primary filegroup).</span></span>  
  
 <span data-ttu-id="026ee-163">Pour effectuer une restauration fragmentaire, observez les instructions suivantes :</span><span class="sxs-lookup"><span data-stu-id="026ee-163">To perform a piecemeal restore, the following guidelines must be followed:</span></span>  
  
-   <span data-ttu-id="026ee-164">Un ensemble complet de sauvegardes pour la restauration fragmentaire d'une base de données utilisant le mode de récupération simple doit contenir les éléments suivants :</span><span class="sxs-lookup"><span data-stu-id="026ee-164">A complete set of backups for the piecemeal restore of a simple recovery model database must contain the following:</span></span>  
  
    -   <span data-ttu-id="026ee-165">Une sauvegarde partielle ou complète de base de données contenant le groupe de fichiers primaire et tous les groupes de fichiers qui étaient en lecture/écriture au moment de la sauvegarde.</span><span class="sxs-lookup"><span data-stu-id="026ee-165">A partial or full database backup that contains the primary filegroup and all filegroups that were read/write at the time of the backup.</span></span>  
  
    -   <span data-ttu-id="026ee-166">Une sauvegarde de chaque fichier en lecture seule.</span><span class="sxs-lookup"><span data-stu-id="026ee-166">A backup of each read-only file.</span></span>  
  
-   <span data-ttu-id="026ee-167">Pour que la sauvegarde d'un fichier en lecture seule soit cohérente avec le groupe de fichiers primaire, le groupe de fichiers secondaire doit se trouver en lecture seule depuis le moment où il a été sauvegardé jusqu'à l'achèvement de la sauvegarde contenant le groupe de fichiers primaire.</span><span class="sxs-lookup"><span data-stu-id="026ee-167">For the backup of a read-only file to be consistent with the primary filegroup, the secondary filegroup must have been read-only from when it was backed up until the backup that contains the primary filegroup was completed.</span></span> <span data-ttu-id="026ee-168">Vous pouvez utiliser des sauvegardes différentielles de fichiers, sous réserve qu'elles aient été réalisées une fois le groupe de fichiers devenu accessible en lecture seule.</span><span class="sxs-lookup"><span data-stu-id="026ee-168">You can use differential file backups, if they were taken after the filegroup became read-only.</span></span>  
  
### <a name="piecemeal-restore-stages-simple-recovery-model"></a><span data-ttu-id="026ee-169">Procédure de restauration fragmentaire (mode de récupération simple)</span><span class="sxs-lookup"><span data-stu-id="026ee-169">Piecemeal Restore Stages (Simple Recovery Model)</span></span>  
 <span data-ttu-id="026ee-170">Le scénario de restauration fragmentaire comprend les étapes suivantes :</span><span class="sxs-lookup"><span data-stu-id="026ee-170">The piecemeal restore scenario involves the following stages:</span></span>  
  
-   <span data-ttu-id="026ee-171">Étape initiale (restaurer et récupérer le groupe de fichiers primaire et tous les groupes de fichiers en lecture/écriture)</span><span class="sxs-lookup"><span data-stu-id="026ee-171">Initial stage (restore and recover the primary filegroup and all read/write filegroups)</span></span>  
  
     <span data-ttu-id="026ee-172">L'étape initiale effectue une restauration partielle.</span><span class="sxs-lookup"><span data-stu-id="026ee-172">The initial stage performs a partial restore.</span></span> <span data-ttu-id="026ee-173">La séquence de restauration partielle restaure le groupe de fichiers primaire, tous les groupes de fichiers secondaires en lecture/écriture et, éventuellement, certains groupes de fichiers en lecture seule.</span><span class="sxs-lookup"><span data-stu-id="026ee-173">The partial restore sequence restores the primary filegroup, all read/write secondary filegroups, and (optionally) some of the read-only filegroups.</span></span> <span data-ttu-id="026ee-174">Pendant l'étape initiale, la totalité de la base de données doit se trouver hors connexion.</span><span class="sxs-lookup"><span data-stu-id="026ee-174">During the initial stage, the whole database must go offline.</span></span> <span data-ttu-id="026ee-175">Après l'étape initiale, la base de données est en ligne et les groupes de fichiers restaurés sont disponibles.</span><span class="sxs-lookup"><span data-stu-id="026ee-175">After the initial stage, the database is online, and restored filegroups are available.</span></span> <span data-ttu-id="026ee-176">Toutefois, tous les groupes de fichiers en lecture seule qui n'ont pas encore été restaurés demeurent hors connexion.</span><span class="sxs-lookup"><span data-stu-id="026ee-176">However, any read-only filegroups that have not yet been restored, remain offline.</span></span>  
  
     <span data-ttu-id="026ee-177">La première instruction RESTORE de l'étape initiale doit :</span><span class="sxs-lookup"><span data-stu-id="026ee-177">The first RESTORE statement in the initial stage must do the following:</span></span>  
  
    -   <span data-ttu-id="026ee-178">utiliser une sauvegarde partielle ou complète de base de données contenant le groupe de fichiers primaire et tous les groupes de fichiers qui étaient en lecture/écriture au moment de la sauvegarde ;</span><span class="sxs-lookup"><span data-stu-id="026ee-178">Use a partial or full database backup that contains the primary filegroup and all filegroups that were read/write at the time of the backup.</span></span> <span data-ttu-id="026ee-179">il est courant de commencer une séquence de restauration partielle en restaurant une sauvegarde partielle ;</span><span class="sxs-lookup"><span data-stu-id="026ee-179">It is common to start a partial restore sequence by restoring a partial backup.</span></span>  
  
    -   <span data-ttu-id="026ee-180">spécifier l'option PARTIAL qui indique le démarrage d'une restauration fragmentaire ;</span><span class="sxs-lookup"><span data-stu-id="026ee-180">Specify the PARTIAL option, which indicates the start of a piecemeal restore.</span></span>  
  
    > [!NOTE]  
    >  <span data-ttu-id="026ee-181">L'option PARTIAL effectue des contrôles de sécurité qui garantissent l'adéquation de la base de données obtenue à son usage en production.</span><span class="sxs-lookup"><span data-stu-id="026ee-181">The PARTIAL option performs safety checks that ensure that the resulting database is suited for use as a production database.</span></span>  
  
    -   <span data-ttu-id="026ee-182">spécifier l'option READ_WRITE_FILEGROUPS si la sauvegarde est une sauvegarde complète de base de données.</span><span class="sxs-lookup"><span data-stu-id="026ee-182">Specify the READ_WRITE_FILEGROUPS option if the backup is a full database backup.</span></span>  
  
-   <span data-ttu-id="026ee-183">Si la base de données est en ligne, vous pouvez faire appel à une ou plusieurs restaurations de fichiers en ligne pour restaurer et récupérer les fichiers en lecture seule hors connexion qui étaient dans cet état au moment de la sauvegarde.</span><span class="sxs-lookup"><span data-stu-id="026ee-183">While the database is online, you can use one or more online file restores to restore and recover offline read-only files that were read-only at the time of backup.</span></span> <span data-ttu-id="026ee-184">La fréquence des restaurations de fichiers en ligne dépend du moment où vous souhaitez que les données soient en ligne.</span><span class="sxs-lookup"><span data-stu-id="026ee-184">The timing of the online file restores depends on when you want to have the data online.</span></span>  
  
     <span data-ttu-id="026ee-185">La nécessité de restaurer des données dans un fichier dépend des éléments suivants :</span><span class="sxs-lookup"><span data-stu-id="026ee-185">Whether you must restore data to a file depends on the following:</span></span>  
  
    -   <span data-ttu-id="026ee-186">Les fichiers en lecture seule valides et cohérents avec la base de données peuvent être mis en ligne directement s'ils sont récupérés sans restaurer les données.</span><span class="sxs-lookup"><span data-stu-id="026ee-186">Valid read-only files that are consistent with the database can be brought online directly by recovering them without restoring any data.</span></span>  
  
    -   <span data-ttu-id="026ee-187">Les fichiers endommagés ou incohérents avec la base de données doivent être restaurés avant d'être récupérés.</span><span class="sxs-lookup"><span data-stu-id="026ee-187">Files that are damaged or inconsistent with the database must be restored before they are recovered.</span></span>  
  
### <a name="examples"></a><span data-ttu-id="026ee-188">Exemples</span><span class="sxs-lookup"><span data-stu-id="026ee-188">Examples</span></span>  
  
-   [<span data-ttu-id="026ee-189">Exemple : restauration fragmentaire d’une base de données &#40;mode de récupération simple&#41;</span><span class="sxs-lookup"><span data-stu-id="026ee-189">Example: Piecemeal Restore of Database &#40;Simple Recovery Model&#41;</span></span>](example-piecemeal-restore-of-database-simple-recovery-model.md)  
  
-   [<span data-ttu-id="026ee-190">Exemple : restauration fragmentaire de quelques groupes de fichiers uniquement &#40;mode de récupération simple&#41;</span><span class="sxs-lookup"><span data-stu-id="026ee-190">Example: Piecemeal Restore of Only Some Filegroups &#40;Simple Recovery Model&#41;</span></span>](example-piecemeal-restore-of-only-some-filegroups-simple-recovery-model.md)  
  
## <a name="piecemeal-restore-under-the-full-recovery-model"></a><span data-ttu-id="026ee-191">Restauration fragmentaire en mode de récupération complète</span><span class="sxs-lookup"><span data-stu-id="026ee-191">Piecemeal Restore Under the Full Recovery Model</span></span>  
 <span data-ttu-id="026ee-192">En mode de récupération complète ou de récupération utilisant les journaux de transactions, une restauration fragmentaire est disponible pour les bases de données qui contiennent plusieurs groupes de fichiers et vous pouvez restaurer une base de données à n'importe quel point dans le temps.</span><span class="sxs-lookup"><span data-stu-id="026ee-192">Under the full recovery model or bulk-logged recovery model, piecemeal restore is available for any database that contains multiple filegroups and you can restore a database to any point in time.</span></span> <span data-ttu-id="026ee-193">Les séquences de restauration d'une restauration fragmentaire se déroulent comme suit :</span><span class="sxs-lookup"><span data-stu-id="026ee-193">The restore sequences of a piecemeal restore behave as follows:</span></span>  
  
-   <span data-ttu-id="026ee-194">séquence de restauration partielle</span><span class="sxs-lookup"><span data-stu-id="026ee-194">Partial-restore sequence</span></span>  
  
     <span data-ttu-id="026ee-195">La séquence de restauration partielle restaure le groupe de fichiers primaire et éventuellement certains des groupes de fichiers secondaires.</span><span class="sxs-lookup"><span data-stu-id="026ee-195">The partial restore sequence restores the primary filegroup and, optionally, some of the secondary filegroups.</span></span>  
  
     <span data-ttu-id="026ee-196">La première instruction RESTORE DATABASE doit :</span><span class="sxs-lookup"><span data-stu-id="026ee-196">The first RESTORE DATABASE statement must do the following:</span></span>  
  
    -   <span data-ttu-id="026ee-197">spécifier l'option PARTIAL ;</span><span class="sxs-lookup"><span data-stu-id="026ee-197">Specify the PARTIAL option.</span></span> <span data-ttu-id="026ee-198">celle-ci indique le début d'une restauration fragmentaire.</span><span class="sxs-lookup"><span data-stu-id="026ee-198">This indicates the start of a piecemeal restore.</span></span>  
  
    -   <span data-ttu-id="026ee-199">utiliser n'importe quelle sauvegarde de base de données complète contenant le groupe de fichiers primaire.</span><span class="sxs-lookup"><span data-stu-id="026ee-199">Use any full database backup that contains the primary filegroup.</span></span> <span data-ttu-id="026ee-200">Il est conseillé de commencer une séquence de restauration partielle en restaurant une sauvegarde partielle.</span><span class="sxs-lookup"><span data-stu-id="026ee-200">The common practice is to start a partial restore sequence by restoring a partial backup.</span></span>  
  
    -   <span data-ttu-id="026ee-201">Pour restaurer à un point précis dans le temps, vous devez spécifier l'heure dans la séquence de restauration partielle.</span><span class="sxs-lookup"><span data-stu-id="026ee-201">To restore to a specific point in time, you must specify the time in the partial restore sequence.</span></span> <span data-ttu-id="026ee-202">Chaque étape successive de la séquence de restauration doit spécifier le même point dans le temps.</span><span class="sxs-lookup"><span data-stu-id="026ee-202">Every successive step of the restore sequence must specify the same point in time.</span></span>  
  
-   <span data-ttu-id="026ee-203">Les séquences de restauration de groupe de fichiers mettent en ligne les groupes de fichiers supplémentaires jusqu'à un point cohérent avec la base de données.</span><span class="sxs-lookup"><span data-stu-id="026ee-203">Filegroup-restore sequences bring additional filegroups online to a point consistent with the database.</span></span>  
  
     <span data-ttu-id="026ee-204">Dans l'édition Enterprise, tout groupe de fichiers secondaire hors connexion peut être restauré et récupéré tant que la base de données reste en ligne.</span><span class="sxs-lookup"><span data-stu-id="026ee-204">In the Enterprise edition, any offline secondary filegroup can be restored and recovered while the database remains online.</span></span> <span data-ttu-id="026ee-205">Un fichier en lecture seule spécifique ne doit être restauré que s'il est endommagé ou s'il est incohérent avec la base de données.</span><span class="sxs-lookup"><span data-stu-id="026ee-205">If a specific read-only file is undamaged and consistent with the database, the file does not have to be restored.</span></span> <span data-ttu-id="026ee-206">Pour plus d’informations, consultez [Récupérer une base de données sans restauration des données &#40;Transact-SQL&#41;](recover-a-database-without-restoring-data-transact-sql.md).</span><span class="sxs-lookup"><span data-stu-id="026ee-206">For more information, see [Recover a Database Without Restoring Data &#40;Transact-SQL&#41;](recover-a-database-without-restoring-data-transact-sql.md).</span></span>  
  
### <a name="applying-log-backups"></a><span data-ttu-id="026ee-207">Application des sauvegardes de journaux</span><span class="sxs-lookup"><span data-stu-id="026ee-207">Applying Log Backups</span></span>  
 <span data-ttu-id="026ee-208">Si un groupe de fichiers est en lecture seule avant la création de la sauvegarde de fichiers, l'application des sauvegardes de journaux au groupe de fichiers n'est pas nécessaire et n'est pas effectuée par la restauration de fichiers.</span><span class="sxs-lookup"><span data-stu-id="026ee-208">If a read-only filegroup has been read-only since before the file backup was created, applying log backups to the filegroup is unnecessary and is skipped by file restore.</span></span> <span data-ttu-id="026ee-209">Si le groupe de fichiers est en lecture/écriture, une séquence non rompue de sauvegardes de journaux doit être appliquée à la dernière restauration complète ou différentielle pour restaurer par progression le groupe de fichiers jusqu'au fichier journal actuel.</span><span class="sxs-lookup"><span data-stu-id="026ee-209">If the filegroup is read/write, an unbroken chain of log backups must be applied to the last full or differential restore to bring the filegroup forward to the current log file.</span></span>  
  
### <a name="examples"></a><span data-ttu-id="026ee-210">Exemples</span><span class="sxs-lookup"><span data-stu-id="026ee-210">Examples</span></span>  
  
-   [<span data-ttu-id="026ee-211">Exemple : restauration fragmentaire d’une base de données &#40;mode de restauration complète&#41;</span><span class="sxs-lookup"><span data-stu-id="026ee-211">Example: Piecemeal Restore of Database &#40;Full Recovery Model&#41;</span></span>](example-piecemeal-restore-of-database-full-recovery-model.md)  
  
-   [<span data-ttu-id="026ee-212">Exemple : restauration fragmentaire de quelques groupes de fichiers &#40;mode de récupération complète&#41;</span><span class="sxs-lookup"><span data-stu-id="026ee-212">Example: Piecemeal Restore of Only Some Filegroups &#40;Full Recovery Model&#41;</span></span>](example-piecemeal-restore-of-only-some-filegroups-full-recovery-model.md)  
  
## <a name="performing-a-piecemeal-restore-of-a-database-whose-recovery-model-has-been-switched-from-simple-to-full"></a><span data-ttu-id="026ee-213">Exécution d'une restauration fragmentaire d'une base de données dont le mode de récupération est passé du mode de récupération complète au mode de récupération simple</span><span class="sxs-lookup"><span data-stu-id="026ee-213">Performing a Piecemeal Restore of a Database Whose Recovery Model Has Been Switched from Simple to Full</span></span>  
 <span data-ttu-id="026ee-214">Vous pouvez effectuer une restauration fragmentaire d'une base de données qui est passée du mode de récupération simple au mode de récupération complète depuis la sauvegarde de base de données complète ou la sauvegarde partielle.</span><span class="sxs-lookup"><span data-stu-id="026ee-214">You can perform a piecemeal restore of a database that has been switched from the simple recovery model to the full recovery model since the full partial or database backup.</span></span> <span data-ttu-id="026ee-215">Exemple : considérons une base de données sur laquelle vous effectuez les opérations ci-après :</span><span class="sxs-lookup"><span data-stu-id="026ee-215">For example, consider a database for which you take the following steps:</span></span>  
  
1.  <span data-ttu-id="026ee-216">Créez une sauvegarde partielle (sauvegarde_1) d'une base de données dans le mode simple.</span><span class="sxs-lookup"><span data-stu-id="026ee-216">Create a partial backup (backup_1) of a simple-model database.</span></span>  
  
2.  <span data-ttu-id="026ee-217">Après quelque temps, changez le mode de récupération en mode complet.</span><span class="sxs-lookup"><span data-stu-id="026ee-217">After some time, change the recovery model to full.</span></span>  
  
3.  <span data-ttu-id="026ee-218">Créez une sauvegarde différentielle.</span><span class="sxs-lookup"><span data-stu-id="026ee-218">Create a differential backup.</span></span>  
  
4.  <span data-ttu-id="026ee-219">Commencez par effectuer des sauvegardes des journaux.</span><span class="sxs-lookup"><span data-stu-id="026ee-219">Start taking log backups.</span></span>  
  
 <span data-ttu-id="026ee-220">Par la suite, la séquence suivante est correcte :</span><span class="sxs-lookup"><span data-stu-id="026ee-220">Thereafter, the following sequence is valid:</span></span>  
  
1.  <span data-ttu-id="026ee-221">Restauration partielle qui omet certains groupes de fichiers secondaires.</span><span class="sxs-lookup"><span data-stu-id="026ee-221">A partial restore that omits some secondary filegroups.</span></span>  
  
2.  <span data-ttu-id="026ee-222">Restauration différentielle suivie d'autres restaurations nécessaires.</span><span class="sxs-lookup"><span data-stu-id="026ee-222">A differential restore followed by any other needed restores.</span></span>  
  
3.  <span data-ttu-id="026ee-223">Ultérieurement, restauration de fichiers d'un groupe de fichiers secondaire en lecture/écriture avec l'option WITH NORECOVERY à partir de la sauvegarde partielle backup_1.</span><span class="sxs-lookup"><span data-stu-id="026ee-223">Later, a file restore of a read/write secondary filegroup WITH NORECOVERY from the backup_1 partial backup</span></span>  
  
4.  <span data-ttu-id="026ee-224">Sauvegarde différentielle suivie d'autres sauvegardes restaurées dans la séquence de restauration fragmentaire d'origine pour restaurer les données jusqu'au point de récupération d'origine.</span><span class="sxs-lookup"><span data-stu-id="026ee-224">The differential backup followed by any other backups that were restored in the original piecemeal restore sequence to restore the data up to the original recovery point.</span></span>  
  
## <a name="see-also"></a><span data-ttu-id="026ee-225">Voir aussi</span><span class="sxs-lookup"><span data-stu-id="026ee-225">See Also</span></span>  
 <span data-ttu-id="026ee-226">[Appliquer les sauvegardes du journal des transactions &#40;SQL Server&#41;](transaction-log-backups-sql-server.md) </span><span class="sxs-lookup"><span data-stu-id="026ee-226">[Apply Transaction Log Backups &#40;SQL Server&#41;](transaction-log-backups-sql-server.md) </span></span>  
 <span data-ttu-id="026ee-227">[RESTORE &#40;Transact-SQL&#41;](/sql/t-sql/statements/restore-statements-transact-sql) </span><span class="sxs-lookup"><span data-stu-id="026ee-227">[RESTORE &#40;Transact-SQL&#41;](/sql/t-sql/statements/restore-statements-transact-sql) </span></span>  
 <span data-ttu-id="026ee-228">[Restaurer une base de données SQL Server jusqu’à une limite dans le temps &#40;mode de récupération complète&#41;](restore-a-sql-server-database-to-a-point-in-time-full-recovery-model.md) </span><span class="sxs-lookup"><span data-stu-id="026ee-228">[Restore a SQL Server Database to a Point in Time &#40;Full Recovery Model&#41;](restore-a-sql-server-database-to-a-point-in-time-full-recovery-model.md) </span></span>  
 <span data-ttu-id="026ee-229">[Vue d’ensemble de la restauration et de la récupération &#40;SQL Server&#41;](restore-and-recovery-overview-sql-server.md) </span><span class="sxs-lookup"><span data-stu-id="026ee-229">[Restore and Recovery Overview &#40;SQL Server&#41;](restore-and-recovery-overview-sql-server.md) </span></span>  
 [<span data-ttu-id="026ee-230">Planifier et exécuter des séquences de restauration &#40;mode de récupération complète&#41;</span><span class="sxs-lookup"><span data-stu-id="026ee-230">Plan and Perform Restore Sequences &#40;Full Recovery Model&#41;</span></span>](plan-and-perform-restore-sequences-full-recovery-model.md)  
  
  
