---
title: Restauration en ligne (SQL Server) | Microsoft Docs
ms.custom: ''
ms.date: 06/13/2017
ms.prod: sql-server-2014
ms.reviewer: ''
ms.technology: backup-restore
ms.topic: conceptual
helpviewer_keywords:
- online restores [SQL Server]
- online restores [SQL Server], about online restores
ms.assetid: 7982a687-980a-4eb8-8e9f-6894148e7d8c
author: MikeRayMSFT
ms.author: mikeray
ms.openlocfilehash: 4db4d5b5ce08c50646857099d82964bb944bc8af
ms.sourcegitcommit: ad4d92dce894592a259721a1571b1d8736abacdb
ms.translationtype: MT
ms.contentlocale: fr-FR
ms.lasthandoff: 08/04/2020
ms.locfileid: "87612436"
---
# <a name="online-restore-sql-server"></a><span data-ttu-id="28e17-102">Restauration en ligne (SQL Server)</span><span class="sxs-lookup"><span data-stu-id="28e17-102">Online Restore (SQL Server)</span></span>
  <span data-ttu-id="28e17-103">La restauration en ligne est prise en charge uniquement dans l'édition [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] Enterprise.</span><span class="sxs-lookup"><span data-stu-id="28e17-103">Online restore is supported only on [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] Enterprise edition.</span></span> <span data-ttu-id="28e17-104">Par défaut, une restauration fragmentaire, de fichiers ou de pages est en ligne dans cette édition.</span><span class="sxs-lookup"><span data-stu-id="28e17-104">In this edition, a file, page, or piecemeal restore is online by default.</span></span> <span data-ttu-id="28e17-105">Cette rubrique concerne les bases de données qui contiennent plusieurs fichiers ou groupes de fichiers et, en mode de récupération simple, seulement des groupes de fichiers en lecture seule.</span><span class="sxs-lookup"><span data-stu-id="28e17-105">This topic is relevant for databases that contain multiple files or filegroups (and, under the simple recovery model, only for read-only filegroups).</span></span>  
  
 <span data-ttu-id="28e17-106">Le processus de restauration des données lorsque la base de données est en ligne est appelé *restauration en ligne*.</span><span class="sxs-lookup"><span data-stu-id="28e17-106">Restoring data while the database is online is called an *online restore*.</span></span> <span data-ttu-id="28e17-107">Une base de données est considérée en ligne lorsque le groupe de fichiers primaire est en ligne, même si un ou plusieurs de ses groupes de fichiers secondaires sont hors connexion.</span><span class="sxs-lookup"><span data-stu-id="28e17-107">A database is considered to be online whenever the primary filegroup is online, even if one or more of its secondary filegroups are offline.</span></span> <span data-ttu-id="28e17-108">Quel que soit le mode de récupération, vous pouvez restaurer un fichier qui est hors connexion quand la base de données est en ligne.</span><span class="sxs-lookup"><span data-stu-id="28e17-108">Under any recovery model, you can restore a file that is offline while the database is online.</span></span> <span data-ttu-id="28e17-109">En mode de restauration complète, vous pouvez aussi restaurer les pages quand la base de données est en ligne.</span><span class="sxs-lookup"><span data-stu-id="28e17-109">Under the full recovery model, you can also restore pages while the database is online.</span></span>  
  
> [!NOTE]  
>  <span data-ttu-id="28e17-110">La restauration en ligne a lieu automatiquement dans [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] Enterprise, et ne nécessite aucune action de l'utilisateur.</span><span class="sxs-lookup"><span data-stu-id="28e17-110">Online restore occurs automatically on [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] Enterprise and requires no user action.</span></span> <span data-ttu-id="28e17-111">Si vous ne souhaitez pas utiliser la restauration en ligne, mettez une base de données hors connexion avant de démarrer une restauration.</span><span class="sxs-lookup"><span data-stu-id="28e17-111">If you do not want to use online restore, you can take a database offline before you start a restore.</span></span> <span data-ttu-id="28e17-112">Pour plus d'informations, consultez [Mise hors connexion d'une base de données ou d'un fichier](#taking_db_or_file_offline), plus loin dans cette rubrique.</span><span class="sxs-lookup"><span data-stu-id="28e17-112">For more information, see [Taking a Database or File Offline](#taking_db_or_file_offline), later in this topic.</span></span>  
  
 <span data-ttu-id="28e17-113">Au cours d'une restauration de fichiers en ligne, les fichiers en cours de restauration et leurs groupes de fichiers sont hors connexion.</span><span class="sxs-lookup"><span data-stu-id="28e17-113">During an online file restore, any file being restored and its filegroup are offline.</span></span> <span data-ttu-id="28e17-114">Si ces fichiers sont en ligne au démarrage d'une restauration en ligne, la première instruction de restauration met le groupe de fichiers du fichier hors connexion.</span><span class="sxs-lookup"><span data-stu-id="28e17-114">If any of these files is online when an online restore starts, the first restore statement takes the filegroup of the file offline.</span></span> <span data-ttu-id="28e17-115">À l'inverse, au cours d'une restauration de pages en ligne, seule la page est hors connexion.</span><span class="sxs-lookup"><span data-stu-id="28e17-115">In contrast, during an online page restore, only the page is offline.</span></span>  
  
 <span data-ttu-id="28e17-116">Chaque scénario de restauration en ligne comprend les étapes de base suivantes :</span><span class="sxs-lookup"><span data-stu-id="28e17-116">Every online restore scenario involves the following basic steps:</span></span>  
  
1.  <span data-ttu-id="28e17-117">Restaurer les données.</span><span class="sxs-lookup"><span data-stu-id="28e17-117">Restore the data.</span></span>  
  
2.  <span data-ttu-id="28e17-118">Effectuer la dernière restauration du journal à l'aide de WITH RECOVERY.</span><span class="sxs-lookup"><span data-stu-id="28e17-118">Restore the log by using WITH RECOVERY for the last log restore.</span></span> <span data-ttu-id="28e17-119">Cette opération met les données restaurées en ligne.</span><span class="sxs-lookup"><span data-stu-id="28e17-119">This brings the restored data online.</span></span>  
  
 <span data-ttu-id="28e17-120">Il arrive parfois qu'une transaction non validée ne puisse être restaurée parce que les données requises par la restauration sont hors connexion au démarrage.</span><span class="sxs-lookup"><span data-stu-id="28e17-120">Occasionally, an uncommitted transaction cannot be rolled back because the data that is required by rollback is offline during startup.</span></span> <span data-ttu-id="28e17-121">Dans ce cas, la transaction est différée.</span><span class="sxs-lookup"><span data-stu-id="28e17-121">In this case, the transaction is deferred.</span></span> <span data-ttu-id="28e17-122">Pour plus d’informations, consultez [Transactions différées &#40;SQL Server&#41;](deferred-transactions-sql-server.md).</span><span class="sxs-lookup"><span data-stu-id="28e17-122">For more information, see [Deferred Transactions &#40;SQL Server&#41;](deferred-transactions-sql-server.md).</span></span>  
  
> [!NOTE]  
>  <span data-ttu-id="28e17-123">Si la base de données utilise le mode de récupération utilisant les journaux de transactions, il est recommandé de basculer en mode de restauration complète avant de démarrer une restauration en ligne.</span><span class="sxs-lookup"><span data-stu-id="28e17-123">If the database is currently using the bulk-logged recovery model, we recommend that you switch to the full recovery model before you start an online restore.</span></span> <span data-ttu-id="28e17-124">Pour plus d’informations, consultez [Afficher ou modifier le mode de récupération d’une base de données &#40;SQL Server&#41;](view-or-change-the-recovery-model-of-a-database-sql-server.md).</span><span class="sxs-lookup"><span data-stu-id="28e17-124">For more information, see [View or Change the Recovery Model of a Database &#40;SQL Server&#41;](view-or-change-the-recovery-model-of-a-database-sql-server.md).</span></span>  
  
> [!IMPORTANT]  
>  <span data-ttu-id="28e17-125">Si les sauvegardes ont été effectuées sur plusieurs unités reliées au serveur, un nombre identique d'unités doit être disponible pendant la restauration en ligne.</span><span class="sxs-lookup"><span data-stu-id="28e17-125">If the backups were taken with multiple devices that were attached to the server, the same number of devices must be available during an online restore.</span></span>  
  
## <a name="log-backups-for-online-restore"></a><span data-ttu-id="28e17-126">Sauvegardes de journal pour une restauration en ligne</span><span class="sxs-lookup"><span data-stu-id="28e17-126">Log Backups for Online Restore</span></span>  
 <span data-ttu-id="28e17-127">Pour une restauration en ligne, le point de récupération est le point où les données en cours de restauration ont été mises hors connexion ou mises en lecture seule pour la dernière fois.</span><span class="sxs-lookup"><span data-stu-id="28e17-127">In an online restore, the recovery point is the point when the data being restored was taken offline or made read-only for the last time.</span></span> <span data-ttu-id="28e17-128">Les sauvegardes des journaux de transactions jusqu'à ce point de récupération compris doivent toutes être disponibles.</span><span class="sxs-lookup"><span data-stu-id="28e17-128">The transaction log backups leading up to and including this recovery point must all be available.</span></span> <span data-ttu-id="28e17-129">Généralement, une sauvegarde de fichier journal est requise après ce point pour couvrir le point de récupération du fichier.</span><span class="sxs-lookup"><span data-stu-id="28e17-129">Generally, a log backup is required after that point to cover the recovery point for the file.</span></span> <span data-ttu-id="28e17-130">La seule exception concerne une restauration en ligne de données en lecture seule à partir une sauvegarde de données effectuée après la mise en lecture seule des données.</span><span class="sxs-lookup"><span data-stu-id="28e17-130">The only exception is during an online restore of read-only data from a data backup that was taken after the data became read-only.</span></span> <span data-ttu-id="28e17-131">Dans ce cas, vous n'avez pas besoin d'une sauvegarde de journal.</span><span class="sxs-lookup"><span data-stu-id="28e17-131">In this case, you do not have to have a log backup.</span></span>  
  
 <span data-ttu-id="28e17-132">En général, vous pouvez effectuer des sauvegardes des journaux de transactions pendant que la base de données est en ligne, même après le début de la séquence de restauration.</span><span class="sxs-lookup"><span data-stu-id="28e17-132">Generally, you may take transaction log backups while the database is online, even after the start of the restore sequence.</span></span> <span data-ttu-id="28e17-133">Le moment de la dernière sauvegarde de journal dépend des propriétés du fichier en cours de restauration :</span><span class="sxs-lookup"><span data-stu-id="28e17-133">The timing of the last log backup depends on the properties of the file being restored:</span></span>  
  
-   <span data-ttu-id="28e17-134">Pour un fichier en lecture seule en ligne, vous pouvez effectuer la dernière sauvegarde de journal nécessaire à la récupération avant ou pendant la première séquence de restauration.</span><span class="sxs-lookup"><span data-stu-id="28e17-134">For an online read-only file, you can take the last log backup that is required for recovery before or during the first restore sequence.</span></span> <span data-ttu-id="28e17-135">Un groupe de fichiers en lecture seule peut se passer de sauvegardes de journal si une sauvegarde de données ou différentielle a été effectuée après la mise en lecture seule du groupe de fichiers.</span><span class="sxs-lookup"><span data-stu-id="28e17-135">A read-only filegroup may not require log backups if a data or differential backup was taken after the filegroup became read-only.</span></span>  
  
    > [!NOTE]  
    >  <span data-ttu-id="28e17-136">Les informations précédentes s'appliquent aussi à chaque fichier hors connexion.</span><span class="sxs-lookup"><span data-stu-id="28e17-136">The preceding information also applies to every offline file.</span></span>  
  
-   <span data-ttu-id="28e17-137">Un cas particulier concerne un fichier en lecture-écriture qui était en ligne lorsque la première instruction de restauration a été envoyée, et qui a ensuite été mis automatiquement hors ligne par cette instruction de restauration.</span><span class="sxs-lookup"><span data-stu-id="28e17-137">A special case exists for a read/write file that was online when the first restore statement was issued and that was then automatically taken offline by that restore statement.</span></span> <span data-ttu-id="28e17-138">Dans ce cas, vous devez effectuer une sauvegarde de journal pendant la première *séquence de restauration* (la séquence d’une ou plusieurs instructions RESTORE qui restaurent, restaurent par progression et récupèrent les données).</span><span class="sxs-lookup"><span data-stu-id="28e17-138">In this case, you must take a log backup during the first *restore sequence* (the sequence of one or more RESTORE statements that restore, roll forward, and recover data).</span></span> <span data-ttu-id="28e17-139">En règle générale, cette sauvegarde de journal doit avoir lieu après la restauration de toutes les sauvegardes complètes et avant la récupération des données.</span><span class="sxs-lookup"><span data-stu-id="28e17-139">Generally, this log backup must occur after you restore all the full backups and before you recover the data.</span></span> <span data-ttu-id="28e17-140">Toutefois, dans le cas de plusieurs sauvegardes de fichiers pour un groupe de fichiers spécifique, le point minimal de la sauvegarde de journal est le moment après la mise hors connexion du groupe de fichiers.</span><span class="sxs-lookup"><span data-stu-id="28e17-140">However, if there are multiple file backups for a specific filegroup, the minimal point of log backup is the time after the filegroup is offline.</span></span> <span data-ttu-id="28e17-141">Cette sauvegarde de journal après restauration des données capture le point où le fichier a été mis hors connexion.</span><span class="sxs-lookup"><span data-stu-id="28e17-141">This post-data-restore log backup captures the point at which the file was taken offline.</span></span> <span data-ttu-id="28e17-142">La sauvegarde de journal après restauration des données est nécessaire car le [!INCLUDE[ssDEnoversion](../../includes/ssdenoversion-md.md)] ne peut pas exploiter le journal en ligne pour une restauration en ligne.</span><span class="sxs-lookup"><span data-stu-id="28e17-142">The post-data-restore log backup is necessary because the [!INCLUDE[ssDEnoversion](../../includes/ssdenoversion-md.md)] cannot use online log for an online restore.</span></span>  
  
    > [!NOTE]  
    >  <span data-ttu-id="28e17-143">D'une autre manière, vous pouvez mettre manuellement le fichier hors connexion avant la séquence de restauration.</span><span class="sxs-lookup"><span data-stu-id="28e17-143">Alternatively, you can manually take the file offline before the restore sequence.</span></span> <span data-ttu-id="28e17-144">Pour plus d'informations, consultez « Mise hors connexion d'une base de données ou d'un fichier », plus loin dans cette rubrique.</span><span class="sxs-lookup"><span data-stu-id="28e17-144">For more information, see "Taking a Database or File Offline" later in this topic.</span></span>  
  
##  <a name="taking-a-database-or-file-offline"></a><a name="taking_db_or_file_offline"></a> <span data-ttu-id="28e17-145">Mise hors connexion d'une base de données ou d'un fichier</span><span class="sxs-lookup"><span data-stu-id="28e17-145">Taking a Database or File Offline</span></span>  
 <span data-ttu-id="28e17-146">Si vous ne souhaitez pas utiliser la restauration en ligne, mettez la base de données hors connexion avant de démarrer la séquence de restauration au moyen de l'une des méthodes suivantes :</span><span class="sxs-lookup"><span data-stu-id="28e17-146">If you do not want to use online restore, you can take the database offline before you start the restore sequence by using one of the following methods:</span></span>  
  
-   <span data-ttu-id="28e17-147">Quel que soit le mode de récupération, vous pouvez mettre la base de données hors connexion à l'aide de l'instruction [ALTER DATABASE](/sql/t-sql/statements/alter-database-transact-sql) suivante :</span><span class="sxs-lookup"><span data-stu-id="28e17-147">Under any recovery model, you can take the database offline by using the following [ALTER DATABASE](/sql/t-sql/statements/alter-database-transact-sql) statement:</span></span>  
  
     <span data-ttu-id="28e17-148">ALTER DATABASE *nom_base_de_données* SET OFFLINE</span><span class="sxs-lookup"><span data-stu-id="28e17-148">ALTER DATABASE *database_name* SET OFFLINE</span></span>  
  
-   <span data-ttu-id="28e17-149">En mode de restauration complète, vous pouvez aussi forcer la mise hors connexion d'une restauration de pages ou de fichiers à l'aide de l'instruction suivante [BACKUP LOG](/sql/t-sql/statements/backup-transact-sql) pour mettre la base de données dans l'état de restauration :</span><span class="sxs-lookup"><span data-stu-id="28e17-149">Alternatively, under the full recovery model, you can force a file or page restore to be offline, by using the following [BACKUP LOG](/sql/t-sql/statements/backup-transact-sql) statement put the database in to the restoring state:</span></span>  
  
     <span data-ttu-id="28e17-150">BACKUP LOG *nom_base_de_données* WITH NORECOVERY</span><span class="sxs-lookup"><span data-stu-id="28e17-150">BACKUP LOG *database_name* WITH NORECOVERY.</span></span>  
  
 <span data-ttu-id="28e17-151">Tant qu'une base de données demeure hors connexion, toutes les restaurations sont des restaurations hors connexion.</span><span class="sxs-lookup"><span data-stu-id="28e17-151">As long as a database remains offline, all restores are offline restores.</span></span>  
  
## <a name="examples"></a><span data-ttu-id="28e17-152">Exemples</span><span class="sxs-lookup"><span data-stu-id="28e17-152">Examples</span></span>  
  
> [!NOTE]  
>  <span data-ttu-id="28e17-153">La syntaxe pour une séquence de restauration en ligne est la même que pour une séquence de restauration hors connexion.</span><span class="sxs-lookup"><span data-stu-id="28e17-153">The syntax for an online restore sequence is the same as for an offline restore sequence.</span></span>  
  
-   [<span data-ttu-id="28e17-154">Exemple : restauration fragmentaire d’une base de données &#40;mode de récupération simple&#41;</span><span class="sxs-lookup"><span data-stu-id="28e17-154">Example: Piecemeal Restore of Database &#40;Simple Recovery Model&#41;</span></span>](example-piecemeal-restore-of-database-simple-recovery-model.md)  
  
-   [<span data-ttu-id="28e17-155">Exemple : restauration fragmentaire de quelques groupes de fichiers uniquement &#40;mode de récupération simple&#41;</span><span class="sxs-lookup"><span data-stu-id="28e17-155">Example: Piecemeal Restore of Only Some Filegroups &#40;Simple Recovery Model&#41;</span></span>](example-piecemeal-restore-of-only-some-filegroups-simple-recovery-model.md)  
  
-   [<span data-ttu-id="28e17-156">Exemple : restauration en ligne d’un fichier en lecture seule &#40;mode de récupération simple&#41;</span><span class="sxs-lookup"><span data-stu-id="28e17-156">Example: Online Restore of a Read-Only File &#40;Simple Recovery Model&#41;</span></span>](example-online-restore-of-a-read-only-file-simple-recovery-model.md)  
  
-   [<span data-ttu-id="28e17-157">Exemple : restauration fragmentaire d’une base de données &#40;mode de restauration complète&#41;</span><span class="sxs-lookup"><span data-stu-id="28e17-157">Example: Piecemeal Restore of Database &#40;Full Recovery Model&#41;</span></span>](example-piecemeal-restore-of-database-full-recovery-model.md)  
  
-   [<span data-ttu-id="28e17-158">Exemple : restauration fragmentaire de quelques groupes de fichiers &#40;mode de récupération complète&#41;</span><span class="sxs-lookup"><span data-stu-id="28e17-158">Example: Piecemeal Restore of Only Some Filegroups &#40;Full Recovery Model&#41;</span></span>](example-piecemeal-restore-of-only-some-filegroups-full-recovery-model.md)  
  
-   [<span data-ttu-id="28e17-159">Exemple : restauration en ligne d’un fichier en lecture/écriture &#40;mode de récupération complète&#41;</span><span class="sxs-lookup"><span data-stu-id="28e17-159">Example: Online Restore of a Read-Write File &#40;Full Recovery Model&#41;</span></span>](example-online-restore-of-a-read-write-file-full-recovery-model.md)  
  
-   [<span data-ttu-id="28e17-160">Exemple : restauration en ligne d’un fichier en lecture seule &#40;mode de restauration complète&#41;</span><span class="sxs-lookup"><span data-stu-id="28e17-160">Example: Online Restore of a Read-Only File &#40;Full Recovery Model&#41;</span></span>](example-online-restore-of-a-read-only-file-full-recovery-model.md)  
  
##  <a name="related-tasks"></a><a name="RelatedTasks"></a> <span data-ttu-id="28e17-161">Tâches associées</span><span class="sxs-lookup"><span data-stu-id="28e17-161">Related Tasks</span></span>  
  
-   [<span data-ttu-id="28e17-162">Restaurer des fichiers et des groupes de fichiers &#40;SQL Server&#41;</span><span class="sxs-lookup"><span data-stu-id="28e17-162">Restore Files and Filegroups &#40;SQL Server&#41;</span></span>](restore-files-and-filegroups-sql-server.md)  
  
-   [<span data-ttu-id="28e17-163">Restaurer des pages &#40;SQL Server&#41;</span><span class="sxs-lookup"><span data-stu-id="28e17-163">Restore Pages &#40;SQL Server&#41;</span></span>](restore-pages-sql-server.md)  
  
-   [<span data-ttu-id="28e17-164">Gérer la table suspect_pages &#40;SQL Server&#41;</span><span class="sxs-lookup"><span data-stu-id="28e17-164">Manage the suspect_pages Table &#40;SQL Server&#41;</span></span>](manage-the-suspect-pages-table-sql-server.md)  
  
-   [<span data-ttu-id="28e17-165">Récupérer une base de données sans restaurer les données &#40;Transact-SQL&#41;</span><span class="sxs-lookup"><span data-stu-id="28e17-165">Recover a Database Without Restoring Data &#40;Transact-SQL&#41;</span></span>](recover-a-database-without-restoring-data-transact-sql.md)  
  
-   [<span data-ttu-id="28e17-166">Supprimer des groupes de fichiers obsolètes &#40;SQL Server&#41;</span><span class="sxs-lookup"><span data-stu-id="28e17-166">Remove Defunct Filegroups &#40;SQL Server&#41;</span></span>](remove-defunct-filegroups-sql-server.md)  
  
## <a name="see-also"></a><span data-ttu-id="28e17-167">Voir aussi</span><span class="sxs-lookup"><span data-stu-id="28e17-167">See Also</span></span>  
 <span data-ttu-id="28e17-168">[Restaurations de fichiers &#40;mode de récupération complète&#41;](file-restores-full-recovery-model.md) </span><span class="sxs-lookup"><span data-stu-id="28e17-168">[File Restores &#40;Full Recovery Model&#41;](file-restores-full-recovery-model.md) </span></span>  
 <span data-ttu-id="28e17-169">[Restaurations de fichiers &#40;mode de récupération simple&#41;](file-restores-simple-recovery-model.md) </span><span class="sxs-lookup"><span data-stu-id="28e17-169">[File Restores &#40;Simple Recovery Model&#41;](file-restores-simple-recovery-model.md) </span></span>  
 <span data-ttu-id="28e17-170">[Restaurer des pages &#40;SQL Server&#41;](restore-pages-sql-server.md) </span><span class="sxs-lookup"><span data-stu-id="28e17-170">[Restore Pages &#40;SQL Server&#41;](restore-pages-sql-server.md) </span></span>  
 <span data-ttu-id="28e17-171">[Restaurations fragmentaires &#40;SQL Server&#41;](piecemeal-restores-sql-server.md) </span><span class="sxs-lookup"><span data-stu-id="28e17-171">[Piecemeal Restores &#40;SQL Server&#41;](piecemeal-restores-sql-server.md) </span></span>  
 [<span data-ttu-id="28e17-172">Vue d’ensemble de la restauration et de la récupération &#40;SQL Server&#41;</span><span class="sxs-lookup"><span data-stu-id="28e17-172">Restore and Recovery Overview &#40;SQL Server&#41;</span></span>](restore-and-recovery-overview-sql-server.md)  
  
  
