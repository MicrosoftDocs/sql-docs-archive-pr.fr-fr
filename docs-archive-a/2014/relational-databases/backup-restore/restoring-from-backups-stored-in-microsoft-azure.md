---
title: Restauration à partir de sauvegardes stockées dans Azure | Microsoft Docs
ms.custom: ''
ms.date: 03/07/2017
ms.prod: sql-server-2014
ms.reviewer: ''
ms.technology: backup-restore
ms.topic: conceptual
ms.assetid: 6ae358b2-6f6f-46e0-a7c8-f9ac6ce79a0e
author: MikeRayMSFT
ms.author: mikeray
ms.openlocfilehash: 68b270f18cb4dbc2724c5a062afae54fa711acec
ms.sourcegitcommit: ad4d92dce894592a259721a1571b1d8736abacdb
ms.translationtype: MT
ms.contentlocale: fr-FR
ms.lasthandoff: 08/04/2020
ms.locfileid: "87612407"
---
# <a name="restoring-from-backups-stored-in-azure"></a><span data-ttu-id="23549-102">Restauration à partir des sauvegardes stockées dans Azure</span><span class="sxs-lookup"><span data-stu-id="23549-102">Restoring From Backups Stored in Azure</span></span>
  <span data-ttu-id="23549-103">Cette rubrique présente les éléments à prendre en considération quand vous restaurez une base de données à l’aide d’une sauvegarde stockée dans le service de stockage Blob Azure.</span><span class="sxs-lookup"><span data-stu-id="23549-103">This topic outlines the considerations when restoring a database using a backup stored in the Azure Blob storage service.</span></span> <span data-ttu-id="23549-104">Ceci s'applique aux sauvegardes créées à l'aide de la sauvegarde SQL Server vers l'URL ou par la [!INCLUDE[ss_smartbackup](../../includes/ss-smartbackup-md.md)].</span><span class="sxs-lookup"><span data-stu-id="23549-104">This applies to backups created either by using SQL Server Backup to URL backup or by [!INCLUDE[ss_smartbackup](../../includes/ss-smartbackup-md.md)].</span></span>  
  
 <span data-ttu-id="23549-105">Nous vous recommandons de consulter cette rubrique si vous avez des sauvegardes stockées dans le service de stockage Blob Azure et que vous planifiez de les restaurer. Lisez ensuite la rubrique qui explique comment restaurer une base de données dont les sauvegardes sont locales ou sur le cloud, les deux méthodes étant identiques.</span><span class="sxs-lookup"><span data-stu-id="23549-105">We recommend reviewing this topic if you have backups stored in the Azure Blob storage service that you plan to restore, and then review the topics that describe the steps on how to restore a database which is the same for both on-premises and azure backups.</span></span>  
  
## <a name="overview"></a><span data-ttu-id="23549-106">Vue d’ensemble</span><span class="sxs-lookup"><span data-stu-id="23549-106">Overview</span></span>  
 <span data-ttu-id="23549-107">Les outils et les méthodes utilisés pour restaurer une base de données à partir d'une sauvegarde local s'appliquent également à la restauration d'une base de données depuis une sauvegarde sur le cloud.</span><span class="sxs-lookup"><span data-stu-id="23549-107">The tools and methods that are used to restore a database from an on-premises backup apply to restoring a database from a cloud backup.</span></span>  <span data-ttu-id="23549-108">Les sections suivantes présentent ces considérations et les différences que vous devez connaître lorsque vous utilisez des sauvegardes stockées dans le service de stockage Blob Azure.</span><span class="sxs-lookup"><span data-stu-id="23549-108">The following sections describe these considerations and any differences you should know about when you use backups stored in the Azure Blob storage service.</span></span>  
  
### <a name="using-transact-sql"></a><span data-ttu-id="23549-109">Utilisation de Transact-SQL</span><span class="sxs-lookup"><span data-stu-id="23549-109">Using Transact-SQL</span></span>  
  
-   <span data-ttu-id="23549-110">Étant donné que SQL Server doit se connecter à une source externe pour récupérer les fichiers de sauvegarde, les informations d'identification SQL sont utilisées pour authentifier le compte de stockage.</span><span class="sxs-lookup"><span data-stu-id="23549-110">Since SQL Server must connect to an external source to retrieve the backup files, SQL Credential is used to authenticate to the storage account.</span></span> <span data-ttu-id="23549-111">Par conséquent, l'instruction RESTORE nécessite l'option WITH CREDENTIAL.</span><span class="sxs-lookup"><span data-stu-id="23549-111">Consequently, the RESTORE statement requires WITH CREDENTIAL option.</span></span> <span data-ttu-id="23549-112">Pour plus d’informations, voir [SQL Server Backup and Restore with Azure Blob Storage Service](sql-server-backup-and-restore-with-microsoft-azure-blob-storage-service.md)(en anglais).</span><span class="sxs-lookup"><span data-stu-id="23549-112">For more information, see [SQL Server Backup and Restore with Azure Blob Storage Service](sql-server-backup-and-restore-with-microsoft-azure-blob-storage-service.md).</span></span>  
  
-   <span data-ttu-id="23549-113">Si vous utilisez une [!INCLUDE[ss_smartbackup](../../includes/ss-smartbackup-md.md)] pour gérer vos sauvegardes dans le cloud, vous pouvez passer en revue toutes les sauvegardes disponibles dans le stockage, en utilisant la fonction système **smart_admin.fn_available_backups** .</span><span class="sxs-lookup"><span data-stu-id="23549-113">If you are using the [!INCLUDE[ss_smartbackup](../../includes/ss-smartbackup-md.md)] to manage your backups to the cloud, you can review all the available backups in the storage, by using the **smart_admin.fn_available_backups** system function.</span></span> <span data-ttu-id="23549-114">Cette fonction système retourne toutes les sauvegardes disponibles pour une base de données dans une table.</span><span class="sxs-lookup"><span data-stu-id="23549-114">This system function returns all the available backups for a database in a table.</span></span> <span data-ttu-id="23549-115">Comme les résultats sont retournés dans une table, vous pouvez les filtres ou les trier.</span><span class="sxs-lookup"><span data-stu-id="23549-115">As the results are returned in a table, you can filter or sort the results.</span></span> <span data-ttu-id="23549-116">Pour plus d’informations, consultez [smart_admin. fn_available_backups &#40;Transact-SQL&#41;](/sql/relational-databases/system-functions/managed-backup-fn-available-backups-transact-sql).</span><span class="sxs-lookup"><span data-stu-id="23549-116">For more information, see [smart_admin.fn_available_backups &#40;Transact-SQL&#41;](/sql/relational-databases/system-functions/managed-backup-fn-available-backups-transact-sql).</span></span>  
  
### <a name="using-sql-server-management-studio"></a><span data-ttu-id="23549-117">Utilisation de SQL Server Management Studio</span><span class="sxs-lookup"><span data-stu-id="23549-117">Using SQL Server Management Studio</span></span>  
  
-   <span data-ttu-id="23549-118">La tâche de restauration est utilisée pour restaurer une base de données à l'aide de SQL Server Management Studio.</span><span class="sxs-lookup"><span data-stu-id="23549-118">The restore task is used to restore a database using the SQL Server Management Studio.</span></span> <span data-ttu-id="23549-119">La page de support de sauvegarde comprend maintenant l’option **URL** pour afficher les fichiers de sauvegarde stockés dans le service de stockage Blob Azure.</span><span class="sxs-lookup"><span data-stu-id="23549-119">The backup media page now includes the **URL** option to show backup files stored in the Azure Blob storage service.</span></span> <span data-ttu-id="23549-120">Vous devez également fournir les informations d'identification SQL utilisées par vous authentifier sur le compte de stockage.</span><span class="sxs-lookup"><span data-stu-id="23549-120">You also must provide the SQL Credential that is used to authenticate to the storage account.</span></span> <span data-ttu-id="23549-121">La grille **Jeux de sauvegarde à restaurer** est ensuite remplie avec les sauvegardes disponibles dans le stockage Blob Azure.</span><span class="sxs-lookup"><span data-stu-id="23549-121">The **Backup sets to restore** grid is then populated with the available backups in the Azure Blob storage.</span></span> <span data-ttu-id="23549-122">Pour plus d’informations, consultez [Restauration à partir du stockage Azure à l’aide de SQL Server Management Studio](sql-server-backup-to-url.md#RestoreSSMS).</span><span class="sxs-lookup"><span data-stu-id="23549-122">For more information, see [Restoring from Azure storage Using SQL Server Management Studio](sql-server-backup-to-url.md#RestoreSSMS).</span></span>  
  
### <a name="optimizing-restores"></a><span data-ttu-id="23549-123">Optimisation des restaurations</span><span class="sxs-lookup"><span data-stu-id="23549-123">Optimizing Restores</span></span>  
 <span data-ttu-id="23549-124">Pour réduire le temps d’écriture des restaurations, ajoutez le droit d’utilisateur **Effectuer les tâches de maintenance de volume** au compte d’utilisateur SQL Server.</span><span class="sxs-lookup"><span data-stu-id="23549-124">To reduce restore write time, Add **perform volume maintenance tasks** user right to the SQL Server user account.</span></span> <span data-ttu-id="23549-125">Pour plus d’informations, consultez [Initialisation des fichiers de base de données](https://go.microsoft.com/fwlink/?LinkId=271622).</span><span class="sxs-lookup"><span data-stu-id="23549-125">For more information, see [Database File Initialization](https://go.microsoft.com/fwlink/?LinkId=271622).</span></span> <span data-ttu-id="23549-126">Si la restauration est toujours lente avec l'initialisation instantanée des fichiers activée, examinez la taille du fichier journal sur l'instance où la base de données a été sauvegardée.</span><span class="sxs-lookup"><span data-stu-id="23549-126">If restore is still slow with instant file initialization turned on, look at the size of the log file on the instance where the database was backed up.</span></span> <span data-ttu-id="23549-127">Si le fichier journal est de très grande taille (plusieurs Go), il faut s'attendre à ce que la restauration soit lente.</span><span class="sxs-lookup"><span data-stu-id="23549-127">If the log is very large in size (multiple GBs), it would be expected that restore would be slow.</span></span> <span data-ttu-id="23549-128">Pendant la restauration, le fichier journal doit être remis à zéro, ce qui prend beaucoup de temps.</span><span class="sxs-lookup"><span data-stu-id="23549-128">During restore the log file must be zeroed which takes a significant amount of time.</span></span>  
  
 <span data-ttu-id="23549-129">Pour réduire les durées de restauration, il est recommandé d'utiliser des sauvegardes compressées.</span><span class="sxs-lookup"><span data-stu-id="23549-129">To reduce restore times it is recommended that you use compressed backups.</span></span>  <span data-ttu-id="23549-130">Pour des tailles de sauvegarde de plus de 25 Go, utilisez l’ [utilitaire AzCopy](https://docs.microsoft.com/archive/blogs/windowsazurestorage/azcopy-uploadingdownloading-files-for-windows-azure-blobs) pour un téléchargement sur le disque local, puis effectuez la restauration.</span><span class="sxs-lookup"><span data-stu-id="23549-130">For backup sizes exceeding 25 GB, use [AzCopy utility](https://docs.microsoft.com/archive/blogs/windowsazurestorage/azcopy-uploadingdownloading-files-for-windows-azure-blobs) to download to the local drive and then perform the restore.</span></span> <span data-ttu-id="23549-131">Pour connaître les bonnes pratiques et obtenir des recommandations, consultez [Meilleures pratiques et dépannage de sauvegarde SQL Server vers une URL](sql-server-backup-to-url-best-practices-and-troubleshooting.md).</span><span class="sxs-lookup"><span data-stu-id="23549-131">For other backup best practices and recommendations, see [SQL Server Backup to URL Best Practices and Troubleshooting](sql-server-backup-to-url-best-practices-and-troubleshooting.md).</span></span>  
  
 <span data-ttu-id="23549-132">Vous pouvez également activer l'indicateur de trace 3051 lors de la restauration afin de générer un journal détaillé.</span><span class="sxs-lookup"><span data-stu-id="23549-132">You can also turn on Trace Flag 3051 when doing the restore to generate a detailed log.</span></span> <span data-ttu-id="23549-133">Ce fichier journal se trouve dans le répertoire du journal et son nom est au format suivant : BackupToUrl-\<instancename>-\<dbname>-action-\<PID>.log.</span><span class="sxs-lookup"><span data-stu-id="23549-133">This log file is placed in the log directory, and is named using the format: BackupToUrl-\<instancename>-\<dbname>-action-\<PID>.log.</span></span> <span data-ttu-id="23549-134">Le fichier journal contient des informations sur chaque aller-retour dans le Stockage Azure, y compris le délai d’attente qui peut être utile lors du diagnostic de problèmes.</span><span class="sxs-lookup"><span data-stu-id="23549-134">The log file includes information about each round trip to Azure Storage including timing that can be helpful in diagnosing the issue.</span></span>  
  
### <a name="topics-on-performing-restore-operations"></a><span data-ttu-id="23549-135">Rubriques relatives aux procédures des opérations de restauration</span><span class="sxs-lookup"><span data-stu-id="23549-135">Topics on Performing Restore Operations</span></span>  
  
-   [<span data-ttu-id="23549-136">Restaurations complètes de bases de données &#40;mode de récupération simple&#41;</span><span class="sxs-lookup"><span data-stu-id="23549-136">Complete Database Restores &#40;Simple Recovery Model&#41;</span></span>](complete-database-restores-simple-recovery-model.md)  
  
-   [<span data-ttu-id="23549-137">RESTORE &#40;Transact-SQL&#41;</span><span class="sxs-lookup"><span data-stu-id="23549-137">RESTORE &#40;Transact-SQL&#41;</span></span>](/sql/t-sql/statements/restore-statements-transact-sql)  
  
-   [<span data-ttu-id="23549-138">Restaurations complètes de bases de données &#40;mode de récupération complète&#41;</span><span class="sxs-lookup"><span data-stu-id="23549-138">Complete Database Restores &#40;Full Recovery Model&#41;</span></span>](complete-database-restores-full-recovery-model.md)  
  
-   [<span data-ttu-id="23549-139">Restaurations de fichiers &#40;mode de récupération simple&#41;</span><span class="sxs-lookup"><span data-stu-id="23549-139">File Restores &#40;Simple Recovery Model&#41;</span></span>](file-restores-simple-recovery-model.md)  
  
-   [<span data-ttu-id="23549-140">Restaurations de fichiers &#40;mode de récupération complète&#41;</span><span class="sxs-lookup"><span data-stu-id="23549-140">File Restores &#40;Full Recovery Model&#41;</span></span>](file-restores-full-recovery-model.md)  
  
-   [<span data-ttu-id="23549-141">Restaurations fragmentaires &#40;SQL Server&#41;</span><span class="sxs-lookup"><span data-stu-id="23549-141">Piecemeal Restores &#40;SQL Server&#41;</span></span>](piecemeal-restores-sql-server.md)  
  
  
