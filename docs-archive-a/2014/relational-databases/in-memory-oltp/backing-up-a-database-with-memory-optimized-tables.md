---
title: Sauvegarde d’une base de données avec des tables mémoire optimisées | Microsoft Docs
ms.custom: ''
ms.date: 06/13/2017
ms.prod: sql-server-2014
ms.reviewer: ''
ms.technology: in-memory-oltp
ms.topic: conceptual
ms.assetid: 83d47694-e56d-4dae-b54e-14945bf8ba31
author: CarlRabeler
ms.author: carlrab
ms.openlocfilehash: 176448aa9d4bab4101ab2db12ffc9a8a7fd1a5b5
ms.sourcegitcommit: ad4d92dce894592a259721a1571b1d8736abacdb
ms.translationtype: MT
ms.contentlocale: fr-FR
ms.lasthandoff: 08/04/2020
ms.locfileid: "87601454"
---
# <a name="backing-up-a-database-with-memory-optimized-tables"></a><span data-ttu-id="0ef44-102">Sauvegarde d'une base de données avec des tables mémoire optimisées</span><span class="sxs-lookup"><span data-stu-id="0ef44-102">Backing Up a Database with Memory-Optimized Tables</span></span>
  <span data-ttu-id="0ef44-103">Les tables mémoire optimisées sont sauvegardées dans le cadre des sauvegardes de base de données normales.</span><span class="sxs-lookup"><span data-stu-id="0ef44-103">Memory-optimized tables are backed up as part of regular database backups.</span></span> <span data-ttu-id="0ef44-104">Pour les tables sur disque, la valeur CHECKSUM des paires de fichiers de données et delta est validée dans le cadre de la sauvegarde de base de données pour détecter la corruption du stockage.</span><span class="sxs-lookup"><span data-stu-id="0ef44-104">As for disk-based tables, the CHECKSUM of data and delta file pairs is validated as part of the database backup to detect storage corruption.</span></span>  
  
> [!NOTE]  
>  <span data-ttu-id="0ef44-105">Pendant une sauvegarde, si vous détectez une erreur CHECKSUM dans un ou plusieurs fichiers d'un groupe de fichiers mémoire optimisé, vous ne pourrez pas restaurer et redémarrer la base de données.</span><span class="sxs-lookup"><span data-stu-id="0ef44-105">During a backup, if you detect a CHECKSUM error in one or more files in a memory-optimized filegroup, you will not be able to restore and restart the database.</span></span> <span data-ttu-id="0ef44-106">Dans ce cas, vous devez restaurer votre base de données à l'aide de la dernière sauvegarde connue et fiable.</span><span class="sxs-lookup"><span data-stu-id="0ef44-106">In that situation, you must, restore your database with the last known good backup.</span></span> <span data-ttu-id="0ef44-107">Si vous ne disposez pas d’une sauvegarde, exportez les données des tables à mémoire optimisée et des tables sur disque, et rechargez-les après avoir supprimé et recréé la base de données.</span><span class="sxs-lookup"><span data-stu-id="0ef44-107">If you don't have a backup, you can export the data from memory-optimized tables and disk-based tables and reload after you drop and recreate the database.</span></span>  
  
 <span data-ttu-id="0ef44-108">Une sauvegarde complète d'une base de données avec une ou plusieurs tables mémoire optimisées comprend le stockage alloué pour les tables sur disque (le cas échéant), le journal des transactions actives, et les paires de fichiers de données et delta (également appelées des « paires de fichiers de point de contrôle ») pour les tables mémoire optimisées.</span><span class="sxs-lookup"><span data-stu-id="0ef44-108">A full backup of a database with one or more memory-optimized tables consists of the allocated storage for disk-based tables (if any), the active transaction log, and the data and delta file pairs (also known as checkpoint file pairs) for memory-optimized tables.</span></span> <span data-ttu-id="0ef44-109">Cependant, comme décrit dans [Durabilité pour les tables optimisées en mémoire](memory-optimized-tables.md), le stockage utilisé par les tables optimisées en mémoire peut être bien supérieur à sa taille en mémoire, et cela a une incidence sur la taille de la sauvegarde de base de données.</span><span class="sxs-lookup"><span data-stu-id="0ef44-109">However, as described in [Durability for Memory-Optimized Tables](memory-optimized-tables.md), the storage used by memory-optimized tables can be much larger than its size in memory, and it affects the size of the database backup.</span></span>  
  
## <a name="full-database-backup"></a><span data-ttu-id="0ef44-110">Sauvegarde de base de données complète</span><span class="sxs-lookup"><span data-stu-id="0ef44-110">Full Database Backup</span></span>  
 <span data-ttu-id="0ef44-111">Cette section aborde les sauvegardes de bases de données qui ne contiennent que des tables mémoire optimisées, car la sauvegarde de tables sur disque est identique.</span><span class="sxs-lookup"><span data-stu-id="0ef44-111">This discussion will focus on database backups for databases with just durable memory-optimized tables, because the backup for disk-based tables is the same.</span></span> <span data-ttu-id="0ef44-112">Les paires de fichiers de point de contrôle dans le groupe de fichiers mémoire optimisé peuvent avoir différents états.</span><span class="sxs-lookup"><span data-stu-id="0ef44-112">The checkpoint file pairs in the memory-optimized filegroup could be in various states.</span></span> <span data-ttu-id="0ef44-113">Le tableau ci-dessous indique quelle partie des fichiers est sauvegardée.</span><span class="sxs-lookup"><span data-stu-id="0ef44-113">The table below describes what part of the files is backed.</span></span>  
  
|<span data-ttu-id="0ef44-114">État de la paire de fichiers de point de contrôle</span><span class="sxs-lookup"><span data-stu-id="0ef44-114">Checkpoint File Pair State</span></span>|<span data-ttu-id="0ef44-115">Sauvegarde</span><span class="sxs-lookup"><span data-stu-id="0ef44-115">Backup</span></span>|  
|--------------------------------|------------|  
|<span data-ttu-id="0ef44-116">PRECREATED</span><span class="sxs-lookup"><span data-stu-id="0ef44-116">PRECREATED</span></span>|<span data-ttu-id="0ef44-117">Métadonnées du fichier uniquement</span><span class="sxs-lookup"><span data-stu-id="0ef44-117">File metadata only</span></span>|  
|<span data-ttu-id="0ef44-118">UNDER CONSTRUCTION</span><span class="sxs-lookup"><span data-stu-id="0ef44-118">UNDER CONSTRUCTION</span></span>|<span data-ttu-id="0ef44-119">Métadonnées du fichier uniquement</span><span class="sxs-lookup"><span data-stu-id="0ef44-119">File metadata only</span></span>|  
|<span data-ttu-id="0ef44-120">Actif</span><span class="sxs-lookup"><span data-stu-id="0ef44-120">Active</span></span>|<span data-ttu-id="0ef44-121">Métadonnées du fichier plus octets utilisés</span><span class="sxs-lookup"><span data-stu-id="0ef44-121">File metadata plus used bytes</span></span>|  
|<span data-ttu-id="0ef44-122">MERGE SOURCE</span><span class="sxs-lookup"><span data-stu-id="0ef44-122">Merge source</span></span>|<span data-ttu-id="0ef44-123">Métadonnées du fichier plus octets utilisés</span><span class="sxs-lookup"><span data-stu-id="0ef44-123">File metadata plus used bytes</span></span>|  
|<span data-ttu-id="0ef44-124">MERGE TARGET</span><span class="sxs-lookup"><span data-stu-id="0ef44-124">Merge target</span></span>|<span data-ttu-id="0ef44-125">Métadonnées du fichier uniquement</span><span class="sxs-lookup"><span data-stu-id="0ef44-125">File metadata only</span></span>|  
|<span data-ttu-id="0ef44-126">REQUIRED FOR BACKUP/HA</span><span class="sxs-lookup"><span data-stu-id="0ef44-126">REQUIRED FOR BACKUP/HA</span></span>|<span data-ttu-id="0ef44-127">Métadonnées du fichier plus octets utilisés</span><span class="sxs-lookup"><span data-stu-id="0ef44-127">File metadata plus used bytes</span></span>|  
|<span data-ttu-id="0ef44-128">IN TRANSITION TO TOMBSTONE</span><span class="sxs-lookup"><span data-stu-id="0ef44-128">IN TRANSITION TO TOMBSTONE</span></span>|<span data-ttu-id="0ef44-129">Métadonnées du fichier uniquement</span><span class="sxs-lookup"><span data-stu-id="0ef44-129">File metadata only</span></span>|  
|<span data-ttu-id="0ef44-130">TOMBSTONE</span><span class="sxs-lookup"><span data-stu-id="0ef44-130">TOMBSTONE</span></span>|<span data-ttu-id="0ef44-131">Métadonnées du fichier uniquement</span><span class="sxs-lookup"><span data-stu-id="0ef44-131">File metadata only</span></span>|  
  
 <span data-ttu-id="0ef44-132">La taille des sauvegardes de base de données avec une ou plusieurs tables mémoire optimisées est généralement supérieure à sa taille en mémoire, mais inférieure à la taille de stockage sur disque.</span><span class="sxs-lookup"><span data-stu-id="0ef44-132">The size of database backups with one or more memory-optimized tables is typically larger than its size in memory but smaller than the on-disk storage.</span></span> <span data-ttu-id="0ef44-133">La taille supplémentaire dépendra du nombre de lignes supprimées et du nombre de paires de fichiers de point de contrôle qui ont les états MERGE SOURCE et REQUIRED FOR BACKUP/HA, ce qui dépend indirectement de la charge de travail.</span><span class="sxs-lookup"><span data-stu-id="0ef44-133">The extra size will depend upon the number of deleted rows and the number of checkpoint file pairs in the states Merge source and REQUIRED FOR BACKUP/HA which indirectly depends upon the workload.</span></span> <span data-ttu-id="0ef44-134">Pour obtenir une description des États des paires de fichiers de point de contrôle, consultez [sys. dm_db_xtp_checkpoint_files &#40;Transact-SQL&#41;](/sql/relational-databases/system-dynamic-management-views/sys-dm-db-xtp-checkpoint-files-transact-sql).</span><span class="sxs-lookup"><span data-stu-id="0ef44-134">For descriptions of the states for checkpoint file pairs, see [sys.dm_db_xtp_checkpoint_files &#40;Transact-SQL&#41;](/sql/relational-databases/system-dynamic-management-views/sys-dm-db-xtp-checkpoint-files-transact-sql).</span></span>  
  
### <a name="estimating-size-of-full-database-backup"></a><span data-ttu-id="0ef44-135">Estimation de la taille d'une sauvegarde complète de base de données</span><span class="sxs-lookup"><span data-stu-id="0ef44-135">Estimating Size of Full Database Backup</span></span>  
  
> [!IMPORTANT]  
>  <span data-ttu-id="0ef44-136">Il est recommandé de ne pas utiliser la valeur BackupSizeInBytes pour estimer la taille de sauvegarde de l’OLTP en mémoire.</span><span class="sxs-lookup"><span data-stu-id="0ef44-136">It's recommended that you not use the BackupSizeInBytes value to estimate the backup size for In-Memory OLTP.</span></span>  
  
 <span data-ttu-id="0ef44-137">Le premier scénario de charge de travail concerne l'insertion (pour la plupart).</span><span class="sxs-lookup"><span data-stu-id="0ef44-137">The first workload scenario is for (mostly) insert.</span></span> <span data-ttu-id="0ef44-138">Dans ce scénario, la plupart des fichiers de données auront l'état ACTIVE, seront totalement chargés et comporteront très peu de lignes supprimées.</span><span class="sxs-lookup"><span data-stu-id="0ef44-138">In this scenario, most data files will be in the Active state, fully loaded, and with very few deleted rows.</span></span> <span data-ttu-id="0ef44-139">La taille de la sauvegarde de base de données sera proche de la taille des données en mémoire.</span><span class="sxs-lookup"><span data-stu-id="0ef44-139">The size of database backup up will be close to the size of data in memory.</span></span>  
  
 <span data-ttu-id="0ef44-140">Le deuxième scénario de charge de travail concerne les opérations d'insertion, de suppression, et de mise à jour fréquentes : dans le pire des cas, chacune des paires de fichiers de point de contrôle est chargée à 50%, après avoir pris en compte les lignes supprimées.</span><span class="sxs-lookup"><span data-stu-id="0ef44-140">The second workload scenario is for frequent insert, delete, and update operations: In the worst case, each of the checkpoint file pairs are 50% loaded, after accounting for the deleted rows.</span></span> <span data-ttu-id="0ef44-141">Par conséquent, la taille de la sauvegarde de base de données sera égale à au moins 2 fois la taille des données en mémoire.</span><span class="sxs-lookup"><span data-stu-id="0ef44-141">So the size of the database backup will at least be 2 times the size of data in memory.</span></span> <span data-ttu-id="0ef44-142">En outre, il y aura peu de paires de fichiers de point de contrôle dans l'état MERGE SOURCE et REQUIRED FOR BACKUP/HA susceptibles d'augmenter la taille de la sauvegarde de la base de données.</span><span class="sxs-lookup"><span data-stu-id="0ef44-142">Additionally, there will few checkpoint file pairs in states Merge source and Required for backup/high availability that will add to the size of database backup.</span></span>  
  
## <a name="differential-backups-of-databases-with-memory-optimized-tables"></a><span data-ttu-id="0ef44-143">Sauvegardes différentielles de bases de données avec des tables mémoire optimisées</span><span class="sxs-lookup"><span data-stu-id="0ef44-143">Differential Backups of Databases with Memory-Optimized Tables</span></span>  
 <span data-ttu-id="0ef44-144">Le stockage des tables optimisées en mémoire comprend des données et des fichiers delta, comme décrit dans [Durabilité pour les tables optimisées en mémoire](memory-optimized-tables.md).</span><span class="sxs-lookup"><span data-stu-id="0ef44-144">The storage for memory-optimized tables consists of data and delta files as described in [Durability for Memory-Optimized Tables](memory-optimized-tables.md).</span></span> <span data-ttu-id="0ef44-145">La sauvegarde différentielle d'une base de données avec des tables mémoire optimisées contient les données suivantes :</span><span class="sxs-lookup"><span data-stu-id="0ef44-145">The differential backup of a database with memory-optimized tables contains the following data:</span></span>  
  
-   <span data-ttu-id="0ef44-146">La sauvegarde différentielle pour les groupes de fichiers qui stockent des tables sur disque n'est pas affectée par la présence de tables mémoire optimisées.</span><span class="sxs-lookup"><span data-stu-id="0ef44-146">Differential backup for filegroups storing disk-based tables is not affected by the presence of memory-optimized tables.</span></span>  
  
-   <span data-ttu-id="0ef44-147">Le journal des transactions actif est le même que dans une sauvegarde de base de données complète.</span><span class="sxs-lookup"><span data-stu-id="0ef44-147">The active transaction log is the same as in a full database backup.</span></span>  
  
-   <span data-ttu-id="0ef44-148">Pour un groupe de fichiers de données mémoire optimisé, la sauvegarde différentielle utilise le même algorithme que la sauvegarde de base de données complète pour identifier les fichiers de données et delta, mais filtre ensuite le sous-ensemble de fichiers comme suit :</span><span class="sxs-lookup"><span data-stu-id="0ef44-148">For a memory-optimized data filegroup, the differential backup uses the same algorithm as full database backup to identify the data and delta files for backup but it then filters out the subset of files as follows:</span></span>  
  
    -   <span data-ttu-id="0ef44-149">Un fichier de données contient les nouvelles lignes insérées, et lorsqu'il est plein, il est fermé et marqué en lecture seule.</span><span class="sxs-lookup"><span data-stu-id="0ef44-149">A data file contains newly inserted rows and when it is full, it is closed and marked read-only.</span></span> <span data-ttu-id="0ef44-150">Un fichier de données est sauvegardé uniquement s'il est fermé après la dernière sauvegarde complète de la base de données.</span><span class="sxs-lookup"><span data-stu-id="0ef44-150">A data file is backed up only if it was closed after the last full database backup.</span></span> <span data-ttu-id="0ef44-151">La sauvegarde différentielle sauvegarde uniquement les fichiers de données contenant les lignes insérées depuis la dernière sauvegarde complète, excepté dans un scénario de mise à jour et suppression où il est possible que certaines lignes insérées soient déjà marquées pour le garbage collection, ou déjà nettoyées.</span><span class="sxs-lookup"><span data-stu-id="0ef44-151">The differential backup only backups up data files containing the inserted rows since the last full database backup with the exception of an update and delete scenario where it is possible that some of the inserted rows may have already been either marked for garbage collection or already garbage collected.</span></span>  
  
    -   <span data-ttu-id="0ef44-152">Un fichier delta stocke les référence aux lignes de données supprimées.</span><span class="sxs-lookup"><span data-stu-id="0ef44-152">A delta file stores references to the deleted data rows.</span></span> <span data-ttu-id="0ef44-153">Étant donné qu'une transaction ultérieure peut supprimer une ligne, un fichier delta peut être modifié à tout moment au cours de sa durée de vie, et n'est jamais fermé.</span><span class="sxs-lookup"><span data-stu-id="0ef44-153">Since any future transaction can delete a row, a delta file can be modified anytime in its life time, it is never closed.</span></span> <span data-ttu-id="0ef44-154">Un fichier delta est toujours sauvegardé.</span><span class="sxs-lookup"><span data-stu-id="0ef44-154">A delta file is always backed up.</span></span> <span data-ttu-id="0ef44-155">Les fichiers delta utilisent généralement moins de 10 % du stockage, par conséquent, ils ont un impact minime sur la taille de la sauvegarde différentielle.</span><span class="sxs-lookup"><span data-stu-id="0ef44-155">Delta files typically use less than 10% of the storage, so delta files have a minimal impact on the size of differential backup.</span></span>  
  
 <span data-ttu-id="0ef44-156">Si les tables mémoire optimisées représentent une partie significative de la taille de votre base de données, la sauvegarde différentielle peut considérablement réduire la taille de votre sauvegarde.</span><span class="sxs-lookup"><span data-stu-id="0ef44-156">If memory-optimized tables are a significant portion of your database size, the differential backup can significantly reduce the size of your database backup.</span></span>  
  
 <span data-ttu-id="0ef44-157">Pour les charges de travail OLTP typiques, les sauvegardes différentielles seront considérablement inférieures aux sauvegardes de base de données complètes.</span><span class="sxs-lookup"><span data-stu-id="0ef44-157">For typical OLTP workloads, the differential backups will be considerably smaller than the full database backups.</span></span>  
  
## <a name="see-also"></a><span data-ttu-id="0ef44-158">Voir aussi</span><span class="sxs-lookup"><span data-stu-id="0ef44-158">See Also</span></span>  
 [<span data-ttu-id="0ef44-159">Sauvegarder, restaurer et récupérer des tables optimisées en mémoire</span><span class="sxs-lookup"><span data-stu-id="0ef44-159">Backup, Restore, and Recovery of Memory-Optimized Tables</span></span>](restore-and-recovery-of-memory-optimized-tables.md)  
  
  
