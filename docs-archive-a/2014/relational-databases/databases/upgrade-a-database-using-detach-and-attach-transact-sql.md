---
title: Mettre à niveau une base de données avec Detach et Attach (Transact-SQL) | Microsoft Docs
ms.custom: ''
ms.date: 06/13/2017
ms.prod: sql-server-2014
ms.reviewer: ''
ms.technology: ''
ms.topic: conceptual
helpviewer_keywords:
- database attaching [SQL Server]
- upgrading databases
- database upgrades [SQL Server]
- database detaching [SQL Server]
- detaching databases [SQL Server]
- attaching databases [SQL Server]
ms.assetid: 99f66ed9-3a75-4e38-ad7d-6c27cc3529a9
author: stevestein
ms.author: sstein
ms.openlocfilehash: d430825fd862ff49b867790f366200a524df3c1c
ms.sourcegitcommit: ad4d92dce894592a259721a1571b1d8736abacdb
ms.translationtype: MT
ms.contentlocale: fr-FR
ms.lasthandoff: 08/04/2020
ms.locfileid: "87603548"
---
# <a name="upgrade-a-database-using-detach-and-attach-transact-sql"></a><span data-ttu-id="69100-102">Mettre à niveau une base de données avec Detach et Attach (Transact-SQL)</span><span class="sxs-lookup"><span data-stu-id="69100-102">Upgrade a Database Using Detach and Attach (Transact-SQL)</span></span>
  <span data-ttu-id="69100-103">Cette rubrique explique comment utiliser les opérations d'attachement et de détachement pour mettre à niveau une base de données dans [!INCLUDE[ssCurrent](../../includes/sscurrent-md.md)].</span><span class="sxs-lookup"><span data-stu-id="69100-103">This topic describes how to use detach and attach operations to upgrade a database in [!INCLUDE[ssCurrent](../../includes/sscurrent-md.md)].</span></span> <span data-ttu-id="69100-104">Une fois attachée à [!INCLUDE[ssCurrent](../../includes/sscurrent-md.md)], la base de données est immédiatement disponible et est automatiquement mise à niveau.</span><span class="sxs-lookup"><span data-stu-id="69100-104">After being attached to [!INCLUDE[ssCurrent](../../includes/sscurrent-md.md)], the database is available immediately and is automatically upgraded.</span></span>  
  
 <span data-ttu-id="69100-105">**Dans cette rubrique**</span><span class="sxs-lookup"><span data-stu-id="69100-105">**In This Topic**</span></span>  
  
-   <span data-ttu-id="69100-106">**Avant de commencer :**</span><span class="sxs-lookup"><span data-stu-id="69100-106">**Before you begin:**</span></span>  
  
     [<span data-ttu-id="69100-107">Limitations et restrictions</span><span class="sxs-lookup"><span data-stu-id="69100-107">Limitations and Restrictions</span></span>](#Restrictions)  
  
     [<span data-ttu-id="69100-108">Recommandations</span><span class="sxs-lookup"><span data-stu-id="69100-108">Recommendations</span></span>](#Recommendations)  
  
-   <span data-ttu-id="69100-109">**Pour mettre à niveau une base de données SQL Server :**</span><span class="sxs-lookup"><span data-stu-id="69100-109">**To Upgrade a SQL Server Database:**</span></span>  
  
     [<span data-ttu-id="69100-110">Utilisation des opérations de détachement et d'attachement</span><span class="sxs-lookup"><span data-stu-id="69100-110">Using detach and attach operations</span></span>](#SSMSProcedure)  
  
-   <span data-ttu-id="69100-111">**Suivi :**  [Après la mise à niveau d'une base de données SQL Server](#FollowUp)</span><span class="sxs-lookup"><span data-stu-id="69100-111">**Follow Up:**  [After Upgrading a SQL Server Database](#FollowUp)</span></span>  
  
##  <a name="before-you-begin"></a><a name="BeforeYouBegin"></a> <span data-ttu-id="69100-112">Avant de commencer</span><span class="sxs-lookup"><span data-stu-id="69100-112">Before You Begin</span></span>  
  
###  <a name="limitations-and-restrictions"></a><a name="Restrictions"></a> <span data-ttu-id="69100-113">Limitations et restrictions</span><span class="sxs-lookup"><span data-stu-id="69100-113">Limitations and Restrictions</span></span>  
  
-   <span data-ttu-id="69100-114">Les bases de données système ne peuvent pas être attachées.</span><span class="sxs-lookup"><span data-stu-id="69100-114">The system databases cannot be attached.</span></span>  
  
-   <span data-ttu-id="69100-115">Attach et Detach désactivent le chaînage des propriétés des bases de données croisées pour la base de données en affectant la valeur 0 à l’option **cross db ownership chaining** .</span><span class="sxs-lookup"><span data-stu-id="69100-115">Attach and detach disable cross-database ownership chaining for the database by setting its **cross db ownership chaining** option to 0.</span></span> <span data-ttu-id="69100-116">Pour plus d’informations sur l’activation du chaînage, consultez [Chaînage des propriétés des bases de données croisées (option de configuration de serveur)](../../database-engine/configure-windows/cross-db-ownership-chaining-server-configuration-option.md).</span><span class="sxs-lookup"><span data-stu-id="69100-116">For information about enabling chaining, see [cross db ownership chaining Server Configuration Option](../../database-engine/configure-windows/cross-db-ownership-chaining-server-configuration-option.md).</span></span>  
  
-   <span data-ttu-id="69100-117">Si vous attachez une base de données répliquée qui a été copiée et non pas détachée :</span><span class="sxs-lookup"><span data-stu-id="69100-117">When attaching a replicated database that was copied instead of detached:</span></span>  
  
    -   <span data-ttu-id="69100-118">Si vous attachez la base de données à une version mise à niveau de la même instance de serveur, vous devez exécuter **sp_vupgrade_replication** pour mettre à niveau la réplication au terme de l’opération d’attachement.</span><span class="sxs-lookup"><span data-stu-id="69100-118">If you attach the database to an upgraded version of the same server instance, you must execute **sp_vupgrade_replication** to upgrade replication after the attach operation finishes.</span></span> <span data-ttu-id="69100-119">Pour plus d’informations, consultez [sp_vupgrade_replication &#40;Transact-SQL&#41;](/sql/relational-databases/system-stored-procedures/sp-vupgrade-replication-transact-sql).</span><span class="sxs-lookup"><span data-stu-id="69100-119">For more information, see [sp_vupgrade_replication &#40;Transact-SQL&#41;](/sql/relational-databases/system-stored-procedures/sp-vupgrade-replication-transact-sql).</span></span>  
  
    -   <span data-ttu-id="69100-120">Si vous attachez la base de données à une instance de serveur différente (quelle que soit sa version), vous devez exécuter **sp_removedbreplication** pour supprimer la réplication au terme de l’opération d’attachement.</span><span class="sxs-lookup"><span data-stu-id="69100-120">If you attach the database to a different server instance (regardless of version), you must execute **sp_removedbreplication** to remove replication after the attach operation finishes.</span></span> <span data-ttu-id="69100-121">Pour plus d’informations, consultez [sp_removedbreplication &#40;Transact-SQL&#41;](/sql/relational-databases/system-stored-procedures/sp-removedbreplication-transact-sql).</span><span class="sxs-lookup"><span data-stu-id="69100-121">For more information, see [sp_removedbreplication &#40;Transact-SQL&#41;](/sql/relational-databases/system-stored-procedures/sp-removedbreplication-transact-sql).</span></span>  
  
###  <a name="recommendations"></a><a name="Recommendations"></a> <span data-ttu-id="69100-122">Recommandations</span><span class="sxs-lookup"><span data-stu-id="69100-122">Recommendations</span></span>  
 <span data-ttu-id="69100-123">Nous vous recommandons de ne pas attacher ni restaurer de bases de données provenant de sources inconnues ou non approuvées.</span><span class="sxs-lookup"><span data-stu-id="69100-123">We recommend that you do not attach or restore databases from unknown or untrusted sources.</span></span> <span data-ttu-id="69100-124">Ces bases de données peuvent contenir du code malveillant susceptible d'exécuter du code [!INCLUDE[tsql](../../includes/tsql-md.md)] indésirable ou de provoquer des erreurs en modifiant le schéma ou la structure physique des bases de données.</span><span class="sxs-lookup"><span data-stu-id="69100-124">Such databases could contain malicious code that might execute unintended [!INCLUDE[tsql](../../includes/tsql-md.md)] code or cause errors by modifying the schema or the physical database structure.</span></span> <span data-ttu-id="69100-125">Avant d’utiliser une base de données issue d’une source inconnue ou non approuvée, exécutez [DBCC CHECKDB](/sql/t-sql/database-console-commands/dbcc-checkdb-transact-sql) sur la base de données sur un serveur autre qu’un serveur de production et examinez également le code, notamment les procédures stockées ou le code défini par l’utilisateur, de la base de données.</span><span class="sxs-lookup"><span data-stu-id="69100-125">Before you use a database from an unknown or untrusted source, run [DBCC CHECKDB](/sql/t-sql/database-console-commands/dbcc-checkdb-transact-sql) on the database on a nonproduction server and also examine the code, such as stored procedures or other user-defined code, in the database.</span></span>  
  
##  <a name="to-upgrade-a-database-by-using-detach-and-attach"></a><a name="SSMSProcedure"></a> <span data-ttu-id="69100-126">Pour mettre à niveau une base de données à l'aide des opérations de détachement et d'attachement</span><span class="sxs-lookup"><span data-stu-id="69100-126">To Upgrade a Database by Using Detach and Attach</span></span>  
  
1.  <span data-ttu-id="69100-127">Détachez la base de données.</span><span class="sxs-lookup"><span data-stu-id="69100-127">Detach the database.</span></span> <span data-ttu-id="69100-128">Pour plus d’informations, consultez [Détacher une base de données](detach-a-database.md).</span><span class="sxs-lookup"><span data-stu-id="69100-128">For more information, see [Detach a Database](detach-a-database.md).</span></span>  
  
2.  <span data-ttu-id="69100-129">Éventuellement, déplacez le ou les fichiers de base de données détachés et le ou les fichiers journaux.</span><span class="sxs-lookup"><span data-stu-id="69100-129">Optionally, move the detached database file or files and the log file or files.</span></span>  
  
     <span data-ttu-id="69100-130">Vous devez déplacer les fichiers journaux ainsi que les fichiers de données, même si vous souhaitez créer de nouveaux fichiers journaux.</span><span class="sxs-lookup"><span data-stu-id="69100-130">You should move the log files along with the data files, even if you intend to create new log files.</span></span> <span data-ttu-id="69100-131">Dans certains cas, le rattachement d'une base de données nécessite ses fichiers journaux existants.</span><span class="sxs-lookup"><span data-stu-id="69100-131">In some cases, reattaching a database requires its existing log files.</span></span> <span data-ttu-id="69100-132">Par conséquent, conservez toujours tous les fichiers journaux détachés jusqu'à ce que la base de données ait été attachée avec succès sans eux.</span><span class="sxs-lookup"><span data-stu-id="69100-132">Therefore, always keep all the detached log files until the database has been successfully attached without them.</span></span>  
  
    > [!NOTE]  
    >  <span data-ttu-id="69100-133">Si vous tentez d'attacher la base de données sans spécifier le fichier journal, l'opération attach recherche le fichier journal à son emplacement d'origine.</span><span class="sxs-lookup"><span data-stu-id="69100-133">If you try to attach the database without specifying the log file, the attach operation will look for the log file in its original location.</span></span> <span data-ttu-id="69100-134">Si la copie d'origine du journal figure toujours dans cet emplacement, la copie est attachée.</span><span class="sxs-lookup"><span data-stu-id="69100-134">If the original copy of the log still exists in that location, that copy is attached.</span></span> <span data-ttu-id="69100-135">Pour éviter d'utiliser le fichier journal d'origine, spécifiez le chemin d'accès au nouveau fichier journal ou supprimez la copie d'origine du fichier journal (après l'avoir copiée au nouvel emplacement).</span><span class="sxs-lookup"><span data-stu-id="69100-135">To avoid using the original log file, either specify the path of the new log file or remove the original copy of the log file (after copying it to the new location).</span></span>  
  
3.  <span data-ttu-id="69100-136">Attachez les fichiers copiés à l'instance de [!INCLUDE[ssCurrent](../../includes/sscurrent-md.md)].</span><span class="sxs-lookup"><span data-stu-id="69100-136">Attach the copied files to the instance of [!INCLUDE[ssCurrent](../../includes/sscurrent-md.md)].</span></span> <span data-ttu-id="69100-137">Pour plus d’informations, consultez [Attach a Database](attach-a-database.md).</span><span class="sxs-lookup"><span data-stu-id="69100-137">For more information, see [Attach a Database](attach-a-database.md).</span></span>  
  
## <a name="example"></a><span data-ttu-id="69100-138">Exemple</span><span class="sxs-lookup"><span data-stu-id="69100-138">Example</span></span>  
 <span data-ttu-id="69100-139">L'exemple suivant met à niveau une copie d'une base de données à partir d'une version antérieure de SQL Server.</span><span class="sxs-lookup"><span data-stu-id="69100-139">The following example upgrades a copy of a database from an earlier version of SQL Server.</span></span> <span data-ttu-id="69100-140">Les instructions [!INCLUDE[tsql](../../includes/tsql-md.md)] sont exécutées dans une fenêtre d'éditeur de requêtes connectée à l'instance de serveur concernée par l'attachement.</span><span class="sxs-lookup"><span data-stu-id="69100-140">The [!INCLUDE[tsql](../../includes/tsql-md.md)] statements are executed in a Query Editor window that is connected to the server instance to which is attached.</span></span>  
  
1.  <span data-ttu-id="69100-141">Détachez la base de données en exécutant les instructions [!INCLUDE[tsql](../../includes/tsql-md.md)] suivantes :</span><span class="sxs-lookup"><span data-stu-id="69100-141">Detach the database by executing the following [!INCLUDE[tsql](../../includes/tsql-md.md)] statements:</span></span>  
  
    ```  
    USE master;  
    GO  
    EXEC sp_detach_db @dbname = N'MyDatabase';  
    GO  
    ```  
  
2.  <span data-ttu-id="69100-142">À l'aide de la méthode de votre choix, copiez les fichiers de données et les fichiers journaux au nouvel emplacement.</span><span class="sxs-lookup"><span data-stu-id="69100-142">Using the method of your choice, copy the data and log files to the new location.</span></span>  
  
    > [!IMPORTANT]  
    >  <span data-ttu-id="69100-143">Dans le cas d'une base de données de production, placez la base de données et le journal des transactions sur des disques distincts.</span><span class="sxs-lookup"><span data-stu-id="69100-143">For a production database, place the database and transaction log on separate disks.</span></span>  
  
     <span data-ttu-id="69100-144">Pour copier des fichiers via le réseau sur le disque d'un ordinateur distant, utilisez le nom UNC (Universal Naming Convention) de l'emplacement distant.</span><span class="sxs-lookup"><span data-stu-id="69100-144">To copy files over the network to a disk on a remote computer, use the universal naming convention (UNC) name of the remote location.</span></span> <span data-ttu-id="69100-145">Un nom UNC se présente sous la forme **\\\\** _nom_serveur_ **\\** _Nom_Partage_ **\\** _chemin_ **\\** _nom_fichier_.</span><span class="sxs-lookup"><span data-stu-id="69100-145">A UNC name takes the form **\\\\**_Servername_**\\**_Sharename_**\\**_Path_**\\**_Filename_.</span></span> <span data-ttu-id="69100-146">Comme lors de l'écriture de fichiers sur le disque dur local, les autorisations appropriées nécessaires à la lecture et à l'écriture d'un fichier sur le disque distant doivent être accordées au compte d'utilisateur utilisé par l'instance de [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)].</span><span class="sxs-lookup"><span data-stu-id="69100-146">As with writing files to the local hard disk, the appropriate permissions that are required to read or write to a file on the remote disk must be granted to the user account used by the instance of [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)].</span></span>  
  
3.  <span data-ttu-id="69100-147">Attachez la base de données déplacée, puis, si vous le souhaitez, son journal, en exécutant l'instruction [!INCLUDE[tsql](../../includes/tsql-md.md)] suivante :</span><span class="sxs-lookup"><span data-stu-id="69100-147">Attach the moved database and, optionally, its log by executing the following [!INCLUDE[tsql](../../includes/tsql-md.md)] statement:</span></span>  
  
    ```  
    USE master;  
    GO  
    CREATE DATABASE MyDatabase   
        ON (FILENAME = 'C:\MySQLServer\MyDatabase.mdf'),  
        (FILENAME = 'C:\MySQLServer\Database.ldf')  
        FOR ATTACH;  
    GO  
    ```  
  
     <span data-ttu-id="69100-148">Dans [!INCLUDE[ssManStudioFull](../../includes/ssmanstudiofull-md.md)], une base de données nouvellement attachée n'est pas immédiatement visible dans l'Explorateur d'objets.</span><span class="sxs-lookup"><span data-stu-id="69100-148">In [!INCLUDE[ssManStudioFull](../../includes/ssmanstudiofull-md.md)], a newly attached database is not immediately visible in Object Explorer.</span></span> <span data-ttu-id="69100-149">Pour visualiser la base de données, dans l'Explorateur d'objets, cliquez sur **Affichage** puis sur **Actualiser**.</span><span class="sxs-lookup"><span data-stu-id="69100-149">To view the database, in Object Explorer, click **View,** and then **Refresh**.</span></span> <span data-ttu-id="69100-150">Si le nœud **Bases de données** est développé dans l'Explorateur d'objets, la base de données récemment attachée apparaît dans la liste des bases de données.</span><span class="sxs-lookup"><span data-stu-id="69100-150">When the **Databases** node is expanded in Object Explorer, the newly attached database now appears in the list of databases.</span></span>  
  
##  <a name="follow-up-after-upgrading-a-sql-server-database"></a><a name="FollowUp"></a> <span data-ttu-id="69100-151">Suivi : Après la mise à niveau d'une base de données SQL Server</span><span class="sxs-lookup"><span data-stu-id="69100-151">Follow Up: After Upgrading a SQL Server Database</span></span>  
 <span data-ttu-id="69100-152">Si la base de données comprend des index de recherche en texte intégral, la mise à niveau les importe, les réinitialise ou les reconstruit, selon le paramètre de la propriété de serveur **upgrade_option** .</span><span class="sxs-lookup"><span data-stu-id="69100-152">If the database has full-text indexes, the upgrade process either imports, resets, or rebuilds them, depending on the setting of the **upgrade_option** server property.</span></span> <span data-ttu-id="69100-153">Si l’option de mise à niveau a la valeur Importer (**upgrade_option** = 2) ou Reconstruire (**upgrade_option** = 0), les index de recherche en texte intégral ne seront pas disponibles pendant la mise à niveau.</span><span class="sxs-lookup"><span data-stu-id="69100-153">If the upgrade option is set to import (**upgrade_option** = 2) or rebuild (**upgrade_option** = 0), the full-text indexes will be unavailable during the upgrade.</span></span> <span data-ttu-id="69100-154">Selon le volume de données indexé, l'importation peut prendre plusieurs heures et la reconstruction jusqu'à dix fois plus longtemps.</span><span class="sxs-lookup"><span data-stu-id="69100-154">Depending the amount of data being indexed, importing can take several hours, and rebuilding can take up to ten times longer.</span></span> <span data-ttu-id="69100-155">Notez également que lorsque l'option de mise à niveau est Importer, les index de recherche en texte intégral associés sont reconstruits si aucun catalogue de texte intégral n'est disponible.</span><span class="sxs-lookup"><span data-stu-id="69100-155">Note also that when the upgrade option is set to import, the associated full-text indexes are rebuilt if a full-text catalog is not available.</span></span> <span data-ttu-id="69100-156">Pour modifier le paramètre de la propriété de serveur **upgrade_option** , utilisez [sp_fulltext_service](/sql/relational-databases/system-stored-procedures/sp-fulltext-service-transact-sql).</span><span class="sxs-lookup"><span data-stu-id="69100-156">To change the setting of the **upgrade_option** server property, use [sp_fulltext_service](/sql/relational-databases/system-stored-procedures/sp-fulltext-service-transact-sql).</span></span>  
  
### <a name="database-compatibility-level-after-upgrade"></a><span data-ttu-id="69100-157">Niveau de compatibilité des bases de données après une mise à niveau</span><span class="sxs-lookup"><span data-stu-id="69100-157">Database Compatibility Level After Upgrade</span></span>  
 <span data-ttu-id="69100-158">Si le niveau de compatibilité d'une base de données utilisateur est à 100 ou supérieur avant la mise à niveau, il reste le même après la mise à niveau.</span><span class="sxs-lookup"><span data-stu-id="69100-158">If the compatibility level of a user database is 100 or higher before upgrade, it remains the same after upgrade.</span></span> <span data-ttu-id="69100-159">Si le niveau de compatibilité était à 90 avant la mise à niveau dans la base de données mise à niveau, le niveau de compatibilité est défini à 100, ce qui correspond au niveau de compatibilité le plus bas pris en charge dans [!INCLUDE[ssCurrent](../../includes/sscurrent-md.md)].</span><span class="sxs-lookup"><span data-stu-id="69100-159">If the compatibility level is 90 before upgrade in the upgraded database, the compatibility level is set to 100, which is the lowest supported compatibility level in [!INCLUDE[ssCurrent](../../includes/sscurrent-md.md)].</span></span> <span data-ttu-id="69100-160">Pour plus d’informations, consultez [Niveau de compatibilité ALTER DATABASE &#40;Transact-SQL&#41;](/sql/t-sql/statements/alter-database-transact-sql-compatibility-level).</span><span class="sxs-lookup"><span data-stu-id="69100-160">For more information, see [ALTER DATABASE Compatibility Level &#40;Transact-SQL&#41;](/sql/t-sql/statements/alter-database-transact-sql-compatibility-level).</span></span>  
  
### <a name="managing-metadata-on-the-upgraded-server-instance"></a><span data-ttu-id="69100-161">Gestion des métadonnées sur l'instance de serveur mise à niveau</span><span class="sxs-lookup"><span data-stu-id="69100-161">Managing Metadata on the Upgraded Server Instance</span></span>  
 <span data-ttu-id="69100-162">Lorsque vous attachez une base de données à une autre instance de serveur et si vous souhaitez offrir une expérience cohérente aux utilisateurs et aux applications, il est possible que vous deviez recréer une partie ou l'ensemble des métadonnées de la base de données, telles que les connexions, les travaux, et les autorisations sur cette autre instance de serveur.</span><span class="sxs-lookup"><span data-stu-id="69100-162">When you attach a database onto another server instance, to provide a consistent experience to users and applications, you might have to re-create some or all of the metadata for the database, such as logins, jobs, and permissions, on the other server instance.</span></span> <span data-ttu-id="69100-163">Pour plus d’informations, consultez [Gérer les métadonnées durant la mise à disposition d’une base de données sur une autre instance de serveur &#40;SQL Server&#41;](manage-metadata-when-making-a-database-available-on-another-server.md).</span><span class="sxs-lookup"><span data-stu-id="69100-163">For more information, see [Manage Metadata When Making a Database Available on Another Server Instance &#40;SQL Server&#41;](manage-metadata-when-making-a-database-available-on-another-server.md).</span></span>  
  
### <a name="service-master-key-and-database-master-key-encryption-changes-from-3des-to-aes"></a><span data-ttu-id="69100-164">Modifications du chiffrement de la clé principale du service et de la clé principale de la base de données de 3DES à AES</span><span class="sxs-lookup"><span data-stu-id="69100-164">Service Master Key and Database Master Key Encryption changes from 3DES to AES</span></span>  
 [!INCLUDE[ssSQL11](../../includes/sssql11-md.md)] <span data-ttu-id="69100-165">et versions ultérieures utilise l’algorithme de chiffrement AES pour protéger la clé principale du service (SMK) et la clé principale de base de données (DMK).</span><span class="sxs-lookup"><span data-stu-id="69100-165">and higher versions uses the AES encryption algorithm to protect the service master key (SMK) and the database master key (DMK).</span></span> <span data-ttu-id="69100-166">AES est un algorithme de chiffrement plus récent que 3DES, qui était utilisé dans les versions antérieures.</span><span class="sxs-lookup"><span data-stu-id="69100-166">AES is a newer encryption algorithm than 3DES used in earlier versions.</span></span> <span data-ttu-id="69100-167">Lorsqu'une base de données est attachée ou restaurée pour la première fois à une nouvelle instance de [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)], une copie de la clé principale de la base de données (chiffrée par la clé principale du service) n'est pas encore stockée sur le serveur.</span><span class="sxs-lookup"><span data-stu-id="69100-167">When a database is first attached or restored to a new instance of [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)], a copy of the database master key (encrypted by the service master key) is not yet stored in the server.</span></span> <span data-ttu-id="69100-168">Vous devez utiliser l'instruction `OPEN MASTER KEY` pour déchiffrer la clé principale de la base de données (DMK).</span><span class="sxs-lookup"><span data-stu-id="69100-168">You must use the `OPEN MASTER KEY` statement to decrypt the database master key (DMK).</span></span> <span data-ttu-id="69100-169">Une fois la clé DMK déchiffrée, vous avez la possibilité d'activer le déchiffrement automatique dans le futur en exécutant l'instruction `ALTER MASTER KEY REGENERATE` pour fournir au serveur une copie de la clé DMK chiffrée avec la clé principale du service (SMK).</span><span class="sxs-lookup"><span data-stu-id="69100-169">Once the DMK has been decrypted, you have the option of enabling automatic decryption in the future by using the `ALTER MASTER KEY REGENERATE` statement to provision the server with a copy of the DMK, encrypted with the service master key (SMK).</span></span> <span data-ttu-id="69100-170">Lorsqu'une base de données a été mise à niveau à partir d'une version antérieure, la clé DMK doit être régénérée de façon à utiliser le nouvel algorithme AES.</span><span class="sxs-lookup"><span data-stu-id="69100-170">When a database has been upgraded from an earlier version, the DMK should be regenerated to use the newer AES algorithm.</span></span> <span data-ttu-id="69100-171">Pour plus d’informations sur la régénération de la clé DMK, consultez [ALTER MASTER KEY &#40;Transact-SQL&#41;](/sql/t-sql/statements/alter-master-key-transact-sql).</span><span class="sxs-lookup"><span data-stu-id="69100-171">For more information about regenerating the DMK, see [ALTER MASTER KEY &#40;Transact-SQL&#41;](/sql/t-sql/statements/alter-master-key-transact-sql).</span></span> <span data-ttu-id="69100-172">La durée nécessaire pour régénérer la clé DMK à mettre à niveau vers AES dépend du nombre d'objets protégés par la clé DMK.</span><span class="sxs-lookup"><span data-stu-id="69100-172">The time required to regenerate the DMK key to upgrade to AES depends upon the number of objects protected by the DMK.</span></span> <span data-ttu-id="69100-173">La régénération de la clé DMK à mettre à niveau vers AES est nécessaire une seule fois et n'a aucune incidence sur les régénérations ultérieures effectuées dans le cadre d'une stratégie de rotation de clés.</span><span class="sxs-lookup"><span data-stu-id="69100-173">Regenerating the DMK key to upgrade to AES is only necessary once, and has no impact on future regenerations as part of a key rotation strategy.</span></span>  
  
  
