---
title: États des fichiers | Microsoft Docs
ms.custom: ''
ms.date: 03/06/2017
ms.prod: sql-server-2014
ms.reviewer: ''
ms.technology: ''
ms.topic: conceptual
helpviewer_keywords:
- restoring file state [SQL Server]
- verifying file states
- current file states
- verifying filegroup states
- file states [SQL Server]
- online file state
- offline file state [SQL Server]
- viewing filegroup states
- viewing file states
- suspect file state
- recovering file state [SQL Server]
- current filegroup state
- recovery pending file state [SQL Server]
- displaying file states
- states [SQL Server], files
- displaying filegroup states
- defunct file state
ms.assetid: b426474d-8954-4df0-b78b-887becfbe8d6
author: stevestein
ms.author: sstein
ms.openlocfilehash: b7cad94527d9191609a6920b5dfa200a98cd8bbd
ms.sourcegitcommit: ad4d92dce894592a259721a1571b1d8736abacdb
ms.translationtype: MT
ms.contentlocale: fr-FR
ms.lasthandoff: 08/04/2020
ms.locfileid: "87612940"
---
# <a name="file-states"></a><span data-ttu-id="6b0f1-102">États des fichiers</span><span class="sxs-lookup"><span data-stu-id="6b0f1-102">File States</span></span>
  <span data-ttu-id="6b0f1-103">Dans [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)], l'état d'un fichier de base de données est géré indépendamment de l'état de la base de données.</span><span class="sxs-lookup"><span data-stu-id="6b0f1-103">In [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)], the state of a database file is maintained independently from the state of the database.</span></span> <span data-ttu-id="6b0f1-104">Un fichier a toujours un seul état spécifique, tel que ONLINE ou OFFLINE.</span><span class="sxs-lookup"><span data-stu-id="6b0f1-104">A file is always in one specific state, such as ONLINE or OFFLINE.</span></span> <span data-ttu-id="6b0f1-105">Pour afficher l’état actuel d’un fichier, utilisez l’affichage catalogue [sys.master_files](/sql/relational-databases/system-catalog-views/sys-master-files-transact-sql) ou [sys.database_files](/sql/relational-databases/system-catalog-views/sys-database-files-transact-sql) .</span><span class="sxs-lookup"><span data-stu-id="6b0f1-105">To view the current state of a file, use the [sys.master_files](/sql/relational-databases/system-catalog-views/sys-master-files-transact-sql) or [sys.database_files](/sql/relational-databases/system-catalog-views/sys-database-files-transact-sql) catalog view.</span></span> <span data-ttu-id="6b0f1-106">Si la base de données est hors connexion, l’état des fichiers peut être visualisé à partir de l’affichage catalogue [sys.master_files](/sql/relational-databases/system-catalog-views/sys-master-files-transact-sql) .</span><span class="sxs-lookup"><span data-stu-id="6b0f1-106">If the database is offline, the state of the files can be viewed from the [sys.master_files](/sql/relational-databases/system-catalog-views/sys-master-files-transact-sql) catalog view.</span></span>  
  
 <span data-ttu-id="6b0f1-107">L'état des fichiers dans un groupe de fichiers détermine la disponibilité du groupe de fichiers tout entier.</span><span class="sxs-lookup"><span data-stu-id="6b0f1-107">The state of the files in a filegroup determines the availability of the whole filegroup.</span></span> <span data-ttu-id="6b0f1-108">Pour qu'un groupe de fichiers soit disponible, tous ses fichiers doivent être en ligne.</span><span class="sxs-lookup"><span data-stu-id="6b0f1-108">For a filegroup to be available, all files within the filegroup must be online.</span></span> <span data-ttu-id="6b0f1-109">Pour afficher l’état actuel d’un groupe de fichiers, utilisez l’affichage catalogue [sys.filegroups](/sql/relational-databases/system-catalog-views/sys-filegroups-transact-sql) .</span><span class="sxs-lookup"><span data-stu-id="6b0f1-109">To view the current state of a filegroup, use the [sys.filegroups](/sql/relational-databases/system-catalog-views/sys-filegroups-transact-sql) catalog view.</span></span> <span data-ttu-id="6b0f1-110">Si un groupe de fichiers est hors connexion et que vous tentez d'y accéder par l'intermédiaire d'une instruction [!INCLUDE[tsql](../../includes/tsql-md.md)] , l'opération échoue et une erreur est générée.</span><span class="sxs-lookup"><span data-stu-id="6b0f1-110">If a filegroup is offline and you try to access the filegroup by a [!INCLUDE[tsql](../../includes/tsql-md.md)] statement, it will fail with an error.</span></span> <span data-ttu-id="6b0f1-111">Lorsque l'optimiseur de requête planifie des instructions SELECT, il évite les index non-cluster et les vues indexées résidant dans les groupes de fichiers hors connexion, de sorte que ces instructions puissent être exécutées correctement.</span><span class="sxs-lookup"><span data-stu-id="6b0f1-111">When the query optimizer builds query plans for SELECT statements, it avoids nonclustered indexes and indexed views that reside in offline filegroups, letting these statements to succeed.</span></span> <span data-ttu-id="6b0f1-112">Cependant, si le groupe de fichiers hors connexion contient le segment ou l'index cluster d'une table cible, les instructions SELECT échouent.</span><span class="sxs-lookup"><span data-stu-id="6b0f1-112">However, if the offline filegroup contains the heap or clustered index of the target table, the SELECT statements fail.</span></span> <span data-ttu-id="6b0f1-113">De plus, toute instruction INSERT, UPDATE ou DELETE modifiant une table assortie d'un index dans un groupe de fichiers hors connexion ne peut être exécutée.</span><span class="sxs-lookup"><span data-stu-id="6b0f1-113">Additionally, any INSERT, UPDATE, or DELETE statement that modifies a table with any index in an offline filegroup will fail.</span></span>  
  
## <a name="file-state-definitions"></a><span data-ttu-id="6b0f1-114">Définitions de l'état d'un fichier</span><span class="sxs-lookup"><span data-stu-id="6b0f1-114">File State Definitions</span></span>  
 <span data-ttu-id="6b0f1-115">Le tableau suivant décrit les états d'un fichier.</span><span class="sxs-lookup"><span data-stu-id="6b0f1-115">The following table defines the file states.</span></span>  
  
|<span data-ttu-id="6b0f1-116">State</span><span class="sxs-lookup"><span data-stu-id="6b0f1-116">State</span></span>|<span data-ttu-id="6b0f1-117">Définition</span><span class="sxs-lookup"><span data-stu-id="6b0f1-117">Definition</span></span>|  
|-----------|----------------|  
|<span data-ttu-id="6b0f1-118">ONLINE</span><span class="sxs-lookup"><span data-stu-id="6b0f1-118">ONLINE</span></span>|<span data-ttu-id="6b0f1-119">Le fichier est accessible pour toutes les opérations.</span><span class="sxs-lookup"><span data-stu-id="6b0f1-119">The file is available for all operations.</span></span> <span data-ttu-id="6b0f1-120">Les fichiers du groupe de fichiers primaire sont toujours en ligne lorsque la base de données elle-même l'est.</span><span class="sxs-lookup"><span data-stu-id="6b0f1-120">Files in the primary filegroup are always online if the database itself is online.</span></span> <span data-ttu-id="6b0f1-121">Si un fichier du groupe de fichiers primaire n'est pas en ligne, la base de données n'est pas en ligne et les états des fichiers secondaires ne sont pas définis.</span><span class="sxs-lookup"><span data-stu-id="6b0f1-121">If a file in the primary filegroup is not online, the database is not online and the states of the secondary files are undefined.</span></span>|  
|<span data-ttu-id="6b0f1-122">OFFLINE</span><span class="sxs-lookup"><span data-stu-id="6b0f1-122">OFFLINE</span></span>|<span data-ttu-id="6b0f1-123">Le fichier n'est pas accessible et il se peut qu'il ne soit pas présent sur le disque.</span><span class="sxs-lookup"><span data-stu-id="6b0f1-123">The file is not available for access and may not be present on the disk.</span></span> <span data-ttu-id="6b0f1-124">Les fichiers prennent l'état hors connexion du fait d'une action explicite de l'utilisateur et restent hors connexion tant qu'une autre action n'est pas exécutée.</span><span class="sxs-lookup"><span data-stu-id="6b0f1-124">Files become offline by explicit user action and remain offline until additional user action is taken.</span></span><br /><br /> <span data-ttu-id="6b0f1-125">Attention un fichier ne doit être défini en mode hors connexion que lorsque le fichier est endommagé, mais il peut être restauré. \*\* \* \* \* \* \*\*</span><span class="sxs-lookup"><span data-stu-id="6b0f1-125">**\*\* Caution \*\*** A file should only be set offline when the file is corrupted, but it can be restored.</span></span> <span data-ttu-id="6b0f1-126">Un fichier mis hors connexion ne peut être remis en ligne qu'en étant restauré à partir d'une sauvegarde.</span><span class="sxs-lookup"><span data-stu-id="6b0f1-126">A file set to offline can only be set online by restoring the file from backup.</span></span> <span data-ttu-id="6b0f1-127">Pour plus d’informations sur la restauration d’un fichier unique, consultez [RESTORE &#40;Transact-SQL&#41;](/sql/t-sql/statements/restore-statements-transact-sql).</span><span class="sxs-lookup"><span data-stu-id="6b0f1-127">For more information about restoring a single file, see [RESTORE &#40;Transact-SQL&#41;](/sql/t-sql/statements/restore-statements-transact-sql).</span></span>|  
|<span data-ttu-id="6b0f1-128">RESTORING</span><span class="sxs-lookup"><span data-stu-id="6b0f1-128">RESTORING</span></span>|<span data-ttu-id="6b0f1-129">Le fichier est en cours de restauration.</span><span class="sxs-lookup"><span data-stu-id="6b0f1-129">The file is being restored.</span></span> <span data-ttu-id="6b0f1-130">Les fichiers passent à l'état « restauration » en raison d'une commande de restauration affectant l'ensemble du fichier, et non pas juste une page, et conservent cet état tant que la restauration n'est pas accomplie et le fichier récupéré.</span><span class="sxs-lookup"><span data-stu-id="6b0f1-130">Files enter the restoring state because of a restore command affecting the whole file, not just a page restore, and remain in this state until the restore is completed and the file is recovered.</span></span>|  
|<span data-ttu-id="6b0f1-131">RECOVERY PENDING</span><span class="sxs-lookup"><span data-stu-id="6b0f1-131">RECOVERY PENDING</span></span>|<span data-ttu-id="6b0f1-132">La récupération du fichier a été différée.</span><span class="sxs-lookup"><span data-stu-id="6b0f1-132">The recovery of the file has been postponed.</span></span> <span data-ttu-id="6b0f1-133">Un fichier prend cet état automatiquement à la suite d'un processus de restauration fragmentaire au cours duquel le fichier n'est ni restauré ni récupéré.</span><span class="sxs-lookup"><span data-stu-id="6b0f1-133">A file enters this state automatically because of a piecemeal restore process in which the file is not restored and recovered.</span></span> <span data-ttu-id="6b0f1-134">Une action supplémentaire est requise de la part de l'utilisateur pour résoudre l'erreur et permettre au processus de récupération de s'achever.</span><span class="sxs-lookup"><span data-stu-id="6b0f1-134">Additional action by the user is required to resolve the error and allow for the recovery process to be completed.</span></span> <span data-ttu-id="6b0f1-135">Pour plus d’informations, consultez [Restaurations fragmentaires &#40;SQL Server&#41;](../backup-restore/piecemeal-restores-sql-server.md).</span><span class="sxs-lookup"><span data-stu-id="6b0f1-135">For more information, see [Piecemeal Restores &#40;SQL Server&#41;](../backup-restore/piecemeal-restores-sql-server.md).</span></span>|  
|<span data-ttu-id="6b0f1-136">SUSPECT</span><span class="sxs-lookup"><span data-stu-id="6b0f1-136">SUSPECT</span></span>|<span data-ttu-id="6b0f1-137">La récupération du fichier a échoué au cours d'un processus de restauration en ligne.</span><span class="sxs-lookup"><span data-stu-id="6b0f1-137">Recovery of the file failed during an online restore process.</span></span> <span data-ttu-id="6b0f1-138">Si le fichier fait partie du groupe de fichiers primaire, la base de données est également marquée comme étant suspecte.</span><span class="sxs-lookup"><span data-stu-id="6b0f1-138">If the file is in the primary filegroup, the database is also marked as suspect.</span></span> <span data-ttu-id="6b0f1-139">Sans cela, seul le fichier est suspect et la base de données reste en ligne.</span><span class="sxs-lookup"><span data-stu-id="6b0f1-139">Otherwise, only the file is suspect and the database is still online.</span></span><br /><br /> <span data-ttu-id="6b0f1-140">Le fichier garde l'état suspect tant qu'il n'est pas rendu de nouveau disponible à l'aide de l'une des méthodes suivantes :</span><span class="sxs-lookup"><span data-stu-id="6b0f1-140">The file will remain in the suspect state until it is made available by one of the following methods:</span></span><br /><br /> <span data-ttu-id="6b0f1-141">Restauration et récupération</span><span class="sxs-lookup"><span data-stu-id="6b0f1-141">Restore and recovery</span></span><br /><br /> <span data-ttu-id="6b0f1-142">DBCC CHECKDB avec REPAIR_ALLOW_DATA_LOSS</span><span class="sxs-lookup"><span data-stu-id="6b0f1-142">DBCC CHECKDB with REPAIR_ALLOW_DATA_LOSS</span></span>|  
|<span data-ttu-id="6b0f1-143">DEFUNCT</span><span class="sxs-lookup"><span data-stu-id="6b0f1-143">DEFUNCT</span></span>|<span data-ttu-id="6b0f1-144">Le fichier a été supprimé alors qu'il n'était pas en ligne.</span><span class="sxs-lookup"><span data-stu-id="6b0f1-144">The file was dropped when it was not online.</span></span> <span data-ttu-id="6b0f1-145">Tous les fichiers d'un groupe de fichiers prennent l'état « ancien » quand un groupe de fichiers hors connexion est supprimé.</span><span class="sxs-lookup"><span data-stu-id="6b0f1-145">All files in a filegroup become defunct when an offline filegroup is removed.</span></span>|  
  
## <a name="related-content"></a><span data-ttu-id="6b0f1-146">Contenu associé</span><span class="sxs-lookup"><span data-stu-id="6b0f1-146">Related Content</span></span>  
 [<span data-ttu-id="6b0f1-147">ALTER DATABASE &#40;Transact-SQL&#41;</span><span class="sxs-lookup"><span data-stu-id="6b0f1-147">ALTER DATABASE &#40;Transact-SQL&#41;</span></span>](/sql/t-sql/statements/alter-database-transact-sql)  
  
 [<span data-ttu-id="6b0f1-148">États d’une base de données</span><span class="sxs-lookup"><span data-stu-id="6b0f1-148">Database States</span></span>](database-states.md)  
  
 [<span data-ttu-id="6b0f1-149">États de la mise en miroir &#40;SQL Server&#41;</span><span class="sxs-lookup"><span data-stu-id="6b0f1-149">Mirroring States &#40;SQL Server&#41;</span></span>](../../database-engine/database-mirroring/mirroring-states-sql-server.md)  
  
 [<span data-ttu-id="6b0f1-150">DBCC CHECKDB &#40;Transact-SQL&#41;</span><span class="sxs-lookup"><span data-stu-id="6b0f1-150">DBCC CHECKDB &#40;Transact-SQL&#41;</span></span>](/sql/t-sql/database-console-commands/dbcc-checkdb-transact-sql)  
  
 [<span data-ttu-id="6b0f1-151">Groupes de fichiers et fichiers de base de données</span><span class="sxs-lookup"><span data-stu-id="6b0f1-151">Database Files and Filegroups</span></span>](database-files-and-filegroups.md)  
  
  
