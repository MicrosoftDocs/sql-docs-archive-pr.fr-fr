---
title: SQL Server de fichiers de données dans Azure | Microsoft Docs
ms.custom: ''
ms.date: 06/13/2017
ms.prod: sql-server-2014
ms.reviewer: ''
ms.technology: supportability
ms.topic: conceptual
ms.assetid: 38ffd9c2-18a5-43d2-b674-e425addec4e4
author: MikeRayMSFT
ms.author: mikeray
ms.openlocfilehash: 21f960a50ed48ff2b146d96b73a1609d73b35c32
ms.sourcegitcommit: ad4d92dce894592a259721a1571b1d8736abacdb
ms.translationtype: MT
ms.contentlocale: fr-FR
ms.lasthandoff: 08/04/2020
ms.locfileid: "87695683"
---
# <a name="sql-server-data-files-in-azure"></a><span data-ttu-id="05e4a-102">Fichiers de données SQL Server dans Azure</span><span class="sxs-lookup"><span data-stu-id="05e4a-102">SQL Server Data Files in Azure</span></span>
  <span data-ttu-id="05e4a-103">SQL Server fichiers de données dans Azure permet la prise en charge native des fichiers de base de données SQL Server stockés en tant qu’objets BLOB Azure.</span><span class="sxs-lookup"><span data-stu-id="05e4a-103">SQL Server Data Files in Azure enables native support for SQL Server database files stored as Azure Blobs.</span></span> <span data-ttu-id="05e4a-104">Elle vous permet de créer une base de données dans SQL Server s’exécutant localement ou dans une machine virtuelle dans Azure avec un emplacement de stockage dédié pour vos données dans le stockage d’objets BLOB Azure.</span><span class="sxs-lookup"><span data-stu-id="05e4a-104">It allows you to create a database in SQL Server running in on-premises or in a virtual machine in Azure with a dedicated storage location for your data in Azure Blob Storage.</span></span> <span data-ttu-id="05e4a-105">Cette amélioration simplifie en particulier le déplacement des bases de données entre les ordinateurs, grâce aux opérations par attachement et détachement.</span><span class="sxs-lookup"><span data-stu-id="05e4a-105">This enhancement especially simplifies to move databases between machines by using detach and attach operations.</span></span> <span data-ttu-id="05e4a-106">En outre, il fournit un autre emplacement de stockage pour vos fichiers de sauvegarde de base de données en vous permettant de restaurer à partir de ou vers le stockage Azure.</span><span class="sxs-lookup"><span data-stu-id="05e4a-106">In addition, it provides an alternative storage location for your database backup files by allowing you to restore from or to Azure Storage.</span></span> <span data-ttu-id="05e4a-107">Par conséquent, elle permet plusieurs solutions hybrides en offrant différents avantages en matière de virtualisation des données, de déplacement des données, de sécurité et de disponibilité, le tout à des coûts et une maintenance réduits pour une mise à l'échelle élastique et une haute disponibilité.</span><span class="sxs-lookup"><span data-stu-id="05e4a-107">Therefore, it enables several hybrid solutions by providing several benefits for data virtualization, data movement, security and availability, and any easy low costs and maintenance for high-availability and elastic scaling.</span></span>  
  
 <span data-ttu-id="05e4a-108">Cette rubrique présente les concepts et les considérations essentiels au stockage des fichiers de données SQL Server dans le service de stockage Azure.</span><span class="sxs-lookup"><span data-stu-id="05e4a-108">This topic introduces concepts and considerations that are central to storing SQL Server data files in Azure Storage Service.</span></span>  
  
 <span data-ttu-id="05e4a-109">Pour une expérience pratique de l’utilisation de cette nouvelle fonctionnalité, consultez [Didacticiel : SQL Server de fichiers de données dans le service de stockage Azure](../tutorial-use-azure-blob-storage-service-with-sql-server-2016.md).</span><span class="sxs-lookup"><span data-stu-id="05e4a-109">For a practical hands-on experience on how to use this new feature, see [Tutorial: SQL Server Data Files in Azure Storage service](../tutorial-use-azure-blob-storage-service-with-sql-server-2016.md).</span></span>  
  
 <span data-ttu-id="05e4a-110">Le diagramme suivant montre que cette amélioration vous permet de stocker des fichiers de base de données SQL Server en tant qu’objets BLOB Azure dans le stockage Azure, quel que soit l’emplacement de votre serveur.</span><span class="sxs-lookup"><span data-stu-id="05e4a-110">The following diagram demonstrates that this enhancement enables you to store SQL Server database files as Azure blobs in Azure Storage regardless of where your server resides.</span></span>  
  
 <span data-ttu-id="05e4a-111">![Intégration de SQL Server à Azure Storage](../../database-engine/media/sql-server-dbfiles-stored-as-blobs.gif "Intégration de SQL Server à Azure Storage")</span><span class="sxs-lookup"><span data-stu-id="05e4a-111">![SQL Server Integration with Azure Storage](../../database-engine/media/sql-server-dbfiles-stored-as-blobs.gif "SQL Server Integration with Azure Storage")</span></span>  
  
## <a name="benefits-of-using-sql-server-data-files-in-azure"></a><span data-ttu-id="05e4a-112">Avantages de l’utilisation des fichiers de données SQL Server dans Azure</span><span class="sxs-lookup"><span data-stu-id="05e4a-112">Benefits of using SQL Server Data Files in Azure</span></span>  
  
-   <span data-ttu-id="05e4a-113">**Migration facile et rapide :** cette fonctionnalité simplifie le processus de migration en déplaçant une base de données à la fois entre les ordinateurs locaux et entre les environnements locaux et le cloud, sans aucune modification de l’application.</span><span class="sxs-lookup"><span data-stu-id="05e4a-113">**Easy and fast migration benefits:** This feature simplifies the migration process by moving one database at a time between machines in on-premises as well as between on-premises and cloud environments without any application changes.</span></span> <span data-ttu-id="05e4a-114">Par conséquent, elle prend en charge une migration incrémentielle tout en conservant l'infrastructure locale existante.</span><span class="sxs-lookup"><span data-stu-id="05e4a-114">Therefore, it supports an incremental migration while maintaining your existing on-premises infrastructure in place.</span></span> <span data-ttu-id="05e4a-115">En outre, avoir accès à un stockage de données centralisé simplifie la logique d'application lorsqu'une application doit s'exécuter à plusieurs emplacements dans un environnement local.</span><span class="sxs-lookup"><span data-stu-id="05e4a-115">In addition, having access to a centralized data storage simplifies the application logic when an application needs to run in multiple locations in an on-premises environment.</span></span> <span data-ttu-id="05e4a-116">Dans certains cas, vous devez configurer rapidement des centres de calcul situés dans des emplacements géographiquement dispersés, qui rassemblent des données de nombreuses sources différentes.</span><span class="sxs-lookup"><span data-stu-id="05e4a-116">In some cases, you may need to rapidly setup computer centers in geographically dispersed locations, which gather data from many different sources.</span></span> <span data-ttu-id="05e4a-117">En utilisant cette nouvelle amélioration, au lieu de déplacer les données d’un emplacement à un autre, vous pouvez stocker de nombreuses bases de données en tant qu’objets BLOB Azure, puis exécuter des scripts Transact-SQL pour créer des bases de données sur les ordinateurs locaux ou les machines virtuelles.</span><span class="sxs-lookup"><span data-stu-id="05e4a-117">By using this new enhancement, instead of moving data from one location to another, you can store many databases as Azure blobs, and then run Transact-SQL scripts to create databases on the local machines or virtual machines.</span></span>  
  
-   <span data-ttu-id="05e4a-118">**Coûts et avantages de stockage illimités :** Cette fonctionnalité vous permet de disposer d’un stockage hors site illimité dans Azure tout en tirant parti des ressources de calcul locales.</span><span class="sxs-lookup"><span data-stu-id="05e4a-118">**Cost and limitless storage benefits:** This feature enables you to have limitless off-site storage in Azure while leveraging on-premises compute resources.</span></span> <span data-ttu-id="05e4a-119">Lorsque vous utilisez Azure comme emplacement de stockage, vous pouvez facilement vous concentrer sur la logique d’application sans la surcharge de la gestion du matériel.</span><span class="sxs-lookup"><span data-stu-id="05e4a-119">When you use Azure as a storage location, you can easily focus on the application logic without the overhead of hardware management.</span></span> <span data-ttu-id="05e4a-120">Si vous perdez un nœud de calcul local, vous pouvez en configurer un autre sans aucun déplacement des données.</span><span class="sxs-lookup"><span data-stu-id="05e4a-120">If you lose a computation node on-premises, you can set up a new one without any data movement.</span></span>  
  
-   <span data-ttu-id="05e4a-121">**Avantages de la haute disponibilité et de la récupération d’urgence :** L’utilisation de SQL Server fichiers de données dans Azure peut simplifier les solutions de haute disponibilité et de récupération d’urgence.</span><span class="sxs-lookup"><span data-stu-id="05e4a-121">**High availability and disaster recovery benefits:** Using SQL Server Data Files in Azure feature might simplify the high availability and disaster recovery solutions.</span></span> <span data-ttu-id="05e4a-122">Par exemple, si une machine virtuelle dans Azure ou une instance de SQL Server se bloque, vous pouvez recréer vos bases de données dans un nouvel ordinateur en rétablissant simplement les liens vers les objets BLOB Azure.</span><span class="sxs-lookup"><span data-stu-id="05e4a-122">For example, if a virtual machine in Azure or an instance of SQL Server crashes, you can re-create your databases in a new machine by just re-establishing links to Azure Blobs.</span></span>  
  
-   <span data-ttu-id="05e4a-123">**Sécurité :** cette nouvelle amélioration vous permet de séparer une instance de calcul d’une instance de stockage.</span><span class="sxs-lookup"><span data-stu-id="05e4a-123">**Security benefits:** This new enhancement allows you to separate a compute instance from a storage instance.</span></span> <span data-ttu-id="05e4a-124">Vous pouvez avoir une base de données entièrement chiffrée où le déchiffrement ne concerne que l'instance de calcul, mais pas l'instance de stockage.</span><span class="sxs-lookup"><span data-stu-id="05e4a-124">You can have a fully encrypted database with decryption only occurring on compute instance but not in a storage instance.</span></span> <span data-ttu-id="05e4a-125">En d'autres termes, cette nouvelle amélioration vous permet de chiffrer toutes les données dans un cloud public à l'aide de certificats TDE (Transparent Data Encryption), lesquels sont physiquement séparés des données.</span><span class="sxs-lookup"><span data-stu-id="05e4a-125">In other words, using this new enhancement, you can encrypt all data in public cloud using Transparent Data Encryption (TDE)  certificates, which are physically separated from the data.</span></span> <span data-ttu-id="05e4a-126">Les clés TDE peuvent être stockées dans la base de données master, qui est stockée localement sur votre ordinateur physiquement sécurisé et sauvegardée localement.</span><span class="sxs-lookup"><span data-stu-id="05e4a-126">The TDE keys can be stored in the master database, which is stored locally in your physically secure on-premises machine and backed up locally.</span></span> <span data-ttu-id="05e4a-127">Vous pouvez utiliser ces clés locales pour chiffrer les données, qui résident dans le stockage Azure.</span><span class="sxs-lookup"><span data-stu-id="05e4a-127">You can use these local keys to encrypt the data, which resides in Azure Storage.</span></span> <span data-ttu-id="05e4a-128">Si les informations d'identification du compte de stockage en nuage (cloud) sont dérobées, vos données restent sécurisées dans la mesure où les certificats TDE résident toujours localement.</span><span class="sxs-lookup"><span data-stu-id="05e4a-128">If your cloud storage account credentials are stolen, your data still stays secure as the TDE certificates always reside in on-premises.</span></span>  
  
## <a name="concepts-and-requirements"></a><span data-ttu-id="05e4a-129">Concepts et configuration requise</span><span class="sxs-lookup"><span data-stu-id="05e4a-129">Concepts and Requirements</span></span>  
  
### <a name="azure-storage-concepts"></a><span data-ttu-id="05e4a-130">Concepts liés au stockage Azure</span><span class="sxs-lookup"><span data-stu-id="05e4a-130">Azure Storage Concepts</span></span>  
 <span data-ttu-id="05e4a-131">Lorsque vous utilisez la fonctionnalité Fichiers de données SQL Server dans Azure, vous devez créer un compte de stockage et un conteneur dans Azure.</span><span class="sxs-lookup"><span data-stu-id="05e4a-131">When using SQL Server Data Files in Azure feature, you need to create a storage account and a container in Azure.</span></span> <span data-ttu-id="05e4a-132">Ensuite, vous devez créer des informations d'identification SQL Server, qui comportent des informations sur la stratégie du conteneur ainsi qu'une signature d'accès partagé qui est nécessaire pour accéder au conteneur.</span><span class="sxs-lookup"><span data-stu-id="05e4a-132">Then, you need to create a SQL Server credential, which includes information on the policy of the container as well as a shared access signature that is necessary to access the container.</span></span>  
  
 <span data-ttu-id="05e4a-133">Dans Azure, un compte de stockage représente le niveau le plus élevé de l’espace de noms pour l’accès aux objets BLOB.</span><span class="sxs-lookup"><span data-stu-id="05e4a-133">In Azure, a storage account represents the highest level of the namespace for accessing Blobs.</span></span> <span data-ttu-id="05e4a-134">Un compte de stockage peut contenir un nombre illimité de conteneurs, tant que leur taille totale ne dépasse pas 500 To.</span><span class="sxs-lookup"><span data-stu-id="05e4a-134">A storage account can contain an unlimited number of containers, as long as their total size is under 500 TB.</span></span> <span data-ttu-id="05e4a-135">Pour les informations les plus récentes sur les limites de stockage, consultez [Abonnement Azure et limites, quotas et contraintes du service](https://azure.microsoft.com/documentation/articles/azure-subscription-service-limits/).</span><span class="sxs-lookup"><span data-stu-id="05e4a-135">For the latest information on storage limits, see [Azure Subscription and Service Limits, Quotas, and Constraints](https://azure.microsoft.com/documentation/articles/azure-subscription-service-limits/).</span></span> <span data-ttu-id="05e4a-136">Un conteneur regroupe un ensemble d'objets blob.</span><span class="sxs-lookup"><span data-stu-id="05e4a-136">A container provides a grouping of a set of Blobs.</span></span> <span data-ttu-id="05e4a-137">Tous les objets blob doivent figurer dans un conteneur.</span><span class="sxs-lookup"><span data-stu-id="05e4a-137">All Blobs must be in a container.</span></span> <span data-ttu-id="05e4a-138">Un compte peut contenir un nombre illimité de conteneurs.</span><span class="sxs-lookup"><span data-stu-id="05e4a-138">An account can contain an unlimited number of containers.</span></span> <span data-ttu-id="05e4a-139">De la même manière, un conteneur peut également stocker un nombre illimité d'objets blob.</span><span class="sxs-lookup"><span data-stu-id="05e4a-139">Similarly, a container can store an unlimited number of Blobs as well.</span></span> <span data-ttu-id="05e4a-140">Il existe deux types d’objets blob qui peuvent être enregistrés dans un stockage Azure : les objets blob de blocs et les objets blob de pages.</span><span class="sxs-lookup"><span data-stu-id="05e4a-140">There are two types of blobs that can be stored in Azure Storage: block and page blobs.</span></span> <span data-ttu-id="05e4a-141">Cette nouvelle fonctionnalité utilise des objets blob de pages, dont la taille peut atteindre jusqu'à 1 To, et qui sont plus efficaces lorsque les plages d'octets d'un fichier sont modifiées fréquemment.</span><span class="sxs-lookup"><span data-stu-id="05e4a-141">This new feature uses Page blobs, which can be up to 1TB in size, and are more efficient when ranges of bytes in a file are modified frequently.</span></span> <span data-ttu-id="05e4a-142">Vous pouvez accéder aux objets blob avec le format d'URL suivant : `http://storageaccount.blob.core.windows.net/<container>/<blob>`.</span><span class="sxs-lookup"><span data-stu-id="05e4a-142">You can access Blobs using the following URL format: `http://storageaccount.blob.core.windows.net/<container>/<blob>`.</span></span>  
  
### <a name="azure-billing-considerations"></a><span data-ttu-id="05e4a-143">Considérations sur la facturation Azure</span><span class="sxs-lookup"><span data-stu-id="05e4a-143">Azure Billing Considerations</span></span>  
 <span data-ttu-id="05e4a-144">L’estimation du coût d’utilisation des services Azure est une question importante dans le processus de prise de décision et de planification.</span><span class="sxs-lookup"><span data-stu-id="05e4a-144">Estimating the cost of using Azure Services is an important matter in the decision making and planning process.</span></span> <span data-ttu-id="05e4a-145">Lorsque vous stockez des fichiers de données SQL Server dans le stockage Azure, vous devez payer les coûts associés au stockage et aux transactions.</span><span class="sxs-lookup"><span data-stu-id="05e4a-145">When storing SQL Server data files in Azure Storage, you need to pay costs associated with storage and transactions.</span></span> <span data-ttu-id="05e4a-146">En outre, l’implémentation de la fonctionnalité Fichiers de données SQL Server dans le stockage Azure nécessite un renouvellement implicite du bail d’objets blob toutes les 45 à 60 secondes.</span><span class="sxs-lookup"><span data-stu-id="05e4a-146">In addition, the implementation of SQL Server Data Files in Azure Storage feature requires a renewal of Blob lease every 45 to 60 seconds implicitly.</span></span> <span data-ttu-id="05e4a-147">Cela entraîne également des coûts de transaction par fichier de base de données (.mdf ou .ldf, par exemple).</span><span class="sxs-lookup"><span data-stu-id="05e4a-147">This also results in transaction costs per database file, such as .mdf or .ldf.</span></span> <span data-ttu-id="05e4a-148">Selon nos évaluations, le coût de renouvellement des baux pour deux fichiers de base de données (.mdf et .ldf) se monte à environ 2 cents par mois d'après la grille de tarification actuelle.</span><span class="sxs-lookup"><span data-stu-id="05e4a-148">Based on our estimations, the cost of renewing leases for two database files (.mdf and .ldf) would be about 2 cents per month according to the current pricing model.</span></span> <span data-ttu-id="05e4a-149">Nous vous recommandons de consulter les informations de la page [Azure Pricing](https://azure.microsoft.com/pricing/) (Tarifs d’Azure) pour vous aider à estimer les coûts mensuels associés à l’utilisation du stockage Azure et des machines virtuelles Azure.</span><span class="sxs-lookup"><span data-stu-id="05e4a-149">We recommend that you use the information on the [Azure Pricing](https://azure.microsoft.com/pricing/) page to help estimate the monthly costs associated with the use of Azure Storage and Azure Virtual Machines.</span></span>  
  
### <a name="sql-server-concepts"></a><span data-ttu-id="05e4a-150">Concepts de serveur SQL</span><span class="sxs-lookup"><span data-stu-id="05e4a-150">SQL Server Concepts</span></span>  
 <span data-ttu-id="05e4a-151">Si vous utilisez cette nouvelle amélioration, assurez-vous de procéder comme suit :</span><span class="sxs-lookup"><span data-stu-id="05e4a-151">When using this new enhancement, you are required to do the followings:</span></span>  
  
-   <span data-ttu-id="05e4a-152">Créez une stratégie sur un conteneur et générez également une clé de signature d'accès partagé (SAS).</span><span class="sxs-lookup"><span data-stu-id="05e4a-152">You must create a policy on a container and also generate a shared access signature (SAS) key.</span></span>  
  
-   <span data-ttu-id="05e4a-153">Pour chaque conteneur utilisé par un fichier de données ou un fichier journal, créez des informations d'identification SQL Server dont le nom correspond au chemin d'accès du conteneur.</span><span class="sxs-lookup"><span data-stu-id="05e4a-153">For each container used by a data or a log file, you must create a SQL Server Credential whose name matches the container path.</span></span>  
  
-   <span data-ttu-id="05e4a-154">Stockez les informations relatives au conteneur de stockage Azure, le nom de stratégie associé et la clé SAS dans la banque d’informations d’identification de SQL Server.</span><span class="sxs-lookup"><span data-stu-id="05e4a-154">You must store the information regarding Azure Storage container, its associated policy name, and SAS key in the SQL Server credential store.</span></span>  
  
 <span data-ttu-id="05e4a-155">L’exemple suivant suppose qu’un conteneur de stockage Azure a été créé et qu’une stratégie a été créée avec des droits de lecture, d’écriture et de liste.</span><span class="sxs-lookup"><span data-stu-id="05e4a-155">The following example assumes that an Azure Storage container has been created, and a policy has been created with read, write, list, rights.</span></span> <span data-ttu-id="05e4a-156">La création d'une stratégie sur un conteneur génère une clé SAS qui peut rester non chiffrée en mémoire et qui est requise par SQL Server pour accéder aux fichiers d'objet blob dans le conteneur.</span><span class="sxs-lookup"><span data-stu-id="05e4a-156">Creating a policy on a container generates a SAS key which is safe to keep unencrypted in memory and needed by SQL Server to access the blob files in the container.</span></span> <span data-ttu-id="05e4a-157">Dans l'extrait de code suivant, remplacez `'your SAS key'` par une entrée similaire à la suivante : `'sr=c&si=<MYPOLICYNAME>&sig=<THESHAREDACCESSSIGNATURE>'`.</span><span class="sxs-lookup"><span data-stu-id="05e4a-157">In the following code snippet, replace `'your SAS key'` with an entry similar to the following: `'sr=c&si=<MYPOLICYNAME>&sig=<THESHAREDACCESSSIGNATURE>'`.</span></span> <span data-ttu-id="05e4a-158">Pour plus d’informations, consultez [créer et utiliser une signature d’accès partagé](https://msdn.microsoft.com/library/azure/jj721951.aspx)</span><span class="sxs-lookup"><span data-stu-id="05e4a-158">For more information, see [Create and Use a Shared Access Signature](https://msdn.microsoft.com/library/azure/jj721951.aspx)</span></span>  
  
```sql
-- Create a credential  
CREATE CREDENTIAL [https://testdb.blob.core.windows.net/data]  
WITH IDENTITY='SHARED ACCESS SIGNATURE',  
SECRET = 'your SAS key'  
  
-- Create database with data and log files in Azure container.  
CREATE DATABASE testdb   
ON  
( NAME = testdb_dat,  
    FILENAME = 'https://testdb.blob.core.windows.net/data/TestData.mdf' )  
 LOG ON  
( NAME = testdb_log,  
    FILENAME =  'https://testdb.blob.core.windows.net/data/TestLog.ldf')
```  
  
> [!IMPORTANT]
> <span data-ttu-id="05e4a-159">s’il existe des références actives aux fichiers de données dans un conteneur, toutes les tentatives de suppression des informations d’identification SQL Server correspondantes échouent.</span><span class="sxs-lookup"><span data-stu-id="05e4a-159">If there are any active references to data files in a container, attempts to delete the corresponding SQL Server credential fails.</span></span>  
  
### <a name="security"></a><span data-ttu-id="05e4a-160">Sécurité</span><span class="sxs-lookup"><span data-stu-id="05e4a-160">Security</span></span>  
 <span data-ttu-id="05e4a-161">Vous trouverez ci-dessous les considérations de sécurité et la configuration requise pour le stockage de fichiers de données SQL Server dans le stockage Azure.</span><span class="sxs-lookup"><span data-stu-id="05e4a-161">The following are security considerations and requirements when storing SQL Server Data Files in Azure Storage.</span></span>  
  
-   <span data-ttu-id="05e4a-162">Lorsque vous créez un conteneur pour le service de stockage d’objets blob Azure, nous vous recommandons de définir l’accès sur Privé.</span><span class="sxs-lookup"><span data-stu-id="05e4a-162">When creating a container for the Azure Blob storage service, we recommend that you set the access to private.</span></span> <span data-ttu-id="05e4a-163">Lorsque vous définissez l’accès privé, le conteneur et les données blob ne peuvent être lus que par le propriétaire du compte Azure.</span><span class="sxs-lookup"><span data-stu-id="05e4a-163">When you set the access to private, container and blob data can be read by the Azure account owner only.</span></span>  
  
-   <span data-ttu-id="05e4a-164">Lors de l’enregistrement des fichiers de base de données SQL Server dans le stockage Azure, vous devez utiliser une signature d’accès partagé, un URI qui octroie des droits d’accès restreints aux conteneurs, aux objets blob, aux files d’attente et aux tables.</span><span class="sxs-lookup"><span data-stu-id="05e4a-164">When storing SQL Server database files in Azure Storage, you need to use a shared access signature, a URI that grants restricted access rights to containers, blobs, queues, and tables.</span></span> <span data-ttu-id="05e4a-165">À l’aide d’une signature d’accès partagé, vous pouvez autoriser SQL Server à accéder aux ressources dans votre compte de stockage sans partager votre clé de compte de stockage Azure.</span><span class="sxs-lookup"><span data-stu-id="05e4a-165">By using a shared access signature, you can enable SQL Server to access resources in your storage account without sharing your Azure storage account key.</span></span>  
  
-   <span data-ttu-id="05e4a-166">De plus, nous vous recommandons de continuer de suivre les pratiques de sécurité locales habituelles pour vos bases de données.</span><span class="sxs-lookup"><span data-stu-id="05e4a-166">In addition, we recommend that you continue implementing the traditional on-premises security practices for your databases.</span></span>  
  
### <a name="installation-prerequisites"></a><span data-ttu-id="05e4a-167">Configuration requise pour l'installation</span><span class="sxs-lookup"><span data-stu-id="05e4a-167">Installation Prerequisites</span></span>  
 <span data-ttu-id="05e4a-168">Vous trouverez ci-dessous les conditions préalables à l’installation lors du stockage SQL Server fichiers de données dans Azure.</span><span class="sxs-lookup"><span data-stu-id="05e4a-168">The followings are installation prerequisites when storing SQL Server Data Files in Azuree.</span></span>  
  
-   <span data-ttu-id="05e4a-169">**SQL Server local :** SQL Server 2014 comprend cette fonctionnalité.</span><span class="sxs-lookup"><span data-stu-id="05e4a-169">**SQL Server on-premises:** SQL Server 2014 version includes this feature.</span></span> <span data-ttu-id="05e4a-170">Pour savoir comment télécharger SQL Server 2014, consultez [SQL Server 2014](https://www.microsoft.com/sqlserver/sql-server-2014.aspx).</span><span class="sxs-lookup"><span data-stu-id="05e4a-170">To learn how to download SQL Server 2014, see [SQL Server 2014](https://www.microsoft.com/sqlserver/sql-server-2014.aspx).</span></span>  
  
-   <span data-ttu-id="05e4a-171">SQL Server s'exécutant sur un ordinateur virtuel Azure : si vous installez SQL Server sur un ordinateur virtuel Azure, installez SQL Server 2014 ou mettez à jour votre instance existante.</span><span class="sxs-lookup"><span data-stu-id="05e4a-171">SQL Server running in an Azure virtual machine: If you are installing SQL Server on an Azure Virtual Machine, install SQL Server 2014, or update your existing instance.</span></span> <span data-ttu-id="05e4a-172">De même, vous pouvez également créer une machine virtuelle dans Azure à l’aide d’SQL Server image de plateforme 2014.</span><span class="sxs-lookup"><span data-stu-id="05e4a-172">Similarly, you can also create a new virtual machine in Azure using SQL Server 2014 platform image.</span></span> <span data-ttu-id="05e4a-173">Pour savoir comment télécharger SQL Server 2014, consultez [SQL Server 2014](https://www.microsoft.com/sqlserver/sql-server-2014.aspx).</span><span class="sxs-lookup"><span data-stu-id="05e4a-173">To learn how to download SQL Server 2014, see [SQL Server 2014](https://www.microsoft.com/sqlserver/sql-server-2014.aspx).</span></span>  
  
###  <a name="limitations"></a><a name="bkmk_Limitations"></a> <span data-ttu-id="05e4a-174">Limitations</span><span class="sxs-lookup"><span data-stu-id="05e4a-174">Limitations</span></span>  
  
-   <span data-ttu-id="05e4a-175">Dans la version actuelle de cette fonctionnalité, le stockage des `FileStream` données dans le stockage Azure n’est pas pris en charge.</span><span class="sxs-lookup"><span data-stu-id="05e4a-175">In the current release of this feature, storing `FileStream` data in Azure Storage is not supported.</span></span> <span data-ttu-id="05e4a-176">Vous pouvez stocker `Filestream` des données dans une base de données locale intégrée au stockage Azure, mais vous ne pouvez pas déplacer les données FILESTREAM entre les machines à l’aide du stockage Azure.</span><span class="sxs-lookup"><span data-stu-id="05e4a-176">You can store `Filestream` data in an Azure Storage integrated local database but you cannot move Filestream data between machines using Azure Storage.</span></span> <span data-ttu-id="05e4a-177">Pour les données `FileStream`, nous vous recommandons de continuer à utiliser les méthodes traditionnelles pour déplacer des fichiers (.mdf, .ldf) associés à Filestream entre différents ordinateurs.</span><span class="sxs-lookup"><span data-stu-id="05e4a-177">For `FileStream` data, we recommend that you continue using the traditional techniques to move the files (.mdf, .ldf) associated with Filestream between different machines.</span></span>  
  
-   <span data-ttu-id="05e4a-178">Actuellement, cette nouvelle amélioration ne prend pas en charge l’accès simultané de plusieurs instances SQL Server aux mêmes fichiers de base de données dans le Stockage Azure.</span><span class="sxs-lookup"><span data-stu-id="05e4a-178">Currently, this new enhancement does not support more than one SQL Server instance accessing the same database files in Azure Storage at the same time.</span></span> <span data-ttu-id="05e4a-179">Si un serveur A est en ligne avec un fichier de base de données actif et si un serveur B démarre par erreur, et qu’il comporte également une base de données qui pointe vers le même fichier de données, le deuxième serveur ne peut pas démarrer la base de données. Un code d’erreur **5120 Impossible d’ouvrir le fichier physique « %.\*ls » est généré. Erreur %d du système d’exploitation : « %ls »** .</span><span class="sxs-lookup"><span data-stu-id="05e4a-179">If ServerA is online with an active database file and if ServerB is accidentally started, and it also has a database which points to the same data file, the second server will fail to start the database with an error code **5120 Unable to open the physical file "%.\*ls". Operating system error %d: "%ls"**.</span></span>  
  
-   <span data-ttu-id="05e4a-180">Seuls les fichiers .mdf, .ldf et .ndf peuvent être enregistrés dans le Stockage Azure à l’aide de la fonctionnalité Fichiers de données SQL Server dans Azure.</span><span class="sxs-lookup"><span data-stu-id="05e4a-180">Only .mdf, .ldf, and .ndf files can be stored in Azure Storage by using the SQL Server Data Files in Azure feature.</span></span>  
  
-   <span data-ttu-id="05e4a-181">En cas d’utilisation de la fonctionnalité Fichiers de données SQL Server dans Azure, la géoréplication de votre compte de stockage n’est pas prise en charge.</span><span class="sxs-lookup"><span data-stu-id="05e4a-181">When using the SQL Server Data Files in Azure feature, geo-replication for your storage account is not supported.</span></span> <span data-ttu-id="05e4a-182">Si un compte de stockage est géorépliqué et qu'un géobasculement a lieu, la base de données risque d'être endommagée.</span><span class="sxs-lookup"><span data-stu-id="05e4a-182">If a storage account is geo-replicated and a geo-failover happened, database corruption could occur.</span></span>  
  
-   <span data-ttu-id="05e4a-183">La taille d'un objet blob peut atteindre 1 To au maximum.</span><span class="sxs-lookup"><span data-stu-id="05e4a-183">Each Blob can be up to maximum 1 TB in size.</span></span> <span data-ttu-id="05e4a-184">Cette limite supérieure s’applique à chaque fichier journal ou fichier de données de base de données pouvant être enregistré dans le stockage Azure.</span><span class="sxs-lookup"><span data-stu-id="05e4a-184">This creates an upper limit on individual database data and log files that can be stored in Azure Storage.</span></span>  
  
-   <span data-ttu-id="05e4a-185">Il est impossible d’enregistrer des données de l’OLTP en mémoire dans un objet blob Azure à l’aide de la fonctionnalité Fichiers de données SQL Server dans le stockage Azure.</span><span class="sxs-lookup"><span data-stu-id="05e4a-185">It is not possible to store In-Memory OLTP data in Azure Blob using the SQL Server Data Files in Azure Storage feature.</span></span> <span data-ttu-id="05e4a-186">En effet, l’OLTP en mémoire dépend de `FileStream` et, dans la version actuelle de cette fonctionnalité, le stockage des `FileStream` données dans le stockage Azure n’est pas pris en charge.</span><span class="sxs-lookup"><span data-stu-id="05e4a-186">This is because In-Memory OLTP has a dependency on `FileStream` and, in the current release of this feature, storing `FileStream` data in Azure Storage is not supported.</span></span>  
  
-   <span data-ttu-id="05e4a-187">Lors de l’utilisation de SQL Server fichiers de données dans la fonctionnalité Azure, SQL Server effectue toutes les comparaisons d’URL ou de chemin d’accès de fichier à l’aide du classement défini dans la `master` base de données.</span><span class="sxs-lookup"><span data-stu-id="05e4a-187">When using SQL Server Data Files in Azure feature, SQL Server performs all URL or file path comparisons using the Collation set in the `master` database.</span></span>  
  
-   <span data-ttu-id="05e4a-188">Les `AlwaysOn Availability Groups` sont pris en charge tant que vous n'ajoutez pas de nouveaux fichiers de base de données à la base de données primaire.</span><span class="sxs-lookup"><span data-stu-id="05e4a-188">`AlwaysOn Availability Groups` are supported as long as you do not add new database files to the primary database.</span></span> <span data-ttu-id="05e4a-189">Si une opération de base de données nécessite la création d'un nouveau fichier dans la base de données primaire, désactivez d'abord les groupes de disponibilité AlwaysOn dans le nœud secondaire.</span><span class="sxs-lookup"><span data-stu-id="05e4a-189">If a database operation requires a new file to be created in the primary database, first disable AlwaysOn Availability Groups in the secondary node.</span></span> <span data-ttu-id="05e4a-190">Puis, effectuez l'opération de base de données dans la base de données primaire et sauvegardez la base de données dans le nœud principal.</span><span class="sxs-lookup"><span data-stu-id="05e4a-190">Then, perform the database operation on the primary database and backup the database in the primary node.</span></span> <span data-ttu-id="05e4a-191">Ensuite, restaurez la base de données sur le nœud secondaire, puis activez les groupes de disponibilité AlwaysOn dans le nœud secondaire.</span><span class="sxs-lookup"><span data-stu-id="05e4a-191">Next, restore the database to the secondary node, and enable AlwaysOn Availability Groups in the secondary node.</span></span> <span data-ttu-id="05e4a-192">Notez que les instances de cluster de basculement AlwaysOn ne sont pas prises en charge lors de l’utilisation de la fonctionnalité fichiers de données SQL Server dans Azure.</span><span class="sxs-lookup"><span data-stu-id="05e4a-192">Note that AlwaysOn Failover Cluster Instances is not supported when using the SQL Server Data Files in Azure feature.</span></span>  
  
-   <span data-ttu-id="05e4a-193">En mode de fonctionnement normal, SQL Server utilise des baux temporaires pour réserver des objets blob pour le stockage, avec un renouvellement du bail de chaque objet blob toutes les 45 à 60 secondes.</span><span class="sxs-lookup"><span data-stu-id="05e4a-193">During normal operation, SQL Server uses temporary leases to reserve Blobs for storage with a renewal of each Blob lease every 45 to 60 seconds.</span></span> <span data-ttu-id="05e4a-194">En cas de défaillance d'un serveur et du démarrage d'une autre instance de SQL Server configurée pour utiliser les mêmes objets blob, la nouvelle instance attend jusqu'à 60 secondes, le temps que le bail existant sur l'objet blob expire.</span><span class="sxs-lookup"><span data-stu-id="05e4a-194">If a server crashes and another instance of SQL Server configured to use the same blobs is started, the new instance will wait up to 60 seconds for the existing lease on the Blob to expire.</span></span> <span data-ttu-id="05e4a-195">Si vous voulez attacher la base de données à une autre instance et que vous ne pouvez pas attendre l'expiration du bail pendant 60 secondes, vous pouvez résilier explicitement le bail sur l'objet blob afin d'éviter les erreurs dans les opérations d'attachement.</span><span class="sxs-lookup"><span data-stu-id="05e4a-195">If you want to attach the database to another instance and you cannot wait for the lease to expire within 60 seconds, you can explicitly break the lease on the Blob to avoid any failures in attach operations.</span></span>  
  
## <a name="tools-and-programming-reference-support"></a><span data-ttu-id="05e4a-196">Prise en charge des bibliothèques de référence de programmation et des outils</span><span class="sxs-lookup"><span data-stu-id="05e4a-196">Tools and programming reference support</span></span>  
 <span data-ttu-id="05e4a-197">Cette section décrit les bibliothèques de référence de programmation et les outils qui peuvent être utilisés lors du stockage de fichiers de données SQL Server dans le stockage Azure.</span><span class="sxs-lookup"><span data-stu-id="05e4a-197">This section describes which tools and programming reference libraries can be used when storing SQL Server data files in Azure Storage.</span></span>  
  
### <a name="powershell-support"></a><span data-ttu-id="05e4a-198">Prise en charge de PowerShell</span><span class="sxs-lookup"><span data-stu-id="05e4a-198">PowerShell support</span></span>  
 <span data-ttu-id="05e4a-199">Dans SQL Server 2014, vous pouvez utiliser des applets de commande PowerShell pour stocker des fichiers de données SQL Server dans le service de stockage d’objets BLOB Azure en référençant un chemin d’URL de stockage d’objets BLOB au lieu d’un chemin d’accès de fichier.</span><span class="sxs-lookup"><span data-stu-id="05e4a-199">In SQL Server 2014, you can use PowerShell cmdlets to store SQL Server data files in Azure Blob Storage service by referencing a Blob Storage URL path instead of a file path.</span></span> <span data-ttu-id="05e4a-200">Vous pouvez accéder aux objets blob avec le format d'URL suivant :`: http://storageaccount.blob.core.windows.net/<container>/<blob>` .</span><span class="sxs-lookup"><span data-stu-id="05e4a-200">You can access Blobs using the following URL format`: http://storageaccount.blob.core.windows.net/<container>/<blob>` .</span></span>  
  
### <a name="sql-server-object-and-performance-counters-support"></a><span data-ttu-id="05e4a-201">Prise en charge des compteurs de performances et des objets SQL Server</span><span class="sxs-lookup"><span data-stu-id="05e4a-201">SQL Server Object and performance counters support</span></span>  
 <span data-ttu-id="05e4a-202">Depuis SQL Server 2014, un nouvel objet SQL Server a été ajouté pour être utilisé avec la fonctionnalité Fichiers de données SQL Server dans le stockage Azure.</span><span class="sxs-lookup"><span data-stu-id="05e4a-202">Starting with SQL Server 2014, a new SQL Server object has been added to be used with SQL Server Data Files in Azure Storage feature.</span></span> <span data-ttu-id="05e4a-203">Le nouvel objet SQL Server est appelé [SQL Server, HTTP_STORAGE_OBJECT](../performance-monitor/sql-server-http-storage-object.md) et il peut être utilisé par le Moniteur système pour surveiller l’activité lors de l’exécution de SQL Server avec le Stockage Azure.</span><span class="sxs-lookup"><span data-stu-id="05e4a-203">The new SQL Server object is called as [SQL Server, HTTP_STORAGE_OBJECT](../performance-monitor/sql-server-http-storage-object.md) and it can be used by System Monitor to monitor activity when running SQL Server with Azure Storage.</span></span>  
  
### <a name="sql-server-management-studio-support"></a><span data-ttu-id="05e4a-204">Prise en charge de SQL Server Management Studio</span><span class="sxs-lookup"><span data-stu-id="05e4a-204">SQL Server Management Studio support</span></span>  
 <span data-ttu-id="05e4a-205">SQL Server Management Studio vous permet d'utiliser cette fonctionnalité via plusieurs fenêtres de dialogue.</span><span class="sxs-lookup"><span data-stu-id="05e4a-205">SQL Server Management Studio allows you to use this feature via several dialog windows.</span></span> <span data-ttu-id="05e4a-206">Par exemple, vous pouvez taper le chemin d'accès de l'URL du conteneur de stockage, tel que `https://teststorageaccnt.blob.core.windows.net/testcontainer/` sous la forme d'un **Chemin d'accès** dans plusieurs fenêtres de dialogue, telles que **Nouvelle base de données**, **Attacher la base de données**ou **Restaurer la base de données**.</span><span class="sxs-lookup"><span data-stu-id="05e4a-206">For example, you can type the URL path of the storage container, such as `https://teststorageaccnt.blob.core.windows.net/testcontainer/` as a **Path** in several dialog windows, such as **New Database**, **Attach Database**, and **Restore Database**.</span></span> <span data-ttu-id="05e4a-207">Pour plus d’informations, consultez [Didacticiel : SQL Server de fichiers de données dans le service de stockage Azure](../tutorial-use-azure-blob-storage-service-with-sql-server-2016.md).</span><span class="sxs-lookup"><span data-stu-id="05e4a-207">For more information, see [Tutorial: SQL Server Data Files in Azure Storage service](../tutorial-use-azure-blob-storage-service-with-sql-server-2016.md).</span></span>  
  
### <a name="sql-server-management-objects-support"></a><span data-ttu-id="05e4a-208">Prise en charge d'objets SMO (SQL Server Management Objects)</span><span class="sxs-lookup"><span data-stu-id="05e4a-208">SQL Server Management Objects support</span></span>  
 <span data-ttu-id="05e4a-209">Quand vous utilisez la fonctionnalité Fichiers de données SQL Server dans Azure, tous les objets SMO (SQL Server Management Objects) sont pris en charge.</span><span class="sxs-lookup"><span data-stu-id="05e4a-209">When using the SQL Server Data Files in Azure feature, all SQL Server Management Objects (SMO) are supported.</span></span> <span data-ttu-id="05e4a-210">Si un objet SMO nécessite un chemin d'accès de fichier, utilisez le format d'URL BLOB à la place d'un chemin d'accès de fichier local, tel que `https://teststorageaccnt.blob.core.windows.net/testcontainer/`.</span><span class="sxs-lookup"><span data-stu-id="05e4a-210">If an SMO object requires a file path, use the BLOB URL format instead of a local file path, such as `https://teststorageaccnt.blob.core.windows.net/testcontainer/`.</span></span> <span data-ttu-id="05e4a-211">Pour plus d’informations sur les objets SMO, consultez [Guide de programmation SMO &#40;SQL Server Management Objects&#41;](../server-management-objects-smo/sql-server-management-objects-smo-programming-guide.md) dans la documentation en ligne de SQL Server.</span><span class="sxs-lookup"><span data-stu-id="05e4a-211">For more information about SQL Server Management Objects (SMO), see [SQL Server Management Objects &#40;SMO&#41; Programming Guide](../server-management-objects-smo/sql-server-management-objects-smo-programming-guide.md) in SQL Server Books Online.</span></span>  
  
### <a name="transact-sql-support"></a><span data-ttu-id="05e4a-212">Prise en charge de Transact-SQL</span><span class="sxs-lookup"><span data-stu-id="05e4a-212">Transact-SQL support</span></span>  
 <span data-ttu-id="05e4a-213">Cette nouvelle fonctionnalité a apporté le changement suivant dans la surface d'exposition de Transact-SQL :</span><span class="sxs-lookup"><span data-stu-id="05e4a-213">This new feature has introduced the following change in the Transact-SQL surface area:</span></span>  
  
-   <span data-ttu-id="05e4a-214">Une nouvelle colonne **int** , **credential_id**, dans la vue système **sys.master_files** .</span><span class="sxs-lookup"><span data-stu-id="05e4a-214">A new **int** column, **credential_id**, in the **sys.master_files** system view.</span></span> <span data-ttu-id="05e4a-215">La colonne **credential_id** permet aux fichiers de données prenant en charge le Stockage Microsoft Azure d'être référencés dans sys.credentials concernant les informations d'identification créées à leur intention.</span><span class="sxs-lookup"><span data-stu-id="05e4a-215">The **credential_id** column is used to enable Azure Storage enabled data files to be cross-referenced back to sys.credentials for the credentials created for them.</span></span> <span data-ttu-id="05e4a-216">Vous pouvez l'utiliser pour le dépannage, par exemple dans le cas où des informations d'identification ne peuvent pas être supprimées parce qu'elles sont utilisées par un fichier de base de données.</span><span class="sxs-lookup"><span data-stu-id="05e4a-216">You can use it for troubleshooting, such as a credential cannot be deleted when there is a database file which uses it.</span></span>  
  
##  <a name="troubleshooting-for-sql-server-data-files-in-azure"></a><a name="bkmk_Troubleshooting"></a><span data-ttu-id="05e4a-217">Résolution des problèmes liés aux fichiers de données SQL Server dans Azure</span><span class="sxs-lookup"><span data-stu-id="05e4a-217">Troubleshooting for SQL Server Data Files in Azure</span></span>  
 <span data-ttu-id="05e4a-218">Pour éviter des erreurs attribuables à des limitations ou à des fonctionnalités non prises en charge, passez d'abord en revue [Limitations](sql-server-data-files-in-microsoft-azure.md#bkmk_Limitations).</span><span class="sxs-lookup"><span data-stu-id="05e4a-218">To avoid errors due to unsupported features or limitations, first review [Limitations](sql-server-data-files-in-microsoft-azure.md#bkmk_Limitations).</span></span>  
  
 <span data-ttu-id="05e4a-219">Voici la liste des erreurs possibles lorsque vous utilisez la fonctionnalité Fichiers de données SQL Server dans le stockage Azure.</span><span class="sxs-lookup"><span data-stu-id="05e4a-219">The list of errors that you might get when using the SQL Server Data Files in Azure Storage feature are as follows.</span></span>  
  
 <span data-ttu-id="05e4a-220">**Erreurs d'authentification**</span><span class="sxs-lookup"><span data-stu-id="05e4a-220">**Authentication errors**</span></span>  
  
-   <span data-ttu-id="05e4a-221">*Impossible de supprimer les informations d’identification « %.\*ls » parce qu’elles sont utilisées par un fichier de base de données actif.*  </span><span class="sxs-lookup"><span data-stu-id="05e4a-221">*Cannot drop the credential '%.\*ls' because it is used by an active database file.* </span></span>  
    <span data-ttu-id="05e4a-222">Résolution : Cette erreur peut s’afficher lorsque vous tentez de supprimer des informations d’identification utilisées par un fichier de base de données actif dans le Stockage Azure.</span><span class="sxs-lookup"><span data-stu-id="05e4a-222">Resolution: You may see this error when you try to drop a credential that is still being used by an active database file in Azure Storage.</span></span> <span data-ttu-id="05e4a-223">Pour supprimer les informations d'identification, vous devez d'abord supprimer l'objet blob associé qui comporte ce fichier de base de données.</span><span class="sxs-lookup"><span data-stu-id="05e4a-223">To drop the credential, first you must delete the associated blob that has this database file.</span></span> <span data-ttu-id="05e4a-224">Pour supprimer un objet blob dont le bail est actif, vous devez d'abord résilier le bail.</span><span class="sxs-lookup"><span data-stu-id="05e4a-224">To delete a blob that has an active lease, you must first break the lease.</span></span>  
  
-   <span data-ttu-id="05e4a-225">*La signature d'accès partagé n'a pas été créée correctement sur le conteneur.*  </span><span class="sxs-lookup"><span data-stu-id="05e4a-225">*Shared Access Signature has not been created on the container correctly.* </span></span>  
     <span data-ttu-id="05e4a-226">Résolution : vérifiez que vous avez créé correctement une signature d’accès partagé sur le conteneur.</span><span class="sxs-lookup"><span data-stu-id="05e4a-226">Resolution: Make sure that you have created a Shared Access Signature on the container correctly.</span></span> <span data-ttu-id="05e4a-227">Passez en revue les instructions fournies dans la leçon 2 du [Didacticiel : SQL Server fichiers de données dans le service de stockage Azure](../tutorial-use-azure-blob-storage-service-with-sql-server-2016.md).</span><span class="sxs-lookup"><span data-stu-id="05e4a-227">Review the instructions given in Lesson 2 in [Tutorial: SQL Server Data Files in Azure Storage service](../tutorial-use-azure-blob-storage-service-with-sql-server-2016.md).</span></span>  
  
-   <span data-ttu-id="05e4a-228">*Les informations d'identification de SQL Server n'ont pas été créées correctement.*  </span><span class="sxs-lookup"><span data-stu-id="05e4a-228">*SQL Server credential has not been not created correctly.* </span></span>  
    <span data-ttu-id="05e4a-229">Résolution : Vérifiez que vous avez utilisé une « signature d’accès partagé » pour le champ **Identité** et que vous avez créé un secret correctement.</span><span class="sxs-lookup"><span data-stu-id="05e4a-229">Resolution: Make sure that you have used 'Shared Access Signature' for the **Identity** field and created a secret correctly.</span></span> <span data-ttu-id="05e4a-230">Passez en revue les instructions fournies à la leçon 3 dans [Didacticiel : SQL Server fichiers de données dans le service de stockage Azure](../tutorial-use-azure-blob-storage-service-with-sql-server-2016.md).</span><span class="sxs-lookup"><span data-stu-id="05e4a-230">Review the instructions given in Lesson 3 in [Tutorial: SQL Server Data Files in Azure Storage service](../tutorial-use-azure-blob-storage-service-with-sql-server-2016.md).</span></span>  
  
 <span data-ttu-id="05e4a-231">**Erreurs de bail d'un objet blob :**</span><span class="sxs-lookup"><span data-stu-id="05e4a-231">**Lease blob errors:**</span></span>  
  
-   <span data-ttu-id="05e4a-232">Erreur lors de la tentative de démarrage de SQL Server après la défaillance d'une autre instance utilisant les mêmes fichiers d'objets blob.</span><span class="sxs-lookup"><span data-stu-id="05e4a-232">Error when trying to start SQL Server after another instance using the same blob files has crashed.</span></span> <span data-ttu-id="05e4a-233">Résolution : en mode de fonctionnement normal, SQL Server utilise des baux temporaires pour réserver des objets blob pour le stockage, avec un renouvellement du bail de chaque objet blob toutes les 45 à 60 secondes.</span><span class="sxs-lookup"><span data-stu-id="05e4a-233">Resolution: During normal operation, SQL Server uses temporary leases to reserve Blobs for storage with a renewal of each Blob lease every 45 to 60 seconds.</span></span> <span data-ttu-id="05e4a-234">En cas de défaillance d'un serveur et du démarrage d'une autre instance de SQL Server configurée pour utiliser les mêmes objets blob, la nouvelle instance attend jusqu'à 60 secondes, le temps que le bail existant sur l'objet blob expire.</span><span class="sxs-lookup"><span data-stu-id="05e4a-234">If a server crashes and another instance of SQL Server configured to use the same blobs is started, the new instance will wait up to 60 seconds for the existing lease on the Blob to expire.</span></span> <span data-ttu-id="05e4a-235">Si vous voulez attacher la base de données à une autre instance et que vous ne pouvez pas attendre l'expiration du bail pendant 60 secondes, vous pouvez résilier explicitement le bail sur l'objet blob afin d'éviter les erreurs dans les opérations d'attachement.</span><span class="sxs-lookup"><span data-stu-id="05e4a-235">If you want to attach the database to another instance and you cannot wait for the lease to expire within 60 seconds, you can explicitly break the lease on the Blob to avoid any failures in attach operations.</span></span>  
  
 <span data-ttu-id="05e4a-236">**Erreurs de base de données**</span><span class="sxs-lookup"><span data-stu-id="05e4a-236">**Database errors**</span></span>  
  
1.  <span data-ttu-id="05e4a-237">*Erreurs lors de la création d'une base de données* </span><span class="sxs-lookup"><span data-stu-id="05e4a-237">*Errors when creating a database* </span></span>  
    <span data-ttu-id="05e4a-238">Résolution : passez en revue les instructions fournies dans la leçon 4 du [Didacticiel : SQL Server des fichiers de données dans le service de stockage Azure](../tutorial-use-azure-blob-storage-service-with-sql-server-2016.md).</span><span class="sxs-lookup"><span data-stu-id="05e4a-238">Resolution: Review the instructions given in Lesson 4 in [Tutorial: SQL Server Data Files in Azure Storage service](../tutorial-use-azure-blob-storage-service-with-sql-server-2016.md).</span></span>  
  
2.  <span data-ttu-id="05e4a-239">*Erreurs lors de l'exécution de l'instruction Alter* </span><span class="sxs-lookup"><span data-stu-id="05e4a-239">*Errors when running the Alter statement* </span></span>  
    <span data-ttu-id="05e4a-240">Résolution : veillez à exécuter l’instruction Alter Database lorsque la base de données est en ligne.</span><span class="sxs-lookup"><span data-stu-id="05e4a-240">Resolution: Make sure to execute the Alter Database statement when the database is online.</span></span> <span data-ttu-id="05e4a-241">Lors de la copie des fichiers de données vers le stockage Azure, créez toujours un objet blob de pages, et non un objet blob de blocs.</span><span class="sxs-lookup"><span data-stu-id="05e4a-241">When copying the data files to Azure Storage, always create a page blob not a block blob.</span></span> <span data-ttu-id="05e4a-242">Sinon, la modification de la base de données avec l'instruction ALTER échouera.</span><span class="sxs-lookup"><span data-stu-id="05e4a-242">Otherwise, ALTER Database will fail.</span></span> <span data-ttu-id="05e4a-243">Passez en revue les instructions fournies dans la leçon 7 du [Didacticiel : SQL Server fichiers de données dans le service de stockage Azure](../tutorial-use-azure-blob-storage-service-with-sql-server-2016.md).</span><span class="sxs-lookup"><span data-stu-id="05e4a-243">Review the instructions given in Lesson 7 in [Tutorial: SQL Server Data Files in Azure Storage service](../tutorial-use-azure-blob-storage-service-with-sql-server-2016.md).</span></span>  
  
3.  <span data-ttu-id="05e4a-244">*Code d’erreur 5120 impossible d’ouvrir le fichier physique "%. \* ls». Erreur% d du système d’exploitation : « % ls »* </span><span class="sxs-lookup"><span data-stu-id="05e4a-244">*Error code 5120 Unable to open the physical file "%.\*ls". Operating system error %d: "%ls"* </span></span>  
    <span data-ttu-id="05e4a-245">Résolution : Actuellement, cette nouvelle amélioration ne prend pas en charge l’accès simultané de plusieurs instances SQL Server aux mêmes fichiers de base de données dans le Stockage Azure.</span><span class="sxs-lookup"><span data-stu-id="05e4a-245">Resolution: Currently, this new enhancement does not support more than one SQL Server instance accessing the same database files in Azure Storage at the same time.</span></span> <span data-ttu-id="05e4a-246">Si un serveur A est en ligne avec un fichier de base de données actif et si un serveur B démarre par erreur, et qu’il comporte également une base de données qui pointe vers le même fichier de données, le deuxième serveur ne peut pas démarrer la base de données. Un code d’erreur *5120 Impossible d’ouvrir le fichier physique « %.\*ls » est généré. Erreur %d du système d’exploitation : « %ls »* .</span><span class="sxs-lookup"><span data-stu-id="05e4a-246">If ServerA is online with an active database file and if ServerB is accidentally started, and it also has a database which points to the same data file, the second server will fail to start the database with an error *code 5120 Unable to open the physical file "%.\*ls". Operating system error %d: "%ls"*.</span></span>  
  
     <span data-ttu-id="05e4a-247">Pour résoudre ce problème, déterminez d’abord si vous avez besoin du serveur A pour accéder au fichier de base de données dans le stockage Azure.</span><span class="sxs-lookup"><span data-stu-id="05e4a-247">To resolve this issue, first determine if you need ServerA to access the database file in Azure Storage or not.</span></span> <span data-ttu-id="05e4a-248">Si vous n’en avez pas besoin, supprimez simplement toute connexion entre le serveur A et les fichiers de base de données dans le stockage Azure.</span><span class="sxs-lookup"><span data-stu-id="05e4a-248">If not, simply remove any connection between ServerA and the database files in Azure Storage.</span></span> <span data-ttu-id="05e4a-249">Pour ce faire, procédez comme suit :</span><span class="sxs-lookup"><span data-stu-id="05e4a-249">To do this, follow these steps:</span></span>  
  
    1.  <span data-ttu-id="05e4a-250">Définissez le chemin d'accès du serveur A sur un dossier local à l'aide de l'instruction ALTER Database.</span><span class="sxs-lookup"><span data-stu-id="05e4a-250">Set the file path of Server A to a local folder by using the ALTER Database statement.</span></span>  
  
    2.  <span data-ttu-id="05e4a-251">Mettez la base de données hors connexion sur le serveur A.</span><span class="sxs-lookup"><span data-stu-id="05e4a-251">Set the database offline in Server A.</span></span>  
  
    3.  <span data-ttu-id="05e4a-252">Puis, copiez les fichiers de base de données du stockage Azure dans le dossier local du serveur A. Cela garantit que le serveur A dispose toujours d’une copie de la base de données localement.</span><span class="sxs-lookup"><span data-stu-id="05e4a-252">Then, copy database files from Azure Storage to the local folder in Server A. This ensures that ServerA still has a copy of the database locally.</span></span>  
  
    4.  <span data-ttu-id="05e4a-253">Mettez la base de données en ligne.</span><span class="sxs-lookup"><span data-stu-id="05e4a-253">Set the database online.</span></span>  
  
## <a name="see-also"></a><span data-ttu-id="05e4a-254">Voir aussi</span><span class="sxs-lookup"><span data-stu-id="05e4a-254">See Also</span></span>  
 [<span data-ttu-id="05e4a-255">Tutoriel : Fichiers de données SQL Server dans le service de Stockage Azure</span><span class="sxs-lookup"><span data-stu-id="05e4a-255">Tutorial: SQL Server Data Files in Azure Storage service</span></span>](../tutorial-use-azure-blob-storage-service-with-sql-server-2016.md)  
