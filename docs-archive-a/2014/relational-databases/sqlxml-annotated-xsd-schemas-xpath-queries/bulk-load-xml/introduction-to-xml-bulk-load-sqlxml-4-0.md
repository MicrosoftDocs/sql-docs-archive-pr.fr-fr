---
title: Présentation du chargement en masse XML (SQLXML 4,0) | Microsoft Docs
ms.custom: ''
ms.date: 03/07/2017
ms.prod: sql-server-2014
ms.reviewer: ''
ms.technology: xml
ms.topic: reference
helpviewer_keywords:
- nontransacted XML Bulk Load operations
- XML Bulk Load [SQLXML], about XML Bulk Load
- bulk load [SQLXML], about bulk load
- transacted XML Bulk Load operations
- streaming XML data
ms.assetid: 38bd3cbd-65ef-4c23-9ef3-e70ecf6bb88a
author: rothja
ms.author: jroth
ms.openlocfilehash: 4f3e0e78edd967e5fcb7377312c1811d34cb1ef8
ms.sourcegitcommit: ad4d92dce894592a259721a1571b1d8736abacdb
ms.translationtype: MT
ms.contentlocale: fr-FR
ms.lasthandoff: 08/04/2020
ms.locfileid: "87695500"
---
# <a name="introduction-to-xml-bulk-load-sqlxml-40"></a><span data-ttu-id="b1138-102">Présentation du chargement en masse XML (SQLXML 4.0)</span><span class="sxs-lookup"><span data-stu-id="b1138-102">Introduction to XML Bulk Load (SQLXML 4.0)</span></span>
  <span data-ttu-id="b1138-103">Le chargement en masse XML est un objet COM autonome qui vous permet de charger des données XML semi-structurées dans des [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] tables Microsoft.</span><span class="sxs-lookup"><span data-stu-id="b1138-103">XML Bulk Load is a stand-alone COM object that allows you to load semistructured XML data into Microsoft [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] tables.</span></span>  
  
 <span data-ttu-id="b1138-104">Vous pouvez insérer les données XML dans une base de données [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] à l'aide d'une instruction INSERT et de la fonction OPENXML ; toutefois, l'utilitaire de chargement en masse fournit de meilleures performances lorsque vous avez besoin d'insérer des quantités importantes de données XML.</span><span class="sxs-lookup"><span data-stu-id="b1138-104">You can insert XML data into a [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] database by using an INSERT statement and the OPENXML function; however, the Bulk Load utility provides better performance when you need to insert large amounts of XML data.</span></span>  
  
 <span data-ttu-id="b1138-105">La méthode Execute du modèle objet de chargement en masse XML accepte deux paramètres :</span><span class="sxs-lookup"><span data-stu-id="b1138-105">The Execute method of the XML Bulk Load object model takes two parameters:</span></span>  
  
-   <span data-ttu-id="b1138-106">Un schéma XSD (XML Schema Definition)) ou XDR (XML-Data Reduced) annoté.</span><span class="sxs-lookup"><span data-stu-id="b1138-106">An annotated XML Schema Definition (XSD) or XML-Data Reduced (XDR) schema.</span></span> <span data-ttu-id="b1138-107">L'utilitaire de chargement en masse XML interprète ce schéma de mappage et les annotations spécifiées dans le schéma pour identifier les tables SQL Server dans lesquelles les données XML doivent être insérées.</span><span class="sxs-lookup"><span data-stu-id="b1138-107">The XML Bulk Load utility interprets this mapping schema and the annotations that are specified in the schema in identifying the SQL Server tables into which the XML data is to be inserted.</span></span>  
  
-   <span data-ttu-id="b1138-108">Un document ou un fragment de document XML (un fragment de document est un document sans élément de niveau supérieur unique).</span><span class="sxs-lookup"><span data-stu-id="b1138-108">An XML document or document fragment (a document fragment is a document without a single top-level element).</span></span> <span data-ttu-id="b1138-109">Un nom de fichier ou un flux pouvant être lu par le chargement en masse XML peut être spécifié.</span><span class="sxs-lookup"><span data-stu-id="b1138-109">A file name or a stream from which XML Bulk Load can read can be specified.</span></span>  
  
 <span data-ttu-id="b1138-110">Le chargement en masse XML interprète le schéma de mappage et identifie le ou les tables dans lesquelles les données XML doivent être insérées.</span><span class="sxs-lookup"><span data-stu-id="b1138-110">XML Bulk Load interprets the mapping schema and identifies the table(s) into which the XML data is to be inserted.</span></span>  
  
 <span data-ttu-id="b1138-111">Cette rubrique suppose que vous connaissez bien les fonctionnalités [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] suivantes :</span><span class="sxs-lookup"><span data-stu-id="b1138-111">It is assumed that you are familiar with the following [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] features:</span></span>  
  
-   <span data-ttu-id="b1138-112">Schémas XSD et XDR annotés.</span><span class="sxs-lookup"><span data-stu-id="b1138-112">Annotated XSD and XDR schemas.</span></span> <span data-ttu-id="b1138-113">Pour plus d’informations sur les schémas XSD annotés, consultez [Présentation des schémas XSD Annotés &#40;SQLXML 4,0&#41;](../../sqlxml/annotated-xsd-schemas/introduction-to-annotated-xsd-schemas-sqlxml-4-0.md).</span><span class="sxs-lookup"><span data-stu-id="b1138-113">For more information about annotated XSD schemas, see [Introduction to Annotated XSD Schemas &#40;SQLXML 4.0&#41;](../../sqlxml/annotated-xsd-schemas/introduction-to-annotated-xsd-schemas-sqlxml-4-0.md).</span></span> <span data-ttu-id="b1138-114">Pour plus d’informations sur les schémas XDR annotés, consultez [schémas XDR Annotés &#40;dépréciés dans SQLXML 4,0&#41;](../../sqlxml/annotated-xsd-schemas/annotated-xdr-schemas-deprecated-in-sqlxml-4-0.md).</span><span class="sxs-lookup"><span data-stu-id="b1138-114">For information about annotated XDR schemas, see [Annotated XDR Schemas &#40;Deprecated in SQLXML 4.0&#41;](../../sqlxml/annotated-xsd-schemas/annotated-xdr-schemas-deprecated-in-sqlxml-4-0.md).</span></span>  
  
-   <span data-ttu-id="b1138-115">Mécanismes d'insertion en bloc [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)], tels que l'instruction [!INCLUDE[tsql](../../../includes/tsql-md.md)] BULK INSERT et l'utilitaire bcp.</span><span class="sxs-lookup"><span data-stu-id="b1138-115">[!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] bulk insert mechanisms, such as the [!INCLUDE[tsql](../../../includes/tsql-md.md)] BULK INSERT statement and the bcp utility.</span></span> <span data-ttu-id="b1138-116">Pour plus d’informations, consultez [BULK INSERT &#40;Transact-SQL&#41;](/sql/t-sql/statements/bulk-insert-transact-sql) et [utilitaire bcp](../../../tools/bcp-utility.md).</span><span class="sxs-lookup"><span data-stu-id="b1138-116">For more information, see [BULK INSERT &#40;Transact-SQL&#41;](/sql/t-sql/statements/bulk-insert-transact-sql) and [bcp Utility](../../../tools/bcp-utility.md).</span></span>  
  
## <a name="streaming-of-xml-data"></a><span data-ttu-id="b1138-117">Diffusion en continu de données XML</span><span class="sxs-lookup"><span data-stu-id="b1138-117">Streaming of XML Data</span></span>  
 <span data-ttu-id="b1138-118">Le document XML source pouvant être volumineux, le document n'est pas lu intégralement en mémoire au cours du traitement de chargement en masse.</span><span class="sxs-lookup"><span data-stu-id="b1138-118">Because the source XML document can be large, the entire document is not read into memory for bulk load processing.</span></span> <span data-ttu-id="b1138-119">Au lieu de cela, le chargement en masse XML interprète les données XML en tant que flux et lit ce flux.</span><span class="sxs-lookup"><span data-stu-id="b1138-119">Instead, XML Bulk Load interprets the XML data as a stream and reads it.</span></span> <span data-ttu-id="b1138-120">À mesure que l'utilitaire lit les données, il identifie la ou les tables de base de données, génère le ou les enregistrements appropriés à partir de la source de données XML, puis envoie le ou les enregistrements à [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] à des fins d'insertion.</span><span class="sxs-lookup"><span data-stu-id="b1138-120">As the utility reads the data, it identifies the database table(s), generates the appropriate record(s) from the XML data source, and then sends the record(s) to [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] for insertion.</span></span>  
  
 <span data-ttu-id="b1138-121">Par exemple, le document XML source suivant se compose d' **\<Customer>** éléments et d' **\<Order>** éléments enfants :</span><span class="sxs-lookup"><span data-stu-id="b1138-121">For example, the following source XML document consists of **\<Customer>** elements and **\<Order>** child elements:</span></span>  
  
```  
<Customer ...>  
    <Order.../>  
    <Order .../>  
     ...  
</Customer>  
...  
```  
  
 <span data-ttu-id="b1138-122">À mesure que le chargement en masse XML lit l' **\<Customer>** élément, il génère un enregistrement pour le CustomerTable.</span><span class="sxs-lookup"><span data-stu-id="b1138-122">As XML Bulk Load reads the **\<Customer>** element, it generates a record for the Customertable.</span></span> <span data-ttu-id="b1138-123">Lorsqu’il lit la **\</Customer>** balise de fin, le chargement en masse XML insère cet enregistrement dans la table de [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] .</span><span class="sxs-lookup"><span data-stu-id="b1138-123">When it reads the **\</Customer>** end tag, XML Bulk Load inserts that record into the table in [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)].</span></span> <span data-ttu-id="b1138-124">De la même façon, lors de la lecture de l' **\<Order>** élément, le chargement en masse XML génère un enregistrement pour le Ordertable, puis insère cet enregistrement dans la [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] table lors de la lecture de la **\</Order>** balise de fin.</span><span class="sxs-lookup"><span data-stu-id="b1138-124">In the same way, when it reads the **\<Order>** element, XML Bulk Load generates a record for the Ordertable, and then inserts that record into the [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] table upon reading the **\</Order>** end tag.</span></span>  
  
## <a name="transacted-and-nontransacted-xml-bulk-load-operations"></a><span data-ttu-id="b1138-125">Opérations de chargement en masse XML transactionnelles et non transactionnelles</span><span class="sxs-lookup"><span data-stu-id="b1138-125">Transacted and Nontransacted XML Bulk Load Operations</span></span>  
 <span data-ttu-id="b1138-126">Le chargement en masse XML peut fonctionner en mode transactionnel ou non transactionnel.</span><span class="sxs-lookup"><span data-stu-id="b1138-126">XML Bulk Load can operate in either a transacted or a nontransacted mode.</span></span> <span data-ttu-id="b1138-127">Les performances sont généralement optimales si vous effectuez un chargement en masse en mode non-. autrement dit, la propriété transaction est définie sur FALSe et l’une ou l’autre des conditions suivantes est vraie :</span><span class="sxs-lookup"><span data-stu-id="b1138-127">Performance is usually optimal if you are bulk loading in a nontransacted mode: that is, the Transaction property is set to FALSE) and either of the following conditions is true:</span></span>  
  
-   <span data-ttu-id="b1138-128">Les tables dans lesquelles les données sont chargées en masse sont vides et ne comprennent pas d'index.</span><span class="sxs-lookup"><span data-stu-id="b1138-128">The tables into which the data is bulk loaded are empty with no indexes.</span></span>  
  
-   <span data-ttu-id="b1138-129">Les tables ont des données et des index uniques.</span><span class="sxs-lookup"><span data-stu-id="b1138-129">The tables have data and unique indexes.</span></span>  
  
 <span data-ttu-id="b1138-130">L'approche non transactionnelle ne garantit pas de restauration en cas de problème dans le processus de chargement en masse (bien que des restaurations partielles puissent se produire).</span><span class="sxs-lookup"><span data-stu-id="b1138-130">The nontransacted approach does not guarantee a rollback if something goes wrong in the bulk load process (although partial rollbacks can happen).</span></span> <span data-ttu-id="b1138-131">Le chargement en masse non transactionnel est approprié lorsque la base de données est vide.</span><span class="sxs-lookup"><span data-stu-id="b1138-131">The nontransacted bulk load is appropriate when the database is empty.</span></span> <span data-ttu-id="b1138-132">Par conséquent, en cas de problème, vous pouvez nettoyer la base de données et redémarrer le chargement en masse XML.</span><span class="sxs-lookup"><span data-stu-id="b1138-132">Therefore, if something does go wrong, you can clean the database and start XML Bulk Load again.</span></span>  
  
> [!NOTE]  
>  <span data-ttu-id="b1138-133">En mode non transactionnel, le chargement en masse XML utilise une transaction interne par défaut et la valide.</span><span class="sxs-lookup"><span data-stu-id="b1138-133">In nontransacted mode, XML Bulk Load uses a default internal transaction and commits it.</span></span> <span data-ttu-id="b1138-134">Lorsque la propriété transaction a la valeur TRUE, le chargement en masse XML n’appelle pas la validation sur cette transaction.</span><span class="sxs-lookup"><span data-stu-id="b1138-134">When the Transaction property is set to TRUE, XML Bulk Load does not call commit on this transaction.</span></span>  
  
 <span data-ttu-id="b1138-135">Si la propriété transaction est définie sur TRUE, le chargement en masse XML crée des fichiers temporaires, un pour chaque table identifiée dans le schéma de mappage.</span><span class="sxs-lookup"><span data-stu-id="b1138-135">If the Transaction property is set to TRUE, XML Bulk Load creates temporary files, one for each table that is identified in the mapping schema.</span></span> <span data-ttu-id="b1138-136">Le chargement en masse XML commence par stocker les enregistrements du document XML source dans ces fichiers temporaires.</span><span class="sxs-lookup"><span data-stu-id="b1138-136">XML Bulk Load first stores the records from the source XML document in these temporary files.</span></span> <span data-ttu-id="b1138-137">Ensuite, une instruction [!INCLUDE[tsql](../../../includes/tsql-md.md)] BULK INSERT récupère ces enregistrements des fichiers et les stocke dans les tables correspondantes.</span><span class="sxs-lookup"><span data-stu-id="b1138-137">Then, a [!INCLUDE[tsql](../../../includes/tsql-md.md)] BULK INSERT statement retrieves these records from the files and stores them in the corresponding tables.</span></span> <span data-ttu-id="b1138-138">Vous pouvez spécifier l’emplacement de ces fichiers temporaires à l’aide de la propriété TempFilePath.</span><span class="sxs-lookup"><span data-stu-id="b1138-138">You can specify the location for these temporary files by using the TempFilePath property.</span></span> <span data-ttu-id="b1138-139">Vous devez vous assurer que le compte [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] utilisé avec le chargement en masse XML a accès à ce chemin d'accès.</span><span class="sxs-lookup"><span data-stu-id="b1138-139">You must ensure that the [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] account used with XML Bulk Load has access to this path.</span></span> <span data-ttu-id="b1138-140">Si la propriété TempFilePath n’est pas spécifiée, le chemin d’accès au fichier par défaut qui est spécifié dans la variable d’environnement TEMP est utilisé pour créer les fichiers temporaires.</span><span class="sxs-lookup"><span data-stu-id="b1138-140">If the TempFilePath property is not specified, the default file path that is specified in the TEMP environment variable is used to create the temporary files.</span></span>  
  
 <span data-ttu-id="b1138-141">Si la propriété transaction est définie sur FALSe (paramètre par défaut), le chargement en masse XML utilise l’interface OLE DB IRowsetFastLoad pour charger en masse les données.</span><span class="sxs-lookup"><span data-stu-id="b1138-141">If the Transaction property is set to FALSE (the default setting), XML Bulk Load uses the OLE DB interface IRowsetFastLoad to bulk load the data.</span></span>  
  
 <span data-ttu-id="b1138-142">Si la propriété ConnectionString définit la chaîne de connexion et que la propriété transaction a la valeur TRUE, le chargement en masse XML opère dans son propre contexte de transaction.</span><span class="sxs-lookup"><span data-stu-id="b1138-142">If the ConnectionString property sets the connection string, and the Transaction property is set to TRUE, XML Bulk Load operates in its own transaction context.</span></span> <span data-ttu-id="b1138-143">(Par exemple, le chargement en masse XML démarre sa propre transaction, puis effectue une validation ou une restauration comme il convient.)</span><span class="sxs-lookup"><span data-stu-id="b1138-143">(For example, XML Bulk Load starts its own transaction, and commits or rolls back as appropriate.)</span></span>  
  
 <span data-ttu-id="b1138-144">Si la propriété ConnectionCommand définit la connexion avec un objet de connexion existant et que la propriété transaction a la valeur TRUE, le chargement en masse XML n’émet pas d’instruction COMMIT ou ROLLBACK en cas de succès ou d’échec, respectivement.</span><span class="sxs-lookup"><span data-stu-id="b1138-144">If the ConnectionCommand property sets the connection with an existing connection object and the Transaction property is set to TRUE, XML Bulk Load does not issue a COMMIT or ROLLBACK statement in the case of a success or a failure, respectively.</span></span> <span data-ttu-id="b1138-145">En cas d'erreur, le chargement en masse XML retourne le message d'erreur approprié.</span><span class="sxs-lookup"><span data-stu-id="b1138-145">If there is an error, XML Bulk Load returns the appropriate error message.</span></span> <span data-ttu-id="b1138-146">La décision d'émettre une instruction COMMIT ou ROLLBACK appartient au client qui a initialisé le chargement en masse.</span><span class="sxs-lookup"><span data-stu-id="b1138-146">The decision to issue a COMMIT or ROLLBACK statement is left to the client that initiated the bulk load.</span></span> <span data-ttu-id="b1138-147">L’objet de connexion utilisé pour le chargement en masse XML doit être de type ICommand ou d’un objet de commande ADO.</span><span class="sxs-lookup"><span data-stu-id="b1138-147">The connection object that is used for XML Bulk Load should be of type ICommand or be an ADO command object.</span></span>  
  
 <span data-ttu-id="b1138-148">Dans SQLXML 4,0, un ConnectionObject ne peut pas être utilisé avec la propriété transaction définie sur FALSe.</span><span class="sxs-lookup"><span data-stu-id="b1138-148">In SQLXML 4.0, a ConnectionObject cannot be used with the Transaction property set to FALSE.</span></span> <span data-ttu-id="b1138-149">Le mode non-Transact-1 n’est pas pris en charge avec un ConnectionObject, car il est impossible d’ouvrir plusieurs interfaces IRowsetFastLoad sur une session passée.</span><span class="sxs-lookup"><span data-stu-id="b1138-149">The nontransacted mode is not supported with a ConnectionObject because it is impossible to open more than one IRowsetFastLoad interface on a passed-in session.</span></span>  
  
  
