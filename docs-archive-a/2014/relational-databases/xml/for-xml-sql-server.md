---
title: FOR XML (SQL Server) | Microsoft Docs
ms.custom: ''
ms.date: 06/13/2017
ms.prod: sql-server-2014
ms.reviewer: ''
ms.technology: xml
ms.topic: conceptual
helpviewer_keywords:
- FOR XML clause, about FOR XML clause
- PATH FOR XML mode, construction
- EXPLICIT FOR XML mode
- RAW FOR XML mode
- retrieving XML data
- XML [SQL Server], FOR XML clause
- AUTO FOR XML mode
- XML [SQL Server], construction
ms.assetid: 2b6b5c61-c5bd-49d2-8c0c-b7cf15857906
author: rothja
ms.author: jroth
ms.openlocfilehash: 6fe55186e89020f57ae1eb078625d1cdce262864
ms.sourcegitcommit: ad4d92dce894592a259721a1571b1d8736abacdb
ms.translationtype: MT
ms.contentlocale: fr-FR
ms.lasthandoff: 08/04/2020
ms.locfileid: "87710459"
---
# <a name="for-xml-sql-server"></a><span data-ttu-id="4ae3d-102">FOR XML (SQL Server)</span><span class="sxs-lookup"><span data-stu-id="4ae3d-102">FOR XML (SQL Server)</span></span>
  <span data-ttu-id="4ae3d-103">Une requête SELECT retourne les résultats sous la forme d'un ensemble de lignes.</span><span class="sxs-lookup"><span data-stu-id="4ae3d-103">A SELECT query returns results as a rowset.</span></span> <span data-ttu-id="4ae3d-104">Vous pouvez si vous le souhaitez récupérer les résultats d'une requête SQL sous forme de code XML en spécifiant la clause FOR XML dans la requête.</span><span class="sxs-lookup"><span data-stu-id="4ae3d-104">You can optionally retrieve formal results of a SQL query as XML by specifying the FOR XML clause in the query.</span></span> <span data-ttu-id="4ae3d-105">La clause FOR XML peut être utilisée dans les requêtes de premier niveau et dans les sous-requêtes.</span><span class="sxs-lookup"><span data-stu-id="4ae3d-105">The FOR XML clause can be used in top-level queries and in sub queries.</span></span> <span data-ttu-id="4ae3d-106">La clause FOR XML de premier niveau ne peut être utilisée que dans l'instruction SELECT.</span><span class="sxs-lookup"><span data-stu-id="4ae3d-106">The top-level FOR XML clause can be used only in the SELECT statement.</span></span> <span data-ttu-id="4ae3d-107">Dans les sous-requêtes, FOR XML peut être utilisée dans les instructions INSERT, UPDATE et DELETE.</span><span class="sxs-lookup"><span data-stu-id="4ae3d-107">In sub queries, FOR XML can be used in the INSERT, UPDATE, and DELETE statements.</span></span> <span data-ttu-id="4ae3d-108">Elle peut être également utilisée dans les instructions d'assignation.</span><span class="sxs-lookup"><span data-stu-id="4ae3d-108">It can also be used in assignment statements.</span></span>  
  
 <span data-ttu-id="4ae3d-109">Dans une clause FOR XML, vous spécifiez l'un des modes suivants :</span><span class="sxs-lookup"><span data-stu-id="4ae3d-109">In a FOR XML clause, you specify one of these modes:</span></span>  
  
-   <span data-ttu-id="4ae3d-110">RAW</span><span class="sxs-lookup"><span data-stu-id="4ae3d-110">RAW</span></span>  
  
-   <span data-ttu-id="4ae3d-111">AUTO</span><span class="sxs-lookup"><span data-stu-id="4ae3d-111">AUTO</span></span>  
  
-   <span data-ttu-id="4ae3d-112">EXPLICIT</span><span class="sxs-lookup"><span data-stu-id="4ae3d-112">EXPLICIT</span></span>  
  
-   <span data-ttu-id="4ae3d-113">PATH</span><span class="sxs-lookup"><span data-stu-id="4ae3d-113">PATH</span></span>  
  
 <span data-ttu-id="4ae3d-114">Le mode RAW génère un seul élément \<row> par ligne dans l’ensemble de lignes qui est retourné par l’instruction SELECT.</span><span class="sxs-lookup"><span data-stu-id="4ae3d-114">The RAW mode generates a single \<row> element per row in the rowset that is returned by the SELECT statement.</span></span> <span data-ttu-id="4ae3d-115">Vous pouvez générer une hiérarchie XML en écrivant des requêtes FOR XML imbriquées.</span><span class="sxs-lookup"><span data-stu-id="4ae3d-115">You can generate XML hierarchy by writing nested FOR XML queries.</span></span>  
  
 <span data-ttu-id="4ae3d-116">Le mode AUTO génère l'imbrication dans le code XML résultant en utilisant une heuristique basée sur la manière dont l'instruction SELECT est spécifiée.</span><span class="sxs-lookup"><span data-stu-id="4ae3d-116">The AUTO mode generates nesting in the resulting XML by using heuristics based on the way the SELECT statement is specified.</span></span> <span data-ttu-id="4ae3d-117">Vous n'avez qu'un contrôle minimal sur la forme du code XML généré.</span><span class="sxs-lookup"><span data-stu-id="4ae3d-117">You have minimal control over the shape of the XML generated.</span></span> <span data-ttu-id="4ae3d-118">Les requêtes FOR XML imbriquées peuvent être écrites de façon à générer une hiérarchie XML au-delà de la forme XML générée par l'heuristique du mode AUTO.</span><span class="sxs-lookup"><span data-stu-id="4ae3d-118">The nested FOR XML queries can be written to generate XML hierarchy beyond the XML shape that is generated by AUTO mode heuristics.</span></span>  
  
 <span data-ttu-id="4ae3d-119">Le mode EXPLICIT permet de contrôler davantage la forme du code XML.</span><span class="sxs-lookup"><span data-stu-id="4ae3d-119">The EXPLICIT mode allows more control over the shape of the XML.</span></span> <span data-ttu-id="4ae3d-120">Vous pouvez combiner des attributs et des éléments à volonté afin de décider de la forme du code XML.</span><span class="sxs-lookup"><span data-stu-id="4ae3d-120">You can mix attributes and elements at will in deciding the shape of the XML.</span></span> <span data-ttu-id="4ae3d-121">Un format spécifique est nécessaire pour l'ensemble de lignes généré suite à l'exécution de requête.</span><span class="sxs-lookup"><span data-stu-id="4ae3d-121">It requires a specific format for the resulting rowset that is generated because of query execution.</span></span> <span data-ttu-id="4ae3d-122">Le format d'ensemble de lignes est ensuite mappé au format XML.</span><span class="sxs-lookup"><span data-stu-id="4ae3d-122">This rowset format is then mapped into XML shape.</span></span> <span data-ttu-id="4ae3d-123">L'avantage du mode EXPLICIT est qu'il permet de combiner des attributs et des éléments à volonté, de créer des wrappers et des propriétés complexes imbriquées et de créer des valeurs séparées par des espaces (par exemple, l'attribut OrderID peut avoir une liste d'ID d'ordre) ainsi que du contenu mixte.</span><span class="sxs-lookup"><span data-stu-id="4ae3d-123">The power of EXPLICIT mode is to mix attributes and elements at will, create wrappers and nested complex properties, create space-separated values (for example, OrderID attribute may have a list of order ID values), and mixed contents.</span></span>  
  
 <span data-ttu-id="4ae3d-124">Toutefois, l'écriture de requêtes en mode EXPLICIT peut être une opération pénible.</span><span class="sxs-lookup"><span data-stu-id="4ae3d-124">However, writing EXPLICIT mode queries can be cumbersome.</span></span> <span data-ttu-id="4ae3d-125">Vous pouvez utiliser certaines des nouvelles fonctionnalités FOR XML, telles que l'écriture de requêtes FOR XML en mode RAW/AUTO/PATH et la directive TYPE, au lieu d'utiliser le mode EXPLICIT pour générer les hiérarchies.</span><span class="sxs-lookup"><span data-stu-id="4ae3d-125">You can use some of the new FOR XML capabilities, such as writing nested FOR XML RAW/AUTO/PATH mode queries and the TYPE directive, instead of using EXPLICIT mode to generate the hierarchies.</span></span> <span data-ttu-id="4ae3d-126">Les requêtes FOR XML imbriquées peuvent produire tout code XML que vous générez à l'aide du mode EXPLICIT.</span><span class="sxs-lookup"><span data-stu-id="4ae3d-126">The nested FOR XML queries can produce any XML that you can generate by using the EXPLICIT mode.</span></span> <span data-ttu-id="4ae3d-127">Pour plus d’informations, consultez [Utiliser des requêtes FOR XML imbriquées](use-nested-for-xml-queries.md) et [Directive TYPE dans les requêtes FOR XML](type-directive-in-for-xml-queries.md).</span><span class="sxs-lookup"><span data-stu-id="4ae3d-127">For more information, see [Use Nested FOR XML Queries](use-nested-for-xml-queries.md) and [TYPE Directive in FOR XML Queries](type-directive-in-for-xml-queries.md).</span></span>  
  
 <span data-ttu-id="4ae3d-128">Le mode PATH, associé à la capacité des requêtes FOR XML imbriquées, offre la flexibilité du mode EXPLICIT sous une forme plus simple.</span><span class="sxs-lookup"><span data-stu-id="4ae3d-128">The PATH mode together with the nested FOR XML query capability provides the flexibility of the EXPLICIT mode in a simpler manner.</span></span>  
  
 <span data-ttu-id="4ae3d-129">Ces modes ne s'appliquent qu'aux requêtes pour lesquelles ils sont définis.</span><span class="sxs-lookup"><span data-stu-id="4ae3d-129">These modes are in effect only for the execution of the query for which they are set.</span></span> <span data-ttu-id="4ae3d-130">Ils n'affectent pas les résultats des requêtes suivantes.</span><span class="sxs-lookup"><span data-stu-id="4ae3d-130">They do not affect the results of any subsequent queries.</span></span>  
  
 <span data-ttu-id="4ae3d-131">La clause FOR XML n'est pas valide en cas de sélection comportant une clause FOR BROWSE.</span><span class="sxs-lookup"><span data-stu-id="4ae3d-131">FOR XML is not valid for any selection that is used with a FOR BROWSE clause.</span></span>  
  
## <a name="example"></a><span data-ttu-id="4ae3d-132">Exemple</span><span class="sxs-lookup"><span data-stu-id="4ae3d-132">Example</span></span>  
 <span data-ttu-id="4ae3d-133">L’instruction `SELECT` suivante récupère des informations des tables `Sales.Customer` et `Sales.SalesOrderHeader` de la base de données `AdventureWorks2012` .</span><span class="sxs-lookup"><span data-stu-id="4ae3d-133">The following `SELECT` statement retrieves information from the `Sales.Customer` and `Sales.SalesOrderHeader` tables in the `AdventureWorks2012` database.</span></span> <span data-ttu-id="4ae3d-134">Cette requête spécifie le mode `AUTO` dans la clause `FOR XML` :</span><span class="sxs-lookup"><span data-stu-id="4ae3d-134">This query specifies the `AUTO` mode in the `FOR XML` clause:</span></span>  
  
```  
USE AdventureWorks2012  
GO  
SELECT Cust.CustomerID,   
       OrderHeader.CustomerID,  
       OrderHeader.SalesOrderID,   
       OrderHeader.Status  
FROM Sales.Customer Cust   
INNER JOIN Sales.SalesOrderHeader OrderHeader  
ON Cust.CustomerID = OrderHeader.CustomerID  
FOR XML AUTO  
```  
  
## <a name="the-for-xml-clause-and-server-names"></a><span data-ttu-id="4ae3d-135">La clause FOR XML et les noms de serveurs</span><span class="sxs-lookup"><span data-stu-id="4ae3d-135">The FOR XML Clause and Server Names</span></span>  
 <span data-ttu-id="4ae3d-136">Quand une instruction SELECT avec une clause FOR XML spécifie un nom en quatre parties dans la requête, le nom du serveur n'est pas renvoyé dans le document XML résultant quand la requête est exécutée sur l'ordinateur local.</span><span class="sxs-lookup"><span data-stu-id="4ae3d-136">When a SELECT statement with a FOR XML clause specifies a four-part name in the query, the server name is not returned in the resulting XML document when the query is executed on the local computer.</span></span> <span data-ttu-id="4ae3d-137">Cependant, le nom du serveur est renvoyé sous forme de nom en quatre parties quand la requête s'exécute sur un serveur.</span><span class="sxs-lookup"><span data-stu-id="4ae3d-137">However, the server name is returned as the four-part name when the query is executed on a network server.</span></span>  
  
 <span data-ttu-id="4ae3d-138">Par exemple, envisagez la requête suivante :</span><span class="sxs-lookup"><span data-stu-id="4ae3d-138">For example, consider this query:</span></span>  
  
```  
SELECT TOP 1 LastName  
FROM ServerName.AdventureWorks2012.Person.Person  
FOR XML AUTO  
```  
  
 <span data-ttu-id="4ae3d-139">Quand `ServerName` est un serveur local, la requête renvoie :</span><span class="sxs-lookup"><span data-stu-id="4ae3d-139">When `ServerName` is a local server, the query returns the following:</span></span>  
  
```  
<AdventureWorks2012.Person.Person LastName="Achong" />  
```  
  
 <span data-ttu-id="4ae3d-140">Quand `ServerName` est un serveur réseau, la requête renvoie :</span><span class="sxs-lookup"><span data-stu-id="4ae3d-140">When `ServerName` is a network server, the query returns the following:</span></span>  
  
```  
<ServerName.AdventureWorks2012.Person.Person LastName="Achong" />  
```  
  
 <span data-ttu-id="4ae3d-141">Cette ambiguïté peut être levée à condition de spécifier cet alias :</span><span class="sxs-lookup"><span data-stu-id="4ae3d-141">This potential ambiguity can be avoided by specifying this alias:</span></span>  
  
```  
SELECT TOP 1 LastName  
FROM ServerName.AdventureWorks2012.Person.Person x  
FOR XML AUTO   
```  
  
 <span data-ttu-id="4ae3d-142">Cette requête donne le résultat suivant :</span><span class="sxs-lookup"><span data-stu-id="4ae3d-142">This query returns the following:</span></span>  
  
```  
<x LastName="Achong"/>  
```  
  
## <a name="see-also"></a><span data-ttu-id="4ae3d-143">Voir aussi</span><span class="sxs-lookup"><span data-stu-id="4ae3d-143">See Also</span></span>  
 <span data-ttu-id="4ae3d-144">[Syntaxe de base de la clause FOR XML](basic-syntax-of-the-for-xml-clause.md) </span><span class="sxs-lookup"><span data-stu-id="4ae3d-144">[Basic Syntax of the FOR XML Clause](basic-syntax-of-the-for-xml-clause.md) </span></span>  
 <span data-ttu-id="4ae3d-145">[Utiliser le mode RAW avec FOR XML](use-raw-mode-with-for-xml.md) </span><span class="sxs-lookup"><span data-stu-id="4ae3d-145">[Use RAW Mode with FOR XML](use-raw-mode-with-for-xml.md) </span></span>  
 <span data-ttu-id="4ae3d-146">[UTiliser le mode AUTO avec FOR XML](use-auto-mode-with-for-xml.md) </span><span class="sxs-lookup"><span data-stu-id="4ae3d-146">[Use AUTO Mode with FOR XML](use-auto-mode-with-for-xml.md) </span></span>  
 <span data-ttu-id="4ae3d-147">[Utiliser le mode EXPLICIT avec FOR XML](use-explicit-mode-with-for-xml.md) </span><span class="sxs-lookup"><span data-stu-id="4ae3d-147">[Use EXPLICIT Mode with FOR XML](use-explicit-mode-with-for-xml.md) </span></span>  
 <span data-ttu-id="4ae3d-148">[Utiliser le mode PATH avec FOR XML](use-path-mode-with-for-xml.md) </span><span class="sxs-lookup"><span data-stu-id="4ae3d-148">[Use PATH Mode with FOR XML](use-path-mode-with-for-xml.md) </span></span>  
 <span data-ttu-id="4ae3d-149">[&#41;de SQL Server &#40;OPENXML](openxml-sql-server.md) </span><span class="sxs-lookup"><span data-stu-id="4ae3d-149">[OPENXML &#40;SQL Server&#41;](openxml-sql-server.md) </span></span>  
 [<span data-ttu-id="4ae3d-150">Ajouter des espaces de noms aux requêtes avec WITH XMLNAMESPACES</span><span class="sxs-lookup"><span data-stu-id="4ae3d-150">Add Namespaces to Queries with WITH XMLNAMESPACES</span></span>](add-namespaces-to-queries-with-with-xmlnamespaces.md)  
  
  
