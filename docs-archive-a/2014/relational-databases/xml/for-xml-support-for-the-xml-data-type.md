---
title: Prise en charge de FOR XML pour le type de données XML | Microsoft Docs
ms.custom: ''
ms.date: 06/13/2017
ms.prod: sql-server-2014
ms.reviewer: ''
ms.technology: xml
ms.topic: conceptual
helpviewer_keywords:
- user-defined functions [SQL Server], XML
- xml data type [SQL Server], FOR XML clause
ms.assetid: 365de07d-694c-4c8b-b671-8825be27f87c
author: rothja
ms.author: jroth
ms.openlocfilehash: 16b03d5f10ded40bb284c409f772ee8986060515
ms.sourcegitcommit: ad4d92dce894592a259721a1571b1d8736abacdb
ms.translationtype: MT
ms.contentlocale: fr-FR
ms.lasthandoff: 08/04/2020
ms.locfileid: "87710444"
---
# <a name="for-xml-support-for-the-xml-data-type"></a><span data-ttu-id="e9586-102">Prise en charge de FOR XML pour le type de données XML</span><span class="sxs-lookup"><span data-stu-id="e9586-102">FOR XML Support for the xml Data Type</span></span>
  <span data-ttu-id="e9586-103">Si une requête FOR XML spécifie une colonne de type `xml` dans la clause SELECT, les valeurs de la colonne sont mappées comme éléments dans le code XML retourné, que vous spécifiiez ou non la directive ELEMENTS.</span><span class="sxs-lookup"><span data-stu-id="e9586-103">If a FOR XML query specifies a column of `xml` type in the SELECT clause, column values are mapped as elements in the returned XML, regardless of whether you specify the ELEMENTS directive.</span></span> <span data-ttu-id="e9586-104">Toute déclaration XML dans la colonne de type `xml` n'est pas sérialisée.</span><span class="sxs-lookup"><span data-stu-id="e9586-104">Any XML declaration in the `xml` type column is not serialized.</span></span>  
  
 <span data-ttu-id="e9586-105">Par exemple, la requête suivante récupère des informations de contact client, telles que les `BusinessEntityID` `FirstName` colonnes, et `LastName` , ainsi que les numéros de téléphone de la `AdditionalContactInfo` colonne de `xml` type.</span><span class="sxs-lookup"><span data-stu-id="e9586-105">For example, the following query retrieves customer contact information such as the `BusinessEntityID`, `FirstName`, and `LastName` columns, and the telephone numbers from the `AdditionalContactInfo` column of `xml` type.</span></span>  
  
```  
USE AdventureWorks2012;  
GO  
SELECT BusinessEntityID, FirstName, LastName, AdditionalContactInfo.query('  
declare namespace act="https://schemas.microsoft.com/sqlserver/2004/07/adventure-works/ContactTypes";  
 //act:telephoneNumber/act:number  
') AS PhoneNumber  
FROM Person.Person  
WHERE AdditionalContactInfo.query('  
declare namespace act="https://schemas.microsoft.com/sqlserver/2004/07/adventure-works/ContactTypes";  
 //act:telephoneNumber/act:number  
')IS NOT NULL  
FOR XML AUTO, TYPE;  
```  
  
 <span data-ttu-id="e9586-106">La requête ne spécifiant pas la directive ELEMENTS, les valeurs de colonne sont retournées en tant qu'attributs, à l'exception des valeurs d'informations de contact supplémentaires récupérées à partir de la colonne de type `xml`.</span><span class="sxs-lookup"><span data-stu-id="e9586-106">Because the query does not specify the ELEMENTS directive, the column values are returned as attributes, except for the additional contact information values retrieved from the `xml` type column.</span></span> <span data-ttu-id="e9586-107">Celles-ci sont retournées en tant qu'éléments.</span><span class="sxs-lookup"><span data-stu-id="e9586-107">These are returned as elements.</span></span>  
  
 <span data-ttu-id="e9586-108">Voici le résultat partiel :</span><span class="sxs-lookup"><span data-stu-id="e9586-108">This is the partial result:</span></span>  
  
 `<Person.Person BusinessEntityID="291" FirstName="Gustavo" LastName="Achong">`  
  
 `<PhoneNumber>`  
  
 `<act:number xmlns:act="https://schemas.microsoft.com/sqlserver/2004/07/adventure-works/ContactTypes">425-555-1112</act:number>`  
  
 `<act:number xmlns:act="https://schemas.microsoft.com/sqlserver/2004/07/adventure-works/ContactTypes">425-555-1111</act:number>`  
  
 `</PhoneNumber>`  
  
 `</Person.Person>`  
  
 `<Person.Person BusinessEntityID="293" FirstName="Catherine" LastName="Abel">`  
  
 `<PhoneNumber>`  
  
 `<act:number xmlns:act="https://schemas.microsoft.com/sqlserver/2004/07/adventure-works/ContactTypes">206-555-2222</act:number>`  
  
 `<act:number xmlns:act="https://schemas.microsoft.com/sqlserver/2004/07/adventure-works/ContactTypes">206-555-1234</act:number>`  
  
 `</PhoneNumber>`  
  
```  
</Person.Person>  
...  
```  
  
 <span data-ttu-id="e9586-109">Si vous spécifiez un alias de colonne pour la colonne XML générée par la requête XQuery, cet alias est utilisé pour ajouter un élément wrapper autour du code XML généré par la requête XQuery.</span><span class="sxs-lookup"><span data-stu-id="e9586-109">If you specify a column alias for the XML column generated by the XQuery, that alias is used to add a wrapper element around the XML generated by the XQuery.</span></span> <span data-ttu-id="e9586-110">Par exemple, la requête suivante spécifie `MorePhoneNumbers` comme alias de colonne :</span><span class="sxs-lookup"><span data-stu-id="e9586-110">For example, the following query specifies `MorePhoneNumbers` as a column alias:</span></span>  
  
```  
SELECT BusinessEntityID, FirstName, LastName, AdditionalContactInfo.query('  
declare namespace act="https://schemas.microsoft.com/sqlserver/2004/07/adventure-works/ContactTypes";  
 //act:telephoneNumber/act:number  
') AS PhoneNumber  
FROM Person.Person  
WHERE AdditionalContactInfo.query('  
declare namespace act="https://schemas.microsoft.com/sqlserver/2004/07/adventure-works/ContactTypes";  
 //act:telephoneNumber/act:number  
')IS NOT NULL  
FOR XML AUTO, TYPE;  
```  
  
 <span data-ttu-id="e9586-111">Le code XML retourné par la requête XQuery est enveloppé dans l'élément <`MorePhoneNumbers`>, comme illustré dans le résultat partiel suivant :</span><span class="sxs-lookup"><span data-stu-id="e9586-111">The XML returned by the XQuery is wrapped in the <`MorePhoneNumbers`> element, as shown in the following partial result:</span></span>  
  
 `<Person.Person BusinessEntityID="291" FirstName="Gustavo" LastName="Achong">`  
  
 `<MorePhoneNumbers>`  
  
 `<act:number xmlns:act="https://schemas.microsoft.com/sqlserver/2004/07/adventure-works/ContactTypes">425-555-1112</act:number>`  
  
 `<act:number xmlns:act="https://schemas.microsoft.com/sqlserver/2004/07/adventure-works/ContactTypes">425-555-1111</act:number>`  
  
 `</MorePhoneNumbers>`  
  
 `</Person.Person>`  
  
 `<Person.Person BusinessEntityID="293" FirstName="Catherine" LastName="Abel">`  
  
 `<MorePhoneNumbers>`  
  
 `<act:number xmlns:act="https://schemas.microsoft.com/sqlserver/2004/07/adventure-works/ContactTypes">206-555-2222</act:number>`  
  
 `<act:number xmlns:act="https://schemas.microsoft.com/sqlserver/2004/07/adventure-works/ContactTypes">206-555-1234</act:number>`  
  
 `</MorePhoneNumbers>`  
  
```  
</Person.Person>  
...  
```  
  
 <span data-ttu-id="e9586-112">Si vous spécifiez la directive ELEMENTS dans la requête, BusinessEntityID, LastName et FirstName seront retournés en tant qu'éléments dans le code XML résultant.</span><span class="sxs-lookup"><span data-stu-id="e9586-112">If you specify the ELEMENTS directive in the query, the BusinessEntityID, LastName, and FirstName will be returned as elements in the resulting XML.</span></span>  
  
 <span data-ttu-id="e9586-113">L'exemple suivant illustre le fait que la logique de traitement FOR XML ne sérialise aucune déclaration XML dans les données XML d'une colonne de type `xml` :</span><span class="sxs-lookup"><span data-stu-id="e9586-113">The following example illustrates that the FOR XML processing logic does not serialize any XML declarations in the XML data from an `xml` type column:</span></span>  
  
```  
create table t(i int, x xml)  
go  
insert into t values(1, '<?xml version="1.0" encoding="UTF-8" ?>  
                             <Root SomeID="10" />')  
select i, x  
from   t  
for xml auto;  
```  
  
 <span data-ttu-id="e9586-114">Voici l'ensemble de résultats.</span><span class="sxs-lookup"><span data-stu-id="e9586-114">This is the result.</span></span> <span data-ttu-id="e9586-115">Dans ce résultat, la déclaration XML <`?xml version="1.0" encoding="UTF-8" ?`> n'est pas sérialisée.</span><span class="sxs-lookup"><span data-stu-id="e9586-115">In the result, the XML declaration <`?xml version="1.0" encoding="UTF-8" ?`> is not serialized.</span></span>  
  
```  
<root>  
  <t i="1">  
    <x>  
      <Root SomeID="10" />  
    </x>  
  </t>  
</root>  
```  
  
## <a name="returning-xml-from-a-user-defined-function"></a><span data-ttu-id="e9586-116">Retour de code XML à partir d'une fonction définie par l'utilisateur</span><span class="sxs-lookup"><span data-stu-id="e9586-116">Returning XML from a User-defined Function</span></span>  
 <span data-ttu-id="e9586-117">Il est possible d'utiliser des requêtes FOR XML pour retourner du code XML à partir d'une fonction définie par l'utilisateur qui retourne l'un des éléments suivants :</span><span class="sxs-lookup"><span data-stu-id="e9586-117">FOR XML queries can be used for returning XML from a user-defined function that returns either of the following:</span></span>  
  
-   <span data-ttu-id="e9586-118">une table avec une seule colonne de type `xml` ;</span><span class="sxs-lookup"><span data-stu-id="e9586-118">A table with a single `xml` type column</span></span>  
  
-   <span data-ttu-id="e9586-119">une instance du type `xml` ;</span><span class="sxs-lookup"><span data-stu-id="e9586-119">An instance of the `xml` type</span></span>  
  
 <span data-ttu-id="e9586-120">Par exemple, la fonction suivante définie par l'utilisateur retourne une table avec une seule colonne de type `xm`l :</span><span class="sxs-lookup"><span data-stu-id="e9586-120">For example, the following user-defined function returns a table with a single column of `xm`l type:</span></span>  
  
```  
USE AdventureWorks2012;  
GO  
CREATE FUNCTION dbo.MyUDF (@ProudctModelID int)  
RETURNS @T TABLE  
  (  
     ProductDescription xml  
  )  
AS  
BEGIN  
  INSERT @T  
     SELECT CatalogDescription.query('  
declare namespace PD="http://www.adventure-works.com/schemas/products/description";  
                    //PD:ProductDescription  ')  
     FROM Production.ProductModel  
     WHERE ProductModelID = @ProudctModelID  
  RETURN  
END;  
```  
  
 <span data-ttu-id="e9586-121">Vous pouvez exécuter la fonction définie par l'utilisateur et interroger la table retournée par celle-ci.</span><span class="sxs-lookup"><span data-stu-id="e9586-121">You can execute the user-defined function and query the table returned by it.</span></span> <span data-ttu-id="e9586-122">Dans cet exemple, le code XML retourné suite à l'interrogation de la table est assigné à une variable de type `xml`.</span><span class="sxs-lookup"><span data-stu-id="e9586-122">In this example, the XML returned by querying the table is assigned to an `xml` type variable.</span></span>  
  
```  
declare @x xml;  
set @x = (SELECT * FROM MyUDF(19));  
select @x;  
```  
  
 <span data-ttu-id="e9586-123">Voici un autre exemple de fonction définie par l'utilisateur.</span><span class="sxs-lookup"><span data-stu-id="e9586-123">This is another example of a user-defined function.</span></span> <span data-ttu-id="e9586-124">Cette fonction définie par l'utilisateur retourne une instance du type `xml`.</span><span class="sxs-lookup"><span data-stu-id="e9586-124">This user-defined function returns an instance of the `xml` type.</span></span> <span data-ttu-id="e9586-125">Dans cet exemple, la fonction définie par l'utilisateur retourne une instance XML typée car l'espace de noms du schéma est spécifié.</span><span class="sxs-lookup"><span data-stu-id="e9586-125">In this example, the user-defined function returns a typed XML instance, because the schema namespace is specified.</span></span>  
  
```  
DROP FUNCTION dbo.MyUDF;  
GO  
CREATE FUNCTION MyUDF (@ProductModelID int)   
RETURNS xml ([Production].[ProductDescriptionSchemaCollection])  
AS  
BEGIN  
  declare @x xml  
  set @x =   ( SELECT CatalogDescription  
          FROM Production.ProductModel  
          WHERE ProductModelID = @ProductModelID )  
  return @x  
END;  
```  
  
 <span data-ttu-id="e9586-126">Le code XML retourné par la fonction définie par l'utilisateur peut être assigné à une variable de type `xml` comme suit :</span><span class="sxs-lookup"><span data-stu-id="e9586-126">The XML returned by the user-defined function can be assigned to an `xml` type variable as follows:</span></span>  
  
```  
declare @x xml;  
SELECT @x= dbo.MyUDF4 (19) ;  
select @x;  
```  
  
## <a name="see-also"></a><span data-ttu-id="e9586-127">Voir aussi</span><span class="sxs-lookup"><span data-stu-id="e9586-127">See Also</span></span>  
 [<span data-ttu-id="e9586-128">Prise en charge de FOR XML pour différents types de données SQL Server</span><span class="sxs-lookup"><span data-stu-id="e9586-128">FOR XML Support for Various SQL Server Data Types</span></span>](for-xml-support-for-various-sql-server-data-types.md)  
  
  
