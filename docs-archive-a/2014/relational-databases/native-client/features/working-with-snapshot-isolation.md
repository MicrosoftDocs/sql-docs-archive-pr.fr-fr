---
title: Utilisation de l’isolement de capture instantanée | Microsoft Docs
ms.custom: ''
ms.date: 03/06/2017
ms.prod: sql-server-2014
ms.reviewer: ''
ms.technology: native-client
ms.topic: reference
helpviewer_keywords:
- data access [SQL Server Native Client], snapshot isolation
- SQLNCLI, snapshot isolation
- isolation levels [SQL Server], snapshot
- DBPROPSET_SESSION property set
- DBDROPSET_DATASOURCEINFO property set
- snapshot isolation [SQL Server Native Client]
- SQL Server Native Client OLE DB provider, snapshot isolation
- SQL Server Native Client ODBC driver, snapshot isolation
- SQL Server Native Client, snapshot isolation
- SQLGetInfo function
- concurrency [SQL Server Native Client]
- SQLSetConnectAttr function
ms.assetid: 39e87eb1-677e-45dd-bc61-83a4025a7756
author: rothja
ms.author: jroth
ms.openlocfilehash: 242d054a5fd2ad12a8811bebc834d423f547a499
ms.sourcegitcommit: ad4d92dce894592a259721a1571b1d8736abacdb
ms.translationtype: MT
ms.contentlocale: fr-FR
ms.lasthandoff: 08/04/2020
ms.locfileid: "87612260"
---
# <a name="working-with-snapshot-isolation"></a><span data-ttu-id="d47cc-102">Utilisation de l’isolement de capture instantanée</span><span class="sxs-lookup"><span data-stu-id="d47cc-102">Working with Snapshot Isolation</span></span>
  <span data-ttu-id="d47cc-103">Dans [!INCLUDE[ssVersion2005](../../../includes/ssversion2005-md.md)], un nouveau niveau d'isolement d'« instantané » a été introduit pour améliorer la concurrence pour les applications de traitement transactionnel en ligne (OLTP).</span><span class="sxs-lookup"><span data-stu-id="d47cc-103">[!INCLUDE[ssVersion2005](../../../includes/ssversion2005-md.md)] introduced a new "snapshot" isolation level that is intended to enhance concurrency for online transaction processing (OLTP) applications.</span></span> <span data-ttu-id="d47cc-104">Dans les versions antérieures à [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)], la concurrence était uniquement basée sur le verrouillage, ce qui pouvait provoquer des problèmes de blocage pour certaines applications.</span><span class="sxs-lookup"><span data-stu-id="d47cc-104">In earlier versions of [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)], concurrency was based solely on locking, which can cause blocking and deadlocking problems for some applications.</span></span> <span data-ttu-id="d47cc-105">Le niveau d'isolement d'instantané, qui dépend des améliorations apportées au contrôle de version de ligne, est conçu pour améliorer les performances en évitant les scénarios de blocage du lecteur/enregistreur.</span><span class="sxs-lookup"><span data-stu-id="d47cc-105">Snapshot isolation depends on enhancements to row versioning and is intended to improve performance by avoiding reader-writer blocking scenarios.</span></span>  
  
 <span data-ttu-id="d47cc-106">Les transactions qui démarrent avec un niveau d'isolement d'instantané lisent un instantané de base de données au moment du démarrage de la transaction.</span><span class="sxs-lookup"><span data-stu-id="d47cc-106">Transactions that start under snapshot isolation read a database snapshot as of the time when the transaction starts.</span></span> <span data-ttu-id="d47cc-107">Entre autres conséquences, lorsque vous ouvrez des curseurs de jeu de clés, dynamiques et côté serveur statiques dans un contexte de transaction d'instantané, ceux-ci se comportent de manière comparable à des curseurs statiques ouverts dans des transactions sérialisables.</span><span class="sxs-lookup"><span data-stu-id="d47cc-107">One result of this is that keyset, dynamic and static server cursors, when opened within a snapshot transaction context, behave much like static cursors opened within serializable transactions.</span></span> <span data-ttu-id="d47cc-108">Toutefois, lorsque les curseurs sont ouverts avec un niveau d'isolement d'instantané, les verrous ne sont pas pris, ce qui peut réduire le blocage sur le serveur.</span><span class="sxs-lookup"><span data-stu-id="d47cc-108">However, when the cursors are opened under the snapshot isolation level locks are not taken, which can reduce blocking on the server.</span></span>  
  
## <a name="sql-server-native-client-ole-db-provider"></a><span data-ttu-id="d47cc-109">Fournisseur OLE DB SQL Server Native Client</span><span class="sxs-lookup"><span data-stu-id="d47cc-109">SQL Server Native Client OLE DB Provider</span></span>  
 <span data-ttu-id="d47cc-110">Le [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] fournisseur OLE DB Native Client a des améliorations qui tirent parti de l’isolation d’instantané introduite dans [!INCLUDE[ssVersion2005](../../../includes/ssversion2005-md.md)] .</span><span class="sxs-lookup"><span data-stu-id="d47cc-110">The [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] Native Client OLE DB provider has enhancements that take advantage of the snapshot isolation introduced in [!INCLUDE[ssVersion2005](../../../includes/ssversion2005-md.md)].</span></span> <span data-ttu-id="d47cc-111">Ces améliorations incluent des modifications aux jeux de propriétés DBPROPSET_DATASOURCEINFO et DBPROPSET_SESSION.</span><span class="sxs-lookup"><span data-stu-id="d47cc-111">These enhancements include changes to the DBPROPSET_DATASOURCEINFO and DBPROPSET_SESSION property sets.</span></span>  
  
### <a name="dbpropset_datasourceinfo"></a><span data-ttu-id="d47cc-112">DBPROPSET_DATASOURCEINFO</span><span class="sxs-lookup"><span data-stu-id="d47cc-112">DBPROPSET_DATASOURCEINFO</span></span>  
 <span data-ttu-id="d47cc-113">Le jeu de propriétés DBPROPSET_DATASOURCEINFO a été modifié pour indiquer que le niveau d'isolement d'instantané est pris en charge par l'ajout de la valeur DBPROPVAL_TI_SNAPSHOT utilisée dans la propriété DBPROP_SUPPORTEDTXNISOLEVELS.</span><span class="sxs-lookup"><span data-stu-id="d47cc-113">The DBPROPSET_DATASOURCEINFO property set has been changed to indicate that the snapshot isolation level is supported by the addition of the DBPROPVAL_TI_SNAPSHOT value that is used in the DBPROP_SUPPORTEDTXNISOLEVELS property.</span></span> <span data-ttu-id="d47cc-114">Cette nouvelle valeur indique que le niveau d'isolement d'instantané est pris en charge, que le contrôle de version ait été activé sur la base de données ou non.</span><span class="sxs-lookup"><span data-stu-id="d47cc-114">This new value indicates that the snapshot isolation level is supported whether or not versioning has been enabled on the database.</span></span> <span data-ttu-id="d47cc-115">Voici une liste des valeurs DBPROP_SUPPORTEDTXNISOLEVELS :</span><span class="sxs-lookup"><span data-stu-id="d47cc-115">The following is a list of the DBPROP_SUPPORTEDTXNISOLEVELS values:</span></span>  
  
|<span data-ttu-id="d47cc-116">ID de propriété</span><span class="sxs-lookup"><span data-stu-id="d47cc-116">Property ID</span></span>|<span data-ttu-id="d47cc-117">Description</span><span class="sxs-lookup"><span data-stu-id="d47cc-117">Description</span></span>|  
|-----------------|-----------------|  
|<span data-ttu-id="d47cc-118">DBPROP_SUPPORTEDTXNISOLEVELS</span><span class="sxs-lookup"><span data-stu-id="d47cc-118">DBPROP_SUPPORTEDTXNISOLEVELS</span></span>|<span data-ttu-id="d47cc-119">Type : VT_I4</span><span class="sxs-lookup"><span data-stu-id="d47cc-119">Type: VT_I4</span></span><br /><br /> <span data-ttu-id="d47cc-120">Lecture/écriture : lecture seule</span><span class="sxs-lookup"><span data-stu-id="d47cc-120">R/W: Read only</span></span><br /><br /> <span data-ttu-id="d47cc-121">Description : masque de bits spécifiant les niveaux d'isolation de la transaction pris en charge.</span><span class="sxs-lookup"><span data-stu-id="d47cc-121">Description: A bitmask specifying the supported transaction isolation levels.</span></span> <span data-ttu-id="d47cc-122">Combinaison de zéro ou plusieurs des éléments suivants :</span><span class="sxs-lookup"><span data-stu-id="d47cc-122">A combination of zero or more of the following:</span></span><br /><br /> <span data-ttu-id="d47cc-123">-DBPROPVAL_TI_CHAOS</span><span class="sxs-lookup"><span data-stu-id="d47cc-123">-   DBPROPVAL_TI_CHAOS</span></span><br /><span data-ttu-id="d47cc-124">-DBPROPVAL_TI_READUNCOMMITTED</span><span class="sxs-lookup"><span data-stu-id="d47cc-124">-   DBPROPVAL_TI_READUNCOMMITTED</span></span><br /><span data-ttu-id="d47cc-125">-DBPROPVAL_TI_BROWSE</span><span class="sxs-lookup"><span data-stu-id="d47cc-125">-   DBPROPVAL_TI_BROWSE</span></span><br /><span data-ttu-id="d47cc-126">-DBPROPVAL_TI_CURSORSTABILITY</span><span class="sxs-lookup"><span data-stu-id="d47cc-126">-   DBPROPVAL_TI_CURSORSTABILITY</span></span><br /><span data-ttu-id="d47cc-127">-DBPROPVAL_TI_READCOMMITTED</span><span class="sxs-lookup"><span data-stu-id="d47cc-127">-   DBPROPVAL_TI_READCOMMITTED</span></span><br /><span data-ttu-id="d47cc-128">-DBPROPVAL_TI_REPEATABLEREAD</span><span class="sxs-lookup"><span data-stu-id="d47cc-128">-   DBPROPVAL_TI_REPEATABLEREAD</span></span><br /><span data-ttu-id="d47cc-129">-DBPROPVAL_TI_SERIALIZABLE</span><span class="sxs-lookup"><span data-stu-id="d47cc-129">-   DBPROPVAL_TI_SERIALIZABLE</span></span><br /><span data-ttu-id="d47cc-130">-DBPROPVAL_TI_ISOLATED</span><span class="sxs-lookup"><span data-stu-id="d47cc-130">-   DBPROPVAL_TI_ISOLATED</span></span><br /><span data-ttu-id="d47cc-131">-DBPROPVAL_TI_SNAPSHOT</span><span class="sxs-lookup"><span data-stu-id="d47cc-131">-   DBPROPVAL_TI_SNAPSHOT</span></span>|  
  
### <a name="dbpropset_session"></a><span data-ttu-id="d47cc-132">DBPROPSET_SESSION</span><span class="sxs-lookup"><span data-stu-id="d47cc-132">DBPROPSET_SESSION</span></span>  
 <span data-ttu-id="d47cc-133">Le jeu de propriétés DBPROPSET_SESSION a été modifié pour indiquer que le niveau d'isolement d'instantané est pris en charge par l'ajout de la valeur DBPROPVAL_TI_SNAPSHOT utilisée dans la propriété DBPROP_SESS_AUTOCOMMITISOLEVELS.</span><span class="sxs-lookup"><span data-stu-id="d47cc-133">The DBPROPSET_SESSION property set has been changed to indicate that the snapshot isolation level is supported by the addition of the DBPROPVAL_TI_SNAPSHOT value that is used in the DBPROP_SESS_AUTOCOMMITISOLEVELS property.</span></span> <span data-ttu-id="d47cc-134">Cette nouvelle valeur indique que le niveau d'isolement d'instantané est pris en charge, que le contrôle de version ait été activé sur la base de données ou non.</span><span class="sxs-lookup"><span data-stu-id="d47cc-134">This new value indicates that the snapshot isolation level is supported whether or not versioning has been enabled on the database.</span></span> <span data-ttu-id="d47cc-135">Voici une liste des valeurs DBPROP_SESS_AUTOCOMMITISOLEVELS :</span><span class="sxs-lookup"><span data-stu-id="d47cc-135">The following is a list of the DBPROP_SESS_AUTOCOMMITISOLEVELS values:</span></span>  
  
|<span data-ttu-id="d47cc-136">ID de propriété</span><span class="sxs-lookup"><span data-stu-id="d47cc-136">Property ID</span></span>|<span data-ttu-id="d47cc-137">Description</span><span class="sxs-lookup"><span data-stu-id="d47cc-137">Description</span></span>|  
|-----------------|-----------------|  
|<span data-ttu-id="d47cc-138">DBPROP_SESS_AUTOCOMMITISOLEVELS</span><span class="sxs-lookup"><span data-stu-id="d47cc-138">DBPROP_SESS_AUTOCOMMITISOLEVELS</span></span>|<span data-ttu-id="d47cc-139">Type : VT_I4</span><span class="sxs-lookup"><span data-stu-id="d47cc-139">Type: VT_I4</span></span><br /><br /> <span data-ttu-id="d47cc-140">Lecture/écriture : lecture seule</span><span class="sxs-lookup"><span data-stu-id="d47cc-140">R/W: Read only</span></span><br /><br /> <span data-ttu-id="d47cc-141">Description : spécifie un masque de bits qui indique le niveau d'isolation de la transaction lorsqu'elle se trouve en mode de validation automatique.</span><span class="sxs-lookup"><span data-stu-id="d47cc-141">Description: Specifies a bitmask that indicates the transaction isolation level while in auto-commit mode.</span></span> <span data-ttu-id="d47cc-142">Les valeurs pouvant être définies dans ce masque de bits sont les mêmes que celles qui peuvent être définies pour DBPROP_SUPPORTEDTXNISOLEVELS.</span><span class="sxs-lookup"><span data-stu-id="d47cc-142">The values that can be set in this bitmask are the same as those that can be set for DBPROP_SUPPORTEDTXNISOLEVELS.</span></span>|  
  
> [!NOTE]  
>  <span data-ttu-id="d47cc-143">Les erreurs DB_S_ERRORSOCCURRED ou DB_E_ERRORSOCCURRED se produisent si DBPROPVAL_TI_SNAPSHOT est défini dans le cadre de l'utilisation de versions de [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] antérieures à [!INCLUDE[ssVersion2005](../../../includes/ssversion2005-md.md)].</span><span class="sxs-lookup"><span data-stu-id="d47cc-143">The errors DB_S_ERRORSOCCURRED or DB_E_ERRORSOCCURRED will occur if DBPROPVAL_TI_SNAPSHOT is set when using versions of [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] earlier than [!INCLUDE[ssVersion2005](../../../includes/ssversion2005-md.md)].</span></span>  
  
 <span data-ttu-id="d47cc-144">Pour plus d'informations sur la prise en charge du niveau d'isolement d'instantané dans les transactions, consultez [Prise en charge des transactions locales](../../native-client-ole-db-transactions/transactions.md).</span><span class="sxs-lookup"><span data-stu-id="d47cc-144">For information about how snapshot isolation is supported in transactions, see [Supporting Local Transactions](../../native-client-ole-db-transactions/transactions.md).</span></span>  
  
## <a name="sql-server-native-client-odbc-driver"></a><span data-ttu-id="d47cc-145">Pilote ODBC SQL Server Native Client</span><span class="sxs-lookup"><span data-stu-id="d47cc-145">SQL Server Native Client ODBC Driver</span></span>  
 <span data-ttu-id="d47cc-146">Le [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] pilote ODBC Native Client prend en charge l’isolement d’instantané grâce aux améliorations apportées aux fonctions [SQLSetConnectAttr](../../native-client-odbc-api/sqlsetconnectattr.md) et [SQLGetInfo](../../native-client-odbc-api/sqlgetinfo.md) .</span><span class="sxs-lookup"><span data-stu-id="d47cc-146">The [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] Native Client ODBC driver provides support for snapshot isolation though enhancements made to the [SQLSetConnectAttr](../../native-client-odbc-api/sqlsetconnectattr.md) and [SQLGetInfo](../../native-client-odbc-api/sqlgetinfo.md) functions.</span></span>  
  
### <a name="sqlsetconnectattr"></a><span data-ttu-id="d47cc-147">SQLSetConnectAttr</span><span class="sxs-lookup"><span data-stu-id="d47cc-147">SQLSetConnectAttr</span></span>  
 <span data-ttu-id="d47cc-148">La fonction **SQLSetConnectAttr** prend désormais en charge l’utilisation de l’attribut SQL_COPT_SS_TXN_ISOLATION.</span><span class="sxs-lookup"><span data-stu-id="d47cc-148">The **SQLSetConnectAttr** function now supports the use of the SQL_COPT_SS_TXN_ISOLATION attribute.</span></span> <span data-ttu-id="d47cc-149">L'attribution de la valeur SQL_TXN_SS_SNAPSHOT à SQL_COPT_SS_TXN_ISOLATION indique que la transaction aura lieu avec le niveau d'isolement d'instantané.</span><span class="sxs-lookup"><span data-stu-id="d47cc-149">Setting SQL_COPT_SS_TXN_ISOLATION to SQL_TXN_SS_SNAPSHOT indicates that the transaction will take place under the snapshot isolation level.</span></span>  
  
### <a name="sqlgetinfo"></a><span data-ttu-id="d47cc-150">SQLGetInfo</span><span class="sxs-lookup"><span data-stu-id="d47cc-150">SQLGetInfo</span></span>  
 <span data-ttu-id="d47cc-151">La fonction [SQLGetInfo](../../native-client-odbc-api/sqlgetinfo.md) prend désormais en charge la valeur SQL_TXN_SS_SNAPSHOT ajoutée au type d’informations SQL_TXN_ISOLATION_OPTION.</span><span class="sxs-lookup"><span data-stu-id="d47cc-151">The [SQLGetInfo](../../native-client-odbc-api/sqlgetinfo.md) function now supports the SQL_TXN_SS_SNAPSHOT value that has been added to the SQL_TXN_ISOLATION_OPTION info type.</span></span>  
  
 <span data-ttu-id="d47cc-152">Pour plus d’informations sur la prise en charge de l’isolement d’instantané dans les transactions, consultez [niveau d’isolement des transactions de curseur](../../native-client-odbc-cursors/properties/cursor-transaction-isolation-level.md).</span><span class="sxs-lookup"><span data-stu-id="d47cc-152">For information about how snapshot isolation is supported in transactions, see [Cursor Transaction Isolation Level](../../native-client-odbc-cursors/properties/cursor-transaction-isolation-level.md).</span></span>  
  
## <a name="see-also"></a><span data-ttu-id="d47cc-153">Voir aussi</span><span class="sxs-lookup"><span data-stu-id="d47cc-153">See Also</span></span>  
 <span data-ttu-id="d47cc-154">[Fonctionnalités de SQL Server Native Client](sql-server-native-client-features.md) </span><span class="sxs-lookup"><span data-stu-id="d47cc-154">[SQL Server Native Client Features](sql-server-native-client-features.md) </span></span>  
 [<span data-ttu-id="d47cc-155">Propriétés et comportements de l’ensemble de lignes</span><span class="sxs-lookup"><span data-stu-id="d47cc-155">Rowset Properties and Behaviors</span></span>](../../native-client-ole-db-rowsets/rowset-properties-and-behaviors.md)  
  
  
