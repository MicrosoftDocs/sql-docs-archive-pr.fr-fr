---
title: Utilisation des notifications de requête | Microsoft Docs
ms.custom: ''
ms.date: 04/27/2017
ms.prod: sql-server-2014
ms.reviewer: ''
ms.technology: native-client
ms.topic: reference
helpviewer_keywords:
- data access [SQL Server Native Client], query notifications
- rowsets [SQL Server], notifications
- SQL Server Native Client, query notifications
- notifications [SQL Server Native Client]
- query notifications [SQL Server], SQL Server Native Client
- canceling rowset changes
- IRowsetNotify interface
- SQLNCLI, query notifications
- SQL Server Native Client OLE DB provider, query notifications
- consumer notification for rowset changes [SQL Server Native Client]
ms.assetid: 2f906fff-5ed9-4527-9fd3-9c0d27c3dff7
author: rothja
ms.author: jroth
ms.openlocfilehash: ba30bfc8df05a55e297ae8fcb8e2253de57e3ca6
ms.sourcegitcommit: ad4d92dce894592a259721a1571b1d8736abacdb
ms.translationtype: MT
ms.contentlocale: fr-FR
ms.lasthandoff: 08/04/2020
ms.locfileid: "87612264"
---
# <a name="working-with-query-notifications"></a><span data-ttu-id="e6c66-102">Utilisation de notifications de requêtes</span><span class="sxs-lookup"><span data-stu-id="e6c66-102">Working with Query Notifications</span></span>
  <span data-ttu-id="e6c66-103">Les notifications de requêtes ont été introduites dans [!INCLUDE[ssVersion2005](../../../includes/ssversion2005-md.md)] et [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] Native Client.</span><span class="sxs-lookup"><span data-stu-id="e6c66-103">Query notifications were introduced in [!INCLUDE[ssVersion2005](../../../includes/ssversion2005-md.md)] and [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] Native Client.</span></span> <span data-ttu-id="e6c66-104">Basées sur l'infrastructure de Service Broker introduite dans [!INCLUDE[ssVersion2005](../../../includes/ssversion2005-md.md)], les notifications de requêtes permettent aux applications d'être notifiées en cas de modification des données.</span><span class="sxs-lookup"><span data-stu-id="e6c66-104">Built upon the Service Broker infrastructure introduced in [!INCLUDE[ssVersion2005](../../../includes/ssversion2005-md.md)], query notifications allow applications to be notified when data has changed.</span></span> <span data-ttu-id="e6c66-105">Cette fonctionnalité est particulièrement utile pour les applications qui fournissent un cache d'informations à partir d'une base de données, par exemple une application Web, et qui doivent être notifiées en cas de modification des données sources.</span><span class="sxs-lookup"><span data-stu-id="e6c66-105">This feature is particularly useful for applications that provide a cache of information from a database, such as a Web application, and need to be notified when the source data is changed.</span></span>  
  
 <span data-ttu-id="e6c66-106">Les notifications de requêtes vous permettent de demander une notification dans un délai d'attente spécifié lorsque les données sous-jacentes d'une requête sont modifiées.</span><span class="sxs-lookup"><span data-stu-id="e6c66-106">Query notifications allow you to request notification within a specified time-out period when the underlying data of a query changes.</span></span> <span data-ttu-id="e6c66-107">La demande de notification spécifie les options de notification, notamment le nom du service, le texte du message et la valeur du délai d'attente au serveur.</span><span class="sxs-lookup"><span data-stu-id="e6c66-107">The request for notification specifies the notification options, which include the service name, message text, and time-out value to the server.</span></span> <span data-ttu-id="e6c66-108">Les notifications sont remises par l'intermédiaire d'une file d'attente Service Broker qui peut être interrogée par les applications pour détecter les notifications disponibles.</span><span class="sxs-lookup"><span data-stu-id="e6c66-108">Notifications are delivered through a Service Broker queue that applications may poll for available notifications.</span></span>  
  
 <span data-ttu-id="e6c66-109">La syntaxe de la chaîne des options de notifications de requêtes est :</span><span class="sxs-lookup"><span data-stu-id="e6c66-109">The syntax of the query notifications options string is:</span></span>  
  
 `service=<service-name>[;(local database=<database> | broker instance=<broker instance>)]`  
  
 <span data-ttu-id="e6c66-110">Par exemple :</span><span class="sxs-lookup"><span data-stu-id="e6c66-110">For example:</span></span>  
  
 `service=mySSBService;local database=mydb`  
  
 <span data-ttu-id="e6c66-111">La durée de vie des abonnements aux notifications est supérieure à celle des processus qui les initialisent. Cela s'explique par le fait qu'une application peut créer un abonnement aux notifications, puis se terminer.</span><span class="sxs-lookup"><span data-stu-id="e6c66-111">Notification subscriptions outlive the process that initiates them, as an application may create a notification subscription and then terminate.</span></span> <span data-ttu-id="e6c66-112">L'abonnement reste valide, et la notification a lieu si les données sont modifiées dans le délai d'attente imparti spécifié au moment de la création de l'abonnement.</span><span class="sxs-lookup"><span data-stu-id="e6c66-112">The subscription remains valid, and the notification will occur if the data changes within the time-out period specified when the subscription was created.</span></span> <span data-ttu-id="e6c66-113">Une notification est identifiée par la requête exécutée, les options de notification et le texte du message, et peut être annulée en attribuant la valeur 0 au délai d'attente.</span><span class="sxs-lookup"><span data-stu-id="e6c66-113">A notification is identified by the query executed, the notification options, and the message text, and may be cancelled by setting its time-out value to zero.</span></span>  
  
 <span data-ttu-id="e6c66-114">Les notifications sont envoyées une seule fois.</span><span class="sxs-lookup"><span data-stu-id="e6c66-114">Notifications are sent only once.</span></span> <span data-ttu-id="e6c66-115">Pour une notification continue des modifications de données, un nouvel abonnement doit être créé en exécutant à nouveau la requête une fois chaque notification traitée.</span><span class="sxs-lookup"><span data-stu-id="e6c66-115">For continuous notification of data change, a new subscription must be created by re-executing the query after each notification is processed.</span></span>  
  
 [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)]<span data-ttu-id="e6c66-116">En général, les applications clientes natives reçoivent des notifications à l’aide de la [!INCLUDE[tsql](../../../includes/tsql-md.md)] commande [Receive](/sql/t-sql/statements/receive-transact-sql) pour lire les notifications de la file d’attente associée au service spécifié dans les options de notification.</span><span class="sxs-lookup"><span data-stu-id="e6c66-116">Native Client applications typically receive notifications by using the [!INCLUDE[tsql](../../../includes/tsql-md.md)] [RECEIVE](/sql/t-sql/statements/receive-transact-sql) command to read notifications from the queue associated with the service specified in the notification options.</span></span>  
  
> [!NOTE]  
>  <span data-ttu-id="e6c66-117">Les noms de tables doivent être qualifiés dans des requêtes pour lesquelles une notification est requise, par exemple `dbo.myTable`.</span><span class="sxs-lookup"><span data-stu-id="e6c66-117">Table names must be qualified in queries for which notification is required, for example, `dbo.myTable`.</span></span> <span data-ttu-id="e6c66-118">Les noms de tables doivent être qualifiés avec des noms en deux parties.</span><span class="sxs-lookup"><span data-stu-id="e6c66-118">Table names must be qualified with two part names.</span></span> <span data-ttu-id="e6c66-119">L'abonnement n'est pas valide si des noms en trois ou quatre parties sont utilisés.</span><span class="sxs-lookup"><span data-stu-id="e6c66-119">Subscription is invalid if three- or four-part names are used.</span></span>  
  
 <span data-ttu-id="e6c66-120">L'infrastructure de notification repose sur une fonctionnalité de mise en file d'attente introduite dans [!INCLUDE[ssVersion2005](../../../includes/ssversion2005-md.md)].</span><span class="sxs-lookup"><span data-stu-id="e6c66-120">The notification infrastructure is built on top of a queuing feature introduced in [!INCLUDE[ssVersion2005](../../../includes/ssversion2005-md.md)].</span></span> <span data-ttu-id="e6c66-121">En général, les notifications générées au niveau du serveur sont envoyées par l'intermédiaire de ces files d'attente pour un traitement ultérieur.</span><span class="sxs-lookup"><span data-stu-id="e6c66-121">In general, notifications generated at the server are sent through these queues to be processed later.</span></span>  
  
 <span data-ttu-id="e6c66-122">Pour utiliser des notifications de requêtes, une file d'attente et un service doivent exister sur le serveur.</span><span class="sxs-lookup"><span data-stu-id="e6c66-122">To use query notifications a queue and a service must exist on the server.</span></span> <span data-ttu-id="e6c66-123">Vous pouvez les créer à l'aide d'une instruction [!INCLUDE[tsql](../../../includes/tsql-md.md)] semblable à la suivante :</span><span class="sxs-lookup"><span data-stu-id="e6c66-123">These can be created using [!INCLUDE[tsql](../../../includes/tsql-md.md)] similar to the following:</span></span>  
  
```  
CREATE QUEUE myQueue  
CREATE SERVICE myService ON QUEUE myQueue   
  
([https://schemas.microsoft.com/SQL/Notifications/PostQueryNotification])  
```  
  
> [!NOTE]  
>  <span data-ttu-id="e6c66-124">Le service doit utiliser le contrat prédéfini `https://schemas.microsoft.com/SQL/Notifications/PostQueryNotification`, comme indiqué plus haut.</span><span class="sxs-lookup"><span data-stu-id="e6c66-124">The service must use the predefined contract `https://schemas.microsoft.com/SQL/Notifications/PostQueryNotification` as shown above.</span></span>  
  
## <a name="sql-server-native-client-ole-db-provider"></a><span data-ttu-id="e6c66-125">Fournisseur OLE DB SQL Server Native Client</span><span class="sxs-lookup"><span data-stu-id="e6c66-125">SQL Server Native Client OLE DB Provider</span></span>  
 <span data-ttu-id="e6c66-126">Le [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] fournisseur OLE DB Native Client prend en charge la notification du consommateur sur la modification de l’ensemble de lignes.</span><span class="sxs-lookup"><span data-stu-id="e6c66-126">The [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] Native Client OLE DB provider supports consumer notification on rowset modification.</span></span> <span data-ttu-id="e6c66-127">Le consommateur reçoit la notification à chaque phase de la modification de l'ensemble de lignes et à chaque tentative de modification.</span><span class="sxs-lookup"><span data-stu-id="e6c66-127">The consumer receives notification at every phase of rowset modification and on any attempted change.</span></span>  
  
> [!NOTE]  
>  <span data-ttu-id="e6c66-128">Le passage d’une requête notifications au serveur avec **ICommand :: Execute** est la seule méthode valide pour s’abonner aux notifications de requête avec le [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] fournisseur OLE DB Native Client.</span><span class="sxs-lookup"><span data-stu-id="e6c66-128">Passing a notifications query to the server with **ICommand::Execute** is the only valid way to subscribe to query notifications with the [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] Native Client OLE DB provider.</span></span>  
  
### <a name="the-dbpropset_sqlserverrowset-property-set"></a><span data-ttu-id="e6c66-129">Le jeu de propriétés DBPROPSET_SQLSERVERROWSET</span><span class="sxs-lookup"><span data-stu-id="e6c66-129">The DBPROPSET_SQLSERVERROWSET Property Set</span></span>  
 <span data-ttu-id="e6c66-130">Afin de prendre en charge les notifications de requêtes par le biais de OLE DB, [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] Native Client ajoute les nouvelles propriétés suivantes au jeu de propriétés DBPROPSET_SQLSERVERROWSET.</span><span class="sxs-lookup"><span data-stu-id="e6c66-130">In order to support query notifications through OLE DB, [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] Native Client adds the following new properties to the DBPROPSET_SQLSERVERROWSET property set.</span></span>  
  
|<span data-ttu-id="e6c66-131">Nom</span><span class="sxs-lookup"><span data-stu-id="e6c66-131">Name</span></span>|<span data-ttu-id="e6c66-132">Type</span><span class="sxs-lookup"><span data-stu-id="e6c66-132">Type</span></span>|<span data-ttu-id="e6c66-133">Description</span><span class="sxs-lookup"><span data-stu-id="e6c66-133">Description</span></span>|  
|----------|----------|-----------------|  
|<span data-ttu-id="e6c66-134">SSPROP_QP_NOTIFICATION_TIMEOUT</span><span class="sxs-lookup"><span data-stu-id="e6c66-134">SSPROP_QP_NOTIFICATION_TIMEOUT</span></span>|<span data-ttu-id="e6c66-135">VT_UI4</span><span class="sxs-lookup"><span data-stu-id="e6c66-135">VT_UI4</span></span>|<span data-ttu-id="e6c66-136">Nombre de secondes pendant lesquelles la notification de requête doit rester active.</span><span class="sxs-lookup"><span data-stu-id="e6c66-136">The number of seconds that the query notification is to remain active.</span></span><br /><br /> <span data-ttu-id="e6c66-137">La valeur par défaut est 432 000 secondes (5 jours).</span><span class="sxs-lookup"><span data-stu-id="e6c66-137">The default is 432000 seconds (5 days).</span></span> <span data-ttu-id="e6c66-138">La valeur minimale est 1 seconde, et la valeur maximale est 2^31-1 secondes.</span><span class="sxs-lookup"><span data-stu-id="e6c66-138">The minimum value is 1 second, and the maximum value is 2^31-1 seconds.</span></span>|  
|<span data-ttu-id="e6c66-139">SSPROP_QP_NOTIFICATION_MSGTEXT</span><span class="sxs-lookup"><span data-stu-id="e6c66-139">SSPROP_QP_NOTIFICATION_MSGTEXT</span></span>|<span data-ttu-id="e6c66-140">VT_BSTR</span><span class="sxs-lookup"><span data-stu-id="e6c66-140">VT_BSTR</span></span>|<span data-ttu-id="e6c66-141">Texte du message de la notification.</span><span class="sxs-lookup"><span data-stu-id="e6c66-141">The message text of the notification.</span></span> <span data-ttu-id="e6c66-142">Il est défini par l'utilisateur et n'a aucun format prédéfini.</span><span class="sxs-lookup"><span data-stu-id="e6c66-142">This is user defined, and has no predefined format.</span></span><br /><br /> <span data-ttu-id="e6c66-143">Par défaut, la chaîne est vide.</span><span class="sxs-lookup"><span data-stu-id="e6c66-143">By default, the string is empty.</span></span> <span data-ttu-id="e6c66-144">Vous pouvez spécifier un message à l'aide de 1-2000 caractères.</span><span class="sxs-lookup"><span data-stu-id="e6c66-144">You can specify a message using 1-2000 characters.</span></span>|  
|<span data-ttu-id="e6c66-145">SSPROP_QP_NOTIFICATION_OPTIONS</span><span class="sxs-lookup"><span data-stu-id="e6c66-145">SSPROP_QP_NOTIFICATION_OPTIONS</span></span>|<span data-ttu-id="e6c66-146">VT_BSTR</span><span class="sxs-lookup"><span data-stu-id="e6c66-146">VT_BSTR</span></span>|<span data-ttu-id="e6c66-147">Options de notification de requêtes.</span><span class="sxs-lookup"><span data-stu-id="e6c66-147">The query notification options.</span></span> <span data-ttu-id="e6c66-148">Celles-ci sont spécifiées dans une chaîne avec la syntaxe de valeur de *nom* = *value* .</span><span class="sxs-lookup"><span data-stu-id="e6c66-148">These are specified in a string with *name*=*value* syntax.</span></span> <span data-ttu-id="e6c66-149">L'utilisateur est chargé de créer le service et de lire les notifications de la file d'attente.</span><span class="sxs-lookup"><span data-stu-id="e6c66-149">The user is responsible for creating the service and reading notifications off of the queue.</span></span><br /><br /> <span data-ttu-id="e6c66-150">La valeur par défaut est une chaîne vide.</span><span class="sxs-lookup"><span data-stu-id="e6c66-150">The default is an empty string.</span></span>|  
  
 <span data-ttu-id="e6c66-151">L'abonnement aux notifications est toujours validé, que l'instruction ait été exécutée dans une transaction utilisateur ou en mode de validation automatique, ou que la transaction dans laquelle l'instruction s'est exécutée ait été validée ou restaurée.</span><span class="sxs-lookup"><span data-stu-id="e6c66-151">The notification subscription is always committed, regardless of whether the statement ran in a user transaction or in auto commit or whether the transaction in which the statement ran committed or rolled back.</span></span> <span data-ttu-id="e6c66-152">La notification du serveur est déclenchée lorsque l'une des conditions de notification non valides suivantes se produit : modification des données sous-jacentes ou du schéma ou expiration du délai d'attente imparti (selon l'opération qui se produit en premier).</span><span class="sxs-lookup"><span data-stu-id="e6c66-152">The server notification fires upon any of the following invalid notification conditions: change of underlying data or schema, or when the timeout period is reached; whichever is first.</span></span> <span data-ttu-id="e6c66-153">Les inscriptions de notification sont supprimées dès qu'elles sont déclenchées.</span><span class="sxs-lookup"><span data-stu-id="e6c66-153">Notification registrations are deleted as soon as they are fired.</span></span> <span data-ttu-id="e6c66-154">Par conséquent, lorsque l'application reçoit des notifications, l'application doit encore s'abonner au cas où elle souhaiterait obtenir d'autres mises à jour.</span><span class="sxs-lookup"><span data-stu-id="e6c66-154">Hence upon receiving notifications, the application must subscribe again in case they want to get further updates.</span></span>  
  
 <span data-ttu-id="e6c66-155">Une autre connexion ou un autre thread peut vérifier la file d'attente de destination pour les notifications.</span><span class="sxs-lookup"><span data-stu-id="e6c66-155">Another connection or thread can check the destination queue for notifications.</span></span> <span data-ttu-id="e6c66-156">Par exemple :</span><span class="sxs-lookup"><span data-stu-id="e6c66-156">For example:</span></span>  
  
```  
WAITFOR (RECEIVE * FROM MyQueue);   // Where MyQueue is the queue name.   
```  
  
 <span data-ttu-id="e6c66-157">Notez que SELECT \* ne supprime pas l’entrée de la file d’attente, contrairement à RECEIVE \* FROM.</span><span class="sxs-lookup"><span data-stu-id="e6c66-157">Note that SELECT \* does not delete the entry from the Queue, however RECEIVE \* FROM does.</span></span> <span data-ttu-id="e6c66-158">Cela bloque un thread serveur si la file d'attente est vide.</span><span class="sxs-lookup"><span data-stu-id="e6c66-158">This stalls a server thread if the queue is empty.</span></span> <span data-ttu-id="e6c66-159">S'il existe des entrées de file d'attente au moment de l'appel, elles sont retournées immédiatement ; sinon, l'appel attend qu'une entrée de file d'attente soit soumise.</span><span class="sxs-lookup"><span data-stu-id="e6c66-159">If there are queue entries at the time of the call, they are returned immediately; otherwise the call waits until a queue entry is made.</span></span>  
  
```  
RECEIVE * FROM MyQueue  
```  
  
 <span data-ttu-id="e6c66-160">Cette instruction retourne immédiatement un jeu de résultats vide si la file d'attente est vide ; sinon, elle retourne toutes les notifications de la file d'attente.</span><span class="sxs-lookup"><span data-stu-id="e6c66-160">This statement immediately returns an empty result set if the queue is empty; otherwise it returns all queue notifications.</span></span>  
  
 <span data-ttu-id="e6c66-161">Si SSPROP_QP_NOTIFICATION_MSGTEXT et SSPROP_QP_NOTIFICATION_OPTIONS ne sont pas NULL et ne sont pas vides, l'en-tête TDS de notifications de requêtes contenant les trois propriétés définies plus haut sont envoyées au serveur avec chaque exécution de la commande.</span><span class="sxs-lookup"><span data-stu-id="e6c66-161">If SSPROP_QP_NOTIFICATION_MSGTEXT and SSPROP_QP_NOTIFICATION_OPTIONS are non-NULL and non-empty, the query notifications TDS header containing the three properties defined above are sent to the server with each execution of the command.</span></span> <span data-ttu-id="e6c66-162">Si l'un d'eux est NULL (ou vide), l'en-tête n'est pas envoyé et DB_E_ERRORSOCCURRED est déclenché (ou DB_S_ERRORSOCCURRED si les propriétés sont toutes deux marquées comme étant facultatives) et la valeur d'état est DBPROPSTATUS_BADVALUE.</span><span class="sxs-lookup"><span data-stu-id="e6c66-162">If either of them is null (or empty), the header is not sent and DB_E_ERRORSOCCURRED is raised, (or DB_S_ERRORSOCCURRED if the properties are both marked as optional), and the status value is set to DBPROPSTATUS_BADVALUE.</span></span> <span data-ttu-id="e6c66-163">La validation se produit dans la phase de préparation et d'exécution.</span><span class="sxs-lookup"><span data-stu-id="e6c66-163">The validation occurs on Execute/Prepare.</span></span> <span data-ttu-id="e6c66-164">De la même façon, DB_S_ERRORSOCCURED est déclenché quand les propriétés de notification de requête sont définies pour les connexions sur les versions [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] avant [!INCLUDE[ssVersion2005](../../../includes/ssversion2005-md.md)]</span><span class="sxs-lookup"><span data-stu-id="e6c66-164">Similarly, DB_S_ERRORSOCCURED is raised when the query notification properties are set for connections to [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] versions before [!INCLUDE[ssVersion2005](../../../includes/ssversion2005-md.md)].</span></span> <span data-ttu-id="e6c66-165">La valeur d'état dans ce cas est DBPROPSTATUS_NOTSUPPORTED.</span><span class="sxs-lookup"><span data-stu-id="e6c66-165">The status value in this case is DBPROPSTATUS_NOTSUPPORTED.</span></span>  
  
 <span data-ttu-id="e6c66-166">L'initialisation d'un abonnement ne garantit pas que les messages suivants soient correctement remis.</span><span class="sxs-lookup"><span data-stu-id="e6c66-166">Initiating a subscription does not guarantee that subsequent messages will be successfully delivered.</span></span> <span data-ttu-id="e6c66-167">De plus, aucun contrôle n'est effectué en termes de validité du nom du service spécifié.</span><span class="sxs-lookup"><span data-stu-id="e6c66-167">In addition, no check is made as to the validity of the service name specified.</span></span>  
  
> [!NOTE]  
>  <span data-ttu-id="e6c66-168">La préparation d'instructions ne provoque jamais l'initialisation de l'abonnement ; seule l'exécution d'instructions peut y parvenir et les notifications de requêtes ne sont pas concernées par l'utilisation des services principaux OLE DB.</span><span class="sxs-lookup"><span data-stu-id="e6c66-168">Preparing statements will never cause the subscription to be initiated; only statement execution will achieve this and query notifications are not impacted by the use of OLE DB core services.</span></span>  
  
 <span data-ttu-id="e6c66-169">Pour plus d’informations sur le jeu de propriétés DBPROPSET_SQLSERVERROWSET, consultez [Propriétés et comportements](../../native-client-ole-db-rowsets/rowset-properties-and-behaviors.md)de l’ensemble de lignes.</span><span class="sxs-lookup"><span data-stu-id="e6c66-169">For more information about the DBPROPSET_SQLSERVERROWSET property set, see [Rowset Properties and Behaviors](../../native-client-ole-db-rowsets/rowset-properties-and-behaviors.md).</span></span>  
  
## <a name="sql-server-native-client-odbc-driver"></a><span data-ttu-id="e6c66-170">Pilote ODBC SQL Server Native Client</span><span class="sxs-lookup"><span data-stu-id="e6c66-170">SQL Server Native Client ODBC Driver</span></span>  
 <span data-ttu-id="e6c66-171">Le [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] pilote ODBC Native Client prend en charge les notifications de requêtes par le biais de l’ajout de trois nouveaux attributs aux fonctions [SQLGetStmtAttr](../../native-client-odbc-api/sqlgetstmtattr.md) et [SQLSetStmtAttr](../../native-client-odbc-api/sqlsetstmtattr.md) :</span><span class="sxs-lookup"><span data-stu-id="e6c66-171">The [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] Native Client ODBC driver supports query notifications through the addition of three new attributes to the [SQLGetStmtAttr](../../native-client-odbc-api/sqlgetstmtattr.md) and [SQLSetStmtAttr](../../native-client-odbc-api/sqlsetstmtattr.md) functions:</span></span>  
  
-   <span data-ttu-id="e6c66-172">SQL_SOPT_SS_QUERYNOTIFICATION_MSGTEXT</span><span class="sxs-lookup"><span data-stu-id="e6c66-172">SQL_SOPT_SS_QUERYNOTIFICATION_MSGTEXT</span></span>  
  
-   <span data-ttu-id="e6c66-173">SQL_SOPT_SS_QUERYNOTIFICATION_OPTIONS</span><span class="sxs-lookup"><span data-stu-id="e6c66-173">SQL_SOPT_SS_QUERYNOTIFICATION_OPTIONS</span></span>  
  
-   <span data-ttu-id="e6c66-174">SQL_SOPT_SS_QUERYNOTIFICATION_TIMEOUT</span><span class="sxs-lookup"><span data-stu-id="e6c66-174">SQL_SOPT_SS_QUERYNOTIFICATION_TIMEOUT</span></span>  
  
 <span data-ttu-id="e6c66-175">Si SQL_SOPT_SS_QUERYNOTIFICATION_MSGTEXT et SQL_SOPT_SS_QUERYNOTIFICATION_OPTIONS ne sont pas NULL, l'en-tête TDS de notifications de requêtes contenant les trois attributs définis plus haut sera envoyé au serveur chaque fois que la commande est exécutée.</span><span class="sxs-lookup"><span data-stu-id="e6c66-175">If SQL_SOPT_SS_QUERYNOTIFICATION_MSGTEXT and SQL_SOPT_SS_QUERYNOTIFICATION_OPTIONS are not NULL, the query notifications TDS header containing the three attributes defined above will be sent to the server each time the command is executed.</span></span> <span data-ttu-id="e6c66-176">Si l'un d'eux est Null, l'en-tête n'est pas envoyé, et SQL_SUCCESS_WITH_INFO est retourné.</span><span class="sxs-lookup"><span data-stu-id="e6c66-176">If either of them is null, the header is not sent, and SQL_SUCCESS_WITH_INFO is returned.</span></span> <span data-ttu-id="e6c66-177">La validation se produit sur les [fonctions SQLPrepare](https://go.microsoft.com/fwlink/?LinkId=59360), **SqlExecDirect**et **SQLExecute**, qui échouent toutes si les attributs ne sont pas valides.</span><span class="sxs-lookup"><span data-stu-id="e6c66-177">The validation occurs on [SQLPrepare Function](https://go.microsoft.com/fwlink/?LinkId=59360), **SqlExecDirect**, and **SqlExecute**, all of which fail if the attributes are not valid.</span></span> <span data-ttu-id="e6c66-178">De la même façon, lorsque ces attributs de notification de requête sont définis pour les versions de [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] antérieures à [!INCLUDE[ssVersion2005](../../../includes/ssversion2005-md.md)], l'exécution échoue avec SQL_SUCCESS_WITH_INFO.</span><span class="sxs-lookup"><span data-stu-id="e6c66-178">Similarly, when these query notification attributes are set for [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] versions before [!INCLUDE[ssVersion2005](../../../includes/ssversion2005-md.md)], the execution fails with SQL_SUCCESS_WITH_INFO.</span></span>  
  
> [!NOTE]  
>  <span data-ttu-id="e6c66-179">La préparation d'instructions ne provoque jamais l'initialisation de l'abonnement ; l'abonnement peut être initialisé par l'exécution d'instructions.</span><span class="sxs-lookup"><span data-stu-id="e6c66-179">Prepare statements will never cause the subscription to be initiated; subscription can be initiated by statement execution.</span></span>  
  
## <a name="special-cases-and-restrictions"></a><span data-ttu-id="e6c66-180">Cas particuliers et restrictions</span><span class="sxs-lookup"><span data-stu-id="e6c66-180">Special Cases and Restrictions</span></span>  
 <span data-ttu-id="e6c66-181">Les types de données suivants ne sont pas pris en charge pour les notifications :</span><span class="sxs-lookup"><span data-stu-id="e6c66-181">The following data types are not supported for notifications:</span></span>  
  
-   `text`  
  
-   `ntext`  
  
-   `image`  
  
 <span data-ttu-id="e6c66-182">Si une demande de notification est soumise pour une requête qui retourne l'un de ces types, la notification se déclenche immédiatement en spécifiant que l'abonnement aux notifications n'était pas possible.</span><span class="sxs-lookup"><span data-stu-id="e6c66-182">If a notification request is made for a query which returns any of these types, the notification fires immediately, specifying that notification subscription was not possible.</span></span>  
  
 <span data-ttu-id="e6c66-183">Si une demande d'abonnement est soumise pour un lot ou une procédure stockée, une demande d'abonnement séparée est soumise pour chaque instruction exécutée dans le traitement ou la procédure stockée.</span><span class="sxs-lookup"><span data-stu-id="e6c66-183">If a subscription request is made for a batch or stored procedure, a separate subscription request is made for each statement executed within the batch or stored procedure.</span></span> <span data-ttu-id="e6c66-184">Les instructions EXECUTE n'inscrivent aucune notification mais la demande de notification est envoyée à la commande exécutée.</span><span class="sxs-lookup"><span data-stu-id="e6c66-184">EXECUTE statements will not register a notification, but will send the notification request to the executed command.</span></span> <span data-ttu-id="e6c66-185">S'il s'agit d'un lot, le contexte est appliqué aux instructions exécutées et les mêmes règles décrites ci-dessus sont appliquées.</span><span class="sxs-lookup"><span data-stu-id="e6c66-185">If it is a batch, the context will be applied to the executed statements and the same rules described above apply.</span></span>  
  
 <span data-ttu-id="e6c66-186">La soumission d’une requête pour notification qui a été envoyée par le même utilisateur sous le même contexte de base de données et qui a le même modèle, les mêmes valeurs de paramètre, le même ID de notification et l’emplacement de remise d’un abonnement actif existant, renouvelle l’abonnement existant, en réinitialisant le nouveau délai d’attente spécifié. Cela signifie que si une notification est demandée pour des requêtes identiques, une seule notification est envoyée.</span><span class="sxs-lookup"><span data-stu-id="e6c66-186">Submission of a query for notification that was submitted by the same user under the same database context and has the same template, same parameter values, same notification ID, and same delivery location of an existing active subscription, will renew the existing subscription, resetting the new specified time-out. This means that if notification is requested for identical queries, only one notification will be sent.</span></span> <span data-ttu-id="e6c66-187">Cette situation concerne une requête dupliquée dans un lot ou une requête dans une procédure stockée qui a été appelée plusieurs fois.</span><span class="sxs-lookup"><span data-stu-id="e6c66-187">This would apply to a query duplicated in a batch, or a query in a stored procedure that was called multiple times.</span></span>  
  
## <a name="see-also"></a><span data-ttu-id="e6c66-188">Voir aussi</span><span class="sxs-lookup"><span data-stu-id="e6c66-188">See Also</span></span>  
 [<span data-ttu-id="e6c66-189">Fonctionnalités de SQL Server Native Client</span><span class="sxs-lookup"><span data-stu-id="e6c66-189">SQL Server Native Client Features</span></span>](sql-server-native-client-features.md)  
  
  
