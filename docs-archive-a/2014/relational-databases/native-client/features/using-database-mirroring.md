---
title: Utilisation de la mise en miroir de bases de données | Microsoft Docs
ms.custom: ''
ms.date: 03/08/2017
ms.prod: sql-server-2014
ms.reviewer: ''
ms.technology: native-client
ms.topic: reference
helpviewer_keywords:
- database mirroring [SQL Server], interoperability
- SQL Server Native Client, database mirroring
- data access [SQL Server Native Client], database mirroring
- database mirroring [SQL Server], connecting clients to
- SQLNCLI, database mirroring
- SQL Server Native Client ODBC driver, database mirroring
- SQL Server Native Client OLE DB provider, database mirroring
ms.assetid: 71b15712-7972-4465-9274-e0ddc271eedc
author: rothja
ms.author: jroth
ms.openlocfilehash: 389036322137abcc9a40e36c697e8d45e39a7de5
ms.sourcegitcommit: ad4d92dce894592a259721a1571b1d8736abacdb
ms.translationtype: MT
ms.contentlocale: fr-FR
ms.lasthandoff: 08/04/2020
ms.locfileid: "87602106"
---
# <a name="using-database-mirroring"></a><span data-ttu-id="25edf-102">Utilisation de la mise en miroir de bases de données</span><span class="sxs-lookup"><span data-stu-id="25edf-102">Using Database Mirroring</span></span>
    
> [!NOTE]  
>  [!INCLUDE[ssNoteDepFutureAvoid](../../../includes/ssnotedepfutureavoid-md.md)] <span data-ttu-id="25edf-103">Utilisez [!INCLUDE[ssHADR](../../../includes/sshadr-md.md)] à la place.</span><span class="sxs-lookup"><span data-stu-id="25edf-103">Use [!INCLUDE[ssHADR](../../../includes/sshadr-md.md)] instead.</span></span>  
  
 <span data-ttu-id="25edf-104">La mise en miroir de bases de données, introduite dans [!INCLUDE[ssVersion2005](../../../includes/ssversion2005-md.md)], est une solution permettant d'accroître la disponibilité de la base de données et la redondance des données.</span><span class="sxs-lookup"><span data-stu-id="25edf-104">Database mirroring, introduced in [!INCLUDE[ssVersion2005](../../../includes/ssversion2005-md.md)], is a solution for increasing database availability and data redundancy.</span></span> [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)]<span data-ttu-id="25edf-105">Native Client fournit une prise en charge implicite de la mise en miroir de bases de données, de sorte que le développeur n’a pas besoin d’écrire du code ou d’effectuer une autre action une fois qu’il a été configuré pour la base de données.</span><span class="sxs-lookup"><span data-stu-id="25edf-105">Native Client provides implicit support for database mirroring, so the developer does not need to write any code or take any other action once it has been configured for the database.</span></span>  
  
 <span data-ttu-id="25edf-106">La mise en miroir de bases de données, implémentée pour chaque base de données, conserve une copie d’une base de données de production [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] sur un serveur de secours.</span><span class="sxs-lookup"><span data-stu-id="25edf-106">Database mirroring, which is implemented on a per-database basis, keeps a copy of a [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] production database on a standby server.</span></span> <span data-ttu-id="25edf-107">Ce serveur est un serveur de secours automatique ou semi-automatique, selon la configuration et l'état de la session de mise en miroir de bases de données.</span><span class="sxs-lookup"><span data-stu-id="25edf-107">This server is either a hot or warm standby server, depending on the configuration and state of the database mirroring session.</span></span> <span data-ttu-id="25edf-108">Un serveur de secours automatique prend en charge le basculement rapide sans perte de transactions validées et un serveur de secours semi-automatique prend en charge le service forcé (avec perte de données possible).</span><span class="sxs-lookup"><span data-stu-id="25edf-108">A hot standby server supports rapid failover with no loss of committed transactions, and a warm standby server supports forcing service (with possible data loss).</span></span>  
  
 <span data-ttu-id="25edf-109">La base de données de production est appelée *base de données principale* et la copie de secours est appelée *base de données miroir*.</span><span class="sxs-lookup"><span data-stu-id="25edf-109">The production database is called the *principal database*, and the standby copy is called the *mirror database*.</span></span> <span data-ttu-id="25edf-110">La base de données principale et la base de données miroir doivent résider sur des instances distinctes de [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] (instances de serveur) et, si possible, sur des ordinateurs différents.</span><span class="sxs-lookup"><span data-stu-id="25edf-110">The principal database and mirror database must reside on separate instances of [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] (server instances), and they should reside on separate computers if possible.</span></span>  
  
 <span data-ttu-id="25edf-111">L’instance de serveur de production, appelée *serveur principal*, communique avec l’instance de serveur de secours, appelée *serveur miroir*.</span><span class="sxs-lookup"><span data-stu-id="25edf-111">The production server instance, called the *principal server*, communicates with the standby server instance, called the *mirror server*.</span></span> <span data-ttu-id="25edf-112">Les serveurs principal et miroir jouent le rôle de partenaires dans une *session*de mise en miroir de bases de données.</span><span class="sxs-lookup"><span data-stu-id="25edf-112">The principal and mirror servers act as partners within a database mirroring *session*.</span></span> <span data-ttu-id="25edf-113">En cas d’échec du serveur principal, le serveur miroir peut créer sa base de données dans la base de données principale grâce à un processus appelé *basculement*.</span><span class="sxs-lookup"><span data-stu-id="25edf-113">If the principal server fails, the mirror server can make its database into the principal database through a process called *failover*.</span></span> <span data-ttu-id="25edf-114">Par exemple, Partner_A et Partner_B sont deux serveurs partenaires, avec initialement la base de données principale sur Partner_A comme serveur principal et la base de données miroir sur Partner_B comme serveur miroir.</span><span class="sxs-lookup"><span data-stu-id="25edf-114">For example, Partner_A and Partner_B are two partner servers, with the principal database initially on Partner_A as principal server, and the mirror database residing on Partner_B as the mirror server.</span></span> <span data-ttu-id="25edf-115">Si Partner_A se retrouve hors connexion, la base de données sur Partner_B peut basculer pour devenir la base de données principale en cours.</span><span class="sxs-lookup"><span data-stu-id="25edf-115">If Partner_A goes offline, the database on Partner_B can fail over to become the current principal database.</span></span> <span data-ttu-id="25edf-116">Lorsque Partner_A rejoint la session de mise en miroir, il devient le serveur miroir et sa base de données devient la base de données miroir.</span><span class="sxs-lookup"><span data-stu-id="25edf-116">When Partner_A rejoins the mirroring session, it becomes the mirror server and its database becomes the mirror database.</span></span>  
  
 <span data-ttu-id="25edf-117">D'autres configurations de mise en miroir de bases de données offrent des niveaux différents de performances et de sécurité des données, et prennent en charge diverses formes de basculement.</span><span class="sxs-lookup"><span data-stu-id="25edf-117">Alternative database mirroring configurations offer different levels of performance and data safety, and support different forms of failover.</span></span> <span data-ttu-id="25edf-118">Pour plus d’informations, consultez [Mise en miroir de bases de données &#40;SQL Server&#41;](../../../database-engine/database-mirroring/database-mirroring-sql-server.md).</span><span class="sxs-lookup"><span data-stu-id="25edf-118">For more information, see [Database Mirroring &#40;SQL Server&#41;](../../../database-engine/database-mirroring/database-mirroring-sql-server.md).</span></span>  
  
 <span data-ttu-id="25edf-119">Il est possible d'utiliser un alias lors de la spécification du nom d'une base de données miroir.</span><span class="sxs-lookup"><span data-stu-id="25edf-119">It is possible to use an alias when specifying the mirror database name.</span></span>  
  
> [!NOTE]  
>  <span data-ttu-id="25edf-120">Pour plus d'informations sur les tentatives de connexion initiale et de reconnexion à une base de données mise en miroir, consultez [Connecter des clients à une session de mise en miroir de bases de données &#40;SQL Server&#41;](../../../database-engine/database-mirroring/connect-clients-to-a-database-mirroring-session-sql-server.md).</span><span class="sxs-lookup"><span data-stu-id="25edf-120">For information about initial connection attempts and reconnection attempts to a mirrored database, see [Connect Clients to a Database Mirroring Session &#40;SQL Server&#41;](../../../database-engine/database-mirroring/connect-clients-to-a-database-mirroring-session-sql-server.md).</span></span>  
  
## <a name="programming-considerations"></a><span data-ttu-id="25edf-121">Éléments de programmation à prendre en considération</span><span class="sxs-lookup"><span data-stu-id="25edf-121">Programming Considerations</span></span>  
 <span data-ttu-id="25edf-122">Lorsque le serveur de la base de données principale échoue, l'application cliente reçoit des erreurs en réponse aux appels d'API, erreurs qui signifient que la connexion à la base de données a été perdue.</span><span class="sxs-lookup"><span data-stu-id="25edf-122">When the principal database server fails, the client application receives errors in response to API calls, which indicate that the connection to the database has been lost.</span></span> <span data-ttu-id="25edf-123">Lorsque cela se produit, toutes les modifications apportées à la base de données qui n'ont pas été validées sont perdues et la transaction en cours est annulée.</span><span class="sxs-lookup"><span data-stu-id="25edf-123">When this happens, any uncommitted changes to the database are lost and the current transaction is rolled back.</span></span> <span data-ttu-id="25edf-124">Si cela se produit, l'application doit fermer la connexion (ou libérer l'objet source de données) et la rouvrir.</span><span class="sxs-lookup"><span data-stu-id="25edf-124">If this occurs, the application should close the connection (or release the data source object) and re-open it.</span></span> <span data-ttu-id="25edf-125">La connexion est redirigée de façon transparente vers la base de données miroir, qui fait désormais office de serveur principal.</span><span class="sxs-lookup"><span data-stu-id="25edf-125">The connection is transparently re-directed to the mirror database, which now acts as the principal server.</span></span>  
  
 <span data-ttu-id="25edf-126">Lorsqu'une connexion est établie, le serveur principal envoie au client l'identité de son partenaire de basculement à utiliser en cas de basculement.</span><span class="sxs-lookup"><span data-stu-id="25edf-126">When a connection is established, the principal server sends the identity of its failover partner to the client to be used when failover occurs.</span></span> <span data-ttu-id="25edf-127">Si une application a essayé d'établir une connexion après un échec du serveur principal, le client ne connaît pas l'identité du partenaire de basculement.</span><span class="sxs-lookup"><span data-stu-id="25edf-127">Where an application tried to establish a connection after the principal server failed, the client does not know the identity of the failover partner.</span></span> <span data-ttu-id="25edf-128">Afin que les clients puissent faire face à ce scénario, une propriété d'initialisation et un mot clé de chaîne de connexion associé permettent au client de spécifier l'identité du partenaire de basculement.</span><span class="sxs-lookup"><span data-stu-id="25edf-128">To allow clients the opportunity to cope with this scenario, an initialization property and an associated connection string keyword allow the client to specify the identity of the failover partner on its own.</span></span> <span data-ttu-id="25edf-129">L'attribut client est utilisé uniquement dans ce scénario ; si le serveur principal est disponible, il n'est pas utilisé.</span><span class="sxs-lookup"><span data-stu-id="25edf-129">The client attribute is used only in this scenario; if the principal server is available, it is not used.</span></span> <span data-ttu-id="25edf-130">Si le partenaire de basculement fourni par le client ne fait pas référence à un serveur agissant comme partenaire de basculement, la connexion est refusée par le serveur.</span><span class="sxs-lookup"><span data-stu-id="25edf-130">If the failover partner server supplied by the client does not refer to a server acting as a failover partner, the connection is refused by the server.</span></span> <span data-ttu-id="25edf-131">Pour permettre aux applications de s'adapter aux modifications de configuration, l'identité du partenaire de basculement peut être déterminée en examinant l'attribut après que la connexion a été établie.</span><span class="sxs-lookup"><span data-stu-id="25edf-131">To allow applications to adapt to configuration changes, the identity of the actual failover partner can be determined by inspecting the attribute after the connection has been established.</span></span> <span data-ttu-id="25edf-132">Si possible, mettez en cache les informations sur le serveur partenaire pour mettre à jour la chaîne de connexion ou imaginer une stratégie de nouvelle tentative au cas où la première tentative d'établissement de la connexion échouerait.</span><span class="sxs-lookup"><span data-stu-id="25edf-132">You should consider caching the partner information to update the connection string or devise a retry strategy in the event that the first attempt at making a connection fails.</span></span>  
  
> [!NOTE]  
>  <span data-ttu-id="25edf-133">Vous devez spécifier explicitement la base de données utilisée par une connexion si vous souhaitez recourir à cette fonctionnalité dans un DSN, une chaîne de connexion ou une propriété (ou un attribut) de connexion.</span><span class="sxs-lookup"><span data-stu-id="25edf-133">You must explicitly specify the database to be used by a connection if you want to use this feature in a DSN, connection string, or connection property/attribute.</span></span> <span data-ttu-id="25edf-134">Si vous ne le faites pas, [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] Native Client ne tente pas de basculer sur la base de données du serveur partenaire.</span><span class="sxs-lookup"><span data-stu-id="25edf-134">[!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] Native Client will not attempt to failover to the partner database if this is not done.</span></span>  
>   
>  <span data-ttu-id="25edf-135">La mise en miroir est une fonctionnalité de la base de données.</span><span class="sxs-lookup"><span data-stu-id="25edf-135">Mirroring is a feature of the database.</span></span> <span data-ttu-id="25edf-136">Il se peut que les applications qui utilisent plusieurs bases de données ne puissent pas exploiter cette fonctionnalité.</span><span class="sxs-lookup"><span data-stu-id="25edf-136">Applications that use multiple databases might not be able to exploit this feature.</span></span>  
>   
>  <span data-ttu-id="25edf-137">De plus, les noms de serveur ne respectent pas la casse, contrairement aux noms de base de données.</span><span class="sxs-lookup"><span data-stu-id="25edf-137">In addition, server names are case insensitive, but database names are case sensitive.</span></span> <span data-ttu-id="25edf-138">Par conséquent, vous devez vous assurer que vous utilisez la même casse dans les DSN et les chaînes de connexion.</span><span class="sxs-lookup"><span data-stu-id="25edf-138">You should therefore make sure that you use the same casing in DSNs and connection strings.</span></span>  
  
## <a name="sql-server-native-client-ole-db-provider"></a><span data-ttu-id="25edf-139">Fournisseur OLE DB SQL Server Native Client</span><span class="sxs-lookup"><span data-stu-id="25edf-139">SQL Server Native Client OLE DB Provider</span></span>  
 <span data-ttu-id="25edf-140">Le [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] fournisseur OLE DB Native Client prend en charge la mise en miroir de bases de données via les attributs de connexion et de chaîne de connexion.</span><span class="sxs-lookup"><span data-stu-id="25edf-140">The [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] Native Client OLE DB provider supports database mirroring through connection and connection string attributes.</span></span> <span data-ttu-id="25edf-141">La propriété SSPROP_INIT_FAILOVERPARTNER a été ajoutée à la propriété DBPROPSET_SQLSERVERDBINIT définie et le mot clé `FailoverPartner` est un nouvel attribut de chaîne de connexion de DBPROP_INIT_PROVIDERSTRING.</span><span class="sxs-lookup"><span data-stu-id="25edf-141">The SSPROP_INIT_FAILOVERPARTNER property has been added to the DBPROPSET_SQLSERVERDBINIT property set, and the `FailoverPartner` keyword is a new connection string attribute for DBPROP_INIT_PROVIDERSTRING.</span></span> <span data-ttu-id="25edf-142">Pour plus d’informations, consultez [utilisation de mots clés de chaîne de connexion avec SQL Server Native Client](../applications/using-connection-string-keywords-with-sql-server-native-client.md).</span><span class="sxs-lookup"><span data-stu-id="25edf-142">For more information, see [Using Connection String Keywords with SQL Server Native Client](../applications/using-connection-string-keywords-with-sql-server-native-client.md).</span></span>  
  
 <span data-ttu-id="25edf-143">Le cache de basculement est conservé tant que le fournisseur est chargé, ce qui est jusqu’à ce que **CoUninitialize** soit appelé ou que l’application ait une référence à un objet géré par le [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] fournisseur de OLE DB Native Client, tel qu’un objet de source de données.</span><span class="sxs-lookup"><span data-stu-id="25edf-143">The failover cache is maintained as long as the provider is loaded, which is until **CoUninitialize** is called or as long as the application has a reference to some object managed by the [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] Native Client OLE DB provider such as a data source object.</span></span>  
  
 <span data-ttu-id="25edf-144">Pour plus d’informations sur [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] la prise en charge du fournisseur OLE DB Native Client pour la mise en miroir de bases de données, consultez [propriétés d’initialisation et d’autorisation](../../native-client-ole-db-data-source-objects/initialization-and-authorization-properties.md).</span><span class="sxs-lookup"><span data-stu-id="25edf-144">For details about [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] Native Client OLE DB provider support for database mirroring, see [Initialization and Authorization Properties](../../native-client-ole-db-data-source-objects/initialization-and-authorization-properties.md).</span></span>  
  
## <a name="sql-server-native-client-odbc-driver"></a><span data-ttu-id="25edf-145">Pilote ODBC SQL Server Native Client</span><span class="sxs-lookup"><span data-stu-id="25edf-145">SQL Server Native Client ODBC Driver</span></span>  
 <span data-ttu-id="25edf-146">Le [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] pilote ODBC Native Client prend en charge la mise en miroir de bases de données via les attributs de connexion et de chaîne de connexion.</span><span class="sxs-lookup"><span data-stu-id="25edf-146">The [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] Native Client ODBC driver supports database mirroring through connection and connection string attributes.</span></span> <span data-ttu-id="25edf-147">Plus précisément, l’attribut SQL_COPT_SS_FAILOVER_PARTNER a été ajouté pour être utilisé avec les fonctions [SQLSetConnectAttr](../../native-client-odbc-api/sqlsetconnectattr.md) et [SQLGetConnectAttr](../../native-client-odbc-api/sqlgetconnectattr.md) . et le `Failover_Partner` mot clé a été ajouté en tant que nouvel attribut de chaîne de connexion.</span><span class="sxs-lookup"><span data-stu-id="25edf-147">Specifically, the SQL_COPT_SS_FAILOVER_PARTNER attribute has been added for use with the [SQLSetConnectAttr](../../native-client-odbc-api/sqlsetconnectattr.md) and [SQLGetConnectAttr](../../native-client-odbc-api/sqlgetconnectattr.md) functions; and the `Failover_Partner` keyword has been added as a new connection string attribute.</span></span>  
  
 <span data-ttu-id="25edf-148">Le cache de basculement est conservé tant que l'application possède au moins un handle d'environnement alloué.</span><span class="sxs-lookup"><span data-stu-id="25edf-148">The failover cache is maintained as long as the application has at least one environment handle allocated.</span></span> <span data-ttu-id="25edf-149">En revanche, il est perdu lorsque le dernier handle d'environnement est libéré.</span><span class="sxs-lookup"><span data-stu-id="25edf-149">Conversely, it is lost when the last environment handle is deallocated.</span></span>  
  
> [!NOTE]  
>  <span data-ttu-id="25edf-150">Le Gestionnaire de pilotes ODBC a été amélioré pour prendre en charge la spécification du nom du serveur de basculement.</span><span class="sxs-lookup"><span data-stu-id="25edf-150">The ODBC Driver Manager has been enhanced to support the specification of the failover server name.</span></span>  
  
## <a name="see-also"></a><span data-ttu-id="25edf-151">Voir aussi</span><span class="sxs-lookup"><span data-stu-id="25edf-151">See Also</span></span>  
 <span data-ttu-id="25edf-152">[Fonctionnalités de SQL Server Native Client](sql-server-native-client-features.md) </span><span class="sxs-lookup"><span data-stu-id="25edf-152">[SQL Server Native Client Features](sql-server-native-client-features.md) </span></span>  
 <span data-ttu-id="25edf-153">[Connecter des clients à une session de mise en miroir de bases de données &#40;SQL Server&#41;](../../../database-engine/database-mirroring/connect-clients-to-a-database-mirroring-session-sql-server.md) </span><span class="sxs-lookup"><span data-stu-id="25edf-153">[Connect Clients to a Database Mirroring Session &#40;SQL Server&#41;](../../../database-engine/database-mirroring/connect-clients-to-a-database-mirroring-session-sql-server.md) </span></span>  
 [<span data-ttu-id="25edf-154">Mise en miroir de bases de données &#40;SQL Server&#41;</span><span class="sxs-lookup"><span data-stu-id="25edf-154">Database Mirroring &#40;SQL Server&#41;</span></span>](../../../database-engine/database-mirroring/database-mirroring-sql-server.md)  
  
  
