---
title: Inscription de types définis par l’utilisateur dans SQL Server | Microsoft Docs
ms.custom: ''
ms.date: 06/13/2017
ms.prod: sql-server-2014
ms.reviewer: ''
ms.technology: clr
ms.topic: reference
dev_langs:
- TSQL
helpviewer_keywords:
- UDTs [CLR integration], maintaining
- user-defined types [CLR integration], maintaining
- dependencies [CLR integration]
- deploying user-defined types [CLR integration]
- CurrencyConversion function
- user-defined types [CLR integration], deploying
- Transact-SQL deploying UDTs
- assemblies [CLR integration], user-defined types
- cross-database UDT support
- CREATE ASSEMBLY statement
- DROP TYPE statement
- Currency UDT
- CREATE TYPE statement
- registering user-defined types
- UDTs [CLR integration], deploying
- removing user-defined types
- user-defined types [CLR integration], registering
- ALTER ASSEMBLY statement
- UDTs [CLR integration], registering
- ADD FILE clause
ms.assetid: f7da3e92-e407-4f0b-b3a3-f214e442b37d
author: rothja
ms.author: jroth
ms.openlocfilehash: 7d24f7948e093335eff708f3c4a8a7361cfc156f
ms.sourcegitcommit: ad4d92dce894592a259721a1571b1d8736abacdb
ms.translationtype: MT
ms.contentlocale: fr-FR
ms.lasthandoff: 08/04/2020
ms.locfileid: "87602162"
---
# <a name="registering-user-defined-types-in-sql-server"></a><span data-ttu-id="f72d3-102">Inscription des types définis par l'utilisateur dans SQL Server</span><span class="sxs-lookup"><span data-stu-id="f72d3-102">Registering User-Defined Types in SQL Server</span></span>
  <span data-ttu-id="f72d3-103">Pour pouvoir utiliser un type défini par l’utilisateur (UDT) dans [!INCLUDE[msCoName](../../includes/msconame-md.md)] [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] , vous devez l’inscrire.</span><span class="sxs-lookup"><span data-stu-id="f72d3-103">In order to use a user-defined type (UDT) in [!INCLUDE[msCoName](../../includes/msconame-md.md)] [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)], you must register it.</span></span> <span data-ttu-id="f72d3-104">L'inscription d'un UDT comprend l'inscription de l'assembly et la création du type dans la base de données dans laquelle vous souhaitez l'utiliser.</span><span class="sxs-lookup"><span data-stu-id="f72d3-104">Registering a UDT involves registering the assembly and creating the type in the database in which you wish to use it.</span></span> <span data-ttu-id="f72d3-105">La portée des UDT se limite à une seule base de données. Ils ne peuvent pas être utilisés dans plusieurs bases de données à moins d'inscrire le même assembly et UDT dans chaque base de données.</span><span class="sxs-lookup"><span data-stu-id="f72d3-105">UDTs are scoped to a single database, and cannot be used in multiple databases unless the identical assembly and UDT are registered with each database.</span></span> <span data-ttu-id="f72d3-106">Une fois l'assembly de l'UDT inscrit et le type créé, vous pouvez utiliser l'UDT dans [!INCLUDE[tsql](../../includes/tsql-md.md)] et dans le code client.</span><span class="sxs-lookup"><span data-stu-id="f72d3-106">Once the UDT assembly is registered and the type created, you can use the UDT in [!INCLUDE[tsql](../../includes/tsql-md.md)] and in client code.</span></span> <span data-ttu-id="f72d3-107">Pour plus d’informations, consultez [Types CLR définis par l’utilisateur](clr-user-defined-types.md).</span><span class="sxs-lookup"><span data-stu-id="f72d3-107">For more information, see [CLR User-Defined Types](clr-user-defined-types.md).</span></span>  
  
## <a name="using-visual-studio-to-deploy-udts"></a><span data-ttu-id="f72d3-108">Utilisation de Visual Studio pour déployer des UDT</span><span class="sxs-lookup"><span data-stu-id="f72d3-108">Using Visual Studio to Deploy UDTs</span></span>  
 <span data-ttu-id="f72d3-109">Le moyen le plus simple de déployer votre UDT consiste à utiliser [!INCLUDE[msCoName](../../includes/msconame-md.md)] Visual Studio.</span><span class="sxs-lookup"><span data-stu-id="f72d3-109">The easiest way to deploy your UDT is by using [!INCLUDE[msCoName](../../includes/msconame-md.md)] Visual Studio.</span></span> <span data-ttu-id="f72d3-110">Toutefois, dans des scénarios de déploiement plus complexes et pour une souplesse maximale, utilisez [!INCLUDE[tsql](../../includes/tsql-md.md)] comme discuté plus loin dans cette rubrique.</span><span class="sxs-lookup"><span data-stu-id="f72d3-110">For more complex deployment scenarios and the greatest flexibility, however, use [!INCLUDE[tsql](../../includes/tsql-md.md)] as discussed later in this topic.</span></span>  
  
 <span data-ttu-id="f72d3-111">Procédez comme suit pour créer et déployer un UDT à l'aide de Visual Studio :</span><span class="sxs-lookup"><span data-stu-id="f72d3-111">Follow these steps to create and deploy a UDT using Visual Studio:</span></span>  
  
1.  <span data-ttu-id="f72d3-112">Créez un projet **de base de données** dans les nœuds de langage **Visual Basic** ou **Visual C#** .</span><span class="sxs-lookup"><span data-stu-id="f72d3-112">Create a new **Database** project in the **Visual Basic** or **Visual C#** language nodes.</span></span>  
  
2.  <span data-ttu-id="f72d3-113">Ajoutez une référence à la base de données [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] qui contiendra l'UDT.</span><span class="sxs-lookup"><span data-stu-id="f72d3-113">Add a reference to the [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] database that will contain the UDT.</span></span>  
  
3.  <span data-ttu-id="f72d3-114">Ajoutez une classe de **type défini par l’utilisateur** .</span><span class="sxs-lookup"><span data-stu-id="f72d3-114">Add a **User-Defined Type** class.</span></span>  
  
4.  <span data-ttu-id="f72d3-115">Écrivez le code d'implémentation de l'UDT.</span><span class="sxs-lookup"><span data-stu-id="f72d3-115">Write code to implement the UDT.</span></span>  
  
5.  <span data-ttu-id="f72d3-116">Dans le menu **générer** , sélectionnez **déployer**.</span><span class="sxs-lookup"><span data-stu-id="f72d3-116">From the **Build** menu, select **Deploy**.</span></span> <span data-ttu-id="f72d3-117">L'assembly est alors inscrit et le type est créé dans la base de données [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)].</span><span class="sxs-lookup"><span data-stu-id="f72d3-117">This registers the assembly and creates the type in the [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] database.</span></span>  
  
## <a name="using-transact-sql-to-deploy-udts"></a><span data-ttu-id="f72d3-118">Utilisation de Transact-SQL pour déployer des UDT</span><span class="sxs-lookup"><span data-stu-id="f72d3-118">Using Transact-SQL to Deploy UDTs</span></span>  
 <span data-ttu-id="f72d3-119">Le syntaxe [!INCLUDE[tsql](../../includes/tsql-md.md)] CREATE ASSEMBLY est utilisée pour inscrire l'assembly dans la base de données dans laquelle vous souhaitez utiliser l'UDT.</span><span class="sxs-lookup"><span data-stu-id="f72d3-119">The [!INCLUDE[tsql](../../includes/tsql-md.md)] CREATE ASSEMBLY syntax is used to register the assembly in the database in which you wish to use the UDT.</span></span> <span data-ttu-id="f72d3-120">L'assembly est stocké en interne dans les tables système de la base de données, et non en externe dans le système de fichiers.</span><span class="sxs-lookup"><span data-stu-id="f72d3-120">It is stored internally in database system tables, not externally in the file system.</span></span> <span data-ttu-id="f72d3-121">Si l'UDT est dépendant d'assemblys externes, ces derniers doivent également être chargés dans la base de données.</span><span class="sxs-lookup"><span data-stu-id="f72d3-121">If the UDT is dependent on external assemblies, they too must be loaded into the database.</span></span> <span data-ttu-id="f72d3-122">L'instruction CREATE TYPE est utilisée pour créer l'UDT dans la base de données dans laquelle il sera utilisé.</span><span class="sxs-lookup"><span data-stu-id="f72d3-122">The CREATE TYPE statement is used to create the UDT in the database in which it is to be used.</span></span> <span data-ttu-id="f72d3-123">Pour plus d’informations, consultez [Create assembly &#40;Transact-sql&#41;](/sql/t-sql/statements/create-assembly-transact-sql) et [create type &#40;transact-SQL&#41;](/sql/t-sql/statements/create-type-transact-sql).</span><span class="sxs-lookup"><span data-stu-id="f72d3-123">For more information, see [CREATE ASSEMBLY &#40;Transact-SQL&#41;](/sql/t-sql/statements/create-assembly-transact-sql) and [CREATE TYPE &#40;Transact-SQL&#41;](/sql/t-sql/statements/create-type-transact-sql).</span></span>  
  
### <a name="using-create-assembly"></a><span data-ttu-id="f72d3-124">Utilisation de CREATE ASSEMBLY</span><span class="sxs-lookup"><span data-stu-id="f72d3-124">Using CREATE ASSEMBLY</span></span>  
 <span data-ttu-id="f72d3-125">Le syntaxe CREATE ASSEMBLY permet d'inscrire l'assembly dans la base de données dans laquelle vous souhaitez utiliser l'UDT.</span><span class="sxs-lookup"><span data-stu-id="f72d3-125">The CREATE ASSEMBLY syntax registers the assembly in the database in which you wish to use the UDT.</span></span> <span data-ttu-id="f72d3-126">Une fois l'assembly inscrit, il n'a plus de dépendances.</span><span class="sxs-lookup"><span data-stu-id="f72d3-126">Once the assembly is registered, it has no dependencies.</span></span>  
  
 <span data-ttu-id="f72d3-127">La création de plusieurs versions du même assembly dans une même base de données n'est pas autorisée.</span><span class="sxs-lookup"><span data-stu-id="f72d3-127">Creating multiple versions of the same assembly in a given database is not allowed.</span></span> <span data-ttu-id="f72d3-128">Toutefois, il est possible de créer plusieurs versions du même assembly dans une même base de données en fonction de la culture.</span><span class="sxs-lookup"><span data-stu-id="f72d3-128">However, it is possible to create multiple versions of the same assembly based on culture in a given database.</span></span> [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] <span data-ttu-id="f72d3-129">distingue les différentes versions culturelles d'un assembly par des noms différents qui sont inscrits dans l'instance de [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)].</span><span class="sxs-lookup"><span data-stu-id="f72d3-129">distinguishes multiple culture versions of an assembly by different names as registered in the instance of [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)].</span></span> <span data-ttu-id="f72d3-130">Pour plus d'informations, consultez la section relative à la création et à l'utilisation d'assemblys avec nom fort dans le Kit de développement logiciel du .NET Framework.</span><span class="sxs-lookup"><span data-stu-id="f72d3-130">For more information, see "Creating and Using Strong-Named Assemblies" in the .NET Framework SDK.</span></span>  
  
 <span data-ttu-id="f72d3-131">Lorsque CREATE ASSEMBLY est exécuté avec le jeu d'autorisations SAFE ou EXTERNAL_ACCESS, l'assembly est vérifié pour s'assurer qu'il est vérifiable et sécurisé.</span><span class="sxs-lookup"><span data-stu-id="f72d3-131">When CREATE ASSEMBLY is executed with the SAFE or EXTERNAL_ACCESS permission sets, the assembly is checked to make sure that it is verifiable and type safe.</span></span> <span data-ttu-id="f72d3-132">Si vous omettez de spécifier un jeu d'autorisations, le jeu SAFE est utilisé.</span><span class="sxs-lookup"><span data-stu-id="f72d3-132">If you omit specifying a permission set, SAFE is assumed.</span></span> <span data-ttu-id="f72d3-133">Le code associé au jeu d'autorisations UNSAFE n'est pas vérifié.</span><span class="sxs-lookup"><span data-stu-id="f72d3-133">Code with the UNSAFE permission set is not checked.</span></span> <span data-ttu-id="f72d3-134">Pour plus d’informations sur les jeux d’autorisations des assemblys, consultez [Conception d’assemblys](../../relational-databases/clr-integration/assemblies-designing.md).</span><span class="sxs-lookup"><span data-stu-id="f72d3-134">For more information about assembly permission sets, see [Designing Assemblies](../../relational-databases/clr-integration/assemblies-designing.md).</span></span>  
  
#### <a name="example"></a><span data-ttu-id="f72d3-135">Exemple</span><span class="sxs-lookup"><span data-stu-id="f72d3-135">Example</span></span>  
 <span data-ttu-id="f72d3-136">L' [!INCLUDE[tsql](../../includes/tsql-md.md)] instruction suivante inscrit l’assembly point dans [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] dans la base de données **AdventureWorks** , avec l’autorisation Safe définie.</span><span class="sxs-lookup"><span data-stu-id="f72d3-136">The following [!INCLUDE[tsql](../../includes/tsql-md.md)] statement registers the Point assembly in [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] in the **AdventureWorks** database, with the SAFE permission set.</span></span> <span data-ttu-id="f72d3-137">Si la clause WITH PERMISSION_SET est omise, l'assembly est inscrit avec le jeu d'autorisations SAFE.</span><span class="sxs-lookup"><span data-stu-id="f72d3-137">If the WITH PERMISSION_SET clause is omitted, the assembly is registered with the SAFE permission set.</span></span>  
  
```  
USE AdventureWorks;  
CREATE ASSEMBLY Point  
FROM '\\ShareName\Projects\Point\bin\Point.dll'   
WITH PERMISSION_SET = SAFE;  
```  
  
 <span data-ttu-id="f72d3-138">L' [!INCLUDE[tsql](../../includes/tsql-md.md)] instruction suivante inscrit l’assembly à l’aide de *<assembly_bits argument>* dans la clause from.</span><span class="sxs-lookup"><span data-stu-id="f72d3-138">The following [!INCLUDE[tsql](../../includes/tsql-md.md)] statement registers the assembly using *<assembly_bits>* argument in the FROM clause.</span></span> <span data-ttu-id="f72d3-139">Cette valeur `varbinary` représente le fichier sous la forme d'un flux d'octets.</span><span class="sxs-lookup"><span data-stu-id="f72d3-139">This `varbinary` value represents the file as a stream of bytes.</span></span>  
  
```  
USE AdventureWorks;  
CREATE ASSEMBLY Point  
FROM 0xfeac4 ... 21ac78  
```  
  
### <a name="using-create-type"></a><span data-ttu-id="f72d3-140">Utilisation de CREATE TYPE</span><span class="sxs-lookup"><span data-stu-id="f72d3-140">Using CREATE TYPE</span></span>  
 <span data-ttu-id="f72d3-141">Une fois l'assembly chargé dans la base de données, vous pouvez créer le type à l'aide de l'instruction [!INCLUDE[tsql](../../includes/tsql-md.md)] CREATE TYPE.</span><span class="sxs-lookup"><span data-stu-id="f72d3-141">Once the assembly is loaded into the database, you can then create the type using the [!INCLUDE[tsql](../../includes/tsql-md.md)] CREATE TYPE statement.</span></span> <span data-ttu-id="f72d3-142">Le type est alors ajouté à la liste des types disponibles pour cette base de données.</span><span class="sxs-lookup"><span data-stu-id="f72d3-142">This adds the type to the list of available types for that database.</span></span> <span data-ttu-id="f72d3-143">La portée du type se limite à la base de données ; il ne peut être utilisé que dans la base de données dans laquelle il a été créé.</span><span class="sxs-lookup"><span data-stu-id="f72d3-143">The type has database scope and the type can only be used in the database in which it was created.</span></span> <span data-ttu-id="f72d3-144">Si l'UDT existe déjà dans la base de données, l'instruction CREATE TYPE échoue avec une erreur.</span><span class="sxs-lookup"><span data-stu-id="f72d3-144">If the UDT already exists in the database, the CREATE TYPE statement fails with an error.</span></span>  
  
> [!NOTE]  
>  <span data-ttu-id="f72d3-145">La syntaxe CREATE TYPE est également utilisée pour créer des types de données d'alias [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] natifs et devrait remplacer `sp_addtype` comme méthode de création de types de données d'alias.</span><span class="sxs-lookup"><span data-stu-id="f72d3-145">The CREATE TYPE syntax is also used for creating native [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] alias data types, and is intended to replace `sp_addtype` as a means of creating alias data types.</span></span> <span data-ttu-id="f72d3-146">Certains arguments facultatifs de la syntaxe CREATE TYPE se rapportent à la création d'UDT et ne peuvent pas être appliqués à la création de types de données d'alias.</span><span class="sxs-lookup"><span data-stu-id="f72d3-146">Some of the optional arguments in the CREATE TYPE syntax refer to creating UDTs, and are not applicable to creating alias data types (such as base type).</span></span>  
  
 <span data-ttu-id="f72d3-147">Pour plus d’informations, consultez [CREATE TYPE &#40;Transact-SQL&#41;](/sql/t-sql/statements/create-type-transact-sql).</span><span class="sxs-lookup"><span data-stu-id="f72d3-147">For more information, see [CREATE TYPE &#40;Transact-SQL&#41;](/sql/t-sql/statements/create-type-transact-sql).</span></span>  
  
#### <a name="example"></a><span data-ttu-id="f72d3-148">Exemple</span><span class="sxs-lookup"><span data-stu-id="f72d3-148">Example</span></span>  
 <span data-ttu-id="f72d3-149">Dans l'exemple d'instruction [!INCLUDE[tsql](../../includes/tsql-md.md)] qui suit, le type `Point` est créé.</span><span class="sxs-lookup"><span data-stu-id="f72d3-149">The following [!INCLUDE[tsql](../../includes/tsql-md.md)] statement creates the `Point` type.</span></span> <span data-ttu-id="f72d3-150">Le nom externe est spécifié à l’aide de la syntaxe de dénomination en deux parties de *AssemblyName*. *UDTName*.</span><span class="sxs-lookup"><span data-stu-id="f72d3-150">The EXTERNAL NAME is specified using the two-part naming syntax of *AssemblyName*.*UDTName*.</span></span>  
  
```  
CREATE TYPE dbo.Point   
EXTERNAL NAME Point.[Point];  
```  
  
## <a name="removing-a-udt-from-the-database"></a><span data-ttu-id="f72d3-151">Suppression d'un UDT de la base de données</span><span class="sxs-lookup"><span data-stu-id="f72d3-151">Removing a UDT from the Database</span></span>  
 <span data-ttu-id="f72d3-152">L'instruction DROP TYPE supprime un UDT de la base de données active.</span><span class="sxs-lookup"><span data-stu-id="f72d3-152">The DROP TYPE statement removes a UDT from the current database.</span></span> <span data-ttu-id="f72d3-153">Une fois un UDT supprimé, vous pouvez utiliser l'instruction DROP ASSEMBLY pour supprimer l'assembly de la base de données.</span><span class="sxs-lookup"><span data-stu-id="f72d3-153">Once a UDT is dropped, you can use the DROP ASSEMBLY statement to drop the assembly from the database.</span></span>  
  
 <span data-ttu-id="f72d3-154">L'instruction DROP TYPE ne s'exécute pas dans les situations suivantes :</span><span class="sxs-lookup"><span data-stu-id="f72d3-154">The DROP TYPE statement does not execute in the following situations:</span></span>  
  
-   <span data-ttu-id="f72d3-155">Des tables de la base de données contiennent des colonnes définies à l'aide de l'UDT.</span><span class="sxs-lookup"><span data-stu-id="f72d3-155">Tables in the database that contain columns defined using the UDT.</span></span>  
  
-   <span data-ttu-id="f72d3-156">Des fonctions, procédures stockées ou déclencheurs créés dans la base de données avec la clause WITH SCHEMABINDING utilisent des variables ou des paramètres de l'UDT.</span><span class="sxs-lookup"><span data-stu-id="f72d3-156">Functions, stored procedures, or triggers that use variables or parameters of the UDT, created in the database with the WITH SCHEMABINDING clause.</span></span>  
  
### <a name="example"></a><span data-ttu-id="f72d3-157">Exemple</span><span class="sxs-lookup"><span data-stu-id="f72d3-157">Example</span></span>  
 <span data-ttu-id="f72d3-158">L'instruction [!INCLUDE[tsql](../../includes/tsql-md.md)] suivante doit s'exécuter dans l'ordre suivant.</span><span class="sxs-lookup"><span data-stu-id="f72d3-158">The following [!INCLUDE[tsql](../../includes/tsql-md.md)] must execute in the following order.</span></span> <span data-ttu-id="f72d3-159">La table qui référence l'UDT `Point` doit être supprimée en premier, suivie du type et enfin de l'assembly.</span><span class="sxs-lookup"><span data-stu-id="f72d3-159">First the table which references the `Point` UDT must be dropped, then the type, and finally the assembly.</span></span>  
  
```  
DROP TABLE dbo.Points;  
DROP TYPE dbo.Point;  
DROP ASSEMBLY Point;  
```  
  
### <a name="finding-udt-dependencies"></a><span data-ttu-id="f72d3-160">Recherche des dépendances d'un UDT</span><span class="sxs-lookup"><span data-stu-id="f72d3-160">Finding UDT Dependencies</span></span>  
 <span data-ttu-id="f72d3-161">En présence d'objets dépendants, comme des tables avec des définitions de colonne UDT, l'instruction DROP TYPE échoue.</span><span class="sxs-lookup"><span data-stu-id="f72d3-161">If there are dependent objects, such as tables with UDT column definitions, the DROP TYPE statement fails.</span></span> <span data-ttu-id="f72d3-162">Elle échoue également si des fonctions, procédures stockées ou déclencheurs créés dans la base de données à l'aide de la clause WITH SCHEMABINDING utilisent des variables ou des paramètres du type défini par l'utilisateur.</span><span class="sxs-lookup"><span data-stu-id="f72d3-162">It also fails if there are functions, stored procedures, or triggers created in the database using the WITH SCHEMABINDING clause, if these routines use variables or parameters of the user-defined type.</span></span> <span data-ttu-id="f72d3-163">Vous devez commencer par supprimer tous les objets dépendants, puis exécuter l'instruction DROP TYPE.</span><span class="sxs-lookup"><span data-stu-id="f72d3-163">You must first drop all dependent objects, and then execute the DROP TYPE statement.</span></span>  
  
 <span data-ttu-id="f72d3-164">La [!INCLUDE[tsql](../../includes/tsql-md.md)] requête suivante localise toutes les colonnes et tous les paramètres qui utilisent un UDT dans la base de données **AdventureWorks** .</span><span class="sxs-lookup"><span data-stu-id="f72d3-164">The following [!INCLUDE[tsql](../../includes/tsql-md.md)] query locates all of the columns and parameters that use a UDT in the **AdventureWorks** database.</span></span>  
  
```  
USE Adventureworks;  
SELECT o.name AS major_name, o.type_desc AS major_type_desc  
     , c.name AS minor_name, c.type_desc AS minor_type_desc  
     , at.assembly_class  
  FROM (  
        SELECT object_id, name, user_type_id, 'SQL_COLUMN' AS type_desc  
          FROM sys.columns  
     UNION ALL  
        SELECT object_id, name, user_type_id, 'SQL_PROCEDURE_PARAMETER'  
          FROM sys.parameters  
     ) AS c  
  JOIN sys.objects AS o  
    ON o.object_id = c.object_id  
  JOIN sys.assembly_types AS at  
    ON at.user_type_id = c.user_type_id;  
```  
  
## <a name="maintaining-udts"></a><span data-ttu-id="f72d3-165">Maintenance des UDT</span><span class="sxs-lookup"><span data-stu-id="f72d3-165">Maintaining UDTs</span></span>  
 <span data-ttu-id="f72d3-166">Vous ne pouvez pas modifier un UDT qui a été créé dans une base de données [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)]. Vous pouvez toutefois modifier l'assembly sur lequel repose ce type.</span><span class="sxs-lookup"><span data-stu-id="f72d3-166">You cannot modify a UDT once it is created in a [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] database, although you can alter the assembly on which the type is based.</span></span> <span data-ttu-id="f72d3-167">Dans la plupart des cas, vous devez supprimer l'UDT de la base de données à l'aide de l'instruction [!INCLUDE[tsql](../../includes/tsql-md.md)] DROP TYPE, apporter des modifications à l'assembly sous-jacent et le recharger à l'aide de l'instruction ALTER ASSEMBLY.</span><span class="sxs-lookup"><span data-stu-id="f72d3-167">In most cases, you must remove the UDT from the database with the [!INCLUDE[tsql](../../includes/tsql-md.md)] DROP TYPE statement, make changes to the underlying assembly, and reload it using the ALTER ASSEMBLY statement.</span></span> <span data-ttu-id="f72d3-168">Vous devez ensuite recréer l'UDT et tout objet dépendant.</span><span class="sxs-lookup"><span data-stu-id="f72d3-168">You then need to re-create the UDT and any dependent objects.</span></span>  
  
### <a name="example"></a><span data-ttu-id="f72d3-169">Exemple</span><span class="sxs-lookup"><span data-stu-id="f72d3-169">Example</span></span>  
 <span data-ttu-id="f72d3-170">L'instruction ALTER ASSEMBLY est utilisée une fois que vous avez modifié le code source dans votre assembly UDT et l'avez recompilé.</span><span class="sxs-lookup"><span data-stu-id="f72d3-170">The ALTER ASSEMBLY statement is used after you have made changes to the source code in your UDT assembly and recompiled it.</span></span> <span data-ttu-id="f72d3-171">Elle copie le fichier .dll sur le serveur et le lie au nouvel assembly.</span><span class="sxs-lookup"><span data-stu-id="f72d3-171">It copies the .dll file to the server and rebinds to the new assembly.</span></span> <span data-ttu-id="f72d3-172">Pour obtenir la syntaxe complète, consultez [ALTER assembly &#40;Transact-SQL&#41;](/sql/t-sql/statements/alter-assembly-transact-sql).</span><span class="sxs-lookup"><span data-stu-id="f72d3-172">For the complete syntax, see [ALTER ASSEMBLY &#40;Transact-SQL&#41;](/sql/t-sql/statements/alter-assembly-transact-sql).</span></span>  
  
 <span data-ttu-id="f72d3-173">L'instruction [!INCLUDE[tsql](../../includes/tsql-md.md)] ALTER ASSEMBLY suivante recharge l'assembly Point.dll à partir de l'emplacement spécifié sur le disque.</span><span class="sxs-lookup"><span data-stu-id="f72d3-173">The following [!INCLUDE[tsql](../../includes/tsql-md.md)] ALTER ASSEMBLY statement reloads the Point.dll assembly from the specified location on disk.</span></span>  
  
```  
ALTER ASSEMBLY Point  
FROM '\\Projects\Point\bin\Point.dll'  
```  
  
### <a name="using-alter-assembly-to-add-source-code"></a><span data-ttu-id="f72d3-174">Utilisation de l'instruction ALTER ASSEMBLY pour ajouter le code source</span><span class="sxs-lookup"><span data-stu-id="f72d3-174">Using ALTER ASSEMBLY to Add Source Code</span></span>  
 <span data-ttu-id="f72d3-175">La clause ADD FILE de la syntaxe ALTER ASSEMBLY n'est pas présente dans CREATE ASSEMBLY.</span><span class="sxs-lookup"><span data-stu-id="f72d3-175">The ADD FILE clause in the ALTER ASSEMBLY syntax is not present in CREATE ASSEMBLY.</span></span> <span data-ttu-id="f72d3-176">Vous pouvez l'utiliser pour ajouter le code source ou tout autre fichier associé à un assembly.</span><span class="sxs-lookup"><span data-stu-id="f72d3-176">You can use it to add source code or any other files associated with an assembly.</span></span> <span data-ttu-id="f72d3-177">Les fichiers sont copiés depuis leur emplacement d'origine et stockés dans les tables système de la base de données.</span><span class="sxs-lookup"><span data-stu-id="f72d3-177">The files are copied from their original locations and stored in system tables in the database.</span></span> <span data-ttu-id="f72d3-178">Le code source et autres fichiers est toujours à portée de main dans l'éventualité où vous deviez recréer ou documenter la version actuelle de l'UDT.</span><span class="sxs-lookup"><span data-stu-id="f72d3-178">This ensures that you always have source code or other files on hand should you ever need to re-create or document the current version of the UDT.</span></span>  
  
 <span data-ttu-id="f72d3-179">L' [!INCLUDE[tsql](../../includes/tsql-md.md)] instruction ALTER assembly suivante ajoute le code source de la classe point.cs pour le type défini par l’utilisateur `Point` .</span><span class="sxs-lookup"><span data-stu-id="f72d3-179">The following [!INCLUDE[tsql](../../includes/tsql-md.md)] ALTER ASSEMBLY statement adds the Point.cs class source code for the `Point` UDT.</span></span> <span data-ttu-id="f72d3-180">Le texte contenu dans le fichier Point.cs est alors copié et stocké dans la base de données sous le nom PointSource.</span><span class="sxs-lookup"><span data-stu-id="f72d3-180">This copies the text contained in the Point.cs file and stores it in the database under the name "PointSource".</span></span>  
  
```  
ALTER ASSEMBLY Point  
ADD FILE FROM '\\Projects\Point\Point.cs' AS PointSource;  
```  
  
 <span data-ttu-id="f72d3-181">Les informations d’assembly sont stockées dans la table **sys. assembly_files** de la base de données dans laquelle l’assembly a été installé.</span><span class="sxs-lookup"><span data-stu-id="f72d3-181">Assembly information is stored in the **sys.assembly_files** table in the database where the assembly has been installed.</span></span> <span data-ttu-id="f72d3-182">La table **sys. assembly_files** contient les colonnes suivantes.</span><span class="sxs-lookup"><span data-stu-id="f72d3-182">The **sys.assembly_files** table contains the following columns.</span></span>  
  
 <span data-ttu-id="f72d3-183">**assembly_id**</span><span class="sxs-lookup"><span data-stu-id="f72d3-183">**assembly_id**</span></span>  
 <span data-ttu-id="f72d3-184">Identificateur défini pour l'assembly.</span><span class="sxs-lookup"><span data-stu-id="f72d3-184">The identifier defined for the assembly.</span></span> <span data-ttu-id="f72d3-185">Ce numéro est affecté à tous les objets se rapportant au même assembly.</span><span class="sxs-lookup"><span data-stu-id="f72d3-185">This number is assigned to all objects relating to the same assembly.</span></span>  
  
 <span data-ttu-id="f72d3-186">**name**</span><span class="sxs-lookup"><span data-stu-id="f72d3-186">**name**</span></span>  
 <span data-ttu-id="f72d3-187">Nom de l'objet.</span><span class="sxs-lookup"><span data-stu-id="f72d3-187">The name of the object.</span></span>  
  
 <span data-ttu-id="f72d3-188">**file_id**</span><span class="sxs-lookup"><span data-stu-id="f72d3-188">**file_id**</span></span>  
 <span data-ttu-id="f72d3-189">Nombre identifiant chaque objet, avec le premier objet associé à un **assembly_id** donné qui reçoit la valeur 1.</span><span class="sxs-lookup"><span data-stu-id="f72d3-189">A number identifying each object, with the first object associated with a given **assembly_id** being given the value of 1.</span></span> <span data-ttu-id="f72d3-190">Si plusieurs objets sont associés au même **assembly_id**, chaque valeur de **file_id** suivante est incrémentée de 1.</span><span class="sxs-lookup"><span data-stu-id="f72d3-190">If there are multiple objects associated with the same **assembly_id**, then each subsequent **file_id** value is incremented by 1.</span></span>  
  
 <span data-ttu-id="f72d3-191">**content**</span><span class="sxs-lookup"><span data-stu-id="f72d3-191">**content**</span></span>  
 <span data-ttu-id="f72d3-192">Représentation hexadécimale de l'assembly ou du fichier.</span><span class="sxs-lookup"><span data-stu-id="f72d3-192">The hexadecimal representation of the assembly or file.</span></span>  
  
 <span data-ttu-id="f72d3-193">Vous pouvez utiliser la fonction CAST ou CONVERT pour convertir le contenu de la colonne de **contenu** en texte lisible.</span><span class="sxs-lookup"><span data-stu-id="f72d3-193">You can use the CAST or CONVERT function to convert the contents of the **content** column to readable text.</span></span> <span data-ttu-id="f72d3-194">La requête suivante convertit le contenu du fichier Point.cs en texte lisible, en utilisant le nom indiqué dans la clause WHERE pour limiter le jeu de résultats à une ligne unique.</span><span class="sxs-lookup"><span data-stu-id="f72d3-194">The following query converts the contents of the Point.cs file to readable text, using the name in the WHERE clause to restrict the result set to a single row.</span></span>  
  
```  
SELECT CAST(content AS varchar(8000))   
  FROM sys.assembly_files   
  WHERE name='PointSource';  
```  
  
 <span data-ttu-id="f72d3-195">Si vous copiez et collez les résultats dans un éditeur de texte, vous pouvez constater que les sauts de ligne et les espaces qui existaient dans l'original ont été conservés.</span><span class="sxs-lookup"><span data-stu-id="f72d3-195">If you copy and paste the results in to a text editor, you will see that the line breaks and spaces that existed in the original have been preserved.</span></span>  
  
## <a name="managing-udts-and-assemblies"></a><span data-ttu-id="f72d3-196">Gestion des UDT et des assemblys</span><span class="sxs-lookup"><span data-stu-id="f72d3-196">Managing UDTs and Assemblies</span></span>  
 <span data-ttu-id="f72d3-197">Lors de la planification de votre implémentation d'UDT, identifiez les méthodes qui sont nécessaires dans l'assembly lui-même de l'UDT, ainsi que celles qui doivent être créées dans des assemblys distincts et implémentées en tant que fonctions définies par l'utilisateur ou procédures stockées.</span><span class="sxs-lookup"><span data-stu-id="f72d3-197">When planning your implementation of UDTs, consider which methods are needed in the UDT assembly itself, and which methods should be created in separate assemblies and implemented as user-defined functions or stored procedures.</span></span> <span data-ttu-id="f72d3-198">Le fait de séparer les méthodes dans des assemblys distincts vous permet de mettre à jour le code sans affecter les données qui peuvent être stockées dans une colonne UDT d'une table.</span><span class="sxs-lookup"><span data-stu-id="f72d3-198">Separating methods into separate assemblies allows you to update code without affecting data that may be stored in a UDT column in a table.</span></span> <span data-ttu-id="f72d3-199">Vous pouvez modifier les assemblys d'UDT sans supprimer de colonnes UDT et autres objets dépendants uniquement lorsque la nouvelle définition peut lire les valeurs précédentes et que la signature du type ne change pas.</span><span class="sxs-lookup"><span data-stu-id="f72d3-199">You can modify UDT assemblies without dropping UDT columns and other dependent objects only when the new definition can read the former values and the signature of the type does not change.</span></span>  
  
 <span data-ttu-id="f72d3-200">Le fait de séparer le code de procédure susceptible de changer du code requis pour implémenter l'UDT simplifie considérablement la maintenance.</span><span class="sxs-lookup"><span data-stu-id="f72d3-200">Separating procedural code that may change from the code required to implement the UDT greatly simplifies maintenance.</span></span> <span data-ttu-id="f72d3-201">Par ailleurs, le fait de n'inclure que le code qui est nécessaire au fonctionnement de l'UDT et de créer des définitions d'UDT aussi simples que possible réduit le risque que l'UDT lui-même ait besoin d'être supprimé de la base de données pour les révisions de code ou la résolution de bogues.</span><span class="sxs-lookup"><span data-stu-id="f72d3-201">Including only code that is necessary for the UDT to function, and keeping your UDT definitions as simple as possible, reduces the risk that the UDT itself may need to be dropped from the database for code revisions or bug fixes.</span></span>  
  
### <a name="the-currency-udt-and-currency-conversion-function"></a><span data-ttu-id="f72d3-202">UDT Currency et fonction de conversion de devise</span><span class="sxs-lookup"><span data-stu-id="f72d3-202">The Currency UDT and Currency Conversion Function</span></span>  
 <span data-ttu-id="f72d3-203">L’UDT **Currency** de l’exemple de base de données **AdventureWorks** fournit un exemple utile de la méthode recommandée pour structurer un UDT et ses fonctions associées.</span><span class="sxs-lookup"><span data-stu-id="f72d3-203">The **Currency** UDT in the **AdventureWorks** sample database provides a useful example of the recommended way to structure a UDT and its associated functions.</span></span> <span data-ttu-id="f72d3-204">Le type défini par l’utilisateur **Currency** est utilisé pour gérer les données financières en fonction du système monétaire d’une culture particulière, et permet de stocker différents types de devises, tels que des dollars, des euros, etc.</span><span class="sxs-lookup"><span data-stu-id="f72d3-204">The **Currency** UDT is used for handling money based on the monetary system of a particular culture, and allows for storage of different currency types, such as dollars, euros, and so forth.</span></span> <span data-ttu-id="f72d3-205">La classe de l'UDT expose un nom de culture sous forme de chaîne, et une somme d'argent sous forme de type de données `decimal`.</span><span class="sxs-lookup"><span data-stu-id="f72d3-205">The UDT class exposes a culture name as a string, and an amount of money as a `decimal` data type.</span></span> <span data-ttu-id="f72d3-206">Toutes les méthodes de sérialisation nécessaires sont contenues dans l'assembly qui définit la classe.</span><span class="sxs-lookup"><span data-stu-id="f72d3-206">All of the necessary serialization methods are contained within the assembly defining the class.</span></span> <span data-ttu-id="f72d3-207">La fonction qui implémente la conversion monétaire d’une culture à une autre est implémentée en tant que fonction externe nommée **ConvertCurrency**, et cette fonction se trouve dans un assembly distinct.</span><span class="sxs-lookup"><span data-stu-id="f72d3-207">The function that implements currency conversion from one culture to another is implemented as an external function named **ConvertCurrency**, and this function is located in a separate assembly.</span></span> <span data-ttu-id="f72d3-208">La fonction **ConvertCurrency** effectue son travail en extrayant le taux de conversion d’une table de la base de données **AdventureWorks** .</span><span class="sxs-lookup"><span data-stu-id="f72d3-208">The **ConvertCurrency** function does its work by retrieving the conversion rate from a table in the **AdventureWorks** database.</span></span> <span data-ttu-id="f72d3-209">Si la source des taux de conversion doit être modifiée ou si d’autres modifications doivent être apportées au code existant, l’assembly peut être facilement modifié sans affecter l’UDT **Currency** .</span><span class="sxs-lookup"><span data-stu-id="f72d3-209">If the source of the conversion rates should ever change, or if there should be any other changes to the existing code, the assembly can be easily modified without affecting the **Currency** UDT.</span></span>  
  
 <span data-ttu-id="f72d3-210">Vous pouvez trouver le code de l’UDT **Currency** et des fonctions **ConvertCurrency** en installant les exemples de Common Language Runtime (CLR).</span><span class="sxs-lookup"><span data-stu-id="f72d3-210">The code listing for the **Currency** UDT and **ConvertCurrency** functions can be found by installing the common language runtime (CLR) samples.</span></span>  
  
### <a name="using-udts-across-databases"></a><span data-ttu-id="f72d3-211">Utilisation d'UDT dans plusieurs bases de données</span><span class="sxs-lookup"><span data-stu-id="f72d3-211">Using UDTs Across Databases</span></span>  
 <span data-ttu-id="f72d3-212">Par définition, la portée des UDT se limite à une seule base de données.</span><span class="sxs-lookup"><span data-stu-id="f72d3-212">UDTs are by definition scoped to a single database.</span></span> <span data-ttu-id="f72d3-213">Autrement dit, un UDT défini dans une base de données ne peut pas être utilisé dans une définition de colonne d'une autre base de données.</span><span class="sxs-lookup"><span data-stu-id="f72d3-213">Therefore, a UDT defined in one database cannot be used in a column definition in another database.</span></span> <span data-ttu-id="f72d3-214">Pour utiliser des UDT dans plusieurs bases de données, vous devez exécuter les instructions CREATE ASSEMBLY et CREATE TYPE dans chaque base de données sur des assemblys identiques.</span><span class="sxs-lookup"><span data-stu-id="f72d3-214">In order to use UDTs in multiple databases, you must execute the CREATE ASSEMBLY and CREATE TYPE statements in each database on identical assemblies.</span></span> <span data-ttu-id="f72d3-215">Les assemblys sont considérés comme identiques s'ils partagent les mêmes nom, nom fort, culture, version, jeu d'autorisations et contenu binaire.</span><span class="sxs-lookup"><span data-stu-id="f72d3-215">Assemblies are considered identical if they have the same name, strong name, culture, version, permission set, and binary contents.</span></span>  
  
 <span data-ttu-id="f72d3-216">Une fois l'UDT inscrit et accessible dans les deux bases de données, vous pouvez convertir une valeur UDT d'une base de données en vue de l'utiliser dans une autre.</span><span class="sxs-lookup"><span data-stu-id="f72d3-216">Once the UDT is registered and accessible in both databases, you can convert a UDT value from one database for use in another.</span></span> <span data-ttu-id="f72d3-217">Des UDT identiques peuvent être utilisés dans plusieurs bases de données dans les scénarios suivants :</span><span class="sxs-lookup"><span data-stu-id="f72d3-217">Identical UDTs can be used across databases in the following scenarios:</span></span>  
  
-   <span data-ttu-id="f72d3-218">appel de procédures stockées définies dans des base de données différentes ;</span><span class="sxs-lookup"><span data-stu-id="f72d3-218">Calling stored procedure defined in different databases.</span></span>  
  
-   <span data-ttu-id="f72d3-219">interrogation de tables définies dans des bases de données différentes ;</span><span class="sxs-lookup"><span data-stu-id="f72d3-219">Querying tables defined in different databases.</span></span>  
  
-   <span data-ttu-id="f72d3-220">sélection de données UDT dans une colonne UDT de table de base de données et insertion dans une seconde base de données avec une colonne UDT identique.</span><span class="sxs-lookup"><span data-stu-id="f72d3-220">Selecting UDT data from one database table UDT column and inserting it into a second database with an identical UDT column.</span></span>  
  
 <span data-ttu-id="f72d3-221">Dans ces situations, toute conversion requise par le serveur se produit automatiquement.</span><span class="sxs-lookup"><span data-stu-id="f72d3-221">In these situations, any conversion required by the server occurs automatically.</span></span> <span data-ttu-id="f72d3-222">Vous ne pouvez pas effectuer explicitement ces conversions à l'aide des fonctions [!INCLUDE[tsql](../../includes/tsql-md.md)] CAST ou CONVERT.</span><span class="sxs-lookup"><span data-stu-id="f72d3-222">You are not able to perform the conversions explicitly using the [!INCLUDE[tsql](../../includes/tsql-md.md)] CAST or CONVERT functions.</span></span>  
  
 <span data-ttu-id="f72d3-223">Notez que vous n’avez pas besoin d’effectuer d’action pour utiliser des UDT lorsque [!INCLUDE[ssDEnoversion](../../includes/ssdenoversion-md.md)] crée des tables de travail dans la base de données système **tempdb** .</span><span class="sxs-lookup"><span data-stu-id="f72d3-223">Note that you do not need to take any action for using UDTs when [!INCLUDE[ssDEnoversion](../../includes/ssdenoversion-md.md)] creates work tables in the **tempdb** system database.</span></span> <span data-ttu-id="f72d3-224">Cela inclut la gestion des curseurs, des variables de table et des fonctions table définies par l’utilisateur qui incluent des UDT et qui utilisent **tempdb**de manière transparente.</span><span class="sxs-lookup"><span data-stu-id="f72d3-224">This includes the handling of cursors, table variables, and user-defined table-valued functions that include UDTs and that transparently make use of **tempdb**.</span></span> <span data-ttu-id="f72d3-225">Toutefois, si vous créez explicitement une table temporaire dans **tempdb** qui définit une colonne UDT, le type défini par l’utilisateur doit être inscrit dans **tempdb** de la même façon que pour une base de données utilisateur.</span><span class="sxs-lookup"><span data-stu-id="f72d3-225">However, if you explicitly create a temporary table in **tempdb** that defines a UDT column, then the UDT must be registered in **tempdb** the same way as for a user database.</span></span>  
  
## <a name="see-also"></a><span data-ttu-id="f72d3-226">Voir aussi</span><span class="sxs-lookup"><span data-stu-id="f72d3-226">See Also</span></span>  
 [<span data-ttu-id="f72d3-227">Types CLR définis par l'utilisateur</span><span class="sxs-lookup"><span data-stu-id="f72d3-227">CLR User-Defined Types</span></span>](clr-user-defined-types.md)  
  
  
