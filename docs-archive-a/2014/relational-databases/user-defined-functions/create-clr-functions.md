---
title: Créer des fonctions CLR | Microsoft Docs
ms.custom: ''
ms.date: 06/13/2017
ms.prod: sql-server-2014
ms.reviewer: ''
ms.technology: ''
ms.topic: conceptual
helpviewer_keywords:
- CLR functions [SQL Server]
- user-defined functions [SQL Server], CLR
ms.assetid: a82df075-2243-4e19-bfe1-ae6d65dabd0f
author: rothja
ms.author: jroth
ms.openlocfilehash: 9741646e43d48bc9336b91538c6065c09855c87d
ms.sourcegitcommit: ad4d92dce894592a259721a1571b1d8736abacdb
ms.translationtype: MT
ms.contentlocale: fr-FR
ms.lasthandoff: 08/04/2020
ms.locfileid: "87696688"
---
# <a name="create-clr-functions"></a><span data-ttu-id="b5917-102">Créer des fonctions CLR</span><span class="sxs-lookup"><span data-stu-id="b5917-102">Create CLR Functions</span></span>
  <span data-ttu-id="b5917-103">Vous pouvez créer un objet de base de données dans une instance de [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] programmée dans un assembly créé dans le CLR (Common Language Runtime) [!INCLUDE[msCoName](../../includes/msconame-md.md)] [!INCLUDE[dnprdnshort](../../includes/dnprdnshort-md.md)].</span><span class="sxs-lookup"><span data-stu-id="b5917-103">You can create a database object inside an instance of [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] that is programmed in an assembly created in the [!INCLUDE[msCoName](../../includes/msconame-md.md)] [!INCLUDE[dnprdnshort](../../includes/dnprdnshort-md.md)] common language runtime (CLR).</span></span> <span data-ttu-id="b5917-104">Les objets de base de données peuvent exploiter le modèle de programmation élaboré fourni par les fonctions agrégées, les fonctions, les procédures stockées, les déclencheurs et les types du CLR.</span><span class="sxs-lookup"><span data-stu-id="b5917-104">Database objects that can leverage the rich programming model provided by the common language runtime include aggregate functions, functions, stored procedures, triggers, and types.</span></span>  
  
 <span data-ttu-id="b5917-105">La création d'une fonction CLR dans [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] comprend les étapes suivantes :</span><span class="sxs-lookup"><span data-stu-id="b5917-105">Creating a CLR function in [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] involves the following steps:</span></span>  
  
-   <span data-ttu-id="b5917-106">Définissez la fonction en tant que méthode statique d'une classe dans un langage reconnu par le [!INCLUDE[dnprdnshort](../../includes/dnprdnshort-md.md)].</span><span class="sxs-lookup"><span data-stu-id="b5917-106">Define the function as a static method of a class in a language supported by the [!INCLUDE[dnprdnshort](../../includes/dnprdnshort-md.md)].</span></span> <span data-ttu-id="b5917-107">Pour plus d’informations sur la programmation des fonctions dans le CLR, consultez [Fonctions CLR définies par l’utilisateur](../clr-integration-database-objects-user-defined-functions/clr-user-defined-functions.md).</span><span class="sxs-lookup"><span data-stu-id="b5917-107">For more information about how to program functions in the common language runtime, see [CLR User-Defined Functions](../clr-integration-database-objects-user-defined-functions/clr-user-defined-functions.md).</span></span> <span data-ttu-id="b5917-108">Ensuite, compilez la classe pour créer un assembly dans le [!INCLUDE[dnprdnshort](../../includes/dnprdnshort-md.md)] à l'aide du compilateur du langage approprié.</span><span class="sxs-lookup"><span data-stu-id="b5917-108">Then, compile the class to build an assembly in the [!INCLUDE[dnprdnshort](../../includes/dnprdnshort-md.md)] by using the appropriate language compiler.</span></span>  
  
-   <span data-ttu-id="b5917-109">Enregistrez l'assembly dans [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] à l'aide de l'instruction CREATE ASSEMBLY.</span><span class="sxs-lookup"><span data-stu-id="b5917-109">Register the assembly in [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] by using the CREATE ASSEMBLY statement.</span></span> <span data-ttu-id="b5917-110">Pour plus d’informations sur les assemblys dans [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)], consultez [Assemblys &#40;moteur de base de données&#41;](../clr-integration/assemblies-database-engine.md).</span><span class="sxs-lookup"><span data-stu-id="b5917-110">For more information about assemblies in [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)], see [Assemblies &#40;Database Engine&#41;](../clr-integration/assemblies-database-engine.md).</span></span>  
  
-   <span data-ttu-id="b5917-111">Créez la fonction qui fait référence à l’assembly inscrit à l’aide de l’instruction [CREATE FUNCTION](/sql/t-sql/statements/create-function-transact-sql) .</span><span class="sxs-lookup"><span data-stu-id="b5917-111">Create the function that references the registered assembly by using the [CREATE FUNCTION](/sql/t-sql/statements/create-function-transact-sql) statement.</span></span>  
  
> [!NOTE]  
>  <span data-ttu-id="b5917-112">Le déploiement d’un projet SQL Server dans [!INCLUDE[msCoName](../../includes/msconame-md.md)][!INCLUDE[vsprvs](../../includes/vsprvs-md.md)] a pour effet d’inscrire un assembly dans la base de données qui a été spécifiée pour le projet.</span><span class="sxs-lookup"><span data-stu-id="b5917-112">Deploying a SQL Server Project in [!INCLUDE[msCoName](../../includes/msconame-md.md)][!INCLUDE[vsprvs](../../includes/vsprvs-md.md)] registers an assembly in the database that was specified for the project.</span></span> <span data-ttu-id="b5917-113">Le déploiement du projet crée aussi les fonctions CLR dans la base de données pour toutes les méthodes annotées par l'attribut `SqlFunction`.</span><span class="sxs-lookup"><span data-stu-id="b5917-113">Deploying the project also creates CLR functions in the database for all methods annotated with the `SqlFunction` attribute.</span></span> <span data-ttu-id="b5917-114">Pour plus d’informations, consultez [Déploiement d’objets de base de données CLR](../clr-integration/deploying-clr-database-objects.md).</span><span class="sxs-lookup"><span data-stu-id="b5917-114">For more information, see [Deploying CLR Database Objects](../clr-integration/deploying-clr-database-objects.md).</span></span>  
  
> [!NOTE]  
>  <span data-ttu-id="b5917-115">La fonctionnalité d'exécution du code CLR par [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] est désactivée par défaut.</span><span class="sxs-lookup"><span data-stu-id="b5917-115">The ability of [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] to execute CLR code is off by default.</span></span> <span data-ttu-id="b5917-116">Vous pouvez créer, modifier et supprimer des objets de base de données qui font référence à des modules de code managé, mais ces références ne s’exécutent pas dans [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] si l’option [clr enabled](../../database-engine/configure-windows/clr-enabled-server-configuration-option.md) n’est pas activée à l’aide de [sp_configure (Transact-SQL)](/sql/relational-databases/system-stored-procedures/sp-configure-transact-sql).</span><span class="sxs-lookup"><span data-stu-id="b5917-116">You can create, alter, and drop database objects that reference managed code modules, but these references will not execute in [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] unless the [clr enabled Option](../../database-engine/configure-windows/clr-enabled-server-configuration-option.md) is enabled by using [sp_configure (Transact-SQL)](/sql/relational-databases/system-stored-procedures/sp-configure-transact-sql).</span></span>  
  
## <a name="accessing-external-resources"></a><span data-ttu-id="b5917-117">Accès aux ressources externes</span><span class="sxs-lookup"><span data-stu-id="b5917-117">Accessing External Resources</span></span>  
 <span data-ttu-id="b5917-118">Les fonctions CLR peuvent être utilisées pour accéder à des ressources externes telles que des fichiers, des ressources réseau, des services Web et d'autres bases de données (notamment des instances distantes de [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)]).</span><span class="sxs-lookup"><span data-stu-id="b5917-118">CLR functions can be used to access external resources such as files, network resources, Web Services, other databases (including remote instances of [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)]).</span></span> <span data-ttu-id="b5917-119">Pour cela, vous devez utiliser différentes classes dans le [!INCLUDE[dnprdnshort](../../includes/dnprdnshort-md.md)], telles que `System.IO`, `System.WebServices`, `System.Sql`, etc.</span><span class="sxs-lookup"><span data-stu-id="b5917-119">This can be achieved by using various classes in the [!INCLUDE[dnprdnshort](../../includes/dnprdnshort-md.md)], such as `System.IO`, `System.WebServices`, `System.Sql`, and so on.</span></span> <span data-ttu-id="b5917-120">L'assembly qui contient ces fonctions doit être configuré au minimum avec l'autorisation EXTERNAL_ACCESS définie dans ce but.</span><span class="sxs-lookup"><span data-stu-id="b5917-120">The assembly that contains such functions should at least be configured with the EXTERNAL_ACCESS permission set for this purpose.</span></span> <span data-ttu-id="b5917-121">Pour plus d’informations, consultez [CREATE ASSEMBLY &#40;Transact-SQL&#41;](/sql/t-sql/statements/create-assembly-transact-sql).</span><span class="sxs-lookup"><span data-stu-id="b5917-121">For more information, see [CREATE ASSEMBLY &#40;Transact-SQL&#41;](/sql/t-sql/statements/create-assembly-transact-sql).</span></span> <span data-ttu-id="b5917-122">Vous pouvez recourir au fournisseur managé Client SQL pour accéder à des instances distantes de [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)].</span><span class="sxs-lookup"><span data-stu-id="b5917-122">The SQL Client Managed Provider can be used to access remote instances of [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)].</span></span> <span data-ttu-id="b5917-123">Cependant, les connexions de bouclage au serveur d'origine ne sont pas gérées dans les fonctions CLR.</span><span class="sxs-lookup"><span data-stu-id="b5917-123">However, loopback connections to the originating server are not supported in CLR functions.</span></span>  
  
 <span data-ttu-id="b5917-124">**Pour créer, modifier ou supprimer des assemblys dans SQL Server**</span><span class="sxs-lookup"><span data-stu-id="b5917-124">**To create, modify, or drop assemblies in SQL Server**</span></span>  
  
-   [<span data-ttu-id="b5917-125">CREATE ASSEMBLY &#40;Transact-SQL&#41;</span><span class="sxs-lookup"><span data-stu-id="b5917-125">CREATE ASSEMBLY &#40;Transact-SQL&#41;</span></span>](/sql/t-sql/statements/create-assembly-transact-sql)  
  
-   [<span data-ttu-id="b5917-126">ALTER ASSEMBLY &#40;Transact-SQL&#41;</span><span class="sxs-lookup"><span data-stu-id="b5917-126">ALTER ASSEMBLY &#40;Transact-SQL&#41;</span></span>](/sql/t-sql/statements/alter-assembly-transact-sql)  
  
-   [<span data-ttu-id="b5917-127">DROP ASSEMBLY &#40;Transact-SQL&#41;</span><span class="sxs-lookup"><span data-stu-id="b5917-127">DROP ASSEMBLY &#40;Transact-SQL&#41;</span></span>](/sql/t-sql/statements/drop-assembly-transact-sql)  
  
 <span data-ttu-id="b5917-128">**Pour créer une fonction clr**</span><span class="sxs-lookup"><span data-stu-id="b5917-128">**To create a CLR function**</span></span>  
  
-   [<span data-ttu-id="b5917-129">CREATE FUNCTION &#40;Transact-SQL&#41;</span><span class="sxs-lookup"><span data-stu-id="b5917-129">CREATE FUNCTION &#40;Transact-SQL&#41;</span></span>](/sql/t-sql/statements/create-function-transact-sql)  
  
## <a name="accessing-native-code"></a><span data-ttu-id="b5917-130">Accès au code natif</span><span class="sxs-lookup"><span data-stu-id="b5917-130">Accessing Native Code</span></span>  
 <span data-ttu-id="b5917-131">Les fonctions CLR permettent d’accéder au code natif (non managé), tel que le code écrit en C ou C++, via l’utilisation de PInvoke à partir du code managé (pour plus d’informations, consultez [Appel à des fonctions natives à partir de code managé](https://go.microsoft.com/fwlink/?LinkID=181929) ).</span><span class="sxs-lookup"><span data-stu-id="b5917-131">CLR functions can be used to access native (unmanaged) code, such as code written in C or C++, via the use of PInvoke from managed code (see [Calling Native Functions from Managed Code](https://go.microsoft.com/fwlink/?LinkID=181929) for details).</span></span> <span data-ttu-id="b5917-132">Vous pouvez ainsi réutiliser du code hérité en tant que fonctions CLR définies par l'utilisateur ou écrire des fonctions définies par l'utilisateur ayant un impact sur les performances en code natif.</span><span class="sxs-lookup"><span data-stu-id="b5917-132">This can allow you to re-use legacy code as CLR UDFs, or write performance-critical UDFs in native code.</span></span> <span data-ttu-id="b5917-133">L'utilisation d'un assembly UNSAFE est obligatoire.</span><span class="sxs-lookup"><span data-stu-id="b5917-133">This requires using an UNSAFE assembly.</span></span> <span data-ttu-id="b5917-134">Pour connaître les précautions à prendre lors de l’utilisation des assemblys UNSAFE, consultez [Sécurité d’accès du code de l’intégration du CLR](../clr-integration/security/clr-integration-code-access-security.md) .</span><span class="sxs-lookup"><span data-stu-id="b5917-134">See [CLR Integration Code Access Security](../clr-integration/security/clr-integration-code-access-security.md) for cautions about use of UNSAFE assemblies.</span></span>  
  
## <a name="see-also"></a><span data-ttu-id="b5917-135">Voir aussi</span><span class="sxs-lookup"><span data-stu-id="b5917-135">See Also</span></span>  
 <span data-ttu-id="b5917-136">[Créer des fonctions définies par l’utilisateur &#40;moteur de base de données&#41;](create-user-defined-functions-database-engine.md) </span><span class="sxs-lookup"><span data-stu-id="b5917-136">[Create User-defined Functions &#40;Database Engine&#41;](create-user-defined-functions-database-engine.md) </span></span>  
 <span data-ttu-id="b5917-137">[Créer des agrégats définis par l'utilisateur](create-user-defined-aggregates.md) </span><span class="sxs-lookup"><span data-stu-id="b5917-137">[Create User-defined Aggregates](create-user-defined-aggregates.md) </span></span>  
 <span data-ttu-id="b5917-138">[Exécuter les fonctions définies par l'utilisateur](execute-user-defined-functions.md) </span><span class="sxs-lookup"><span data-stu-id="b5917-138">[Execute User-defined Functions](execute-user-defined-functions.md) </span></span>  
 <span data-ttu-id="b5917-139">[Afficher les fonctions définies par l'utilisateur](view-user-defined-functions.md) </span><span class="sxs-lookup"><span data-stu-id="b5917-139">[View User-defined Functions](view-user-defined-functions.md) </span></span>  
 [<span data-ttu-id="b5917-140">Concepts de programmation pour l’intégration du CLR &#40;Common Language Runtime&#41;</span><span class="sxs-lookup"><span data-stu-id="b5917-140">Common Language Runtime &#40;CLR&#41; Integration Programming Concepts</span></span>](../clr-integration/common-language-runtime-clr-integration-programming-concepts.md)  
  
  
