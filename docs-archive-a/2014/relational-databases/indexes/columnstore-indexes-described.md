---
title: Index ColumnStore décrits | Microsoft Docs
ms.custom: ''
ms.date: 03/07/2017
ms.prod: sql-server-2014
ms.reviewer: ''
ms.technology: table-view-index
ms.topic: conceptual
helpviewer_keywords:
- indexes creation, columnstore
- indexes [SQL Server], columnstore
- columnstore index
- columnstore index, described
- xVelocity, columnstore indexes
ms.assetid: f98af4a5-4523-43b1-be8d-1b03c3217839
author: mikeraymsft
ms.author: mikeray
ms.openlocfilehash: 80a29b8e8cc5b53c09369156a5cf5f717e9447a0
ms.sourcegitcommit: ad4d92dce894592a259721a1571b1d8736abacdb
ms.translationtype: MT
ms.contentlocale: fr-FR
ms.lasthandoff: 08/04/2020
ms.locfileid: "87708320"
---
# <a name="columnstore-indexes-described"></a><span data-ttu-id="be061-102">Columnstore Indexes Described</span><span class="sxs-lookup"><span data-stu-id="be061-102">Columnstore Indexes Described</span></span>
  <span data-ttu-id="be061-103">L' [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] *index ColumnStore en mémoire* stocke et gère des données à l’aide du stockage de données basé sur les colonnes et du traitement de requête basé sur les colonnes.</span><span class="sxs-lookup"><span data-stu-id="be061-103">The [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] *in-memory columnstore index* stores and manages data by using column-based data storage and column-based query processing.</span></span> <span data-ttu-id="be061-104">Les index columnstore fonctionnent bien pour les charges de travail de stockage de données qui effectuent principalement des chargements en masse et des requêtes en lecture seule.</span><span class="sxs-lookup"><span data-stu-id="be061-104">Columnstore indexes work well for data warehousing workloads that primarily perform bulk loads and read-only queries.</span></span> <span data-ttu-id="be061-105">Utilisez l’index columnstore pour atteindre des **performances des requêtes** pouvant être multipliées par 10 par rapport au stockage orienté lignes traditionnel, et une **compression de données** multipliée par 7 par rapport à la taille des données non compressées.</span><span class="sxs-lookup"><span data-stu-id="be061-105">Use the columnstore index to achieve up to **10x query performance** gains over traditional row-oriented storage, and up to **7x data compression** over the uncompressed data size.</span></span>

> [!NOTE]
>  <span data-ttu-id="be061-106">Nous considérons l'index columnstore cluster comme étant la norme pour le stockage de grandes tables de faits de stockage des données, et nous pensons qu'il va être utilisé dans la plupart des scénarios de stockage des données.</span><span class="sxs-lookup"><span data-stu-id="be061-106">We view the clustered columnstore index as the standard for storing large data warehousing fact tables, and expect it will be used in most data warehousing scenarios.</span></span> <span data-ttu-id="be061-107">Étant donné que l'index columnstore cluster est modifiable, votre charge de travail peut exécuter un grand nombre d'insertions, mises à jour, et suppressions.</span><span class="sxs-lookup"><span data-stu-id="be061-107">Since the clustered columnstore index is updateable, your workload can perform a large number of insert, update, and delete operations.</span></span>

## <a name="contents"></a><span data-ttu-id="be061-108">Contenu</span><span class="sxs-lookup"><span data-stu-id="be061-108">Contents</span></span>

-   [<span data-ttu-id="be061-109">Concepts de base</span><span class="sxs-lookup"><span data-stu-id="be061-109">Basics</span></span>](#basics)

-   [<span data-ttu-id="be061-110">Chargement de données</span><span class="sxs-lookup"><span data-stu-id="be061-110">Loading Data</span></span>](#dataload)

-   [<span data-ttu-id="be061-111">Conseils sur les performances</span><span class="sxs-lookup"><span data-stu-id="be061-111">Performance Tips</span></span>](#performance)

-   [<span data-ttu-id="be061-112">Tâches et rubriques connexes</span><span class="sxs-lookup"><span data-stu-id="be061-112">Related Tasks and Topics</span></span>](#related)

##  <a name="basics"></a><a name="basics"></a><span data-ttu-id="be061-113">Fondamentaux</span><span class="sxs-lookup"><span data-stu-id="be061-113">Basics</span></span>
 <span data-ttu-id="be061-114">Un *columnstore index* est une technologie permettant de stocker, extraire et gérer les données à l'aide d'un format de données en colonnes, appelé columnstore.</span><span class="sxs-lookup"><span data-stu-id="be061-114">A *columnstore index* is a technology for storing, retrieving and managing data by using a columnar data format, called a columnstore.</span></span> [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] <span data-ttu-id="be061-115">prend en charge les index columnstore cluster et non cluster.</span><span class="sxs-lookup"><span data-stu-id="be061-115">supports both clustered and nonclustered columnstore indexes.</span></span> <span data-ttu-id="be061-116">Les deux utilisent la même technologie columnstore en mémoire, mais sont différents en ce qui concerne leur but et les fonctionnalités qu'ils prennent en charge.</span><span class="sxs-lookup"><span data-stu-id="be061-116">Both use the same in-memory columnstore technology, but they do have differences in purpose and in features they support.</span></span>

###  <a name="benefits"></a><a name="benefits"></a> <span data-ttu-id="be061-117">Avantages</span><span class="sxs-lookup"><span data-stu-id="be061-117">Benefits</span></span>
 <span data-ttu-id="be061-118">Les index columnstore fonctionnent bien pour la plupart des requêtes en lecture seule qui effectuent des analyses sur des ensembles de données volumineux.</span><span class="sxs-lookup"><span data-stu-id="be061-118">Columnstore indexes work well for mostly read-only queries that perform analysis on large data sets.</span></span> <span data-ttu-id="be061-119">Bien souvent, il s'agit de requêtes destinées à des charges de travail de stockage de données.</span><span class="sxs-lookup"><span data-stu-id="be061-119">Often, these are queries for data warehousing workloads.</span></span> <span data-ttu-id="be061-120">Les index columnstore offrent des gains de performances importants pour les requêtes qui utilisent des analyses de table complètes, et ne conviennent pas pour les requêtes qui effectuent des opérations de recherche de données, notamment qui recherchent une valeur particulière.</span><span class="sxs-lookup"><span data-stu-id="be061-120">Columnstore indexes give high performance gains for queries that use full table scans, and are not well-suited for queries that seek into the data, searching for a particular value.</span></span>

 <span data-ttu-id="be061-121">Avantages de l'index columnstore :</span><span class="sxs-lookup"><span data-stu-id="be061-121">Columnstore Index benefits:</span></span>

-   <span data-ttu-id="be061-122">Les colonnes contenant souvent des données similaires, les taux de compression sont élevés.</span><span class="sxs-lookup"><span data-stu-id="be061-122">Columns often have similar data, which results in high compression rates.</span></span>

-   <span data-ttu-id="be061-123">Les taux de compression élevés améliorent les performances des requêtes en utilisant un plus faible encombrement en mémoire.</span><span class="sxs-lookup"><span data-stu-id="be061-123">High compression rates improve query performance by using a smaller in-memory footprint.</span></span> <span data-ttu-id="be061-124">En conséquence, les performances des requêtes sont améliorées, car [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] peut exécuter davantage d'opérations de requêtes et sur les données en mémoire.</span><span class="sxs-lookup"><span data-stu-id="be061-124">In turn, query performance can improve because [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] can perform more query and data operations in-memory.</span></span>

-   <span data-ttu-id="be061-125">Un nouveau mécanisme d'exécution de requête, appelé « exécution en mode batch » a été ajouté à SQL Server pour réduire considérablement l'utilisation de l'UC.</span><span class="sxs-lookup"><span data-stu-id="be061-125">A new query execution mechanism called batch-mode execution has been added to SQL Server that reduces CPU usage by a large amount.</span></span> <span data-ttu-id="be061-126">L'exécution en mode batch est étroitement intégrée avec (et optimisée pour) le format de stockage columnstore.</span><span class="sxs-lookup"><span data-stu-id="be061-126">Batch-mode execution is closely integrated with, and optimized around, the columnstore storage format.</span></span> <span data-ttu-id="be061-127">L'exécution en mode batch est parfois appelée « exécution vectorielle ou vectorisée ».</span><span class="sxs-lookup"><span data-stu-id="be061-127">Batch-mode execution is sometimes known as vector-based or vectorized execution.</span></span>

-   <span data-ttu-id="be061-128">Les requêtes sélectionnent souvent seulement quelques colonnes d'une table, ce qui réduit les E/S totales à partir du support physique.</span><span class="sxs-lookup"><span data-stu-id="be061-128">Queries often select only a few columns from a table, which reduces total I/O from the physical media.</span></span>

### <a name="columnstore-versions"></a><span data-ttu-id="be061-129">Versions de columnstore</span><span class="sxs-lookup"><span data-stu-id="be061-129">Columnstore Versions</span></span>
 <span data-ttu-id="be061-130">SQL Server 2012, SQL Server 2012 Parallel Data Warehouse, et SQL Server 2014 utilisent tous des index columnstore pour accélérer les requêtes d'entrepôts de données communs.</span><span class="sxs-lookup"><span data-stu-id="be061-130">SQL Server 2012, SQL Server 2012 Parallel Data Warehouse, and SQL Server 2014 all use columnstore indexes to accelerate common data warehouse queries.</span></span> <span data-ttu-id="be061-131">SQL Server 2012 introduit deux nouvelles fonctionnalités : un index columnstore non cluster et une fonction d'exécution de requête vectorielle qui traite les données dans des unités appelées « lots ».</span><span class="sxs-lookup"><span data-stu-id="be061-131">SQL Server 2012 introduced two new features: a nonclustered columnstore index and a vector-based query execution capability that processes data in units called "batches."</span></span> <span data-ttu-id="be061-132">SQL Server 2014 contient les fonctionnalités de SQL Server 2012 plus des index columnstore cluster pouvant être mis à jour.</span><span class="sxs-lookup"><span data-stu-id="be061-132">SQL Server 2014 has the features of SQL Server 2012 plus updateable clustered columnstore indexes.</span></span>

### <a name="key-characteristics"></a><span data-ttu-id="be061-133">Caractéristiques clés</span><span class="sxs-lookup"><span data-stu-id="be061-133">Key Characteristics</span></span>

||
|-|
|<span data-ttu-id="be061-134">**S'applique à**: [!INCLUDE[ssSQL14](../../includes/sssql14-md.md)] jusqu'à [!INCLUDE[ssCurrent](../../../includes/sscurrent-md.md)].</span><span class="sxs-lookup"><span data-stu-id="be061-134">**Applies to**: [!INCLUDE[ssSQL14](../../includes/sssql14-md.md)] through [!INCLUDE[ssCurrent](../../../includes/sscurrent-md.md)].</span></span>|

 <span data-ttu-id="be061-135">Dans [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)], un index columnstore :</span><span class="sxs-lookup"><span data-stu-id="be061-135">In [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)], a clustered columnstore index:</span></span>

-   <span data-ttu-id="be061-136">Est disponible dans les éditions Enterprise, Developer et Evaluation.</span><span class="sxs-lookup"><span data-stu-id="be061-136">Is available in Enterprise, Developer, and Evaluation editions.</span></span>

-   <span data-ttu-id="be061-137">Peut être mis à jour.</span><span class="sxs-lookup"><span data-stu-id="be061-137">Is updateable.</span></span>

-   <span data-ttu-id="be061-138">Est la méthode de stockage principale de la table entière.</span><span class="sxs-lookup"><span data-stu-id="be061-138">Is the primary storage method for the entire table.</span></span>

-   <span data-ttu-id="be061-139">N'a pas de colonnes clés.</span><span class="sxs-lookup"><span data-stu-id="be061-139">Has no key columns.</span></span> <span data-ttu-id="be061-140">Toutes les colonnes sont des colonnes incluses.</span><span class="sxs-lookup"><span data-stu-id="be061-140">All columns are included columns.</span></span>

-   <span data-ttu-id="be061-141">Est le seul index sur la table.</span><span class="sxs-lookup"><span data-stu-id="be061-141">Is the only index on the table.</span></span> <span data-ttu-id="be061-142">Ne peut pas être associé à d'autres index.</span><span class="sxs-lookup"><span data-stu-id="be061-142">It cannot be combined with any other indexes.</span></span>

-   <span data-ttu-id="be061-143">Peut être configuré pour utiliser columnstore ou la compression d'archivage columnstore.</span><span class="sxs-lookup"><span data-stu-id="be061-143">Can be configured to use columnstore or columnstore archival compression.</span></span>

-   <span data-ttu-id="be061-144">Ne stocke pas physiquement les colonnes dans un ordre de tri.</span><span class="sxs-lookup"><span data-stu-id="be061-144">Does not physically store columns in a sorted order.</span></span> <span data-ttu-id="be061-145">Au lieu de cela, il stocke les données pour améliorer la compression et les performances.</span><span class="sxs-lookup"><span data-stu-id="be061-145">Instead, it stores data to improve compression and performance.</span></span>

||
|-|
|<span data-ttu-id="be061-146">**S'applique à**: [!INCLUDE[ssSQL11](../../includes/sssql11-md.md)] jusqu'à [!INCLUDE[ssCurrent](../../../includes/sscurrent-md.md)].</span><span class="sxs-lookup"><span data-stu-id="be061-146">**Applies to**: [!INCLUDE[ssSQL11](../../includes/sssql11-md.md)] through [!INCLUDE[ssCurrent](../../../includes/sscurrent-md.md)].</span></span>|

 <span data-ttu-id="be061-147">Dans [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)], un index non cluster :</span><span class="sxs-lookup"><span data-stu-id="be061-147">In [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)], a nonclustered columnstore index:</span></span>

-   <span data-ttu-id="be061-148">Peut indexer un sous-ensemble de colonnes dans l'index cluster ou le segment de mémoire.</span><span class="sxs-lookup"><span data-stu-id="be061-148">Can index a subset of columns in the clustered index or heap.</span></span> <span data-ttu-id="be061-149">Par exemple, il peut indexer les colonnes utilisées fréquemment.</span><span class="sxs-lookup"><span data-stu-id="be061-149">For example, it can index the frequently used columns.</span></span>

-   <span data-ttu-id="be061-150">Nécessite un stockage supplémentaire pour stocker une copie des colonnes dans l'index.</span><span class="sxs-lookup"><span data-stu-id="be061-150">Requires extra storage to store a copy of the columns in the index.</span></span>

-   <span data-ttu-id="be061-151">Est mis à jour par la reconstruction de l’index ou le basculement des partitions. Elle ne peut pas être mise à jour à l’aide d’opérations DML telles que l’insertion, la mise à jour et la suppression.</span><span class="sxs-lookup"><span data-stu-id="be061-151">Is updated by rebuilding the index or switching partitions in and out. It is not updateable by using the DML operations such as insert, update, and delete.</span></span>

-   <span data-ttu-id="be061-152">Peut être associé à d'autres index sur la table.</span><span class="sxs-lookup"><span data-stu-id="be061-152">Can be combined with other indexes on the table.</span></span>

-   <span data-ttu-id="be061-153">Peut être configuré pour utiliser columnstore ou la compression d'archivage columnstore.</span><span class="sxs-lookup"><span data-stu-id="be061-153">Can be configured to use columnstore or columnstore archival compression.</span></span>

-   <span data-ttu-id="be061-154">Ne stocke pas physiquement les colonnes dans un ordre de tri.</span><span class="sxs-lookup"><span data-stu-id="be061-154">Does not physically store columns in a sorted order.</span></span> <span data-ttu-id="be061-155">Au lieu de cela, il stocke les données pour améliorer la compression et les performances.</span><span class="sxs-lookup"><span data-stu-id="be061-155">Instead, it stores data to improve compression and performance.</span></span> <span data-ttu-id="be061-156">Le prétri des données avant de créer l'index columnstore n'est pas requis, mais cela peut améliorer la compression columnstore.</span><span class="sxs-lookup"><span data-stu-id="be061-156">Pre-sorting the data before creating the columnstore index is not required, but can improve columnstore compression.</span></span>

###  <a name="key-concepts-and-terms"></a><a name="Concepts"></a><span data-ttu-id="be061-157">Concepts et termes clés</span><span class="sxs-lookup"><span data-stu-id="be061-157">Key Concepts and Terms</span></span>
 <span data-ttu-id="be061-158">Les termes et concepts clés suivants sont associés aux index columnstore.</span><span class="sxs-lookup"><span data-stu-id="be061-158">The following key terms and concepts are associated with columnstore indexes.</span></span>

 <span data-ttu-id="be061-159">index ColumnStore un *index ColumnStore* est une technologie de stockage, de récupération et de gestion des données à l’aide d’un format de données en colonnes, appelé ColumnStore.</span><span class="sxs-lookup"><span data-stu-id="be061-159">columnstore index A *columnstore index* is a technology for storing, retrieving and managing data by using a columnar data format, called a columnstore.</span></span> [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] <span data-ttu-id="be061-160">prend en charge les index columnstore cluster et non cluster.</span><span class="sxs-lookup"><span data-stu-id="be061-160">supports both clustered and nonclustered columnstore indexes.</span></span> <span data-ttu-id="be061-161">Les deux utilisent la même technologie columnstore en mémoire, mais sont différents en ce qui concerne leur but et les fonctionnalités qu'ils prennent en charge.</span><span class="sxs-lookup"><span data-stu-id="be061-161">Both use the same in-memory columnstore technology, but they do have differences in purpose and in features they support.</span></span>

 <span data-ttu-id="be061-162">ColumnStore un *ColumnStore* est constitué de données logiquement organisées sous la forme d’une table avec des lignes et des colonnes, et stockées physiquement dans un format de données selon les colonnes.</span><span class="sxs-lookup"><span data-stu-id="be061-162">columnstore A *columnstore* is data that is logically organized as a table with rows and columns, and physically stored in a column-wise data format.</span></span>

 <span data-ttu-id="be061-163">rowstore un *rowstore* est constitué de données logiquement organisées sous la forme d’une table avec des lignes et des colonnes, puis stockées physiquement dans un format de données selon les lignes.</span><span class="sxs-lookup"><span data-stu-id="be061-163">rowstore A *rowstore* is data that is logically organized as a table with rows and columns, and then physically stored in a row-wise data format.</span></span> <span data-ttu-id="be061-164">Il s'agit de la méthode traditionnelle de stockage des données de table relationnelles.</span><span class="sxs-lookup"><span data-stu-id="be061-164">This has been the traditional way to store relational table data.</span></span>

 <span data-ttu-id="be061-165">RowGroups et les segments de colonne pour des performances élevées et des taux de compression élevés, l’index ColumnStore découpe la table en groupes de lignes, appelés groupes de lignes, puis compresse chaque groupe de lignes selon les colonnes.</span><span class="sxs-lookup"><span data-stu-id="be061-165">rowgroups and column segments For high performance and high compression rates, the columnstore index slices the table into groups of rows, called row groups, and then compresses each row group in a column-wise manner.</span></span> <span data-ttu-id="be061-166">Le nombre de lignes dans le groupe de lignes doit être assez grand pour améliorer le taux de compression, et assez petit tirer parti des opérations en mémoire.</span><span class="sxs-lookup"><span data-stu-id="be061-166">The number of rows in the row group must be large enough to improve compression rates, and small enough to benefit from in-memory operations.</span></span>

 <span data-ttu-id="be061-167">Groupe de lignes un *rowgroup* est un groupe de lignes qui sont compressées au format ColumnStore en même temps.</span><span class="sxs-lookup"><span data-stu-id="be061-167">row group A *rowgroup* is a group of rows that are compressed into columnstore format at the same time.</span></span>

 <span data-ttu-id="be061-168">segment de colonne un *segment de colonne* est une colonne de données dans le rowgroup.</span><span class="sxs-lookup"><span data-stu-id="be061-168">column segment A *column segment* is a column of data from within the rowgroup.</span></span>

-   <span data-ttu-id="be061-169">Un rowgroup contient généralement le nombre maximal de lignes par rowgroup qui est de 1 048 576 lignes.</span><span class="sxs-lookup"><span data-stu-id="be061-169">A rowgroup usually contains the maximum number of rows per rowgroup which is 1,048,576 rows.</span></span>

-   <span data-ttu-id="be061-170">Chaque rowgroup contient un segment de colonne pour chaque colonne dans la table.</span><span class="sxs-lookup"><span data-stu-id="be061-170">Each rowgroup contains one column segment for every column in the table.</span></span>

-   <span data-ttu-id="be061-171">Chaque segment de colonne est compressé et stocké sur un support physique.</span><span class="sxs-lookup"><span data-stu-id="be061-171">Each column segment is compressed together and stored on physical media.</span></span>

 <span data-ttu-id="be061-172">![Segment de colonne](../../database-engine/media/sql-server-pdw-columnstore-columnsegment.gif "segment de colonne")</span><span class="sxs-lookup"><span data-stu-id="be061-172">![Column segment](../../database-engine/media/sql-server-pdw-columnstore-columnsegment.gif "Column segment")</span></span>

 <span data-ttu-id="be061-173">index ColumnStore non cluster un *index ColumnStore non cluster* est un index en lecture seule créé sur un index cluster existant ou une table de segments de mémoire.</span><span class="sxs-lookup"><span data-stu-id="be061-173">nonclustered columnstore index A *nonclustered columnstore index* is a read-only index created on an existing clustered index or heap table.</span></span> <span data-ttu-id="be061-174">Il contient une copie d'un sous-ensemble de colonnes, et peut contenir toutes les colonnes de la table.</span><span class="sxs-lookup"><span data-stu-id="be061-174">It contains a copy of a subset of columns, up to and including all of the columns in the table..</span></span> <span data-ttu-id="be061-175">La table est en lecture seule alors qu’elle contient un index ColumnStore non cluster.</span><span class="sxs-lookup"><span data-stu-id="be061-175">The table is read-only while it contains a nonclustered columnstore index.</span></span>

 <span data-ttu-id="be061-176">Un index columnstore non cluster permet d'avoir un index columnstore pour exécuter les requêtes d'analyse tout en exécutant des opérations en lecture seule sur la table d'origine.</span><span class="sxs-lookup"><span data-stu-id="be061-176">A nonclustered columnstore index provides a way to have a columnstore index for running analysis queries while at the same time performing read-only operations on the original table.</span></span>

 <span data-ttu-id="be061-177">![index columnstore non cluster](../../database-engine/media/sql-server-pdw-columnstore-physicalstorage-nonclustered.gif "index columnstore non cluster")</span><span class="sxs-lookup"><span data-stu-id="be061-177">![Nonclustered columnstore index](../../database-engine/media/sql-server-pdw-columnstore-physicalstorage-nonclustered.gif "Nonclustered columnstore index")</span></span>

 <span data-ttu-id="be061-178">index ColumnStore cluster un *index ColumnStore cluster* est le stockage physique de la table entière et est le seul index de la table.</span><span class="sxs-lookup"><span data-stu-id="be061-178">clustered columnstore index A *clustered columnstore index* is the physical storage for the entire table and is the only index for the table.</span></span> <span data-ttu-id="be061-179">L'index cluster peut être mis à jour.</span><span class="sxs-lookup"><span data-stu-id="be061-179">The clustered index is updateable.</span></span> <span data-ttu-id="be061-180">Effectuez des opérations d'insertion, suppression, et mise à jour sur l'index et chargez en masse des données dans l'index.</span><span class="sxs-lookup"><span data-stu-id="be061-180">You can perform insert, delete, and update operations on the index and you can bulk load data into the index.</span></span>

 <span data-ttu-id="be061-181">![Index cluster columnstore](../../database-engine/media/sql-server-pdw-columnstore-physicalstorage.gif "Index columstore en cluster")</span><span class="sxs-lookup"><span data-stu-id="be061-181">![Clustered Columnstore Index](../../database-engine/media/sql-server-pdw-columnstore-physicalstorage.gif "Clustered Columnstore Index")</span></span>

 <span data-ttu-id="be061-182">Pour réduire la fragmentation des segments de colonne et améliorer les performances, l'index columnstore peut stocker des données temporaires dans une table rowstore, appelée un deltastore, plus un arbre B d'ID pour les lignes supprimées.</span><span class="sxs-lookup"><span data-stu-id="be061-182">To reduce fragmentation of the column segments and improve performance, the columnstore index might store some data temporarily into a rowstore table, called a deltastore, plus a B-Tree of IDs for deleted rows.</span></span> <span data-ttu-id="be061-183">Les opérations deltastore sont effectuées en coulisse.</span><span class="sxs-lookup"><span data-stu-id="be061-183">The deltastore operations are handled behind the scenes.</span></span> <span data-ttu-id="be061-184">Pour retourner des résultats de requête corrects, l'index columnstore cluster associe les résultats de columnstore et de deltastore.</span><span class="sxs-lookup"><span data-stu-id="be061-184">To return the correct query results, the clustered columnstore index combines query results from both the columnstore and the deltastore.</span></span>

 <span data-ttu-id="be061-185">deltastore utilisé avec les index cluster ColumnStore uniquement, un *deltastore* est une table rowstore qui stocke des lignes jusqu’à ce que le nombre de lignes soit suffisamment important pour être déplacé dans le ColumnStore.</span><span class="sxs-lookup"><span data-stu-id="be061-185">deltastore Used with clustered columnstore indexes only, a *deltastore* is a rowstore table that stores rows until the number of rows is large enough to be moved into the columnstore.</span></span> <span data-ttu-id="be061-186">Un deltastore est utilisé avec des index columnstore cluster pour améliorer les performances du chargement et d'autres opérations DML.</span><span class="sxs-lookup"><span data-stu-id="be061-186">A deltastore is used with clustered columnstore indexes to improve performance for loading and other DML operations.</span></span>

 <span data-ttu-id="be061-187">Lors d'un chargement en masse important, la plupart des lignes sont directement placées dans le columnstore sans passer par le deltastore.</span><span class="sxs-lookup"><span data-stu-id="be061-187">During a large bulk load, most of the rows go directly to the columnstore without passing through the deltastore.</span></span> <span data-ttu-id="be061-188">Certaines lignes à la fin du chargement en masse peuvent être en trop petit nombre pour atteindre la taille minimale d'un rowgroup, qui est de 102 400 lignes.</span><span class="sxs-lookup"><span data-stu-id="be061-188">Some rows at the end of the bulk load might be too few in number to meet the minimum size of a rowgroup which is 102,400 rows.</span></span> <span data-ttu-id="be061-189">Dans ce cas, les lignes finales sont placées dans le deltastore plutôt que dans le columnstore.</span><span class="sxs-lookup"><span data-stu-id="be061-189">When this happens, the final rows go to the deltastore instead of the columnstore.</span></span> <span data-ttu-id="be061-190">Pour les petits chargements en masse de taille inférieure à 102 400 lignes, toutes les lignes vont directement au deltastore.</span><span class="sxs-lookup"><span data-stu-id="be061-190">For small bulk loads with less than 102,400 rows, all of the rows go directly to the deltastore.</span></span>

 <span data-ttu-id="be061-191">Lorsque le deltastore atteint le nombre maximal de lignes, il est fermé.</span><span class="sxs-lookup"><span data-stu-id="be061-191">When the deltastore reaches the maximum number of rows, it becomes closed.</span></span> <span data-ttu-id="be061-192">Un processus de déplacement de tuple vérifie les groupes de lignes fermés.</span><span class="sxs-lookup"><span data-stu-id="be061-192">A tuple-move process checks for closed row groups.</span></span> <span data-ttu-id="be061-193">Lorsqu'il trouve un rowgroup fermé, il le compresse et le stocke dans le columnstore.</span><span class="sxs-lookup"><span data-stu-id="be061-193">When it finds the closed rowgroup, it compresses it and stores it into the columnstore.</span></span>

##  <a name="loading-data"></a><a name="dataload"></a><span data-ttu-id="be061-194">Chargement de données</span><span class="sxs-lookup"><span data-stu-id="be061-194">Loading Data</span></span>

###  <a name="loading-data-into-a-nonclustered-columnstore-index"></a><a name="dataload_nci"></a><span data-ttu-id="be061-195">Chargement de données dans un index ColumnStore non cluster</span><span class="sxs-lookup"><span data-stu-id="be061-195">Loading Data into a Nonclustered Columnstore Index</span></span>
 <span data-ttu-id="be061-196">Pour charger des données dans un index ColumnStore non cluster, chargez d’abord les données dans une table rowstore traditionnelle stockée en tant que segment de mémoire ou index cluster, puis créez l’index non cluster ColumnStore avec [Create COLUMNSTORE index &#40;Transact-SQL&#41;](/sql/t-sql/statements/create-columnstore-index-transact-sql).</span><span class="sxs-lookup"><span data-stu-id="be061-196">To load data into a nonclustered columnstore index, first load data into a traditional rowstore table stored as a heap or clustered index, and then create the nonclustered columnstore index with [CREATE COLUMNSTORE INDEX &#40;Transact-SQL&#41;](/sql/t-sql/statements/create-columnstore-index-transact-sql).</span></span>

 <span data-ttu-id="be061-197">![Chargement de données dans un index columnstore](../../database-engine/media/sql-server-pdw-columnstore-loadprocess-nonclustered.gif "Chargement de données dans un index columnstore")</span><span class="sxs-lookup"><span data-stu-id="be061-197">![Loading data into a columnstore index](../../database-engine/media/sql-server-pdw-columnstore-loadprocess-nonclustered.gif "Loading data into a columnstore index")</span></span>

 <span data-ttu-id="be061-198">Une table avec un index columnstore non cluster est en lecture seule jusqu'à ce que l'index soit désactivé ou supprimé.</span><span class="sxs-lookup"><span data-stu-id="be061-198">A table with a nonclustered columnstore index is read-only until the index is dropped or disabled.</span></span> <span data-ttu-id="be061-199">Pour mettre à jour la table et l’index ColumnStore non-cluster, vous pouvez basculer les partitions. Vous pouvez également désactiver l’index, mettre à jour la table, puis reconstruire l’index.</span><span class="sxs-lookup"><span data-stu-id="be061-199">To update the table and the nonclustered columnstore index you can switch partitions in and out. You can also disable the index, update the table, and then rebuild the index.</span></span>

 <span data-ttu-id="be061-200">Pour plus d'informations, consultez [Using Nonclustered Columnstore Indexes](indexes.md)</span><span class="sxs-lookup"><span data-stu-id="be061-200">For more information see [Using Nonclustered Columnstore Indexes](indexes.md)</span></span>

###  <a name="loading-data-into-a-clustered-columnstore-index"></a><a name="dataload_cci"></a><span data-ttu-id="be061-201">Chargement de données dans un index ColumnStore cluster</span><span class="sxs-lookup"><span data-stu-id="be061-201">Loading Data into a Clustered Columnstore Index</span></span>
 <span data-ttu-id="be061-202">![Chargement dans un index columnstore cluster](../../database-engine/media/sql-server-pdw-columnstore-loadprocess.gif "Chargement dans un index columnstore cluster")</span><span class="sxs-lookup"><span data-stu-id="be061-202">![Loading into a clustered columnstore index](../../database-engine/media/sql-server-pdw-columnstore-loadprocess.gif "Loading into a clustered columnstore index")</span></span>

 <span data-ttu-id="be061-203">Comme le suggère le diagramme, pour charger des données dans un index columnstore cluster, [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)]:</span><span class="sxs-lookup"><span data-stu-id="be061-203">As the diagram suggests, to load data into a clustered columnstore index, [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)]:</span></span>

1.  <span data-ttu-id="be061-204">Insère les rowgroups de taille maximale directement dans le columnstore.</span><span class="sxs-lookup"><span data-stu-id="be061-204">Inserts maximum-size rowgroups directly into the columnstore.</span></span> <span data-ttu-id="be061-205">Lorsque les données sont chargées, [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] affecte les lignes de données dans l'ordre premier arrivé premier servi dans un rowgroup ouvert.</span><span class="sxs-lookup"><span data-stu-id="be061-205">As the data is loaded, [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] assigns the data rows in a first-come first-serve order into an open rowgroup.</span></span>

2.  <span data-ttu-id="be061-206">Pour chaque rowgroup, après qu'il a atteint la taille maximale, [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)]:</span><span class="sxs-lookup"><span data-stu-id="be061-206">For each rowgroup, after it reaches the maximum size, [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)]:</span></span>

    1.  <span data-ttu-id="be061-207">Marque le rowgroup comme étant CLOSED.</span><span class="sxs-lookup"><span data-stu-id="be061-207">Marks the rowgroup as CLOSED.</span></span>

    2.  <span data-ttu-id="be061-208">Ignore le deltastore.</span><span class="sxs-lookup"><span data-stu-id="be061-208">Bypasses the deltastore.</span></span>

    3.  <span data-ttu-id="be061-209">Compresse chaque segment de colonne avec le rowgroup à l'aide de la compression columnstore.</span><span class="sxs-lookup"><span data-stu-id="be061-209">Compresses each column segment with the rowgroup with columnstore compression.</span></span>

    4.  <span data-ttu-id="be061-210">Stocke physiquement chaque segment de colonne compressé dans le columnstore.</span><span class="sxs-lookup"><span data-stu-id="be061-210">Physically stores each compressed column segment into the columnstore.</span></span>

3.  <span data-ttu-id="be061-211">Insère les lignes restantes dans le columnstore ou le deltastore comme suit :</span><span class="sxs-lookup"><span data-stu-id="be061-211">Inserts the remaining rows into the columnstore or the deltastore as follows:</span></span>

    1.  <span data-ttu-id="be061-212">Si le nombre de lignes répond à l'exigence de nombre de lignes minimal par rowgroup, les lignes sont ajoutées au columnstore.</span><span class="sxs-lookup"><span data-stu-id="be061-212">If the number of rows meets the minimum rows per rowgroup requirement, the rows are added to the columnstore.</span></span>

    2.  <span data-ttu-id="be061-213">Si le nombre de lignes est inférieur au nombre de lignes minimal par rowgroup, les lignes sont ajoutées au deltastore.</span><span class="sxs-lookup"><span data-stu-id="be061-213">If the number of rows is less than the minimum rows per rowgroup, the rows are added to the deltastore.</span></span>

 <span data-ttu-id="be061-214">Pour plus d'informations sur les tâches et les processus deltastore, consultez [Using Clustered Columnstore Indexes](../../database-engine/using-clustered-columnstore-indexes.md)</span><span class="sxs-lookup"><span data-stu-id="be061-214">For more information about deltastore tasks and processes, see [Using Clustered Columnstore Indexes](../../database-engine/using-clustered-columnstore-indexes.md)</span></span>

##  <a name="performance-tips"></a><a name="performance"></a><span data-ttu-id="be061-215">Conseils sur les performances</span><span class="sxs-lookup"><span data-stu-id="be061-215">Performance Tips</span></span>

### <a name="plan-for-enough-memory-to-create-columnstore-indexes-in-parallel"></a><span data-ttu-id="be061-216">Planifiez suffisamment de mémoire pour créer des index columnstore en parallèle</span><span class="sxs-lookup"><span data-stu-id="be061-216">Plan for enough memory to create columnstore indexes in parallel</span></span>
 <span data-ttu-id="be061-217">La création d'un index columnstore par défaut est une opération parallèle tant que la mémoire est contrainte.</span><span class="sxs-lookup"><span data-stu-id="be061-217">Creating a columnstore index is by default a parallel operation unless memory is constrained.</span></span> <span data-ttu-id="be061-218">La création de l'index en parallèle requiert plus de mémoire que la création de l'index en série.</span><span class="sxs-lookup"><span data-stu-id="be061-218">Creating the index in parallel requires more memory than creating the index serially.</span></span> <span data-ttu-id="be061-219">Lorsqu'il y a suffisamment de mémoire, la création d'un index columnstore prend 1,5 fois plus de temps que créer un arbre B sur les mêmes colonnes.</span><span class="sxs-lookup"><span data-stu-id="be061-219">When there is ample memory, creating a columnstore index takes on the order of 1.5 times as long as building a B-tree on the same columns.</span></span>

 <span data-ttu-id="be061-220">La mémoire requise pour créer un index columnstore dépend du nombre de colonnes, du nombre de colonnes de chaîne, du degré de parallélisme (DOP), et des caractéristiques des données.</span><span class="sxs-lookup"><span data-stu-id="be061-220">The memory required for creating a columnstore index depends on the number of columns, the number of string columns, the degree of parallelism (DOP), and the characteristics of the data.</span></span> <span data-ttu-id="be061-221">Par exemple, si la table a moins d'un million de lignes, SQL Server utilisera un seul thread pour créer l'index columnstore.</span><span class="sxs-lookup"><span data-stu-id="be061-221">For example, if your table has fewer than one million rows, SQL Server will use only one thread to create the columnstore index.</span></span>

 <span data-ttu-id="be061-222">Si votre table a plus d'un million de lignes, mais SQL Server ne peut pas obtenir suffisamment d'allocation de mémoire pour créer l'index à l'aide de MAXDOP, il réduira automatiquement MAXDOP de sorte qu'il tienne dans l'allocation de mémoire disponible.</span><span class="sxs-lookup"><span data-stu-id="be061-222">If your table has more than one million rows, but SQL Server cannot get a large enough memory grant to create the index using MAXDOP, SQL Server will automatically decrease MAXDOP as needed to fit into the available memory grant.</span></span>  <span data-ttu-id="be061-223">Dans certains cas, le DOP doit être réduit à un pour pouvoir créer l'index sous une mémoire contrainte.</span><span class="sxs-lookup"><span data-stu-id="be061-223">In some cases, DOP must be decreased to one in order to build the index under constrained memory.</span></span>

##  <a name="related-tasks-and-topics"></a><a name="related"></a><span data-ttu-id="be061-224">Tâches et Rubriques connexes</span><span class="sxs-lookup"><span data-stu-id="be061-224">Related Tasks and Topics</span></span>

### <a name="nonclustered-columnstore-indexes"></a><span data-ttu-id="be061-225">Index columnstore non cluster</span><span class="sxs-lookup"><span data-stu-id="be061-225">Nonclustered Columnstore Indexes</span></span>
 <span data-ttu-id="be061-226">Pour les tâches courantes, consultez [Using Nonclustered Columnstore Indexes](../../database-engine/using-nonclustered-columnstore-indexes.md).</span><span class="sxs-lookup"><span data-stu-id="be061-226">For common tasks, see [Using Nonclustered Columnstore Indexes](../../database-engine/using-nonclustered-columnstore-indexes.md).</span></span>

-   [<span data-ttu-id="be061-227">CREATE COLUMNSTORE INDEX &#40;Transact-SQL&#41;</span><span class="sxs-lookup"><span data-stu-id="be061-227">CREATE COLUMNSTORE INDEX &#40;Transact-SQL&#41;</span></span>](/sql/t-sql/statements/create-columnstore-index-transact-sql)

-   <span data-ttu-id="be061-228">[ALTER INDEX &#40;Transact-SQL&#41;](/sql/t-sql/statements/alter-index-transact-sql) avec Rebuild.</span><span class="sxs-lookup"><span data-stu-id="be061-228">[ALTER INDEX &#40;Transact-SQL&#41;](/sql/t-sql/statements/alter-index-transact-sql) with REBUILD.</span></span>

-   [<span data-ttu-id="be061-229">DROP INDEX &#40;Transact-SQL&#41;</span><span class="sxs-lookup"><span data-stu-id="be061-229">DROP INDEX &#40;Transact-SQL&#41;</span></span>](/sql/t-sql/statements/drop-index-transact-sql)

### <a name="clustered-columnstore-indexes"></a><span data-ttu-id="be061-230">Index columnstore cluster</span><span class="sxs-lookup"><span data-stu-id="be061-230">Clustered Columnstore Indexes</span></span>
 <span data-ttu-id="be061-231">Pour les tâches courantes, consultez [Using Clustered Columnstore Indexes](../../database-engine/using-clustered-columnstore-indexes.md).</span><span class="sxs-lookup"><span data-stu-id="be061-231">For common tasks, see [Using Clustered Columnstore Indexes](../../database-engine/using-clustered-columnstore-indexes.md).</span></span>

-   [<span data-ttu-id="be061-232">CRÉER un INDEX COLUMNSTORE CLUSTER &#40;&#41;Transact-SQL</span><span class="sxs-lookup"><span data-stu-id="be061-232">CREATE CLUSTERED COLUMNSTORE INDEX &#40;Transact-SQL&#41;</span></span>](/sql/t-sql/statements/create-columnstore-index-transact-sql)

-   <span data-ttu-id="be061-233">[ALTER INDEX &#40;Transact-SQL&#41;](/sql/t-sql/statements/alter-index-transact-sql) avec Rebuild ou REORGANIZE.</span><span class="sxs-lookup"><span data-stu-id="be061-233">[ALTER INDEX &#40;Transact-SQL&#41;](/sql/t-sql/statements/alter-index-transact-sql) with REBUILD or REORGANIZE.</span></span>

-   [<span data-ttu-id="be061-234">DROP INDEX &#40;Transact-SQL&#41;</span><span class="sxs-lookup"><span data-stu-id="be061-234">DROP INDEX &#40;Transact-SQL&#41;</span></span>](/sql/t-sql/statements/drop-index-transact-sql)

-   [<span data-ttu-id="be061-235">INSERT &#40;Transact-SQL&#41;</span><span class="sxs-lookup"><span data-stu-id="be061-235">INSERT &#40;Transact-SQL&#41;</span></span>](/sql/t-sql/statements/insert-transact-sql)

-   [<span data-ttu-id="be061-236">UPDATE &#40;Transact-SQL&#41;</span><span class="sxs-lookup"><span data-stu-id="be061-236">UPDATE &#40;Transact-SQL&#41;</span></span>](/sql/t-sql/queries/update-transact-sql)

-   [<span data-ttu-id="be061-237">DELETE &#40;Transact-SQL&#41;</span><span class="sxs-lookup"><span data-stu-id="be061-237">DELETE &#40;Transact-SQL&#41;</span></span>](/sql/t-sql/statements/delete-transact-sql)

### <a name="metadata"></a><span data-ttu-id="be061-238">Métadonnées</span><span class="sxs-lookup"><span data-stu-id="be061-238">Metadata</span></span>
 <span data-ttu-id="be061-239">Toutes les colonnes dans un index columnstore sont stockées dans les métadonnées en tant que colonnes incluses.</span><span class="sxs-lookup"><span data-stu-id="be061-239">All of the columns in a columnstore index are stored in the metadata as included columns.</span></span> <span data-ttu-id="be061-240">L'index columnstore n'a pas de colonnes clés.</span><span class="sxs-lookup"><span data-stu-id="be061-240">The columnstore index does not have key columns.</span></span>

-   [<span data-ttu-id="be061-241">sys.indexes &#40;Transact-SQL&#41;</span><span class="sxs-lookup"><span data-stu-id="be061-241">sys.indexes &#40;Transact-SQL&#41;</span></span>](/sql/relational-databases/system-catalog-views/sys-indexes-transact-sql)

-   [<span data-ttu-id="be061-242">sys.index_columns &#40;Transact-SQL&#41;</span><span class="sxs-lookup"><span data-stu-id="be061-242">sys.index_columns &#40;Transact-SQL&#41;</span></span>](/sql/relational-databases/system-catalog-views/sys-index-columns-transact-sql)

-   [<span data-ttu-id="be061-243">sys.partitions &#40;Transact-SQL&#41;</span><span class="sxs-lookup"><span data-stu-id="be061-243">sys.partitions &#40;Transact-SQL&#41;</span></span>](/sql/relational-databases/system-catalog-views/sys-partitions-transact-sql)

-   [<span data-ttu-id="be061-244">sys.column_store_segments &#40;Transact-SQL&#41;</span><span class="sxs-lookup"><span data-stu-id="be061-244">sys.column_store_segments &#40;Transact-SQL&#41;</span></span>](/sql/relational-databases/system-catalog-views/sys-column-store-segments-transact-sql)

-   [<span data-ttu-id="be061-245">sys.column_store_dictionaries &#40;Transact-SQL&#41;</span><span class="sxs-lookup"><span data-stu-id="be061-245">sys.column_store_dictionaries &#40;Transact-SQL&#41;</span></span>](/sql/relational-databases/system-catalog-views/sys-column-store-dictionaries-transact-sql)

-   [<span data-ttu-id="be061-246">sys.column_store_row_groups &#40;Transact-SQL&#41;</span><span class="sxs-lookup"><span data-stu-id="be061-246">sys.column_store_row_groups &#40;Transact-SQL&#41;</span></span>](/sql/relational-databases/system-catalog-views/sys-column-store-row-groups-transact-sql)


