---
title: Suivi d’événements pour Windows en cible | Microsoft Docs
ms.custom: ''
ms.date: 06/13/2017
ms.prod: sql-server-2014
ms.reviewer: ''
ms.technology: xevents
ms.topic: conceptual
helpviewer_keywords:
- event tracing for windows target
- ETW target
- targets [SQL Server extended events], event tracing for windows target
ms.assetid: ca2bb295-b7f6-49c3-91ed-0ad4c39f89d5
author: rothja
ms.author: jroth
ms.openlocfilehash: 55f247af30b5278f614b6505a94266cc07ec6c54
ms.sourcegitcommit: ad4d92dce894592a259721a1571b1d8736abacdb
ms.translationtype: MT
ms.contentlocale: fr-FR
ms.lasthandoff: 08/04/2020
ms.locfileid: "87601472"
---
# <a name="event-tracing-for-windows-target"></a><span data-ttu-id="2ce9a-102">suivi d'événements pour cible Windows</span><span class="sxs-lookup"><span data-stu-id="2ce9a-102">Event Tracing for Windows Target</span></span>
  <span data-ttu-id="2ce9a-103">Avant d'utiliser le suivi d'événements pour Windows (ETW) comme cible, il est recommandé d'avoir une connaissance pratique du Suivi d'événements pour Windows.</span><span class="sxs-lookup"><span data-stu-id="2ce9a-103">Before you use Event Tracing for Windows (ETW) as a target, we recommend that you have a working knowledge of ETW.</span></span> <span data-ttu-id="2ce9a-104">Le suivi ETW est utilisé conjointement avec les Événements étendus ou en tant que consommateur d'événements des Événements étendus.</span><span class="sxs-lookup"><span data-stu-id="2ce9a-104">ETW tracing is either used together with Extended Events or as an Extended Events event consumer.</span></span> <span data-ttu-id="2ce9a-105">Les liens externes suivants fournissent un point de départ pour obtenir des informations générales sur le suivi ETW :</span><span class="sxs-lookup"><span data-stu-id="2ce9a-105">The following external links provide a starting point for obtaining background information about ETW:</span></span>  
  
-   [<span data-ttu-id="2ce9a-106">Événements Windows</span><span class="sxs-lookup"><span data-stu-id="2ce9a-106">Windows Events</span></span>](https://go.microsoft.com/fwlink/?LinkId=92380)  
  
-   [<span data-ttu-id="2ce9a-107">Améliorer le débogage et le réglage des performances à l'aide du suivi ETW</span><span class="sxs-lookup"><span data-stu-id="2ce9a-107">Improve Debugging And Performance Tuning With ETW</span></span>](https://go.microsoft.com/fwlink/?LinkId=92381)  
  
 <span data-ttu-id="2ce9a-108">La cible du suivi ETW est une cible singleton, bien qu'elle puisse être ajoutée à plusieurs sessions.</span><span class="sxs-lookup"><span data-stu-id="2ce9a-108">The ETW target is a singleton target, although the target can be added to many sessions.</span></span> <span data-ttu-id="2ce9a-109">Si un événement est déclenché sur plusieurs sessions, l'événement sera propagé uniquement à la cible ETW une fois par occurrence de l'événement.</span><span class="sxs-lookup"><span data-stu-id="2ce9a-109">If an event is raised on many sessions, the event will only be propagated to the ETW target one time per event occurrence.</span></span> <span data-ttu-id="2ce9a-110">Le moteur des Événements étendus est limité à une seule instance par processus.</span><span class="sxs-lookup"><span data-stu-id="2ce9a-110">The Extended Events engine is limited to a single instance per process.</span></span>  
  
> [!IMPORTANT]  
>  <span data-ttu-id="2ce9a-111">Pour que la cible du suivi ETW fonctionne, le compte de démarrage du service [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] doit être membre du groupe Utilisateurs du journal de performances.</span><span class="sxs-lookup"><span data-stu-id="2ce9a-111">For the ETW target to work, the [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] Service startup account must be a member of the Performance Log Users group.</span></span>  
  
 <span data-ttu-id="2ce9a-112">La configuration des événements présents dans une session ETW est contrôlée par le processus qui héberge le moteur des Événements étendus.</span><span class="sxs-lookup"><span data-stu-id="2ce9a-112">The configuration of the events present in an ETW session is controlled by the process that hosts the Extended Events engine.</span></span> <span data-ttu-id="2ce9a-113">Le moteur contrôle quels événements déclencher et quelles conditions doivent être respectées pour qu'un événement se déclenche.</span><span class="sxs-lookup"><span data-stu-id="2ce9a-113">The engine controls which events to raise and what conditions must be met for an event to occur.</span></span>  
  
 <span data-ttu-id="2ce9a-114">Après avoir créé une liaison à une session Événements étendus, ce qui joint la cible ETW pour la première fois pendant la durée de vie d'un processus, la cible ETW ouvre une session ETW unique sur le fournisseur [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] .</span><span class="sxs-lookup"><span data-stu-id="2ce9a-114">After binding to an Extended Events session, which attaches the ETW target for the first time during the lifetime of a process, the ETW target opens a single ETW session on the [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] provider.</span></span> <span data-ttu-id="2ce9a-115">Si une session ETW existe déjà, la cible ETW obtient une référence à la session existante.</span><span class="sxs-lookup"><span data-stu-id="2ce9a-115">If an ETW session already exists, the ETW target obtains a reference to the existing session.</span></span> <span data-ttu-id="2ce9a-116">Cette session ETW est partagée sur toutes les instances de [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] sur un ordinateur donné.</span><span class="sxs-lookup"><span data-stu-id="2ce9a-116">This ETW session is shared across all [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] instances on a given computer.</span></span> <span data-ttu-id="2ce9a-117">Cette session ETW reçoit tous les événements à partir des sessions qui possèdent la cible ETW.</span><span class="sxs-lookup"><span data-stu-id="2ce9a-117">This ETW session receives all the events from sessions that have the ETW target.</span></span>  
  
 <span data-ttu-id="2ce9a-118">Comme ETW a besoin de fournisseurs pour pouvoir consommer des événements et les transmettre en aval au suivi ETW, tous les packages des Événements étendus sont activés sur la session.</span><span class="sxs-lookup"><span data-stu-id="2ce9a-118">Because ETW needs providers to be enabled to consume events and flow them down to the ETW, all Extended Events packages are enabled on the session.</span></span> <span data-ttu-id="2ce9a-119">Lorsqu'un événement est déclenché, la cible ETW envoie l'événement à la session sur laquelle le fournisseur pour l'événement est activé.</span><span class="sxs-lookup"><span data-stu-id="2ce9a-119">When an event is fired, the ETW target sends the event to the session on which the provider for the event is enabled.</span></span>  
  
 <span data-ttu-id="2ce9a-120">La cible ETW prend en charge la publication synchrone d'événements sur le thread qui déclenche l'événement.</span><span class="sxs-lookup"><span data-stu-id="2ce9a-120">The ETW target supports synchronous publishing of events on the thread that raises the event.</span></span> <span data-ttu-id="2ce9a-121">Cependant, la cible ETW ne prend pas en charge la publication asynchrone d'événements.</span><span class="sxs-lookup"><span data-stu-id="2ce9a-121">However, the ETW target does not support asynchronous event publishing.</span></span>  
  
 <span data-ttu-id="2ce9a-122">La cible ETW ne prend pas en charge le contrôle à partir de contrôleurs ETW externes tels que Logman.exe.</span><span class="sxs-lookup"><span data-stu-id="2ce9a-122">The ETW target does not support control from external ETW controllers such as Logman.exe.</span></span> <span data-ttu-id="2ce9a-123">Pour produire des traces ETW, une session d'événements doit être créée avec la cible ETW.</span><span class="sxs-lookup"><span data-stu-id="2ce9a-123">To produce ETW traces, an event session must be created with the ETW target.</span></span> <span data-ttu-id="2ce9a-124">Pour plus d’informations, consultez [CREATE EVENT SESSION &#40;Transact-SQL&#41;](/sql/t-sql/statements/create-event-session-transact-sql).</span><span class="sxs-lookup"><span data-stu-id="2ce9a-124">For more information, see [CREATE EVENT SESSION &#40;Transact-SQL&#41;](/sql/t-sql/statements/create-event-session-transact-sql).</span></span>  
  
> [!NOTE]  
>  <span data-ttu-id="2ce9a-125">L'activation de la cible ETW crée une session ETW nommée XE_DEFAULT_ETW_SESSION.</span><span class="sxs-lookup"><span data-stu-id="2ce9a-125">Enabling the ETW target creates an ETW session that is named XE_DEFAULT_ETW_SESSION.</span></span> <span data-ttu-id="2ce9a-126">Si une session XE_DEFAULT_ETW_SESSION existe déjà, elle est utilisée sans modifier la moindre propriété de la session existante.</span><span class="sxs-lookup"><span data-stu-id="2ce9a-126">If a session with the name XE_DEFAULT_ETW_SESSION already exists, it is used without modifying any properties of the existing session.</span></span> <span data-ttu-id="2ce9a-127">La session XE_DEFAULT_ETW_SESSION est partagée entre toutes les instances de [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)].</span><span class="sxs-lookup"><span data-stu-id="2ce9a-127">The XE_DEFAULT_ETW_SESSION is shared between all instances of [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)].</span></span> <span data-ttu-id="2ce9a-128">Après avoir démarré XE_DEFAULT_ETW_SESSION, vous devez l'arrêter à l'aide d'un contrôleur ETW, tel que l'outil Logman.</span><span class="sxs-lookup"><span data-stu-id="2ce9a-128">After you start the XE_DEFAULT_ETW_SESSION, you must stop it by using an ETW controller, such as the Logman tool.</span></span> <span data-ttu-id="2ce9a-129">Par exemple, vous pouvez exécuter la commande suivante à l’invite de commandes : `logman stop XE_DEFAULT_ETW_SESSION -ets`.</span><span class="sxs-lookup"><span data-stu-id="2ce9a-129">For example, you can run the following command at the command prompt: `logman stop XE_DEFAULT_ETW_SESSION -ets`.</span></span>  
  
 <span data-ttu-id="2ce9a-130">Le tableau suivant décrit les options disponibles pour configurer la cible ETW.</span><span class="sxs-lookup"><span data-stu-id="2ce9a-130">The following table describes the available options for configuring the ETW target.</span></span>  
  
|<span data-ttu-id="2ce9a-131">Option</span><span class="sxs-lookup"><span data-stu-id="2ce9a-131">Option</span></span>|<span data-ttu-id="2ce9a-132">Valeurs autorisées</span><span class="sxs-lookup"><span data-stu-id="2ce9a-132">Allowed values</span></span>|<span data-ttu-id="2ce9a-133">Description</span><span class="sxs-lookup"><span data-stu-id="2ce9a-133">Description</span></span>|  
|------------|--------------------|-----------------|  
|<span data-ttu-id="2ce9a-134">default_xe_session_name</span><span class="sxs-lookup"><span data-stu-id="2ce9a-134">default_xe_session_name</span></span>|<span data-ttu-id="2ce9a-135">Toute chaîne incluant jusqu'à 256 caractères.</span><span class="sxs-lookup"><span data-stu-id="2ce9a-135">Any string up to 256 characters.</span></span> <span data-ttu-id="2ce9a-136">Cette valeur est facultative.</span><span class="sxs-lookup"><span data-stu-id="2ce9a-136">This value is optional.</span></span>|<span data-ttu-id="2ce9a-137">Nom de la session Événements étendus.</span><span class="sxs-lookup"><span data-stu-id="2ce9a-137">The Extended Events session name.</span></span> <span data-ttu-id="2ce9a-138">Par défaut, il s'agit de la session XE_DEFAULT_ETW_SESSION.</span><span class="sxs-lookup"><span data-stu-id="2ce9a-138">By default, this is XE_DEFAULT_ETW_SESSION.</span></span>|  
|<span data-ttu-id="2ce9a-139">default_etw_session_logfile_path</span><span class="sxs-lookup"><span data-stu-id="2ce9a-139">default_etw_session_logfile_path</span></span>|<span data-ttu-id="2ce9a-140">Toute chaîne incluant jusqu'à 256 caractères.</span><span class="sxs-lookup"><span data-stu-id="2ce9a-140">Any string up to 256 characters.</span></span> <span data-ttu-id="2ce9a-141">Cette valeur est facultative.</span><span class="sxs-lookup"><span data-stu-id="2ce9a-141">This value is optional.</span></span>|<span data-ttu-id="2ce9a-142">Chemin d'accès du fichier journal pour la session Événements étendus.</span><span class="sxs-lookup"><span data-stu-id="2ce9a-142">The path of the log file for the Extended Events session.</span></span> <span data-ttu-id="2ce9a-143">Par défaut, il s'agit de %TEMP%\ XEEtw.etl.</span><span class="sxs-lookup"><span data-stu-id="2ce9a-143">By default, this is %TEMP%\ XEEtw.etl.</span></span>|  
|<span data-ttu-id="2ce9a-144">default_etw_session_logfile_size_mb</span><span class="sxs-lookup"><span data-stu-id="2ce9a-144">default_etw_session_logfile_size_mb</span></span>|<span data-ttu-id="2ce9a-145">Entier quelconque non signé.</span><span class="sxs-lookup"><span data-stu-id="2ce9a-145">Any unsigned integer.</span></span> <span data-ttu-id="2ce9a-146">Cette valeur est facultative.</span><span class="sxs-lookup"><span data-stu-id="2ce9a-146">This value is optional.</span></span>|<span data-ttu-id="2ce9a-147">Taille du fichier journal, en mégaoctets (Mo), de la session Événements étendus.</span><span class="sxs-lookup"><span data-stu-id="2ce9a-147">The log file size, in megabytes (MB), for the Extended Events session.</span></span> <span data-ttu-id="2ce9a-148">La valeur par défaut est 20 Mo.</span><span class="sxs-lookup"><span data-stu-id="2ce9a-148">The default is 20 MB.</span></span>|  
|<span data-ttu-id="2ce9a-149">default_etw_session_buffer_size_kb</span><span class="sxs-lookup"><span data-stu-id="2ce9a-149">default_etw_session_buffer_size_kb</span></span>|<span data-ttu-id="2ce9a-150">Entier quelconque non signé.</span><span class="sxs-lookup"><span data-stu-id="2ce9a-150">Any unsigned integer.</span></span> <span data-ttu-id="2ce9a-151">Cette valeur est facultative.</span><span class="sxs-lookup"><span data-stu-id="2ce9a-151">This value is optional.</span></span>|<span data-ttu-id="2ce9a-152">Taille des tampons en mémoire, en kilo-octets (Ko), pour la session Événements étendus.</span><span class="sxs-lookup"><span data-stu-id="2ce9a-152">The in-memory buffer size, in kilobytes (KB), for the Extended Events session.</span></span> <span data-ttu-id="2ce9a-153">La valeur par défaut est 128 Ko.</span><span class="sxs-lookup"><span data-stu-id="2ce9a-153">The default is 128 KB.</span></span>|  
|<span data-ttu-id="2ce9a-154">retries</span><span class="sxs-lookup"><span data-stu-id="2ce9a-154">retries</span></span>|<span data-ttu-id="2ce9a-155">Entier quelconque non signé.</span><span class="sxs-lookup"><span data-stu-id="2ce9a-155">Any unsigned integer.</span></span>|<span data-ttu-id="2ce9a-156">Nombre de nouvelles tentatives de publication de l'événement dans le sous-système ETW avant la suppression de l'événement.</span><span class="sxs-lookup"><span data-stu-id="2ce9a-156">The number of times to retry publishing the event to the ETW subsystem before dropping the event.</span></span> <span data-ttu-id="2ce9a-157">La valeur par défaut est 0.</span><span class="sxs-lookup"><span data-stu-id="2ce9a-157">The default is 0.</span></span>|  
  
 <span data-ttu-id="2ce9a-158">La configuration de ces paramètres est facultative.</span><span class="sxs-lookup"><span data-stu-id="2ce9a-158">Configuring these settings is optional.</span></span> <span data-ttu-id="2ce9a-159">La cible ETW utilise les valeurs par défaut de ces paramètres.</span><span class="sxs-lookup"><span data-stu-id="2ce9a-159">The ETW target uses default values for these settings.</span></span>  
  
 <span data-ttu-id="2ce9a-160">La cible ETW est chargée des opérations suivantes :</span><span class="sxs-lookup"><span data-stu-id="2ce9a-160">The ETW target is responsible for:</span></span>  
  
-   <span data-ttu-id="2ce9a-161">Création de la session ETW par défaut.</span><span class="sxs-lookup"><span data-stu-id="2ce9a-161">Creating the default ETW session.</span></span>  
  
-   <span data-ttu-id="2ce9a-162">Enregistrement de tous les packages des Événements étendus auprès d'ETW.</span><span class="sxs-lookup"><span data-stu-id="2ce9a-162">Registering all Extended Events packages with ETW.</span></span> <span data-ttu-id="2ce9a-163">Cela garantit que les événements ne seront pas supprimés par ETW.</span><span class="sxs-lookup"><span data-stu-id="2ce9a-163">This ensures that events are not dropped by ETW.</span></span>  
  
-   <span data-ttu-id="2ce9a-164">Gestion de l'envoi du flux d'événements à ETW.</span><span class="sxs-lookup"><span data-stu-id="2ce9a-164">Managing the flow of events to ETW.</span></span> <span data-ttu-id="2ce9a-165">La cible ETW crée un événement ETW avec les données des Événements étendus et l'envoie à la session ETW appropriée.</span><span class="sxs-lookup"><span data-stu-id="2ce9a-165">The ETW target creates an ETW event with Extended Events data and sends it to the appropriate ETW session.</span></span> <span data-ttu-id="2ce9a-166">Si l'événement est plus grand que la taille de la mémoire tampon ou si les données ne peuvent pas s'ajuster dans un événement ETW, le suivi ETW fractionne l'événement en fragments.</span><span class="sxs-lookup"><span data-stu-id="2ce9a-166">If the event is larger than the buffer size, or data cannot fit in one ETW event, ETW splits the event into fragments.</span></span>  
  
-   <span data-ttu-id="2ce9a-167">Conservation des packages des Événements étendus activés à tout instant.</span><span class="sxs-lookup"><span data-stu-id="2ce9a-167">Keeping Extended Events packages enabled at all times.</span></span>  
  
 <span data-ttu-id="2ce9a-168">Les emplacements de fichier par défaut suivants sont utilisés par ETW :</span><span class="sxs-lookup"><span data-stu-id="2ce9a-168">The following default file locations are used by ETW:</span></span>  
  
-   <span data-ttu-id="2ce9a-169">Le fichier de sortie ETW se trouve dans %TEMP%\XEEtw.etl.</span><span class="sxs-lookup"><span data-stu-id="2ce9a-169">The ETW output file is in %TEMP%\XEEtw.etl.</span></span>  
  
    > [!IMPORTANT]  
    >  <span data-ttu-id="2ce9a-170">Le chemin d'accès ne peut pas être modifié une fois la première session démarrée.</span><span class="sxs-lookup"><span data-stu-id="2ce9a-170">The file path cannot be changed after the first session starts.</span></span>  
  
-   <span data-ttu-id="2ce9a-171">Les fichiers MOF (Managed Object Format - Format MOF) se trouvent dans *\<your install path>* \Microsoft SQL Server\Shared.</span><span class="sxs-lookup"><span data-stu-id="2ce9a-171">Managed Object Format (MOF) files are in *\<your install path>* \Microsoft SQL Server\Shared.</span></span> <span data-ttu-id="2ce9a-172">Pour plus d'informations, consultez [Format d'objet managé](https://go.microsoft.com/fwlink/?LinkId=92851) sur MSDN.</span><span class="sxs-lookup"><span data-stu-id="2ce9a-172">For more information, see [Managed Object Format](https://go.microsoft.com/fwlink/?LinkId=92851) on MSDN.</span></span>  
  
## <a name="adding-the-target-to-a-session"></a><span data-ttu-id="2ce9a-173">Ajout de la cible à une session</span><span class="sxs-lookup"><span data-stu-id="2ce9a-173">Adding the Target to a Session</span></span>  
 <span data-ttu-id="2ce9a-174">Pour ajouter la cible ETW à une session Événements étendus lorsque vous créez ou modifiez une session d'événements, vous devez inclure l'instruction suivante :</span><span class="sxs-lookup"><span data-stu-id="2ce9a-174">To add the ETW target to an Extended Events session, you must include the following statement when you create or alter an event session:</span></span>  
  
```  
ADD TARGET package0.etw_classic_sync_target  
```  
  
 <span data-ttu-id="2ce9a-175">Pour plus d’informations et pour obtenir un exemple complet qui montre comment utiliser la cible ETW (et notamment comment afficher les données), consultez [Surveiller l’activité système à l’aide d’événements étendus](monitor-system-activity-using-extended-events.md).</span><span class="sxs-lookup"><span data-stu-id="2ce9a-175">For more information about a full example that shows how to use the ETW target, including how to view the data, see [Monitor System Activity Using Extended Events](monitor-system-activity-using-extended-events.md).</span></span>  
  
## <a name="see-also"></a><span data-ttu-id="2ce9a-176">Voir aussi</span><span class="sxs-lookup"><span data-stu-id="2ce9a-176">See Also</span></span>  
 <span data-ttu-id="2ce9a-177">[Cibles des Événements étendus SQL Server](../../database-engine/sql-server-extended-events-targets.md) </span><span class="sxs-lookup"><span data-stu-id="2ce9a-177">[SQL Server Extended Events Targets](../../database-engine/sql-server-extended-events-targets.md) </span></span>  
 <span data-ttu-id="2ce9a-178">[sys.dm_xe_session_targets &#40;Transact-SQL&#41;](/sql/relational-databases/system-dynamic-management-views/sys-dm-xe-session-targets-transact-sql) </span><span class="sxs-lookup"><span data-stu-id="2ce9a-178">[sys.dm_xe_session_targets &#40;Transact-SQL&#41;](/sql/relational-databases/system-dynamic-management-views/sys-dm-xe-session-targets-transact-sql) </span></span>  
 <span data-ttu-id="2ce9a-179">[CREATE EVENT SESSION &#40;Transact-SQL&#41;](/sql/t-sql/statements/create-event-session-transact-sql) </span><span class="sxs-lookup"><span data-stu-id="2ce9a-179">[CREATE EVENT SESSION &#40;Transact-SQL&#41;](/sql/t-sql/statements/create-event-session-transact-sql) </span></span>  
 [<span data-ttu-id="2ce9a-180">ALTER EVENT SESSION &#40;Transact-SQL&#41;</span><span class="sxs-lookup"><span data-stu-id="2ce9a-180">ALTER EVENT SESSION &#40;Transact-SQL&#41;</span></span>](/sql/t-sql/statements/alter-event-session-transact-sql)  
  
  
