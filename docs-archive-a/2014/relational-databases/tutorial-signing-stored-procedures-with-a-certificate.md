---
title: 'Didacticiel : signature de procédures stockées à l’aide d’un certificat | Microsoft Docs'
ms.custom: ''
ms.date: 06/14/2017
ms.prod: sql-server-2014
ms.reviewer: ''
ms.technology: ''
ms.topic: conceptual
helpviewer_keywords:
- signing stored procedures tutorial [SQL Server]
ms.assetid: a4b0f23b-bdc8-425f-b0b9-e0621894f47e
author: rothja
ms.author: jroth
ms.openlocfilehash: 6fe387c43431436ba5fba5bcab879584ecdad533
ms.sourcegitcommit: ad4d92dce894592a259721a1571b1d8736abacdb
ms.translationtype: MT
ms.contentlocale: fr-FR
ms.lasthandoff: 08/04/2020
ms.locfileid: "87614462"
---
# <a name="tutorial-signing-stored-procedures-with-a-certificate"></a><span data-ttu-id="1523a-102">Didacticiel : signature de procédures stockées à l'aide d'un certificat</span><span class="sxs-lookup"><span data-stu-id="1523a-102">Tutorial: Signing Stored Procedures with a Certificate</span></span>
  <span data-ttu-id="1523a-103">Ce didacticiel explique comment signer des procédures stockées à l'aide d'un certificat généré par [!INCLUDE[ssNoVersion](../includes/ssnoversion-md.md)].</span><span class="sxs-lookup"><span data-stu-id="1523a-103">This tutorial illustrates signing stored procedures using a certificate generated by [!INCLUDE[ssNoVersion](../includes/ssnoversion-md.md)].</span></span>  
  
> [!NOTE]  
>  <span data-ttu-id="1523a-104">Pour exécuter le code de ce didacticiel, vous devez à la fois configurer la sécurité en mode mixte et installer la base de données [!INCLUDE[ssSampleDBobject](../includes/sssampledbobject-md.md)] .</span><span class="sxs-lookup"><span data-stu-id="1523a-104">To run the code in this tutorial you must have both Mixed Mode security configured and the [!INCLUDE[ssSampleDBobject](../includes/sssampledbobject-md.md)] database installed.</span></span> <span data-ttu-id="1523a-105">Scénario</span><span class="sxs-lookup"><span data-stu-id="1523a-105">Scenario</span></span>  
  
 <span data-ttu-id="1523a-106">La signature de procédures stockées à l'aide d'un certificat est utile lorsque vous voulez définir des autorisations pour la procédure stockée mais ne souhaitez pas accorder explicitement ces droits à un utilisateur.</span><span class="sxs-lookup"><span data-stu-id="1523a-106">Signing stored procedures using a certificate is useful when you want to require permissions on the stored procedure but you do not want to explicitly grant a user those rights.</span></span> <span data-ttu-id="1523a-107">Bien que d'autres méthodes vous permettent d'accomplir cette tâche, notamment en faisant appel à l'instruction EXECUTE AS, le recours à un certificat vous permet d'utiliser une trace afin de rechercher l'appelant d'origine de la procédure stockée.</span><span class="sxs-lookup"><span data-stu-id="1523a-107">Although you can accomplish this task in other ways, such as using the EXECUTE AS statement, using a certificate allows you to use a trace to find the original caller of the stored procedure.</span></span> <span data-ttu-id="1523a-108">Cette fonction garantit un degré d'audit élevé, surtout lors d'opérations de sécurité ou d'opérations DDL (Data Definition Language).</span><span class="sxs-lookup"><span data-stu-id="1523a-108">This provides a high level of auditing, especially during security or Data Definition Language (DDL) operations.</span></span>  
  
 <span data-ttu-id="1523a-109">Vous pouvez créer un certificat dans la base de données master pour permettre l'usage d'autorisations de niveau serveur ou bien créer un certificat dans n'importe quelle base de données pour des autorisations de niveau base de données.</span><span class="sxs-lookup"><span data-stu-id="1523a-109">You can create a certificate in the master database to allow server-level permissions, or you can create a certificate in any user databases to allow database-level permissions.</span></span> <span data-ttu-id="1523a-110">Dans ce scénario, un utilisateur ne bénéficiant d'aucun droit pour les tables de base doit avoir accès à une procédure stockée de la base de données [!INCLUDE[ssSampleDBobject](../includes/sssampledbobject-md.md)] et vous souhaitez soumettre le journal d'accès aux objets à un audit.</span><span class="sxs-lookup"><span data-stu-id="1523a-110">In this scenario, a user with no rights to base tables must access a stored procedure in the [!INCLUDE[ssSampleDBobject](../includes/sssampledbobject-md.md)] database, and you want to audit the object access trail.</span></span> <span data-ttu-id="1523a-111">Plutôt que d'utiliser d'autres méthodes de chaînes de propriétés, vous allez créer un compte d'utilisateur de serveur et de base de données sans droits d'accès aux objets de base, puis un compte d'utilisateur de base de données doté de droits d'accès à une table et à une procédure stockée.</span><span class="sxs-lookup"><span data-stu-id="1523a-111">Rather than using other ownership chain methods, you will create a server and database user account with no rights to the base objects, and a database user account with rights to a table and a stored procedure.</span></span> <span data-ttu-id="1523a-112">La procédure stockée et le deuxième compte d'utilisateur de base de données seront tous les deux sécurisés à l'aide d'un certificat.</span><span class="sxs-lookup"><span data-stu-id="1523a-112">Both the stored procedure and the second database user account will be secured with a certificate.</span></span> <span data-ttu-id="1523a-113">Le deuxième compte de base de données aura accès à tous les objets et un accès à la procédure stockée sera accordé au premier compte d'utilisateur de base de données.</span><span class="sxs-lookup"><span data-stu-id="1523a-113">The second database account will have access to all objects, and grant access to the stored procedure to the first database user account.</span></span>  
  
 <span data-ttu-id="1523a-114">Dans ce scénario, vous allez d'abord créer un certificat de base de données, une procédure stockée et un utilisateur, puis vous testerez le processus en suivant ces étapes :</span><span class="sxs-lookup"><span data-stu-id="1523a-114">In this scenario you will first create a database certificate, a stored procedure, and a user, and then you will test the process following these steps:</span></span>  
  
1.  <span data-ttu-id="1523a-115">Configuration de l'environnement</span><span class="sxs-lookup"><span data-stu-id="1523a-115">Configure the environment.</span></span>  
  
2.  <span data-ttu-id="1523a-116">Création d'un certificat</span><span class="sxs-lookup"><span data-stu-id="1523a-116">Create a certificate.</span></span>  
  
3.  <span data-ttu-id="1523a-117">Création et signature d'une procédure stockée à l'aide du certificat</span><span class="sxs-lookup"><span data-stu-id="1523a-117">Create and sign a stored procedure using the certificate.</span></span>  
  
4.  <span data-ttu-id="1523a-118">Création d'un compte de certificat à l'aide du certificat</span><span class="sxs-lookup"><span data-stu-id="1523a-118">Create a certificate account using the certificate.</span></span>  
  
5.  <span data-ttu-id="1523a-119">Octroi de droits de base de données au compte de certificat</span><span class="sxs-lookup"><span data-stu-id="1523a-119">Grant the certificate account database rights.</span></span>  
  
6.  <span data-ttu-id="1523a-120">Affichage du contexte d'accès</span><span class="sxs-lookup"><span data-stu-id="1523a-120">Display the access context.</span></span>  
  
7.  <span data-ttu-id="1523a-121">Réinitialisation de l'environnement</span><span class="sxs-lookup"><span data-stu-id="1523a-121">Reset the environment.</span></span>  
  
 <span data-ttu-id="1523a-122">Chaque bloc de code dans cet exemple est présenté sous forme de lignes.</span><span class="sxs-lookup"><span data-stu-id="1523a-122">Each code block in this example is explained in line.</span></span> <span data-ttu-id="1523a-123">Pour copier l'exemple tout entier, consultez la section [Exemple complet](#CompleteExample) à la fin de ce didacticiel.</span><span class="sxs-lookup"><span data-stu-id="1523a-123">To copy the complete example, see [Complete Example](#CompleteExample) at the end of this tutorial.</span></span>  
  
## <a name="1-configure-the-environment"></a><span data-ttu-id="1523a-124">1. Configurez l'environnement</span><span class="sxs-lookup"><span data-stu-id="1523a-124">1. Configure the Environment</span></span>  
 <span data-ttu-id="1523a-125">Pour définir le contexte initial de l'exemple, ouvrez une nouvelle requête dans [!INCLUDE[ssManStudioFull](../includes/ssmanstudiofull-md.md)] et exécutez le code suivant pour ouvrir la base de données [!INCLUDE[ssSampleDBobject](../includes/sssampledbobject-md.md)] .</span><span class="sxs-lookup"><span data-stu-id="1523a-125">To set the initial context of the example, in [!INCLUDE[ssManStudioFull](../includes/ssmanstudiofull-md.md)] open a new Query and run the following code to open the [!INCLUDE[ssSampleDBobject](../includes/sssampledbobject-md.md)] database.</span></span> <span data-ttu-id="1523a-126">Ce code modifie et redéfinit le contexte de la base de données à `AdventureWorks2012` , puis crée une nouvelle connexion serveur et un compte d'utilisateur de base de données (`TestCreditRatingUser`) avec un mot de passe.</span><span class="sxs-lookup"><span data-stu-id="1523a-126">This code changes the database context to `AdventureWorks2012` and creates a new server login and database user account (`TestCreditRatingUser`), using a password.</span></span>  
  
```  
USE AdventureWorks2012;  
GO  
-- Set up a login for the test user  
CREATE LOGIN TestCreditRatingUser  
   WITH PASSWORD = 'ASDECd2439587y'  
GO  
CREATE USER TestCreditRatingUser  
FOR LOGIN TestCreditRatingUser;  
GO  
```  
  
 <span data-ttu-id="1523a-127">Pour plus d’informations sur l’instruction CREATE USER, consultez [CREATE USER &#40;Transact-SQL&#41;](/sql/t-sql/statements/create-user-transact-sql).</span><span class="sxs-lookup"><span data-stu-id="1523a-127">For more information on the CREATE USER statement, see [CREATE USER &#40;Transact-SQL&#41;](/sql/t-sql/statements/create-user-transact-sql).</span></span> <span data-ttu-id="1523a-128">Pour plus d’informations sur l’instruction CREATE LOGIN, consultez [CREATE LOGIN &#40;Transact-SQL&#41;](/sql/t-sql/statements/create-login-transact-sql).</span><span class="sxs-lookup"><span data-stu-id="1523a-128">For more information on the CREATE LOGIN statement, see [CREATE LOGIN &#40;Transact-SQL&#41;](/sql/t-sql/statements/create-login-transact-sql).</span></span>  
  
## <a name="2-create-a-certificate"></a><span data-ttu-id="1523a-129">2. Créez un certificat</span><span class="sxs-lookup"><span data-stu-id="1523a-129">2. Create a Certificate</span></span>  
 <span data-ttu-id="1523a-130">Vous pouvez créer des certificats sur le serveur à l'aide de la base de données master comme contexte, d'une base de données d'utilisateur ou bien des deux.</span><span class="sxs-lookup"><span data-stu-id="1523a-130">You can create certificates in the server using the master database as the context, using a user database, or both.</span></span> <span data-ttu-id="1523a-131">Il existe plusieurs options pour sécuriser le certificat.</span><span class="sxs-lookup"><span data-stu-id="1523a-131">There are multiple options for securing the certificate.</span></span> <span data-ttu-id="1523a-132">Pour plus d’informations sur les certificats, consultez [CREATE CERTIFICATE &#40;Transact-SQL&#41;](/sql/t-sql/statements/create-certificate-transact-sql).</span><span class="sxs-lookup"><span data-stu-id="1523a-132">For more information on certificates, see [CREATE CERTIFICATE &#40;Transact-SQL&#41;](/sql/t-sql/statements/create-certificate-transact-sql).</span></span>  
  
 <span data-ttu-id="1523a-133">Exécutez ce code pour créer un certificat de base de données et sécurisez-le avec un mot de passe.</span><span class="sxs-lookup"><span data-stu-id="1523a-133">Run this code to create a database certificate and secure it using a password.</span></span>  
  
```  
CREATE CERTIFICATE TestCreditRatingCer  
   ENCRYPTION BY PASSWORD = 'pGFD4bb925DGvbd2439587y'  
      WITH SUBJECT = 'Credit Rating Records Access',   
      EXPIRY_DATE = '12/05/2014';  
GO  
```  
  
## <a name="3-create-and-sign-a-stored-procedure-using-the-certificate"></a><span data-ttu-id="1523a-134">3. Créez et signez une procédure stockée à l'aide du certificat</span><span class="sxs-lookup"><span data-stu-id="1523a-134">3. Create and Sign a Stored Procedure Using the Certificate</span></span>  
 <span data-ttu-id="1523a-135">Utilisez le code suivant pour créer une procédure stockée qui sélectionne des données de la table `Vendor` dans le schéma de la base de données `Purchasing` , ce qui limite l'accès uniquement aux sociétés qui ont une cote de solvabilité de 1.</span><span class="sxs-lookup"><span data-stu-id="1523a-135">Use the following code to create a stored procedure that selects data from the `Vendor` table in the `Purchasing` database schema, restricting access to only the companies with a credit rating of 1.</span></span> <span data-ttu-id="1523a-136">Notez que la première section de la procédure stockée affiche le contexte du compte d'utilisateur qui exécute la procédure stockée, à des fins de démonstration des concepts uniquement.</span><span class="sxs-lookup"><span data-stu-id="1523a-136">Note that the first section of the stored procedure displays the context of the user account running the stored procedure, which is to demonstrate the concepts only.</span></span> <span data-ttu-id="1523a-137">Il n'est pas nécessaire pour répondre aux conditions requises.</span><span class="sxs-lookup"><span data-stu-id="1523a-137">It is not required to satisfy the requirements.</span></span>  
  
```  
CREATE PROCEDURE TestCreditRatingSP  
AS  
BEGIN  
   -- Show who is running the stored procedure  
   SELECT SYSTEM_USER 'system Login'  
   , USER AS 'Database Login'  
   , NAME AS 'Context'  
   , TYPE  
   , USAGE   
   FROM sys.user_token     
  
   -- Now get the data  
   SELECT AccountNumber, Name, CreditRating   
   FROM Purchasing.Vendor  
   WHERE CreditRating = 1  
END  
GO  
```  
  
 <span data-ttu-id="1523a-138">Exécutez ce code pour signer la procédure stockée avec le certificat de base de données en utilisant un mot de passe.</span><span class="sxs-lookup"><span data-stu-id="1523a-138">Run this code to sign the stored procedure with the database certificate, using a password.</span></span>  
  
```  
ADD SIGNATURE TO TestCreditRatingSP   
   BY CERTIFICATE TestCreditRatingCer  
    WITH PASSWORD = 'pGFD4bb925DGvbd2439587y';  
GO  
```  
  
 <span data-ttu-id="1523a-139">Pour plus d’informations sur les procédures stockées, consultez [Procédures stockées &#40;Moteur de base de données&#41;](stored-procedures/stored-procedures-database-engine.md).</span><span class="sxs-lookup"><span data-stu-id="1523a-139">For more information on stored procedures, see [Stored Procedures &#40;Database Engine&#41;](stored-procedures/stored-procedures-database-engine.md).</span></span>  
  
 <span data-ttu-id="1523a-140">Pour plus d’informations sur la signature de procédures stockées, consultez [ADD SIGNATURE &#40;Transact-SQL&#41;](/sql/t-sql/statements/add-signature-transact-sql).</span><span class="sxs-lookup"><span data-stu-id="1523a-140">For more information on signing stored procedures, see [ADD SIGNATURE &#40;Transact-SQL&#41;](/sql/t-sql/statements/add-signature-transact-sql).</span></span>  
  
## <a name="4-create-a-certificate-account-using-the-certificate"></a><span data-ttu-id="1523a-141">4. Créez un compte de certificat à l'aide du certificat</span><span class="sxs-lookup"><span data-stu-id="1523a-141">4. Create a Certificate Account Using the Certificate</span></span>  
 <span data-ttu-id="1523a-142">Exécutez ce code pour créer un utilisateur de base de données (`TestCreditRatingcertificateAccount`) à partir du certificat.</span><span class="sxs-lookup"><span data-stu-id="1523a-142">Run this code to create a database user (`TestCreditRatingcertificateAccount`) from the certificate.</span></span> <span data-ttu-id="1523a-143">Ce compte ne dispose pas d'une connexion serveur et doit en fin de compte contrôler l'accès aux tables sous-jacentes.</span><span class="sxs-lookup"><span data-stu-id="1523a-143">This account has no server login, and will ultimately control access to the underlying tables.</span></span>  
  
```  
USE AdventureWorks2012;  
GO  
CREATE USER TestCreditRatingcertificateAccount  
   FROM CERTIFICATE TestCreditRatingCer;  
GO  
```  
  
## <a name="5-grant-the-certificate-account-database-rights"></a><span data-ttu-id="1523a-144">5. Accordez des droits de base de données au compte de certificat</span><span class="sxs-lookup"><span data-stu-id="1523a-144">5. Grant the Certificate Account Database Rights</span></span>  
 <span data-ttu-id="1523a-145">Exécutez ce code pour accorder des droits `TestCreditRatingcertificateAccount` à la table de base et à la procédure stockée.</span><span class="sxs-lookup"><span data-stu-id="1523a-145">Run this code to grant `TestCreditRatingcertificateAccount` rights to the base table and the stored procedure.</span></span>  
  
```  
GRANT SELECT   
   ON Purchasing.Vendor   
   TO TestCreditRatingcertificateAccount;  
GO  
  
GRANT EXECUTE   
   ON TestCreditRatingSP   
   TO TestCreditRatingcertificateAccount;  
GO  
```  
  
 <span data-ttu-id="1523a-146">Pour plus d’informations sur l’accord d’autorisations à des objets, consultez [GRANT &#40;Transact-SQL&#41;](/sql/t-sql/statements/grant-transact-sql).</span><span class="sxs-lookup"><span data-stu-id="1523a-146">For more information on granting permissions to objects, see [GRANT &#40;Transact-SQL&#41;](/sql/t-sql/statements/grant-transact-sql).</span></span>  
  
## <a name="6-display-the-access-context"></a><span data-ttu-id="1523a-147">6. Affichez le contexte d'accès</span><span class="sxs-lookup"><span data-stu-id="1523a-147">6. Display the Access Context</span></span>  
 <span data-ttu-id="1523a-148">Pour afficher les droits associés à l'accès de la procédure stockée, exécutez le code suivant pour accorder des droits d'exécution de la procédure stockée à l'utilisateur `TestCreditRatingUser` .</span><span class="sxs-lookup"><span data-stu-id="1523a-148">To display the rights associated with the stored procedure access, run the following code to grant the rights to run the stored procedure to the `TestCreditRatingUser` user.</span></span>  
  
```  
GRANT EXECUTE   
   ON TestCreditRatingSP   
   TO TestCreditRatingUser;  
GO  
```  
  
 <span data-ttu-id="1523a-149">Ensuite, exécutez le code ci-dessous pour exécuter la procédure stockée en tant que connexion dbo utilisée sur le serveur.</span><span class="sxs-lookup"><span data-stu-id="1523a-149">Next, run the following code to run the stored procedure as the dbo login you used on the server.</span></span> <span data-ttu-id="1523a-150">Observez la sortie des informations de contexte utilisateur.</span><span class="sxs-lookup"><span data-stu-id="1523a-150">Observe the output of the user context information.</span></span> <span data-ttu-id="1523a-151">Il affiche le compte dbo en tant que contexte avec ses propres droits et non par le biais d'une appartenance à un groupe.</span><span class="sxs-lookup"><span data-stu-id="1523a-151">It will show the dbo account as the context with its own rights and not through a group membership.</span></span>  
  
```  
EXECUTE TestCreditRatingSP;  
GO  
```  
  
 <span data-ttu-id="1523a-152">Exécutez le code suivant pour utiliser l'instruction `EXECUTE AS` en tant que compte `TestCreditRatingUser` et exécutez la procédure stockée.</span><span class="sxs-lookup"><span data-stu-id="1523a-152">Run the following code to use the `EXECUTE AS` statement to become the `TestCreditRatingUser` account and run the stored procedure.</span></span> <span data-ttu-id="1523a-153">Cette fois, le contexte utilisateur apparaît défini sur le contexte USER MAPPED TO CERTIFICATE.</span><span class="sxs-lookup"><span data-stu-id="1523a-153">This time you will see the user context is set to the USER MAPPED TO CERTIFICATE context.</span></span>  
  
```  
EXECUTE AS LOGIN = 'TestCreditRatingUser';  
GO  
EXECUTE TestCreditRatingSP;  
GO  
```  
  
 <span data-ttu-id="1523a-154">Ce résultat vous montre l'audit disponible puisque vous avez signé la procédure stockée.</span><span class="sxs-lookup"><span data-stu-id="1523a-154">This shows you the auditing available because you signed the stored procedure.</span></span>  
  
> [!NOTE]  
>  <span data-ttu-id="1523a-155">Utilisez EXECUTE AS pour basculer entre les contextes au sein d'une base de données.</span><span class="sxs-lookup"><span data-stu-id="1523a-155">Use EXECUTE AS to switch contexts within a database.</span></span>  
  
## <a name="7-reset-the-environment"></a><span data-ttu-id="1523a-156">7. Réinitialisez l'environnement</span><span class="sxs-lookup"><span data-stu-id="1523a-156">7. Reset the Environment</span></span>  
 <span data-ttu-id="1523a-157">Le code ci-dessous utilise l'instruction `REVERT` pour retourner le contexte du compte actuel à dbo, puis réinitialise l'environnement.</span><span class="sxs-lookup"><span data-stu-id="1523a-157">The following code uses the `REVERT` statement to return the context of the current account to dbo, and resets the environment.</span></span>  
  
```  
REVERT;  
GO  
DROP PROCEDURE TestCreditRatingSP;  
GO  
DROP USER TestCreditRatingcertificateAccount;  
GO  
DROP USER TestCreditRatingUser;  
GO  
DROP LOGIN TestCreditRatingUser;  
GO  
DROP CERTIFICATE TestCreditRatingCer;  
GO  
```  
  
 <span data-ttu-id="1523a-158">Pour plus d’informations sur l’instruction REVERT, consultez [REVERT &#40;Transact-SQL&#41;](/sql/t-sql/statements/revert-transact-sql).</span><span class="sxs-lookup"><span data-stu-id="1523a-158">For more information about the REVERT statement, see [REVERT &#40;Transact-SQL&#41;](/sql/t-sql/statements/revert-transact-sql).</span></span>  
  
##  <a name="complete-example"></a><a name="CompleteExample"></a><span data-ttu-id="1523a-159">Exemple complet</span><span class="sxs-lookup"><span data-stu-id="1523a-159">Complete Example</span></span>  
 <span data-ttu-id="1523a-160">Cette section affiche l'exemple de code dans son intégralité.</span><span class="sxs-lookup"><span data-stu-id="1523a-160">This section displays the complete example code.</span></span>  
  
```  
/* Step 1 - Open the AdventureWorks2012 database */  
USE AdventureWorks2012;  
GO  
-- Set up a login for the test user  
CREATE LOGIN TestCreditRatingUser  
   WITH PASSWORD = 'ASDECd2439587y'  
GO  
CREATE USER TestCreditRatingUser  
FOR LOGIN TestCreditRatingUser;  
GO  
  
/* Step 2 - Create a certificate in the AdventureWorks2012 database */  
CREATE CERTIFICATE TestCreditRatingCer  
   ENCRYPTION BY PASSWORD = 'pGFD4bb925DGvbd2439587y'  
      WITH SUBJECT = 'Credit Rating Records Access',   
      EXPIRY_DATE = '12/05/2014';  
GO  
  
/* Step 3 - Create a stored procedure and  
sign it using the certificate */  
CREATE PROCEDURE TestCreditRatingSP  
AS  
BEGIN  
   -- Shows who is running the stored procedure  
   SELECT SYSTEM_USER 'system Login'  
   , USER AS 'Database Login'  
   , NAME AS 'Context'  
   , TYPE  
   , USAGE   
   FROM sys.user_token;     
  
   -- Now get the data  
   SELECT AccountNumber, Name, CreditRating   
   FROM Purchasing.Vendor  
   WHERE CreditRating = 1;  
END  
GO  
  
ADD SIGNATURE TO TestCreditRatingSP   
   BY CERTIFICATE TestCreditRatingCer  
    WITH PASSWORD = 'pGFD4bb925DGvbd2439587y';  
GO  
  
/* Step 4 - Create a database user for the certificate.   
This user has the ownership chain associated with it. */  
USE AdventureWorks2012;  
GO  
CREATE USER TestCreditRatingcertificateAccount  
   FROM CERTIFICATE TestCreditRatingCer;  
GO  
  
/* Step 5 - Grant the user database rights */  
GRANT SELECT   
   ON Purchasing.Vendor   
   TO TestCreditRatingcertificateAccount;  
GO  
  
GRANT EXECUTE  
   ON TestCreditRatingSP   
   TO TestCreditRatingcertificateAccount;  
GO  
  
/* Step 6 - Test, using the EXECUTE AS statement */  
GRANT EXECUTE   
   ON TestCreditRatingSP   
   TO TestCreditRatingUser;  
GO  
  
-- Run the procedure as the dbo user, notice the output for the type  
EXEC TestCreditRatingSP;  
GO  
  
EXECUTE AS LOGIN = 'TestCreditRatingUser';  
GO  
EXEC TestCreditRatingSP;  
GO  
  
/* Step 7 - Clean up the example */  
REVERT;  
GO  
DROP PROCEDURE TestCreditRatingSP;  
GO  
DROP USER TestCreditRatingcertificateAccount;  
GO  
DROP USER TestCreditRatingUser;  
GO  
DROP LOGIN TestCreditRatingUser;  
GO  
DROP CERTIFICATE TestCreditRatingCer;  
GO  
```  
  
## <a name="see-also"></a><span data-ttu-id="1523a-161">Voir aussi</span><span class="sxs-lookup"><span data-stu-id="1523a-161">See Also</span></span>  
 [<span data-ttu-id="1523a-162">Centre de sécurité pour le moteur de base de données SQL Server et Azure SQL Database</span><span class="sxs-lookup"><span data-stu-id="1523a-162">Security Center for SQL Server Database Engine and Azure SQL Database</span></span>](security/security-center-for-sql-server-database-engine-and-azure-sql-database.md)  
  
  
