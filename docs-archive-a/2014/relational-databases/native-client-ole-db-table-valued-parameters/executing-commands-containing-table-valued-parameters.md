---
title: Exécution de commandes contenant des paramètres table | Microsoft Docs
ms.custom: ''
ms.date: 03/06/2017
ms.prod: sql-server-2014
ms.reviewer: ''
ms.technology: native-client
ms.topic: reference
helpviewer_keywords:
- table-valued parameters, executing commands containing
ms.assetid: 7ecba6f6-fe7a-462a-9aa3-d5115b6d4529
author: rothja
ms.author: jroth
ms.openlocfilehash: e3f616b2b9f95ae558e444bcbdae50eae123fa4c
ms.sourcegitcommit: ad4d92dce894592a259721a1571b1d8736abacdb
ms.translationtype: MT
ms.contentlocale: fr-FR
ms.lasthandoff: 08/04/2020
ms.locfileid: "87602820"
---
# <a name="executing-commands-containing-table-valued-parameters"></a><span data-ttu-id="8fc58-102">Exécution de commandes contenant des paramètres table</span><span class="sxs-lookup"><span data-stu-id="8fc58-102">Executing Commands Containing Table-Valued Parameters</span></span>
  <span data-ttu-id="8fc58-103">L'exécution d'une commande qui contient des paramètres table requiert deux phases :</span><span class="sxs-lookup"><span data-stu-id="8fc58-103">Executing a command that contains table-valued parameters requires two phases:</span></span>  
  
1.  <span data-ttu-id="8fc58-104">Spécifier les types de paramètres.</span><span class="sxs-lookup"><span data-stu-id="8fc58-104">Specify the parameter types.</span></span>  
  
2.  <span data-ttu-id="8fc58-105">Lier les données des paramètres.</span><span class="sxs-lookup"><span data-stu-id="8fc58-105">Bind the parameter data.</span></span>  
  
## <a name="table-valued-parameter-specification"></a><span data-ttu-id="8fc58-106">Spécification des paramètres table</span><span class="sxs-lookup"><span data-stu-id="8fc58-106">Table-Valued Parameter Specification</span></span>  
 <span data-ttu-id="8fc58-107">Le consommateur peut spécifier le type du paramètre table.</span><span class="sxs-lookup"><span data-stu-id="8fc58-107">The consumer can specify the type of the table-valued parameter.</span></span> <span data-ttu-id="8fc58-108">Ces informations incluent le nom du type du paramètre table.</span><span class="sxs-lookup"><span data-stu-id="8fc58-108">This information includes the table-valued parameter type name.</span></span> <span data-ttu-id="8fc58-109">Elles incluent aussi le nom du schéma et indiquent si le type de table défini par l'utilisateur pour le paramètre table ne figure pas dans le schéma par défaut actuel de la connexion.</span><span class="sxs-lookup"><span data-stu-id="8fc58-109">It also includes the schema name, if the user-defined table type for the table-valued parameter is not in the current default schema for the connection.</span></span> <span data-ttu-id="8fc58-110">En fonction de la prise en charge du serveur, le consommateur peut également spécifier des informations de métadonnées facultatives, telles que la classification des colonnes, et mentionner que toutes les lignes de colonnes particulières ont des valeurs par défaut.</span><span class="sxs-lookup"><span data-stu-id="8fc58-110">Depending on server support, the consumer can also specify optional metadata information, such as ordering of columns, and can specify that all rows for particular columns have the default values.</span></span>  
  
 <span data-ttu-id="8fc58-111">Pour spécifier un paramètre table, le consommateur appelle ISSCommandWithParameter::SetParameterInfo, et éventuellement ISSCommandWithParameters::SetParameterProperties.</span><span class="sxs-lookup"><span data-stu-id="8fc58-111">To specify a table-valued parameter, the consumer calls ISSCommandWithParameter::SetParameterInfo, and optionally calls ISSCommandWithParameters::SetParameterProperties.</span></span> <span data-ttu-id="8fc58-112">Pour un paramètre table, le champ *pwszDataSourceType* de la structure DBPARAMBINDINFO a la valeur DBTYPE_TABLE.</span><span class="sxs-lookup"><span data-stu-id="8fc58-112">For a table-valued parameter, the *pwszDataSourceType* field in the DBPARAMBINDINFO structure has a value of DBTYPE_TABLE.</span></span> <span data-ttu-id="8fc58-113">Le champ *ulParamSize* est défini avec la valeur ~0 pour indiquer que la longueur est inconnue.</span><span class="sxs-lookup"><span data-stu-id="8fc58-113">The *ulParamSize* field is set to ~0 to indicate that length is unknown.</span></span> <span data-ttu-id="8fc58-114">Les propriétés particulières des paramètres table, telles que le nom de schéma, le nom de type, l'ordre des colonnes et les colonnes par défaut, peuvent être définies via ISSCommandWithParameters::SetParameterProperties.</span><span class="sxs-lookup"><span data-stu-id="8fc58-114">Particular properties for table-valued parameters, such as schema name, type name, column order, and default columns, can be set through ISSCommandWithParameters::SetParameterProperties.</span></span>  
  
## <a name="table-valued-parameter-binding"></a><span data-ttu-id="8fc58-115">Liaison de paramètre table</span><span class="sxs-lookup"><span data-stu-id="8fc58-115">Table-Valued Parameter Binding</span></span>  
 <span data-ttu-id="8fc58-116">Un paramètre table peut être n'importe quel objet d'ensemble de lignes.</span><span class="sxs-lookup"><span data-stu-id="8fc58-116">A table-valued parameter can be any rowset object.</span></span> <span data-ttu-id="8fc58-117">Le fournisseur effectue la lecture à partir de cet objet tout en envoyant les paramètres table au serveur pendant l'exécution.</span><span class="sxs-lookup"><span data-stu-id="8fc58-117">The provider reads from this object while sending table-valued parameters to the server during execution.</span></span>  
  
 <span data-ttu-id="8fc58-118">Pour lier le paramètre table, le consommateur appelle IAccessor::CreateAccessor.</span><span class="sxs-lookup"><span data-stu-id="8fc58-118">To bind the table-valued parameter, the consumer calls IAccessor::CreateAccessor.</span></span> <span data-ttu-id="8fc58-119">Le champ *wType* de la structure DBBINDING du paramètre table est défini avec la valeur DBTYPE_TABLE.</span><span class="sxs-lookup"><span data-stu-id="8fc58-119">The *wType* field of the DBBINDING structure for the table-valued parameter is set to DBTYPE_TABLE.</span></span> <span data-ttu-id="8fc58-120">Le membre *pObject* de la structure DBBINDING n’est pas Null et le membre *iid* de *pObject* est défini avec la valeur IID_IRowset ou autre interface d’objets d’ensemble de lignes de paramètres table.</span><span class="sxs-lookup"><span data-stu-id="8fc58-120">The *pObject* member of the DBBINDING structure is non-NULL, and the *pObject*'s *iid* member is set to IID_IRowset or any other table-valued parameter rowset object interfaces.</span></span> <span data-ttu-id="8fc58-121">Les champs restants de la structure DBBINDING doivent être définis de la même façon qu'ils le sont pour les BLOB transmis en continu.</span><span class="sxs-lookup"><span data-stu-id="8fc58-121">The remaining fields in the DBBINDING structure should be set the same way they are set for streamed BLOBs.</span></span>  
  
 <span data-ttu-id="8fc58-122">Dans les liaisons du paramètre table et de l'objet d'ensemble de lignes associé à un paramètre table, les restrictions suivantes s'appliquent :</span><span class="sxs-lookup"><span data-stu-id="8fc58-122">In the bindings for the table-valued parameter and the rowset object associated with a table-valued parameter, the following restrictions apply:</span></span>  
  
-   <span data-ttu-id="8fc58-123">Les seules valeurs d'état autorisées pour les données de colonnes d'ensembles de lignes de paramètres table sont DBSTATUS_S_ISNULL et DBSTATUS_S_OK.</span><span class="sxs-lookup"><span data-stu-id="8fc58-123">The only status values allowed for table-valued parameter rowset column data are DBSTATUS_S_ISNULL and DBSTATUS_S_OK.</span></span> <span data-ttu-id="8fc58-124">DBSTATUS_S_DEFAULT se traduit par un échec et la valeur d'état liée est DBSTATUS_E_BADSTATUS.</span><span class="sxs-lookup"><span data-stu-id="8fc58-124">DBSTATUS_S_DEFAULT will result in a failure, and the bound status value will be set to DBSTATUS_E_BADSTATUS.</span></span>  
  
-   <span data-ttu-id="8fc58-125">Un paramètre table peut être marqué avec l'état DBSTATUS_S_DEFAULT.</span><span class="sxs-lookup"><span data-stu-id="8fc58-125">A table-valued parameter can be marked with the status DBSTATUS_S_DEFAULT.</span></span> <span data-ttu-id="8fc58-126">Les seules valeurs valides sont DBSTATUS_S_DEFAULT et DBSTATUS_S_OK.</span><span class="sxs-lookup"><span data-stu-id="8fc58-126">The only valid values are DBSTATUS_S_DEFAULT and DBSTATUS_S_OK.</span></span> <span data-ttu-id="8fc58-127">Quand l'état est défini sur DBSTATUS_S_DEFAULT, la valeur du paramètre table correspond à une table vide.</span><span class="sxs-lookup"><span data-stu-id="8fc58-127">When the status is set to DBSTATUS_S_DEFAULT, the value of the table-valued parameter corresponds to an empty table.</span></span>  
  
-   <span data-ttu-id="8fc58-128">Les colonnes en lecture seule des paramètres table (colonnes d'identité ou colonnes calculées) doivent être marquées comme valeur par défaut à l'aide de la propriété SSPROP_PARAM_TABLE_DEFAULT_COLUMNS.</span><span class="sxs-lookup"><span data-stu-id="8fc58-128">Read-only columns in table-valued parameters (identity or computed columns) must be marked as default by using the SSPROP_PARAM_TABLE_DEFAULT_COLUMNS property.</span></span> <span data-ttu-id="8fc58-129">Les colonnes qui ont une valeur par défaut doivent aussi être marquées comme valeur par défaut via la propriété SSPROP_PARAM_TABLE_DEFAULT_COLUMNS pour autoriser l'utilisation de la valeur par défaut pour les valeurs de données de la colonne d'un paramètre table particulier.</span><span class="sxs-lookup"><span data-stu-id="8fc58-129">Columns that have a default value must also be marked as default through SSPROP_PARAM_TABLE_DEFAULT_COLUMNS property to allow the default value to be used for the column's data values for a particular table-valued parameter.</span></span> <span data-ttu-id="8fc58-130">Le fournisseur ignore les valeurs de données liées pour les colonnes marquées par défaut.</span><span class="sxs-lookup"><span data-stu-id="8fc58-130">The provider will ignore the data values bound for the columns marked as default.</span></span>  
  
-   <span data-ttu-id="8fc58-131">Les données sont envoyées au serveur pour les colonnes avec DBPROP_COL_AUTOINCREMENT ou SSPROP_COL_COMPUTED, à moins que SSPROP_PARAM_TABLE_DEFAULT ne soit également défini.</span><span class="sxs-lookup"><span data-stu-id="8fc58-131">Data will be sent to the server for columns with DBPROP_COL_AUTOINCREMENT or SSPROP_COL_COMPUTED, unless SSPROP_PARAM_TABLE_DEFAULT is also set.</span></span>  
  
## <a name="see-also"></a><span data-ttu-id="8fc58-132">Voir aussi</span><span class="sxs-lookup"><span data-stu-id="8fc58-132">See Also</span></span>  
 <span data-ttu-id="8fc58-133">[Paramètres table &#40;OLE DB&#41;](table-valued-parameters-ole-db.md) </span><span class="sxs-lookup"><span data-stu-id="8fc58-133">[Table-Valued Parameters &#40;OLE DB&#41;](table-valued-parameters-ole-db.md) </span></span>  
 [<span data-ttu-id="8fc58-134">Utiliser les paramètres table &#40;OLE DB&#41;</span><span class="sxs-lookup"><span data-stu-id="8fc58-134">Use Table-Valued Parameters &#40;OLE DB&#41;</span></span>](../native-client-ole-db-how-to/use-table-valued-parameters-ole-db.md)  
  
  
