---
title: Mises à jour positionnées (ODBC) | Microsoft Docs
ms.custom: ''
ms.date: 03/06/2017
ms.prod: sql-server-2014
ms.reviewer: ''
ms.technology: native-client
ms.topic: reference
helpviewer_keywords:
- SQL Server Native Client ODBC driver, cursors
- SQLSetPos function
- SQLSetCursorName function
- ODBC applications, cursors
- cursors [ODBC], positioned updates
- positioned updates [ODBC]
- ODBC cursors, positioned updates
ms.assetid: ff404e02-630f-474d-b5d4-06442b756991
author: rothja
ms.author: jroth
ms.openlocfilehash: 20272014e32632117e6282e5929d1d21789852df
ms.sourcegitcommit: ad4d92dce894592a259721a1571b1d8736abacdb
ms.translationtype: MT
ms.contentlocale: fr-FR
ms.lasthandoff: 08/04/2020
ms.locfileid: "87603512"
---
# <a name="positioned-updates-odbc"></a><span data-ttu-id="5a0f0-102">Mises à jour positionnées (ODBC)</span><span class="sxs-lookup"><span data-stu-id="5a0f0-102">Positioned Updates (ODBC)</span></span>
  <span data-ttu-id="5a0f0-103">ODBC prend en charge deux méthodes permettant d'effectuer des mises à jour positionnées dans un curseur :</span><span class="sxs-lookup"><span data-stu-id="5a0f0-103">ODBC supports two methods for performing positioned updates in a cursor:</span></span>  
  
-   <span data-ttu-id="5a0f0-104">**SQLSetPos**</span><span class="sxs-lookup"><span data-stu-id="5a0f0-104">**SQLSetPos**</span></span>  
  
-   <span data-ttu-id="5a0f0-105">Clause WHERE CURRENT OF</span><span class="sxs-lookup"><span data-stu-id="5a0f0-105">WHERE CURRENT OF clause</span></span>  
  
 <span data-ttu-id="5a0f0-106">L’approche la plus courante consiste à utiliser **SQLSetPos**.</span><span class="sxs-lookup"><span data-stu-id="5a0f0-106">The more common approach is to use **SQLSetPos**.</span></span> <span data-ttu-id="5a0f0-107">Il comporte les options suivantes.</span><span class="sxs-lookup"><span data-stu-id="5a0f0-107">It has the following options.</span></span>  
  
 <span data-ttu-id="5a0f0-108">SQL_POSITION</span><span class="sxs-lookup"><span data-stu-id="5a0f0-108">SQL_POSITION</span></span>  
 <span data-ttu-id="5a0f0-109">Positionne le curseur sur une ligne spécifique dans l'ensemble de lignes actif.</span><span class="sxs-lookup"><span data-stu-id="5a0f0-109">Positions the cursor on a specific row in the current rowset.</span></span>  
  
 <span data-ttu-id="5a0f0-110">SQL_REFRESH</span><span class="sxs-lookup"><span data-stu-id="5a0f0-110">SQL_REFRESH</span></span>  
 <span data-ttu-id="5a0f0-111">Actualise les variables de programme liées aux colonnes de jeu de résultats avec les valeurs provenant de la ligne sur laquelle le curseur est actuellement positionné.</span><span class="sxs-lookup"><span data-stu-id="5a0f0-111">Refreshes program variables bound to the result set columns with the values from the row the cursor is currently positioned on.</span></span>  
  
 <span data-ttu-id="5a0f0-112">SQL_UPDATE</span><span class="sxs-lookup"><span data-stu-id="5a0f0-112">SQL_UPDATE</span></span>  
 <span data-ttu-id="5a0f0-113">Met à jour la ligne active du curseur avec les valeurs stockées dans les variables de programme liées aux colonnes de jeu de résultats.</span><span class="sxs-lookup"><span data-stu-id="5a0f0-113">Updates the current row in the cursor with the values stored in the program variables bound to the result set columns.</span></span>  
  
 <span data-ttu-id="5a0f0-114">SQL_DELETE</span><span class="sxs-lookup"><span data-stu-id="5a0f0-114">SQL_DELETE</span></span>  
 <span data-ttu-id="5a0f0-115">Supprime la ligne active du curseur.</span><span class="sxs-lookup"><span data-stu-id="5a0f0-115">Deletes the current row in the cursor.</span></span>  
  
 <span data-ttu-id="5a0f0-116">**SQLSetPos** peut être utilisé avec n’importe quel jeu de résultats d’instruction lorsque les attributs de curseur de handle d’instruction sont définis pour utiliser des curseurs côté serveur.</span><span class="sxs-lookup"><span data-stu-id="5a0f0-116">**SQLSetPos** can be used with any statement result set when the statement handle cursor attributes are set to use server cursors.</span></span> <span data-ttu-id="5a0f0-117">Les colonnes de jeu de résultats doivent être liées à des variables de programme.</span><span class="sxs-lookup"><span data-stu-id="5a0f0-117">The result set columns must be bound to program variables.</span></span> <span data-ttu-id="5a0f0-118">Dès que l’application a extrait une ligne, elle appelle **SQLSetPos**(SQL_POSTION) pour positionner le curseur sur la ligne.</span><span class="sxs-lookup"><span data-stu-id="5a0f0-118">As soon as the application has fetched a row it calls **SQLSetPos**(SQL_POSTION) to position the cursor on the row.</span></span> <span data-ttu-id="5a0f0-119">L'application peut ensuite appeler SQLSetPos(SQL_DELETE) pour supprimer la ligne active, ou elle peut déplacer les nouvelles valeurs de données dans les variables de programme liées et appeler SQLSetPos(SQL_UPDATE) pour mettre à jour la ligne active.</span><span class="sxs-lookup"><span data-stu-id="5a0f0-119">The application could then call SQLSetPos(SQL_DELETE) to delete the current row, or it can move new data values into the bound program variables and call SQLSetPos(SQL_UPDATE) to update the current row.</span></span>  
  
 <span data-ttu-id="5a0f0-120">Les applications peuvent mettre à jour ou supprimer n’importe quelle ligne de l’ensemble de lignes avec **SQLSetPos**.</span><span class="sxs-lookup"><span data-stu-id="5a0f0-120">Applications can update or delete any row in the rowset with **SQLSetPos**.</span></span> <span data-ttu-id="5a0f0-121">L’appel de **SQLSetPos** est une alternative pratique à la construction et à l’exécution d’une instruction SQL.</span><span class="sxs-lookup"><span data-stu-id="5a0f0-121">Calling **SQLSetPos** is a convenient alternative to constructing and executing an SQL statement.</span></span> <span data-ttu-id="5a0f0-122">**SQLSetPos** fonctionne sur l’ensemble de lignes actuel et peut être utilisé uniquement après un appel à [SQLFetchScroll](../native-client-odbc-api/sqlfetchscroll.md).</span><span class="sxs-lookup"><span data-stu-id="5a0f0-122">**SQLSetPos** operates on the current rowset and can be used only after a call to [SQLFetchScroll](../native-client-odbc-api/sqlfetchscroll.md).</span></span>  
  
 <span data-ttu-id="5a0f0-123">La taille de l’ensemble de lignes est définie par un appel à [SQLSetStmtAttr](../native-client-odbc-api/sqlsetstmtattr.md) avec un argument d’attribut de SQL_ATTR_ROW_ARRAY_SIZE.</span><span class="sxs-lookup"><span data-stu-id="5a0f0-123">Rowset size is set by a call to [SQLSetStmtAttr](../native-client-odbc-api/sqlsetstmtattr.md) with an attribute argument of SQL_ATTR_ROW_ARRAY_SIZE.</span></span> <span data-ttu-id="5a0f0-124">**SQLSetPos** utilise une nouvelle taille d’ensemble de lignes, mais uniquement après un appel à **SQLFetch** ou **SQLFetchScroll**.</span><span class="sxs-lookup"><span data-stu-id="5a0f0-124">**SQLSetPos** uses a new rowset size, but only after a call to **SQLFetch** or **SQLFetchScroll**.</span></span> <span data-ttu-id="5a0f0-125">Par exemple, si la taille de l’ensemble de lignes est modifiée, **SQLSetPos** est appelé, puis **SQLFetch** ou **SQLFetchScroll** est appelé.</span><span class="sxs-lookup"><span data-stu-id="5a0f0-125">For example, if the rowset size is changed, **SQLSetPos** is called and then **SQLFetch** or **SQLFetchScroll** is called.</span></span> <span data-ttu-id="5a0f0-126">L’appel à **SQLSetPos** utilise l’ancienne taille d’ensemble de lignes, mais **SQLFetch** ou **SQLFetchScroll** utilise la nouvelle taille d’ensemble de lignes.</span><span class="sxs-lookup"><span data-stu-id="5a0f0-126">The call to **SQLSetPos** uses the old rowset size, but **SQLFetch** or **SQLFetchScroll** uses the new rowset size.</span></span>  
  
 <span data-ttu-id="5a0f0-127">La première ligne de l'ensemble de lignes porte le numéro 1.</span><span class="sxs-lookup"><span data-stu-id="5a0f0-127">The first row in the rowset is row number 1.</span></span> <span data-ttu-id="5a0f0-128">L’argument RowNumber dans **SQLSetPos** doit identifier une ligne dans l’ensemble de lignes ; autrement dit, sa valeur doit être comprise entre 1 et le nombre de lignes extraites le plus récemment.</span><span class="sxs-lookup"><span data-stu-id="5a0f0-128">The RowNumber argument in **SQLSetPos** must identify a row in the rowset; that is, its value must be in the range between 1 and the number of rows that were most recently fetched.</span></span> <span data-ttu-id="5a0f0-129">Cette valeur peut être inférieure à la taille de l'ensemble de lignes.</span><span class="sxs-lookup"><span data-stu-id="5a0f0-129">This may be less than the rowset size.</span></span> <span data-ttu-id="5a0f0-130">Si RowNumber a la valeur 0, l'opération s'applique à chaque ligne de l'ensemble de lignes.</span><span class="sxs-lookup"><span data-stu-id="5a0f0-130">If RowNumber is 0, the operation applies to every row in the rowset.</span></span>  
  
 <span data-ttu-id="5a0f0-131">L’opération de suppression de **SQLSetPos** permet à la source de données de supprimer une ou plusieurs lignes sélectionnées d’une table.</span><span class="sxs-lookup"><span data-stu-id="5a0f0-131">The delete operation of **SQLSetPos** makes the data source delete one or more selected rows of a table.</span></span> <span data-ttu-id="5a0f0-132">Pour supprimer des lignes avec **SQLSetPos**, l’application appelle **SQLSetPos** avec l’opération définie à SQL_DELETE et RowNumber définie sur le numéro de la ligne à supprimer.</span><span class="sxs-lookup"><span data-stu-id="5a0f0-132">To delete rows with **SQLSetPos**, the application calls **SQLSetPos** with Operation set to SQL_DELETE and RowNumber set to the number of the row to delete.</span></span> <span data-ttu-id="5a0f0-133">Si RowNumber a la valeur 0, toutes les lignes de l'ensemble de lignes sont supprimées.</span><span class="sxs-lookup"><span data-stu-id="5a0f0-133">If RowNumber is 0, all rows in the rowset are deleted.</span></span>  
  
 <span data-ttu-id="5a0f0-134">Une fois **SQLSetPos** retourné, la ligne supprimée est la ligne actuelle et son état est SQL_ROW_DELETED.</span><span class="sxs-lookup"><span data-stu-id="5a0f0-134">After **SQLSetPos** returns, the deleted row is the current row and its status is SQL_ROW_DELETED.</span></span> <span data-ttu-id="5a0f0-135">La ligne ne peut pas être utilisée dans des opérations positionnées supplémentaires, telles que des appels à [SQLGetData](../native-client-odbc-api/sqlgetdata.md) ou **SQLSetPos**.</span><span class="sxs-lookup"><span data-stu-id="5a0f0-135">The row cannot be used in any additional positioned operations, such as calls to [SQLGetData](../native-client-odbc-api/sqlgetdata.md) or **SQLSetPos**.</span></span>  
  
 <span data-ttu-id="5a0f0-136">Lorsque vous supprimez toutes les lignes de l’ensemble de lignes (NombLigne est égal à 0), l’application peut empêcher le pilote de supprimer certaines lignes en utilisant le tableau d’opérations de ligne comme pour l’opération de mise à jour de **SQLSetPos**.</span><span class="sxs-lookup"><span data-stu-id="5a0f0-136">When you delete all rows of the rowset (RowNumber is equal to 0), the application can prevent the driver from deleting certain rows by using the row operation array just like for the update operation of **SQLSetPos**.</span></span>  
  
 <span data-ttu-id="5a0f0-137">Chaque ligne supprimée doit être une ligne qui existe dans le jeu de résultats.</span><span class="sxs-lookup"><span data-stu-id="5a0f0-137">Every row that is deleted should be a row that exists in the result set.</span></span> <span data-ttu-id="5a0f0-138">Si les mémoires tampons de l'application ont été remplies par extraction et si un tableau de statut de ligne a été maintenu, ses valeurs à chacune de ces positions de ligne ne doivent pas être SQL_ROW_DELETED, SQL_ROW_ERROR ou SQL_ROW_NOROW.</span><span class="sxs-lookup"><span data-stu-id="5a0f0-138">If the application buffers were filled by fetching, and if a row status array has been maintained, its values at each of these row positions should not be SQL_ROW_DELETED, SQL_ROW_ERROR, or SQL_ROW_NOROW.</span></span>  
  
 <span data-ttu-id="5a0f0-139">Les mises à jour positionnées peuvent également être réalisées à l'aide de la clause WHERE CURRENT OF sur les instructions UPDATE, DELETE et INSERT.</span><span class="sxs-lookup"><span data-stu-id="5a0f0-139">Positioned updates can also be performed using the WHERE CURRENT OF clause on UPDATE, DELETE, and INSERT statements.</span></span> <span data-ttu-id="5a0f0-140">OÙ CURRENT OF requiert un nom de curseur qui sera généré par ODBC quand la fonction [SQLGetCursorName](../native-client-odbc-api/sqlgetcursorname.md) sera appelée, ou que vous pouvez spécifier en appelant **SQLSetCursorName**.</span><span class="sxs-lookup"><span data-stu-id="5a0f0-140">WHERE CURRENT OF requires a cursor name that ODBC will generate when the [SQLGetCursorName](../native-client-odbc-api/sqlgetcursorname.md) function is called, or which you can specify by calling **SQLSetCursorName**.</span></span> <span data-ttu-id="5a0f0-141">La procédure générale suivante est utilisée pour effectuer une mise à jour de WHERE CURRENT OF dans une application ODBC :</span><span class="sxs-lookup"><span data-stu-id="5a0f0-141">The following are general steps used to perform a WHERE CURRENT OF update in an ODBC application:</span></span>  
  
-   <span data-ttu-id="5a0f0-142">Appelez **SQLSetCursorName** pour établir un nom de curseur pour le descripteur d’instruction.</span><span class="sxs-lookup"><span data-stu-id="5a0f0-142">Call **SQLSetCursorName** to establish a cursor name for the statement handle.</span></span>  
  
-   <span data-ttu-id="5a0f0-143">Générez une instruction SELECT avec une clause FOR UPDATE OF et exécutez-la.</span><span class="sxs-lookup"><span data-stu-id="5a0f0-143">Build a SELECT statement with a FOR UPDATE OF clause and execute it.</span></span>  
  
-   <span data-ttu-id="5a0f0-144">Appelez **SQLFetchScroll** pour récupérer un ensemble de lignes ou **SQLFetch** pour récupérer une ligne.</span><span class="sxs-lookup"><span data-stu-id="5a0f0-144">Call **SQLFetchScroll** to retrieve a rowset or **SQLFetch** to retrieve a row.</span></span>  
  
-   <span data-ttu-id="5a0f0-145">Appelez **SQLSetPos** (SQL_POSITION) pour positionner le curseur sur la ligne.</span><span class="sxs-lookup"><span data-stu-id="5a0f0-145">Call **SQLSetPos** (SQL_POSITION) to position the cursor on the row.</span></span>  
  
-   <span data-ttu-id="5a0f0-146">Générez et exécutez une instruction UPDATE avec une clause WHERE CURRENT OF en utilisant le nom de curseur défini avec **SQLSetCursorName**.</span><span class="sxs-lookup"><span data-stu-id="5a0f0-146">Build and execute an UPDATE statement with a WHERE CURRENT OF clause using the cursor name set with **SQLSetCursorName**.</span></span>  
  
 <span data-ttu-id="5a0f0-147">Vous pouvez également appeler **SQLGetCursorName** après avoir exécuté l’instruction SELECT au lieu d’appeler **SQLSetCursorName** avant d’exécuter l’instruction SELECT.</span><span class="sxs-lookup"><span data-stu-id="5a0f0-147">Alternatively, you could call **SQLGetCursorName** after you execute the SELECT statement instead of calling **SQLSetCursorName** before executing the SELECT statement.</span></span> <span data-ttu-id="5a0f0-148">**SQLGetCursorName** retourne un nom de curseur par défaut attribué par ODBC si vous ne définissez pas de nom de curseur à l’aide de **SQLSetCursorName**.</span><span class="sxs-lookup"><span data-stu-id="5a0f0-148">**SQLGetCursorName** returns a default cursor name assigned by ODBC if you do not set a cursor name using **SQLSetCursorName**.</span></span>  
  
 <span data-ttu-id="5a0f0-149">**SQLSetPos** est préférable à l’emplacement actuel de lorsque vous utilisez des curseurs côté serveur.</span><span class="sxs-lookup"><span data-stu-id="5a0f0-149">**SQLSetPos** is preferred over WHERE CURRENT OF when you are using server cursors.</span></span> <span data-ttu-id="5a0f0-150">Si vous utilisez un curseur statique pouvant être mis à jour avec la bibliothèque de curseurs ODBC, la bibliothèque de curseurs implémente les mises à jour WHERE CURRENT OF en ajoutant une clause WHERE avec les valeurs de clé pour la table sous-jacente.</span><span class="sxs-lookup"><span data-stu-id="5a0f0-150">If you are using a static, updatable cursor with the ODBC cursor library, the cursor library implements WHERE CURRENT OF updates by adding a WHERE clause with the key values for the underlying table.</span></span> <span data-ttu-id="5a0f0-151">Cela peut entraîner des mises à jour inattendues si les clés de la table ne sont pas uniques.</span><span class="sxs-lookup"><span data-stu-id="5a0f0-151">This can cause unintended updates if the keys in the table are not unique.</span></span>  
  
## <a name="see-also"></a><span data-ttu-id="5a0f0-152">Voir aussi</span><span class="sxs-lookup"><span data-stu-id="5a0f0-152">See Also</span></span>  
 [<span data-ttu-id="5a0f0-153">Utilisation de curseurs &#40;ODBC&#41;</span><span class="sxs-lookup"><span data-stu-id="5a0f0-153">Using Cursors &#40;ODBC&#41;</span></span>](using-cursors-odbc.md)  
  
  
