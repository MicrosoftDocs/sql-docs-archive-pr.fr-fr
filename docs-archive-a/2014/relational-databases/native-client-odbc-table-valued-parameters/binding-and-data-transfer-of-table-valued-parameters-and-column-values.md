---
title: Liaison et Transfert de données des paramètres table et des valeurs de colonne | Microsoft Docs
ms.custom: ''
ms.date: 03/06/2017
ms.prod: sql-server-2014
ms.reviewer: ''
ms.technology: native-client
ms.topic: reference
helpviewer_keywords:
- table-valued parameters (ODBC), binding and data transfer
ms.assetid: 0a2ea462-d613-42b6-870f-c7fa086a6b42
author: rothja
ms.author: jroth
ms.openlocfilehash: 2e9e30e22a69b2d500990cc1481506b4edbda99b
ms.sourcegitcommit: ad4d92dce894592a259721a1571b1d8736abacdb
ms.translationtype: MT
ms.contentlocale: fr-FR
ms.lasthandoff: 08/04/2020
ms.locfileid: "87612815"
---
# <a name="binding-and-data-transfer-of-table-valued-parameters-and-column-values"></a><span data-ttu-id="5cdf8-102">Liaison et transfert de données de paramètres table et de valeurs de colonnes</span><span class="sxs-lookup"><span data-stu-id="5cdf8-102">Binding and Data Transfer of Table-Valued Parameters and Column Values</span></span>
  <span data-ttu-id="5cdf8-103">Les paramètres table, comme d'autres paramètres, doivent être liés avant d'être passés au serveur.</span><span class="sxs-lookup"><span data-stu-id="5cdf8-103">Table-valued parameters, like other parameters, must be bound before they are passed to the server.</span></span> <span data-ttu-id="5cdf8-104">L’application lie les paramètres table de la même façon qu’elle lie d’autres paramètres : en utilisant SQLBindParameter ou des appels équivalents à SQLSetDescField ou SQLSetDescRec.</span><span class="sxs-lookup"><span data-stu-id="5cdf8-104">The application binds table-valued parameters the same way it binds other parameters: by using SQLBindParameter or equivalent calls to SQLSetDescField or SQLSetDescRec.</span></span> <span data-ttu-id="5cdf8-105">Le type de données serveur pour un paramètre table est SQL_SS_TABLE.</span><span class="sxs-lookup"><span data-stu-id="5cdf8-105">The server data type for a table-valued parameter is SQL_SS_TABLE.</span></span> <span data-ttu-id="5cdf8-106">Le type C peut être spécifié comme SQL_C_DEFAULT ou SQL_C_BINARY.</span><span class="sxs-lookup"><span data-stu-id="5cdf8-106">The C type can be specified either as SQL_C_DEFAULT or SQL_C_BINARY.</span></span>  
  
 <span data-ttu-id="5cdf8-107">Dans [!INCLUDE[ssKatmai](../../includes/sskatmai-md.md)] ou version ultérieure, seuls les paramètres table d'entrée sont pris en charge.</span><span class="sxs-lookup"><span data-stu-id="5cdf8-107">In [!INCLUDE[ssKatmai](../../includes/sskatmai-md.md)] or later, only input table-valued parameters are supported.</span></span> <span data-ttu-id="5cdf8-108">Par conséquent, toute tentative de définition de SQL_DESC_PARAMETER_TYPE à une valeur autre que SQL_PARAM_INPUT retourne SQL_ERROR avec SQLSTATE = HY105 et le message « type de paramètre non valide ».</span><span class="sxs-lookup"><span data-stu-id="5cdf8-108">Therefore, any attempt to set SQL_DESC_PARAMETER_TYPE to a value other than SQL_PARAM_INPUT will return SQL_ERROR with SQLSTATE = HY105 and the message "Invalid parameter type".</span></span>  
  
 <span data-ttu-id="5cdf8-109">Des valeurs par défaut peuvent être assignées à des colonnes de paramètres table entières à l'aide de l'attribut SQL_CA_SS_COL_HAS_DEFAULT_VALUE.</span><span class="sxs-lookup"><span data-stu-id="5cdf8-109">Entire table-valued parameter columns can be assigned default values by using the attribute SQL_CA_SS_COL_HAS_DEFAULT_VALUE.</span></span> <span data-ttu-id="5cdf8-110">Toutefois, il n’est pas possible d’assigner des valeurs par défaut à des valeurs de colonne de paramètre table individuelles à l’aide de SQL_DEFAULT_PARAM dans *StrLen_or_IndPtr* avec SQLBindParameter.</span><span class="sxs-lookup"><span data-stu-id="5cdf8-110">Individual table-valued parameter column values, however, cannot be assigned default values by using SQL_DEFAULT_PARAM in *StrLen_or_IndPtr* with SQLBindParameter.</span></span> <span data-ttu-id="5cdf8-111">Les paramètres table dans leur ensemble ne peuvent pas être définis sur une valeur par défaut à l’aide de SQL_DEFAULT_PARAM dans *StrLen_or_IndPtr* avec SQLBindParameter.</span><span class="sxs-lookup"><span data-stu-id="5cdf8-111">Table-valued parameters as a whole cannot be set to a default value by using SQL_DEFAULT_PARAM in *StrLen_or_IndPtr* with SQLBindParameter.</span></span> <span data-ttu-id="5cdf8-112">Si ces règles ne sont pas suivies, SQLExecute ou SQLExecDirect retourne SQL_ERROR.</span><span class="sxs-lookup"><span data-stu-id="5cdf8-112">If these rules are not followed, SQLExecute or SQLExecDirect will return SQL_ERROR.</span></span> <span data-ttu-id="5cdf8-113">Un enregistrement de diagnostic est généré avec SQLSTATE = 07S01 et le message « utilisation non valide du paramètre par défaut pour le paramètre \<p> », où \<p> est l’ordinal du TVP dans l’instruction de la requête.</span><span class="sxs-lookup"><span data-stu-id="5cdf8-113">A diagnostic record will be generated with SQLSTATE=07S01 and the message "Invalid use of default parameter for parameter \<p>", where \<p> is the ordinal of the TVP in the query statement.</span></span>  
  
 <span data-ttu-id="5cdf8-114">Après avoir lié le paramètre table, l'application doit lier chaque colonne de paramètre table.</span><span class="sxs-lookup"><span data-stu-id="5cdf8-114">After binding the table-valued parameter, the application must then bind each table-valued parameter column.</span></span> <span data-ttu-id="5cdf8-115">Pour ce faire, l’application appelle d’abord SQLSetStmtAttr pour définir SQL_SOPT_SS_PARAM_FOCUS sur l’ordinal d’un paramètre table.</span><span class="sxs-lookup"><span data-stu-id="5cdf8-115">To do this, the application first calls SQLSetStmtAttr to set SQL_SOPT_SS_PARAM_FOCUS to the ordinal of a table-valued parameter.</span></span> <span data-ttu-id="5cdf8-116">Ensuite, l’application lie les colonnes du paramètre table en appelant les routines suivantes : SQLBindParameter, SQLSetDescRec et SQLSetDescField.</span><span class="sxs-lookup"><span data-stu-id="5cdf8-116">Then the application binds the columns of the table-valued parameter by calls to the following routines: SQLBindParameter, SQLSetDescRec, and SQLSetDescField.</span></span> <span data-ttu-id="5cdf8-117">L’affectation de la valeur 0 à SQL_SOPT_SS_PARAM_FOCUS restaure l’effet habituel de SQLBindParameter, SQLSetDescRec et SQLSetDescField en opérant sur des paramètres de niveau supérieur normaux.</span><span class="sxs-lookup"><span data-stu-id="5cdf8-117">Setting SQL_SOPT_SS_PARAM_FOCUS to 0 restores the usual effect of SQLBindParameter, SQLSetDescRec, and SQLSetDescField in operating on regular top-level parameters.</span></span>  
  
 <span data-ttu-id="5cdf8-118">Aucune donnée n'est réellement envoyée ou reçue pour le paramètre table lui-même, mais des données sont envoyées et reçues pour chacune de ses colonnes constituantes.</span><span class="sxs-lookup"><span data-stu-id="5cdf8-118">No actual data is sent or received for the table-valued parameter itself, but data is sent and received for each of its constituent columns.</span></span> <span data-ttu-id="5cdf8-119">Étant donné que le paramètre table est une pseudo-colonne, les paramètres de SQLBindParameter sont utilisés pour faire référence à des attributs différents de ceux des autres types de données, comme suit :</span><span class="sxs-lookup"><span data-stu-id="5cdf8-119">Because the table-valued parameter is a pseudo column, the parameters for SQLBindParameter are used to refer to different attributes than other data types, as follows:</span></span>  
  
|<span data-ttu-id="5cdf8-120">Paramètre</span><span class="sxs-lookup"><span data-stu-id="5cdf8-120">Parameter</span></span>|<span data-ttu-id="5cdf8-121">Attribut associé pour les types de paramètre non table, y compris les colonnes</span><span class="sxs-lookup"><span data-stu-id="5cdf8-121">Related attribute for non-table-valued parameter types, including columns</span></span>|<span data-ttu-id="5cdf8-122">Attribut associé pour les paramètres table</span><span class="sxs-lookup"><span data-stu-id="5cdf8-122">Related attribute for table-valued parameters</span></span>|  
|---------------|--------------------------------------------------------------------------------|----------------------------------------------------|  
|<span data-ttu-id="5cdf8-123">*InputOutputType*</span><span class="sxs-lookup"><span data-stu-id="5cdf8-123">*InputOutputType*</span></span>|<span data-ttu-id="5cdf8-124">SQL_DESC_PARAMETER_TYPE dans IPD.</span><span class="sxs-lookup"><span data-stu-id="5cdf8-124">SQL_DESC_PARAMETER_TYPE in IPD.</span></span><br /><br /> <span data-ttu-id="5cdf8-125">Pour les colonnes de paramètre table, ce doit être identique au paramètre du paramètre table lui-même.</span><span class="sxs-lookup"><span data-stu-id="5cdf8-125">For table-valued parameter columns, this must be the same as the setting for the table-valued parameter itself.</span></span>|<span data-ttu-id="5cdf8-126">SQL_DESC_PARAMETER_TYPE dans IPD.</span><span class="sxs-lookup"><span data-stu-id="5cdf8-126">SQL_DESC_PARAMETER_TYPE in IPD.</span></span><br /><br /> <span data-ttu-id="5cdf8-127">Ce doit être SQL_PARAM_INPUT.</span><span class="sxs-lookup"><span data-stu-id="5cdf8-127">This must be SQL_PARAM_INPUT.</span></span>|  
|<span data-ttu-id="5cdf8-128">*ValueType*</span><span class="sxs-lookup"><span data-stu-id="5cdf8-128">*ValueType*</span></span>|<span data-ttu-id="5cdf8-129">SQL_DESC_TYPE, SQL_DESC_CONCISE_TYPE dans APD.</span><span class="sxs-lookup"><span data-stu-id="5cdf8-129">SQL_DESC_TYPE, SQL_DESC_CONCISE_TYPE in APD.</span></span>|<span data-ttu-id="5cdf8-130">SQL_DESC_TYPE, SQL_DESC_CONCISE_TYPE dans APD.</span><span class="sxs-lookup"><span data-stu-id="5cdf8-130">SQL_DESC_TYPE, SQL_DESC_CONCISE_TYPE in APD.</span></span><br /><br /> <span data-ttu-id="5cdf8-131">Ce doit être SQL_C_DEFAULT ou SQL_C_BINARY.</span><span class="sxs-lookup"><span data-stu-id="5cdf8-131">This must be SQL_C_DEFAULT or SQL_C_BINARY.</span></span>|  
|<span data-ttu-id="5cdf8-132">*ParameterType*</span><span class="sxs-lookup"><span data-stu-id="5cdf8-132">*ParameterType*</span></span>|<span data-ttu-id="5cdf8-133">SQL_DESC_TYPE, SQL_DESC_CONCISE_TYPE dans IPD.</span><span class="sxs-lookup"><span data-stu-id="5cdf8-133">SQL_DESC_TYPE, SQL_DESC_CONCISE_TYPE in IPD.</span></span>|<span data-ttu-id="5cdf8-134">SQL_DESC_TYPE, SQL_DESC_CONCISE_TYPE dans IPD.</span><span class="sxs-lookup"><span data-stu-id="5cdf8-134">SQL_DESC_TYPE, SQL_DESC_CONCISE_TYPE in IPD.</span></span><br /><br /> <span data-ttu-id="5cdf8-135">Ce doit être SQL_SS_TABLE.</span><span class="sxs-lookup"><span data-stu-id="5cdf8-135">This must be SQL_SS_TABLE.</span></span>|  
|<span data-ttu-id="5cdf8-136">*ColumnSize*</span><span class="sxs-lookup"><span data-stu-id="5cdf8-136">*ColumnSize*</span></span>|<span data-ttu-id="5cdf8-137">SQL_DESC_LENGTH ou SQL_DESC_PRECISION dans IPD.</span><span class="sxs-lookup"><span data-stu-id="5cdf8-137">SQL_DESC_LENGTH or SQL_DESC_PRECISION in IPD.</span></span><br /><br /> <span data-ttu-id="5cdf8-138">Cela dépend de la valeur de *ParameterType*.</span><span class="sxs-lookup"><span data-stu-id="5cdf8-138">This depends on the value of *ParameterType*.</span></span>|<span data-ttu-id="5cdf8-139">SQL_DESC_ARRAY_SIZE</span><span class="sxs-lookup"><span data-stu-id="5cdf8-139">SQL_DESC_ARRAY_SIZE</span></span><br /><br /> <span data-ttu-id="5cdf8-140">Peut également être défini à l'aide de SQL_ATTR_PARAM_SET_SIZE lorsque le focus de paramètre est défini sur le paramètre table.</span><span class="sxs-lookup"><span data-stu-id="5cdf8-140">Can also be set using SQL_ATTR_PARAM_SET_SIZE when the parameter focus is set to the table-valued parameter.</span></span><br /><br /> <span data-ttu-id="5cdf8-141">Pour un paramètre table, il s'agit du nombre de lignes dans les mémoires tampons de colonnes de paramètres table.</span><span class="sxs-lookup"><span data-stu-id="5cdf8-141">For a table-valued parameter, this is the number of rows in the table-valued parameter column buffers.</span></span>|  
|<span data-ttu-id="5cdf8-142">*DecimalDigits*</span><span class="sxs-lookup"><span data-stu-id="5cdf8-142">*DecimalDigits*</span></span>|<span data-ttu-id="5cdf8-143">SQL_DESC_PRECISION or SQL_DESC_SCALE dans IPD.</span><span class="sxs-lookup"><span data-stu-id="5cdf8-143">SQL_DESC_PRECISION or SQL_DESC_SCALE in IPD.</span></span>|<span data-ttu-id="5cdf8-144">Inutilisé.</span><span class="sxs-lookup"><span data-stu-id="5cdf8-144">Unused.</span></span> <span data-ttu-id="5cdf8-145">Doit être 0.</span><span class="sxs-lookup"><span data-stu-id="5cdf8-145">This must be 0.</span></span><br /><br /> <span data-ttu-id="5cdf8-146">Si ce paramètre n’est pas égal à 0, SQLBindParameter retourne SQL_ERROR et un enregistrement de diagnostic est généré avec SQLSTATE = HY104 et le message « précision ou échelle non valide ».</span><span class="sxs-lookup"><span data-stu-id="5cdf8-146">If this parameter is not 0, SQLBindParameter will return SQL_ERROR, and a diagnostic record will be generated with SQLSTATE= HY104 and the message "Invalid precision or scale".</span></span>|  
|<span data-ttu-id="5cdf8-147">*ParameterValuePtr*</span><span class="sxs-lookup"><span data-stu-id="5cdf8-147">*ParameterValuePtr*</span></span>|<span data-ttu-id="5cdf8-148">SQL_DESC_DATA_PTR dans APD.</span><span class="sxs-lookup"><span data-stu-id="5cdf8-148">SQL_DESC_DATA_PTR in APD.</span></span>|<span data-ttu-id="5cdf8-149">SQL_CA_SS_TYPE_NAME.</span><span class="sxs-lookup"><span data-stu-id="5cdf8-149">SQL_CA_SS_TYPE_NAME.</span></span><br /><br /> <span data-ttu-id="5cdf8-150">Ceci est facultatif pour les appels de procédure stockée et NULL peut être spécifié si ce n'est pas requis.</span><span class="sxs-lookup"><span data-stu-id="5cdf8-150">This is optional for stored procedure calls, and NULL can be specified if it is not required.</span></span> <span data-ttu-id="5cdf8-151">Doit être spécifié pour les instructions SQL qui ne sont pas des appels de procédure.</span><span class="sxs-lookup"><span data-stu-id="5cdf8-151">It must be specified for SQL statements that are not procedure calls.</span></span><br /><br /> <span data-ttu-id="5cdf8-152">Ce paramètre sert également de valeur unique que l'application peut utiliser pour identifier ce paramètre table lorsque la liaison de ligne variable est utilisée.</span><span class="sxs-lookup"><span data-stu-id="5cdf8-152">This parameter also serves as a unique value that the application can use to identify this table-valued parameter when variable row binding is used.</span></span> <span data-ttu-id="5cdf8-153">Pour plus d'informations, consultez la section « Liaison de ligne de paramètre table variable » plus loin dans cette rubrique.</span><span class="sxs-lookup"><span data-stu-id="5cdf8-153">For more information, see the "Variable Table-Valued Parameter Row Binding" section, later in this topic.</span></span><br /><br /> <span data-ttu-id="5cdf8-154">Lorsqu’un nom de type de paramètre table est spécifié sur un appel à SQLBindParameter, il doit être spécifié en tant que valeur Unicode, même dans les applications générées en tant qu’applications ANSI.</span><span class="sxs-lookup"><span data-stu-id="5cdf8-154">When a table-valued parameter type name is specified on a call to SQLBindParameter, it must be specified as a Unicode value, even in applications that are built as ANSI applications.</span></span> <span data-ttu-id="5cdf8-155">La valeur utilisée pour le paramètre *StrLen_or_IndPtr* doit être SQL_NTS ou la longueur de chaîne du nom multipliée par sizeof (WCHAR).</span><span class="sxs-lookup"><span data-stu-id="5cdf8-155">The value used for the parameter *StrLen_or_IndPtr* should be either SQL_NTS or the string length of the name multiplied by sizeof(WCHAR).</span></span>|  
|<span data-ttu-id="5cdf8-156">*BufferLength*</span><span class="sxs-lookup"><span data-stu-id="5cdf8-156">*BufferLength*</span></span>|<span data-ttu-id="5cdf8-157">SQL_DESC_OCTET_LENGTH dans APD.</span><span class="sxs-lookup"><span data-stu-id="5cdf8-157">SQL_DESC_OCTET_LENGTH in APD.</span></span>|<span data-ttu-id="5cdf8-158">Longueur du nom de type de paramètre table en octets.</span><span class="sxs-lookup"><span data-stu-id="5cdf8-158">The length of the table-valued parameter type name in bytes.</span></span><br /><br /> <span data-ttu-id="5cdf8-159">Cela peut être SQL_NTS si le nom de type se termine par une valeur Null ou 0 si le nom de type de paramètre table n'est pas requis.</span><span class="sxs-lookup"><span data-stu-id="5cdf8-159">This can be SQL_NTS if the type name is null terminated, or 0 if the table-valued parameter type name is not required.</span></span>|  
|<span data-ttu-id="5cdf8-160">*StrLen_or_IndPtr*</span><span class="sxs-lookup"><span data-stu-id="5cdf8-160">*StrLen_or_IndPtr*</span></span>|<span data-ttu-id="5cdf8-161">SQL_DESC_OCTET_LENGTH_PTR dans APD.</span><span class="sxs-lookup"><span data-stu-id="5cdf8-161">SQL_DESC_OCTET_LENGTH_PTR in APD.</span></span>|<span data-ttu-id="5cdf8-162">SQL_DESC_OCTET_LENGTH_PTR dans APD.</span><span class="sxs-lookup"><span data-stu-id="5cdf8-162">SQL_DESC_OCTET_LENGTH_PTR in APD.</span></span><br /><br /> <span data-ttu-id="5cdf8-163">Pour les paramètres table, il s'agit d'un nombre de lignes plutôt qu'une longueur de données.</span><span class="sxs-lookup"><span data-stu-id="5cdf8-163">For table-valued parameters, this is a row count rather than a data length.</span></span>|  
  
 <span data-ttu-id="5cdf8-164">Deux modes de transfert de données sont pris en charge pour les paramètres table : la liaison de ligne fixe et la liaison de ligne variable.</span><span class="sxs-lookup"><span data-stu-id="5cdf8-164">Two data transfer modes are supported for table-valued parameters: fixed row binding and variable row binding.</span></span>  
  
## <a name="fixed-table-valued-parameter-row-binding"></a><span data-ttu-id="5cdf8-165">Liaison de ligne de paramètre table fixe</span><span class="sxs-lookup"><span data-stu-id="5cdf8-165">Fixed Table-Valued Parameter Row Binding</span></span>  
 <span data-ttu-id="5cdf8-166">Pour la liaison de ligne fixe, une application alloue des mémoires tampon (ou tableaux de mémoires tampon) suffisamment grandes pour toutes les valeurs de colonne d'entrée possibles.</span><span class="sxs-lookup"><span data-stu-id="5cdf8-166">For fixed row binding, an application allocates buffers (or buffer arrays) large enough for all possible input column values.</span></span> <span data-ttu-id="5cdf8-167">L'application effectue les actions suivantes :</span><span class="sxs-lookup"><span data-stu-id="5cdf8-167">The application does the following:</span></span>  
  
1.  <span data-ttu-id="5cdf8-168">Lie tous les paramètres à l’aide des appels SQLBindParameter, SQLSetDescRec ou SQLSetDescField.</span><span class="sxs-lookup"><span data-stu-id="5cdf8-168">Binds all parameters by using SQLBindParameter, SQLSetDescRec, or SQLSetDescField calls.</span></span>  
  
    1.  <span data-ttu-id="5cdf8-169">Elle définit SQL_DESC_ARRAY_SIZE au nombre maximal de lignes qui peuvent être transférées pour chaque paramètre table.</span><span class="sxs-lookup"><span data-stu-id="5cdf8-169">Sets SQL_DESC_ARRAY_SIZE to the maximum number of rows that can be transferred for each table-valued parameter.</span></span> <span data-ttu-id="5cdf8-170">Cela peut être fait dans l’appel SQLBindParameter.</span><span class="sxs-lookup"><span data-stu-id="5cdf8-170">This can be done in the SQLBindParameter call.</span></span>  
  
2.  <span data-ttu-id="5cdf8-171">Appelle SQLSetStmtAttr pour définir SQL_SOPT_SS_PARAM_FOCUS à l’ordinal de chaque paramètre table.</span><span class="sxs-lookup"><span data-stu-id="5cdf8-171">Calls SQLSetStmtAttr to set SQL_SOPT_SS_PARAM_FOCUS to the ordinal of each table-valued parameter.</span></span>  
  
    1.  <span data-ttu-id="5cdf8-172">Pour chaque paramètre table, lie les colonnes de paramètre table à l’aide des appels SQLBindParameter, SQLSetDescRec ou SQLSetDescField.</span><span class="sxs-lookup"><span data-stu-id="5cdf8-172">For each table-valued parameter, binds table-valued parameter columns by using SQLBindParameter, SQLSetDescRec, or SQLSetDescField calls.</span></span>  
  
    2.  <span data-ttu-id="5cdf8-173">Pour chaque colonne de paramètre table qui doit avoir des valeurs par défaut, appelle SQLSetDescField pour affecter la valeur 1 à SQL_CA_SS_COL_HAS_DEFAULT_VALUE.</span><span class="sxs-lookup"><span data-stu-id="5cdf8-173">For each table-valued parameter column that is to have default values, calls SQLSetDescField to set SQL_CA_SS_COL_HAS_DEFAULT_VALUE to 1.</span></span>  
  
3.  <span data-ttu-id="5cdf8-174">Appelle SQLSetStmtAttr pour affecter la valeur 0 à SQL_SOPT_SS_PARAM_FOCUS.</span><span class="sxs-lookup"><span data-stu-id="5cdf8-174">Calls SQLSetStmtAttr to set SQL_SOPT_SS_PARAM_FOCUS to 0.</span></span> <span data-ttu-id="5cdf8-175">Cela doit être fait avant l’appel de SQLExecute ou SQLExecDirect.</span><span class="sxs-lookup"><span data-stu-id="5cdf8-175">This must be done before SQLExecute or SQLExecDirect is called.</span></span> <span data-ttu-id="5cdf8-176">Autrement, SQL_ERROR est retourné et un enregistrement de diagnostic est généré avec SQLSTATE=HY024 et le message « Valeur d'attribut non valide, SQL_SOPT_SS_PARAM_FOCUS (doit être égale à zéro au moment de l'exécution) ».</span><span class="sxs-lookup"><span data-stu-id="5cdf8-176">Otherwise, SQL_ERROR is be returned and a diagnostic record is generated with SQLSTATE=HY024 and the message "Invalid attribute value, SQL_SOPT_SS_PARAM_FOCUS (must be zero at execution time)".</span></span>  
  
4.  <span data-ttu-id="5cdf8-177">Définit *StrLen_or_IndPtr* ou SQL_DESC_OCTET_LENGTH_PTR à SQL_DEFAULT_PARAM pour un paramètre table sans ligne, ou le nombre de lignes à transférer lors de l’appel suivant de SQLExecute ou SQLExecDirect si le paramètre table a des lignes.</span><span class="sxs-lookup"><span data-stu-id="5cdf8-177">Sets *StrLen_or_IndPtr* or SQL_DESC_OCTET_LENGTH_PTR to SQL_DEFAULT_PARAM for a table-valued parameter with no rows, or the number of rows to be transferred on the next call of SQLExecute or SQLExecDirect if the table-valued parameter has rows.</span></span> <span data-ttu-id="5cdf8-178">*StrLen_or_IndPtr* ou SQL_DESC_OCTET_LENGTH_PTR ne peuvent pas être définis sur SQL_NULL_DATA pour un paramètre table, car les paramètres table ne sont pas nullables (bien que les colonnes constituantes des paramètres table puissent avoir la valeur null).</span><span class="sxs-lookup"><span data-stu-id="5cdf8-178">*StrLen_or_IndPtr* or SQL_DESC_OCTET_LENGTH_PTR cannot be set to SQL_NULL_DATA for a table-valued parameter as table-valued parameters are not nullable (though table-valued parameter constituent columns may be nullable).</span></span> <span data-ttu-id="5cdf8-179">Si cette valeur est définie sur une valeur non valide, SQLExecute ou SQLExecDirect retourne SQL_ERROR, et un enregistrement de diagnostic est généré avec SQLSTATE = HY090 et le message « longueur de chaîne ou de mémoire tampon non valide pour le paramètre \<p> », où p est le numéro du paramètre.</span><span class="sxs-lookup"><span data-stu-id="5cdf8-179">If this is set to an invalid value, SQLExecute or SQLExecDirect returns SQL_ERROR, and a diagnostic record is generated with SQLSTATE=HY090 and the message "Invalid string or buffer length for parameter \<p>", where p is the parameter number.</span></span>  
  
5.  <span data-ttu-id="5cdf8-180">Appelle SQLExecute ou SQLExecDirect.</span><span class="sxs-lookup"><span data-stu-id="5cdf8-180">Calls SQLExecute or SQLExecDirect.</span></span>  
  
 <span data-ttu-id="5cdf8-181">Les valeurs de colonne de paramètre table d’entrée peuvent être passées en parties si *StrLen_or_IndPtr* est défini sur SQL_LEN_DATA_AT_EXEC (*longueur*) ou SQL_DATA_AT_EXEC pour la colonne.</span><span class="sxs-lookup"><span data-stu-id="5cdf8-181">Input table-valued parameter column values can be passed in pieces if *StrLen_or_IndPtr* is set to SQL_LEN_DATA_AT_EXEC(*length*) or SQL_DATA_AT_EXEC for the column.</span></span> <span data-ttu-id="5cdf8-182">Cela s'apparente au passage de valeurs en fragments lorsque des tableaux de paramètres sont utilisés.</span><span class="sxs-lookup"><span data-stu-id="5cdf8-182">This is similar to passing values in pieces when arrays of parameters are used.</span></span> <span data-ttu-id="5cdf8-183">Comme avec tous les paramètres de données en cours d’exécution, SQLParamData n’indique pas la ligne du tableau pour lequel le pilote demande des données ; l’application doit s’en occuper.</span><span class="sxs-lookup"><span data-stu-id="5cdf8-183">As with all data-at-execution parameters, SQLParamData does not indicate which row of the array the driver is requesting data for; the application must take care of this.</span></span> <span data-ttu-id="5cdf8-184">L'application ne peut pas faire d'hypothèses concernant l'ordre dans lequel le pilote demandera des valeurs.</span><span class="sxs-lookup"><span data-stu-id="5cdf8-184">The application cannot make any assumptions about the order in which the driver will request values.</span></span>  
  
## <a name="variable-table-valued-parameter-row-binding"></a><span data-ttu-id="5cdf8-185">Liaison de ligne de paramètre table variable</span><span class="sxs-lookup"><span data-stu-id="5cdf8-185">Variable Table-Valued Parameter Row Binding</span></span>  
 <span data-ttu-id="5cdf8-186">Pour la liaison de ligne variable, les lignes sont transférées par lots au moment de l'exécution et l'application passe des lignes au pilote sur demande.</span><span class="sxs-lookup"><span data-stu-id="5cdf8-186">For variable row binding, rows are transferred in batches at execution time and the application passes rows to the driver on demand.</span></span> <span data-ttu-id="5cdf8-187">Cela s'apparente à la fonctionnalité « data-at-execution » pour les valeurs de paramètre individuelles.</span><span class="sxs-lookup"><span data-stu-id="5cdf8-187">This is similar to data-at-execution for individual parameter values.</span></span> <span data-ttu-id="5cdf8-188">Pour la liaison de ligne variable, l'application effectue les opérations suivantes :</span><span class="sxs-lookup"><span data-stu-id="5cdf8-188">For variable row binding, the application does the following:</span></span>  
  
1.  <span data-ttu-id="5cdf8-189">Elle lie les paramètres et les colonnes de paramètre table comme décrit aux étapes 1 à 3 de la section précédente, « Liaison de ligne de paramètre table fixe ».</span><span class="sxs-lookup"><span data-stu-id="5cdf8-189">Binds parameters and table-valued parameter columns as described in steps 1 to 3 of the previous section, "Fixed Table-Valued Parameter Row Binding".</span></span>  
  
2.  <span data-ttu-id="5cdf8-190">Définit *StrLen_or_IndPtr* ou SQL_DESC_OCTET_LENGTH_PTR pour tous les paramètres table qui doivent être passés au moment de l’exécution pour SQL_DATA_AT_EXEC.</span><span class="sxs-lookup"><span data-stu-id="5cdf8-190">Sets *StrLen_or_IndPtr* or SQL_DESC_OCTET_LENGTH_PTR for any table-valued parameters that are to be passed at execution time to SQL_DATA_AT_EXEC.</span></span> <span data-ttu-id="5cdf8-191">Si ni l'un ni l'autre n'est défini, le paramètre est traité comme décrit dans la section précédente.</span><span class="sxs-lookup"><span data-stu-id="5cdf8-191">If neither is set, the parameter will be processed as described in the previous section.</span></span>  
  
3.  <span data-ttu-id="5cdf8-192">Appelle SQLExecute ou SQLExecDirect.</span><span class="sxs-lookup"><span data-stu-id="5cdf8-192">Calls SQLExecute or SQLExecDirect.</span></span> <span data-ttu-id="5cdf8-193">Cela retourne SQL_NEED_DATA s'il y a des paramètres SQL_PARAM_INPUT ou SQL_PARAM_INPUT_OUTPUT à gérer comme paramètres « data-at-execution ».</span><span class="sxs-lookup"><span data-stu-id="5cdf8-193">This will return SQL_NEED_DATA if there are any SQL_PARAM_INPUT or SQL_PARAM_INPUT_OUTPUT parameters to be handled as data-at-execution parameters.</span></span> <span data-ttu-id="5cdf8-194">Dans ce cas, l'application effectue les opérations suivantes :</span><span class="sxs-lookup"><span data-stu-id="5cdf8-194">In this case, the application does the following:</span></span>  
  
    -   <span data-ttu-id="5cdf8-195">Appelle SQLParamData.</span><span class="sxs-lookup"><span data-stu-id="5cdf8-195">Calls SQLParamData.</span></span> <span data-ttu-id="5cdf8-196">Cela retourne la valeur *ParameterValuePtr* pour un paramètre de données en cours d’exécution et un code de retour de SQL_NEED_DATA.</span><span class="sxs-lookup"><span data-stu-id="5cdf8-196">This returns the *ParameterValuePtr* value for a data-at-execution parameter and a return code of SQL_NEED_DATA.</span></span> <span data-ttu-id="5cdf8-197">Lorsque toutes les données de paramètre ont été transmises au pilote, SQLParamData retourne SQL_SUCCESS, SQL_SUCCESS_WITH_INFO ou SQL_ERROR.</span><span class="sxs-lookup"><span data-stu-id="5cdf8-197">When all parameter data has been passed to the driver, SQLParamData returns SQL_SUCCESS, SQL_SUCCESS_WITH_INFO, or SQL_ERROR.</span></span> <span data-ttu-id="5cdf8-198">Pour les paramètres de données en cours d’exécution, *ParameterValuePtr*, qui est le même que le champ de descripteur SQL_DESC_DATA_PTR, peut être considéré comme un jeton pour identifier de manière unique un paramètre pour lequel une valeur est requise.</span><span class="sxs-lookup"><span data-stu-id="5cdf8-198">For data-at-execution parameters, *ParameterValuePtr*, which is the same as the descriptor field SQL_DESC_DATA_PTR, can be regarded as a token to uniquely identify a parameter for which a value is required.</span></span> <span data-ttu-id="5cdf8-199">Ce « jeton » est passé de l'application au pilote au moment de la liaison, puis repassé à l'application au moment de l'exécution.</span><span class="sxs-lookup"><span data-stu-id="5cdf8-199">This "token" is passed from the application to the driver at bind time, then passed back to the application at execution time.</span></span>  
  
4.  <span data-ttu-id="5cdf8-200">Pour envoyer des données de ligne de paramètre table pour les paramètres table null, si le paramètre table n’a pas de ligne, une application appelle SQLPutData avec *StrLen_Or_Ind* défini sur SQL_DEFAULT_PARAM.</span><span class="sxs-lookup"><span data-stu-id="5cdf8-200">To send table-valued parameter row data for null table-valued parameters, if the table-valued parameter has no rows, an application calls SQLPutData with *StrLen_or_Ind* set to SQL_DEFAULT_PARAM.</span></span>  
  
     <span data-ttu-id="5cdf8-201">Pour les paramètres table non nuls, une application :</span><span class="sxs-lookup"><span data-stu-id="5cdf8-201">For non-NULL TVPs, an application:</span></span>  
  
    -   <span data-ttu-id="5cdf8-202">Définit *Str_Len_or_Ind* pour toutes les colonnes de paramètre table sur les valeurs appropriées, et remplit les tampons de données pour les colonnes de paramètre table qui ne sont pas des paramètres de données en cours d’exécution.</span><span class="sxs-lookup"><span data-stu-id="5cdf8-202">Sets *Str_Len_or_Ind* for all the table-valued parameter columns to appropriate values, and populates data buffers for table-valued parameter columns that are not to be data-at-execution parameters.</span></span> <span data-ttu-id="5cdf8-203">Vous pouvez utiliser la fonctionnalité « data-at-execution » pour les colonnes de paramètres table d'une manière semblable à celle employée lorsque des paramètres ordinaires sont passés au pilote par fragments.</span><span class="sxs-lookup"><span data-stu-id="5cdf8-203">You can use data-at-execution for table-valued parameter columns in a similar way to that in which ordinary parameters can be passed to the driver in pieces.</span></span>  
  
    -   <span data-ttu-id="5cdf8-204">Appelle SQLPutData avec *Str_Len_or_Ind* défini sur le nombre de lignes à envoyer au serveur.</span><span class="sxs-lookup"><span data-stu-id="5cdf8-204">Calls SQLPutData with *Str_Len_or_Ind* set to the number of rows to be sent to the server.</span></span> <span data-ttu-id="5cdf8-205">Toute valeur en dehors de la plage 0 à SQL_DESC_ARRAY_SIZE ou SQL_DEFAULT_PARAM est une erreur et retourne SQLSTATE HY090 avec le message « Longueur de chaîne ou de mémoire tampon non valide ».</span><span class="sxs-lookup"><span data-stu-id="5cdf8-205">Any value outside the range 0 to SQL_DESC_ARRAY_SIZE or SQL_DEFAULT_PARAM is an error, and will return SQLSTATE HY090, with the message "Invalid string or buffer length".</span></span> <span data-ttu-id="5cdf8-206">0 indique que toutes les lignes ont été envoyées et qu'il n'y a plus de données pour un paramètre table (comme noté dans le deuxième élément de puce dans cette liste).</span><span class="sxs-lookup"><span data-stu-id="5cdf8-206">0 indicates that all rows have been sent and there is no more data for a table-valued parameter (as noted in the second bullet item in this list).</span></span> <span data-ttu-id="5cdf8-207">SQL_DEFAULT_PARAM peut être utilisé uniquement la première fois que le pilote demande des données pour un paramètre table (comme décrit dans le premier élément de puce dans cette liste).</span><span class="sxs-lookup"><span data-stu-id="5cdf8-207">SQL_DEFAULT_PARAM can only be used the first time the driver requests data for a table-valued parameter (as described in the first bullet item in this list).</span></span>  
  
5.  <span data-ttu-id="5cdf8-208">Lorsque toutes les lignes ont été envoyées, appelle SQLPutData pour le paramètre table avec une valeur *Str_Len_or_Ind* égale à 0, puis passe à l’étape 3A ci-dessus.</span><span class="sxs-lookup"><span data-stu-id="5cdf8-208">When all rows have been sent, calls SQLPutData for the table-valued parameter with a *Str_Len_or_Ind* value of 0, then proceeds to step 3a above.</span></span>  
  
6.  <span data-ttu-id="5cdf8-209">Rappelle SQLParamData.</span><span class="sxs-lookup"><span data-stu-id="5cdf8-209">Calls SQLParamData again.</span></span> <span data-ttu-id="5cdf8-210">S’il existe des paramètres de données en cours d’exécution parmi les colonnes de paramètre table, ceux-ci sont identifiés par la valeur *ValuePtrPtr* retournée par SQLParamData.</span><span class="sxs-lookup"><span data-stu-id="5cdf8-210">If there are any data-at-execution parameters among the table-valued parameter columns, these will be identified by the value *ValuePtrPtr* returned by SQLParamData.</span></span> <span data-ttu-id="5cdf8-211">Lorsque toutes les valeurs de colonne sont disponibles, SQLParamData retourne à nouveau la valeur *ParameterValuePtr* pour le paramètre table, et l’application recommence.</span><span class="sxs-lookup"><span data-stu-id="5cdf8-211">When all column values are available, SQLParamData will again return the *ParameterValuePtr* value for the table-valued parameter, and the application begins again.</span></span>  
  
## <a name="see-also"></a><span data-ttu-id="5cdf8-212">Voir aussi</span><span class="sxs-lookup"><span data-stu-id="5cdf8-212">See Also</span></span>  
 [<span data-ttu-id="5cdf8-213">Paramètres table &#40;ODBC&#41;</span><span class="sxs-lookup"><span data-stu-id="5cdf8-213">Table-Valued Parameters &#40;ODBC&#41;</span></span>](table-valued-parameters-odbc.md)  
  
  
