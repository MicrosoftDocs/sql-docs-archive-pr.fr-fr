---
title: Gestion des connexions et des travaux après un basculement de rôle (SQL Server) | Microsoft Docs
ms.custom: ''
ms.date: 06/13/2017
ms.prod: sql-server-2014
ms.reviewer: ''
ms.technology: high-availability
ms.topic: conceptual
helpviewer_keywords:
- role switching [SQL Server]
ms.assetid: fc2fc949-746f-40c7-b5d4-3fd51ccfbd7b
author: MikeRayMSFT
ms.author: mikeray
ms.openlocfilehash: 9c099bf9ea271b5ea93fdebfe8f35c98864bca09
ms.sourcegitcommit: ad4d92dce894592a259721a1571b1d8736abacdb
ms.translationtype: MT
ms.contentlocale: fr-FR
ms.lasthandoff: 08/04/2020
ms.locfileid: "87605030"
---
# <a name="management-of-logins-and-jobs-after-role-switching-sql-server"></a><span data-ttu-id="8058b-102">Gestion des connexions et des travaux après un basculement de rôle (SQL Server)</span><span class="sxs-lookup"><span data-stu-id="8058b-102">Management of Logins and Jobs After Role Switching (SQL Server)</span></span>
  <span data-ttu-id="8058b-103"> Lors du déploiement d’une solution de récupération d’urgence ou haute disponibilité pour une base de données [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)], il est important de reproduire les informations importantes stockées pour la base de données dans les bases de données **master** ou **msdb**.</span><span class="sxs-lookup"><span data-stu-id="8058b-103">When deploying a high-availability or disaster-recovery solution for a [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] database, it is important to reproduce relevant information that is stored for the database in the **master** or **msdb** databases.</span></span> <span data-ttu-id="8058b-104">En général, les informations importantes incluent les travaux de la base de données primaire/principale et les connexions des utilisateurs ou des processus qui doivent se connecter à la base de données.</span><span class="sxs-lookup"><span data-stu-id="8058b-104">Typically, the relevant information includes the jobs of the primary/principal database and the logins of users or processes that need to connect to the database.</span></span> <span data-ttu-id="8058b-105">Vous devez dupliquer ces informations dans une instance de [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] qui héberge une base de données secondaire/miroir.</span><span class="sxs-lookup"><span data-stu-id="8058b-105">You should duplicate this information on any instance of [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] that hosts a secondary/mirror database.</span></span> <span data-ttu-id="8058b-106">Si possible, il est préférable de reproduire, par programmation, l'information au niveau de la nouvelle base de données primaire/principale, après le basculement des rôles.</span><span class="sxs-lookup"><span data-stu-id="8058b-106">If possible after roles are switched, it is best to programmatically reproduce the information on the new primary/principal database.</span></span>  
  
## <a name="logins"></a><span data-ttu-id="8058b-107">Connexions</span><span class="sxs-lookup"><span data-stu-id="8058b-107">Logins</span></span>  
 <span data-ttu-id="8058b-108">Sur chaque instance de serveur qui héberge une copie de la base de données, vous devez reproduire les connexions qui sont autorisées à accéder à la base de données principale.</span><span class="sxs-lookup"><span data-stu-id="8058b-108">On every server instances that hosts a copy of the database, you should reproduce the logins that have permission to access the principal database.</span></span> <span data-ttu-id="8058b-109">Lorsque le rôle primaire/principal bascule, seuls les utilisateurs dont les connexions existent sur la nouvelle instance de serveur primaire/principal peuvent accéder à la nouvelle base de données primaire/principale.</span><span class="sxs-lookup"><span data-stu-id="8058b-109">When the primary/principal role switches, only users whose logins exist on the new primary/principal server instance can access the new primary/principal database.</span></span> <span data-ttu-id="8058b-110">Les utilisateurs dont les connexions ne sont pas définies sur la nouvelle instance de serveur primaire/principal sont orphelins et ne peuvent pas accéder à la base de données.</span><span class="sxs-lookup"><span data-stu-id="8058b-110">Users whose logins are not defined on the new primary/principal server instance are orphaned and cannot access the database.</span></span>  
  
 <span data-ttu-id="8058b-111">Si un utilisateur est orphelin, créez la connexion sur la nouvelle instance de serveur primaire/principal et exécutez [sp_change_users_login](/sql/relational-databases/system-stored-procedures/sp-change-users-login-transact-sql).</span><span class="sxs-lookup"><span data-stu-id="8058b-111">If a user is orphaned, create the login on the new primary/principal server instance and run [sp_change_users_login](/sql/relational-databases/system-stored-procedures/sp-change-users-login-transact-sql).</span></span> <span data-ttu-id="8058b-112">Pour plus d’informations, consultez [Dépanner des utilisateurs orphelins &#40;SQL Server&#41;](troubleshoot-orphaned-users-sql-server.md).</span><span class="sxs-lookup"><span data-stu-id="8058b-112">For more information, see [Troubleshoot Orphaned Users &#40;SQL Server&#41;](troubleshoot-orphaned-users-sql-server.md).</span></span>  
  
###  <a name="logins-of-applications-that-use-sql-server-authentication-or-a-local-windows-login"></a><a name="SSauthentication"></a> <span data-ttu-id="8058b-113">Connexions des applications qui utilisent l’authentification SQL Server ou une connexion locale Windows</span><span class="sxs-lookup"><span data-stu-id="8058b-113">Logins Of Applications That Use SQL Server Authentication or a Local Windows Login</span></span>  
 <span data-ttu-id="8058b-114">Si une application utilise l'authentification SQL Server ou une connexion locale Windows, des SID incompatibles peuvent empêcher la résolution de la connexion de l'application sur une instance distante de [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)].</span><span class="sxs-lookup"><span data-stu-id="8058b-114">If an application uses SQL Server Authentication or a local Windows login, mismatched SIDs can prevent the application's login from resolving on a remote instance of [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)].</span></span> <span data-ttu-id="8058b-115">En cas de SID incompatibles, la connexion peut se solder par un utilisateur orphelin sur l'instance de serveur distante.</span><span class="sxs-lookup"><span data-stu-id="8058b-115">The mismatched SIDs cause the login to become an orphaned user on the remote server instance.</span></span> <span data-ttu-id="8058b-116">Ce problème peut se produire lorsqu'une application se connecte à une base de données de copie des journaux de transaction ou une base de données mise en miroir suite à un basculement ou à une base de données d'abonné de réplication qui a été initialisée à partir d'une sauvegarde.</span><span class="sxs-lookup"><span data-stu-id="8058b-116">This issue can occur when an application connects to a mirrored or log shipping database after a failover or to a replication subscriber database that was initialized from a backup.</span></span>  
  
 <span data-ttu-id="8058b-117">Pour éviter ce problème, nous vous recommandons de prendre des mesures préventives lorsque vous configurez une telle application de manière à utiliser une base de données hébergée par une instance distante de [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)].</span><span class="sxs-lookup"><span data-stu-id="8058b-117">To prevent this issue, we recommend that you take preventative measures when you set up such an application to use a database that is hosted by a remote instance of [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)].</span></span> <span data-ttu-id="8058b-118">La prévention implique de transférer des connexions et des mots de passe de l'instance locale de [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] à l'instance distante de [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)].</span><span class="sxs-lookup"><span data-stu-id="8058b-118">Prevention involves transferring the logins and the passwords from the local instance of [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] to the remote instance of [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)].</span></span> <span data-ttu-id="8058b-119">Pour plus d’informations sur la manière d’éviter ce problème, consultez l’article 918992 de la Base de connaissances : [Comment faire pour transférer des noms d’accès et des mots de passe entre instances de SQL Server](https://support.microsoft.com/kb/918992/).</span><span class="sxs-lookup"><span data-stu-id="8058b-119">For more information about how to prevent this issue, see KB article 918992 -[How to transfer logins and passwords between instances of SQL Server](https://support.microsoft.com/kb/918992/)).</span></span>  
  
> [!NOTE]  
>  <span data-ttu-id="8058b-120">Ce problème affecte les comptes Windows locaux sur différents ordinateurs.</span><span class="sxs-lookup"><span data-stu-id="8058b-120">This problem affects Windows local accounts on different computers.</span></span> <span data-ttu-id="8058b-121">Toutefois, ce problème ne se pose pas pour les comptes de domaine car le SID est identique sur chacun des ordinateurs.</span><span class="sxs-lookup"><span data-stu-id="8058b-121">However, this problem does not occur for domain accounts because the SID is the same on each of the computers.</span></span>  
  
 <span data-ttu-id="8058b-122">Pour plus d’informations, consultez [Orphaned Users with Database Mirroring and Log Shipping (Utilisateurs orphelins avec mise en miroir de bases de données et copie des journaux de transaction)](https://blogs.msdn.com/b/sqlserverfaq/archive/2009/04/13/orphaned-users-with-database-mirroring-and-log-shipping.aspx) (blog du moteur de base de données).</span><span class="sxs-lookup"><span data-stu-id="8058b-122">For more information, see [Orphaned Users with Database Mirroring and Log Shipping](https://blogs.msdn.com/b/sqlserverfaq/archive/2009/04/13/orphaned-users-with-database-mirroring-and-log-shipping.aspx) (a Database Engine blog).</span></span>  
  
## <a name="jobs"></a><span data-ttu-id="8058b-123">travaux</span><span class="sxs-lookup"><span data-stu-id="8058b-123">Jobs</span></span>  
 <span data-ttu-id="8058b-124">Les travaux tels que les travaux de sauvegarde, requièrent une attention particulière.</span><span class="sxs-lookup"><span data-stu-id="8058b-124">Jobs, such as backup jobs, require special consideration.</span></span> <span data-ttu-id="8058b-125">Généralement, après un basculement de rôle, le propriétaire de la base de données ou l'administrateur système doit recréer les travaux de la nouvelle base de données primaire/principale.</span><span class="sxs-lookup"><span data-stu-id="8058b-125">Typically, after a role switch, the database owner or system administrator must re-create the jobs for the new primary/principal database.</span></span>  
  
 <span data-ttu-id="8058b-126">Lorsque l'ancienne instance de serveur primaire/principal est disponible, vous devez supprimer les travaux originaux sur cette instance de [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)].</span><span class="sxs-lookup"><span data-stu-id="8058b-126">When the former primary/principal server instance is available, you should delete the original jobs on that instanceof [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)].</span></span> <span data-ttu-id="8058b-127">Notez que ces travaux de la base de données miroir actuelle échouent dans la mesure où celle-ci se trouve en état de restauration (RESTORING) et qu'elle n'est ainsi pas disponible.</span><span class="sxs-lookup"><span data-stu-id="8058b-127">Note that jobs on the current mirror database fail because it is in the RESTORING state, making it unavailable.</span></span>  
  
> [!NOTE]  
>  <span data-ttu-id="8058b-128">Différentes instances de [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] peuvent être configurées différemment, avec des lettres de lecteurs de lecteur différentes, ou quelque chose d'équivalent.</span><span class="sxs-lookup"><span data-stu-id="8058b-128">Different instances of [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] might be configured differently, with different drive letters or such.</span></span> <span data-ttu-id="8058b-129">Les travaux de chaque partenaire doivent autoriser de telles différences.</span><span class="sxs-lookup"><span data-stu-id="8058b-129">The jobs for each partner must allow for any such differences.</span></span>  
  
## <a name="see-also"></a><span data-ttu-id="8058b-130">Voir aussi</span><span class="sxs-lookup"><span data-stu-id="8058b-130">See Also</span></span>  
 <span data-ttu-id="8058b-131">[Gérer les métadonnées durant la mise à disposition d’une base de données sur une autre instance de serveur &#40;SQL Server&#41;](../../relational-databases/databases/manage-metadata-when-making-a-database-available-on-another-server.md) </span><span class="sxs-lookup"><span data-stu-id="8058b-131">[Manage Metadata When Making a Database Available on Another Server Instance &#40;SQL Server&#41;](../../relational-databases/databases/manage-metadata-when-making-a-database-available-on-another-server.md) </span></span>  
 [<span data-ttu-id="8058b-132">Dépanner des utilisateurs orphelins &#40;SQL Server&#41;</span><span class="sxs-lookup"><span data-stu-id="8058b-132">Troubleshoot Orphaned Users &#40;SQL Server&#41;</span></span>](troubleshoot-orphaned-users-sql-server.md)  
  
  
